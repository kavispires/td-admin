import{j as A}from"./index-AeBhBC7r.js";import{V as T}from"./VirtualizationWrapper-DHo53XDG.js";import{I as $}from"./ImageCard-B3O3rSIp.js";import{u as w}from"./useQueryParams-CkFTvRtk.js";import{l as L}from"./useBaseUrl-CGD9CB6e.js";import{u as V}from"./useResourceFirestoreData-DRE8PPhn.js";import{u as E}from"./useTDResource-CfBHyLv8.js";function J({cardId:s,variant:r,...t}){const{queryParams:n}=w(),o=r??n.get("variant")??"gb";return A.jsx(T,{aspectRatio:"2:3",width:t.cardWidth??75,children:A.jsx($,{cardId:q(s,o),...t})})}const q=(()=>{const s=new Map;return(r,t)=>{if(!t)return r;const n=`${r}|${t??""}`;if(s.has(n))return s.get(n);const o=r.split("-"),i=`${o[0]}-${t}-${o[o.length-1]}`;return s.set(n,i),i}})(),B=(s,r,t,n)=>{const{reliabilityThreshold:o=4,projectionThreshold:i=55}={},f=`us-gb-${s.split("-")[1].padStart(3,"0")}`,e=L.isEmpty(t[s])?[]:t[s],c=e.some(a=>a===32||a===-32);let h=0,m=0,u=0,g=0,l=0;e.forEach(a=>{a===32?h+=35:a===-32?m+=35:a===4?h+=4:a===-4?m+=4:a>0?u+=a:a<0&&(g+=Math.abs(a)),l+=Math.abs(a)});const x=u+g,y=Math.max(l,o),p=l===0?0:Math.round((h+u)/y*100),d=l===0?0:Math.round((m+g)/y*100),M=h+u,S=m+g,R=l===0?100:Math.round((y-M-S)/y*100),z=c||l>=o,D=c||x>o/1.5||l>=4,j=D&&l>o&&Math.abs(p-d)>=40,C=j&&Math.abs(p-d)>40?p>d?"ğŸ‘":"ğŸ‘":null,O=Math.abs(p-d)<50?null:p>=i?"ğŸ‘":d>=i?"ğŸ‘":null;return{suspectCardId:s,imageId:f,questionId:r,enoughData:D,reliable:j,total:l,yesCount:M,yesPercentage:p,noCount:S,noPercentage:d,blankPercentage:R,complete:z,values:e,resolution:C,projection:O}};function G(s){const r=s.map(e=>e===0?-1:e),t=s.filter(e=>e===-32||e===32||e===4||e===-4),n=r.filter(e=>e===-1||e===1),o=r.filter(e=>![-32,32,4,-4,-1,1].includes(e)).flatMap(e=>Array.from({length:Math.abs(e)},()=>e>0?1:-1)),i=[...n,...o].sort((e,c)=>e-c),b={"-1":0,1:0};i.forEach(e=>{(e===-1||e===1)&&(b[e]+=1)});const f=8;for(const[e,c]of Object.entries(b)){const h=Math.floor(c/f),m=c%f;for(let u=0;u<h;u++)t.push(e==="-1"?-f:f);if(m>0){const u=Array.from({length:m},()=>e==="-1"?-1:1);t.push(...u)}}return t.sort((e,c)=>e-c)}const K=s=>s.reduce((r,t)=>{const n=Math.abs(t);return n?r+n:r},0);function U(){const s=E("suspects"),r=E("testimony-questions-pt"),t=V({tdrResourceName:"testimony-answers",firestoreDataCollectionName:"testimonies",serialize:!0,deserializer:F});return{...t,isLoading:t.isLoading||r.isLoading||s.isLoading,isSuccess:t.isSuccess&&r.isSuccess&&s.isSuccess,error:t.error||r.error||s.error,questions:r.data,suspects:s.data,hasNewData:t.hasFirestoreData}}function F(s){const r={};return Object.entries(s).forEach(([t,n])=>{r[t]={},Object.entries(n).forEach(([o,i])=>{r[t][o]=JSON.parse(i)})}),r}export{J as S,B as a,K as c,q as g,G as n,F as t,U as u};
