import{j as e,F as d,T as h,q as L,S as v,B as Q,r as p,M as E,D as b,P as A,L as P}from"./index-AeBhBC7r.js";import{D as $}from"./DataLoadingWrapper-ChvbOcIh.js";import{T as z}from"./Typeahead-euT8_tzS.js";import{R as D,I}from"./Item-D1fhDPdc.js";import{u as M}from"./useCopyToClipboardFunction-1voR8M_w.js";import{u as G}from"./useTableExpandableRows-C-hQ4Vh2.js";import{u as J}from"./useTablePagination-BxigUU9d.js";import{u as w}from"./useTDResource-CfBHyLv8.js";import{l as y,P as W}from"./useBaseUrl-CGD9CB6e.js";import{r as S,g as _,c as U,w as Y,a as K}from"./index-dN5o3TnW.js";import{I as F}from"./InspirationSample-DNcH3GjI.js";import{I as X}from"./ItemsTypeahead-CV-OTlJr.js";import{F as N}from"./Table-DtkA7GhK.js";import{S as H}from"./index-cQwL5GOf.js";import{R as V}from"./index-Ca1XzAc2.js";import{S as Z}from"./index-D3aHxMAZ.js";import{P as q}from"./index-BW3wABTi.js";import{R as ee}from"./DeleteFilled-B0c7ClMY.js";import{u as R}from"./useQueryParams-CkFTvRtk.js";import{b as te,F as se,T as k}from"./FilterEntries-B20fNyqW.js";import{S as re}from"./SiderContent-BBrCGPee.js";import{D as ie,B as ae}from"./DownloadButton-2dt99Wgn.js";import{S as ne}from"./SaveButton-CGZ119o_.js";import{C as oe}from"./index-ylX_DNMx.js";import{R as le}from"./TableOutlined-5EI_WAnz.js";import{R as ce}from"./FrownOutlined-Ce8JjuTm.js";import{R as de}from"./RobotOutlined-XAR4knQA.js";import{T as ue}from"./TransparentButton-p7EK8Fi4.js";import{u as me,P as pe}from"./useGridPagination-CkqYH3_T.js";import{I as B}from"./ItemBuildingBlocks-DaHejb99.js";import{D as he}from"./index-CzHEkavl.js";import{R as xe}from"./main-CuZ4d4QD.js";import{u as je}from"./daily-quartetos-Ctsk5ki8.js";import{g as fe}from"./useParsedHistory-DBek8UGb.js";import{u as ge}from"./useResourceFirestoreData-DRE8PPhn.js";import"./useDebounce-BB2JKJhA.js";import"./index--19LBFFZ.js";import"./constants-CYJN94L5.js";import"./SyncOutlined-BTO40fVs.js";import"./PlusOutlined-C9LcCiU-.js";import"./index-BTFqW_tr.js";import"./Dropdown-9ElPI2lv.js";import"./index-Djnq5RxC.js";import"./index-CUiOQ1bq.js";import"./scrollTo-DIF_ikdQ.js";import"./Pagination-_Cc5bCRA.js";import"./index-RkF4G9iN.js";import"./moment-B-YVwB4U.js";import"./SaveOutlined-54X7fwx9.js";import"./index-CFL2EcdZ.js";import"./LanguageFlag-Bo9CVRno.js";import"./IdcardOutlined-qYBd3D5x.js";import"./warnings--oGBrb1a.js";import"./useGetFirestoreDoc-3AobfX5J.js";import"./useUpdateFirestoreDoc-BmAQD6Af.js";import"./useMutation-WOFFLZsP.js";const ye=y.orderBy(["general","visual","word","thematic","attribute"]).map(t=>({label:t,value:t}));function O({rows:t,addEntryToUpdate:s}){const r=M(),a=w("items"),n=J({total:t.length,showQuickJumper:!0}),l=[{title:"ID",dataIndex:"id",render(i,o){return e.jsxs(d,{align:"center",gap:3,children:[o.itemsIds.length>=4&&!o.level&&e.jsx(D,{style:{color:"red"}}),e.jsx(h.Text,{copyable:!0,children:i})]})}},{title:"Title",dataIndex:"title",render:(i,o)=>e.jsx(Ce,{addEntryToUpdate:s,property:"title",quartet:o,value:i}),sorter:(i,o)=>i.title.localeCompare(o.title)},N.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(i,o)=>e.jsx(we,{addEntryToUpdate:s,copyToClipboard:r,itemsIds:i,quartet:o}),sorter:(i,o)=>i.itemsIds.length-o.itemsIds.length},{title:"Count",dataIndex:"itemsIds",render:i=>S(i).filter(Boolean).length,sorter:(i,o)=>i.itemsIds.length-o.itemsIds.length},{title:"Type",dataIndex:"type",render:(i,o)=>e.jsx(H,{defaultValue:i,onChange:x=>s(o.id,{...o,type:x}),options:ye,size:"small",style:{width:100}}),sorter:(i,o)=>(i.type??"_").localeCompare(o.type??"_")},{title:"Level",dataIndex:"level",render:(i,o)=>e.jsx(V,{count:4,onChange:x=>s(o.id,{...o,level:x}),value:i}),sorter:(i,o)=>i.level-o.level},{title:"Perfect Quartet",dataIndex:"itemsIds",render:i=>S(i).filter(Boolean).length===4&&e.jsx(L,{style:{color:"dodgerblue"}})},{title:"Flagged",dataIndex:"flagged",render:(i,o)=>e.jsx(Z,{checked:i,checkedChildren:e.jsx(D,{style:{color:"red"}}),onChange:x=>{if(x)s(o.id,{...o,flagged:x});else{const f=y.cloneDeep(o);delete f.flagged,s(o.id,f)}}}),sorter:(i,o)=>(i.flagged?1:0)-(o.flagged?1:0)}],c=G({maxExpandedRows:1,expandedRowRender:i=>e.jsx(Ie,{addEntryToUpdate:s,quartet:i}),rowExpandable:()=>a.isSuccess});return e.jsx(N,{columns:l,dataSource:t,expandable:c,pagination:n,rowClassName:i=>i.itemsIds.length>=4&&!i.level?"table-row-error":"",rowKey:"id"})}function Ie({quartet:t,addEntryToUpdate:s}){const r=a=>{s(t.id,{...t,itemsIds:[...t.itemsIds,a]})};return e.jsxs("div",{children:[e.jsx(X,{onFinish:r}),e.jsx(F,{excludeList:t.itemsIds,initialQuantity:0,onSelect:r})]})}function ve({quartet:t,addEntryToUpdate:s,itemId:r}){const a=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(n=>n!==r)})};return e.jsx(q,{cancelText:"No",okText:"Yes",onConfirm:a,title:"Are you sure you want to remove this item?",children:e.jsx(Q,{icon:e.jsx(ee,{}),size:"small",type:"text"})})}function we({quartet:t,itemsIds:s,copyToClipboard:r,addEntryToUpdate:a}){return e.jsx(d,{gap:6,wrap:"wrap",children:s.map(n=>e.jsxs(d,{gap:2,vertical:!0,children:[n?e.jsx(I,{itemId:String(n),width:60}):'"ERROR"',e.jsxs(d,{justify:"center",children:[e.jsx(h.Text,{onClick:()=>r(n),children:n}),e.jsx(ve,{addEntryToUpdate:a,itemId:n,quartet:t})]})]},`${t.title}-${n}`))},`items-${t.title}`)}function Ce({value:t,quartet:s,addEntryToUpdate:r,property:a}){const n=l=>typeof t=="number"?l!==String(t)?r(s.id,{...s,[a]:Number(l)}):null:l!==t?r(s.id,{...s,[a]:l.trim()}):null;return e.jsx(v,{children:e.jsx(h.Text,{editable:{onChange:n},children:String(t)})})}function T({data:t,addEntryToUpdate:s}){const[r,a]=p.useState(null),n=p.useMemo(()=>r?t[r]:null,[r,t]);return e.jsxs(v,{orientation:"vertical",children:[e.jsx(h.Title,{level:5,children:"Search Quartet"}),e.jsx(z,{data:t,onFinish:l=>a(l),parser:be,placeholder:"Search quartet by title..."}),!!n&&e.jsx(O,{addEntryToUpdate:s,rows:[n]})]})}const be=t=>Object.values(t??{}).reduce((s,r)=>(s[`${r.title} (${r.id})`]=r.id,s),{});function Se({data:t,addEntryToUpdate:s}){const{is:r}=R(),a=r("emptyOnly"),n=p.useMemo(()=>a?y.orderBy(Object.values(t).filter(c=>c.itemsIds.length<4),["id"],["asc"]):y.orderBy(Object.values(t),["id"],["asc"]),[t,a]),l=n.filter(c=>c.itemsIds.length===4).length;return e.jsxs(v,{orientation:"vertical",children:[e.jsxs(h.Title,{level:5,children:["Total Quartets: ",n.length," | Complete Quartets: ",l]}),e.jsx(O,{addEntryToUpdate:s,rows:n})]})}function Te({data:t,addEntryToUpdate:s}){const[r,a]=p.useState(!1),n=p.useMemo(()=>_(Object.keys(t)),[t]),l=()=>y.cloneDeep({id:n,title:"",itemsIds:[],level:0}),[c,i]=p.useState(l()),o=(j,m)=>{i({...m})},x=j=>{i(m=>({...m,itemsIds:S([...m.itemsIds,j])}))},f=async()=>{s(c.id,y.cloneDeep(c)),a(!1),await Y(250),i(l())},u=p.useMemo(()=>c.title.length<3?[]:y.orderBy(Object.values(t),j=>U.compareTwoStrings(j.title.toLocaleLowerCase(),c.title.toLocaleLowerCase()),"desc").slice(0,5).filter(j=>j.id!==c.id),[c.title,c.id,t]);return e.jsxs(e.Fragment,{children:[e.jsx(Q,{block:!0,onClick:()=>a(!0),type:"dashed",children:"Add New Set"}),e.jsx(E,{maskClosable:!1,okButtonProps:{disabled:!c.title,onClick:f},onCancel:()=>a(!1),open:r,title:"Add Quartet",width:"80vw",children:!!c&&e.jsxs(e.Fragment,{children:[e.jsx(O,{addEntryToUpdate:o,expandedRowKeys:[c.id],rows:[c]}),u.length>0&&e.jsx(oe,{size:"small",children:e.jsx(d,{gap:4,vertical:!0,children:u.map(j=>e.jsx("div",{children:j.title},j.id))})}),e.jsx(F,{excludeList:c.itemsIds,onSelect:x})]})})]})}function Qe({data:t,save:s,isDirty:r,isSaving:a,entriesToUpdate:n,addEntryToUpdate:l,hasFirestoreData:c}){const{is:i,addParam:o,queryParams:x,addParams:f}=R();return Oe(),e.jsxs(re,{children:[e.jsxs(d,{gap:12,vertical:!0,children:[e.jsx(ne,{dirt:JSON.stringify(n),isDirty:r,isSaving:a,onSave:s}),e.jsx(ie,{block:!0,data:()=>Re(t),disabled:r,fileName:"daily-quartet-sets.json",hasNewData:c})]}),e.jsx(b,{}),e.jsx(te,{label:"Pending Only",onChange:u=>o("emptyOnly",u,!1),value:i("emptyOnly")}),e.jsx(Te,{addEntryToUpdate:l,data:t}),e.jsx(b,{}),e.jsx(se,{label:"Display",onChange:u=>f({display:u,page:1},{page:1,display:"table"}),options:[{title:"Table",icon:e.jsx(le,{}),value:"table"},{title:"Orphans",icon:e.jsx(ce,{}),value:"orphans"},{title:"Simulator",icon:e.jsx(de,{}),value:"simulator"}],value:x.get("display")??"table"})]})}function Re(t){return K(t)}function Oe(){const t=w("items");p.useEffect(()=>{if(!t.dataUpdatedAt)return;const s={twoChars:{},threeChars:{},fourChars:{}};Object.values(t.data??{}).forEach(r=>{const a=r.name.pt||r.aliasesPt?.find(i=>i.split(" ").length===1);if(!a||a.length<3)return;const n=a.slice(-2).trim();if(n.length<2)return;s.twoChars[n]||(s.twoChars[n]=[]),s.twoChars[n].push(r);const l=a.slice(-3).trim();if(l.length<3)return;s.threeChars[l]||(s.threeChars[l]=[]),s.threeChars[l].push(r);const c=a.slice(-4).trim();c.length<4||(s.fourChars[c]||(s.fourChars[c]=[]),s.fourChars[c].push(r))}),Object.keys(s).forEach(r=>{Object.keys(s[r]).forEach(a=>{s[r][a].length<4&&delete s[r][a]})}),console.log("Grouped Items by Name Ending:",s)},[t.dataUpdatedAt])}function Pe({data:t,...s}){const r=w("items"),[a,n]=p.useState(null),[l,c]=p.useState(1),{unusedItems:i,usedItems:o}=p.useMemo(()=>{const u=Object.values(t).reduce((m,g)=>(g.itemsIds.forEach(C=>{m[C]||(m[C]=[]),m[C].push(g.id)}),m),{}),j=Object.keys(r.data||{}).reduce((m,g)=>u[g]?(u[g].length<=l&&(m[g]=u[g].length),m):(m[g]=0,m),{});return{usedItems:u,unusedItems:Object.keys(j).map(m=>({id:m,count:j[m]}))}},[t,r.data,l]),{page:x,pagination:f}=me({data:i,defaultPageSize:64});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(h.Title,{className:"my-0",level:4,children:"Quartetos Orphans Items"}),e.jsx(h.Text,{type:"secondary",children:"These items are not used in any quartet. You can add them to a quartet by clicking on them."})]}),e.jsxs(d,{align:"center",gap:8,children:[e.jsxs("span",{children:[i.length," Orphans | ",Object.keys(o).length," Used"]}),e.jsx(k,{min:0,onChange:u=>c(u??1),size:"small",style:{width:120},suffix:"max uses",value:l})]}),e.jsx(pe,{className:"full-width",pagination:f,children:e.jsx(d,{gap:16,wrap:"wrap",children:x.map(u=>e.jsx(ue,{onClick:()=>n(u.id),children:e.jsxs(d,{style:{maxWidth:84},vertical:!0,children:[e.jsx(I,{itemId:u.id,width:64}),e.jsx(d,{align:"center",children:e.jsx(ae,{count:u.count,offset:[-8,0],children:e.jsx(B,{item:r.data[u.id]})})})]},u.id)},u.id))})}),e.jsx(De,{data:t,itemId:a,onClose:()=>n(null),...s})]})}function De({itemId:t,onClose:s,...r}){const a=w("items"),n=p.useMemo(()=>Object.values(r.data).filter(l=>l.itemsIds.includes(t??"")),[t,r.data]);return t===null?null:e.jsx(he,{onClose:s,open:!!t,placement:"bottom",title:"Item Details",children:e.jsxs(d,{gap:16,children:[e.jsxs(d,{gap:16,vertical:!0,children:[e.jsx(I,{itemId:t,width:64}),e.jsx(B,{item:a.data[t]})]}),e.jsxs(d,{vertical:!0,children:[e.jsxs(h.Text,{strong:!0,children:["Used in ",n.length," quartets:"]}),n.map(l=>e.jsxs(d,{vertical:!0,children:[e.jsx(h.Text,{children:l.title}),e.jsxs(h.Text,{type:"secondary",children:["(",l.id,")"]}),e.jsx(d,{gap:8,wrap:"wrap",children:l.itemsIds.map(c=>e.jsx(I,{itemId:c,width:32},c))}),e.jsx(b,{})]},l.id))]}),e.jsx(T,{...r})]})})}function Ne(){const[t,s]=p.useState({batchSize:1,history:{}}),r=p.useRef(1),{entries:a}=je(!0,"pt",t.batchSize,t.history);return e.jsxs(d,{className:"p-4",gap:12,vertical:!0,children:[e.jsxs(d,{align:"center",justify:"space-between",children:[e.jsx(h.Title,{className:"my-0",level:4,children:"Quartetos Simulator"}),e.jsxs(d,{gap:6,children:[e.jsx(k,{defaultValue:1,max:100,min:1,onChange:n=>{r.current=n??1}}),e.jsx(Q,{onClick:()=>s({batchSize:r.current,history:{}}),type:"primary",children:"Re-run Simulation"})]})]}),e.jsx(Fe,{entries:a})]})}function Fe({entries:t}){const s=fe(),r=t[s];return e.jsxs("div",{className:"full-width grid",style:{gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(xe,{collapsed:3,src:t??{},theme:"twilight"}),e.jsx("div",{children:r&&e.jsx(d,{vertical:!0,children:r.sets.map(a=>e.jsx(ke,{quartet:a},a.id))})})]})}function ke({quartet:t}){return e.jsxs(v,{orientation:"vertical",children:[e.jsxs(h.Text,{strong:!0,children:[t.title," [",t.level,"]"]}),e.jsx(d,{gap:8,children:t.itemsIds.map(s=>e.jsxs(d,{vertical:!0,children:[e.jsx(I,{itemId:s,width:60}),e.jsx(h.Text,{type:"secondary",children:s})]},s))})]})}function Et(){const{queryParams:t}=R(),s=t.get("display"),r=ge({tdrResourceName:"daily-quartet-sets",firestoreDataCollectionName:"quartetSets"});return e.jsx(A,{subtitle:"Quartet Sets",title:"Items",children:e.jsxs(P,{hasSider:!0,children:[e.jsx(W,{children:e.jsx(Qe,{...r})}),e.jsx(P.Content,{className:"content",children:e.jsxs($,{error:r.error,hasResponseData:!y.isEmpty(r.data),isLoading:r.isLoading,children:[s==="simulator"&&e.jsx(Ne,{}),s==="orphans"&&e.jsxs(d,{gap:24,vertical:!0,children:[e.jsx(T,{...r}),e.jsx(Pe,{...r})]}),!s&&e.jsxs(d,{gap:24,vertical:!0,children:[e.jsx(T,{...r}),e.jsx(Se,{...r})]})]})})]})})}export{Et as ItemsQuartets,Et as default};
