import{r as b,a as J,_ as M,j as e,af as B,T as S,B as F,aj as U,D as W,P as A,L as P}from"./index-BmKmifuD.js";import{u as I}from"./useQueryParams-Xp2SkAjz.js";import{u as H,l as x,c as k,P as K}from"./useBaseUrl-CV65xL7T.js";import{D as C}from"./EditableFields-9QkOV5W4.js";import{C as R}from"./CopyToClipboardButton-C3UrthRE.js";import{u as w}from"./useCopyToClipboardFunction-v2jZg77r.js";import{u as z}from"./useTableExpandableRows-Cku_BbcW.js";import{u as _}from"./useTablePagination-BZXZ9gnP.js";import{I as V}from"./Item-BDgAGbk3.js";import{T as q}from"./index-ikDottzl.js";import{F as T}from"./Table-t0JrhtBC.js";import{F as h}from"./index-DZkJ9OT8.js";import{I as G}from"./index-dopZDYz9.js";import{S as O}from"./index-CXjb0pZw.js";import{T as X}from"./index-3FN9VFKp.js";import{F as Y,c as Z}from"./FilterEntries-CRanhvKv.js";import{S as Q}from"./SiderContent-CQJYQry7.js";import{D as g}from"./DownloadButton-tz6fwmNw.js";import{S as v}from"./SaveButton-E-BI8ZxD.js";import{a as $}from"./index-DmSVtCoz.js";import{R as ee}from"./SkinOutlined-aVfSephr.js";import{R as ae}from"./EnvironmentOutlined-n_wh_Bkj.js";import{D as te}from"./DataLoadingWrapper-DfqjV0Gf.js";import{u as y}from"./useResourceFirestoreData-IMf-Ll2Z.js";import{u as ie}from"./useTDResource-C3kg2Dqy.js";import"./LanguageFlag-2FhCtA3U.js";import"./index-DmgRV1Ct.js";import"./FireFilled-17_jJgK3.js";import"./IdcardOutlined-CyQOn2HX.js";import"./CopyOutlined-B3-_qQtO.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-C93JcBPZ.js";import"./index-Dl0nHeYG.js";import"./index-Bp5RKnu_.js";import"./index-B3nqieae.js";import"./scrollTo-Bya_zsyU.js";import"./Pagination-BT7uN7Tb.js";import"./extendsObject-keMuGWqj.js";import"./Input-CEcyoz_o.js";import"./gapSize-U1swVQyS.js";import"./index-CsRa4iyH.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-Gppapl37.js";import"./constants-B4YYuuBb.js";import"./useGetFirestoreDoc--hH88T1t.js";import"./useUpdateFirestoreDoc-C2ni2j9Y.js";import"./useMutation-Dczd92Es.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"},re=function(i,s){return b.createElement(J,M({},i,{ref:s,icon:se}))},oe=b.forwardRef(re);function ne({item:a,cardWidth:i,activeColor:s,isSelected:l=!1,className:r=""}){const{getUrl:p}=H("images"),d=`back/crime${x.capitalize(a.type)}`;return a.itemId?e.jsxs("div",{className:k("crime-item-card",`crime-item-card--${a.type}`,l&&"crime-item-card--selected",r),style:{width:i,backgroundImage:`url(${p(`${d}.jpg`)})`,...s&&l?{borderColor:s,backgroundColor:s}:{}},children:[e.jsx(B,{content:e.jsxs(e.Fragment,{children:[a.name.pt," | ",a.name.en]}),children:e.jsx("div",{className:"crime-item-card__name",style:{maxWidth:`${i}px`},children:e.jsx("span",{children:a.name.en})})}),e.jsx("div",{className:k("crime-item-card__item-container",`crime-item-card__item-container--${a.type}`),children:e.jsx(V,{id:a.itemId,width:i*.75,className:"crime-item-card__item"})})]}):e.jsx(e.Fragment,{children:a.id})}function le({rows:a,onUpdateCard:i,weapons:s,evidence:l,locations:r,victims:p,scenes:d}){const{queryParams:m,addParams:o}=I(),t=m.get("type"),n=[{key:"all",label:"All",children:e.jsx(f,{rows:a,onUpdateCard:i,scenes:d})},{key:"weapons",label:"Weapons",children:e.jsx(f,{rows:s,onUpdateCard:i,scenes:d})},{key:"evidence",label:"Evidence",children:e.jsx(f,{rows:l,onUpdateCard:i,scenes:d})},{key:"locations",label:"Locations",children:e.jsx(f,{rows:r,onUpdateCard:i,scenes:d})},{key:"victims",label:"Victims",children:e.jsx(f,{rows:p,onUpdateCard:i,scenes:d})}],c=u=>{o({type:u,page:"1"})};return e.jsx("div",{className:"my-4",children:e.jsx(q,{defaultActiveKey:t||"all",items:n,onChange:c})})}function f({rows:a,onUpdateCard:i,scenes:s}){const l=w(),r=_({total:a.length,showQuickJumper:!0}),p=(t,n,c)=>{const u=x.cloneDeep(c);u.name[n]=t,i(u)},d=[T.EXPAND_COLUMN,{title:"Id",dataIndex:"id",key:"id",render:t=>e.jsxs("span",{children:[t,e.jsx(R,{content:t})]}),sorter:(t,n)=>t.id.localeCompare(n.id)},{title:"Card",dataIndex:"itemId",key:"itemId",render:(t,n)=>e.jsxs(h,{align:"center",gap:8,children:[e.jsx(ne,{item:n,cardWidth:70}),e.jsx("div",{children:e.jsx(G,{defaultValue:n.itemId,size:"small",onBlur:c=>{var u,j,N,E;if(console.log((u=c==null?void 0:c.target)==null?void 0:u.value),console.log("onBlur"),(j=c==null?void 0:c.target)!=null&&j.value&&((N=c==null?void 0:c.target)==null?void 0:N.value)!==n.itemId){const L=x.cloneDeep(n);L.itemId=(E=c==null?void 0:c.target)==null?void 0:E.value,i(L)}}})})]})},{title:"Name",dataIndex:"name",key:"name",sorter:(t,n)=>t.name.en.localeCompare(n.name.en),render:(t,n)=>e.jsxs(O,{direction:"vertical",style:{minWidth:150},children:[e.jsx(C,{value:t,language:"en",onPressEnter:c=>{var u;return p(((u=c.target)==null?void 0:u.value)||n.name.en,"en",n)}}),e.jsx(C,{value:t,language:"pt",onPressEnter:c=>{var u;return p(((u=c.target)==null?void 0:u.value)||n.name.pt,"pt",n)}})]})},{title:"Type",dataIndex:"type",key:"type",render:t=>e.jsx("span",{children:t}),sorter:(t,n)=>t.type.localeCompare(n.type)}],m=z({maxExpandedRows:1,expandedRowRender:t=>e.jsx(de,{card:t,scenes:s})}),o=()=>{if(r){const{current:t=1,pageSize:n=10}=r,c=a.slice((t-1)*n,t*n),u=[];c.forEach((j,N)=>{u.push(`${N+1}) ${j.name.en}}`)}),console.log(u),l(u.join(`
`))}};return e.jsxs("div",{className:"my-4",children:[e.jsxs(O,{className:"mb-4",children:[e.jsxs(S,{children:[a.length," cards total"]}),e.jsx(F,{onClick:o,children:"Copy Page Cards"})]}),e.jsx(T,{columns:d,dataSource:a,rowKey:"id",expandable:m,pagination:r})]})}function de({card:a,scenes:i}){return e.jsxs("div",{children:[e.jsx(S.Title,{level:5,children:"Scene Likelihood"}),e.jsx("div",{className:"likelihood",children:Object.values(i).map(s=>{var t,n,c,u,j;const[l,r]=((t=a.likelihood)==null?void 0:t[s.id])??[],p=l!==void 0,d=(c=(n=s.values)==null?void 0:n[l])==null?void 0:c.en,m=r!==void 0,o=(j=(u=s.values)==null?void 0:u[r])==null?void 0:j.en;return e.jsxs("div",{className:"likelihood-entry",children:[e.jsx("div",{className:"bold",children:s.title.en}),e.jsx("div",{className:k("likely-result",{"likely-result--no-data":!p||!d}),children:d||"No most likely value"}),e.jsx("div",{className:k("likely-result--2",{"likely-result--no-data":!m||!o}),children:o||"No second most likely value"})]},s.id)})})]})}function ce({sceneQuery:a,objects:i}){const s=w(),l=Object.values(a.data??[]),r=_({total:l.length,showQuickJumper:!0}),p=o=>{const t=[];t.push(`"${o.description.en}"`),o.values.forEach((n,c)=>{t.push(`${c}) ${n.en}`)}),s(t.join(`
`))},d=[{title:"Id",dataIndex:"id",key:"id",render:o=>e.jsxs("span",{children:[o,e.jsx(R,{content:o})]}),sorter:(o,t)=>o.id.localeCompare(t.id)},{title:"Title",dataIndex:"title",key:"title",render:(o,t)=>e.jsxs(O,{direction:"vertical",style:{minWidth:150},children:[e.jsx(C,{value:t.title,language:"en",readOnly:!0}),e.jsx(C,{value:t.title,language:"pt",readOnly:!0})]})},{title:"Type",dataIndex:"type",key:"type",render:o=>e.jsx("span",{children:o}),sorter:(o,t)=>o.type.localeCompare(t.type)},T.EXPAND_COLUMN,{title:"Options",dataIndex:"values",key:"tags",render:(o,t)=>e.jsxs(e.Fragment,{children:[e.jsx(F,{onClick:()=>p(t),children:"Copy options"}),e.jsx("ul",{children:o.map(n=>e.jsx("li",{children:e.jsxs(S,{children:[n.en," / ",n.pt]})},n.en))})]})}],m=z({maxExpandedRows:1,expandedRowRender:o=>e.jsx(me,{scene:o,objects:i})});return e.jsxs("div",{className:"my-4",children:[e.jsx(S.Title,{level:2,className:"my-0",children:"Scenes"}),e.jsx(T,{columns:d,dataSource:l,rowKey:"id",expandable:m,pagination:r})]})}function me({scene:a,objects:i}){const s=b.useMemo(()=>{let l=0;const r={};return i.forEach(d=>{var m;if((m=d.likelihood)!=null&&m[a.id]){const t=d.likelihood[a.id][0];r[t]=(r[t]||0)+1,l+=1}}),Object.entries(r).map(([d,m])=>({value:d,percentage:m/l*100}))},[i,a.id]);return e.jsxs("div",{children:[e.jsxs("h3",{children:[a.title.en," / ",a.title.pt]}),e.jsx("ul",{children:s.map(({value:l,percentage:r})=>e.jsxs("li",{children:[e.jsx(X,{children:a.values[Number(l)].en})," ",r.toFixed(2),"%"]},l))})]})}function pe({weaponsQuery:a,evidenceQuery:i,scenesQuery:s,locationsQuery:l,victimsQuery:r}){const{is:p,queryParams:d}=I(),m=b.useMemo(()=>[...Object.values(a.data),...Object.values(i.data),...Object.values(l.data),...Object.values(r.data)],[a.data,i.data,l.data,r.data]),o=t=>{if(t.type==="weapon")a.addEntryToUpdate(t.id,t);else if(t.type==="evidence")i.addEntryToUpdate(t.id,t);else throw new Error("Invalid card type")};return e.jsxs(e.Fragment,{children:[(p("display","cards")||!d.has("display"))&&e.jsx(le,{rows:m,onUpdateCard:o,weapons:Object.values(a.data),evidence:Object.values(i.data),locations:Object.values(l.data),victims:Object.values(r.data),scenes:s.data}),p("display","tags")&&e.jsx(U,{type:"info",message:"Tags table is not implemented yet",showIcon:!0,closable:!0}),p("display","scenes")&&e.jsx(ce,{sceneQuery:s,objects:m})]})}function ue({weaponsQuery:a,evidenceQuery:i,scenesQuery:s,locationsQuery:l,victimsQuery:r}){const{queryParams:p,addParam:d,addParams:m,is:o}=I();return e.jsxs(Q,{children:[e.jsxs(h,{vertical:!0,gap:12,children:[e.jsxs(h,{gap:6,children:[e.jsxs(h,{vertical:!0,gap:6,children:[e.jsx("span",{children:"Weapons"}),e.jsx(v,{isDirty:a.isDirty,onSave:a.save,isSaving:a.isSaving,dirt:JSON.stringify(a.entriesToUpdate),size:"middle"}),e.jsx(g,{data:()=>D(a.data),fileName:"crime-weapons.json",disabled:a.isDirty,hasNewData:a.hasFirestoreData,block:!0,children:"JSON"})]}),e.jsxs(h,{vertical:!0,gap:6,children:[e.jsx("span",{children:"Evidence"}),e.jsx(v,{isDirty:i.isDirty,onSave:i.save,isSaving:i.isSaving,dirt:JSON.stringify(i.entriesToUpdate),size:"middle"}),e.jsx(g,{data:()=>D(i.data),fileName:"crime-evidence.json",disabled:i.isDirty,hasNewData:i.hasFirestoreData,block:!0,children:"JSON"})]})]}),e.jsxs(h,{gap:6,children:[e.jsxs(h,{vertical:!0,gap:6,children:[e.jsx("span",{children:"Locations"}),e.jsx(v,{isDirty:a.isDirty,onSave:a.save,isSaving:a.isSaving,dirt:JSON.stringify(a.entriesToUpdate),size:"middle"}),e.jsx(g,{data:()=>D(l.data),fileName:"crime-locations.json",disabled:a.isDirty,hasNewData:a.hasFirestoreData,block:!0,children:"JSON"})]}),e.jsxs(h,{vertical:!0,gap:6,children:[e.jsx("span",{children:"Victims"}),e.jsx(v,{isDirty:a.isDirty,onSave:a.save,isSaving:a.isSaving,dirt:JSON.stringify(a.entriesToUpdate),size:"middle"}),e.jsx(g,{data:()=>D(r.data),fileName:"crime-victims.json",disabled:a.isDirty,hasNewData:a.hasFirestoreData,children:"JSON"})]})]}),e.jsx("span",{children:"Scenes"}),e.jsx(v,{isDirty:s.isDirty,onSave:s.save,isSaving:s.isSaving,dirt:JSON.stringify(s.entriesToUpdate)}),e.jsx(g,{data:()=>xe(s.data),fileName:"crime-scenes.json",disabled:s.isDirty,hasNewData:s.hasFirestoreData,block:!0})]}),e.jsx(W,{}),e.jsx(Y,{label:"Display",value:p.get("display")??"listing",onChange:t=>m({display:t,page:1},{page:1}),options:[{title:"Cards",icon:e.jsx(ee,{}),value:"cards"},{title:"Tags",icon:e.jsx(oe,{}),value:"tags"},{title:"Scenes",icon:e.jsx(ae,{}),value:"scenes"}]}),o("display","item")&&e.jsx(Z,{label:"No Groups Only",value:o("emptyOnly"),onChange:t=>d("emptyOnly",t,!1)})]})}function D(a){console.log("Preparing file for download...");const i=x.cloneDeep(a);return Object.values(i).forEach(s=>{s.likelihood||(s.likelihood={})}),$(i)}function xe(a){console.log("Preparing scenes file for download...");const i=x.cloneDeep(a);return $(i)}function la(){const a=y({tdrResourceName:"crime-weapons",firestoreDataCollectionName:"crimeWeapons",serialize:!0}),i=y({tdrResourceName:"crime-evidence",firestoreDataCollectionName:"crimeEvidence",serialize:!0}),s=y({tdrResourceName:"crime-locations",firestoreDataCollectionName:"crimeLocations",serialize:!0}),l=y({tdrResourceName:"crime-victims",firestoreDataCollectionName:"crimeVictims",serialize:!0}),r=y({tdrResourceName:"crime-scenes",firestoreDataCollectionName:"crimeScenes",serialize:!0}),p=ie("items");return b.useEffect(()=>{const d=Object.values(r.data).map(m=>({id:m.id,title:m.title.en,description:m.description.en,values:m.values.map(o=>o.en)}));x.isEmpty(d)||console.log("Slim Scenes for GPT:",d)},[r.data]),e.jsx(A,{title:"Crimes Hediondos",subtitle:"Categorizer",children:e.jsxs(P,{hasSider:!0,children:[e.jsx(K,{children:e.jsx(ue,{weaponsQuery:a,evidenceQuery:i,scenesQuery:r,locationsQuery:s,victimsQuery:l})}),e.jsx(P.Content,{className:"content",children:e.jsx(te,{isLoading:a.isLoading||i.isLoading||r.isLoading||s.isLoading||l.isLoading||p.isLoading,error:a.error||i.error||r.error||p.error||s.error||l.error,hasResponseData:!x.isEmpty(a.data)&&!x.isEmpty(i.data)&&!x.isEmpty(r.data)&&!x.isEmpty(s.data)&&!x.isEmpty(l.data)&&!x.isEmpty(p.data),children:e.jsx(pe,{weaponsQuery:a,evidenceQuery:i,scenesQuery:r,locationsQuery:s,victimsQuery:l})})})]})})}export{la as default};
