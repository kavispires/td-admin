import{r as S,a as je,j as n,aj as L,T as F,ae as Ae,B as W,b0 as ce,b1 as ye,b2 as Se,X as De,W as Ne,Y as ee,$ as se,Z as te,P as be,L as ie}from"./index-YrxXJCRo.js";import{R as Oe}from"./ResponseState-B0LGAzva.js";import{u as Ee}from"./useQueryParams-Bdhq2aAO.js";import{C as Ce,u as de}from"./useArteRuimDrawings-CJzwm2SW.js";import{I as ne}from"./ImageCard-BsKNYw2B.js";import{f as Te,W as Le,d as Q,g as $,h as ve}from"./constants-OlFzuvYk.js";import{I as q}from"./Item-DhRhcEKB.js";import{l as m}from"./lodash-DHSXaBCI.js";import{F as E}from"./index-CGTHWfcT.js";import{S as U}from"./index-CTPuhsUj.js";import{T as we}from"./index-X64WGjtd.js";import{u as _e}from"./useGetFirebaseDoc-B2OdLxyM.js";import{h as re}from"./moment-C5S46NFB.js";import{I as Re}from"./index-C7MVWxrt.js";import{F as ue}from"./Table-e_j_niQa.js";import{m as Me,r as k}from"./index-Ie4GiVIN.js";import{u as Ge}from"./daily-teoria-de-conjuntos-ChoS7ekn.js";import{u as Qe}from"./useMutation-csmyFkac.js";import{u as M,D as p,g as G,c as me,L as pe}from"./constants--Ns1lAsx.js";import{u as v}from"./useTDResource-CDxaXFWP.js";import{u as ge}from"./useDailyHistoryQuery-DbfOUAOH.js";import{R as ke}from"./SaveOutlined-CCBaQX56.js";import{a as H}from"./FilterEntries-SHPIZRcQ.js";import{S as Ue}from"./SiderContent-Cw0bn2HP.js";import{u as K}from"./useLoadWordLibrary-l4Q6DTwb.js";import{D as Pe}from"./DataLoadingWrapper-PpUqHkgV.js";import{P as qe}from"./useBaseUrl-C6NB5AVO.js";import"./index-CXekz8d8.js";import"./gapSize-U1swVQyS.js";import"./Input-C7GOHm5-.js";import"./index-BHZnLOj_.js";import"./index-BlsZn4o0.js";import"./index-C3cyCUJ1.js";import"./index-jo0E7T7E.js";import"./scrollTo-BOLcqtwO.js";import"./Pagination-Bs8rgT4I.js";import"./extendsObject-keMuGWqj.js";import"./index-C3pi46bp.js";var Be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M396 512a112 112 0 10224 0 112 112 0 10-224 0zm546.2-25.8C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM508 688c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z"}}]},name:"eye",theme:"filled"};function X(){return X=Object.assign?Object.assign.bind():function(s){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(s[o]=a[o])}return s},X.apply(this,arguments)}const Ve=(s,i)=>S.createElement(je,X({},s,{ref:i,icon:Be})),Fe=S.forwardRef(Ve);function w({children:s}){return n.jsx(U,{direction:"vertical",style:{maxWidth:120},children:s})}function _({children:s}){return n.jsxs(we,{color:"cyan",children:["#",s]})}function O({label:s,children:i}){return n.jsxs(F.Text,{children:[n.jsxs("strong",{children:[s,":"]})," ",i]})}function R({children:s}){return n.jsx(Ae,{trigger:"click",content:s,title:"Sneak Peek",children:n.jsx(W,{icon:n.jsx(Fe,{})})})}const he=[{title:"Id",dataIndex:"id",key:"id",fixed:"left"},{title:"Arte Ruim",dataIndex:"arte-ruim",key:"arte-ruim",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,cardId:a,text:o,drawings:e}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"CardId",children:a}),n.jsx(O,{label:"Drawings",children:e.length}),n.jsx(R,{children:n.jsxs(E,{gap:6,vertical:!0,children:[n.jsxs("div",{children:['"',o.split("").map((t,l)=>l<2||t===" "?t:"⏹").join(""),'"']}),n.jsx(U,{wrap:!0,children:e.map(t=>n.jsx(Ce,{drawing:t,width:75,height:75,className:"canvas"},t))})]})})]})}},{title:"Aqui O",dataIndex:"aqui-o",key:"aqui-o",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,setId:a,title:o,itemsIds:e}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"SetId",children:a}),n.jsx(O,{label:"Title",children:o.pt}),n.jsx(O,{label:"Items",children:e.length}),n.jsx(R,{children:n.jsx(E,{gap:6,wrap:!0,style:{maxWidth:500},children:e.map(t=>n.jsx(q,{id:t,width:50},t))})})]})}},{title:"Alienígena",dataIndex:"comunicacao-alienigena",key:"comunicacao-alienigena",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,itemsIds:a,attributes:o}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"Items",children:a.length}),n.jsx(R,{children:n.jsxs(E,{gap:6,style:{maxWidth:"300px"},vertical:!0,children:[n.jsx(U,{wrap:!0,children:o.map(e=>n.jsx(Te,{id:`sign-${e.spriteId}`,width:50},e.spriteId))}),n.jsx(U,{wrap:!0,children:a.map(e=>n.jsx(q,{id:e,width:50},e))})]})})]})}},{title:"Conjuntos",dataIndex:"teoria-de-conjuntos",key:"teoria-de-conjuntos",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,rule1:a,intersectingThing:o,rule2:e,title:t,things:l}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"Title",children:t}),n.jsx(R,{children:n.jsxs(E,{vertical:!0,gap:6,children:[n.jsxs(E,{gap:6,children:[n.jsx(q,{id:a.thing.id,width:50}),n.jsx(q,{id:o.id,width:50}),n.jsx(q,{id:e.thing.id,width:50})]}),n.jsx(E,{gap:6,children:l.map(c=>n.jsx(q,{id:c.id,width:35},c.id))})]})})]})}},{title:"Estoque",dataIndex:"controle-de-estoque",key:"controle-de-estoque",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,title:a,goods:o}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"Title",children:a}),n.jsx(O,{label:"Goods",children:o.length}),n.jsx(R,{children:n.jsx(E,{gap:6,wrap:!0,style:{maxWidth:245},children:o.map(e=>n.jsx(Le,{id:e,width:50},e))})})]})}},{title:"Filmaço",dataIndex:"filmaco",key:"filmaco",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,setId:a,title:o,year:e}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"SetId",children:a}),n.jsx(R,{children:n.jsxs(E,{gap:6,vertical:!0,children:[n.jsxs("span",{children:["Year: ",e]}),n.jsxs("span",{children:["Title:"," ",o.split("").map((t,l)=>l<1||t===" "?t:"⏹").join("")]})]})})]})}},{title:"Palavreado",dataIndex:"palavreado",key:"palavreado",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,letters:a,keyword:o,words:e}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"Letters",children:a.length}),n.jsx(O,{label:"Keyword",children:o}),n.jsx(R,{children:n.jsx(U,{direction:"vertical",children:e.map((t,l)=>n.jsx("span",{children:t.split("").map((c,r)=>r===l||c===" "?c:"⏹").join("")},`${i}-${t}`))})})]})}},{title:"Portais",dataIndex:"portais-magicos",key:"portais-magicos",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,setId:a,corridors:o}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"SetId",children:m.truncate(a,{length:9})}),n.jsx(R,{children:n.jsx(E,{gap:6,vertical:!0,children:o.map(e=>n.jsxs(E,{gap:6,vertical:!0,children:[n.jsxs("span",{children:["Passcode: ",e.passcode]}),n.jsx(E,{children:e.imagesIds.map(t=>n.jsx(ne,{id:t,width:50},t))})]},e.passcode))})})]})}},{title:"Quartetos",dataIndex:"quartetos",key:"quartetos",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,setId:a,sets:o}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"SetId",children:m.truncate(a,{length:9})}),n.jsx(R,{children:n.jsx(E,{gap:6,children:o.map(e=>n.jsx(E,{gap:6,vertical:!0,children:e.itemsIds.map(t=>n.jsx(q,{id:t,width:50},t))},e.id))})})]})}},{title:"Picaço",dataIndex:"artista",key:"artista",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,cards:a}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"Cards",children:a.length}),n.jsx(R,{children:n.jsx(E,{gap:6,vertical:!0,style:{maxHeight:500,overflowY:"auto"},children:a.map((o,e)=>n.jsx("span",{children:o.text},`${o.id}-${e}`))})})]})}},{title:"Tá Na Cara",dataIndex:"ta-na-cara",key:"ta-na-cara",render:s=>{if(!s)return n.jsx(L,{message:"No entry",type:"error"});const{number:i,suspectsIds:a,testimonies:o}=s;return n.jsxs(w,{children:[n.jsx(_,{children:i}),n.jsx(O,{label:"Suspects",children:a==null?void 0:a.length}),n.jsx(O,{label:"Questions",children:o.length}),n.jsx(R,{children:n.jsxs(E,{vertical:!0,children:[n.jsx(U,{direction:"vertical",style:{maxHeight:100,overflowY:"auto"},children:o.map(e=>n.jsx("span",{children:e.question},e.testimonyId))}),n.jsx(U,{wrap:!0,style:{maxHeight:200,maxWidth:"500px",overflowY:"auto"},children:a==null?void 0:a.map(e=>n.jsx(ne,{id:e,width:48},e))})]})})]})}}];function We(){const[s,i]=S.useState(""),[a,o]=S.useState(!1),{isLoading:e,data:t}=_e("diario",s,{enabled:!!s&&a}),l=S.useMemo(()=>t?[t]:[],[t]),c=d=>{o(!1),i(d.trim())},r=()=>{console.log(s,re(s,"YYYY-MM-DD",!0).isValid()),o(re(s,"YYYY-MM-DD",!0).isValid())};return console.log(t),n.jsxs("div",{children:[n.jsx(F.Title,{level:2,children:"Data Verification"}),n.jsx(ce,{to:"/game/daily-setup",children:"Go to Setup"}),n.jsxs(E,{justify:"space-between",align:"center",className:"mb-2",children:[n.jsxs(U.Compact,{children:[n.jsx(Re,{placeholder:"YYYY-MM-DD",onChange:d=>c(d.target.value)}),n.jsx(W,{type:"primary",onClick:r,children:"Load"})]}),s," ",a?"Valid":"Invalid",n.jsx(W,{disabled:!0,type:"primary",size:"large",children:"Save"})]}),n.jsx(ue,{loading:e,columns:he,dataSource:l,scroll:{x:"max-content"}})]})}const J=new Se({}),z=(s,i)=>{J.setState(a=>({...a,[s]:i}))},Je=()=>{J.setState(()=>({}))},$e=()=>ye(J,()=>J.state),Ye=(s,i,a,o)=>{const[e]=M(p.AQUI_O,o),t=v("items",s),l=v("daily-disc-sets",s);return{entries:S.useMemo(()=>!s||!l.isSuccess||!e||!t.isSuccess?{}:Ze(a,e,l.data,t.data),[s,l,t,e,a]),isLoading:t.isLoading||l.isLoading}},Ze=(s,i,a,o)=>{console.count("Creating Aqui Ó...");const e=m.shuffle(Object.values(a).filter(d=>d.itemsIds.filter(Boolean).length>=20)),t=e.filter(d=>!i.used.includes(d.id));t.length<s&&(console.log("🔆 Not enough aqui-o sets left, shuffling..."),z("aqui-o","Not enough aqui-o sets left"),t.push(...m.shuffle(e)));const l=Object.values(o).filter(d=>d!=null&&d.nsfw?!1:m.intersection(d.decks??[],["alien","dream","thing"]).length>0);let c=i.latestDate;const r={};for(let d=0;d<s;d++){const g=t[d];g||console.error("No aqui-o sets left");const u=G(c),I=me(u);c=u,I?r[u]={id:u,type:"aqui-o",number:i.latestNumber+d+1,setId:"special",title:{pt:"Especial Fim de Semana",en:"Weekend Special"},itemsIds:["0",...m.sampleSize(l,45).map(x=>x.id)]}:r[u]={id:u,type:"aqui-o",number:i.latestNumber+d+1,setId:g.id,title:g.title,itemsIds:["0",...m.sampleSize(g.itemsIds,20)]}}return r},He=(s,i,a,o)=>{const[e]=M(p.ARTE_RUIM,o),t=de(s,i);return{entries:S.useMemo(()=>!s||t.isLoading||!e?[]:Ke(a,e,t,i),[s,t,i,e,a,t.isLoading]),isLoading:t.isLoading}},Ke=(s,i,a,o)=>{console.count("Creating Arte Ruim...");const e=Object.values(a.drawings).filter(r=>!(i.used.includes(r.id)||r.drawings.length<3)).map(r=>({id:r.id,type:"arte-ruim",language:o??"pt",cardId:r.id,text:r.text,drawings:r.drawings.map(d=>d.drawing),number:0,dataIds:r.drawings.map(d=>d.id)})),t=m.sampleSize(m.shuffle(e),s);let l=i.latestDate;return t.map((r,d)=>{const g=G(l);return l=g,{...r,id:g,number:i.latestNumber+d+1}})},Xe=(s,i,a,o,e)=>{const[t]=M(p.ARTISTA,o),[l]=M(p.ARTE_RUIM,o),c=v(`arte-ruim-cards-${i}`,s),r=de(s,i);return{entries:S.useMemo(()=>{if(!s||!c.isSuccess||r.isLoading||!t)return{};const g=e.map(u=>u.cardId);return ze(a,t,l,c.data,g,r.drawings)},[s,c,l,t,a,e,r.drawings,r.isLoading]),isLoading:c.isLoading||r.isLoading}},ze=(s,i,a,o,e,t)=>{console.count("Creating Artista...");let l=i.latestDate;const c={};for(let r=0;r<s;r++){const d=G(l),g=Object.keys(o??{}).filter(I=>{var x,A;return!a.used.includes(I)&&!e.includes(I)&&((A=(x=t==null?void 0:t[I])==null?void 0:x.drawings)==null?void 0:A.length)<3}),u=m.sampleSize(g,20).map(I=>o[I]);l=d,c[d]={id:d,type:"artista",number:i.latestNumber+r+1,cards:u}}return c},es=(s,i,a,o)=>{const[e]=M(p.COMUNICACAO_ALIENIGENA,o),t=v("items",s),l=v("items-attributes",s),c=v("items-attribute-values",s);return{entries:S.useMemo(()=>!s||!e||!l.isSuccess||!c.isSuccess||!t.isSuccess?{}:ss(a,e,l.data,c.data,t.data),[s,a,e,e,l,c,t]),isLoading:t.isLoading||l.isLoading||c.isLoading}},ss=(s,i,a,o,e)=>{console.count("Creating Comunicacao Alienigena...");let t=i.latestDate;const l=m.values(a),c=m.values(o).filter(u=>{var I;return u.complete&&((I=e==null?void 0:e[u.id])==null?void 0:I.nsfw)!==!0}),r={};let d=0;for(;m.keys(r).length<s&&d<100;){const u=ts(l,c);if(u.valid&&!r[u.setId]&&!i.used.includes(u.setId)&&(r[u.setId]=u),m.keys(r).length>=s)break;d+=1}console.log(`🔆 Generating this batch took ${d} tries`),d>=100&&z("comunicacao-alienigena","Not enough valid comunicacao alienigena games (over 100 attempts)");const g={};return Object.values(r).forEach((u,I)=>{const x=G(t);t=x,g[x]={...u,id:x,number:i.latestNumber+I+1}}),g},ts=(s,i)=>{const a=m.shuffle(i),o=m.shuffle(Me(50,0)),e=m.sampleSize(s,3).map(h=>({...h,spriteId:`${o.pop()}`})),t=[],l=[],c=[],r=[],d=[],g=[],u=[],I=[];a.forEach(h=>{const P=[Q.DETERMINISTIC,Q.RELATED],j=h.attributes[e[0].id]===Q.DETERMINISTIC,C=P.includes(h.attributes[e[0].id]),T=h.attributes[e[0].id]===Q.UNRELATED,Ie=h.attributes[e[1].id]===Q.DETERMINISTIC,Y=P.includes(h.attributes[e[1].id]),B=h.attributes[e[1].id]===Q.UNRELATED,xe=h.attributes[e[2].id]===Q.DETERMINISTIC,Z=P.includes(h.attributes[e[2].id]),V=h.attributes[e[2].id]===Q.UNRELATED;if(T&&B&&V)return I.push(h.id);j&&B&&V&&t.push(h.id),T&&Ie&&V&&l.push(h.id),T&&B&&xe&&c.push(h.id),C&&Y&&V&&r.push(h.id),C&&B&&Z&&d.push(h.id),T&&Y&&Z&&g.push(h.id),C&&Y&&Z&&u.push(h.id)});const x=e.map(h=>({id:h.id,name:h.name.pt,description:h.description.pt,spriteId:h.spriteId,itemsIds:[]}));x[0].itemsIds=m.sampleSize(t,t.length>3?3:Math.max(t.length-1,1)),x[1].itemsIds=m.sampleSize(l,l.length>3?3:Math.max(t.length-1,1)),x[2].itemsIds=m.sampleSize(c,c.length>3?3:Math.max(t.length-1,1));const A=[];x.forEach(h=>{A.push(...h.itemsIds)});const N=[];r.length>0&&N.push({spritesIds:[e[0].spriteId,e[1].spriteId],itemId:m.sample(r)??""}),d.length>0&&N.push({spritesIds:[e[0].spriteId,e[2].spriteId],itemId:m.sample(d)??""}),g.length>0&&N.push({spritesIds:[e[1].spriteId,e[2].spriteId],itemId:m.sample(g)??""}),u.length>0&&N.push({spritesIds:e.map(h=>h.spriteId),itemId:m.sample(u)??""});const D=[];t.length>0&&D.push({spritesIds:[e[0].spriteId],itemId:t.filter(h=>!A.includes(h))[0]}),l.length>0&&D.push({spritesIds:[e[1].spriteId],itemId:l.filter(h=>!A.includes(h))[0]}),c.length>0&&D.push({spritesIds:[e[2].spriteId],itemId:c.filter(h=>!A.includes(h))[0]});let b=m.sampleSize(N,4);b.length<3&&b.push(...m.sampleSize(D,4-b.length)),b.length<4&&console.log("🔆 Not enough requests for an alien communication, marking it as invalid"),b=m.shuffle(b);const y=b.map(h=>h.itemId),f={id:"0000-00-00",setId:x.map(h=>h.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:x,requests:b,solution:y.join("-"),itemsIds:m.shuffle([...y,...m.sampleSize([I[0],I[1],I[2],I[3]],m.random(1,3))]).filter(Boolean),valid:!1};return f.valid=[f.attributes.length===3,f.requests.length===4,f.itemsIds.length>4,f.attributes.every(h=>h.itemsIds.length>0),f.requests.every(h=>h.itemId)].every(Boolean),f},is=(s,i,a,o)=>{const[e]=M(p.CONTROLE_DE_ESTOQUE,o);return{entries:S.useMemo(()=>!s||!e?{}:ns(a,e),[s,a,e]),isLoading:!1}},ns=(s,i)=>{console.count("Creating Controle de Estoque...");let a=i.latestDate;const o={};for(let e=0;e<s;e++){const t=G(a);a=t,o[t]=cs(t,i.latestNumber+e+1)}return o},rs=256,as=16,os=4,ls=1,cs=(s,i)=>{const[a,o,e]=s.split("-").map(Number),l=new Date(a,o-1,e).getDay(),c=["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"][l],r={id:s,number:i,type:"controle-de-estoque",language:"pt",title:c,goods:[],orders:[]},d=m.sampleSize(Array(rs).fill("").map((u,I)=>`good-${I+1}`),as+ls),g=d.pop();if(r.goods=d,r.orders=m.sampleSize(r.goods,os),!g)throw new Error("No out of stock good");return r.orders.push(g),r.orders=m.shuffle(r.orders),r},ds=(s,i,a,o)=>{const[e]=M(p.FILMACO,o),t=v("daily-movie-sets",s);return{entries:S.useMemo(()=>!s||!t.isSuccess||!e?{}:(Object.values(t.data).filter(r=>r.itemsIds.length>0&&!e.used.includes(r.id)).length<=a&&z("filmaco","Not enough unused films"),us(a,e,t.data)),[s,t,e,a]),isLoading:t.isLoading}},us=(s,i,a)=>{console.count("Creating Filmaço...");const o=m.shuffle(Object.values(a).filter(c=>c.itemsIds.filter(Boolean).length>0)),e=o.filter(c=>!i.used.includes(c.id));e.length<s&&e.push(...m.shuffle(o));let t=i.latestDate;const l={};for(let c=0;c<s;c++){const r=e[c];if(!r){console.error("No filmaço sets left");break}const d=G(t);t=d,l[d]={id:d,type:"filmaco",number:i.latestNumber+c+1,setId:r.id,title:r.title,itemsIds:r.itemsIds,year:r.year}}return l},ms=(s,i,a,o)=>{const[e]=M(p.PALAVREADO,o),t=K(4,i,s),l=K(5,i,s);return{entries:S.useMemo(()=>!s||!t.data||!t.data.length||!l.data||!l.data.length||!e?{}:ps(a,e,t.data,l.data),[s,t,l,e,a]),isLoading:t.isLoading||l.isLoading}},ps=(s,i,a,o)=>{console.count("Creating Palavreado...");let e=i.latestDate;const t=[],l={};for(let c=0;c<s;c++){const r=G(e),d=me(r),g=d?5:4;e=r,l[r]={id:r,type:"palavreado",number:i.latestNumber+c+1,...gs(d?o:a,[...Object.values(l).map(u=>u.keyword),...i.used],t,g)}}return l},gs=(s,i,a,o=4,e)=>{let t=m.shuffle(m.difference(s,a,i));const l=e||(t.pop()??""),c=[];for(let r=0;r<o;r++){const d=hs(s,l,c,r);c.push(d)}return a.push(l,...c),{keyword:l,words:c,letters:fs(c,l.length)}},hs=(s,i,a,o)=>{const e=m.uniq([...m.flatMap(a.map(c=>c.split(""))),...i.split("")]),t=m.shuffle(s.filter(c=>c[o]===i[o]&&!a.includes(c)));return m.sortBy(t,c=>m.intersection(c.split(""),e).length)[0]},fs=(s,i)=>{const a=m.flatMap(s.map(l=>l.split(""))),o=i===4?[0,5,10,15]:[0,6,12,18,24],e=m.shuffle(a.filter((l,c)=>!o.includes(c))),t=[];for(let l=0;l<a.length;l++)o.includes(l)?t.push(a[l]):t.push(e.shift()??"");return t},Is=(s,i,a,o)=>{const[e]=M(p.PORTAIS_MAGICOS,o),t=v("daily-passcode-sets",s),l=K(3,i,s);return{entries:S.useMemo(()=>{if(!s||!t.isSuccess||!l.isSuccess||!e)return{};const r=l.data.reduce((d,g)=>(g.split("").forEach(u=>{d[u]||(d[u]=[]),d[u].push(g)}),d),{" ":["  "],"-":[" - "]});return xs(a,e,t.data,r)},[s,a,t.isSuccess,t.data,l.isSuccess,l.data,e]),isLoading:t.isLoading||l.isLoading}},xs=(s,i,a,o)=>{console.count("Creating Portais Mágicos...");let e=i.latestDate;const t=i.used,l={};let c=m.shuffle(Object.values(a).filter(d=>d.imageCardsIds.length>0));const r={};for(let d=0;d<s;d++){const g=G(e),u=[];let I=[...c];const x=[];for(;x.length<3;){const A=I.pop();if(!A)throw new Error("Not enough sets available");const N=m.sample(A.passcode.filter(f=>f.length<=12&&!t.includes(f)))||"";if(!N)continue;const D=x.length+1;u.push(A.id),l[A.id]=!0;const b=N.split("").map(f=>m.sample(o[f])||` ${f} `),y=m.sampleSize(A.imageCardsIds,D);x.push({passcode:N,imagesIds:y,words:b}),I=I.filter(f=>!l[f.id]&&f.imageCardsIds.length>D)}e=g,r[g]={id:g,type:"portais-magicos",setId:u.join($),number:i.latestNumber+d+1,corridors:x.reverse()},c=c.filter(A=>!l[A.id])}return r},js=(s,i,a,o)=>{const[e]=M(p.QUARTETOS,o),t=v("daily-quartet-sets",s),l=v("items-groups",s);return{entries:S.useMemo(()=>!s||t.isLoading||l.isLoading||!e?{}:As(a,e,i,t.data,l.data),[s,i,e,a,t,l]),isLoading:t.isLoading||l.isLoading}},As=(s,i,a,o,e)=>{console.count("Creating Quartetos...");let t=Object.values(o).filter(r=>r.itemsIds.length>=4&&!i.used.includes(r.id)&&!r.flagged),l=i.latestDate;const c={};return Array.from({length:s}).forEach((r,d)=>{const g=[],u={};let I=m.cloneDeep(t),x=0;for(;g.length<3&&x<500;){const j=m.sample(I);if(!j)throw Error("No potential set found for Quartetos game");I=I.filter(T=>T.id!==j.id);const C=m.orderBy(m.sampleSize(j.itemsIds,4),T=>Number(T));if(C.some(T=>u[T])){x++;continue}j.itemsIds.forEach(T=>{u[T]=!0}),g.push({id:j.id,title:j.title,itemsIds:C,level:j.level??1}),x=0}const A=g.map(j=>j.id);t=t.filter(j=>!A.includes(j.id));const N=Object.values(e).filter(j=>j.itemsIds.some(C=>!u[C])&&j.itemsIds.length>=4&&j.nsfw!==!0),D=m.sample(N);if(!D)throw Error("No eligible group found for Quartetos game");g.push({id:D.id,title:m.capitalize(D.name[a]),itemsIds:m.sampleSize(D.itemsIds,4),level:1});const b=Math.ceil(g.reduce((j,C)=>j+C.level,0)/g.length),y=m.orderBy(g,["level"],["desc"]).map((j,C)=>(j.level=C,j)),f=g.map(j=>j.id).join($),h=m.shuffle(g.flatMap(j=>j.itemsIds)),P=G(l);l=P,c[P]={id:P,number:i.latestNumber+d+1,setId:f,type:"quartetos",grid:h,difficulty:b,sets:y}}),c},ys=(s,i)=>k([...s,...i.flatMap(a=>a.sets.map(o=>o.id))]),Ss=(s,i,a,o)=>{const[e]=M(p.TA_NA_CARA,o),t=v("suspects",s),l=v(`testimony-questions-${i}`,s);return{entries:S.useMemo(()=>!s||!t.isSuccess||!l.isSuccess||!e?{}:Ds(a,e,t.data,l.data),[s,t,l,e,a]),isLoading:t.isLoading||l.isLoading}},ae=15,oe=13,Ds=(s,i,a,o)=>{console.count("Creating Tá Na Cara...");const e=fe(i.used),t=m.orderBy(m.shuffle(Object.values(a)),[d=>(e==null?void 0:e[d.id])??0],["asc"]).slice(0,oe*4).map(d=>{const[,g]=d.id.split("-");return{id:`us-gb-${g}`,used:0}}),l=m.orderBy(m.shuffle(Object.values(o)),[d=>e==null?void 0:e[d.id]],["asc"]).slice(0,ae*4).map(d=>({testimony:d,used:0}));let c=i.latestDate;const r={};for(let d=0;d<s;d++){const g=le(l,ae).map(I=>({testimonyId:I.testimony.id,question:I.testimony.question,nsfw:!!I.testimony.nsfw})),u=G(c);c=u,r[u]={id:u,type:"ta-na-cara",number:i.latestNumber+d+1,suspectsIds:le(t,oe).map(I=>I.id),testimonies:g}}return r},le=(s,i)=>{const o=m.orderBy(s,[e=>e.used],["asc"]).slice(0,i);return o.forEach(e=>{e.used+=1}),o},fe=s=>s.reduce((i,a)=>{const o=a.split($),e=o[0],t=Number(o[1]);if(e.startsWith("us")){const l=e.split("-"),c=`${l[0]}-${l[2]}`;return i[c]=t||0,i}return i[e]=t||0,i},{}),Ns=(s,i)=>{const a=fe(s);return i.forEach(o=>{var e;o.testimonies.forEach(t=>{a[t.testimonyId]===void 0&&(a[t.testimonyId]=0),a[t.testimonyId]+=1}),(e=o.suspectsIds)==null||e.forEach(t=>{a[t]===void 0&&(a[t]=0),a[t]+=1})}),Object.entries(a).map(([o,e])=>`${o}${$}${e}`)};function bs(s,i,a){const o=pe.DAILY[i??"pt"],e=ge(o,{enabled:s});S.useEffect(()=>{Je()},[a,i]);const t=s&&e.isSuccess,l=Ye(t,i,a,e.data??{}),c=He(t,i,a,e.data??{}),r=es(t,i,a,e.data??{}),d=is(t,i,a,e.data??{}),g=ds(t,i,a,e.data??{}),u=ms(t,i,a,e.data??{}),I=js(t,i,a,e.data??{}),x=Ge(t,i,a,e.data??{}),A=Is(t,i,a,e.data??{}),N=Xe(t,i,a,e.data??{},c.entries),D=Ss(t,i,a,e.data??{}),b=S.useMemo(()=>c.entries.length===0?[]:(console.count("Bundling entries..."),c.entries.map(y=>({id:y.id,"arte-ruim":y,"aqui-o":l.entries[y.id],"comunicacao-alienigena":r.entries[y.id],"controle-de-estoque":d.entries[y.id],filmaco:g.entries[y.id],palavreado:u.entries[y.id],"portais-magicos":A.entries[y.id],quartetos:I.entries[y.id],"teoria-de-conjuntos":x.entries[y.id],artista:N.entries[y.id],"ta-na-cara":D.entries[y.id]}))),[c.entries,l.entries,g.entries,r.entries,d.entries,u.entries,A.entries,I.entries,x.entries,N.entries,D.entries]);return{isLoading:e.isLoading||l.isLoading||c.isLoading||r.isLoading||d.isLoading||g.isLoading||u.isLoading||A.isLoading||I.isLoading||x.isLoading||N.isLoading||D.isLoading,entries:b}}function Os(s){const{notification:i}=De.useApp(),a=Ne(),o=pe.DAILY[s??"pt"],[e,t]=S.useState(!1),l=ge(o,{enabled:!!o}),c=Qe({mutationFn:async r=>{var x,A,N,D,b,y;const d=r.map(f=>{const h=ee(se,`${o}/${f.id}`);return te(h,f)}),g=ee(se,`${o}/history`),u=l.data;if(!u)throw new Error("No previous history");const I={...u,[p.ARTE_RUIM]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.ARTE_RUIM].number,used:JSON.stringify(k([...JSON.parse(u[p.ARTE_RUIM].used),...r.map(f=>f[p.ARTE_RUIM].cardId)]))},[p.AQUI_O]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.AQUI_O].number,used:JSON.stringify(k([...JSON.parse(u[p.AQUI_O].used??"[]"),...r.map(f=>f[p.AQUI_O].setId)]))},[p.PALAVREADO]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.PALAVREADO].number,used:JSON.stringify(k([...JSON.parse(u.palavreado.used),...r.map(f=>f[p.PALAVREADO].keyword)]))},[p.ARTISTA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.ARTISTA].number,used:"[]"},[p.FILMACO]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.FILMACO].number,used:JSON.stringify(k([...JSON.parse(((x=u==null?void 0:u[p.FILMACO])==null?void 0:x.used)??"[]"),...r.map(f=>f[p.FILMACO].setId)]))},[p.CONTROLE_DE_ESTOQUE]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.CONTROLE_DE_ESTOQUE].number,used:"[]"},[p.TEORIA_DE_CONJUNTOS]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.TEORIA_DE_CONJUNTOS].number,used:JSON.stringify(k([...JSON.parse(((A=u==null?void 0:u[p.TEORIA_DE_CONJUNTOS])==null?void 0:A.used)??"[]"),...r.map(f=>f[p.TEORIA_DE_CONJUNTOS].setId),...r.map(f=>f[p.TEORIA_DE_CONJUNTOS].intersectingThing.id)]))},[p.COMUNICACAO_ALIENIGENA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.COMUNICACAO_ALIENIGENA].number,used:JSON.stringify(k([...JSON.parse(((N=u==null?void 0:u[p.COMUNICACAO_ALIENIGENA])==null?void 0:N.used)??"[]"),...r.map(f=>f[p.COMUNICACAO_ALIENIGENA].setId)]))},[p.QUARTETOS]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.QUARTETOS].number,used:JSON.stringify(ys(JSON.parse(((D=u==null?void 0:u[p.QUARTETOS])==null?void 0:D.used)??"[]"),r.map(f=>f[p.QUARTETOS])))},[p.TA_NA_CARA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.TA_NA_CARA].number,used:JSON.stringify(Ns(JSON.parse(((b=u==null?void 0:u[p.TA_NA_CARA])==null?void 0:b.used)??"[]"),r.map(f=>f[p.TA_NA_CARA])))},[p.PORTAIS_MAGICOS]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.PORTAIS_MAGICOS].number,used:JSON.stringify(k([...JSON.parse(((y=u==null?void 0:u[p.PORTAIS_MAGICOS])==null?void 0:y.used)??"[]"),...r.map(f=>f[p.PORTAIS_MAGICOS].corridors.map(h=>h.passcode))].flat()))}};return te(g,I),Promise.all(d)},onSuccess:()=>{i.info({message:"Data saved",placement:"bottomLeft"}),a.invalidateQueries({queryKey:[o,"history"]}),t(!1)},onError:()=>{i.error({message:"Error saving data",placement:"bottomLeft"})}});return{isDirty:e,setIsDirty:t,save:c.mutateAsync,isPending:c.isPending}}function Es({language:s,dataLoad:i}){const a=s,{is:o}=Ee(),e=$e();console.log(e);const{save:t,isPending:l}=Os(a??"pt");return o("dataCheck")?n.jsx(We,{}):n.jsxs("div",{children:[n.jsx(F.Title,{level:2,children:"Data Population"}),i.isLoading&&n.jsx("div",{children:"Loading..."}),n.jsxs(E,{justify:"space-between",align:"center",children:[n.jsxs("span",{children:[n.jsx(ce,{to:"/game/daily-setup?dataCheck=true",children:"Go to Check"}),n.jsxs(F.Title,{level:4,children:["Total: ",i.entries.length]})]}),n.jsx(W,{onClick:()=>t(i.entries),loading:l,disabled:(i.entries??[]).length===0,type:"primary",size:"large",icon:n.jsx(ke,{}),children:"Save"})]}),Object.values(e).map(c=>n.jsx(L,{message:c,type:"warning",showIcon:!0,banner:!0},c)),n.jsx(ue,{columns:he,dataSource:i.entries??[],scroll:{x:"max-content"}})]})}function Cs({language:s,setLanguage:i,drawingsCount:a,setDrawingsCount:o,batchSize:e,setBatchSize:t}){return n.jsxs(Ue,{children:[n.jsx(H,{label:"Language",value:s,onChange:i,options:[ve],placeholder:"Select a language"}),n.jsx(H,{label:"Minimum Drawings",value:a,onChange:o,options:[2,3,4],placeholder:"Select a number"}),n.jsx(H,{label:"Batch Size",value:e,onChange:t,options:[3,7,14,21,28],placeholder:"Select a number"})]})}function pt(){const[s,i]=S.useState(""),[a,o]=S.useState(3),[e,t]=S.useState(7),l=bs(!!s,s,e);return n.jsx(be,{title:"Daily Setup",children:n.jsxs(ie,{hasSider:!0,children:[n.jsxs(qe,{children:[n.jsx(Oe,{isLoading:l.isLoading,error:null,hasResponseData:!l.isLoading}),n.jsx(Cs,{language:s,setLanguage:i,drawingsCount:a,setDrawingsCount:o,batchSize:e,setBatchSize:t})]}),n.jsx(ie.Content,{className:"content",children:n.jsx(Pe,{isLoading:l.isLoading,error:null,hasResponseData:!l.isLoading,children:n.jsx(Es,{language:s,dataLoad:l})})})]})},e)}export{pt as default};
