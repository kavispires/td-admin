import{r as v,a as _,_ as Y,j as e,T,B as I,ao as be,aj as ye,G as F,D as le,an as we,P as ve,L as ee}from"./index-BvgJVW7d.js";import{D as Se}from"./DataLoadingWrapper-DbxLta2F.js";import{l as S,c as ue,P as ke}from"./useBaseUrl-D1KQyl61.js";import{u as D}from"./useQueryParams-C0m2l_EQ.js";import{R as Oe,c as Ce,u as Ee}from"./useTestimoniesResource-BBOiX261.js";import{u as Te,D as Ie,a as Me,g as Ne}from"./constants-DkI4H2ZF.js";import{u as H}from"./useTDResource-BN7Ah5z6.js";import{I as z}from"./ImageCard-DSPg33KU.js";import{g as G}from"./utils-BxSvbnVR.js";import{F as O}from"./index-DTdaIeah.js";import{T as de,S as De,F as Re}from"./FilterEntries-DAehkN6x.js";import{B as te,D as Pe}from"./DownloadButton-CxSuRluW.js";import{S as B}from"./index-X4WmpXU9.js";import{u as he}from"./useTableExpandableRows-VDr0sqqp.js";import{u as me}from"./useTablePagination-DdFqgpVA.js";import{P as se}from"./progress-K6Gi6vG1.js";import{S as $}from"./index-Cbfw24BI.js";import{F as X}from"./Table-CDT_TX_Z.js";import{I as Ae}from"./index-M0CbH9Pw.js";import{u as Fe}from"./useCardWidth-CIKZGWiN.js";import{C as fe}from"./index-B25zXE0m.js";import{P as ne}from"./index-vz66gXKz.js";import{R as Be}from"./FireFilled-BODGem4j.js";import{S as q}from"./SiderContent-46R1r0GQ.js";import{F as re}from"./FirestoreConsoleLink-CavUHU2w.js";import{S as $e}from"./SaveButton-xpBBkUoN.js";import{g as ze}from"./useGetFirestoreDoc-D4mW-Dvh.js";import{e as Le,a as He,d as qe}from"./index-BOEwK3Jx.js";import{u as pe}from"./useWindowSize-9HNk3Brl.js";import{M as ge}from"./index-v51NMMtw.js";import{R as Ue}from"./TableOutlined-DyhKbS8m.js";import"./useResourceFirestoreData-_KlcHWEV.js";import"./useUpdateFirestoreDoc-CJzmwTHX.js";import"./useMutation-CU6V_BvD.js";import"./moment-C5S46NFB.js";import"./gapSize-U1swVQyS.js";import"./index-5gGgnGWi.js";import"./index-VhfxMJYB.js";import"./index-D3tyqM8J.js";import"./index-CF-_ss-M.js";import"./scrollTo-D1OyGVJw.js";import"./Pagination-zda6Desw.js";import"./extendsObject-keMuGWqj.js";import"./Input-DDQRQFh-.js";import"./SaveOutlined-Bh36DPhn.js";import"./constants-D9Dpf4ur.js";import"./Item-CClapcG9.js";var Ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M594.3 601.5a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1 8 8 0 008 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"}}]},name:"contacts",theme:"outlined"},Ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 328a60 60 0 10120 0 60 60 0 10-120 0zM852 64H172c-17.7 0-32 14.3-32 32v660c0 17.7 14.3 32 32 32h680c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-32 660H204V128h616v596zM604 328a60 60 0 10120 0 60 60 0 10-120 0zm250.2 556H169.8c-16.5 0-29.8 14.3-29.8 32v36c0 4.4 3.3 8 7.4 8h729.1c4.1 0 7.4-3.6 7.4-8v-36c.1-17.7-13.2-32-29.7-32zM664 508H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"robot",theme:"outlined"},Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.6 630.2 359 721.8 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.8 758.4 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM248 439.6c-37.1-11.9-64-46.7-64-87.6V232h64v207.6zM840 352c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"filled"};function We(){var s=v.useRef(!0);return s.current?(s.current=!1,!0):s.current}function _e(s,t){return typeof s=="function"?s.length?s(t):s():s}function xe(s,t,c){if(t===void 0&&(t=10),t<1)throw new Error("Capacity has to be greater than 1, got '"+t+"'");var l=We(),u=v.useState(s),m=u[0],d=u[1],i=v.useRef([]),n=v.useRef(0);l&&(i.current.length?(i.current[i.current.length-1]!==s&&i.current.push(s),i.current.length>t&&(i.current=i.current.slice(i.current.length-t))):i.current.push(s),n.current=i.current.length&&i.current.length-1);var g=v.useCallback(function(r){d(function(a){return r=_e(r,a),r!==a&&(n.current<i.current.length-1&&(i.current=i.current.slice(0,n.current+1)),n.current=i.current.push(r)-1,i.current.length>t&&(i.current=i.current.slice(i.current.length-t))),r})},[m,t]),h=v.useMemo(function(){return{history:i.current,position:n.current,capacity:t,back:function(r){r===void 0&&(r=1),n.current&&d(function(){return n.current-=Math.min(r,n.current),i.current[n.current]})},forward:function(r){r===void 0&&(r=1),n.current!==i.current.length-1&&d(function(){return n.current=Math.min(n.current+r,i.current.length-1),i.current[n.current]})},go:function(r){r!==n.current&&d(function(){return n.current=r<0?Math.max(i.current.length+r,0):Math.min(i.current.length-1,r),i.current[n.current]})}}},[m]);return[m,g,h]}var Ye=function(t,c){return v.createElement(_,Y({},t,{ref:c,icon:Ge}))},Xe=v.forwardRef(Ye),Je=function(t,c){return v.createElement(_,Y({},t,{ref:c,icon:Ve}))},Ke=v.forwardRef(Je),Ze=function(t,c){return v.createElement(_,Y({},t,{ref:c,icon:Qe}))},oe=v.forwardRef(Ze);const J=(s,t,c)=>{const{reliabilityThreshold:l=4,projectionThreshold:u=55}={},d=`us-gb-${s.split("-")[1]}`,i=S.isEmpty(t[s])?[]:t[s];let n=0,g=0;i.forEach(E=>{E===3&&(n+=3),E===-3&&(g+=3),E===4&&(n+=4),E===-4&&(g+=4)});const h=i.filter(E=>![-4,-3,3,4].includes(E)),r=h.length+n+g,a=Math.max(r,5),f=i.filter(E=>E===1).length+n,y=Math.round(f/a*100),x=i.filter(E=>E===0).length+g,p=Math.round(x/a*100),j=Math.round((a-f-x)/a*100),w=h.length+n+g>=5,k=r>3,C=r>l,N=C&&Math.abs(y-p)>30?y>p?"üëç":"üëé":null,R=!k||Math.abs(y-p)<20?null:y>=u?"üëç":p>=u?"üëé":null;return{suspectCardId:s,imageId:d,enoughData:k,reliable:C,total:a,yesCount:f,yesPercentage:y,noCount:x,noPercentage:p,blankPercentage:j,complete:w,values:i,resolution:N,projection:R}};function et(s){const t=s.filter(u=>![0,1].includes(u)),c=s.filter(u=>[0,1].includes(u)),l={0:0,1:0};return c.forEach(u=>{if(l[u]===void 0)throw Error(`what is this value? ${u}`);l[u]+=1}),Object.entries(l).forEach(([u,m])=>{if(m>0){const d=Math.floor(m/4),i=m%4;for(let n=0;n<d;n++)t.push(u==="0"?-4:4);if(i>0){const n=Array.from({length:i},()=>u==="0"?0:1);t.push(...n)}}}),t.sort((u,m)=>u-m)}const Q=9,tt=(s,t,c,l)=>{const[u]=Te(Ie.ESPIONAGEM,l),m=H("suspects",s),d=H(`testimony-questions-${t}`,s),i=H("testimony-answers",s),n=H("crime-reasons",s),g=v.useMemo(()=>rt(i.data),[i.data]),h=v.useMemo(()=>ot(m.data),[m.data]);return{entries:v.useMemo(()=>!u||!m.isSuccess||!d.isSuccess||!i.isSuccess||!n.isSuccess?{}:st(c,u,m.data,d.data,g,h,n.data),[s,u,m,d,i,c,g,h,n]),isLoading:m.isLoading||d.isLoading||i.isLoading}},st=(s,t,c,l,u,m,d)=>{console.count("Creating Espionagem...");let i=t.latestDate;const n=[],g={};for(let h=0;h<s;h++){const r=Me(i);i=r;let a=null,o=0;try{for(;!a&&o<500;){o++;const f=nt(c,l,u,m,n,d);if(lt(f.statements)){a=f,console.log(`Generated valid game for ${r} after ${o} attempts`);break}}}catch(f){throw new Error(`Failed to generate valid game for ${r} after ${o} attempts: ${f}`)}if(!a)throw new Error(`Failed to generate valid game for ${r} after ${o} attempts`);n.push(a.culpritId),g[r]={id:r,type:"espionagem",number:t.latestNumber+h+1,...a}}return g};function nt(s,t,c,l,u,m){let d=[];const i=[],n={},g=S.sample(Object.keys(c));if(!g)throw new Error("No selected testimony ID found");const h=Object.keys(c[g]).filter(C=>!u.includes(C)),r=h.length>0?h:Object.keys(c[g]),a=S.sample(r);if(!a)throw new Error("No selected culprit ID found");const o=S.sampleSize(Object.keys(c[g]).filter(C=>C!==a),Q-1);for(d.push(...o);d.length<8;){const C=S.sampleSize(Object.keys(s).filter(N=>!d.includes(N)&&N!==a),Q-d.length-1);d.push(...C)}const f={};Object.keys(l).forEach(C=>{if(l[C][a]===void 0){const N=Object.keys(l[C]).filter(R=>d.includes(R));if(N.length>0){const R={};N.forEach(E=>{d.includes(E)&&(R[E]=!0)}),f[C]=R}}});const y=t[g];i.push(it(a,d,y,c[g])),A(n,i[0].excludes);const b=V(a,d,f);i.push(b),A(n,b.excludes),d=S.shuffle([...d,a]);const x=V(a,d,f,[b],"worst");i.push(x),A(n,x.excludes);const p=V(a,d,f,[b,x],"worst");i.push(p),A(n,p.excludes);const j=ct(a,d,i);i.push(j),A(n,j.excludes);const w=[i[0],i[1],i[2],i[4],i[3]],k=ut(s[a],m);return{isNsfw:y.nsfw??!1,culpritId:a,statements:w,suspects:d.map(C=>s[C]),reason:k.title,setId:`${a}::${k.id}::${w[0].key}`,level:dt(w)}}const rt=s=>{const t={};console.log("‚öôÔ∏è Calculating suspect answers...");for(const c of Object.keys(s)){const l=s[c];for(const u of Object.keys(l)){const{resolution:m,projection:d}=J(u,l);if(!m&&!d){console.log("‚ÅâÔ∏è Ignoring testimony with no resolution or projection");continue}if(t[c]===void 0&&(t[c]={}),m){t[c][u]=m==="üëç";continue}if(d){t[c][u]=d==="üëç";continue}console.log("‚ÅâÔ∏è Ignoring testimony with not enough values")}}return Object.keys(t).forEach(c=>{S.isEmpty(t[c])&&delete t[c]}),Object.keys(t).forEach(c=>{Object.keys(t[c]).length<3&&(console.log("‚ÅâÔ∏è Removing testimonies with less than 3 answers"),delete t[c])}),Object.keys(t).forEach(c=>{S.uniq(Object.values(t[c])).length===1&&(console.log("‚ÅâÔ∏è Removing testimonies with the same answer"),delete t[c])}),t},ot=s=>{const t={};for(const l of Object.keys(s)){const{gender:u,ethnicity:m,age:d,build:i,height:n,features:g}=s[l];if(!i){console.log("‚ÅâÔ∏è Ignoring suspect with missing build",l);continue}if(!n){console.log("‚ÅâÔ∏è Ignoring suspect with missing height",l);continue}if(!g||g.length===0){console.log("‚ÅâÔ∏è Ignoring suspect with missing features",l);continue}t[u]===void 0&&(t[u]={}),t[u][l]=!0,t[m]===void 0&&(t[m]={}),t[m][l]=!0,t[d]===void 0&&(t[d]={}),t[d][l]=!0,t[i]===void 0&&(t[i]={}),t[i][l]=!0,t[n]===void 0&&(t[n]={}),t[n][l]=!0,g.forEach(h=>{t[h]===void 0&&(t[h]={}),t[h][l]=!0})}return t.young=S.cloneDeep(t["18-21"]),t.adult=S.cloneDeep({...t["21-30"],...t["30-40"],...t["40-50"]}),t.senior=S.cloneDeep({...t["50-60"],...t["60-70"],...t["70-80"],...t["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(l=>{delete t[l]}),t},A=(s,t)=>{t.forEach(c=>{s[c]===void 0&&(s[c]=0),s[c]++})},it=(s,t,c,l)=>{const u=l[s],m=t.filter(n=>l[n]!==void 0&&l[n]!==u),d=c.answer.charAt(0).toLowerCase()+c.answer.slice(1),i={key:`testimony.${c.id}`,text:`O(a) suspeito(a) ${u?"":"n√£o "}${d}`,excludes:m};return i.text.includes("n√£o j√°")&&(i.text=i.text.replace("n√£o j√°","nunca")),i},U={row1:{indexes:[0,1,2],text:"na primeira linha"},row2:{indexes:[3,4,5],text:"na segunda linha"},row3:{indexes:[6,7,8],text:"na terceira linha"},column1:{indexes:[0,3,6],text:"na primeira coluna"},column2:{indexes:[1,4,7],text:"na segunda coluna"},column3:{indexes:[2,5,8],text:"na terceira coluna"},corners:{indexes:[0,2,6,8],text:"nos cantos"}},ct=(s,t,c)=>{const l=t.indexOf(s),u=c.slice(0,3),m={};for(const r of Object.keys(U)){const{indexes:a}=U[r];a.includes(l)||(m[r]=a.reduce((o,f)=>{const y=t[f],b=u.filter(x=>x.excludes.includes(y)).length;return b>0?o+b:o},0))}const d=Object.entries(m).reduce((r,[a,o])=>(r[o]||(r[o]=[]),r[o].push(a),r),{}),i=Math.min(...Object.keys(m).map(r=>m[r])),n=d[i.toString()],g=S.sample(n)||Object.keys(m)[0],h=U[g].indexes.map(r=>t[r]);return{key:`not.grid.${g}`,text:`O(a) suspeito(a) n√£o est√° ${U[g].text}`,excludes:h}},V=(s,t,c,l=[],u="best")=>{const m=S.difference(t,[s]),d=l.filter(f=>f.key.startsWith("not.feature.")).map(f=>f.key.replace("not.feature.","")),i=new Set(l.flatMap(f=>f.excludes)),n=Object.keys(c).filter(f=>Object.keys(c[f]).length<=6&&!d.includes(f)).sort((f,y)=>Object.keys(c[y]).length-Object.keys(c[f]).length);let g,h=[],r=0;const a=500;for(;r<a;){r++;const f=u==="best"?n[0]:S.sample(n.slice(2,5))??n[2];if(!f)break;const y=m.filter(x=>c[f][x]);if(y.some(x=>!i.has(x))||r===a){g=f,h=y;break}n.splice(n.indexOf(f),1)}if(!g)throw Error(`No suitable feature found for ${u} selection after ${a} attempts`);console.log(`Selected feature after ${r} attempts: ${g}`);const o=at[g];return o||console.warn(`Feature ${g} not found in translations`),{key:`not.feature.${g}`,text:`O(a) suspeito(a) n√£o ${o||g}`,excludes:h}},at={male:"√© homem",female:"√© mulher",black:"√© negro(a)",white:"√© branco(a)",asian:"√© asi√°tico(a)",latino:"√© latino(a)",thin:"√© magrelo(a)",fat:"√© gordo(a)",large:"√© gordo(a)",tall:"√© alto(a)",short:"√© baixinho(a)",young:"√© jovem",adult:"√© adulto(a)",senior:"√© idoso(a)",average:"√© m√©dio(a)",medium:"√© m√©dio(a)",mixed:"√© mesti√ßo(a)",hat:"est√° usando um chap√©u",tie:"est√° usando uma gravata",glasses:"est√° usando √≥culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",caucasian:"√© caucasiano(a)",scarf:"est√° usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"√© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"√© musculoso(a)",blackHair:"tem cabelo preto",hoodie:"est√° usando um moletom",earrings:"est√° usando brincos",lipstick:"est√° usando batom",necklace:"est√° usando um colar",mediumHair:"tem cabelo m√©dio","middle-eastern":"√© do Oriente M√©dio",headscarf:"est√° usando um len√ßo na cabe√ßa",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"√© indiano(a)","native-american":"√© nativo-americano(a)",noAccessories:"n√£o est√° usando acess√≥rios"},lt=s=>{const t=s.slice(0,3);return t.reduce((u,m)=>u+m.excludes.length,0)<10?!1:new Set(t.flatMap(u=>u.excludes)).size===Q-1},ut=(s,t)=>{const c=[];Object.values(t).forEach(u=>{var m;u.feature==="general"&&c.push(u),(m=s.features)!=null&&m.includes(u.feature)&&c.push(u)});const l=S.sample(c);return l||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},dt=s=>{const t=s.slice(0,3),c=[],l={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};t.forEach(m=>{const d=m.excludes.length;l[d]!==void 0&&c.push(l[d])});const u=Math.round(c.reduce((m,d)=>m+d,0)/c.length);return Math.min(Math.max(u,1),3)};function ht(){const[s,t]=v.useState({batchSize:1,history:{}}),c=v.useRef(1),{entries:l}=tt(!0,"pt",s.batchSize,s.history);return e.jsxs(O,{vertical:!0,gap:12,className:"p-4",children:[e.jsxs(O,{justify:"space-between",align:"center",children:[e.jsx(T.Title,{level:4,className:"my-0",children:"Espionagem Simulator"}),e.jsxs(O,{gap:6,children:[e.jsx(de,{min:1,max:7,defaultValue:1,onChange:u=>{c.current=u??1}}),e.jsx(I,{type:"primary",onClick:()=>t({batchSize:c.current,history:{}}),children:"Re-run Simulation"})]})]}),e.jsx(mt,{entries:l})]})}function mt({entries:s}){const[t,c]=v.useState(!1),l=Ne(),u=s[l],m=v.useMemo(()=>u?u.statements.slice(0,3).reduce((d,i)=>{const{excludes:n}=i;return n.forEach(g=>{d[g]?d[g]++:d[g]=1}),d},{}):{},[u]);return e.jsxs("div",{className:"full-width grid grid-2",children:[e.jsx(Oe,{src:s??{},theme:"twilight",collapsed:3}),u&&e.jsxs(O,{gap:18,className:"p-4",children:[e.jsx("div",{children:e.jsx("div",{style:{width:`${105*3}px`,display:"grid",gap:"6px",gridTemplateColumns:"repeat(3, 1fr)"},children:u.suspects.map(d=>e.jsxs(te.Ribbon,{text:t?m[d.id]:null,color:"cyan",children:[e.jsx(z,{id:G(d.id,"gb"),width:96,className:ue(t&&d.id===u.culpritId&&"red-border")},d.id),e.jsxs(O,{gap:6,align:"center",children:[e.jsx(B,{checkedChildren:"üö´",size:"small"})," ",d.id]})]},d.id))})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(B,{checkedChildren:"Show Culprit",unCheckedChildren:"Hide Culprit",checked:t,onChange:c})}),u.statements.map((d,i)=>e.jsx(T.Paragraph,{children:e.jsx(te,{count:d.excludes.length,color:"cyan",children:e.jsx(be,{message:d.text,banner:!0,type:i<3?"info":"error"},d.key)})},d.key))]})]})]})}function je({suspect:s,values:t,resolution:c,projection:l,yesPercentage:u,noPercentage:m,complete:d,enoughData:i,testimonyId:n,addEntryToUpdate:g,answers:h,barWidth:r,showName:a}){const o=x=>{const p={...h};p[x]=[...p[x]||[],3],g(n,p)},f=x=>{const p={...h};p[x]=[...p[x]||[],-3],g(n,p)},y=x=>{var w;const p={...h},j=(w=p[x])==null?void 0:w.findIndex(k=>k===3);j!==-1&&j!==void 0&&(p[x]=[...p[x].slice(0,j),...p[x].slice(j+1)]),g(n,p)},b=x=>{var w;const p={...h},j=(w=p[x])==null?void 0:w.findIndex(k=>k===-3);j!==-1&&j!==void 0&&(p[x]=[...p[x].slice(0,j),...p[x].slice(j+1)]),g(n,p)};return e.jsxs(ye,{trigger:"click",title:`Add strong fit/unfit answer to ${s.name.pt}`,content:e.jsxs(O,{vertical:!0,gap:4,children:[e.jsx(T.Text,{type:"secondary",children:t.join(", ")}),e.jsxs(I,{icon:"üëç",block:!0,onClick:()=>o(s.id),children:[" ","Add strong fit"]}),e.jsxs(I,{icon:"üëé",block:!0,onClick:()=>f(s.id),children:[" ","Add strong unfit"]}),e.jsxs($.Compact,{children:[e.jsx(I,{icon:"‚ùå",size:"small",block:!0,onClick:()=>y(s.id),children:"fit"}),e.jsx(I,{icon:"‚ùå",size:"small",block:!0,onClick:()=>b(s.id),children:"unfit"})]})]}),children:[a&&e.jsxs("div",{children:[e.jsx(F,{title:s.id,children:s.name.pt})," ",d&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(oe,{style:{color:"gold"}})})]}),e.jsxs(O,{align:"flex-start",gap:12,children:[e.jsx(F,{title:`Values: ${t.join(", ")} : ${c||(l?`${l}*`:"")}`,children:i?e.jsx(se,{percent:m+u,size:[r,20],status:"exception",success:{percent:u},showInfo:!1}):e.jsx(se,{percent:m+u,size:[r,10],status:"exception",success:{percent:u},showInfo:!1})}),!a&&d&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(oe,{style:{color:"gold"}})})]})]})}function ft({suspect:s,answersPerQuestion:t={},questions:c,addEntryToUpdate:l,allAnswers:u}){const{queryParams:m}=D({sortSuspectsBy:"answers"}),d=m.get("sortSuspectsBy")??"answers",i=v.useMemo(()=>{const h=Object.values(c).map(r=>{const a=t[r.id]??{},{enoughData:o,reliable:f,yesPercentage:y,noPercentage:b,blankPercentage:x,values:p,total:j,resolution:w,projection:k,complete:C}=J(s.id,{[s.id]:a});return{id:r.id,question:r,enoughData:o,reliable:f,yesPercentage:y,noPercentage:b,blankPercentage:x,values:p,total:j,resolution:w,projection:k,complete:C}});return d==="answers"?S.orderBy(h,["reliable","enoughData","yesPercentage",r=>r.values.length],["desc","desc","desc","desc"]):S.orderBy(h,r=>Number(r.id.split("-")[1]),["asc"])},[t,c,s.id,d]),n=v.useMemo(()=>pt(s,i),[s,i]),g=[{key:"id",title:"Id",dataIndex:"id"},{key:"question",title:"Question",dataIndex:"question",render:h=>h.question},{key:"answer",title:"Answer",dataIndex:"id",sorter:(h,r)=>h.total-r.total,render:h=>{const r=i.find(a=>a.id===h);return r?e.jsx(O,{gap:8,wrap:"nowrap",children:e.jsx(je,{values:r.values,resolution:r.resolution,projection:r.projection,yesPercentage:r.yesPercentage,noPercentage:r.noPercentage,complete:r.complete,enoughData:r.enoughData,suspect:s,testimonyId:r.question.id,answers:u[r.question.id]||{},addEntryToUpdate:l,barWidth:120})}):""}}];return e.jsxs($,{wrap:!0,size:"large",children:[e.jsx(X,{rowKey:"id",columns:g,dataSource:i,bordered:!0}),e.jsxs(O,{gap:8,vertical:!0,children:[e.jsx(T.Title,{level:5,children:"Suspect Description"}),e.jsx(Ae.TextArea,{value:n,readOnly:!0,className:"full-width",rows:7})]})]})}const pt=(s,t)=>{const c=t.filter(l=>l.resolution||l.projection).map(l=>{const{question:u,resolution:m,projection:d}=l,i=m||d;return`${s.gender==="male"?"ele":"ela"} ${i==="üëç"?"":"n√£o "}${u.answer.toLocaleLowerCase()}`});return`${s.name.pt}: ${c.join(", ")}`};function gt({isLoading:s,isSuccess:t,questions:c,data:l,suspects:u,addEntryToUpdate:m}){const{queryParams:d,addParam:i}=D(),n=v.useMemo(()=>Object.keys(l).reduce((o,f)=>{const y=l[f]??{};return Object.keys(y).forEach(b=>{o[b]||(o[b]={}),o[b][f]=y[b]}),o},{}),[l]),g=v.useMemo(()=>S.orderBy(Object.values(u).map(o=>({...o,answers:n[o.id]})),o=>Number(o.id.split("-")[1]),"asc"),[u,n]),h=me({total:g.length,showQuickJumper:!0}),r=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,f)=>Number(o.id.split("-")[1])-Number(f.id.split("-")[1])},{title:"Picture",dataIndex:"id",render:o=>e.jsx(z,{id:G(o,"gb"),width:48})},{title:"Name",dataIndex:"name",key:"name",sorter:(o,f)=>o.name.pt.localeCompare(f.name.pt),render:(o,f)=>e.jsxs(O,{vertical:!0,children:[e.jsx(T.Text,{children:o.pt}),e.jsx(T.Text,{type:"secondary",children:o.en}),e.jsx(T.Text,{type:"secondary",italic:!0,children:e.jsx("small",{children:f.note})})]})},{title:"Questions Answered",dataIndex:"answers",key:"answers",sorter:(o,f)=>Object.keys(o.answers??{}).length-Object.keys(f.answers??{}).length,render:o=>o?Object.values(o).length:""}],a=he({maxExpandedRows:1,expandedRowRender:o=>e.jsx(ft,{suspect:o,answersPerQuestion:n[o.id],questions:c,addEntryToUpdate:m,allAnswers:l}),rowExpandable:()=>t});return e.jsxs(O,{gap:12,className:"full-width py-4",vertical:!0,children:[e.jsxs(O,{justify:"space-between",align:"center",children:[e.jsx(T.Title,{level:4,className:"my-0",children:"Testimonies by Suspect"}),e.jsx(B,{checked:d.get("sortSuspectsBy")==="answers",onChange:o=>i("sortSuspectsBy",o?"answers":"id"),checkedChildren:"Sort by Answers",unCheckedChildren:"Sort by Id"})]}),e.jsx(X,{columns:r,dataSource:g,pagination:h,rowKey:"id",expandable:a,loading:s,bordered:!0,className:"full-width"})]})}function xt({answers:s,suspects:t,addEntryToUpdate:c,testimonyId:l}){const[u,m]=Fe(12),{queryParams:d,is:i}=D({sortSuspectsBy:"answers"}),n=i("enableBatch"),g=d.get("sortSuspectsBy")??"answers",h=v.useMemo(()=>{const o=Object.keys(t).map(f=>J(f,s));return g==="answers"?S.orderBy(o,["reliable","enoughData",f=>f.values.length,"yesPercentage","noPercentage",f=>Number(f.suspectCardId.split("-")[1])],["desc","desc","desc","desc","desc","asc"]):S.orderBy(o,f=>Number(f.suspectCardId.split("-")[1]),["asc"])},[s,t,g]),[r,a]=v.useState([]);return e.jsxs($,{direction:"vertical",children:[e.jsx(jt,{selection:r,setSelection:a,suspects:t,addEntryToUpdate:c,list:h,testimonyId:l,answers:s}),e.jsx($,{wrap:!0,ref:m,size:"large",children:h.map(o=>e.jsxs(O,{vertical:!0,gap:6,className:ue({"selection-outline":n&&r.includes(o.suspectCardId)}),children:[e.jsx(z,{id:o.imageId,width:u,className:o.values.length>1?void 0:"grayscale"}),e.jsxs(O,{gap:4,children:[n&&e.jsx(fe,{disabled:o.complete,checked:r.includes(o.suspectCardId),onChange:f=>{const y=f.target.checked;a(b=>y?[...b,o.suspectCardId]:b.filter(x=>x!==o.suspectCardId))}}),e.jsx(je,{values:o.values,resolution:o.resolution,projection:o.projection,yesPercentage:o.yesPercentage,noPercentage:o.noPercentage,complete:o.complete,enoughData:o.enoughData,suspect:t[o.suspectCardId],testimonyId:l,answers:s,addEntryToUpdate:c,barWidth:u,showName:!0})]})]},o.suspectCardId))})]})}function jt({testimonyId:s,selection:t,setSelection:c,suspects:l,addEntryToUpdate:u,list:m,answers:d}){const[i,n]=v.useState([]),{addParam:g,removeParam:h,is:r}=D({sortSuspectsBy:"answers"}),a=r("enableBatch"),o=b=>{n(x=>x.includes(b)?x.filter(p=>p!==b):[...x,b])},f=v.useMemo(()=>S.keyBy(m,"suspectCardId"),[m]);v.useEffect(()=>{if(i.length===0&&t.length>0){c([]);return}if(!i.length)return;const x=(t.length>0?t:Object.values(f).filter(p=>!p.complete&&!p.values.includes(3)&&!p.values.includes(-3)).map(p=>p.suspectCardId)).filter(p=>{const j=l[p],w=[j.gender,j.ethnicity,j.build,j.height];return j.age==="18-21"&&w.push("young"),(j.age==="21-30"||j.age==="30-40")&&w.push("adult"),j.age==="40-50"&&w.push("parent"),(j.age==="50-60"||j.age==="60-70"||j.age==="70-80"||j.age==="80-90")&&w.push("senior"),i.every(k=>w.includes(k))});c(x)},[i]);const y=b=>{const x=S.cloneDeep(d);t.forEach(p=>{x[p]=[...x[p]||[],b]}),u(s,x),n([])};return e.jsxs(O,{align:"center",gap:6,justify:"space-between",className:"mb-4",children:[e.jsxs(O,{gap:3,children:[e.jsx(T.Text,{className:"nowrap",style:{minWidth:"5ch"},children:"Batch"}),e.jsx(B,{value:a,checkedChildren:"On",unCheckedChildren:"Off",onChange:b=>{b?g("enableBatch",!0):h("enableBatch")}})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(T.Text,{className:"nowrap mr-2",children:["Selected ",t.length]}),e.jsxs(O,{gap:6,wrap:!0,align:"center",justify:"center",children:[e.jsx(M,{filter:"male",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"female",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"young",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"adult",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"parent",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"senior",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"thin",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"muscular",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"large",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"asian",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"black",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"caucasian",activeFilters:i,updateActiveFilter:o}),e.jsx(M,{filter:"latino",activeFilters:i,updateActiveFilter:o})]}),e.jsxs(O,{align:"center",gap:6,children:[e.jsx(I,{onClick:()=>n([]),danger:!0,size:"small",children:"Clear"}),e.jsx(ne,{title:"Apply +3 to selected suspects?",onConfirm:()=>y(3),children:e.jsx(I,{disabled:t.length===0,size:"small",type:"primary",className:"ml-10",children:"Apply +3"})}),e.jsx(le,{type:"vertical"}),e.jsx(ne,{title:"Apply -3 to selected suspects?",onConfirm:()=>y(-3),children:e.jsx(I,{disabled:t.length===0,size:"small",type:"primary",children:"Apply -3"})})]})]})]})}function M({filter:s,activeFilters:t,updateActiveFilter:c}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[e.jsx(fe,{checked:t.includes(s),onClick:()=>c(s)})," ",S.capitalize(s)]}),e.jsx(le,{type:"vertical"})]})}function bt({data:s,questions:t,suspects:c,isLoading:l,isSuccess:u,addEntryToUpdate:m}){const{queryParams:d,addParam:i}=D(),n=v.useMemo(()=>S.orderBy(Object.values(t).map(a=>({...a,answersCount:Object.values(s[a.id]??{}).length})),a=>Number(a.id.split("-")[1]),"asc"),[t]),g=me({total:n.length,showQuickJumper:!0}),h=[{title:"Id",dataIndex:"id",key:"id",sorter:(a,o)=>Number(a.id.split("-")[1])-Number(o.id.split("-")[1])},{title:"Question",dataIndex:"question",key:"question",sorter:(a,o)=>a.question.localeCompare(o.question)},{title:"NSFW",dataIndex:"nsfw",key:"nsfw",render:a=>a?e.jsx(Be,{style:{color:"hotPink"}}):"",sorter:(a,o)=>Number(a.nsfw)-Number(o.nsfw)},{title:"Answers",dataIndex:"answersCount",key:"answersCount",sorter:(a,o)=>a.answersCount-o.answersCount}],r=he({maxExpandedRows:1,expandedRowRender:a=>e.jsx(xt,{testimonyId:a.id,answers:s[a.id]??{},suspects:c,addEntryToUpdate:m}),rowExpandable:()=>u});return e.jsxs(O,{gap:12,className:"full-width py-4",vertical:!0,children:[e.jsxs(O,{justify:"space-between",align:"center",children:[e.jsx(T.Title,{level:4,className:"my-0",children:"Suspects by Testimony"}),e.jsx(B,{checked:d.get("sortSuspectsBy")==="answers",onChange:a=>i("sortSuspectsBy",a?"answers":"id"),checkedChildren:"Sort by Answers",unCheckedChildren:"Sort by Id"})]}),e.jsx(X,{columns:h,dataSource:n,pagination:g,rowKey:"id",expandable:r,loading:l,bordered:!0,className:"full-width"})]})}function yt(s){const{queryParams:t,is:c}=D();return e.jsxs(e.Fragment,{children:[(c("display","questions")||!t.get("display"))&&e.jsx(bt,{...s}),c("display","suspects")&&e.jsx(gt,{...s}),c("display","simulator")&&e.jsx(ht,{})]})}const wt="Left",vt="Right",St="Up",kt="Down",P={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},W={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},ie="mousemove",ce="mouseup",Ot="touchend",Ct="touchmove",Et="touchstart";function Tt(s,t,c,l){return s>t?c>0?vt:wt:l>0?kt:St}function ae(s,t){if(t===0)return s;const c=Math.PI/180*t,l=s[0]*Math.cos(c)+s[1]*Math.sin(c),u=s[1]*Math.cos(c)-s[0]*Math.sin(c);return[l,u]}function It(s,t){const c=h=>{const r="touches"in h;r&&h.touches.length>1||s((a,o)=>{o.trackMouse&&!r&&(document.addEventListener(ie,l),document.addEventListener(ce,d));const{clientX:f,clientY:y}=r?h.touches[0]:h,b=ae([f,y],o.rotationAngle);return o.onTouchStartOrOnMouseDown&&o.onTouchStartOrOnMouseDown({event:h}),Object.assign(Object.assign(Object.assign({},a),W),{initial:b.slice(),xy:b,start:h.timeStamp||0})})},l=h=>{s((r,a)=>{const o="touches"in h;if(o&&h.touches.length>1)return r;if(h.timeStamp-r.start>a.swipeDuration)return r.swiping?Object.assign(Object.assign({},r),{swiping:!1}):r;const{clientX:f,clientY:y}=o?h.touches[0]:h,[b,x]=ae([f,y],a.rotationAngle),p=b-r.xy[0],j=x-r.xy[1],w=Math.abs(p),k=Math.abs(j),C=(h.timeStamp||0)-r.start,N=Math.sqrt(w*w+k*k)/(C||1),R=[p/(C||1),j/(C||1)],E=Tt(w,k,p,j),K=typeof a.delta=="number"?a.delta:a.delta[E.toLowerCase()]||P.delta;if(w<K&&k<K&&!r.swiping)return r;const L={absX:w,absY:k,deltaX:p,deltaY:j,dir:E,event:h,first:r.first,initial:r.initial,velocity:N,vxvy:R};L.first&&a.onSwipeStart&&a.onSwipeStart(L),a.onSwiping&&a.onSwiping(L);let Z=!1;return(a.onSwiping||a.onSwiped||a[`onSwiped${E}`])&&(Z=!0),Z&&a.preventScrollOnSwipe&&a.trackTouch&&h.cancelable&&h.preventDefault(),Object.assign(Object.assign({},r),{first:!1,eventData:L,swiping:!0})})},u=h=>{s((r,a)=>{let o;if(r.swiping&&r.eventData){if(h.timeStamp-r.start<a.swipeDuration){o=Object.assign(Object.assign({},r.eventData),{event:h}),a.onSwiped&&a.onSwiped(o);const f=a[`onSwiped${o.dir}`];f&&f(o)}}else a.onTap&&a.onTap({event:h});return a.onTouchEndOrOnMouseUp&&a.onTouchEndOrOnMouseUp({event:h}),Object.assign(Object.assign(Object.assign({},r),W),{eventData:o})})},m=()=>{document.removeEventListener(ie,l),document.removeEventListener(ce,d)},d=h=>{m(),u(h)},i=(h,r)=>{let a=()=>{};if(h&&h.addEventListener){const o=Object.assign(Object.assign({},P.touchEventOptions),r.touchEventOptions),f=[[Et,c,o],[Ct,l,Object.assign(Object.assign({},o),r.preventScrollOnSwipe?{passive:!1}:{})],[Ot,u,o]];f.forEach(([y,b,x])=>h.addEventListener(y,b,x)),a=()=>f.forEach(([y,b])=>h.removeEventListener(y,b))}return a},g={ref:h=>{h!==null&&s((r,a)=>{if(r.el===h)return r;const o={};return r.el&&r.el!==h&&r.cleanUpTouch&&(r.cleanUpTouch(),o.cleanUpTouch=void 0),a.trackTouch&&h&&(o.cleanUpTouch=i(h,a)),Object.assign(Object.assign(Object.assign({},r),{el:h}),o)})}};return t.trackMouse&&(g.onMouseDown=c),[g,i]}function Mt(s,t,c,l){return!t.trackTouch||!s.el?(s.cleanUpTouch&&s.cleanUpTouch(),Object.assign(Object.assign({},s),{cleanUpTouch:void 0})):s.cleanUpTouch?t.preventScrollOnSwipe!==c.preventScrollOnSwipe||t.touchEventOptions.passive!==c.touchEventOptions.passive?(s.cleanUpTouch(),Object.assign(Object.assign({},s),{cleanUpTouch:l(s.el,t)})):s:Object.assign(Object.assign({},s),{cleanUpTouch:l(s.el,t)})}function Nt(s){const{trackMouse:t}=s,c=v.useRef(Object.assign({},W)),l=v.useRef(Object.assign({},P)),u=v.useRef(Object.assign({},l.current));u.current=Object.assign({},l.current),l.current=Object.assign(Object.assign({},P),s);let m;for(m in P)l.current[m]===void 0&&(l.current[m]=P[m]);const[d,i]=v.useMemo(()=>It(n=>c.current=n(c.current,l.current),{trackMouse:t}),[t]);return c.current=Mt(c.current,l.current,u.current,i),d}function Dt(s){const{addParam:t}=D();return e.jsxs(O,{vertical:!0,gap:8,children:[e.jsx(I,{onClick:()=>t("testify","single"),block:!0,children:"Testify Drawer"}),e.jsx(I,{onClick:()=>t("testify","group"),block:!0,children:"Testify Group"}),e.jsx(Rt,{...s}),e.jsx(Pt,{...s})]})}function Rt({suspects:s,questions:t,answers:c,addEntryToUpdate:l}){var x;const{width:u,height:m}=pe(),{is:d,removeParam:i}=D(),[n,g,h]=xe(),r=Nt({onSwipedLeft:()=>alert("Swiped Left"),onSwipedRight:()=>alert("Swiped Right"),onSwipedUp:()=>alert("Swiped Up"),preventScrollOnSwipe:!0,trackTouch:!0,trackMouse:!0}),a=()=>{g({suspectId:S.sample(Object.keys(s))||null,testimonyId:S.sample(Object.keys(t))||null})},o=()=>{a()},f=()=>{if(n!=null&&n.suspectId&&(n!=null&&n.testimonyId)){const p=S.cloneDeep(c[(n==null?void 0:n.testimonyId)??""]??{});p[n.suspectId]=[...p[n.suspectId]||[],1],l(n.testimonyId??"",p),a()}},y=()=>{if(n!=null&&n.suspectId&&(n!=null&&n.testimonyId)){const p=S.cloneDeep(c[(n==null?void 0:n.testimonyId)??""]??{});p[n.suspectId]=[...p[n.suspectId]||[],0],l(n.testimonyId??"",p),a()}},b=!!(n!=null&&n.suspectId)&&!!(n!=null&&n.testimonyId);return e.jsx(ge,{title:e.jsx(T,{children:"Does this person do this??"}),open:d("testify","single"),onCancel:()=>i("testify"),maskClosable:!1,width:u-64,footer:null,children:e.jsxs("div",{...r,children:[b&&e.jsxs(O,{vertical:!0,gap:8,className:"mb-8",justify:"center",align:"center",children:[e.jsx(z,{id:G(n.suspectId??"","gb"),width:Math.max(m/4,128)}),e.jsx(T.Title,{level:5,className:"text-center",children:(x=t[n.testimonyId??""])==null?void 0:x.question})]}),e.jsxs($.Compact,{block:!0,size:"large",className:"mb-8",children:[e.jsx(I,{block:!0,icon:"üëé",disabled:!b,style:{height:64},onClick:y,children:"No"}),e.jsx(I,{block:!0,onClick:o,style:{height:64},children:"Skip"}),e.jsx(I,{block:!0,icon:"üëç",iconPosition:"end",disabled:!b,style:{height:64},onClick:f,children:"Yes"})]})]})})}function Pt({suspects:s,questions:t,answers:c,addEntryToUpdate:l}){var x;const{width:u,height:m}=pe(),{is:d,removeParam:i}=D(),[n,g,h]=xe(),[r,a]=v.useState(6),o=()=>{var j;const p=(j=S.sampleSize(Object.keys(s),r))==null?void 0:j.reduce((w,k)=>(w[k]=null,w),{});g({suspectsIds:p,testimonyId:S.sample(Object.keys(t))||null})};we(()=>o());const f=()=>{const p=Object.entries((n==null?void 0:n.suspectsIds)??{}).reduce((j,[w,k])=>(k!==null&&(j[w]=[k]),j),{});if(n!=null&&n.testimonyId&&Object.keys(p).length>0){const j=S.cloneDeep(c[n.testimonyId]??{});Object.entries(p).forEach(([w,k])=>{j[w]=[...j[w]||[],...k]}),l(n.testimonyId,j)}else console.log("No testimonyId or no judged suspects found, likely skipped");o()},y=!!(n!=null&&n.suspectsIds)&&!!(n!=null&&n.testimonyId),b=p=>{g(j=>{if(!j)return j;const w=Object.entries(j.suspectsIds).reduce((k,[C,N])=>(k[C]=N===null?p:N,k),{});return{...j,suspectsIds:w}})};return e.jsx(ge,{title:e.jsx(T,{children:"Do these people do this??"}),open:d("testify","group"),onCancel:()=>i("testify"),maskClosable:!1,width:u-64,footer:null,children:e.jsxs("div",{children:[y&&e.jsxs(O,{vertical:!0,gap:8,className:"mb-8",justify:"center",align:"center",children:[e.jsxs(T.Text,{children:["Number of Suspects:",e.jsx(de,{value:r,onChange:p=>a(p??6)})]}),e.jsx(T.Title,{level:4,className:"text-center",children:(x=t[n.testimonyId??""])==null?void 0:x.question}),e.jsx(O,{wrap:"wrap",justify:"center",gap:8,children:Object.keys(n.suspectsIds).map(p=>{var j,w;return e.jsxs(O,{justify:"center",align:"center",vertical:!0,children:[e.jsx(T.Text,{className:"text-center",children:((w=(j=s[p])==null?void 0:j.name)==null?void 0:w.pt)||"Unknown"}),e.jsx(z,{id:G(p,"gb"),width:Math.min(Math.max(m/3,128),128)},p),e.jsx(De,{shape:"round",size:"large",value:n.suspectsIds[p],onChange:k=>g(C=>C&&{...C,suspectsIds:{...C.suspectsIds,[p]:k}}),options:[{value:0,icon:"üëé"},{value:null,icon:"‚ôæ"},{value:1,icon:"üëç"}]})]},p)})})]}),e.jsxs(O,{justify:"space-between",align:"center",className:"mt-8",children:[e.jsx("span",{}),e.jsxs(O,{gap:8,children:[e.jsx(I,{onClick:()=>b(0),children:"Set all ‚ôæ to üëé"}),e.jsx(I,{onClick:()=>b(1),children:"Set all ‚ôæ to üëç"})]}),e.jsx(I,{onClick:f,size:"large",children:"Next Set"})]})]})})}function At({suspects:s,questions:t,data:c,hasNewData:l,isDirty:u,save:m,isSaving:d,entriesToUpdate:i,addEntryToUpdate:n}){const{queryParams:g,addParams:h}=D(),r=v.useMemo(()=>{const a={};return Object.values(c).forEach(o=>{Object.keys(o).forEach(f=>{o[f]&&(a[f]||(a[f]=0),Ce(o[f])>=5&&(a[f]+=1))})}),{queriedTestimoniesCount:Object.keys(c).length,suspectsCount:Object.keys(a).length,reliableSuspectsCount:Object.values(a).filter(o=>o>=5).length}},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsxs(O,{vertical:!0,gap:12,children:[e.jsx($e,{isDirty:u,onSave:m,isSaving:d,dirt:JSON.stringify(i)}),e.jsx(Pe,{data:async()=>await Ft(c),fileName:"testimony-answers.json",disabled:u,hasNewData:l,block:!0}),e.jsx(re,{path:"data/testimonies",className:"text-center",label:"Firestore Data"}),e.jsx(re,{path:"tdr/testimonies",className:"text-center",label:"Firestore TDR"})]})}),e.jsx(q,{children:e.jsx(Re,{label:"Display",value:g.get("display")??"questions",onChange:a=>h({display:a,page:1},{page:1}),options:[{title:"Questions",icon:e.jsx(Ue,{}),value:"questions"},{title:"Suspects",icon:e.jsx(Xe,{}),value:"suspects"},{title:"Simulator",icon:e.jsx(Ke,{}),value:"simulator"}]})}),e.jsx(q,{children:e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Legend"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Reliability: At least 5 votes"}),e.jsx("li",{children:"Large Bars: There's enough data (at least 3)"}),e.jsx("li",{children:"Small blue bar: in progress negative"})]})]})}),e.jsxs(q,{children:[e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Counts"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Testimonies: ",r.queriedTestimoniesCount]}),e.jsxs("li",{children:["Suspects: ",r.suspectsCount]}),e.jsx("li",{children:e.jsxs(F,{title:"A reliable suspect is one that has at least 5 complete testimonies.",children:["Reliable suspects: ",r.reliableSuspectsCount]})})]})]}),e.jsx(Dt,{suspects:s,questions:t,answers:c,addEntryToUpdate:n})]})]})}async function Ft(s){console.log("Preparing file for download...x");const t=await ze("data","testimonies")(),c=Le(t);console.log("Parsed data from Firestore:",c);const l=S.cloneDeep(s);return Object.keys(l).forEach(u=>{const m=l[u],d=c[u]||{};Object.keys(m).forEach(i=>{const n=d[i]||[],g=et([...m[i],...n]);m[i]=g})}),He(qe(l))}function Ms(){const s=Ee();return e.jsx(ve,{title:"Testimonies",subtitle:"Suspect Testimony Rates",children:e.jsxs(ee,{hasSider:!0,children:[e.jsx(ke,{children:e.jsx(At,{...s})}),e.jsx(ee.Content,{className:"content",children:e.jsx(Se,{isLoading:s.isLoading,error:s.error,hasResponseData:!S.isEmpty(s.data),children:e.jsx(yt,{...s})})})]})})}export{Ms as TestimoniesPage,Ms as default};
