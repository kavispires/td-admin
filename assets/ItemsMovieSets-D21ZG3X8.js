import{j as e,D as b,r as g,T as v,B as w,P as T,L as S}from"./index-CCPCqmwn.js";import{D as L}from"./DataLoadingWrapper-DYVUL6Fk.js";import{c as O}from"./FilterEntries-DWt1NKTA.js";import{S as k}from"./SiderContent-5xS73I4L.js";import{D as E}from"./DownloadButton-C_dAOCHp.js";import{S as B}from"./SaveButton-C94s-XBZ.js";import{u as C}from"./useQueryParams-DscI9L68.js";import{a as A,r as D}from"./index-DfZEHWc_.js";import{F as h}from"./index-CL2_8Yc_.js";import{u as P}from"./useCopyToClipboardFunction-BDyBpcj_.js";import{u as R}from"./useTDResource-BwAXVVPu.js";import{u as N}from"./useTableExpandableRows-Bzg66QYI.js";import{l as c,P as Q}from"./useBaseUrl-BFZattM8.js";import{I as Y}from"./Item-CtMuIS_J.js";import{u as G}from"./useTablePagination-DH9g9wHM.js";import{I as $}from"./ItemsTypeahead-xTU7mWCt.js";import{u as H}from"./useDailyHistoryQuery-B_aW4ftu.js";import{u as J,L as K}from"./constants--Sq9E04o.js";import{F as y}from"./Table-Blwd8CG9.js";import{S as I}from"./index-1vF1OoDf.js";import{P as X}from"./index-C-acapna.js";import{R as _}from"./DeleteFilled-CqWCgRPv.js";import{u as z}from"./useResourceFirestoreData-DMXUytrV.js";import"./index-Cb0F2SWn.js";import"./index-NVZJvXHE.js";import"./index-Bi3nZmoQ.js";import"./index-Br7RFtJ1.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-Db7L5lLZ.js";import"./constants-mMo-QEqz.js";import"./gapSize-U1swVQyS.js";import"./useDebounce-B0j3DUcN.js";import"./index-DnnWv706.js";import"./Input-DgNQyC7W.js";import"./useGetFirestoreDoc-Ds9zYP1E.js";import"./index-vv4QFTLm.js";import"./index-CF1GbRTU.js";import"./scrollTo-B-2Ph30b.js";import"./Pagination-BfoenvKU.js";import"./extendsObject-keMuGWqj.js";import"./useUpdateFirestoreDoc-BO7v8zZq.js";import"./useMutation-BYHBckkd.js";function W({data:t,save:s,isDirty:o,isSaving:a,entriesToUpdate:i,hasFirestoreData:m}){const{is:u,addParam:p}=C();return e.jsxs(k,{children:[e.jsxs(h,{vertical:!0,gap:12,children:[e.jsx(B,{isDirty:o,onSave:s,isSaving:a,dirt:JSON.stringify(i)}),e.jsx(E,{data:()=>q(t),fileName:"daily-movie-sets.json",disabled:o,hasNewData:m,block:!0})]}),e.jsx(b,{}),e.jsx(O,{label:"Pending Only",value:u("emptyOnly"),onChange:x=>p("emptyOnly",x,!1)})]})}function q(t){return A(t)}function Z(){const t=K.DAILY.pt,s=H(t,{enabled:!0}),[o]=J("filmaco",s.data);return g.useMemo(()=>c.mapValues(c.keyBy((o==null?void 0:o.used)??[]),()=>!0),[o])}function U(t){return c.orderBy(t,[s=>s.title]).map(s=>({...s,itemsIds:c.orderBy(s.itemsIds,o=>Number(o))}))}function V({data:t,addEntryToUpdate:s}){const o=P(),a=R("items"),i=Z(),{is:m}=C(),u=m("emptyOnly"),p=g.useMemo(()=>{const r=t?U(Object.values(t)):[];return u?r.filter(n=>n.itemsIds.length===0):r},[t,u]),x=p.filter(r=>r.itemsIds.length>0).length,l=G({total:p.length,showQuickJumper:!0}),d=[{title:"Title",dataIndex:"title",render:(r,n)=>e.jsx(j,{property:"title",value:r,movie:n,addEntryToUpdate:s}),sorter:(r,n)=>r.title.localeCompare(n.title)},{title:"Year",dataIndex:"year",render:(r,n)=>e.jsx(j,{property:"year",value:r,movie:n,addEntryToUpdate:s}),sorter:(r,n)=>r.year-n.year},y.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(r,n)=>e.jsx(F,{movie:n,itemsIds:r,copyToClipboard:o,addEntryToUpdate:s}),sorter:(r,n)=>r.itemsIds.length-n.itemsIds.length},{title:"Count",dataIndex:"itemsIds",render:r=>D(r).filter(Boolean).length},{title:"Used",dataIndex:"id",render:r=>i[r]?"Yes":"No",sorter:(r,n)=>i[r.id]&&!i[n.id]?-1:!i[r.id]&&i[n.id]?1:n.itemsIds.length-r.itemsIds.length}],f=N({maxExpandedRows:1,expandedRowRender:r=>e.jsx(M,{movie:r,addEntryToUpdate:s}),rowExpandable:()=>a.isSuccess});return e.jsxs(I,{direction:"vertical",children:[e.jsxs(v.Title,{level:5,children:["Total Movies: ",p.length," | Complete Movies: ",x]}),e.jsx(y,{columns:d,rowKey:"id",dataSource:p,expandable:f,pagination:l})]})}function M({movie:t,addEntryToUpdate:s}){const o=a=>{s(t.id,{...t,itemsIds:[...t.itemsIds,a]})};return e.jsx("div",{children:e.jsx($,{onFinish:o})})}function ee({movie:t,addEntryToUpdate:s,itemId:o}){const a=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(i=>i!==o)})};return e.jsx(X,{title:"Are you sure you want to remove this item?",onConfirm:a,okText:"Yes",cancelText:"No",children:e.jsx(w,{icon:e.jsx(_,{}),size:"small",type:"text"})})}function F({movie:t,itemsIds:s,copyToClipboard:o,addEntryToUpdate:a}){return e.jsx(h,{gap:6,wrap:"wrap",children:s.map((i,m)=>e.jsxs(h,{gap:2,vertical:!0,children:[e.jsx(Y,{id:i,width:60}),e.jsxs(h,{justify:"center",children:[e.jsx(v.Text,{onClick:()=>o(i),children:i}),e.jsx(ee,{movie:t,addEntryToUpdate:a,itemId:i})]})]},`${t.title}-${i}-${m}`))},`items-${t.title}`)}function j({value:t,movie:s,addEntryToUpdate:o,property:a}){const i=m=>typeof t=="number"?m!==String(t)?o(s.id,{...s,[a]:Number(m)}):null:m!==t?o(s.id,{...s,[a]:m.trim()}):null;return e.jsx(I,{children:e.jsx(v.Text,{editable:{onChange:i},children:String(t)})})}function te({data:t,addEntryToUpdate:s}){const[o,a]=g.useState(null),i=R("items"),m=P(),u=()=>{var f;let l=c.sample(Object.keys(t??{})),d=0;for(;d<15&&(((f=t[String(l)])==null?void 0:f.itemsIds)??[]).length>0;)l=c.sample(Object.keys(t??{})),d++;if(d>=15)return console.warn("Could not find a sample with no itemsIds");a(l??null)},p=[{title:"Title",dataIndex:"title",render:(l,d)=>e.jsx(j,{property:"title",value:l,movie:d,addEntryToUpdate:s})},{title:"Year",dataIndex:"year",render:(l,d)=>e.jsx(j,{property:"year",value:l,movie:d,addEntryToUpdate:s})},y.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(l,d)=>e.jsx(F,{movie:d,itemsIds:l,copyToClipboard:m,addEntryToUpdate:s})},{title:"Count",dataIndex:"itemsIds",render:l=>D(l).filter(Boolean).length}],x=N({maxExpandedRows:1,expandedRowRender:l=>e.jsx(M,{movie:l,addEntryToUpdate:s}),rowExpandable:()=>i.isSuccess});return e.jsxs(I,{direction:"vertical",className:"my-4",children:[e.jsx(w,{onClick:u,children:"Get Sample"}),o&&e.jsx(y,{columns:p,rowKey:"id",dataSource:[t[o]],expandable:x,pagination:!1},String(o)),e.jsx(b,{})]})}function Je(){const t=z({tdrResourceName:"daily-movie-sets",firestoreDataCollectionName:"movieSets"});return e.jsx(T,{title:"Items",subtitle:"Movie Sets",children:e.jsxs(S,{hasSider:!0,children:[e.jsx(Q,{children:e.jsx(W,{...t})}),e.jsx(S.Content,{className:"content",children:e.jsx(L,{isLoading:t.isLoading,error:t.error,hasResponseData:!c.isEmpty(t.data),children:e.jsxs(I,{direction:"vertical",children:[e.jsx(te,{...t}),e.jsx(V,{...t})]})})})]})})}export{Je as ItemsMovieSets,Je as default};
