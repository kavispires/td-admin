import{r as t,O as K,Q as P,U as F,V as j,W as O,X as L}from"./index-7p9S7-5Q.js";import{l as x}from"./lodash-CXYs1tTD.js";import{r as B}from"./index-R29wutHV.js";import{a as _}from"./useBaseUrl-B1zVbX7A.js";import{u as M}from"./useMutation-DhmZZsJA.js";import{u as T}from"./useQueryParams-D3xkYlWL.js";const G=12,V=252,y=()=>x.padStart(String(x.random(1,V)),2,"0"),A=()=>x.random(1,G),W=()=>`td-d${A()}-${y()}`;function D(s,b){const[g,S]=t.useState(A()),[i,k]=t.useState(y()),[I,o]=t.useState(A()),[h,r]=t.useState(y()),a=`td-d${g}-${i}`,c=`td-d${I}-${h}`,[R,u]=t.useState(0),{queryParams:d}=T(),E=Number(d.get("cycle")??3),l=(s==null?void 0:s[a])??[],m=(s==null?void 0:s[c])??[],U=()=>{u(0),S(A()),k(y()),o(A()),r(y())},f=()=>{u(0),l.push(c),s[a]=B(l),m.push(a),s[c]=B(m),b(!0),S(I),k(h),o(A()),r(y())},N=()=>{R>=E?(u(0),U()):(u(q=>q+1),o(A()),r(y()))};return t.useEffect(()=>{a===c&&r(y())},[a,c]),{cardAId:a,cardA:l,cardBId:c,cardB:m,relate:f,unrelate:N,areRelated:l.includes(c),onRandomCards:U}}function ee(){const[s,b]=t.useState(!1),g=["data/imageCardsRelationships"],S=K(),{notification:i}=P.useApp(),[k,I]=t.useState({total:0,overdone:0,complete:0,single:0}),{data:o={},isLoading:h,isSuccess:r,isError:a,error:c,isFetched:R,isRefetching:u,refetch:d}=_({queryKey:g,queryFn:async()=>{const f=F(O,"data/imageCardsRelationships");return(await L(f)).data()??{}}}),{isPending:E,isError:l,isSuccess:m,mutate:U}=M({mutationKey:g,mutationFn:async()=>{const f=F(O,"data/imageCardsRelationships");return await j(f,o),o},onSuccess:()=>{i.success({message:"Saved",placement:"bottomLeft"}),S.refetchQueries({queryKey:g}),b(!1)}});return t.useEffect(()=>{if(!u&&R){const f=Object.keys(o).length;let N=0,q=0,e=0;Object.values(o).forEach(n=>{n.length>8&&(N+=1),n.length===1&&(e+=1),n.length>2&&(q+=1)}),I({total:f,overdone:N,complete:q,single:e})}},[R,u]),{data:o,isLoading:h,isSuccess:r,isError:a,error:c,hasData:r&&Object.keys(o).length>0,refetch:d,isSaving:E,isMutationError:l,isSaved:m,save:U,setDirty:b,isDirty:s,stats:k}}function se(s,b,g,S){const[i,k]=t.useState([]),[I,o]=t.useState([]),[h,r]=t.useState([]),[a,c]=t.useState(0),[R,u]=t.useState(!0),[d,E]=t.useState([]),l=e=>{o((e??i).map(n=>(s==null?void 0:s[n])??[]))},m=()=>{const e=[...d];let n=0;const p=h.length<2e3?h:[];let v=0;for(;v<400&&e.length<g;){const C=W(),$=s[C]??[],Q=S>0?$.length<S:!0,w=R?p.includes(C):!1;!e.includes(C)&&!w&&Q&&(e.push(C),n+=1),v+=1}k(e),r(C=>[...C,...e]),l(e),c(C=>C+n)};return t.useEffect(()=>{i.length===0&&m()},[i]),{cardIds:i,cards:I,selection:d,onSelect:e=>{E(n=>{const p=[...n],v=p.indexOf(e);return v>-1?p.splice(v,1):p.push(e),p})},relate:()=>{d.forEach(e=>{const n=s[e]??[];n.push(...d.filter(p=>p!==e)),s[e]=B(n)}),b(!0),E([]),l(),r([]),c(0)},nextSet:m,deselectAll:()=>{E([])},cycles:a,filters:{useCycles:R,toggleUseCycles:()=>{u(e=>!e)}}}}export{ee as a,se as b,D as u};
