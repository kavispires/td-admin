var U=i=>{throw TypeError(i)};var P=(i,e,s)=>e.has(i)||U("Cannot "+s);var u=(i,e,s)=>(P(i,e,"read from private field"),s?s.call(i):e.get(i)),v=(i,e,s)=>e.has(i)?U("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,s),m=(i,e,s,t)=>(P(i,e,"write to private field"),t?t.call(i,s):e.set(i,s),s),A=(i,e,s)=>(P(i,e,"access private method"),s);import{aP as J,aQ as q,aR as X,a0 as Y,r as R,aS as Z,j as $,a1 as ss,aT as es}from"./index-3wVxZuaG.js";import{Q as G,b as ts,d as rs,e as is,f as ns,g as os,s as _,h as K,w as as,i as us,l as z,a as cs}from"./useBaseUrl-DC_5F-uw.js";import{g as H}from"./useGetFirestoreDoc-DEMKnJVl.js";import{u as ds}from"./useTDResource-JJa_G7B-.js";import{g as hs}from"./constants-DbfgZwql.js";function V(i,e){const s=new Set(e);return i.filter(t=>!s.has(t))}function fs(i,e,s){const t=i.slice(0);return t[e]=s,t}var S,y,x,D,w,E,L,M,k,f,F,N,j,T,B,W,ls=(W=class extends J{constructor(e,s,t){super();v(this,f);v(this,S);v(this,y);v(this,x);v(this,D);v(this,w);v(this,E);v(this,L);v(this,M);v(this,k,[]);m(this,S,e),m(this,D,t),m(this,x,[]),m(this,w,[]),m(this,y,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&u(this,w).forEach(e=>{e.subscribe(s=>{A(this,f,T).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,u(this,w).forEach(e=>{e.destroy()})}setQueries(e,s){m(this,x,e),m(this,D,s),q.batch(()=>{const t=u(this,w),o=A(this,f,j).call(this,u(this,x));m(this,k,o),o.forEach(r=>r.observer.setOptions(r.defaultedQueryOptions));const n=o.map(r=>r.observer),a=n.map(r=>r.getCurrentResult()),c=n.some((r,g)=>r!==t[g]);t.length===n.length&&!c||(m(this,w,n),m(this,y,a),this.hasListeners()&&(V(t,n).forEach(r=>{r.destroy()}),V(n,t).forEach(r=>{r.subscribe(g=>{A(this,f,T).call(this,r,g)})}),A(this,f,B).call(this)))})}getCurrentResult(){return u(this,y)}getQueries(){return u(this,w).map(e=>e.getCurrentQuery())}getObservers(){return u(this,w)}getOptimisticResult(e,s){const t=A(this,f,j).call(this,e),o=t.map(n=>n.observer.getOptimisticResult(n.defaultedQueryOptions));return[o,n=>A(this,f,N).call(this,n??o,s),()=>A(this,f,F).call(this,o,t)]}},S=new WeakMap,y=new WeakMap,x=new WeakMap,D=new WeakMap,w=new WeakMap,E=new WeakMap,L=new WeakMap,M=new WeakMap,k=new WeakMap,f=new WeakSet,F=function(e,s){return s.map((t,o)=>{const n=e[o];return t.defaultedQueryOptions.notifyOnChangeProps?n:t.observer.trackResult(n,a=>{s.forEach(c=>{c.observer.trackProp(a)})})})},N=function(e,s){return s?((!u(this,E)||u(this,y)!==u(this,M)||s!==u(this,L))&&(m(this,L,s),m(this,M,u(this,y)),m(this,E,X(u(this,E),s(e)))),u(this,E)):e},j=function(e){const s=new Map(u(this,w).map(o=>[o.options.queryHash,o])),t=[];return e.forEach(o=>{const n=u(this,S).defaultQueryOptions(o),a=s.get(n.queryHash);a?t.push({defaultedQueryOptions:n,observer:a}):t.push({defaultedQueryOptions:n,observer:new G(u(this,S),n)})}),t},T=function(e,s){const t=u(this,w).indexOf(e);t!==-1&&(m(this,y,fs(u(this,y),t,s)),A(this,f,B).call(this))},B=function(){var e;if(this.hasListeners()){const s=u(this,E),t=A(this,f,F).call(this,u(this,y),u(this,k)),o=A(this,f,N).call(this,t,(e=u(this,D))==null?void 0:e.combine);s!==o&&q.batch(()=>{this.listeners.forEach(n=>{n(u(this,y))})})}},W);function ps({queries:i,...e},s){const t=Y(),o=ts(),n=rs(),a=R.useMemo(()=>i.map(l=>{const O=t.defaultQueryOptions(l);return O._optimisticResults=o?"isRestoring":"optimistic",O}),[i,t,o]);a.forEach(l=>{is(l),ns(l,n)}),os(n);const[c]=R.useState(()=>new ls(t,a,e)),[r,g,b]=c.getOptimisticResult(a,e.combine),d=!o&&e.subscribed!==!1;R.useSyncExternalStore(R.useCallback(l=>d?c.subscribe(q.batchCalls(l)):Z,[c,d]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),R.useEffect(()=>{c.setQueries(a,e)},[a,e,c]);const p=r.some((l,O)=>_(a[O],l))?r.flatMap((l,O)=>{const h=a[O];if(h){const I=new G(t,h);if(_(h,l))return K(h,I,n);as(l,o)&&K(h,I,n)}return[]}):[];if(p.length>0)throw Promise.all(p);const C=r.find((l,O)=>{const h=a[O];return h&&us({result:l,errorResetBoundary:n,throwOnError:h.throwOnError,query:t.getQueryCache().get(h.queryHash),suspense:h.suspense})});if(C!=null&&C.error)throw C.error;return g(b())}const ms=i=>i.map(s=>{let t="";for(let o=0,n=1;n<s.length;o+=2,n+=2)s[o+2]&&s[n+2]&&(t+=`M${s[o]},${s[n]} L${s[o+2]},${s[n+2]}`);return t}),Es=({drawing:i="",className:e="",width:s=250,height:t,strokeWidth:o="medium",viewBox:n="0 0 500 500"})=>{const a=JSON.parse(i),c=ms(a),r={small:3,medium:5,large:7}[o]??5;return $.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:n,overflow:"hidden",className:e,style:{width:`${s}px`,height:`${t||s}px`},children:[$.jsx("defs",{}),c.map((g,b)=>$.jsx("path",{d:g,fill:"none",stroke:"#000",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10"},`${i}-${b}`))]})};function gs(i,e){var g;const s={pt:"drawingsPT",en:"drawingsEN"},{notification:t}=ss.useApp(),o=cs({queryKey:["data","suffixCounts"],queryFn:H("data","suffixCounts"),enabled:i});R.useEffect(()=>{o.isSuccess&&es("Loaded data/suffixCounts")},[o.isSuccess]),R.useEffect(()=>{o.isError&&t.error({message:"Error loading data/suffixCounts",placement:"bottomLeft"})},[o.isError]);const n=s[e??"pt"],a=((g=o.data)==null?void 0:g[n])??0,c=`drawings${e==="pt"?"PT":"EN"}`,r=R.useMemo(()=>new Array(a).fill(0).map((b,d)=>({queryKey:["data",`${c}${d+1}`],queryFn:H("data",`${c}${d+1}`),enabled:i&&!!a,onSuccess:()=>{t.info({message:`Data Drawings ${c}${d+1} loaded`,placement:"bottomLeft"})}})),[a,c,i]);return ps({queries:r})}function bs(i){const s=i.split(/::|:;|;;/)[1],t=Number(s);return Number.isNaN(t)&&console.log("ðŸ”† Invalid createdAt",i,t),Number.isNaN(t)?16191612e5:t}function Qs(i,e){const s=gs(i,e),t=ds(`arte-ruim-drawings-${e}`,i),o=s.some(r=>r.isLoading),n=s.every(r=>r.isSuccess),a=R.useMemo(()=>{if(!n)return{};if(!t.isSuccess)return{};const r=t.data??{};return(s??[]).forEach(g=>{const b=g.data??{};Object.entries(b).forEach(([d,Q])=>{const p=Q.cardId??Q.id;if(p!=null&&p.includes("--"))return;if(Q.drawing.trim().length<10){console.log("ðŸ”† Empty drawing",p);return}const C=bs(d),l=Q.playerId??"unknown",h={id:[p,l,C].join(hs),drawing:Q.drawing,artistId:l,createdAt:C};r[p]===void 0?r[p]={id:p,text:Q.text,drawings:[h],updatedAt:h.createdAt}:r[p].drawings.some(I=>I.id===h.id)||(r[p].drawings.push(h),h.createdAt>r[p].updatedAt&&(r[p].updatedAt=h.createdAt))})}),r},[s,n,t.data,t.isSuccess]),c=R.useMemo(()=>Object.values(a).reduce((r,g)=>(g.drawings.forEach(b=>{const d=b.artistId;r[d]===void 0?r[d]={artistId:d,drawingsCount:1,firstDrawingAt:b.createdAt,lastDrawingAt:b.createdAt}:(r[d].drawingsCount+=1,b.createdAt<r[d].firstDrawingAt&&(r[d].firstDrawingAt=b.createdAt),b.createdAt>r[d].lastDrawingAt&&(r[d].lastDrawingAt=b.createdAt))}),r),{}),[a]);return{isLoading:o||t.isLoading,error:t.error,hasResponseData:!z.isEmpty(a),hasFirestoreData:s.some(r=>!z.isEmpty(r.data)),drawings:a,drawingsPerArtist:Object.values(c),dataUpdatedAt:t.dataUpdatedAt}}const Cs={"3PkJr":"Flaviane","3c4lY":"Kavis",BPTEL:"Maris","0vuXf":"Marcio",Bm6dr:"Livia",QrfLz:"Stephanie",AlRvI:"Unknown",pK3OY:"Unknown",VF9iG:"Zenaide",WWUvD:"Fernanda",aec7L:"Anonymous",Xsimf:"Carol",fV5ns:"Diego",qQo9N:"Laura",yVAl7:"Rodrigo",O2IQm:"Drica","24qec":"Mariana","5J1Al":"Mateus"};export{Cs as A,Es as C,ps as a,Qs as u};
