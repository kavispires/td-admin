import{m as w,n as be,o as X,p as B,q as je,K as pe,t as W,v as Re,w as Fe,x as Ce,y as De,z as _e,E as Ve,G as ze,H as Be,r as g,J as Le,M as ie,N as We,O as Ke,Q as V,S as Ge,U as He,V as Ue,W as qe,X as Je,Y as Qe,Z as Xe,$ as fe,a0 as Ye,a1 as xe,j as t,F as H,D as K,T as I,c as M,a2 as Ze,b as ee,B as Y,a3 as ce,i as et,a4 as tt,P as at,L as ge}from"./index-Mpn7fKLo.js";import{D as Ie}from"./DataLoadingWrapper-DJ85WKe8.js";import{F as nt}from"./FilterEntries-CscBbHYS.js";import{S as st}from"./SiderContent-CA_Mx0qK.js";import{D as lt}from"./DownloadButton-WLo36Aa7.js";import{a as it}from"./FirestoreConsoleLink-D6Uz_K5Q.js";import{S as rt}from"./SaveButton-GeS8HZ2o.js";import{u as ue}from"./useQueryParams-i-yD5Lix.js";import{u as re}from"./useTDResource-C47fB72g.js";import{l as Z,P as ot}from"./useBaseUrl-CX18PvAw.js";import{a as dt,w as oe}from"./index-D29QDRdy.js";import{v as G,s as te,a as ae,b as Se,S as $e,c as ve}from"./daily-teoria-de-conjuntos-C0bwGUct.js";import{R as ct}from"./ClusterOutlined-MTLOeyvE.js";import{R as ut}from"./TableOutlined-DINqxZUw.js";import{R as mt}from"./RobotOutlined-kCOAbXZg.js";import{c as le}from"./clsx-B-dksMZM.js";import{I as Te}from"./Item-Cz8Li8m1.js";import{R as q}from"./index-wSWHTulM.js";import{T as z}from"./index-Dkpz02iF.js";import{A as ht}from"./index-BXPUx5TJ.js";import{S as de}from"./index-p6w2fwio.js";import{T as J}from"./TransparentButton-B9EWthMs.js";import{S as D}from"./index-De3Jpewb.js";import{R as Ne}from"./index-CryMulQ9.js";import{u as we}from"./useTablePagination-CbaOeZxP.js";import{F as Ae}from"./Table-C2GnM8lx.js";import{u as pt}from"./useResourceFirestoreData-Bnb1ufbI.js";import"./index-0aqywvkc.js";import"./index-BAyL2y2L.js";import"./index-DGNTcQev.js";import"./index-C8_OtA8I.js";import"./useMutation-BmIwR3V_.js";import"./index-CRXwpxLQ.js";import"./moment-BYTvHWBW.js";import"./SaveOutlined-BE8lHBEG.js";import"./constants-Bvs7f2Uv.js";import"./useParsedHistory-jAyKRVRi.js";import"./throttleByAnimationFrame-kJTShJOk.js";import"./scrollTo-DFvfQX28.js";import"./Pagination-BTUVIioT.js";import"./useGetFirestoreDoc-r5ysmJHA.js";import"./useUpdateFirestoreDoc-BI-upCEr.js";var Pe=w.forwardRef(function(e,a){var r=e.prefixCls,l=e.forceRender,n=e.className,u=e.style,f=e.children,o=e.isActive,m=e.role,h=e.classNames,v=e.styles,c=w.useState(o||l),s=be(c,2),d=s[0],i=s[1];return w.useEffect(function(){(l||o)&&i(!0)},[l,o]),d?w.createElement("div",{ref:a,className:X("".concat(r,"-content"),B(B({},"".concat(r,"-content-active"),o),"".concat(r,"-content-inactive"),!o),n),style:u,role:m},w.createElement("div",{className:X("".concat(r,"-content-box"),h?.body),style:v?.body},f)):null});Pe.displayName="PanelContent";var ft=["showArrow","headerClass","isActive","onItemClick","forceRender","className","classNames","styles","prefixCls","collapsible","accordion","panelKey","extra","header","expandIcon","openMotion","destroyInactivePanel","children"],ke=w.forwardRef(function(e,a){var r=e.showArrow,l=r===void 0?!0:r,n=e.headerClass,u=e.isActive,f=e.onItemClick,o=e.forceRender,m=e.className,h=e.classNames,v=h===void 0?{}:h,c=e.styles,s=c===void 0?{}:c,d=e.prefixCls,i=e.collapsible,p=e.accordion,b=e.panelKey,C=e.extra,S=e.header,$=e.expandIcon,y=e.openMotion,A=e.destroyInactivePanel,T=e.children,O=je(e,ft),N=i==="disabled",P=C!=null&&typeof C!="boolean",k=B(B(B({onClick:function(){f?.(b)},onKeyDown:function(F){(F.key==="Enter"||F.keyCode===pe.ENTER||F.which===pe.ENTER)&&f?.(b)},role:p?"tab":"button"},"aria-expanded",u),"aria-disabled",N),"tabIndex",N?-1:0),x=typeof $=="function"?$(e):w.createElement("i",{className:"arrow"}),j=x&&w.createElement("div",W({className:"".concat(d,"-expand-icon")},["header","icon"].includes(i)?k:{}),x),_=X("".concat(d,"-item"),B(B({},"".concat(d,"-item-active"),u),"".concat(d,"-item-disabled"),N),m),se=X(n,"".concat(d,"-header"),B({},"".concat(d,"-collapsible-").concat(i),!!i),v.header),E=Re({className:se,style:s.header},["header","icon"].includes(i)?{}:k);return w.createElement("div",W({},O,{ref:a,className:_}),w.createElement("div",E,l&&j,w.createElement("span",W({className:"".concat(d,"-header-text")},i==="header"?k:{}),S),P&&w.createElement("div",{className:"".concat(d,"-extra")},C)),w.createElement(Fe,W({visible:u,leavedClassName:"".concat(d,"-content-hidden")},y,{forceRender:o,removeOnLeave:A}),function(R,F){var U=R.className,L=R.style;return w.createElement(Pe,{ref:F,prefixCls:d,className:U,classNames:v,style:L,styles:s,isActive:u,forceRender:o,role:p?"tabpanel":void 0},T)}))}),xt=["children","label","key","collapsible","onItemClick","destroyInactivePanel"],gt=function(a,r){var l=r.prefixCls,n=r.accordion,u=r.collapsible,f=r.destroyInactivePanel,o=r.onItemClick,m=r.activeKey,h=r.openMotion,v=r.expandIcon;return a.map(function(c,s){var d=c.children,i=c.label,p=c.key,b=c.collapsible,C=c.onItemClick,S=c.destroyInactivePanel,$=je(c,xt),y=String(p??s),A=b??u,T=S??f,O=function(k){A!=="disabled"&&(o(k),C?.(k))},N=!1;return n?N=m[0]===y:N=m.indexOf(y)>-1,w.createElement(ke,W({},$,{prefixCls:l,key:y,panelKey:y,isActive:N,accordion:n,openMotion:h,expandIcon:v,header:i,collapsible:A,onItemClick:O,destroyInactivePanel:T}),d)})},vt=function(a,r,l){if(!a)return null;var n=l.prefixCls,u=l.accordion,f=l.collapsible,o=l.destroyInactivePanel,m=l.onItemClick,h=l.activeKey,v=l.openMotion,c=l.expandIcon,s=a.key||String(r),d=a.props,i=d.header,p=d.headerClass,b=d.destroyInactivePanel,C=d.collapsible,S=d.onItemClick,$=!1;u?$=h[0]===s:$=h.indexOf(s)>-1;var y=C??f,A=function(N){y!=="disabled"&&(m(N),S?.(N))},T={key:s,panelKey:s,header:i,headerClass:p,isActive:$,prefixCls:n,destroyInactivePanel:b??o,openMotion:v,accordion:u,children:a.props.children,onItemClick:A,expandIcon:c,collapsible:y};return typeof a.type=="string"?a:(Object.keys(T).forEach(function(O){typeof T[O]>"u"&&delete T[O]}),w.cloneElement(a,T))};function yt(e,a,r){return Array.isArray(e)?gt(e,r):Ce(a).map(function(l,n){return vt(l,n,r)})}function bt(e){var a=e;if(!Array.isArray(a)){var r=ze(a);a=r==="number"||r==="string"?[a]:[]}return a.map(function(l){return String(l)})}var jt=w.forwardRef(function(e,a){var r=e.prefixCls,l=r===void 0?"rc-collapse":r,n=e.destroyInactivePanel,u=n===void 0?!1:n,f=e.style,o=e.accordion,m=e.className,h=e.children,v=e.collapsible,c=e.openMotion,s=e.expandIcon,d=e.activeKey,i=e.defaultActiveKey,p=e.onChange,b=e.items,C=X(l,m),S=De([],{value:d,onChange:function(P){return p?.(P)},defaultValue:i,postState:bt}),$=be(S,2),y=$[0],A=$[1],T=function(P){return A(function(){if(o)return y[0]===P?[]:[P];var k=y.indexOf(P),x=k>-1;return x?y.filter(function(j){return j!==P}):[].concat(Be(y),[P])})};_e(!h,"[rc-collapse] `children` will be removed in next major version. Please use `items` instead.");var O=yt(b,h,{prefixCls:l,accordion:o,openMotion:c,expandIcon:s,collapsible:v,destroyInactivePanel:u,onItemClick:T,activeKey:y});return w.createElement("div",W({ref:a,className:C,style:f,role:o?"tablist":void 0},Ve(e,{aria:!0,data:!0})),O)});const me=Object.assign(jt,{Panel:ke});me.Panel;const Ct=g.forwardRef((e,a)=>{const{getPrefixCls:r}=g.useContext(Le),{prefixCls:l,className:n,showArrow:u=!0}=e,f=r("collapse",l),o=ie({[`${f}-no-arrow`]:!u},n);return g.createElement(me.Panel,Object.assign({ref:a},e,{prefixCls:f,className:o}))}),It=e=>{const{componentCls:a,contentBg:r,padding:l,headerBg:n,headerPadding:u,collapseHeaderPaddingSM:f,collapseHeaderPaddingLG:o,collapsePanelBorderRadius:m,lineWidth:h,lineType:v,colorBorder:c,colorText:s,colorTextHeading:d,colorTextDisabled:i,fontSizeLG:p,lineHeight:b,lineHeightLG:C,marginSM:S,paddingSM:$,paddingLG:y,paddingXS:A,motionDurationSlow:T,fontSizeIcon:O,contentPadding:N,fontHeight:P,fontHeightLG:k}=e,x=`${V(h)} ${v} ${c}`;return{[a]:Object.assign(Object.assign({},He(e)),{backgroundColor:n,border:x,borderRadius:m,"&-rtl":{direction:"rtl"},[`& > ${a}-item`]:{borderBottom:x,"&:first-child":{[`
            &,
            & > ${a}-header`]:{borderRadius:`${V(m)} ${V(m)} 0 0`}},"&:last-child":{[`
            &,
            & > ${a}-header`]:{borderRadius:`0 0 ${V(m)} ${V(m)}`}},[`> ${a}-header`]:Object.assign(Object.assign({position:"relative",display:"flex",flexWrap:"nowrap",alignItems:"flex-start",padding:u,color:d,lineHeight:b,cursor:"pointer",transition:`all ${T}, visibility 0s`},Ue(e)),{[`> ${a}-header-text`]:{flex:"auto"},[`${a}-expand-icon`]:{height:P,display:"flex",alignItems:"center",paddingInlineEnd:S},[`${a}-arrow`]:Object.assign(Object.assign({},qe()),{fontSize:O,transition:`transform ${T}`,svg:{transition:`transform ${T}`}}),[`${a}-header-text`]:{marginInlineEnd:"auto"}}),[`${a}-collapsible-header`]:{cursor:"default",[`${a}-header-text`]:{flex:"none",cursor:"pointer"},[`${a}-expand-icon`]:{cursor:"pointer"}},[`${a}-collapsible-icon`]:{cursor:"unset",[`${a}-expand-icon`]:{cursor:"pointer"}}},[`${a}-content`]:{color:s,backgroundColor:r,borderTop:x,[`& > ${a}-content-box`]:{padding:N},"&-hidden":{display:"none"}},"&-small":{[`> ${a}-item`]:{[`> ${a}-header`]:{padding:f,paddingInlineStart:A,[`> ${a}-expand-icon`]:{marginInlineStart:e.calc($).sub(A).equal()}},[`> ${a}-content > ${a}-content-box`]:{padding:$}}},"&-large":{[`> ${a}-item`]:{fontSize:p,lineHeight:C,[`> ${a}-header`]:{padding:o,paddingInlineStart:l,[`> ${a}-expand-icon`]:{height:k,marginInlineStart:e.calc(y).sub(l).equal()}},[`> ${a}-content > ${a}-content-box`]:{padding:y}}},[`${a}-item:last-child`]:{borderBottom:0,[`> ${a}-content`]:{borderRadius:`0 0 ${V(m)} ${V(m)}`}},[`& ${a}-item-disabled > ${a}-header`]:{"\n          &,\n          & > .arrow\n        ":{color:i,cursor:"not-allowed"}},[`&${a}-icon-position-end`]:{[`& > ${a}-item`]:{[`> ${a}-header`]:{[`${a}-expand-icon`]:{order:1,paddingInlineEnd:0,paddingInlineStart:S}}}}})}},St=e=>{const{componentCls:a}=e,r=`> ${a}-item > ${a}-header ${a}-arrow`;return{[`${a}-rtl`]:{[r]:{transform:"rotate(180deg)"}}}},$t=e=>{const{componentCls:a,headerBg:r,borderlessContentPadding:l,borderlessContentBg:n,colorBorder:u}=e;return{[`${a}-borderless`]:{backgroundColor:r,border:0,[`> ${a}-item`]:{borderBottom:`1px solid ${u}`},[`
        > ${a}-item:last-child,
        > ${a}-item:last-child ${a}-header
      `]:{borderRadius:0},[`> ${a}-item:last-child`]:{borderBottom:0},[`> ${a}-item > ${a}-content`]:{backgroundColor:n,borderTop:0},[`> ${a}-item > ${a}-content > ${a}-content-box`]:{padding:l}}}},Tt=e=>{const{componentCls:a,paddingSM:r}=e;return{[`${a}-ghost`]:{backgroundColor:"transparent",border:0,[`> ${a}-item`]:{borderBottom:0,[`> ${a}-content`]:{backgroundColor:"transparent",border:0,[`> ${a}-content-box`]:{paddingBlock:r}}}}}},Nt=e=>({headerPadding:`${e.paddingSM}px ${e.padding}px`,headerBg:e.colorFillAlter,contentPadding:`${e.padding}px 16px`,contentBg:e.colorBgContainer,borderlessContentPadding:`${e.paddingXXS}px 16px ${e.padding}px`,borderlessContentBg:"transparent"}),wt=We("Collapse",e=>{const a=Ke(e,{collapseHeaderPaddingSM:`${V(e.paddingXS)} ${V(e.paddingSM)}`,collapseHeaderPaddingLG:`${V(e.padding)} ${V(e.paddingLG)}`,collapsePanelBorderRadius:e.borderRadiusLG});return[It(a),$t(a),Tt(a),St(a),Ge(a)]},Nt),At=g.forwardRef((e,a)=>{const{getPrefixCls:r,direction:l,expandIcon:n,className:u,style:f}=Je("collapse"),{prefixCls:o,className:m,rootClassName:h,style:v,bordered:c=!0,ghost:s,size:d,expandIconPosition:i="start",children:p,destroyInactivePanel:b,destroyOnHidden:C,expandIcon:S}=e,$=Qe(E=>{var R;return(R=d??E)!==null&&R!==void 0?R:"middle"}),y=r("collapse",o),A=r(),[T,O,N]=wt(y),P=g.useMemo(()=>i==="left"?"start":i==="right"?"end":i,[i]),k=S??n,x=g.useCallback((E={})=>{const R=typeof k=="function"?k(E):g.createElement(Xe,{rotate:E.isActive?l==="rtl"?-90:90:void 0,"aria-label":E.isActive?"expanded":"collapsed"});return fe(R,()=>{var F;return{className:ie((F=R.props)===null||F===void 0?void 0:F.className,`${y}-arrow`)}})},[k,y,l]),j=ie(`${y}-icon-position-${P}`,{[`${y}-borderless`]:!c,[`${y}-rtl`]:l==="rtl",[`${y}-ghost`]:!!s,[`${y}-${$}`]:$!=="middle"},u,m,h,O,N),_=g.useMemo(()=>Object.assign(Object.assign({},Ye(A)),{motionAppear:!1,leavedClassName:`${y}-content-hidden`}),[A,y]),se=g.useMemo(()=>p?Ce(p).map((E,R)=>{var F,U;const L=E.props;if(L?.disabled){const Me=(F=E.key)!==null&&F!==void 0?F:String(R),Ee=Object.assign(Object.assign({},xe(E.props,["disabled"])),{key:Me,collapsible:(U=L.collapsible)!==null&&U!==void 0?U:"disabled"});return fe(E,Ee)}return E}):null,[p]);return T(g.createElement(me,Object.assign({ref:a,openMotion:_},xe(e,["rootClassName"]),{expandIcon:x,prefixCls:y,className:j,style:Object.assign(Object.assign({},f),v),destroyInactivePanel:C??b}),se))}),Pt=Object.assign(At,{Panel:Ct});function kt({data:e,save:a,isDirty:r,isSaving:l,entriesToUpdate:n,hasFirestoreData:u}){const{addParams:f,queryParams:o}=ue(),m=re("daily-diagram-rules");return t.jsxs(st,{children:[t.jsxs(H,{gap:12,vertical:!0,children:[t.jsx(rt,{dirt:JSON.stringify(n),isDirty:r,isSaving:l,onSave:a}),t.jsx(lt,{block:!0,data:()=>Ot(e,m.data??{}),disabled:r,fileName:"daily-diagram-items.json",hasNewData:u})]}),t.jsx(K,{}),t.jsx(nt,{label:"Display",onChange:h=>f({display:h,page:1},{page:1}),options:[{title:"By Rule",icon:t.jsx(ct,{}),value:"rule"},{title:"By Thing",icon:t.jsx(ut,{}),value:"thing"},{title:"Simulator",icon:t.jsx(mt,{}),value:"simulator"}],value:o.get("display")??"rule"}),t.jsx(K,{}),t.jsx(I.Paragraph,{className:"my-6",type:"secondary",children:"v2.1.0"}),t.jsx(it,{disabled:r,docId:"diagramItems",path:"tdr",queryKey:["tdr","diagramItems"]})]})}function Ot(e,a){console.log("Preparing file for download...");const r=Z.cloneDeep(e),l=Date.now();return Object.values(r).forEach(n=>{const u=Object.values(a).filter(h=>h.updatedAt>n.updatedAt),f=u.map(()=>!1),o=u.filter(h=>h.method==="auto");o.length>0&&(console.log(`Performing ${o.length} auto updates for ${n.name}`),n.rules=n.rules.filter(h=>!o.map(v=>v.id).includes(h)),o.forEach(h=>{G[h.id](n.name)&&n.rules.push(h.id);const c=u.findIndex(s=>s.id===h.id);c!==-1&&(f[c]=!0)}));const m=u.filter(h=>h.method==="dependency");if(m.length>0){console.log(`Performing ${m.length} dependency updates for ${n.name}`),n.rules=n.rules.filter(s=>!m.map(d=>d.id).includes(s));const h=n.rules.includes("ddr-51-pt"),v=n.syllables??"",c=n.stressedSyllable;m.forEach(s=>{if(te[s.id]&&v){te[s.id](n.name,v,h)&&n.rules.push(s.id);const i=u.findIndex(p=>p.id===s.id);i!==-1&&(f[i]=!0)}if(ae[s.id]&&v&&c!==void 0){ae[s.id](n.name,v,c)&&n.rules.push(s.id);const i=u.findIndex(p=>p.id===s.id);i!==-1&&(f[i]=!0)}})}f.every(Boolean)&&(console.log(`All auto and dependency rules updated for ${n.name}`),n.updatedAt=l)}),dt(r)}function he({isModalOpen:e,onSaveThing:a,onCancel:r,thing:l,rules:n,width:u,itemAliases:f,subtitle:o,okButtonText:m,onGiveAnotherThing:h,allThings:v}){const c=g.useMemo(()=>Z.orderBy(Object.values(n),[x=>{const j=["manual","dependency","auto"].indexOf(x.method);return j===-1?Number.POSITIVE_INFINITY:j},x=>{const j=["grammar","comparison","order","count","contains","ends"].indexOf(x.type);return j===-1?Number.POSITIVE_INFINITY:j},x=>x.title.slice(0,7),x=>Number(x.id.split("-")[1])]),[n]),[s]=M.useForm(),d=M.useWatch([],s),i=!d||Object.values(d??{}).some(x=>x===void 0),p=M.useWatch("name",s);g.useEffect(()=>{if(!p||l.name&&l.syllables&&p===l.name)return;const x={syllables:Se(p),stressedSyllable:l.stressedSyllable??p.includes(" ")?-1:0};Object.keys(n).forEach(j=>{G[j]?x[j]=G[j](p):x[j]=l.rules.length>0?l.rules.includes(j):void 0}),s.setFieldsValue(x)},[p]);const b=M.useWatch("syllables",s),C=s.getFieldValue("ddr-51-pt");g.useEffect(()=>{C&&(s.setFieldsValue({stressedSyllable:void 0}),s.setFieldsValue({"ddr-43-pt":!1}),s.setFieldsValue({"ddr-44-pt":!1}),s.setFieldsValue({"ddr-45-pt":!1}),s.setFieldsValue({"ddr-46-pt":!1})),C===void 0&&s.setFieldsValue({"ddr-51-pt":!1})},[C]),g.useEffect(()=>{if(b){const x=Object.keys(n).reduce((j,_)=>(te[_]&&(j[_]=te[_](p,b,C)),j),{});s.setFieldsValue({...x,stressedSyllable:b===l.syllables?l.stressedSyllable:l.stressedSyllable??p.includes(" ")?-1:void 0})}},[p,b,C]);const S=M.useWatch("stressedSyllable",s);g.useEffect(()=>{if(!C&&S!==void 0){const x=Object.keys(n).reduce((j,_)=>(ae[_]&&(j[_]=ae[_](p,b,S)),j),{});s.setFieldsValue({...x})}},[S]);const $=s.getFieldValue("ddr-1-pt"),y=s.getFieldValue("ddr-2-pt"),A=s.getFieldValue("ddr-50-pt");g.useEffect(()=>{$===!0&&(s.setFieldsValue({"ddr-2-pt":!1}),s.setFieldsValue({"ddr-50-pt":!1}))},[$]),g.useEffect(()=>{y===!0&&(s.setFieldsValue({"ddr-1-pt":!1}),s.setFieldsValue({"ddr-50-pt":!1}))},[y]),g.useEffect(()=>{A===!0&&(s.setFieldsValue({"ddr-1-pt":!1}),s.setFieldsValue({"ddr-2-pt":!1}))},[A]);const T=s.getFieldValue("ddr-3-pt");g.useEffect(()=>{T===!0&&s.setFieldsValue({"ddr-4-pt":!1})},[T]);const O=s.getFieldValue("ddr-4-pt");g.useEffect(()=>{O===!0&&s.setFieldsValue({"ddr-3-pt":!1})},[O]),g.useEffect(()=>{p?.includes("-")&&s.setFieldsValue({"ddr-5-pt":!0})},[p]);const N=x=>{const j=Et(x);a(j)},P=g.useMemo(()=>(b??"").split($e),[b]),k=g.useMemo(()=>Object.values(v).filter(x=>x.name===l.name&&x.itemId!==l.itemId),[l,v]);return t.jsx(Ze,{maskClosable:!1,okButtonProps:{disabled:i,htmlType:"submit",size:"large"},okText:m??"Add Item",onCancel:r,onOk:s.submit,open:e,title:t.jsxs(t.Fragment,{children:["Edit ",l.name," ",o&&t.jsx("small",{children:o})]}),width:u,children:t.jsxs(M,{autoComplete:"off",form:s,initialValues:Mt(l,n),labelWrap:!0,layout:"vertical",name:`new-item-${l.itemId}`,onFinish:N,size:"small",children:[t.jsxs("div",{className:"diagram-container",children:[t.jsxs("div",{children:[t.jsxs(H,{gap:6,children:[t.jsx(Te,{itemId:l.itemId,width:50}),t.jsx(M.Item,{label:"Id",name:"itemId",children:t.jsx(ee,{readOnly:!0})})]}),t.jsx(M.Item,{label:"Updated At",name:"updatedAt",children:t.jsx(ee,{readOnly:!0})})]}),t.jsx(M.Item,{label:"Name",name:"name",children:t.jsx(ee,{})}),t.jsx(M.Item,{label:"Syllables",name:"syllables",children:t.jsx(ee,{})}),t.jsx(M.Item,{label:"Stressed Syllable",name:"stressedSyllable",children:t.jsx(q.Group,{buttonStyle:"solid",optionType:"button",children:P.map((x,j)=>t.jsx(q,{value:P.length-j-1,children:x},j))})}),t.jsxs("div",{children:[f&&t.jsxs(t.Fragment,{children:[t.jsx(I.Text,{children:"Options:"})," ",t.jsx(I.Text,{type:"secondary",children:f?.join(", ")})]}),k.length>0&&t.jsxs("div",{children:[t.jsx(I.Text,{type:"danger",children:"⚠️ Warning: There are other items with the same name:"}),t.jsx("div",{children:k.map(x=>t.jsx(z,{children:x.itemId},x.itemId))})]})]}),(f||h)&&t.jsx("div",{children:h&&t.jsx(Y,{className:"mt-2",onClick:h,size:"large",type:"dashed",children:"Give me another thing"})}),t.jsx("div",{children:t.jsx(ht,{offsetTop:50,children:t.jsx(H,{align:"center",justify:"center",children:t.jsx(Y,{disabled:i,htmlType:"submit",size:"large",type:"primary",children:m??"Add Item"})})})})]}),t.jsx("div",{className:"diagram-container",children:c.map(x=>x.method==="auto"&&G[x.id]?t.jsx(M.Item,{className:le(l.updatedAt<x.updatedAt&&"diagram-container__outdated-rule"),label:x.title,name:x.id,valuePropName:"checked",children:t.jsx(de,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},x.id):x.method==="dependency"?t.jsx(M.Item,{className:le(l.updatedAt<x.updatedAt&&"diagram-container__outdated-rule"),label:x.title,name:x.id,valuePropName:"checked",children:t.jsx(de,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},x.id):t.jsx(M.Item,{className:le(l.updatedAt<x.updatedAt&&"diagram-container__outdated-rule"),label:x.title,name:x.id,children:t.jsxs(q.Group,{buttonStyle:"solid",optionType:"button",children:[t.jsx(q,{value:!0,children:"✅"}),t.jsx(q,{value:!1,children:"❌"})]})},x.id))})]})})}const Mt=(e,a)=>{let r=!1;return{name:e.name,itemId:e.itemId,syllables:e.syllables??Se(e.name),stressedSyllable:e.stressedSyllable??0,...Object.keys(a).reduce((l,n)=>{if(e.updatedAt<a[n].updatedAt)if(G[n]){const u=G[n](e.name);u&&e.rules.includes(n)&&(r=!0),l[n]=u}else l[n]=void 0;else l[n]=e.rules.includes(n);return l},{}),updatedAt:r?Date.now():e.updatedAt}},Et=e=>{const{itemId:a,name:r,syllables:l,stressedSyllable:n,...u}=e;return{itemId:a,name:r,updatedAt:Date.now(),syllables:l,stressedSyllable:n,rules:Object.keys(u).filter(f=>u[f]===!0)}};function Q({itemId:e,name:a,width:r=50}){return t.jsxs(H,{align:"center",vertical:!0,children:[t.jsx(Te,{itemId:e,width:r}),t.jsx(I.Text,{code:!0,children:a},e)]})}function ne({thing:e,width:a=50,onActivateThing:r}){return t.jsx(J,{onClick:()=>r(e),children:t.jsx(Q,{itemId:e.itemId,name:e.name,width:a})})}function Rt({game:e}){const[a]=g.useState([{id:e.rule1.thing.id,name:e.rule1.thing.name,rule:1}]),[r]=g.useState([{id:e.rule2.thing.id,name:e.rule2.thing.name,rule:2}]),[l]=g.useState([{id:e.intersectingThing.id,name:e.intersectingThing.name,rule:0}]),[n]=g.useState(e.things.slice(0,4)),[u,f]=g.useState(e.things[0]);return t.jsxs(D,{align:"center",direction:"vertical",children:[t.jsx(I.Title,{level:4,children:"Game Sample"}),t.jsxs(I.Title,{level:5,children:['"',e.title,'"']}),t.jsx(Ne,{count:e.level,disabled:!0,value:e.level}),t.jsx(I.Paragraph,{style:{maxWidth:"500px"},children:"O círculo amarelo tem uma regra gramatical secreta e o circulo vermelho tem outra regra gramatical secreta. O quadrado do meio representa a interseção entre a regra amarela e a regra vermelha."}),t.jsx(D,{children:t.jsx(Ft,{intersectionChildren:t.jsx(J,{style:{width:"100%",height:"100%"},children:l.map((o,m,h)=>t.jsx(Q,{itemId:o.id,name:o.name,width:m===h.length-1?80:60},o.id))}),leftCircleChildren:t.jsx(J,{style:{width:"100%",height:"100%"},children:a.map((o,m,h)=>t.jsx(Q,{itemId:o.id,name:o.name,width:m===h.length-1?80:60},o.id))}),rightCircleChildren:t.jsx(J,{style:{width:"100%",height:"100%"},children:r.map((o,m,h)=>t.jsx(Q,{itemId:o.id,name:o.name,width:m===h.length-1?80:60},o.id))}),width:600})}),t.jsx(I.Text,{children:"Coloque os objetos nos círculos corretos:"}),t.jsx(D,{className:"space--center",children:n.map(o=>t.jsx(J,{onClick:()=>f(o),style:o.id===u?.id?{outline:"3px solid hotPink"}:{},children:t.jsx(Q,{itemId:o.id,name:o.name},o.id)},o.id))}),t.jsx(Pt,{items:[{key:"1",label:"Resposta",children:t.jsxs(D,{direction:"vertical",children:[t.jsx(I.Text,{strong:!0,children:"Regra Amarela"}),t.jsx("ul",{children:t.jsx("li",{children:t.jsx(I.Text,{children:e.rule1.text})})}),t.jsx(I.Text,{strong:!0,children:"Regra Vermelha"}),t.jsx("ul",{children:t.jsx("li",{children:t.jsx(I.Text,{children:e.rule2.text})})})]})}]}),t.jsx("div",{style:{height:"200px"}})]})}function Ft({leftCircleChildren:e,rightCircleChildren:a,intersectionChildren:r,...l}){return t.jsxs("svg",{viewBox:"0 0 760 500",xmlns:"http://www.w3.org/2000/svg",...l,children:[t.jsx("path",{d:"M252.78 3.5c-136.42 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.59-247-247-247zm.99 483.07C123.39 486.57 17.7 380.88 17.7 250.5S123.39 14.43 253.77 14.43 489.84 120.12 489.84 250.5 384.15 486.57 253.77 486.57z",fill:"#fbb03b",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),t.jsx("path",{d:"M508.22 3.5c-136.41 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.58-247-247-247zm.99 483.07c-130.38 0-236.07-105.69-236.07-236.07S378.84 14.43 509.22 14.43 745.29 120.12 745.29 250.5 639.6 486.57 509.22 486.57z",fill:"#f15a24",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),t.jsx("path",{d:"M487.34 250.5c0-62.39-24.29-121.04-68.41-165.16a235.9 235.9 0 00-37.43-30.47 235.35 235.35 0 00-37.43 30.47c-44.12 44.11-68.41 102.77-68.41 165.16s24.29 121.04 68.41 165.16a235.9 235.9 0 0037.43 30.47 235.35 235.35 0 0037.43-30.47c44.12-44.11 68.41-102.77 68.41-165.16z",fill:"#535353"}),t.jsx("path",{d:"M258.72 250.5c0-66.64 25.95-129.3 73.08-176.42a253.125 253.125 0 0134.1-28.57c-33.98-18.65-72.29-28.57-112.13-28.57-62.39 0-121.04 24.29-165.16 68.41C44.5 129.46 20.2 188.11 20.2 250.5s24.29 121.04 68.41 165.16c44.11 44.12 102.77 68.41 165.16 68.41 39.84 0 78.15-9.92 112.13-28.57a252.507 252.507 0 01-34.1-28.57c-47.12-47.12-73.08-109.78-73.08-176.42zM674.37 85.34C630.25 41.22 571.6 16.93 509.21 16.93c-40.27 0-78.98 10.14-113.24 29.18 11.74 8.26 22.86 17.6 33.22 27.96 47.12 47.12 73.08 109.78 73.08 176.42s-25.95 129.3-73.08 176.42a252.312 252.312 0 01-33.22 27.96c34.25 19.04 72.96 29.18 113.24 29.18 62.39 0 121.04-24.29 165.16-68.41 44.12-44.11 68.41-102.77 68.41-165.16s-24.29-121.04-68.41-165.16z",fill:"#535353"}),t.jsx("foreignObject",{height:"450",width:"250",x:"30",y:"25",children:t.jsx("div",{className:"venn-diagram__circle-content-left",children:e})}),t.jsx("foreignObject",{height:"450",width:"250",x:"480",y:"25",children:t.jsx("div",{className:"venn-diagram__circle-content-right",children:a})}),t.jsx("foreignObject",{height:"370",width:"182",x:"290",y:"65",children:t.jsx("div",{className:"venn-diagram__circle-content-intersection",children:r})})]})}function Dt({things:e,rules:a}){const[r]=ce(),[l,n]=g.useState(null),u=()=>{n(Object.values(ve(1,{latestDate:"2023/01/01",latestNumber:0,used:[]},a,e))[0])},f=()=>{let o=null;try{o=ve(25,{latestDate:"2023/01/01",latestNumber:0,used:[]},a,e),console.log(o)}catch(m){console.error(m)}};return t.jsxs(D,{direction:"vertical",ref:r,children:[t.jsx(I.Title,{level:5,children:"Game Simulator"}),t.jsx(Y,{onClick:u,size:"large",children:"Simulate"}),t.jsx(Y,{onClick:f,size:"large",children:"Generate Demos (log)"}),l&&t.jsx(Rt,{game:l},JSON.stringify(l))]})}function _t({children:e,things:a,rules:r,addEntryToUpdate:l}){const n=g.useMemo(()=>Object.values(a).filter(m=>{if(!m.syllables)return!0;if(m.syllables.split($e).join("")!==m.name.replace(/\s/g,""))return console.log("❗️ Name and syllables do not match",m.name,m.syllables),!0;const h=Object.values(r).filter(c=>c.updatedAt>m.updatedAt);return h.filter(c=>c.method==="manual").length>0&&console.log("❗️ Thing has auto updates that will be performed automatically upon downloading the JSON"),h.some(c=>c.method==="manual")}),[a,r]),[u,f]=g.useState(null);g.useEffect(()=>{const m=async h=>{console.log("Found things that need to update..."),f(null),await oe(250),n.length>0&&f(n[0])};console.count("Checking for things that need to update..."),n.length>0&&m(n[0])},[n]);const o=m=>{l(m.itemId,m)};return t.jsxs(t.Fragment,{children:[u&&t.jsx(he,{allThings:a,isModalOpen:u!==null,okButtonText:"Update",onCancel:()=>f(null),onSaveThing:o,rules:r,subtitle:`(${n.length} left to update)`,thing:u,width:"90vw"}),e]})}function Oe({addEntryToUpdate:e,availableThings:a,rules:r,width:l,allThings:n}){const{notification:u}=et.useApp(),[f,o]=g.useState(null),[m,h]=g.useState({}),v=()=>{const i=Z.sample(a.filter(p=>!m[p.id]));i?(h(p=>({...p,[i.id]:!0})),o({itemId:i.id,name:Vt(i),updatedAt:Date.now(),syllables:"",stressedSyllable:0,rules:[]})):o(null)},c=g.useMemo(()=>{if(!f)return[];const i=a.find(p=>p.id===f.itemId);return[i?.name.pt,...i?.aliasesPt??[]].filter(Boolean)},[f,a]),s=async i=>{f&&((!i.name||!i.itemId)&&u.error({message:"Name and Item ID are required"}),e(i.itemId,i),console.log("COMPLETED SAVE"),o(null),await oe(250),v())},d=async()=>{o(null),await oe(100),v()};return t.jsxs(t.Fragment,{children:[t.jsx(Y,{onClick:v,size:"large",children:"Classify New Item"}),!!f&&t.jsx(he,{allThings:n,isModalOpen:f!==null,itemAliases:c,onCancel:()=>o(null),onGiveAnotherThing:d,onSaveThing:s,rules:r,thing:f,width:l*.9})]})}const Vt=e=>e.name.pt.split(" ").length===1?e.name.pt:e.aliasesPt?e.aliasesPt.find(a=>a.split(" ").length===1)??e.name.pt:e.name.pt;function zt({things:e,addEntryToUpdate:a,availableThings:r,rules:l,setActiveThing:n}){const[u,{width:f}]=ce(),o=g.useMemo(()=>Object.values(e),[e]),m=we({total:o.length,showQuickJumper:!0}),h=[{title:"ItemId",dataIndex:"itemId",key:"itemId",sorter:(c,s)=>Number(c.itemId)-Number(s.itemId),render:c=>t.jsx(z,{children:c})},{title:"Name",dataIndex:"name",key:"name",sorter:(c,s)=>c.name.localeCompare(s.name),render:c=>t.jsx(I.Text,{children:c})},{title:"Sprite",dataIndex:"itemId",key:"sprite",render:c=>t.jsx(ne,{onActivateThing:n,thing:e[c]},`i-${c}`)},{title:"Rules",dataIndex:"rules",key:"rules",render:(c,s)=>t.jsx(D,{wrap:!0,children:c.map(d=>t.jsx(tt,{title:l[d].title,children:t.jsx(z,{color:l[d].updatedAt>s.updatedAt?"red":void 0,children:d})},d))})},{title:"Count",dataIndex:"rules",key:"count",sorter:(c,s)=>c.rules.length-s.rules.length,render:c=>c.length}],v=g.useMemo(()=>{const c={};return Object.values(e).forEach(s=>{c[s.name]||(c[s.name]=[]),c[s.name].push(s.itemId)}),Object.values(c).filter(s=>s.length>1)},[e]);return t.jsxs(D,{direction:"vertical",ref:u,children:[t.jsxs(I.Title,{level:5,children:["Rules By Items ",t.jsx(K,{type:"vertical"})," Added: ",t.jsx(z,{children:Object.keys(e).length})," Available to add ",t.jsx(z,{children:r.length})]}),t.jsx(Oe,{addEntryToUpdate:a,allThings:e,availableThings:r,rules:l,width:f}),t.jsx(K,{}),t.jsx(Ae,{columns:h,dataSource:o,pagination:m,rowKey:"itemId"}),t.jsx(K,{}),t.jsx(I.Title,{level:5,children:"Duplicated Things"}),t.jsxs(D,{wrap:!0,children:[v.length===0&&t.jsx(I.Text,{children:"No duplicated things"}),v.map(c=>t.jsxs(H,{align:"center",children:[t.jsx(z,{color:"red",children:c.length}),c.map(s=>t.jsx(ne,{onActivateThing:n,thing:e[s]},`i-${s}`))]},c[0]))]})]})}function Bt({things:e,addEntryToUpdate:a,availableThings:r,rules:l,thingsByRules:n,setActiveThing:u,containerWidth:f}){const{is:o,addParam:m}=ue(),h=g.useMemo(()=>Object.values(l).map(d=>({...d,thingsCount:n[d.id].length})),[l,n]),v=we({total:h.length,showQuickJumper:!0}),c=g.useMemo(()=>{const d=Object.values(n).map(i=>i.length);return{maxThings:Math.max(...d),minThings:Math.min(...d),averageThings:Math.round(Object.values(n).reduce((i,p)=>i+p.length,0)/Object.keys(n).length)}},[n]),s=[{title:"Id",dataIndex:"id",key:"id",sorter:(d,i)=>Number(d.id.split("-")[1])-Number(i.id.split("-")[1]),render:d=>t.jsx(I.Text,{children:d})},{title:"Rule",dataIndex:"title",key:"title",sorter:(d,i)=>d.title.localeCompare(i.title),render:d=>t.jsx(I.Text,{children:d})},{title:"Type",dataIndex:"type",key:"type",sorter:(d,i)=>d.type.localeCompare(i.type)},{title:"Method",dataIndex:"method",key:"method",sorter:(d,i)=>d.method.localeCompare(i.method)},{title:"Things",dataIndex:"thingsCount",key:"thingsCount",render:(d,i)=>t.jsxs(D,{size:"small",children:[t.jsx(z,{children:d}),o("showThings")?t.jsxs(D,{size:"small",wrap:!0,children:[n[i.id].slice(0,20).map(p=>t.jsx(ne,{onActivateThing:u,thing:e[p]},`${i.id}-${p}`)),n[i.id].length>20&&t.jsxs(I.Text,{children:["+",d-20," more"]})]}):t.jsxs(D,{size:"small",wrap:!0,children:[n[i.id].slice(0,5).map(p=>t.jsx(ne,{onActivateThing:u,thing:e[p]},`${i.id}-${p}`)),n[i.id].length>5&&t.jsxs(I.Text,{children:["+",d-5," more"]})]})]}),sorter:(d,i)=>d.thingsCount-i.thingsCount},{title:"Level",dataIndex:"level",key:"level",sorter:(d,i)=>d.level-i.level,render:d=>t.jsx(Ne,{count:3,disabled:!0,value:d})}];return t.jsxs(D,{direction:"vertical",children:[t.jsxs(I.Title,{level:4,children:["Things By Rule (Added: ",Object.keys(e).length," | ",r.length,")"," "]}),t.jsxs(D,{split:t.jsx(K,{type:"vertical"}),wrap:!0,children:[t.jsx(Oe,{addEntryToUpdate:a,allThings:e,availableThings:r,rules:l,width:f}),t.jsxs(I.Text,{strong:!0,children:["Average Things: ",t.jsx(z,{children:c.averageThings})]}),t.jsxs(I.Text,{strong:!0,children:["Max Things: ",t.jsx(z,{children:c.maxThings})]}),t.jsxs(I.Text,{strong:!0,children:["Min Things: ",t.jsx(z,{children:c.minThings})]}),t.jsx(de,{checked:o("showThings"),checkedChildren:"Hide things",onChange:d=>m("showThings",d),unCheckedChildren:"Show things"})]}),t.jsx(Ae,{columns:s,dataSource:h,pagination:v})]})}const ye=e=>{const a=e.filter(r=>r.split(" ").length===1);return a.length>0?a[0]:""};function Lt({data:e,addEntryToUpdate:a}){const[r,{width:l}]=ce(),n=re("items"),u=re("daily-diagram-rules"),f=g.useMemo(()=>Object.values(n.data??{}).filter(i=>{if(e&&e[i.id]!==void 0||i.nsfw)return!1;const p=i.name.pt.split(" ").length===1;return!!(i.decks?.includes("thing")||i.decks?.includes("alien")&&p||i.decks?.includes("manufactured")&&p||i.decks?.includes("alien")&&i.aliasesPt&&ye(i.aliasesPt)||i.decks?.includes("manufactured")&&i.aliasesPt&&ye(i.aliasesPt)||i.decks?.includes("meta")&&p)}),[e,n.data]),o=g.useMemo(()=>u.data??{},[u.data]),m=g.useMemo(()=>{const i=Object.values(o).reduce((p,b)=>(p[b.id]=[],p),{});return Z.orderBy(Object.values(e),["updatedAt"],["desc"]).forEach(p=>{p.rules.forEach(b=>{i[b].push(p.itemId)})}),i},[e,o]),{is:h,queryParams:v}=ue(),[c,s]=g.useState(null);if(n.isLoading||u.isLoading)return t.jsx(I.Text,{children:"Loading..."});const d=i=>{a(i.itemId,i)};return t.jsx(Ie,{hasResponseData:n.hasResponseData||u.hasResponseData,isLoading:n.isLoading||u.isLoading,children:t.jsx("div",{ref:r,children:t.jsxs(_t,{addEntryToUpdate:a,rules:o,things:e,children:[c&&t.jsx(he,{allThings:e,isModalOpen:c!==null,okButtonText:"Update",onCancel:()=>s(null),onSaveThing:i=>{d(i),s(null)},rules:o,thing:c,width:l}),(h("display","rule")||!v.has("display"))&&t.jsx(Bt,{addEntryToUpdate:a,availableThings:f,containerWidth:l,rules:o,setActiveThing:s,things:e,thingsByRules:m}),h("display","thing")&&t.jsx(zt,{addEntryToUpdate:a,availableThings:f,rules:o,setActiveThing:s,things:e,thingsByRules:m}),h("display","simulator")&&t.jsx(Dt,{addEntryToUpdate:a,availableThings:f,rules:o,things:e})]})})})}function ka(){const e=pt({tdrResourceName:"daily-diagram-items",firestoreDataCollectionName:"diagramItems",serialize:!0});return t.jsx(at,{subtitle:"Diagram Sets",title:"Items",children:t.jsxs(ge,{hasSider:!0,children:[t.jsx(ot,{children:t.jsx(kt,{...e})}),t.jsx(ge.Content,{className:"content",children:t.jsx(Ie,{error:e.error,hasResponseData:!Z.isEmpty(e.data),isLoading:e.isLoading||e.isSaving,children:t.jsx(H,{gap:24,vertical:!0,children:t.jsx(Lt,{...e})})})})]})})}export{ka as ItemsDiagramSets,ka as default};
