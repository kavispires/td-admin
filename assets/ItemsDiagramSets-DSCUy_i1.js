import{j as e,F as C,D as O,T as g,r as f,c as T,M as me,b as P,B as V,m as L,S,n as G,i as he,o as pe,P as xe,L as ee}from"./index-CTf-mCqX.js";import{D as le}from"./DataLoadingWrapper-gOz-iekJ.js";import{F as fe}from"./FilterEntries-C6mDosJ4.js";import{S as je}from"./SiderContent-BNiATzc9.js";import{D as ge}from"./DownloadButton-C5F2g6EI.js";import{a as ye}from"./FirestoreConsoleLink-BVUaD7iD.js";import{S as be}from"./SaveButton-7yucFeRc.js";import{u as U}from"./useQueryParams-yhBqKdrw.js";import{u as _}from"./useTDResource-B7EIjaJI.js";import{l as M,P as ve}from"./useBaseUrl-D2YOm4WP.js";import{a as Te,w as $}from"./index-B1cA-3FD.js";import{v as F,s as E,a as W,b as ae,S as ne,c as te}from"./daily-teoria-de-conjuntos-C-giDvWQ.js";import{R as Se}from"./ClusterOutlined-F3ffwGBa.js";import{R as Ie}from"./TableOutlined-DDlzH949.js";import{R as we}from"./RobotOutlined-6MVUPtGQ.js";import{I as ie}from"./Item-Dsp7t-q7.js";import{R as N}from"./index-DwUSrJnX.js";import{T as k}from"./index-BL7SeXuZ.js";import{A as ke}from"./index-zpkUy0oe.js";import{S as B}from"./index-DfMWjrZa.js";import{T as D}from"./TransparentButton-B2cQWw0k.js";import{R as re}from"./index-Bybt_HrC.js";import{C as Ae}from"./Collapse-Bedy4-7s.js";import{u as de}from"./useTablePagination-DP41t9uK.js";import{F as oe}from"./Table-BxtTVYUo.js";import{C as Ce}from"./CopyToClipboardButton-CphwfYkg.js";import{u as Oe}from"./useResourceFirestoreData-fnfl5kas.js";import"./index-DFmb7Kiu.js";import"./useId-Cj2VzGUM.js";import"./index-C920Py66.js";import"./PlusOutlined-Dk0Fv5SP.js";import"./index-bNYZ7r0n.js";import"./index-Dodd8xBe.js";import"./Dropdown-BGUDzd0a.js";import"./useMutation-NSzs5tB7.js";import"./index-BA6hSl06.js";import"./moment-B-YVwB4U.js";import"./SaveOutlined-vh_oimCQ.js";import"./constants-D2J5TbS7.js";import"./useParsedHistory-CYM0Kk5f.js";import"./warnings-DF2QAROD.js";import"./throttleByAnimationFrame-BMmyStw2.js";import"./scrollTo-YauXU52C.js";import"./Pagination-BSJTbaOJ.js";import"./useCopyToClipboardFunction-DmnIfl-E.js";import"./useGetFirestoreDoc-CKXhz1bK.js";import"./useUpdateFirestoreDoc-CvnIsjS5.js";function Fe({data:t,save:c,isDirty:m,isSaving:i,entriesToUpdate:s,hasFirestoreData:x}){const{addParams:h,queryParams:d}=U(),p=_("daily-diagram-rules");return e.jsxs(je,{children:[e.jsxs(C,{gap:12,vertical:!0,children:[e.jsx(be,{dirt:JSON.stringify(s),isDirty:m,isSaving:i,onSave:c}),e.jsx(ge,{block:!0,data:()=>Ne(t,p.data??{}),disabled:m,fileName:"daily-diagram-items.json",hasNewData:x})]}),e.jsx(O,{}),e.jsx(fe,{label:"Display",onChange:j=>h({display:j,page:1},{page:1}),options:[{title:"By Rule",icon:e.jsx(Se,{}),value:"rule"},{title:"By Thing",icon:e.jsx(Ie,{}),value:"thing"},{title:"Simulator",icon:e.jsx(we,{}),value:"simulator"}],value:d.get("display")??"rule"}),e.jsx(O,{}),e.jsx(g.Paragraph,{className:"my-6",type:"secondary",children:"v2.1.0"}),e.jsx(ye,{disabled:m,docId:"diagramItems",path:"tdr",queryKey:["tdr","diagramItems"]})]})}function Ne(t,c){console.log("Preparing file for download...");const m=M.cloneDeep(t),i=Date.now();return Object.values(m).forEach(s=>{const x=Object.values(c).filter(n=>n.updatedAt>s.updatedAt),h=x.map(()=>!1),d=[...s.rules];let p=!1;const j=Object.values(c).filter(n=>n.method==="auto");if(j.length>0){console.log(`Performing ${j.length} auto updates for ${s.name}`);const n=j.map(l=>l.id);s.rules=s.rules.filter(l=>!n.includes(l)),j.forEach(l=>{F[l.id](s.name)&&s.rules.push(l.id);const a=x.findIndex(r=>r.id===l.id);a!==-1&&(h[a]=!0)})}const b=Object.values(c).filter(n=>n.method==="dependency");if(b.length>0){console.log(`Performing ${b.length} dependency updates for ${s.name}`);const n=b.map(r=>r.id);s.rules=s.rules.filter(r=>!n.includes(r));const l=s.rules.includes("ddr-51-pt"),o=s.syllables??"",a=s.stressedSyllable;b.forEach(r=>{if(E[r.id]&&o){E[r.id](s.name,o,l)?s.rules.push(r.id):s.rules=s.rules.filter(w=>w!==r.id);const I=x.findIndex(w=>w.id===r.id);I!==-1&&(h[I]=!0)}if(W[r.id]&&o&&a!==void 0){W[r.id](s.name,o,a)?s.rules.push(r.id):s.rules=s.rules.filter(w=>w!==r.id);const I=x.findIndex(w=>w.id===r.id);I!==-1&&(h[I]=!0)}})}p=d.length!==s.rules.length||!d.every(n=>s.rules.includes(n)),p?(console.log(`Rules changed for ${s.name}, updating timestamp`),s.updatedAt=i):h.every(Boolean)&&h.length>0&&console.log(`All outdated rules verified for ${s.name}, but no changes detected`),s.rules.sort()}),Te(m)}function q({isModalOpen:t,onSaveThing:c,onCancel:m,thing:i,rules:s,width:x,itemAliases:h,subtitle:d,okButtonText:p,onGiveAnotherThing:j,allThings:b}){const n=f.useMemo(()=>M.orderBy(Object.values(s),[u=>{const y=["manual","dependency","auto"].indexOf(u.method);return y===-1?Number.POSITIVE_INFINITY:y},u=>{const y=["grammar","comparison","order","count","contains","ends"].indexOf(u.type);return y===-1?Number.POSITIVE_INFINITY:y},u=>u.title.slice(0,7),u=>Number(u.id.split("-")[1])]),[s]),[l]=T.useForm(),o=T.useWatch([],l),a=!o||Object.values(o??{}).some(u=>u===void 0),r=T.useWatch("name",l);f.useEffect(()=>{if(!r||i.name&&i.syllables&&r===i.name)return;const u={syllables:ae(r),stressedSyllable:i.stressedSyllable??r.includes(" ")?-1:0};Object.keys(s).forEach(y=>{F[y]?u[y]=F[y](r):u[y]=i.rules.length>0?i.rules.includes(y):void 0}),l.setFieldsValue(u)},[r]);const v=T.useWatch("syllables",l),I=l.getFieldValue("ddr-51-pt");f.useEffect(()=>{I&&(l.setFieldsValue({stressedSyllable:void 0}),l.setFieldsValue({"ddr-43-pt":!1}),l.setFieldsValue({"ddr-44-pt":!1}),l.setFieldsValue({"ddr-45-pt":!1}),l.setFieldsValue({"ddr-46-pt":!1})),I===void 0&&l.setFieldsValue({"ddr-51-pt":!1})},[I]),f.useEffect(()=>{if(v){const u=Object.keys(s).reduce((y,A)=>(E[A]&&(y[A]=E[A](r,v,I)),y),{});l.setFieldsValue({...u,stressedSyllable:v===i.syllables?i.stressedSyllable:i.stressedSyllable??r.includes(" ")?-1:void 0})}},[r,v,I]);const w=T.useWatch("stressedSyllable",l);f.useEffect(()=>{if(!I&&w!==void 0){const u=Object.keys(s).reduce((y,A)=>(W[A]&&(y[A]=W[A](r,v,w)),y),{});l.setFieldsValue({...u})}},[w]);const J=l.getFieldValue("ddr-1-pt"),Q=l.getFieldValue("ddr-2-pt"),H=l.getFieldValue("ddr-50-pt");f.useEffect(()=>{J===!0&&(l.setFieldsValue({"ddr-2-pt":!1}),l.setFieldsValue({"ddr-50-pt":!1}))},[J]),f.useEffect(()=>{Q===!0&&(l.setFieldsValue({"ddr-1-pt":!1}),l.setFieldsValue({"ddr-50-pt":!1}))},[Q]),f.useEffect(()=>{H===!0&&(l.setFieldsValue({"ddr-1-pt":!1}),l.setFieldsValue({"ddr-2-pt":!1}))},[H]);const K=l.getFieldValue("ddr-3-pt");f.useEffect(()=>{K===!0&&l.setFieldsValue({"ddr-4-pt":!1})},[K]);const Y=l.getFieldValue("ddr-4-pt");f.useEffect(()=>{Y===!0&&l.setFieldsValue({"ddr-3-pt":!1})},[Y]),f.useEffect(()=>{r?.includes("-")&&l.setFieldsValue({"ddr-5-pt":!0})},[r]);const ue=u=>{const y=Re(u);c(y)},X=f.useMemo(()=>(v??"").split(ne),[v]),Z=f.useMemo(()=>Object.values(b).filter(u=>u.name===i.name&&u.itemId!==i.itemId),[i,b]);return e.jsx(me,{maskClosable:!1,okButtonProps:{disabled:a,htmlType:"submit",size:"large"},okText:p??"Add Item",onCancel:m,onOk:l.submit,open:t,title:e.jsxs(e.Fragment,{children:["Edit ",i.name," ",d&&e.jsx("small",{children:d})]}),width:x,children:e.jsxs(T,{autoComplete:"off",form:l,initialValues:De(i,s),labelWrap:!0,layout:"vertical",name:`new-item-${i.itemId}`,onFinish:ue,size:"small",children:[e.jsxs("div",{className:"diagram-container",children:[e.jsxs("div",{children:[e.jsxs(C,{gap:6,children:[e.jsx(ie,{itemId:i.itemId,width:50}),e.jsx(T.Item,{label:"Id",name:"itemId",children:e.jsx(P,{readOnly:!0})})]}),e.jsx(T.Item,{label:"Updated At",name:"updatedAt",children:e.jsx(P,{readOnly:!0})})]}),e.jsx(T.Item,{label:"Name",name:"name",children:e.jsx(P,{})}),e.jsx(T.Item,{label:"Syllables",name:"syllables",children:e.jsx(P,{})}),e.jsx(T.Item,{label:"Stressed Syllable",name:"stressedSyllable",children:e.jsx(N.Group,{buttonStyle:"solid",optionType:"button",children:X.map((u,y)=>e.jsx(N,{value:X.length-y-1,children:u},y))})}),e.jsxs("div",{children:[h&&e.jsxs(e.Fragment,{children:[e.jsx(g.Text,{children:"Options:"})," ",e.jsx(g.Text,{type:"secondary",children:h?.join(", ")})]}),Z.length>0&&e.jsxs("div",{children:[e.jsx(g.Text,{type:"danger",children:"⚠️ Warning: There are other items with the same name:"}),e.jsx("div",{children:Z.map(u=>e.jsx(k,{children:u.itemId},u.itemId))})]})]}),(h||j)&&e.jsx("div",{children:j&&e.jsx(V,{className:"mt-2",onClick:j,size:"large",type:"dashed",children:"Give me another thing"})}),e.jsx("div",{children:e.jsx(ke,{offsetTop:50,children:e.jsx(C,{align:"center",justify:"center",children:e.jsx(V,{disabled:a,htmlType:"submit",size:"large",type:"primary",children:p??"Add Item"})})})})]}),e.jsx("div",{className:"diagram-container",children:n.map(u=>u.method==="auto"&&F[u.id]?e.jsx(T.Item,{className:L(i.updatedAt<u.updatedAt&&"diagram-container__outdated-rule"),label:u.title,name:u.id,valuePropName:"checked",children:e.jsx(B,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},u.id):u.method==="dependency"?e.jsx(T.Item,{className:L(i.updatedAt<u.updatedAt&&"diagram-container__outdated-rule"),label:u.title,name:u.id,valuePropName:"checked",children:e.jsx(B,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},u.id):e.jsx(T.Item,{className:L(i.updatedAt<u.updatedAt&&"diagram-container__outdated-rule"),label:u.title,name:u.id,children:e.jsxs(N.Group,{buttonStyle:"solid",optionType:"button",children:[e.jsx(N,{value:!0,children:"✅"}),e.jsx(N,{value:!1,children:"❌"})]})},u.id))})]})})}const De=(t,c)=>{let m=!1;return{name:t.name,itemId:t.itemId,syllables:t.syllables??ae(t.name),stressedSyllable:t.stressedSyllable??0,...Object.keys(c).reduce((i,s)=>{if(t.updatedAt<c[s].updatedAt)if(F[s]){const x=F[s](t.name),h=t.rules.includes(s);x!==h&&(m=!0),i[s]=x}else i[s]=void 0;else i[s]=t.rules.includes(s);return i},{}),updatedAt:m?Date.now():t.updatedAt}},Re=t=>{const{itemId:c,name:m,syllables:i,stressedSyllable:s,...x}=t;return{itemId:c,name:m,updatedAt:Date.now(),syllables:i,stressedSyllable:s,rules:Object.keys(x).filter(h=>x[h]===!0)}};function R({itemId:t,name:c,width:m=50}){return e.jsxs(C,{align:"center",vertical:!0,children:[e.jsx(ie,{itemId:t,width:m}),e.jsx(g.Text,{code:!0,children:c},t)]})}function z({thing:t,width:c=50,onActivateThing:m}){return e.jsx(D,{onClick:()=>m(t),children:e.jsx(R,{itemId:t.itemId,name:t.name,width:c})})}function Ve({game:t}){const[c]=f.useState([{id:t.rule1.thing.id,name:t.rule1.thing.name,rule:1}]),[m]=f.useState([{id:t.rule2.thing.id,name:t.rule2.thing.name,rule:2}]),[i]=f.useState([{id:t.intersectingThing.id,name:t.intersectingThing.name,rule:0}]),[s]=f.useState(t.things.slice(0,4)),[x,h]=f.useState(t.things[0]);return e.jsxs(S,{align:"center",orientation:"vertical",children:[e.jsx(g.Title,{level:4,children:"Game Sample"}),e.jsxs(g.Title,{level:5,children:['"',t.title,'"']}),e.jsx(re,{count:t.level,disabled:!0,value:t.level}),e.jsx(g.Paragraph,{style:{maxWidth:"500px"},children:"O círculo amarelo tem uma regra gramatical secreta e o circulo vermelho tem outra regra gramatical secreta. O quadrado do meio representa a interseção entre a regra amarela e a regra vermelha."}),e.jsx(S,{children:e.jsx(Me,{intersectionChildren:e.jsx(D,{style:{width:"100%",height:"100%"},children:i.map((d,p,j)=>e.jsx(R,{itemId:d.id,name:d.name,width:p===j.length-1?80:60},d.id))}),leftCircleChildren:e.jsx(D,{style:{width:"100%",height:"100%"},children:c.map((d,p,j)=>e.jsx(R,{itemId:d.id,name:d.name,width:p===j.length-1?80:60},d.id))}),rightCircleChildren:e.jsx(D,{style:{width:"100%",height:"100%"},children:m.map((d,p,j)=>e.jsx(R,{itemId:d.id,name:d.name,width:p===j.length-1?80:60},d.id))}),width:600})}),e.jsx(g.Text,{children:"Coloque os objetos nos círculos corretos:"}),e.jsx(S,{className:"space--center",children:s.map(d=>e.jsx(D,{onClick:()=>h(d),style:d.id===x?.id?{outline:"3px solid hotPink"}:{},children:e.jsx(R,{itemId:d.id,name:d.name},d.id)},d.id))}),e.jsx(Ae,{items:[{key:"1",label:"Resposta",children:e.jsxs(S,{orientation:"vertical",children:[e.jsx(g.Text,{strong:!0,children:"Regra Amarela"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx(g.Text,{children:t.rule1.text})})}),e.jsx(g.Text,{strong:!0,children:"Regra Vermelha"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx(g.Text,{children:t.rule2.text})})})]})}]}),e.jsx("div",{style:{height:"200px"}})]})}function Me({leftCircleChildren:t,rightCircleChildren:c,intersectionChildren:m,...i}){return e.jsxs("svg",{viewBox:"0 0 760 500",xmlns:"http://www.w3.org/2000/svg",...i,children:[e.jsx("path",{d:"M252.78 3.5c-136.42 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.59-247-247-247zm.99 483.07C123.39 486.57 17.7 380.88 17.7 250.5S123.39 14.43 253.77 14.43 489.84 120.12 489.84 250.5 384.15 486.57 253.77 486.57z",fill:"#fbb03b",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),e.jsx("path",{d:"M508.22 3.5c-136.41 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.58-247-247-247zm.99 483.07c-130.38 0-236.07-105.69-236.07-236.07S378.84 14.43 509.22 14.43 745.29 120.12 745.29 250.5 639.6 486.57 509.22 486.57z",fill:"#f15a24",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),e.jsx("path",{d:"M487.34 250.5c0-62.39-24.29-121.04-68.41-165.16a235.9 235.9 0 00-37.43-30.47 235.35 235.35 0 00-37.43 30.47c-44.12 44.11-68.41 102.77-68.41 165.16s24.29 121.04 68.41 165.16a235.9 235.9 0 0037.43 30.47 235.35 235.35 0 0037.43-30.47c44.12-44.11 68.41-102.77 68.41-165.16z",fill:"#535353"}),e.jsx("path",{d:"M258.72 250.5c0-66.64 25.95-129.3 73.08-176.42a253.125 253.125 0 0134.1-28.57c-33.98-18.65-72.29-28.57-112.13-28.57-62.39 0-121.04 24.29-165.16 68.41C44.5 129.46 20.2 188.11 20.2 250.5s24.29 121.04 68.41 165.16c44.11 44.12 102.77 68.41 165.16 68.41 39.84 0 78.15-9.92 112.13-28.57a252.507 252.507 0 01-34.1-28.57c-47.12-47.12-73.08-109.78-73.08-176.42zM674.37 85.34C630.25 41.22 571.6 16.93 509.21 16.93c-40.27 0-78.98 10.14-113.24 29.18 11.74 8.26 22.86 17.6 33.22 27.96 47.12 47.12 73.08 109.78 73.08 176.42s-25.95 129.3-73.08 176.42a252.312 252.312 0 01-33.22 27.96c34.25 19.04 72.96 29.18 113.24 29.18 62.39 0 121.04-24.29 165.16-68.41 44.12-44.11 68.41-102.77 68.41-165.16s-24.29-121.04-68.41-165.16z",fill:"#535353"}),e.jsx("foreignObject",{height:"450",width:"250",x:"30",y:"25",children:e.jsx("div",{className:"venn-diagram__circle-content-left",children:t})}),e.jsx("foreignObject",{height:"450",width:"250",x:"480",y:"25",children:e.jsx("div",{className:"venn-diagram__circle-content-right",children:c})}),e.jsx("foreignObject",{height:"370",width:"182",x:"290",y:"65",children:e.jsx("div",{className:"venn-diagram__circle-content-intersection",children:m})})]})}function Pe({things:t,rules:c}){const[m]=G(),[i,s]=f.useState(null),x=()=>{s(Object.values(te(1,{latestDate:"2023/01/01",latestNumber:0,used:[]},c,t))[0])},h=()=>{let d=null;try{d=te(25,{latestDate:"2023/01/01",latestNumber:0,used:[]},c,t),console.log(d)}catch(p){console.error(p)}};return e.jsxs(S,{orientation:"vertical",ref:m,children:[e.jsx(g.Title,{level:5,children:"Game Simulator"}),e.jsx(V,{onClick:x,size:"large",children:"Simulate"}),e.jsx(V,{onClick:h,size:"large",children:"Generate Demos (log)"}),i&&e.jsx(Ve,{game:i},JSON.stringify(i))]})}function Ee({children:t,things:c,rules:m,addEntryToUpdate:i}){const s=f.useMemo(()=>Object.values(c).filter(p=>{if(!p.syllables)return!0;if(p.syllables.split(ne).join("")!==p.name.replace(/\s/g,""))return console.log("❗️ Name and syllables do not match",p.name,p.syllables),!0;const j=Object.values(m).filter(n=>n.updatedAt>p.updatedAt);return j.filter(n=>n.method==="manual").length>0&&console.log("❗️ Thing has auto updates that will be performed automatically upon downloading the JSON"),j.some(n=>n.method==="manual")}),[c,m]),[x,h]=f.useState(null);f.useEffect(()=>{const p=async j=>{console.log("Found things that need to update..."),h(null),await $(250),s.length>0&&h(s[0])};console.count("Checking for things that need to update..."),s.length>0&&p(s[0])},[s]);const d=p=>{i(p.itemId,p)};return e.jsxs(e.Fragment,{children:[x&&e.jsx(q,{allThings:c,isModalOpen:x!==null,okButtonText:"Update",onCancel:()=>h(null),onSaveThing:d,rules:m,subtitle:`(${s.length} left to update)`,thing:x,width:"90vw"}),t]})}function ce({addEntryToUpdate:t,availableThings:c,rules:m,width:i,allThings:s}){const{notification:x}=he.useApp(),[h,d]=f.useState(null),[p,j]=f.useState({}),b=()=>{const a=M.sample(c.filter(r=>!p[r.id]));a?(j(r=>({...r,[a.id]:!0})),d({itemId:a.id,name:We(a),updatedAt:Date.now(),syllables:"",stressedSyllable:0,rules:[]})):d(null)},n=f.useMemo(()=>{if(!h)return[];const a=c.find(r=>r.id===h.itemId);return[a?.name.pt,...a?.aliasesPt??[]].filter(Boolean)},[h,c]),l=async a=>{h&&((!a.name||!a.itemId)&&x.error({title:"Name and Item ID are required"}),t(a.itemId,a),console.log("COMPLETED SAVE"),d(null),await $(250),b())},o=async()=>{d(null),await $(100),b()};return e.jsxs(e.Fragment,{children:[e.jsx(V,{onClick:b,size:"large",children:"Classify New Item"}),!!h&&e.jsx(q,{allThings:s,isModalOpen:h!==null,itemAliases:n,onCancel:()=>d(null),onGiveAnotherThing:o,onSaveThing:l,rules:m,thing:h,width:i*.9})]})}const We=t=>t.name.pt.split(" ").length===1?t.name.pt:t.aliasesPt?t.aliasesPt.find(c=>c.split(" ").length===1)??t.name.pt:t.name.pt;function ze({things:t,addEntryToUpdate:c,availableThings:m,rules:i,setActiveThing:s}){const[x,{width:h}]=G(),d=f.useMemo(()=>Object.values(t),[t]),p=de({total:d.length,showQuickJumper:!0}),j=[{title:"ItemId",dataIndex:"itemId",key:"itemId",sorter:(n,l)=>Number(n.itemId)-Number(l.itemId),render:n=>e.jsx(k,{children:n})},{title:"Name",dataIndex:"name",key:"name",sorter:(n,l)=>n.name.localeCompare(l.name),render:n=>e.jsx(g.Text,{children:n})},{title:"Sprite",dataIndex:"itemId",key:"sprite",render:n=>e.jsx(z,{onActivateThing:s,thing:t[n]},`i-${n}`)},{title:"Rules",dataIndex:"rules",key:"rules",render:(n,l)=>e.jsx(S,{wrap:!0,children:n.map(o=>e.jsx(pe,{title:i[o].title,children:e.jsx(k,{color:i[o].updatedAt>l.updatedAt?"red":void 0,children:o})},o))})},{title:"Count",dataIndex:"rules",key:"count",sorter:(n,l)=>n.rules.length-l.rules.length,render:n=>n.length}],b=f.useMemo(()=>{const n={};return Object.values(t).forEach(l=>{n[l.name]||(n[l.name]=[]),n[l.name].push(l.itemId)}),Object.values(n).filter(l=>l.length>1)},[t]);return e.jsxs(S,{orientation:"vertical",ref:x,children:[e.jsxs(g.Title,{level:5,children:["Rules By Items ",e.jsx(O,{orientation:"vertical"})," Added: ",e.jsx(k,{children:Object.keys(t).length})," ","Available to add ",e.jsx(k,{children:m.length})]}),e.jsx(ce,{addEntryToUpdate:c,allThings:t,availableThings:m,rules:i,width:h}),e.jsx(O,{}),e.jsx(oe,{columns:j,dataSource:d,pagination:p,rowKey:"itemId"}),e.jsx(O,{}),e.jsx(g.Title,{level:5,children:"Duplicated Things"}),e.jsxs(S,{wrap:!0,children:[b.length===0&&e.jsx(g.Text,{children:"No duplicated things"}),b.map(n=>e.jsxs(C,{align:"center",children:[e.jsx(k,{color:"red",children:n.length}),n.map(l=>e.jsx(z,{onActivateThing:s,thing:t[l]},`i-${l}`))]},n[0]))]})]})}function Le({things:t,addEntryToUpdate:c,availableThings:m,rules:i,thingsByRules:s,setActiveThing:x,containerWidth:h}){const{is:d,addParam:p}=U(),j=f.useMemo(()=>Object.values(i).map(o=>({...o,thingsCount:s[o.id].length})),[i,s]),b=de({total:j.length,showQuickJumper:!0}),n=f.useMemo(()=>{const o=Object.values(s).map(a=>a.length);return{maxThings:Math.max(...o),minThings:Math.min(...o),averageThings:Math.round(Object.values(s).reduce((a,r)=>a+r.length,0)/Object.keys(s).length)}},[s]),l=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,a)=>Number(o.id.split("-")[1])-Number(a.id.split("-")[1]),render:o=>e.jsx(g.Text,{children:o})},{title:"Rule",dataIndex:"title",key:"title",sorter:(o,a)=>o.title.localeCompare(a.title),render:o=>e.jsx(g.Text,{children:o})},{title:"Type",dataIndex:"type",key:"type",sorter:(o,a)=>o.type.localeCompare(a.type)},{title:"Method",dataIndex:"method",key:"method",sorter:(o,a)=>o.method.localeCompare(a.method)},{title:"Things",dataIndex:"thingsCount",key:"thingsCount",render:(o,a)=>e.jsxs(S,{size:"small",children:[e.jsx(k,{children:o}),d("showThings")?e.jsxs(S,{size:"small",wrap:!0,children:[s[a.id].slice(0,20).map(r=>e.jsx(z,{onActivateThing:x,thing:t[r]},`${a.id}-${r}`)),s[a.id].length>20&&e.jsxs(g.Text,{children:["+",o-20," more"]})]}):e.jsxs(S,{size:"small",wrap:!0,children:[s[a.id].slice(0,5).map(r=>e.jsx(z,{onActivateThing:x,thing:t[r]},`${a.id}-${r}`)),s[a.id].length>5&&e.jsxs(g.Text,{children:["+",o-5," more"]})]})]}),sorter:(o,a)=>o.thingsCount-a.thingsCount},{title:"Level",dataIndex:"level",key:"level",sorter:(o,a)=>o.level-a.level,render:o=>e.jsx(re,{count:3,disabled:!0,value:o})}];return e.jsxs(S,{orientation:"vertical",children:[e.jsxs(C,{align:"center",gap:12,justify:"space-between",children:[e.jsxs(g.Title,{level:4,children:["Things By Rule (Added: ",Object.keys(t).length," | ",m.length,")"," "]}),e.jsx(Ce,{content:()=>Date.now().toString(),shape:"default",children:"Now"})]}),e.jsxs(S,{separator:e.jsx(O,{orientation:"vertical"}),wrap:!0,children:[e.jsx(ce,{addEntryToUpdate:c,allThings:t,availableThings:m,rules:i,width:h}),e.jsxs(g.Text,{strong:!0,children:["Average Things: ",e.jsx(k,{children:n.averageThings})]}),e.jsxs(g.Text,{strong:!0,children:["Max Things: ",e.jsx(k,{children:n.maxThings})]}),e.jsxs(g.Text,{strong:!0,children:["Min Things: ",e.jsx(k,{children:n.minThings})]}),e.jsx(B,{checked:d("showThings"),checkedChildren:"Hide things",onChange:o=>p("showThings",o),unCheckedChildren:"Show things"})]}),e.jsx(oe,{columns:l,dataSource:j,pagination:b})]})}const se=t=>{const c=t.filter(m=>m.split(" ").length===1);return c.length>0?c[0]:""};function _e({data:t,addEntryToUpdate:c}){const[m,{width:i}]=G(),s=_("items"),x=_("daily-diagram-rules"),h=f.useMemo(()=>Object.values(s.data??{}).filter(a=>{if(t&&t[a.id]!==void 0||a.nsfw)return!1;const r=a.name.pt.split(" ").length===1;return!!(a.decks?.includes("thing")||a.decks?.includes("alien")&&r||a.decks?.includes("manufactured")&&r||a.decks?.includes("alien")&&a.aliasesPt&&se(a.aliasesPt)||a.decks?.includes("manufactured")&&a.aliasesPt&&se(a.aliasesPt)||a.decks?.includes("meta")&&r)}),[t,s.data]),d=f.useMemo(()=>x.data??{},[x.data]),p=f.useMemo(()=>{const a=Object.values(d).reduce((r,v)=>(r[v.id]=[],r),{});return M.orderBy(Object.values(t),["updatedAt"],["desc"]).forEach(r=>{r.rules.forEach(v=>{a[v].push(r.itemId)})}),a},[t,d]),{is:j,queryParams:b}=U(),[n,l]=f.useState(null);if(s.isLoading||x.isLoading)return e.jsx(g.Text,{children:"Loading..."});const o=a=>{c(a.itemId,a)};return e.jsx(le,{hasResponseData:s.hasResponseData||x.hasResponseData,isLoading:s.isLoading||x.isLoading,children:e.jsx("div",{ref:m,children:e.jsxs(Ee,{addEntryToUpdate:c,rules:d,things:t,children:[n&&e.jsx(q,{allThings:t,isModalOpen:n!==null,okButtonText:"Update",onCancel:()=>l(null),onSaveThing:a=>{o(a),l(null)},rules:d,thing:n,width:i}),(j("display","rule")||!b.has("display"))&&e.jsx(Le,{addEntryToUpdate:c,availableThings:h,containerWidth:i,rules:d,setActiveThing:l,things:t,thingsByRules:p}),j("display","thing")&&e.jsx(ze,{addEntryToUpdate:c,availableThings:h,rules:d,setActiveThing:l,things:t,thingsByRules:p}),j("display","simulator")&&e.jsx(Pe,{addEntryToUpdate:c,availableThings:h,rules:d,things:t})]})})})}function Mt(){const t=Oe({tdrResourceName:"daily-diagram-items",firestoreDataCollectionName:"diagramItems",serialize:!0});return e.jsx(xe,{subtitle:"Diagram Sets",title:"Items",children:e.jsxs(ee,{hasSider:!0,children:[e.jsx(ve,{children:e.jsx(Fe,{...t})}),e.jsx(ee.Content,{className:"content",children:e.jsx(le,{error:t.error,hasResponseData:!M.isEmpty(t.data),isLoading:t.isLoading||t.isSaving,children:e.jsx(C,{gap:24,vertical:!0,children:e.jsx(_e,{...t})})})})]})})}export{Mt as ItemsDiagramSets,Mt as default};
