import{r as u,d as V,j as e,b as D,F as j,B as P,S as O,D as A,i as $,T as C,q as W,P as J,L as F}from"./index-DyjSH4OM.js";import{D as K}from"./DataLoadingWrapper-B0oxzPVc.js";import{u as k}from"./useQueryParams-Buak0vV0.js";import{l as b,P as Q}from"./useBaseUrl-CGDFxb01.js";import{I as _}from"./IdTag-DAa7d6oF.js";import{u as G}from"./useTablePagination-B1j7FR-a.js";import{I as U}from"./ImageCard-C5pbT96q.js";import{u as X}from"./useDebounce-D7MRSMNC.js";import{A as Y}from"./index-nZGt43g9.js";import{F as Z}from"./Table-DHBMrFtB.js";import{S as q}from"./index-DQRiDBAE.js";import{g as L,r as ee,a as se}from"./index-CIvxw8l3.js";import{u as ae}from"./useImageCardsDecks-DLGh8czd.js";import{R as M}from"./PlusOutlined-DXJb8t4Z.js";import{T as I}from"./index-CQYidkL6.js";import{F as te}from"./FilterEntries-D3ZPyz_c.js";import{S as re}from"./SiderContent--jQ49XzE.js";import{D as oe}from"./DownloadButton-Bk4uNNwt.js";import{a as ne}from"./FirestoreConsoleLink-Buc0gGoQ.js";import{S as ie}from"./SaveButton-DSm6bsIT.js";import{R as de}from"./TableOutlined-BWRkcsjF.js";import{u as ce}from"./useResourceFirestoreData-Kas4aR5W.js";import"./useCopyToClipboardFunction-DzFGYu6U.js";import"./index-D9N9BiJs.js";import"./Dropdown-CQ0KOtK0.js";import"./index-BSyNjB5B.js";import"./index-ClnxuMyA.js";import"./useId-C3rCDJeT.js";import"./scrollTo-Dcq7vwV7.js";import"./Pagination-DhLSDJ7y.js";import"./constants-B1K3jPng.js";import"./Item-jt1Ui6d6.js";import"./useTDResource-CGE34CFt.js";import"./index-BxFHkOJs.js";import"./index-DpYZgC1U.js";import"./useMutation-B98nW9qs.js";import"./index-CUyUdleU.js";import"./moment-B-YVwB4U.js";import"./SaveOutlined-C-TjSIG9.js";import"./useGetFirestoreDoc-Clud0cWJ.js";import"./useUpdateFirestoreDoc-BINkZPPh.js";var le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"};function w(){return w=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},w.apply(this,arguments)}const me=(s,a)=>u.createElement(V,w({},s,{ref:a,icon:le})),pe=u.forwardRef(me);function T({sets:s,addEntryToUpdate:a,hidePagination:t}){const n=G({total:s.length,showQuickJumper:!0}),d=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,r)=>o.id.localeCompare(r.id)},{title:"Passcode",dataIndex:"passcode",key:"passcode",sorter:(o,r)=>o.passcode[0].localeCompare(r.passcode[0]),render:(o,r)=>e.jsx(ue,{addEntryToUpdate:a,entry:r})},{title:"Cards",dataIndex:"imageCardsIds",key:"imageCardsIds",render:(o,r)=>e.jsx(he,{addEntryToUpdate:a,entry:r})}];return e.jsx(Z,{className:"my-4",columns:d,dataSource:s,pagination:t?void 0:n,rowKey:"id"})}function ue({entry:s,addEntryToUpdate:a}){const t=n=>{a(s.id,{...s,passcode:n})};return e.jsx(q,{defaultValue:s.passcode,mode:"tags",onChange:t,placeholder:"Add passcode from easier to harder",style:{width:300}})}function he({entry:s,addEntryToUpdate:a}){const[t,n]=u.useState(""),d=()=>{t&&(a(s.id,{...s,imageCardsIds:[...s.imageCardsIds,t.trim()]}),n(""))},o=r=>{a(s.id,{...s,imageCardsIds:s.imageCardsIds.filter(i=>i!==r)})};return e.jsxs(j,{align:"flex-end",gap:6,wrap:"wrap",children:[s.imageCardsIds.map(r=>e.jsxs(j,{gap:2,vertical:!0,children:[e.jsx(U,{cardId:r,cardWidth:60}),e.jsx(_,{children:r}),e.jsx(P,{onClick:()=>o(r),size:"small",children:"Remove"})]},r)),e.jsx("div",{children:e.jsx(D,{onChange:r=>n(r.target.value),onPressEnter:d,placeholder:"td-d*",style:{width:100},value:t})})]})}function B(s,a=!1){return u.useMemo(()=>{console.log("Recomputing passcode names typeahead...");const t={},n=Object.values(s).reduce((o,r)=>(r.passcode.forEach(i=>{const h=a?`${i} (${r.id})`:i;o[h]&&console.warn(`Duplicate passcode found: ${i}`,o[h],r.id),o[h]=r.id,r.imageCardsIds.forEach(p=>{t[p]||(t[p]=[]),t[p].push(i)})}),o),{}),d=b.orderBy(Object.keys(n),[o=>o.toLowerCase()]).map(o=>({value:o}));return{namesDict:n,options:d,imagesDict:t}},[s,a])}function ge({data:s,onFinish:a}){const{namesDict:t,options:n}=B(s,!0),[d,o]=u.useState([]),[r,i]=u.useState("");X(()=>{r&&h(r)},500,[r]);const h=g=>{if(!g){o([]);return}const x=g.trim().toUpperCase(),S=n.filter(c=>String(c?.value??"").toUpperCase().includes(x)),v=b.orderBy(S,[c=>{const m=String(c?.value??"").toUpperCase();if(m===x)return 0;const l=m.match(/\((.*?)\)/);if(l&&l[1]===x)return 1;const E=m.indexOf(x);return E===0?2:E>0?3:4}]);o(v)},p=()=>{d.length>0&&t[d[0].value]!==void 0&&a(t[d[0].value])},f=g=>{t[g]!==void 0&&a(t[g])};return e.jsx(Y,{allowClear:!0,filterOption:(g,x)=>String(x?.value??"").toUpperCase().indexOf(g?.toUpperCase())!==-1,notFoundContent:r.length>0?"No items found":"Type to search...",onSearch:i,onSelect:f,options:d,placeholder:"Search...",style:{width:250},children:e.jsx(D,{onPressEnter:p})})}const z={id:"",passcode:[],imageCardsIds:[]},N=(s,a)=>Array.from({length:s},()=>({...b.cloneDeep(z),id:L(a)}));function xe(s){const[a,t]=u.useState(N(3,Object.keys(s.data))),n=()=>{t(i=>[...i,{...b.cloneDeep(z),id:crypto.randomUUID().substring(0,5)}])},d=(i,h)=>{t(p=>p.map(f=>f.id===i?h:f))},o=()=>{console.log("Add entries to database"),a.forEach(i=>{i.passcode.length>0&&i.imageCardsIds.length>0&&s.addEntryToUpdate(i.id,i)}),t(N(5,Object.keys(s.data)))},r=u.useMemo(()=>a.some(i=>i.passcode.length>0||i.imageCardsIds.length>0),[a]);return e.jsxs(O,{className:"full-width",orientation:"vertical",children:[e.jsx(P,{disabled:!r,onClick:o,type:"primary",children:"Add Entries"}),e.jsx(T,{addEntryToUpdate:d,sets:a}),e.jsx(P,{icon:e.jsx(M,{}),onClick:n,children:"Add row"}),e.jsx(A,{}),e.jsx(je,{addEntryToUpdate:s.addEntryToUpdate,data:s.data})]})}function je({data:s,addEntryToUpdate:a}){const[t,n]=u.useState(""),[d,o]=u.useState(""),{namesDict:r,imagesDict:i}=B(s),{onRandomCard:h}=ae(),[p,f]=u.useState(""),{message:g}=$.useApp(),x=()=>{t&&o(t)},S=()=>{const c=h();o(c),n(c)},v=()=>{const c=p.split(",").map(m=>m.trim().toLowerCase()).filter(Boolean);c.length>0&&d&&c.forEach(m=>{if(r[m]){const l=s[r[m]];l.imageCardsIds.push(d),l.imageCardsIds=ee(l.imageCardsIds),a(l.id,l)}else{const l={id:L(Object.keys(s)),passcode:[m],imageCardsIds:[d]};a(l.id,l)}}),f(""),S(),g.success("Entries processed")};return e.jsxs(e.Fragment,{children:[e.jsx(C.Title,{className:"my-0",level:4,children:"Create Image Card Multiprompt"}),e.jsxs(O,{className:"full-width",children:[e.jsxs(j,{gap:8,vertical:!0,children:[e.jsxs(j,{children:[e.jsx(D,{onChange:c=>n(c.target.value),onPressEnter:x,placeholder:"Image Card ID",value:t}),e.jsx(P,{onClick:S,children:"Random"})]}),e.jsx(U,{cardId:d,cardWidth:200})]}),e.jsxs(j,{gap:8,vertical:!0,children:[e.jsxs(j,{children:[e.jsx(D,{onChange:c=>f(c.target.value),placeholder:"Names",value:p}),e.jsx(P,{disabled:!d||!p,onClick:v,type:"primary",children:"Process"})]}),e.jsx(j,{gap:8,wrap:!0,children:p.split(",").map(c=>{const m=c.trim().toLowerCase(),l=r[m];return e.jsx(I,{color:l?"blue":"green",icon:l?e.jsx(W,{}):e.jsx(M,{}),children:m},m)})}),e.jsx(j,{gap:8,wrap:!0,children:i[d]&&e.jsxs(e.Fragment,{children:[e.jsx(C.Text,{type:"secondary",children:"Already in:"}),i[d]?.map(c=>e.jsx(I,{children:c},c))]})})]})]})]})}function fe(s){const{is:a,queryParams:t}=k();return e.jsxs(e.Fragment,{children:[(a("display","table")||!t.has("display"))&&e.jsx(Ce,{...s}),a("display","create")&&e.jsx(xe,{...s})]})}function Ce(s){const a=u.useMemo(()=>b.orderBy(Object.values(s.data),["id","passcode"]),[s.data]),[t,n]=u.useState();return e.jsxs(O,{className:"full-width my-4",orientation:"vertical",children:[e.jsx(ge,{data:s.data,onFinish:d=>n(d)}),t&&e.jsxs(e.Fragment,{children:[e.jsx(T,{addEntryToUpdate:s.addEntryToUpdate,hidePagination:!0,sets:[s.data[t]]}),e.jsx(P,{onClick:()=>n(null),size:"small",children:"Clear search"})]}),e.jsx(T,{addEntryToUpdate:s.addEntryToUpdate,sets:a})]})}function Ie({data:s,save:a,isDirty:t,isSaving:n,entriesToUpdate:d,hasFirestoreData:o}){const{addParams:r,queryParams:i}=k(),{complete:h,incomplete:p,varied:f,mappings:g,mappedImages:x,overdone:S}=u.useMemo(()=>{let v=0,c=0,m=0,l=0,E=0;const R={};return Object.values(s).forEach(y=>{y.imageCardsIds.length>=3&&v++,y.imageCardsIds.length>4&&m++,y.imageCardsIds.length<3&&c++,y.passcode.length>3&&l++,E+=y.imageCardsIds.length,y.imageCardsIds.forEach(H=>{R[H]=!0})}),{complete:v,incomplete:c,varied:l,mappings:E,mappedImages:Object.keys(R).length,overdone:m}},[s]);return e.jsxs(re,{children:[e.jsxs(j,{gap:12,vertical:!0,children:[e.jsx(ie,{dirt:JSON.stringify(d),isDirty:t,isSaving:n,onSave:a}),e.jsx(oe,{block:!0,data:()=>ve(s),disabled:t,fileName:"daily-passcode-sets.json",hasNewData:o}),e.jsx(j,{justify:"center",children:e.jsx(ne,{docId:"imagePasscode",label:"FS TDR",path:"tdr",queryKey:["tdr","imagePasscode"]})})]}),e.jsx(A,{}),e.jsx(te,{label:"Display",onChange:v=>r({display:v,page:1},{page:1,display:"table"}),options:[{title:"Table",icon:e.jsx(de,{}),value:"table"},{title:"Create",icon:e.jsx(pe,{}),value:"create"}],value:i.get("display")??"table"}),e.jsx("p",{children:"Stats"}),e.jsxs(C.Text,{children:["Passcode sets: ",e.jsx(I,{children:Object.keys(s).length})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Complete: ",e.jsx(I,{color:"green-inverse",children:h})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Incomplete: ",e.jsx(I,{color:"gold-inverse",children:p})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Overdone: ",e.jsx(I,{color:"purple",children:S})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Varied: ",e.jsx(I,{children:f})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Mappings: ",e.jsx(I,{children:g})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Unique images: ",e.jsx(I,{children:x})]})]})}function ve(s){console.log("Preparing file for download...");const a=b.cloneDeep(s);return se(a)}function cs(){const s=ce({tdrResourceName:"daily-passcode-sets",firestoreDataCollectionName:"imagePasscode",serialize:!0});return e.jsx(J,{subtitle:"Daily Set Entries",title:"Image Cards Passcode Sets",children:e.jsxs(F,{hasSider:!0,children:[e.jsx(Q,{children:e.jsx(Ie,{...s})}),e.jsx(F.Content,{className:"content",children:e.jsx(K,{error:s.error,hasResponseData:!b.isEmpty(s.data),isLoading:s.isLoading,children:e.jsx(fe,{...s})})})]})})}export{cs as ImageCardsPasscode,cs as default};
