import{r as u,j as e,B as w,T as f,D as z,P as q,L as R}from"./index-B2IufO9d.js";import{D as Q}from"./DataLoadingWrapper-Te6tcY9j.js";import{F as W}from"./FilterEntries-CE--5qSd.js";import{S as J}from"./SiderContent--y26S5J7.js";import{D as K}from"./DownloadButton-BS-rGL6t.js";import{S as G}from"./SaveButton-X34DXvKp.js";import{u as O}from"./useQueryParams-VqzV2bcM.js";import{l as x,P as X}from"./useBaseUrl-Df4Xj3M9.js";import{h as Y,i as C,r as D,a as _}from"./index-DYbc2yc2.js";import{L as A}from"./LanguageFlag-Cy1Z1Ga7.js";import{F as b}from"./index-BFp_qQ_m.js";import{M as H}from"./index-BmZrjRgc.js";import{I as F}from"./index-C-QvqMpR.js";import{F as S}from"./index-eN_YjmO0.js";import{R as V}from"./TableOutlined-DkiWpnnN.js";import{R as Z}from"./FrownOutlined-DSjqCG9s.js";import{T as U}from"./Typeahead-Cw-lB3q0.js";import{u as ee}from"./useCopyToClipboardFunction-BXltBBgx.js";import{u as te}from"./useTableExpandableRows-DYFx2Ph1.js";import{u as se}from"./useTablePagination-CKsXPyXX.js";import{u as E}from"./useTDResource-BRz6Jgmi.js";import{S as v}from"./index-BLdWx9a_.js";import{I as N}from"./Item-CrTB72Il.js";import{C as re}from"./CopyIdsButton-CLctQC3C.js";import{P as ie}from"./index-BZKIKlfR.js";import{R as ne}from"./DeleteFilled-CGHiHZzI.js";import{I as oe}from"./InspirationSample-CZrZfKjW.js";import{I as ae}from"./ItemsTypeahead-CyCBD-p6.js";import{F as B}from"./Table-C7k__y5r.js";import{T as le}from"./TransparentButton-DW24v49c.js";import{u as me,P as ce}from"./useGridPagination-v7JwL3cG.js";import{S as de}from"./index-CzBdkirf.js";import{D as pe}from"./index-CILU9f69.js";import{S as ue}from"./index-B7k7fINJ.js";import{T as he}from"./index-CvojYiF0.js";import{u as xe}from"./useResourceFirestoreData-Ct9dRA7e.js";import"./index-Bj41O2Wl.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-BnCMkMIP.js";import"./constants-D-ibECRI.js";import"./Input-DZDlQFp6.js";import"./gapSize-U1swVQyS.js";import"./useDebounce-DAKGns9o.js";import"./index-DB4iQl4V.js";import"./SyncOutlined-Ba1kePi3.js";import"./PlusOutlined-qpuW7UdR.js";import"./index-CHU5UCpw.js";import"./index-DxGPxIRU.js";import"./scrollTo-CViIWZ5G.js";import"./Pagination-9MrbEQqq.js";import"./useGetFirestoreDoc-jzQcL3mM.js";import"./useUpdateFirestoreDoc-PVwR-GEv.js";import"./useMutation-CkGQIDSr.js";function je({addEntryToUpdate:t,ids:s}){const[i,n]=u.useState(!1),[r]=b.useForm(),m=o=>{const h=x.camelCase(o.name);t(x.camelCase(h),{id:h,title:{pt:o.nome,en:o.name},itemsIds:[]})},l=b.useWatch("name",r),a=u.useMemo(()=>{const o={};if(l&&l.length>2){const h=x.camelCase(l);if(h)try{Y.findBestMatch(h,s).ratings.forEach(g=>{g.rating>.4&&(o[g.target]=g.rating)})}catch(j){console.error(j)}}return Object.keys(o)},[l,s]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{block:!0,onClick:()=>n(!0),type:"dashed",children:"Add New Set"}),e.jsxs(H,{maskClosable:!1,okButtonProps:{htmlType:"submit"},okText:"Add",onCancel:()=>n(!1),onOk:r.submit,open:i,title:"Add New Set",children:[e.jsxs(b,{form:r,onFinish:m,children:[e.jsx(b.Item,{label:"Nome",name:"nome",rules:[{required:!0}],children:e.jsx(F,{placeholder:"Name in pt",prefix:e.jsx(A,{language:"pt",width:"1em"}),size:"small"})}),e.jsx(b.Item,{label:"Name",name:"name",rules:[{required:!0}],children:e.jsx(F,{placeholder:"Name in en",prefix:e.jsx(A,{language:"en",width:"1em"}),size:"small"})})]}),e.jsx(f.Text,{children:"Similar:"}),e.jsx("ul",{children:a.map(o=>e.jsx("li",{children:o},o))})]})]})}function fe({data:t,save:s,isDirty:i,isSaving:n,entriesToUpdate:r,addEntryToUpdate:m,hasFirestoreData:l}){const{queryParams:a,addParams:o}=O();return e.jsxs(J,{children:[e.jsxs(S,{gap:12,vertical:!0,children:[e.jsx(G,{dirt:JSON.stringify(L(r)),isDirty:i,isSaving:n,onSave:s}),e.jsx(K,{block:!0,data:()=>ge(t),disabled:i,fileName:"daily-disc-sets.json",hasNewData:l})]}),e.jsx(z,{}),e.jsx(W,{label:"Display",onChange:h=>o({display:h,page:1},{page:1,display:"table"}),options:[{title:"Sets",icon:e.jsx(V,{}),value:"sets"},{title:"Orphan Items",icon:e.jsx(Z,{}),value:"orphans"}],value:a.get("display")??"sets"}),e.jsx(je,{addEntryToUpdate:m,ids:Object.keys(t)})]})}function L(t){return x.omitBy(x.cloneDeep(t),s=>x.isEmpty(s.itemsIds))}function ge(t){return Object.keys(t).forEach(s=>{t[s].itemsIds=C(D(t[s].itemsIds))}),_(L(t))}function Se({value:t,disc:s,addEntryToUpdate:i}){const n=(r,m)=>{i(s.id,{...s,title:{...s.title,[m]:r}})};return e.jsxs(v,{direction:"vertical",size:"small",children:[e.jsx(f.Text,{editable:{onChange:r=>n(r,"pt")},children:String(t.pt)}),e.jsx(f.Text,{editable:{onChange:r=>n(r,"en")},children:String(t.en)})]})}function ye({disc:t,addEntryToUpdate:s,itemId:i}){const n=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(r=>r!==i)})};return e.jsx(ie,{cancelText:"No",okText:"Yes",onConfirm:n,title:"Are you sure you want to remove this item?",children:e.jsx(w,{icon:e.jsx(ne,{}),size:"small",type:"text"})})}function Ie({disc:t,itemsIds:s,copyToClipboard:i,addEntryToUpdate:n}){return e.jsxs(S,{gap:6,wrap:"wrap",children:[s.map((r,m)=>e.jsxs(S,{gap:2,vertical:!0,children:[e.jsx(N,{id:r,width:60}),e.jsxs(S,{justify:"center",children:[e.jsx(f.Text,{onClick:()=>i(r),children:r}),e.jsx(ye,{addEntryToUpdate:n,disc:t,itemId:r})]})]},`${t.title}-${r}-${m}`)),e.jsx(re,{ids:s})]},`items-${t.title}`)}function be({onUpdateBatch:t}){const[s,i]=u.useState(""),n=()=>{try{const m=s.replace(/^\[|\]$/g,"").split(/\s*,\s*/).map(l=>l.replace(/^"|"$/g,"")).filter(Boolean);t(m),i("")}catch(r){console.error(r)}};return e.jsxs(f.Paragraph,{children:["Paste IDs",e.jsx(F.TextArea,{onChange:r=>i(r.target.value),value:s}),e.jsx(w,{onClick:n,size:"small",children:"Add"})]})}function Ce({disc:t,addEntryToUpdate:s}){const i=r=>{s(t.id,{...t,itemsIds:D(C([...t.itemsIds,r]))})},n=r=>{s(t.id,{...t,itemsIds:D(C([...t.itemsIds,...r]))})};return e.jsxs(S,{gap:16,children:[e.jsxs("div",{children:[e.jsx(f.Paragraph,{children:"Add Item"}),e.jsx(ae,{onFinish:i})]}),e.jsx(oe,{excludeList:t.itemsIds,onSelect:i}),e.jsx(be,{onUpdateBatch:n})]})}function M({rows:t,addEntryToUpdate:s}){const i=E("items"),n=ee(),r=se({total:t.length,showQuickJumper:!0}),m=[{title:"Id",dataIndex:"id",key:"id",sorter:(a,o)=>a.title.en.localeCompare(o.title.en)},{title:"Title",dataIndex:"title",key:"title",sorter:(a,o)=>a.title.en.localeCompare(o.title.en),render:(a,o)=>e.jsx(Se,{addEntryToUpdate:s,disc:o,value:a})},B.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(a,o)=>e.jsx(Ie,{addEntryToUpdate:s,copyToClipboard:n,disc:o,itemsIds:C(a)})},{title:"Count",dataIndex:"itemsIds",key:"count",render:a=>D(a).filter(Boolean).length}],l=te({maxExpandedRows:1,expandedRowRender:a=>e.jsx(Ce,{addEntryToUpdate:s,disc:a}),rowExpandable:()=>i.isSuccess});return e.jsx(B,{columns:m,dataSource:t,expandable:l,pagination:r,rowKey:"id"})}function De({data:t,addEntryToUpdate:s}){const[i,n]=u.useState(null),r=u.useMemo(()=>i?t[i]:null,[i,t]);return e.jsxs(v,{direction:"vertical",children:[e.jsx(f.Title,{level:5,children:"Search Disc Set"}),e.jsx(U,{data:t,onFinish:m=>n(m),parser:we,placeholder:"Search disc set by title...",style:{width:"100%",minWidth:450}}),!!r&&e.jsx(M,{addEntryToUpdate:s,rows:[r]})]})}const we=t=>Object.values(t??{}).reduce((s,i)=>(s[`${i.title.en}`]=i.id,s[`${i.title.pt}`]=i.id,s),{});function ve(t){return x.orderBy(t,[s=>s.title.en]).map(s=>({...s,itemsIds:x.orderBy(s.itemsIds,i=>Number(i))}))}function Te({data:t,addEntryToUpdate:s}){const i=u.useMemo(()=>ve(Object.values(t)),[t]),n=u.useMemo(()=>i.filter(r=>r.itemsIds.length>=20).length,[i]);return e.jsxs(v,{direction:"vertical",children:[e.jsx(De,{addEntryToUpdate:s,data:t}),e.jsxs(f.Title,{level:5,children:["Total Disc Sets: ",i.length," | Complete Disc Sets: ",n]}),e.jsx(M,{addEntryToUpdate:s,rows:i})]})}function ke({data:t,addEntryToUpdate:s}){const{is:i,addParam:n}=O(),r=E("items"),[m,l]=u.useMemo(()=>{if(r.data){const p=Object.values(t).reduce((d,y)=>(y.itemsIds.forEach(P=>{d[P]||(d[P]=[]),d[P].push(y.id)}),d),{});Object.keys(r.data).reduce((d,y)=>(d[y]===void 0&&(d[y]=[]),d[y].push(y),d),{});const k=["black","blue","brown","green","orange","pink","purple","red","white","yellow"],$=Object.keys(r.data).filter(d=>p[d]===void 0||p[d].length===1&&k.includes(p[d][0])).map(d=>r.data[d]);return[p,$]}return[{},[]]},[t,r.data]),a=i("onlyOrphans"),{page:o,pagination:h}=me({data:a?l:Object.values(r.data),defaultPageSize:64,resetter:a?"orphans":"all"}),[j,g]=u.useState(null),[c,I]=u.useState(null),T=u.useMemo(()=>Object.values(t).sort((p,k)=>p.title.pt.localeCompare(k.title.pt)),[t]);return e.jsxs(e.Fragment,{children:[e.jsxs(f.Title,{level:4,children:["Orphan Items (",l.length,")"]}),e.jsx(v,{className:"mb-4",children:e.jsx(de,{checkedChildren:"Only Orphans",onChange:p=>n("onlyOrphans",p,!1),unCheckedChildren:"All Items"})}),e.jsx(pe,{onClose:()=>g(null),open:!!j,title:"Add Item to Set",children:!!j&&e.jsx(Pe,{activeItem:j,activeItemSets:(m==null?void 0:m[j])??[],addEntryToUpdate:s,data:t,latestSetId:c,setLatestSetId:I,sortedSets:T})}),e.jsx(ce,{className:"full-width",pagination:h,children:e.jsx(S,{gap:16,wrap:"wrap",children:o.map(p=>e.jsx(le,{onClick:()=>g(p.id),children:e.jsx(N,{id:p.id})},p.id))})})]})}function Pe({activeItem:t,activeItemSets:s,setLatestSetId:i,sortedSets:n,data:r,addEntryToUpdate:m}){const[l,a]=u.useState(s);if(!t)return null;const o=c=>{a(c)},h=c=>{a(I=>I.includes(c)?I.filter(T=>T!==c):[...I,c])},j=()=>{l.forEach(c=>{m(c,{...r[c],itemsIds:[...r[c].itemsIds,t]})}),i(l[l.length-1])},g=n.map(c=>({value:c.id,label:c.title.pt}));return e.jsxs(S,{gap:16,vertical:!0,children:[e.jsx(N,{id:t}),e.jsx(w,{disabled:x.isEqual(s,l),onClick:j,type:"primary",children:"Save to Sets"}),e.jsx(ue,{mode:"tags",onChange:o,options:g,value:l}),e.jsx(S,{gap:8,wrap:"wrap",children:n.map(c=>e.jsx(he,{color:l.includes(c.id)?"gold":void 0,onClick:()=>h(c.id),children:c.title.pt},c.id))})]})}function Fe({data:t,addEntryToUpdate:s}){const{is:i,queryParams:n}=O();return e.jsxs(e.Fragment,{children:[(i("display","sets")||!n.has("display"))&&e.jsx(Te,{addEntryToUpdate:s,data:t}),(i("display","orphans")||!n.has("display"))&&e.jsx(ke,{addEntryToUpdate:s,data:t})]})}function Ft(){const t=xe({tdrResourceName:"daily-disc-sets",firestoreDataCollectionName:"discSets",serialize:!0});return e.jsx(q,{subtitle:"Disc Sets",title:"Items",children:e.jsxs(R,{hasSider:!0,children:[e.jsx(X,{children:e.jsx(fe,{...t})}),e.jsx(R.Content,{className:"content",children:e.jsx(Q,{error:t.error,hasResponseData:!x.isEmpty(t.data),isLoading:t.isLoading||t.isSaving,children:e.jsx(Fe,{...t})})})]})})}export{Ft as ItemsDiscSets,Ft as default};
