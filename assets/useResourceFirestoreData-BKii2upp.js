import{i as Q,u as $,r as m}from"./index-D33WsCK5.js";import{l as c}from"./useBaseUrl-BgzYt73r.js";import{j as h,k as x}from"./index-BbPzNS2e.js";import{u as L}from"./useGetFirestoreDoc-BU1yuPpp.js";import{u as M}from"./useTDResource-CzTlhf0K.js";import{u as P}from"./useUpdateFirestoreDoc-3f0VpAX-.js";function G({tdrResourceName:o,firestoreDataCollectionName:e,serialize:u,deserializer:n}){const{notification:d}=Q.useApp(),f=$(),r=M(o,{select:n||void 0}),s=L("tdr",e,{select:u?h:void 0}),[t,p]=m.useState({}),i=P("tdr",e,{onSuccess:()=>{d.success({message:`${e} updated`}),f.refetchQueries({queryKey:["firestore","tdr",e]}),p({})},onError:a=>{d.error({message:`${e} update failed`,description:a.message})}}),y=m.useMemo(()=>!r.isSuccess||!s.isSuccess||i.isPending?{}:(console.log(`%cMerging ${o}+${e} data...`,"color: #f0f"),c.cloneDeep({...r.data??{},...s.data??{},...t})),[o,e,r.data,s.data,r.isSuccess,s.isSuccess,i.isPending,t]),S=!c.isEmpty(t),E=(a,v)=>{p(D=>({...D,[a]:v}))},g=s.data,F=()=>{i.mutate(u?x(t):t)};return{data:y,isLoading:r.isLoading||s.isLoading,isSuccess:r.isSuccess&&s.isSuccess,error:r.error||s.error,firestoreData:g,hasFirestoreData:!c.isEmpty(g),isSaving:i.isPending,save:F,addEntryToUpdate:E,entriesToUpdate:t,isDirty:S}}export{G as u};
