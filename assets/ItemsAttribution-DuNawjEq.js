import{r as f,Y as qe,a as _,_ as G,ak as Qe,al as Ke,am as He,a1 as he,a0 as Ye,j as e,T as F,D as Q,B as P,an as Je,G as Se,aj as fe,ao as Ze,ap as We,P as Xe,L as je}from"./index-DsV55vb0.js";import{D as et}from"./DataLoadingWrapper-DRIKXOAh.js";import{c as K,a as se,b as we,d as ce,T as tt}from"./FilterEntries-mw82ljdp.js";import{S as st}from"./SiderContent-DJlYgVXp.js";import{D as Ne}from"./DownloadButton-CSQMkNUE.js";import{S as rt}from"./SaveButton-CHO0AJlF.js";import{l as b,c as ue,E as ae,P as nt}from"./useBaseUrl-DHVr4qF3.js";import{A as k,d as w,e as it,f as Y}from"./constants-BzeosQnZ.js";import{e as at,g as lt,a as xe,d as Pe,w as ot,m as ct}from"./index-DwSDsoxO.js";import{u as ut}from"./useGetFirestoreDoc-CPaLzGa-.js";import{u as ie}from"./useTDResource-ytlw1Wdo.js";import{u as dt}from"./useUpdateFirestoreDoc-CV6isKZQ.js";import{u as D}from"./useQueryParams-35HGH-39.js";import{T as ne}from"./index-CePeb8uu.js";import{F as S}from"./index-BhQiV4UT.js";import{F as mt}from"./FirestoreConsoleLink-mWYFOixt.js";import{V as pt}from"./VerticalAlignTopOutlined-v_ZPtoJ9.js";import{I as W,a as X,b as $,c as le}from"./ItemBuildingBlocks-Q5e_qdyx.js";import{Q as gt}from"./index-B1ugW9XK.js";import{R as Ie}from"./index-BLeO27EC.js";import{R as de}from"./CheckCircleFilled-DKvGkBqo.js";import{I as ve}from"./Item-BU57AiPz.js";import{P as Re}from"./progress-BQYgrUs_.js";import{R as ye,u as ht}from"./CloseCircleOutlined-OZSasFNR.js";import{C as Z}from"./index-BTp8zCqp.js";import{A as ft}from"./index-BgbkOSXH.js";import{S as M}from"./index-BYr7G0av.js";import{I as xt}from"./ItemsTypeahead-DfQt1Reb.js";import{R as bt,a as jt}from"./DoubleRightOutlined-ByTEdfWS.js";import{S as te}from"./index-CxHMk4ck.js";import{a as It,P as vt,F as Oe}from"./Table-Cd714oU7.js";import{D as yt}from"./index-pC40YKPu.js";import{S as At}from"./index-C2BSwcK5.js";import{P as Ct}from"./index-Dia_90Zf.js";import{P as Tt}from"./Pagination-RedeP2v2.js";import{M as Et}from"./index-CL8_3uEH.js";import{T as St}from"./TransparentButton-sGwLIwZp.js";import{T as wt}from"./index-DIzvswcm.js";import{R as Nt}from"./SkinOutlined-DBUgQPf5.js";import{R as Pt}from"./index-Rp75b_rM.js";import"./index-BY_VO0Jc.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-Cmwn8Rxi.js";import"./useMutation-DczzbJSq.js";import"./gapSize-U1swVQyS.js";import"./LanguageFlag-QXcEmUEA.js";import"./useCopyToClipboardFunction-6k-5oTSa.js";import"./index-DH7x8X0p.js";import"./Input-ot97OnIB.js";import"./FireFilled-pK_jM7ZK.js";import"./IdcardOutlined-DiZVjhDb.js";import"./throttleByAnimationFrame-DDBrnWpe.js";import"./useDebounce-CnH_CZ5R.js";import"./index-DxNbiSOl.js";import"./index-Br-kN19V.js";import"./scrollTo-CMtt_I9a.js";import"./extendsObject-keMuGWqj.js";import"./PlusOutlined-ByZyTB3m.js";var Rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"},Ot={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},Lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},Dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},Ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},Ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Vt=function(s,r){return qe?window.matchMedia(s).matches:!1},kt=function(s,r){var t=f.useState(Vt(s)),n=t[0],o=t[1];return f.useEffect(function(){var i=!0,l=window.matchMedia(s),c=function(){i&&o(!!l.matches)};return l.addEventListener("change",c),o(l.matches),function(){i=!1,l.removeEventListener("change",c)}},[s]),n},Mt=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:Rt}))},zt=f.forwardRef(Mt),Bt=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:Ot}))},$t=f.forwardRef(Bt),_t=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:It}))},Gt=f.forwardRef(_t),qt=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:Lt}))},Qt=f.forwardRef(qt),Kt=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:Qe}))},Ht=f.forwardRef(Kt),Yt=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:Dt}))},Jt=f.forwardRef(Yt),Zt=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:vt}))},Wt=f.forwardRef(Zt),Xt=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:gt}))},Le=f.forwardRef(Xt),es=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:Ke}))},ts=f.forwardRef(es),ss=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:He}))},rs=f.forwardRef(ss),ns=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:pt}))},is=f.forwardRef(ns),as=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:Ut}))},ls=f.forwardRef(as),os=function(r,t){return f.createElement(_,G({},r,{ref:t,icon:Ft}))},cs=f.forwardRef(os);const De={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};b.keyBy(De,"prefix");const us=["*","^","+","~","!"],H={ATTRIBUTE_VALUE_DICT:De,ATTRIBUTE_VALUE_PRIORITY:us},me=(s={})=>b.cloneDeep(b.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},s)),pe=(s={})=>b.cloneDeep(b.merge({id:"",attributes:{}},s)),Ue=(s,r,t)=>{const n=b.orderBy(Object.values(r),["priority","id"],["asc","asc"]).map(a=>a.id);function o(a,u){return b.orderBy(a,j=>n.indexOf(j),["asc"]).map(j=>`${u}${j}`)}const i=[],l=[],c=[],m=[],g=[];return Object.entries(s.attributes).forEach(([a,u])=>{if(r[a])switch(u){case w.OPPOSITE:i.push(a);break;case w.DETERMINISTIC:l.push(a);break;case w.RELATED:c.push(a);break;case w.UNRELATED:m.push(a);break;case w.UNCLEAR:g.push(a);break;default:g.push(a);break}}),[...o(i,k.OPPOSITE),...o(l,k.DETERMINISTIC),...o(c,k.RELATED),...o(m,k.UNRELATED),...o(g,k.UNCLEAR)]},Fe=b.memoize(s=>{if(s.length===3)return{key:s,className:"",text:""};const r=s[0];return{key:s.slice(1,4),className:{[k.DETERMINISTIC]:"deterministic",[k.UNRELATED]:"unrelated",[k.UNCLEAR]:"unclear",[k.OPPOSITE]:"opposite"}[r],text:{[k.DETERMINISTIC]:"very",[k.UNRELATED]:"not",[k.UNCLEAR]:"maybe",[k.OPPOSITE]:"very not"}[r]}}),Ve=(s,r,t)=>s.filter(n=>!(!r&&n.includes(k.UNCLEAR)||!t&&n.includes(k.UNRELATED)));function ge(s,r,t){const n=[];for(const[l,c]of Object.entries(s.attributes)){const m=r[l];if(m){const g=Object.values(H.ATTRIBUTE_VALUE_DICT).find(a=>a.value===c);g&&n.push({prefix:g.prefix,id:m.id,priority:m.priority})}}const o=b.sortBy(n,[l=>H.ATTRIBUTE_VALUE_PRIORITY.indexOf(l.prefix),l=>l.prefix===H.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:l.priority,["asc","asc"]]),i=t!=null&&t.length?o.slice(0,t==null?void 0:t.length):o;return t!=null&&t.onlyRelevant?i.filter(l=>[H.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,H.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(l.prefix)).map(l=>`${l.prefix}${l.id}`).join(""):i.map(l=>`${l.prefix}${l.id}`).join((t==null?void 0:t.delimiter)??"")}const ds=b.keyBy(H.ATTRIBUTE_VALUE_DICT,"prefix");function ms(s){return(s.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((t,n)=>{const o=n[0],i=n.slice(1),l=ds[o].value;return t[i]=l,t},{})}function ke(s){return Object.values(s.attributes).reduce((r,t)=>{let n=r;return t<=0?(t===H.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(n+=t/2),n):n+t},0)}function Me(s,r){const t=Object.values(s.attributes).filter(n=>n===H.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((r-t)/r*100)}const re={};function ps(){const{notification:s,message:r}=he.useApp(),t=Ye(),n=ie("items"),o=ie("items-attributes"),i=ie("items-attribute-values"),l=ut("tdr","itemsAttributeValues",{select:I=>hs({itemAttributesValues:I,itemAttributes:o.data??{}})}),[c,m]=f.useState({}),g=dt("tdr","itemsAttributeValues",{onSuccess:()=>{s.success({message:"itemsAttributeValues updated"}),t.refetchQueries({queryKey:["firestore","tdr","itemsAttributeValues"]}),m({})},onError:I=>{s.error({message:"itemsAttributeValues update failed",description:I.message})}}),a=f.useMemo(()=>({...i.data??{},...l.data??{}}),[i.data,l.data]),u=!b.isEmpty(c),j=(I,y)=>{m(d=>({...d,[I]:{...y,updatedAt:Date.now()}}))},x=I=>{m(y=>({...y,...b.mapKeys(I.map(d=>({...d,updatedAt:Date.now()})),"id")}))},h=l.data,p=()=>{g.mutate(gs({...h,...c},o.data))};return{availableItemIds:f.useMemo(()=>{const I=n.data??{};return b.orderBy(Object.keys(I).filter(y=>{var d;return(((d=I[y])==null?void 0:d.decks)??[]).includes("alien")}),y=>Number(y),"asc")},[n.data]),getItem:I=>{var y;return(y=n.data)!=null&&y[I]?n.data[I]:(I&&r.info(`Item ${I} not found in TDR. Creating a new item...`),me({id:I}))},getItemAttributeValues:I=>{const y=(a==null?void 0:a[I])??{},d=c[I]??{};return b.isEmpty(y)&&b.isEmpty(d)?(re[I]=pe({id:I}),re[I]):b.merge((re==null?void 0:re[I])??{},y,d)},attributes:o.data??{},isLoading:n.isLoading||o.isLoading||i.isLoading||l.isLoading,error:n.error||o.error||i.error||l.error,firestoreData:h,hasFirestoreData:!b.isEmpty(l.data),isSaving:g.isPending,save:p,addAttributesToUpdate:j,addMultipleAttributesToUpdate:x,attributesToUpdate:c,isDirty:u}}const gs=(s,r)=>lt(s,n=>({id:n.id,tempSignature:ge(n,r),updatedAt:n.updatedAt})),hs=s=>{const{itemAttributesValues:r,itemAttributes:t}=s,n=Object.keys(t).length;return at(r,i=>{const l=ms(i.tempSignature),c=Object.keys(l).length===n,m={id:i.id,updatedAt:i.updatedAt,attributes:l};return c?{...m,complete:c,reliability:Me(m,n),score:ke(m)}:m})},ze=f.createContext({getItem:()=>me(),getItemAttributeValues:()=>pe(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:me(),itemAttributeValues:pe(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{},hasFirestoreData:!1}),fs=({children:s})=>{const{getItem:r,getItemAttributeValues:t,availableItemIds:n,isLoading:o,error:i,isSaving:l,save:c,addAttributesToUpdate:m,isDirty:g,attributes:a,addMultipleAttributesToUpdate:u,attributesToUpdate:j,hasFirestoreData:x}=ps(),{message:h}=he.useApp(),p=f.useMemo(()=>b.orderBy(Object.values(a),"name.en","asc"),[a]),{queryParams:A}=D(),C=A.get("sortBy"),T=f.useMemo(()=>C==="id"?b.orderBy(n,v=>Number(v),"asc"):C==="updatedAt"?b.orderBy(n,v=>t(v).updatedAt,"desc"):C==="fewestAttributesLeft"?b.orderBy(n,v=>{const E=p.length-Object.keys(t(v).attributes).length;return E===0?Number.POSITIVE_INFINITY:E},"asc"):n,[n,C]),[I,y]=f.useState(b.random(0,T.length-1)),d=r(T[I]),V=t(d.id),z=(v,E)=>{if(v==="next"){y(N=>(N+1)%T.length);return}if(v==="previous"){y(N=>(N-1+T.length)%T.length);return}if(v==="random"){y(b.random(0,T.length-1));return}if(v==="first"){y(0);return}if(v==="last"){y(T.length-1);return}if(v==="next10"){y(N=>(N+10)%T.length);return}if(v==="previous10"){y(N=>(N-10+T.length)%T.length);return}if(v==="incomplete"){y(N=>{let O=N+1;for(;O<T.length;){const B=t(T[O]);if(Object.keys(B.attributes).length!==p.length)return O;if(O===T.length-1)return h.info("No more incomplete items found."),N;O++}return N});return}if(v==="goTo"&&E!==void 0){const N=T.indexOf(E);if(N!==-1){y(N);return}h.error(`Item ${E} is not available for attribution.`)}},R=(v,E)=>{m(d.id,{...V,attributes:{...V.attributes,[v]:E}})},L=()=>xe(n.reduce((v,E)=>{const N=t(E);return b.isEmpty(N.attributes)||(Object.keys(N.attributes).length===p.length?N.complete=!0:delete N.complete,v[N.id]=N),v},{}));return e.jsx(ze.Provider,{value:{getItem:r,getItemAttributeValues:t,availableItemIds:n,isLoading:o,error:i,hasResponseData:n.length>0&&!b.isEmpty(a),isDirty:g,itemAttributeValues:V,jumpToItem:z,activeItem:d,onAttributeChange:R,isSaving:l,save:c,attributes:a,attributesList:p,addAttributesToUpdate:m,addMultipleAttributesToUpdate:u,prepareItemsAttributesFileForDownload:L,attributesToUpdate:j,hasFirestoreData:x},children:s})},U=()=>f.useContext(ze);function q({label:s,children:r}){return e.jsxs(F.Text,{children:[s," ",e.jsx(ne,{children:r})]})}function xs(){const{getItemAttributeValues:s,availableItemIds:r,attributesList:t}=U(),{total:n,complete:o,completionPercentage:i,hasDataCount:l,initiatedPercentage:c,progress:m,progressTotal:g,currentProgress:a}=f.useMemo(()=>{const u=r.length;let j=0,x=0,h=0;r.map(C=>s(C)).forEach(({attributes:C})=>{b.isEmpty(C)||(j+=1),Object.values(C).length===t.length&&(x+=1),h+=Object.values(C).length});const A=Object.values(t).length*r.length;return{total:u,complete:x,completionPercentage:u>0?(x/u*100).toFixed(1):0,hasDataCount:j,initiatedPercentage:u>0?Math.floor(j/u*100):0,progress:(h/A*100).toFixed(1),currentProgress:h,progressTotal:A}},[t,r,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{vertical:!0,children:[e.jsx(F.Text,{strong:!0,className:"mb-2",children:"Items Stats"}),e.jsx(q,{label:"Total",children:n}),e.jsxs(q,{label:"Complete",children:[o," (",i,"%)"]}),e.jsxs(q,{label:"Initiated",children:[l," (",c,"%)"]}),e.jsx(F.Text,{strong:!0,className:"mt-4 mb-2",children:"Attributes Stats"}),e.jsx(q,{label:"Total",children:g}),e.jsx(q,{label:"Set",children:a}),e.jsxs(q,{label:"Progress",children:[m,"%"]})]}),e.jsx(Q,{})]})}function bs(){const{jumpToItem:s}=U(),{addParam:r,is:t}=D();return e.jsxs(e.Fragment,{children:[e.jsx(P,{block:!0,onClick:()=>s("random"),type:"primary",children:"Random Item"}),e.jsx(K,{label:"Unset Only",value:t("scope","unset"),onChange:n=>r("scope",n?"unset":""),className:"mt-4"})]})}function js(){const{queryParams:s,addParam:r}=D(),{attributesList:t}=U(),n=f.useMemo(()=>[{label:"Random Attribute",value:"random"},...t.map(({id:o,name:i})=>({label:i.en,value:o}))],[t]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Sampler Attribute",value:s.get("attribute")||"random",onChange:o=>r("attribute",o),options:n}),e.jsx(we,{label:"Sample Size",value:Number(s.get("size")||9),onChange:o=>r("size",String(o)),min:3,max:21,step:3})]})}function Is(){const{queryParams:s,addParam:r}=D(),{attributesList:t}=U(),n=f.useMemo(()=>t.map(({id:o,name:i,...l})=>({label:`${i.en}${l.default?"*":""}`,value:o})),[t]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Attribute",value:s.get("attribute")||"ali",onChange:o=>r("attribute",o),options:n}),e.jsx(se,{label:"Scope",value:s.get("scope")||"unset",onChange:o=>r("scope",o),options:[{value:"unset",label:"Unset"},...it]}),e.jsx(se,{label:"Results per page",value:s.get("pageSize")||12,onChange:o=>r("pageSize",o),options:[12,24,48,96]})]})}function vs(){const{addParam:s,is:r}=D();return e.jsxs(e.Fragment,{children:[e.jsx(K,{label:"Only Complete",value:r("showComplete"),onChange:t=>s("showComplete",t?"true":""),className:"full-width m-0"}),e.jsx(K,{label:"Show Unrelated",value:r("showUnrelated"),onChange:t=>s("showUnrelated",t?"true":""),className:"full-width m-0"}),e.jsx(K,{label:"Show Unclear",value:r("showUnclear"),onChange:t=>s("showUnclear",t?"true":""),className:"full-width m-0"})]})}function ys(){const{addParam:s,is:r}=D();return e.jsx(e.Fragment,{children:e.jsx(K,{label:"Show Glyphs",value:r("showGlyphs"),onChange:t=>s("showGlyphs",t?"true":""),className:"full-width m-0"})})}function As(){const{isDirty:s,save:r,prepareItemsAttributesFileForDownload:t,attributes:n,isSaving:o,attributesToUpdate:i,hasFirestoreData:l}=U(),{queryParams:c,addParam:m}=D(),g=c.get("display")??"classifier";return e.jsxs(st,{children:[e.jsxs(S,{vertical:!0,gap:12,children:[e.jsx(rt,{isDirty:s,onSave:r,isSaving:o,dirt:JSON.stringify(i)}),e.jsx(Ne,{data:()=>Cs(t(),n),fileName:"items-attribute-values.json",disabled:s,hasNewData:l,block:!0})]}),e.jsx(Q,{}),e.jsx(xs,{}),e.jsx(se,{label:"Display",value:g,onChange:a=>m("display",a),options:["classifier","sampler","grouping","comparator","simulator","stats"]}),e.jsx(Q,{}),g==="classifier"&&e.jsx(bs,{}),g==="sampler"&&e.jsx(js,{}),g==="grouping"&&e.jsx(Is,{}),g==="comparator"&&e.jsx(vs,{}),g==="stats"&&e.jsx(ys,{})]})}function Cs(s,r){const t=Object.keys(r).length;Object.keys(s).forEach(o=>{const i=s[o],l=Object.keys(i.attributes);l.forEach(m=>{r[m]||delete i.attributes[m]}),l.length===t?(i.complete=!0,i.score=ke(i),i.reliability=Me(i,t),i.signature=ge(i,r,{onlyRelevant:!0})):(i.complete=void 0,i.score=void 0,i.reliability=void 0,i.signature=void 0)});const n={};return Object.values(s).forEach(o=>{n[o.id]={id:o.id,updatedAt:o.updatedAt,signature:ge(o,r,{delimiter:":"})},o.complete&&(n[o.id].complete=o.complete)}),console.log(n),xe(Pe(s))}function Be(s){const[r,t]=f.useState(!1),n=()=>{t(window.scrollY>300)},o=()=>{window.scrollTo({top:0,behavior:"smooth"})};return Je(()=>(window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)})),e.jsx(P,{className:`go-to-top-button ${r?"visible":""}`,onClick:o,icon:e.jsx(is,{}),...s,children:"Go to Top"})}function $e({title:s,icon:r}){return e.jsx(Se,{title:s,children:r??e.jsx(Le,{})})}const Ae=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC}],Ce=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC,disabled:!0}];function oe({attribute:s,value:r,onChange:t,onlyButtons:n,size:o}){return s?n?e.jsx(Ie.Group,{options:s.limited?Ce:Ae,onChange:({target:{value:i}})=>t(s.id,i),value:r,optionType:"button",buttonStyle:"solid",size:o}):e.jsxs("div",{className:"attribute-button-container__row",children:[e.jsxs("span",{className:"attribute-button-container__label",children:[b.truncate(s.name.en,{length:12})," ",e.jsx($e,{title:s.description.en})]}),e.jsx(Ie.Group,{options:s.limited?Ce:Ae,onChange:({target:{value:i}})=>t(s.id,i),value:r,optionType:"button",buttonStyle:"solid",size:o}),e.jsx("span",{children:e.jsx(de,{style:{color:r&&r>7?"green":"transparent"}})})]},s.id):e.jsx(e.Fragment,{})}function Ts({itemAttributeValues:s,attributes:r}){const{is:t,addParam:n}=D(),o=t("showUnclear"),i=t("showUnrelated"),l=f.useMemo(()=>Ve(Ue(s,r),o,i),[s,r,o,i]),c=t("signs")?_e:Es;return e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(K,{label:"Show Unrelated",value:t("showUnrelated"),onChange:m=>n("showUnrelated",m?"true":""),className:"full-width m-0"}),e.jsx(K,{label:"Show Unclear",value:t("showUnclear"),onChange:m=>n("showUnclear",m?"true":""),className:"full-width m-0"}),e.jsx(K,{label:"Alien Signs",value:t("signs"),onChange:m=>n("signs",m?"true":""),className:"full-width m-0"}),e.jsx(S,{gap:6,wrap:"wrap",className:"item-attribute-value-statement",children:l.map((m,g,a)=>e.jsx(c,{keyVariant:m,attributes:r,firstElement:g===0,lastElement:g===a.length-1},m))})]})}function _e({keyVariant:s,attributes:r,withText:t}){const{key:n,className:o,text:i}=Fe(s);return e.jsxs(S,{vertical:!0,align:"center",children:[e.jsx(Y,{width:50,id:r[n].spriteId,className:ue("item-attribute-alien-sign",`item-attribute-alien-sign--${o}`)}),t&&e.jsxs(S,{wrap:"wrap",justify:"center",align:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},children:[i," ",r[n].name.en.toLowerCase()]})]})}function Es({keyVariant:s,attributes:r,firstElement:t,lastElement:n}){const{key:o,text:i}=Fe(s),l=t?"It's ":"",c=n?".":", ";return e.jsxs(e.Fragment,{children:[l,i," ",r[o].name.en.toLowerCase(),c]})}function Ss({attributesList:s,itemAttributeValues:r}){const{completion:t,isDeterministic:n,value:o,isOpposing:i,relevancy:l}=f.useMemo(()=>{const c=s.length,m=Object.keys(r.attributes).length,g=Math.floor(m/c*100);let a=!1,u=!1,j=0;const x=Object.values(r.attributes).reduce((p,A)=>A<=0?(A===w.UNCLEAR&&(j+=1),A===w.OPPOSITE&&(u=!0,p+=A/2),p):(A===w.DETERMINISTIC&&(a=!0),p+A),0),h=Math.floor((m-j)/c*100);return{completion:g,isDeterministic:a,value:x,isOpposing:u,relevancy:h}},[s,r.attributes]);return e.jsxs("div",{children:[e.jsx(F.Text,{strong:!0,children:"Completion"}),e.jsx(Re,{percent:t,size:"small"}),e.jsx(F.Text,{strong:!0,children:"Stats"}),e.jsxs(S,{vertical:!0,children:[e.jsx(q,{label:"Deterministic",children:n?e.jsx(de,{style:{color:"green"}}):e.jsx(ye,{style:{color:"red"}})}),e.jsx(q,{label:"Opposing",children:i?e.jsx(de,{style:{color:"CornflowerBlue"}}):e.jsx(ye,{style:{color:"grey"}})}),e.jsx(q,{label:"Value",children:o}),e.jsx(Se,{title:"The percentage of conclusive attributes (not unclear)",children:e.jsxs(q,{label:"Reliability",children:[l,"%"]})})]})]})}function ws(){const{activeItem:s,attributesList:r,itemAttributeValues:t,onAttributeChange:n,jumpToItem:o,attributes:i}=U(),{queryParams:l,removeParam:c,is:m}=D(),g=l.get("itemId"),a=l.get("filters");f.useEffect(()=>{g&&(c("itemId"),o("goTo",g))},[g]);const u=m("scope","unset"),j=f.useMemo(()=>{const x=u?r.filter(h=>!t.attributes[h.id]):r;if(a){const h=a.split(",").reduce((p,A)=>(p[A]=!0,p),{});return x.filter(p=>h[p.id])}return x},[u,s.id,a]);return s?e.jsx(Z,{children:e.jsxs("div",{className:"item-attribution-card",children:[e.jsx(ft,{offsetTop:120,className:"item-attribution-card__item",children:e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:s,width:150}),e.jsx(X,{item:s}),e.jsx($,{item:s,language:"en"}),e.jsx($,{item:s,language:"pt"}),e.jsx(Q,{className:"my-2"}),e.jsx(Ss,{attributesList:r,itemAttributeValues:t}),e.jsx(Q,{className:"my-2"}),e.jsx(F.Text,{type:"secondary",children:e.jsx(Ts,{itemAttributeValues:t,attributes:i})})]})}),e.jsx(M,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:j.map(x=>e.jsx(oe,{attribute:x,value:t.attributes[x.id],onChange:n},x.id))})]},`${s.id}`)}):e.jsx(Z,{children:e.jsxs(F.Text,{type:"secondary",children:["No item selected."," ",e.jsx(P,{size:"small",type:"primary",onClick:()=>o("random"),children:"Random Item"})]})})}function Ns(){const{jumpToItem:s}=U();return e.jsxs(M.Compact,{children:[e.jsx(P,{onClick:()=>s("first"),icon:e.jsx(cs,{}),children:"First"}),e.jsx(P,{onClick:()=>s("previous10"),icon:e.jsx(bt,{}),children:"Previous 10"}),e.jsx(P,{onClick:()=>s("previous"),icon:e.jsx(Ht,{}),children:"Previous"}),e.jsxs(P,{onClick:()=>s("next"),children:["Next ",e.jsx(ts,{})]}),e.jsxs(P,{onClick:()=>s("next10"),children:["Next 10 ",e.jsx(jt,{})]}),e.jsxs(P,{onClick:()=>s("last"),children:["Last ",e.jsx(ls,{})]}),e.jsx(fe,{content:e.jsx(Ps,{}),title:"Go to item",children:e.jsx(P,{children:"Go To"})}),e.jsx(P,{onClick:()=>s("incomplete"),children:"Next Incomplete"})]})}function Ps(){const{jumpToItem:s}=U();return e.jsx(xt,{isPending:!1,onFinish:r=>s("goTo",r)})}function Rs(){const{addParam:s,queryParams:r}=D(),{attributesList:t}=U(),n=f.useMemo(()=>t.map(c=>({label:c.name.en,value:c.id})),[t]),o=c=>{s("filters",c.join(","))},i=r.get("filters"),l=e.jsx(te,{mode:"multiple",style:{width:300},options:n,value:i==null?void 0:i.split(","),onChange:c=>o(c),allowClear:!0});return e.jsx(fe,{content:l,title:"Filter Attributes",children:e.jsx(P,{children:i?e.jsx(Gt,{style:{color:"gold"}}):e.jsx(Qt,{})})})}function Os(){const{addParam:s,queryParams:r}=D(),t=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],n=r.get("sortBy"),o=e.jsx(te,{style:{width:120},options:t,value:n,onChange:i=>s("sortBy",i),allowClear:!0});return e.jsx(fe,{content:o,title:"Sort By",children:e.jsx(P,{children:"Sort"})})}function Ls(){const{attributes:s,getItemAttributeValues:r,availableItemIds:t,getItem:n,isLoading:o}=U(),{is:i}=D(),l=i("showComplete"),c=i("showUnclear"),m=i("showUnrelated"),{itemMessages:g,itemMessagesDict:a,grouping:u}=f.useMemo(()=>{if(o)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const j=b.orderBy(t.map(p=>{const A=r(p),C=Ue(A,s);return{item:n(p),itemAttributesValues:A,message:Ve(C,c,m),fullMessage:C}}).filter(({itemAttributesValues:p})=>l?p.complete:!0),["message"],["asc"]),x=j.reduce((p,{message:A,item:{id:C}})=>{const T=A.join(" ");return p[T]===void 0&&(p[T]=[]),p[T].push(C),p},{}),h=Object.values(x).filter(p=>p.length>1);return h.length>0&&console.log("More than one",h),{itemMessages:j,itemMessagesDict:b.keyBy(j,"item.id"),grouping:x}},[s,t,r,n,o,l,c,m]);return{itemMessages:g,itemMessagesDict:a,grouping:u}}function be(){const{queryParams:s,removeParam:r}=D(),t=s.get("drawer"),[n,o]=f.useState(!1),{activeItem:i,attributesList:l,itemAttributeValues:c,onAttributeChange:m,jumpToItem:g}=U(),a=()=>{r("drawer")};f.useEffect(()=>{t&&g("goTo",t)},[t]);const u=f.useMemo(()=>n?l.filter(j=>!c.attributes[j.id]):l,[n,i.id]);return e.jsxs(yt,{open:!!t,title:`Edit: ${i.name.en}`,onClose:a,width:"640px",children:[e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:i,width:50}),e.jsx(X,{item:i})]}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx($,{item:i,language:"en"}),e.jsx($,{item:i,language:"pt"})]}),e.jsx(S,{vertical:!0,gap:6,children:e.jsx(At,{checked:n,onChange:o,checkedChildren:"Unset",unCheckedChildren:"All"})})]}),e.jsx(Q,{className:"my-1"}),e.jsx(M,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(j=>e.jsx(oe,{size:"small",attribute:j,value:c.attributes[j.id],onChange:m},j.id))})]})}function Ds(){const{attributes:s}=U(),{itemMessages:r,grouping:t}=Ls(),{addParam:n}=D(),o=[{title:"Item Id",dataIndex:"item",key:"id",render:i=>e.jsxs("div",{children:[e.jsx(X,{item:i}),e.jsxs(M.Compact,{children:[e.jsx(le,{item:i}),e.jsx(P,{size:"small",shape:"round",onClick:()=>n("drawer",i.id),children:"Drawer"})]})]}),sorter:(i,l)=>Number(i.item.id)-Number(l.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:i=>e.jsx(W,{item:i,width:75})},{title:"Name",dataIndex:"item",key:"name",render:i=>e.jsxs(e.Fragment,{children:[e.jsx($,{item:i,language:"en"}),e.jsx($,{item:i,language:"pt"})]}),sorter:(i,l)=>i.item.name.en.localeCompare(l.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(i,{item:l})=>e.jsx(S,{gap:6,children:i.map((c,m,g)=>e.jsx(_e,{keyVariant:c,attributes:s,firstElement:m===0,lastElement:m===g.length-1,withText:!0},`${c}-${l.id}`))}),sorter:(i,l)=>i.message.join(" ").localeCompare(l.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:i=>i.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:i=>{const l=t[i.join(" ")]??[];return e.jsx(e.Fragment,{children:l.length>1?l.length:"0"})},sorter:(i,l)=>{const c=t[i.message.join(" ")]??[];return(t[l.message.join(" ")]??[]).length-c.length}}];return e.jsxs("div",{className:"my-4",children:[e.jsx(F.Title,{level:5,children:"Item Comparator"}),e.jsx(Oe,{dataSource:r,columns:o,pagination:{showQuickJumper:!0}}),e.jsx(be,{})]})}function Us(){const{attributesList:s,addAttributesToUpdate:r,getItemAttributeValues:t,availableItemIds:n,addMultipleAttributesToUpdate:o}=U(),{queryParams:i,addParam:l}=D(),c=i.get("attribute")??"ali",m=i.get("scope")??"unset",g=i.get("page")??"1",a=i.get("pageSize")??"12",[u,j]=f.useState("ali"),[x,h]=f.useState("unset"),[p,A]=f.useState(null),[C,T]=f.useState("desc"),I=f.useMemo(()=>{const R=n.map(O=>t(O)),L=m==="unset"?void 0:w[m.toUpperCase()],v=R.filter(O=>{var B;return((B=O.attributes)==null?void 0:B[c])===L}).map(O=>O.id),[E,N]=(p??"::").split("::");return b.orderBy(v,[O=>{var B,J;return E==="attribute"?(J=(B=t(O))==null?void 0:B.attributes)==null?void 0:J[N]:!0},O=>E==="prop"?Number(O):!0,O=>{var B;return(B=t(O))==null?void 0:B.updatedAt},O=>Number(O)],[C,"asc","desc","asc"])},[c,m,p,C]),y=f.useMemo(()=>{if(u!==c||x!==m)return j(c),h(m),l("page","1"),I.slice(0,Number(a));const R=(Number(g)-1)*Number(a),L=R+Number(a);return I.slice(R,L)},[g,a,I]),d=s.find(R=>R.id===c),V=(R,L,v)=>{const E=t(R);r(R,{...E,attributes:{...E.attributes,[L]:v}})},z=()=>{o(y.map(R=>{const L=t(R);return L.attributes[c]||(L.attributes[c]=w.UNRELATED),L}))};return{group:I,stats:{total:n.length,group:I.length,percent:Math.round(I.length/n.length*100)},pageIds:y,attribute:d,updateAttributeValue:V,updatePageItemsAsUnrelated:z,sorting:{sortBy:p,setSortBy:A,sortOrder:C,setSortOrder:T},pagination:{total:I.length,current:Number(g),pageSize:Number(a),onChange:R=>l("page",String(R)),onShowSizeChange:(R,L)=>l("pageSize",String(L)),pageSizeOptions:[12,24,48,96]}}}const Fs=(s,r)=>r==="unset"||!r?`${100-s.percent}% done, ${s.group} left`:`${s.percent}%  - ${s.group} items`;function Vs(){const{getItem:s,getItemAttributeValues:r,attributesList:t}=U(),{attribute:n,pageIds:o,updateAttributeValue:i,updatePageItemsAsUnrelated:l,pagination:c,stats:m,sorting:g}=Us(),{queryParams:a,addParam:u}=D(),j=kt("(max-width: 1024px)");if(b.isEmpty(n))return e.jsx(Z,{className:"my-4",children:e.jsx(F.Text,{type:"secondary",children:"No group attribute has been selected."})});const x=e.jsx(S,{justify:"center",children:e.jsx(Tt,{onChange:c.onChange,current:c.current,total:c.total,pageSizeOptions:c.pageSizeOptions,pageSize:c.pageSize,onShowSizeChange:c.onShowSizeChange},"pagination")}),h=e.jsxs(S,{align:"center",children:[e.jsx(F.Text,{className:"mr-2",children:"Sort by"}),e.jsxs(te,{style:{width:120},value:g.sortBy,onChange:C=>g.setSortBy(C),children:[e.jsx(te.Option,{value:null,children:"Last Updated"}),e.jsx(te.Option,{value:"prop::id",children:"Id"}),t.map(C=>e.jsx(te.Option,{value:`attribute::${C.id}`,children:C.name.en},C.id))]})]}),A=(a.get("scope")==="unset"||!a.get("scope"))&&e.jsx(Ct,{title:`Are you sure everything is unrelated to ${n.name.en}?`,onConfirm:l,children:e.jsx(P,{type:"primary",danger:!0,disabled:o.length===0,className:"mx-2",children:"Unrelate Unset Items on Page"})},"unrelate-button");return e.jsxs(Z,{className:"my-4",title:e.jsxs(F.Text,{children:[n==null?void 0:n.name.en," (",Fs(m,a.get("scope")),") -"," ",n.description.en]}),extra:e.jsxs(S,{align:"center",justify:"space-around",className:"mx-2",children:[h,x]}),actions:[e.jsxs(S,{justify:"space-between",children:[A,e.jsx(ks,{},"navigation-buttons")]},"options"),x].filter(Boolean),children:[o.length===0&&e.jsx(ae,{description:"No items found in this scope for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),o.map(C=>{const T=r(C),I=s(C);return e.jsx(Z.Grid,{style:{width:j?"50%":"25%"},children:e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:I,width:75}),e.jsx(X,{item:I}),e.jsxs(M.Compact,{children:[e.jsx(le,{item:I}),e.jsx(P,{size:"small",shape:"round",onClick:()=>u("drawer",I.id),children:"Drawer"})]}),e.jsx($,{item:I,language:"en"}),e.jsx($,{item:I,language:"pt"})]}),e.jsx(oe,{attribute:n,value:T.attributes[n.id],onlyButtons:!0,onChange:(y,d)=>i(I.id,y,d)})]})},`${C}-${T.updatedAt}`)}),e.jsx(be,{})]})}function ks(){var l,c;const{queryParams:s,addParam:r}=D(),{attributesList:t}=U(),n=s.get("attribute"),o=()=>{const m=t.findIndex(a=>a.id===n),g=t[m-1];g&&r("attribute",g.id)},i=()=>{const m=t.findIndex(a=>a.id===n),g=t[m+1];g&&r("attribute",g.id)};return e.jsxs(S,{gap:6,justify:"space-between",className:"mx-8",children:[e.jsx(P,{onClick:o,disabled:n===((l=t[0])==null?void 0:l.id),children:"Previous Attribute"},"previous"),e.jsx(Be,{},"go-to-top"),e.jsx(P,{onClick:i,disabled:n===((c=t[t.length-1])==null?void 0:c.id),children:"Next Attribute"},"next")]})}function Ge(){const{attributesList:s,availableItemIds:r,addAttributesToUpdate:t,getItemAttributeValues:n}=U(),{queryParams:o}=D(),[i,l]=f.useState([]),[c,m]=f.useState(),g=()=>{var T;const x=o.get("attribute")??((T=b.sample(s))==null?void 0:T.id)??"ali",h=s.find(I=>I.id===x)??b.sample(s),p=Number(o.get("size"))||9,A=[],C=b.shuffle(r);for(let I=0;I<C.length&&A.length!==p;I++){const y=C[I];n(y).attributes[x]||A.push(y)}return{selectedAttribute:h,selected:A}},a=()=>{let x=g(),h=0;for(;x.selected.length===0&&h<30;)x=g(),h++;m(x.selectedAttribute),l(x.selected)},u=f.useMemo(()=>c?r.filter(x=>!n(x).attributes[c==null?void 0:c.id]).length:0,[c,r]);return{sampleIds:i,attribute:c,itemsLeftForAttribute:u,onGetSample:a,updateAttributeValue:(x,h,p)=>{const A=n(x);t(x,{...A,attributes:{...A.attributes,[h]:p}})}}}function Ms(){const{getItem:s,getItemAttributeValues:r}=U(),{sampleIds:t,attribute:n,onGetSample:o,updateAttributeValue:i,itemsLeftForAttribute:l}=Ge(),{addParam:c}=D();if(b.isEmpty(t)&&b.isEmpty(n))return e.jsxs(Z,{className:"my-4",children:[e.jsxs(F.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",e.jsx(P,{size:"small",type:"primary",onClick:o,children:"Get Sample"})]}),e.jsx(Q,{}),e.jsx(Te,{})]});const m=t.map(u=>({itemAttributes:r(u),item:s(u)})),g=m.filter(({itemAttributes:u})=>(n==null?void 0:n.id)&&!u.attributes[n.id]),a=()=>{g.forEach(({item:u})=>{n!=null&&n.id&&i(u.id,n.id,-3)})};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsxs(Z,{className:"my-4",title:e.jsxs(F.Text,{children:[n==null?void 0:n.name.en," - ",n==null?void 0:n.description.en," (",l," items left)"]}),actions:[e.jsx(P,{onClick:a,danger:!0,disabled:g.length===0,children:"Mark rest as unrelated"},"1"),e.jsx(P,{type:"primary",ghost:!0,onClick:o,children:"Get New Sample"},"2")],extra:e.jsx(P,{type:"primary",size:"small",onClick:o,children:"Get New Sample"}),children:[e.jsxs(S,{vertical:!0,gap:6,children:[m.length===0&&e.jsx(ae,{description:"No unset items found for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),m.map(({item:u,itemAttributes:j})=>e.jsxs(f.Fragment,{children:[e.jsxs(S,{gap:6,children:[e.jsx(W,{item:u,width:75}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:u}),e.jsxs(M.Compact,{children:[e.jsx(le,{item:u}),e.jsx(P,{size:"small",shape:"round",onClick:()=>c("drawer",u.id),children:"Drawer"})]})]}),e.jsx($,{item:u,language:"en"}),e.jsx($,{item:u,language:"pt"})]}),!!n&&e.jsx(oe,{attribute:n,value:j.attributes[n.id],onChange:(x,h)=>i(u.id,x,h)})]}),e.jsx(Q,{className:"my-1"})]},`${u.id}-${j.updatedAt}`))]}),e.jsx(be,{})]})]})}function Te(){const[s,r]=ht(!1),{addParam:t,removeParam:n}=D(),{sampleIds:o,attribute:i,onGetSample:l,updateAttributeValue:c}=Ge(),{getItem:m,getItemAttributeValues:g}=U(),a=()=>{t("size","1"),r(!0),l()},u=()=>{n("size"),r(!1)},j=o[0],x=m(j),h=g(j);return e.jsxs(S,{className:"mt-4",children:[e.jsx(P,{type:"primary",onClick:a,children:"Single Sampler"}),e.jsxs(Et,{title:e.jsxs(F,{children:["Single Sampler: ",e.jsx("strong",{children:i==null?void 0:i.name.en})]}),open:s,width:"100vw",maskClosable:!1,onOk:u,onClose:u,onCancel:u,cancelButtonProps:{style:{display:"none"}},children:[j&&x&&h&&i&&e.jsxs(S,{gap:6,className:"my-10",wrap:"wrap",children:[e.jsx(W,{item:x,width:150}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:x}),e.jsx(le,{item:x})]}),e.jsx($,{item:x,language:"en"}),e.jsx($,{item:x,language:"pt"})]}),!!i&&e.jsx(oe,{size:"large",attribute:i,value:h.attributes[i.id],onChange:async(p,A)=>{c(x.id,p,A),await ot(500),l()}})]},j),e.jsx(P,{onClick:l,children:"Another Sample"})]})]})}function zs(){const s=ie("items-attributes"),r=ie("items-attribute-values"),[t,n]=f.useState(null),o=()=>{n(Ee(s.data,r.data))},i=()=>{const l={};let c=0;for(;c<300||b.keys(l).length===15;){const m=Ee(s.data,r.data);if(m.valid&&!l[m.setId]&&(l[m.setId]=m),b.keys(l).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(l).map((m,g)=>({...m,number:m.number-g})))};return e.jsxs("div",{className:"my-4",children:[e.jsx(F.Title,{level:3,children:"Daily Simulator"}),e.jsx(F.Paragraph,{children:"Generates a daily game for Alien Communication"}),e.jsxs(M,{children:[e.jsx(P,{type:"primary",onClick:o,children:"Generate"}),e.jsx(P,{onClick:i,children:"Generate List"})]}),e.jsx("div",{children:!!t&&e.jsxs(M,{direction:"vertical",children:[e.jsx(F.Title,{level:5,children:t==null?void 0:t.setId}),!(t!=null&&t.valid)&&e.jsx(Ze,{type:"error",message:"Invalid game"}),e.jsx(M,{direction:"vertical",children:t==null?void 0:t.attributes.map(l=>e.jsxs(S,{gap:8,children:[e.jsx(Y,{id:l.spriteId,width:50}),l.itemsIds.map(c=>e.jsx(ve,{id:c||"0",width:50},c))]},l.id))}),e.jsx(Q,{className:"my-1"}),e.jsx(M,{direction:"horizontal",children:t==null?void 0:t.requests.map(l=>e.jsxs(S,{vertical:!0,children:[e.jsx(Y,{id:l.spritesIds[2],width:50}),e.jsx(Y,{id:l.spritesIds[1],width:50}),e.jsx(Y,{id:l.spritesIds[0],width:50})]},l.itemId))}),e.jsx(Q,{className:"my-1"}),e.jsx(M,{direction:"horizontal",children:t==null?void 0:t.itemsIds.map(l=>e.jsx(ve,{id:l||"0",width:50},l))})]},t==null?void 0:t.setId)})]})}const Ee=(s,r)=>{const t=b.values(s).filter(d=>!d.limited||d.id==="sol"),n=b.shuffle(b.values(r).filter(d=>d.complete)),o=b.shuffle(ct(38,0)),i=b.sampleSize(t,3).map(d=>({...d,spriteId:`${o.pop()}`})),l=[],c=[],m=[],g=[],a=[],u=[],j=[],x=[];n.forEach(d=>{const V=[w.DETERMINISTIC,w.RELATED],z=d.attributes[i[0].id]===w.DETERMINISTIC,R=V.includes(d.attributes[i[0].id]),L=d.attributes[i[0].id]===w.UNRELATED,v=d.attributes[i[1].id]===w.DETERMINISTIC,E=V.includes(d.attributes[i[1].id]),N=d.attributes[i[1].id]===w.UNRELATED,O=d.attributes[i[2].id]===w.DETERMINISTIC,B=V.includes(d.attributes[i[2].id]),J=d.attributes[i[2].id]===w.UNRELATED;if(L&&N&&J)return x.push(d.id);z&&N&&J&&l.push(d.id),L&&v&&J&&c.push(d.id),L&&N&&O&&m.push(d.id),R&&E&&J&&g.push(d.id),R&&N&&B&&a.push(d.id),L&&E&&B&&u.push(d.id),R&&E&&B&&j.push(d.id)});const h=i.map(d=>({id:d.id,name:d.name.pt,description:d.description.pt,spriteId:d.spriteId,itemsIds:[]}));h[0].itemsIds=b.sampleSize(l,l.length>3?3:Math.max(l.length-1,1)),h[1].itemsIds=b.sampleSize(c,c.length>3?3:Math.max(l.length-1,1)),h[2].itemsIds=b.sampleSize(m,m.length>3?3:Math.max(l.length-1,1));const p=[];h.forEach(d=>{p.push(...d.itemsIds)});const A=[];g.length>0&&A.push({spritesIds:[i[0].spriteId,i[1].spriteId],itemId:b.sample(g)??""}),a.length>0&&A.push({spritesIds:[i[0].spriteId,i[2].spriteId],itemId:b.sample(a)??""}),u.length>0&&A.push({spritesIds:[i[1].spriteId,i[2].spriteId],itemId:b.sample(u)??""}),j.length>0&&A.push({spritesIds:i.map(d=>d.spriteId),itemId:b.sample(j)??""});const C=[];l.length>0&&C.push({spritesIds:[i[0].spriteId],itemId:l.filter(d=>!p.includes(d))[0]}),c.length>0&&C.push({spritesIds:[i[1].spriteId],itemId:c.filter(d=>!p.includes(d))[0]}),m.length>0&&C.push({spritesIds:[i[2].spriteId],itemId:m.filter(d=>!p.includes(d))[0]}),console.log({attributeA:l,attributeB:c,attributeC:m,attributeAB:g,attributeAC:a,attributeBC:u,attributeABC:j}),console.log("COMPLEX REQUEST SIZE",A.length),console.log("SIMPLE REQUEST SIZE",C.length);let T=b.sampleSize(A,4);console.log("REQUEST SIZE",T.length),T.length<3&&T.push(...b.sampleSize(C,4-T.length)),T.length<4&&console.warn("Not enough requests"),T=b.shuffle(T);const I=T.map(d=>d.itemId),y={id:"2024-00-00",setId:h.map(d=>d.id).sort().join("-"),number:0,type:"comunicacao-alienigena",attributes:h,requests:T,solution:I.join("-"),itemsIds:b.shuffle([...I,x[0],x[1],x[2],x[3]]).filter(Boolean),valid:!1};return y.valid=[y.attributes.length===3,y.requests.length===4,y.itemsIds.length>5,y.attributes.every(d=>d.itemsIds.length>0),y.requests.every(d=>d.itemId)].every(Boolean),console.log(y),y},Bs=["","I","II","III","IV","V"];function $s(){const{attributes:s,availableItemIds:r,getItemAttributeValues:t,getItem:n}=U(),{message:o}=he.useApp(),[i,l]=f.useState(25),[c,m]=f.useState(80),[g,a]=f.useState(!1),[u,j]=f.useState([]),[x,h]=f.useState([]),[p,A]=f.useState(null),[C,T]=f.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),I=()=>{const d={},V=b.shuffle(r);for(;Object.values(d).length<i;){const v=V.pop();if(!v)break;const E=t(v);E&&(!E.complete||!E.reliability||E.reliability<c||!g&&n(v).nsfw||(E.signature&&!d[E.signature]?d[E.signature]=v:console.log("Item has identical key to another item. Skipping.",n(v).name.en)))}const z=Object.values(d);z.length<i&&o.error(`Could not generate sample. Got only ${z.length} items`),j(b.sortBy(z,v=>Number(v)));const R=_s(z.map(v=>t(v)),25,s);if(R.length<25){const v=b.keys(s).filter(O=>!R.includes(O)),N=b.sortBy(v,O=>s[O].priority).slice(0,25-R.length);console.log("Adding more attributes by priority",N),R.push(...N)}const L=R.reduce((v,E)=>(z.forEach(N=>{const O=t(N);if(O)switch(O.attributes[E]){case w.RELATED:v.relatedCount[E]=(v.relatedCount[E]||0)+1;break;case w.DETERMINISTIC:v.deterministicCount[E]=(v.deterministicCount[E]||0)+1;break;case w.UNCLEAR:v.unclearCount[E]=(v.unclearCount[E]||0)+1;break;case w.OPPOSITE:v.oppositeCount[E]=(v.oppositeCount[E]||0)+1;break}}),v),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});h(R.sort().map(v=>({...s[v],relatedCount:L.relatedCount[v],deterministicCount:L.deterministicCount[v],unclearCount:L.unclearCount[v],oppositeCount:L.oppositeCount[v]})))},y=d=>{T(V=>({...V,[d]:!V[d]}))};return e.jsxs("div",{className:"my-4",children:[e.jsx(F.Title,{level:3,children:"Simulator"}),e.jsx(F.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(se,{label:"Grid Size",value:i,onChange:d=>l(d),options:[16,25]}),e.jsx(we,{label:"Reliability Threshold",value:c,onChange:d=>m(d),step:5,min:10,max:100}),e.jsx(K,{label:"NSFW",value:g,onChange:a}),e.jsx(P,{onClick:I,type:"primary",children:"Get Sample Board"})]}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(ce,{label:"Show Id",value:!!C.id,onChange:()=>y("id")}),e.jsx(ce,{label:"Show Name (EN)",value:!!C.nameEn,onChange:()=>y("nameEn")}),e.jsx(ce,{label:"Show Name (PT)",value:!!C.namePt,onChange:()=>y("namePt")}),e.jsx(ce,{label:"Show Reliability",value:!!C.reliability,onChange:()=>y("reliability")})]}),e.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(i)}, 1fr)`},children:u.map(d=>{const V=n(d),z=t(d);return e.jsxs(M,{direction:"vertical",className:ue("simulator-grid__entry",p&&z.attributes[p]>0&&"simulator-grid__entry--highlighted"),align:"center",children:[e.jsxs(M,{children:[e.jsxs(S,{vertical:!0,children:[C.id&&e.jsx(X,{item:V}),C.reliability&&e.jsx("span",{children:e.jsx(tt,{prefix:e.jsx(Jt,{}),placeholder:"Reliability",variant:"borderless",size:"small",value:z.reliability,readOnly:!0,style:{width:"8ch"},formatter:R=>`${R}%`})}),C.id&&e.jsx(le,{item:V})]}),e.jsx(W,{item:V,width:50})]}),C.nameEn&&e.jsx($,{item:V,language:"en"}),C.namePt&&e.jsx($,{item:V,language:"pt"})]},d)})}),e.jsx("div",{className:"simulator-grid my-4",children:x.map(d=>e.jsxs(St,{className:ue("simulator-grid__entry","simulator-grid__button",p===d.id&&"simulator-grid__entry--highlighted"),onClick:()=>A(d.id),children:[d.name.en," ",Bs[d.level],e.jsxs(S,{gap:6,justify:"center",className:"my-1",children:[e.jsxs("span",{children:[e.jsx(zt,{style:{color:d.deterministicCount?"dodgerblue":void 0}})," ",d.deterministicCount??0]}),e.jsxs("span",{children:[e.jsx(Wt,{style:{color:d.relatedCount?"green":void 0}})," ",d.relatedCount??0]}),e.jsxs("span",{children:[e.jsx($t,{style:{color:d.oppositeCount?"red":void 0}})," ",d.oppositeCount??0]}),e.jsxs("span",{children:[e.jsx(Le,{style:{color:d.unclearCount?"gold":void 0}})," ",d.unclearCount??0]})]})]},d.id))}),e.jsx(zs,{})]})}function _s(s,r,t){const n={},o={};s.forEach(h=>{h&&Object.keys(h.attributes).forEach(p=>{h.attributes[p]>0&&(n[p]=(n[p]||0)+1),h.attributes[p]===w.DETERMINISTIC&&(o[p]=!0,n[p]=(n[p]||0)+2),h.attributes[p]===w.OPPOSITE&&(n[p]=(n[p]||0)+1)})});const i={1:0,2:0,3:0,4:0};function l(h){return h.filter(p=>(i[t[p].level]++,i[4]>1?(console.log("Discarding level 4 attribute",p),!1):!0))}const c=l(Object.keys(o)),m=l(b.keys(n).filter(h=>!c.includes(h)));if(console.log({levelCount:i}),r===c.length)return console.log("All keys are deterministic"),c;if(console.log(n),c.length===0)return[];const g=c.reduce((h,p)=>{const A=n[p];return h[A]||(h[A]=[]),h[A].push(p),h},{}),a=b.keys(g).sort((h,p)=>Number(p)-Number(h));console.log({sortedDeterministicTiedGroupsKeys:a});const u=m.reduce((h,p)=>{const A=n[p];return h[A]||(h[A]=[]),h[A].push(p),h},{});console.log(u);const j=b.keys(u).sort((h,p)=>Number(p)-Number(h)),x=[];for(const h of a){if(x.length===r)break;x.push(...b.sampleSize(g[h],r-x.length))}for(const h of j){if(x.length===r)break;x.push(...b.sampleSize(u[h],r-x.length))}return x}function Gs(){const{attributes:s}=U(),r=[{key:"1",label:"All Attributes",children:e.jsx(ee,{type:"all"})},{key:"2",label:"Default",children:e.jsx(ee,{type:"default"})},{key:"3",label:"Custom",children:e.jsx(ee,{type:"custom"})},{key:"4",label:"Limited",children:e.jsx(ee,{type:"limited"})},{key:"5",label:"Specific",children:e.jsx(ee,{type:"specific"})},{key:"6",label:"Opposite",children:e.jsx(ee,{type:"opposite"})}];return e.jsxs("div",{className:"my-4",children:[e.jsxs(S,{justify:"space-between",align:"center",children:[e.jsx(F.Title,{level:5,children:"Stats"}),e.jsx(Ne,{data:()=>Qs(s),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),e.jsx(wt,{defaultActiveKey:"1",items:r})]})}const qs=(s,r)=>{let t=0,n=0,o=0,i=0,l=0,c=0,m=0,g=0;r.forEach(({attributes:I})=>{if(I[s.id]){t++;const y=I[s.id];y===10?n++:y===5?o++:y===0||!y?i++:y===-1?l++:y===-3?c++:y===-10&&m++,y>0&&g++}});const a=r.length,u=t/a*100,j=n/a*100,x=o/a*100,h=i/a*100,p=l/a*100,A=c/a*100,C=m/a*100,T=g/a*100;return{completionPercentage:u.toFixed(1),tensPercentage:j.toFixed(1),fivesPercentage:x.toFixed(1),zerosPercentage:h.toFixed(1),negativeOnesPercentage:p.toFixed(1),negativeThreesPercentage:A.toFixed(1),negativeTensPercentage:C.toFixed(1),positivePercentage:T.toFixed(1)}};function ee({type:s}){const{availableItemIds:r,getItemAttributeValues:t,attributesList:n}=U(),o=We(),{is:i}=D(),l=f.useMemo(()=>{const a=new Array(65).fill(0).map((j,x)=>x),u=n.map(j=>j.spriteId);return a.filter(j=>!u.includes(`sign-${j}`))},[n]),c=f.useMemo(()=>s==="default"?n.filter(a=>a.default):s==="custom"?n.filter(a=>!a.default):s==="limited"?n.filter(a=>a.limited):s==="specific"?n.filter(a=>a.specific):s==="opposite"?n.filter(a=>a.oppositeId):n,[n,s]),m=f.useMemo(()=>{const a=r.map(u=>t(u));return c.map(u=>({...u,...qs(u,a)}))},[c,r,t]),g=[{title:"Attribute",dataIndex:"name",key:"name",render:(a,u)=>e.jsxs(S,{align:"center",gap:8,children:[i("showGlyphs")&&e.jsx(Y,{id:u.spriteId,width:30}),a.en,u.default&&e.jsx(ne,{className:"ml-1",children:"default"}),u.limited&&e.jsx(ne,{className:"ml-1",children:"limited"}),(u.specific||u.parentId)&&e.jsx(ne,{className:"ml-1",children:"specific"}),u.oppositeId&&e.jsx(ne,{className:"ml-1",children:e.jsx(rs,{})}),e.jsx($e,{title:u.description.en})]}),sorter:(a,u)=>a.name.en.localeCompare(u.name.en)},{title:e.jsx(Nt,{}),dataIndex:"spriteId",key:"spriteId",render:a=>e.jsx(Y,{id:a,width:18,padding:0})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(a,u)=>a.priority-u.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.positivePercentage)-Number.parseFloat(u.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(a,u)=>u.limited?"-":`${a}%`,sorter:(a,u)=>Number.parseFloat(a.tensPercentage)-Number.parseFloat(u.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.fivesPercentage)-Number.parseFloat(u.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeOnesPercentage)-Number.parseFloat(u.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeThreesPercentage)-Number.parseFloat(u.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeTensPercentage)-Number.parseFloat(u.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:a=>e.jsx(Re,{percent:Number.parseFloat(a),size:"small"}),sorter:(a,u)=>Number.parseFloat(a.completionPercentage)-Number.parseFloat(u.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:a=>e.jsx(Pt,{count:4,value:a,disabled:!0}),sorter:(a,u)=>a.level-u.level},{title:"Actions",key:"actions",render:a=>e.jsx(M,{children:e.jsxs(M.Compact,{children:[e.jsx(P,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?display=grouping&attribute=${a.id}&page=1`),children:"Grouping"}),e.jsx(P,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?display=sampler&attribute=${a.id}&size=6`),children:"Sample"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(F.Paragraph,{children:["Total: ",m.length]}),e.jsx(Oe,{columns:g,dataSource:m,pagination:!1,rowKey:"id",size:"small"}),e.jsx(S,{wrap:"wrap",gap:8,children:l.map(a=>e.jsxs("div",{children:["#",a,e.jsx(Y,{id:`sign-${a}`},a)]},a))})]})}function Qs(s){const r=b.cloneDeep(s);return xe(Pe(r),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Ks(){const{queryParams:s}=D(),r=s.get("display")??"classifier";return r==="classifier"?e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"my-4",gap:8,align:"center",wrap:!0,children:[e.jsx(Ns,{}),e.jsx(Rs,{}),e.jsx(Os,{}),e.jsx(mt,{path:"/tdr/itemsAttributeValues"})]}),e.jsx(ws,{}),e.jsx(S,{justify:"flex-end",className:"my-4",children:e.jsx(Be,{})})]}):r==="sampler"?e.jsx(Ms,{}):r==="grouping"?e.jsx(Vs,{}):r==="comparator"?e.jsx(Ds,{}):r==="simulator"?e.jsx($s,{}):r==="stats"?e.jsx(Gs,{}):e.jsx(ae,{className:"my-10",description:"Unknown display has been selected"})}function Hs(){const{isLoading:s,error:r,hasResponseData:t}=U();return e.jsx(Xe,{title:"Items",subtitle:"Attribution",children:e.jsxs(je,{hasSider:!0,children:[e.jsx(nt,{children:e.jsx(As,{})}),e.jsx(je.Content,{className:"content",children:e.jsx(et,{isLoading:s,error:r,hasResponseData:t,children:e.jsx(Ks,{})})})]})})}function Xr(){return e.jsx(fs,{children:e.jsx(Hs,{})})}export{Xr as default};
