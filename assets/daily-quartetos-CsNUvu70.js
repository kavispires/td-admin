import{u as Q,D as b,a as G}from"./useParsedHistory-Da35IewS.js";import{u as S}from"./useTDResource-CGE34CFt.js";import{l as u}from"./useBaseUrl-CGDFxb01.js";import{r as L}from"./index-DyjSH4OM.js";import{c as M}from"./constants-B1K3jPng.js";import"./warnings-DXIMNqu4.js";const C=(o,a,r,i)=>{const[l]=Q(b.QUARTETOS,i),d=S("daily-quartet-sets",{enabled:o}),n=S("items-groups",{enabled:o});return{entries:L.useMemo(()=>!o||d.isLoading||n.isLoading||!l?{}:R(r,l,a,d.data,n.data),[o,a,l,r,d.dataUpdatedAt,n.dataUpdatedAt]),isLoading:d.isLoading||n.isLoading}},R=(o,a,r,i,l)=>{console.count("Creating Quartetos...");const d=u.shuffle(Object.values(i).filter(m=>m.itemsIds.length>=4&&!a.used.includes(m.id)&&!m.flagged));let n=a.latestDate;const t={},f=j(d,5);return Array.from({length:o}).forEach((m,h)=>{const c=[],g={};for(let e=0;e<3;e++){const s=f[h*3+e];s&&(c.push({id:s.id,title:s.title,itemsIds:u.sampleSize(s.itemsIds,4),level:s.level??1}),s.itemsIds.forEach(D=>{g[D]=!0}))}const I=u.shuffle(Object.values(l)).filter(e=>e.itemsIds.length>=6&&!e.itemsIds.some(s=>g[s]));if(I.length>0){const e=u.sampleSize(I,1)[0];c.push({id:e.id,title:`${u.capitalize(e.name[r])}*`,itemsIds:u.sampleSize(e.itemsIds,4),level:1})}if(c.length<4)throw new Error("Kaboom! Could not get 4 sets");const v=Math.ceil(c.reduce((e,s)=>e+s.level,0)/c.length),E=u.orderBy(c,["level"],["asc"]).map((e,s)=>(e.level=s,e)),y=c.map(e=>e.id).join(M),A=u.shuffle(c.flatMap(e=>e.itemsIds)),p=G(n);n=p,t[p]={id:p,number:a.latestNumber+h+1,setId:y,type:"quartetos",grid:A,difficulty:v,sets:E}}),t},j=(o,a=5)=>{if(o.length<=1)return o;const r=[o[0]],i=o.slice(1);for(;i.length>0;){const l=new Set,d=Math.min(r.length,a);for(let t=1;t<=d;t++)r[r.length-t].itemsIds.forEach(m=>{l.add(m)});let n=!1;for(let t=0;t<i.length;t++){const f=i[t];if(!f.itemsIds.some(h=>l.has(h))){r.push(f),i.splice(t,1),n=!0;break}}!n&&i.length>0&&(r.push(i[0]),i.splice(0,1))}return r};export{C as u};
