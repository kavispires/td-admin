import{r as p,a as L,j as e,T as g,B as b,D as q,P as Q,L as E}from"./index-CiF5--2a.js";import{D as J}from"./DataLoadingWrapper-DcZ8aPWb.js";import{I as D}from"./Item-n7HVLcpj.js";import{u as R}from"./useQueryParams-BPSENYYW.js";import{l as f}from"./lodash-D0O7dYQ-.js";import{u as W}from"./useCopyToClipboardFunction-CmOOqtYG.js";import{u as A}from"./useTDResource-BEVaMQKZ.js";import{u as G}from"./useTableExpandableRows-CK-U-qUy.js";import{u as K}from"./useTablePagination-CpF-MMCU.js";import{r as w,h as v,i as _,a as H}from"./index-B70_2-pz.js";import{C as X}from"./CopyIdsButton-C4tIiQyB.js";import{I as Y}from"./ItemsTypeahead-D-t1j6Wc.js";import{I as P}from"./index-Df8Fa_h3.js";import{F as j}from"./index-C2UcdlrS.js";import{R as U}from"./PlusOutlined-DJhJqBFW.js";import{F as z}from"./Table-mDpHyuoe.js";import{S as N}from"./index-0mQ0wxZD.js";import{P as V}from"./index-bwOVXcX6.js";import{R as Z}from"./DeleteFilled-BRL6vp_5.js";import{T as ee}from"./TransparentButton-C7TjtNEf.js";import{u as te,P as se}from"./useGridPagination-CKVmuI_2.js";import{S as re}from"./index-BiZXzEtx.js";import{D as ae}from"./index-D_4y-aMM.js";import{S as ne}from"./index-DK7iRz0b.js";import{T as oe}from"./index-CItXObol.js";import{D as ie}from"./DownloadButton-BlsojvSw.js";import{S as le}from"./SaveButton-s1jXsG7T.js";import{S as ce}from"./SiderContent-CroB5yCP.js";import{F as me}from"./FilterEntries-C4iDCHm7.js";import{L as B}from"./LanguageFlag-BlOVCz5x.js";import{F as C}from"./index-B1eqNN9Q.js";import{M as de}from"./index-UlL6vzO2.js";import{R as pe}from"./TableOutlined-DiOvpn60.js";import{P as ue}from"./useBaseUrl-CgXHlTLh.js";import{u as he}from"./useResourceFirebaseData-CQQ-E8Rm.js";import"./constants-B4FgzbO3.js";import"./useDebounce-CP0-fpHx.js";import"./Input-C-KfAM2p.js";import"./gapSize-U1swVQyS.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-BjA8dbFX.js";import"./index-DoNNsqTe.js";import"./index-CpJD0T27.js";import"./scrollTo-BaPpjTa9.js";import"./Pagination-bheZeHQM.js";import"./extendsObject-keMuGWqj.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-0vKyCLNP.js";import"./useGetFirebaseDoc-DwdkTEca.js";import"./useUpdateFirebaseDoc-ThYrHW5R.js";import"./useMutation-B2Ymi21Q.js";var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM512 533c-85.5 0-155.6 67.3-160 151.6a8 8 0 008 8.4h48.1c4.2 0 7.8-3.2 8.1-7.4C420 636.1 461.5 597 512 597s92.1 39.1 95.8 88.6c.3 4.2 3.9 7.4 8.1 7.4H664a8 8 0 008-8.4C667.6 600.3 597.5 533 512 533z"}}]},name:"frown",theme:"outlined"};function F(){return F=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},F.apply(this,arguments)}const fe=(t,s)=>p.createElement(L,F({},t,{ref:s,icon:xe})),je=p.forwardRef(fe);function ge({onUpdateBatch:t}){const[s,a]=p.useState(""),n=()=>{try{const c=s.replace(/^\[|\]$/g,"").split(/\s*,\s*/).map(l=>l.replace(/^"|"$/g,"")).filter(Boolean);t(c),a("")}catch(r){console.error(r)}};return e.jsxs(g.Paragraph,{children:["Paste IDs",e.jsx(P.TextArea,{value:s,onChange:r=>a(r.target.value)}),e.jsx(b,{size:"small",onClick:n,children:"Add"})]})}function Se({disc:t,addEntryToUpdate:s}){const a=r=>{s(t.id,{...t,itemsIds:w(v([...t.itemsIds,r]))})},n=r=>{s(t.id,{...t,itemsIds:w(v([...t.itemsIds,...r]))})};return e.jsxs(j,{gap:16,children:[e.jsxs("div",{children:[e.jsx(g.Paragraph,{children:"Add Item"}),e.jsx(Y,{onFinish:a})]}),e.jsx(ye,{onUpdate:a,disc:t}),e.jsx(ge,{onUpdateBatch:n})]})}function ye({onUpdate:t,disc:s}){const a=A("items"),[n,r]=p.useState([...s.itemsIds]),c=i=>{const h=f.difference(Object.keys(a.data??{}),n);return f.sampleSize(h,i)},[l,u]=p.useState(c(5)),o=()=>{const i=c(30);u(i),r([...n,...i])};return p.useEffect(()=>{r([...s.itemsIds])},[s.id]),p.useEffect(()=>{l.length===0&&(o(),r([...s.itemsIds]))},[l]),e.jsxs("div",{children:[e.jsxs(g.Paragraph,{children:["Random Sample"," ",e.jsx(b,{size:"small",onClick:o,children:"Get"})]}),e.jsx(j,{gap:16,wrap:"wrap",children:l.map((i,h)=>e.jsxs(j,{gap:2,vertical:!0,children:[e.jsx(D,{id:i,width:60}),e.jsxs(j,{justify:"center",gap:6,children:[e.jsx(g.Text,{children:i}),e.jsx(b,{size:"small",shape:"circle",onClick:()=>t(i),children:e.jsx(U,{})})]})]},`sample-${i}-${h}`))})]})}function be(t){return f.orderBy(t,[s=>s.title.en]).map(s=>({...s,itemsIds:f.orderBy(s.itemsIds,a=>Number(a))}))}function Ie({data:t,addEntryToUpdate:s}){const a=A("items"),n=p.useMemo(()=>be(Object.values(t)),[t]),r=W(),c=K({total:n.length,showQuickJumper:!0}),l=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,i)=>o.title.en.localeCompare(i.title.en)},{title:"Title",dataIndex:"title",key:"title",sorter:(o,i)=>o.title.en.localeCompare(i.title.en),render:(o,i)=>e.jsx(we,{value:o,disc:i,addEntryToUpdate:s})},z.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(o,i)=>e.jsx(ve,{disc:i,itemsIds:v(o),copyToClipboard:r,addEntryToUpdate:s})},{title:"Count",dataIndex:"itemsIds",key:"count",render:o=>w(o).filter(Boolean).length}],u=G({maxExpandedRows:1,expandedRowRender:o=>e.jsx(Se,{disc:o,addEntryToUpdate:s}),rowExpandable:()=>a.isSuccess});return e.jsx(N,{direction:"vertical",children:e.jsx(z,{columns:l,dataSource:n,pagination:c,rowKey:"id",expandable:u})})}function Ce({disc:t,addEntryToUpdate:s,itemId:a}){const n=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(r=>r!==a)})};return e.jsx(V,{title:"Are you sure you want to remove this item?",onConfirm:n,okText:"Yes",cancelText:"No",children:e.jsx(b,{icon:e.jsx(Z,{}),size:"small",type:"text"})})}function we({value:t,disc:s,addEntryToUpdate:a}){const n=(r,c)=>{a(s.id,{...s,title:{...s.title,[c]:r}})};return e.jsxs(N,{direction:"vertical",size:"small",children:[e.jsx(g.Text,{editable:{onChange:r=>n(r,"pt")},children:String(t.pt)}),e.jsx(g.Text,{editable:{onChange:r=>n(r,"en")},children:String(t.en)})]})}function ve({disc:t,itemsIds:s,copyToClipboard:a,addEntryToUpdate:n}){return e.jsxs(j,{gap:6,wrap:"wrap",children:[s.map((r,c)=>e.jsxs(j,{gap:2,vertical:!0,children:[e.jsx(D,{id:r,width:60}),e.jsxs(j,{justify:"center",children:[e.jsx(g.Text,{onClick:()=>a(r),children:r}),e.jsx(Ce,{disc:t,addEntryToUpdate:n,itemId:r})]})]},`${t.title}-${r}-${c}`)),e.jsx(X,{ids:s})]},`items-${t.title}`)}function De({data:t,addEntryToUpdate:s}){const{is:a,addParam:n}=R(),r=A("items"),[c,l]=p.useMemo(()=>{if(r.data){const x=Object.values(t).reduce((d,y)=>(y.itemsIds.forEach(k=>{d[k]||(d[k]=[]),d[k].push(y.id)}),d),{});Object.keys(r.data).reduce((d,y)=>(d[y]===void 0&&(d[y]=[]),d[y].push(y),d),{});const T=["black","blue","brown","green","orange","pink","purple","red","white","yellow"],M=Object.keys(r.data).filter(d=>x[d]===void 0||x[d].length===1&&T.includes(x[d][0])).map(d=>r.data[d]);return[x,M]}return[{},[]]},[t,r.data]),u=a("onlyOrphans"),{page:o,pagination:i}=te({data:u?l:Object.values(r.data),defaultPageSize:64,resetter:u?"orphans":"all"}),[h,S]=p.useState(null),[m,I]=p.useState(null),O=p.useMemo(()=>Object.values(t).sort((x,T)=>x.title.pt.localeCompare(T.title.pt)),[t]);return e.jsxs(e.Fragment,{children:[e.jsxs(g.Title,{level:4,children:["Orphan Items (",l.length,")"]}),e.jsx(N,{className:"mb-4",children:e.jsx(re,{checkedChildren:"Only Orphans",unCheckedChildren:"All Items",onChange:x=>n("onlyOrphans",x,!1)})}),e.jsx(ae,{title:"Add Item to Set",open:!!h,onClose:()=>S(null),children:!!h&&e.jsx(Oe,{activeItem:h,activeItemSets:(c==null?void 0:c[h])??[],latestSetId:m,setLatestSetId:I,sortedSets:O,data:t,addEntryToUpdate:s})}),e.jsx(se,{pagination:i,className:"full-width",children:e.jsx(j,{gap:16,wrap:"wrap",children:o.map(x=>e.jsx(ee,{onClick:()=>S(x.id),children:e.jsx(D,{id:x.id})},x.id))})})]})}function Oe({activeItem:t,activeItemSets:s,setLatestSetId:a,sortedSets:n,data:r,addEntryToUpdate:c}){const[l,u]=p.useState(s);if(!t)return null;const o=m=>{u(m)},i=m=>{u(I=>I.includes(m)?I.filter(O=>O!==m):[...I,m])},h=()=>{l.forEach(m=>{c(m,{...r[m],itemsIds:[...r[m].itemsIds,t]})}),a(l[l.length-1])},S=n.map(m=>({value:m.id,label:m.title.pt}));return e.jsxs(j,{vertical:!0,gap:16,children:[e.jsx(D,{id:t}),e.jsx(b,{type:"primary",onClick:h,disabled:f.isEqual(s,l),children:"Save to Sets"}),e.jsx(ne,{onChange:o,mode:"tags",value:l,options:S}),e.jsx(j,{wrap:"wrap",gap:8,children:n.map(m=>e.jsx(oe,{onClick:()=>i(m.id),color:l.includes(m.id)?"gold":void 0,children:m.title.pt},m.id))})]})}function Te({data:t,addEntryToUpdate:s}){const{is:a,queryParams:n}=R();return e.jsxs(e.Fragment,{children:[(a("display","sets")||!n.has("display"))&&e.jsx(Ie,{data:t,addEntryToUpdate:s}),(a("display","orphans")||!n.has("display"))&&e.jsx(De,{data:t,addEntryToUpdate:s})]})}function ke({addEntryToUpdate:t,ids:s}){const[a,n]=p.useState(!1),[r]=C.useForm(),c=o=>{const i=f.camelCase(o.name);t(f.camelCase(i),{id:i,title:{pt:o.nome,en:o.name},itemsIds:[]})},l=C.useWatch("name",r),u=p.useMemo(()=>{const o={};if(l&&l.length>2){const i=f.camelCase(l);if(i)try{_.findBestMatch(i,s).ratings.forEach(S=>{S.rating>.4&&(o[S.target]=S.rating)})}catch(h){console.error(h)}}return Object.keys(o)},[l,s]);return e.jsxs(e.Fragment,{children:[e.jsx(b,{type:"dashed",block:!0,onClick:()=>n(!0),children:"Add New Set"}),e.jsxs(de,{title:"Add New Set",open:a,onOk:r.submit,onCancel:()=>n(!1),maskClosable:!1,okText:"Add",okButtonProps:{htmlType:"submit"},children:[e.jsxs(C,{form:r,onFinish:c,children:[e.jsx(C.Item,{name:"nome",label:"Nome",rules:[{required:!0}],children:e.jsx(P,{prefix:e.jsx(B,{language:"pt",width:"1em"}),placeholder:"Name in pt",size:"small"})}),e.jsx(C.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(P,{prefix:e.jsx(B,{language:"en",width:"1em"}),placeholder:"Name in en",size:"small"})})]}),e.jsx(g.Text,{children:"Similar:"}),e.jsx("ul",{children:u.map(o=>e.jsx("li",{children:o},o))})]})]})}function Pe({data:t,save:s,isDirty:a,isSaving:n,entriesToUpdate:r,addEntryToUpdate:c,hasFirestoreData:l}){const{queryParams:u,addParams:o}=R();return e.jsxs(ce,{children:[e.jsxs(j,{vertical:!0,gap:12,children:[e.jsx(le,{isDirty:a,onSave:s,isSaving:n,dirt:JSON.stringify($(r))}),e.jsx(ie,{data:()=>Fe(t),fileName:"daily-disc-sets.json",disabled:a,hasNewData:l,block:!0})]}),e.jsx(q,{}),e.jsx(me,{label:"Display",value:u.get("display")??"sets",onChange:i=>o({display:i,page:1},{page:1,display:"table"}),options:[{title:"Sets",icon:e.jsx(pe,{}),value:"sets"},{title:"Orphan Items",icon:e.jsx(je,{}),value:"orphans"}]}),e.jsx(ke,{addEntryToUpdate:c,ids:Object.keys(t)})]})}function $(t){return f.omitBy(f.cloneDeep(t),s=>f.isEmpty(s.itemsIds))}function Fe(t){return Object.keys(t).forEach(s=>{t[s].itemsIds=v(w(t[s].itemsIds))}),H($(t))}function kt(){const t=he({tdrResourceName:"daily-disc-sets",firebaseDataCollectionName:"discSets",serialize:!0});return e.jsx(Q,{title:"Items",subtitle:"Disc Sets",children:e.jsxs(E,{hasSider:!0,children:[e.jsx(ue,{children:e.jsx(Pe,{...t})}),e.jsx(E.Content,{className:"content",children:e.jsx(J,{isLoading:t.isLoading||t.isSaving,error:t.error,hasResponseData:!f.isEmpty(t.data),children:e.jsx(Te,{...t})})})]})})}export{kt as ItemsDiscSets,kt as default};
