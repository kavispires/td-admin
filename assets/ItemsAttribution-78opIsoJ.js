import{r as v,a as J,_ as Z,ad as Ke,Q as he,O as qe,j as e,T as O,D as G,B as P,M as He,z as we,aa as ue,ae as Ye,af as Je,ab as fe,ag as Ze,ah as We,ai as Xe,P as et,L as Ie}from"./index-oik76Yce.js";import{D as tt}from"./DataLoadingWrapper-B2D8XxnP.js";import{c as Q,a as se,b as Pe,d as ce,T as st}from"./FilterEntries-2k4jljom.js";import{S as rt}from"./SiderContent-2txor-6k.js";import{D as Ne}from"./DownloadButton-Dg0aFjjM.js";import{S as nt}from"./SaveButton-By4PzGJ5.js";import{l as x}from"./lodash-Vop7Mp14.js";import{A as k,d as w,e as it,f as q}from"./constants-TZCB7cTe.js";import{e as at,g as lt,a as xe,d as Re,w as ot,m as ct}from"./index-C4Fw4qmq.js";import{u as ut}from"./useGetFirebaseDoc-U-6oUXkl.js";import{u as ie}from"./useTDResource-DkOmcFeu.js";import{u as dt}from"./useUpdateFirebaseDoc-DZGN3Wig.js";import{T as ne}from"./index-4_11IMf3.js";import{F as S}from"./index-BPF7_s59.js";import{R as mt}from"./VerticalAlignTopOutlined-BfnXB43r.js";import{I as W,a as X,b as F,c as le}from"./ItemBuildingBlocks-C_r0LJGB.js";import{a as Le}from"./index-Bi3uYhXZ.js";import{R as ve}from"./index-Cm8buRN3.js";import{c as de,E as ae,P as pt}from"./useBaseUrl-8KF9RGGJ.js";import{I as ye}from"./Item-Ba0f751c.js";import{P as Oe}from"./progress-BgRgfdBv.js";import{C as Y}from"./index-C_m9foa2.js";import{A as gt}from"./index-BgXIuWdb.js";import{S as $}from"./index-Do93bfhz.js";import{u as be}from"./useQueryParams-Df1JeVTl.js";import{I as ht}from"./ItemsTypeahead-Duc-5HRT.js";import{R as ft,a as xt,P as bt}from"./Pagination-CV-sUief.js";import{S as te}from"./index-C8FScIXC.js";import{R as jt,F as Ue,a as It}from"./Table-xgW500Xi.js";import{D as vt}from"./index-CkUdqrmR.js";import{S as yt}from"./index-BPMAy79T.js";import{i as At}from"./util-CeAI_f06.js";import{P as Ct}from"./index-fWj005PZ.js";import{u as Tt}from"./useToggle-thL8AuPK.js";import{M as Et}from"./index-BEJ6EXO5.js";import{T as St}from"./TransparentButton-CsyHwFDG.js";import{T as wt}from"./index-CBA8eTtm.js";import{R as Pt}from"./SkinOutlined-BnPlAugn.js";import{R as Nt}from"./index-DdaN0e6l.js";import"./index-BT_-hxwD.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-DX5pS_DM.js";import"./useMutation-CthqUVjk.js";import"./gapSize-U1swVQyS.js";import"./LanguageFlag-BIzkDP9a.js";import"./useCopyToClipboardFunction-BFhTS2ay.js";import"./index-DX4nSdYK.js";import"./Input-B7NcGiI2.js";import"./FireFilled-CDhG2y_s.js";import"./IdcardOutlined-G1fFCtkH.js";import"./throttleByAnimationFrame-B11r44Lm.js";import"./useDebounce-Cdryh9m_.js";import"./index-D4bHF8ZM.js";import"./scrollTo-DdZFo67F.js";import"./extendsObject-keMuGWqj.js";import"./PlusOutlined-CQT3z5rK.js";var Rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"},Lt=function(n,s){return v.createElement(J,Z({},n,{ref:s,icon:Rt}))},Ot=v.forwardRef(Lt),Ut={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},Dt=function(n,s){return v.createElement(J,Z({},n,{ref:s,icon:Ut}))},Ae=v.forwardRef(Dt),Mt={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},Vt=function(n,s){return v.createElement(J,Z({},n,{ref:s,icon:Mt}))},kt=v.forwardRef(Vt),zt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},Ft=function(n,s){return v.createElement(J,Z({},n,{ref:s,icon:zt}))},Bt=v.forwardRef(Ft),$t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},_t=function(n,s){return v.createElement(J,Z({},n,{ref:s,icon:$t}))},Gt=v.forwardRef(_t),Qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},Kt=function(n,s){return v.createElement(J,Z({},n,{ref:s,icon:Qt}))},qt=v.forwardRef(Kt),Ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Yt=function(n,s){return v.createElement(J,Z({},n,{ref:s,icon:Ht}))},Jt=v.forwardRef(Yt),Zt=function(t,n){return At?window.matchMedia(t).matches:!1},Wt=function(t,n){var s=v.useState(Zt(t)),i=s[0],o=s[1];return v.useEffect(function(){var r=!0,l=window.matchMedia(t),c=function(){r&&o(!!l.matches)};return l.addEventListener("change",c),o(l.matches),function(){r=!1,l.removeEventListener("change",c)}},[t]),i};const De={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};x.keyBy(De,"prefix");const Xt=["*","^","+","~","!"],K={ATTRIBUTE_VALUE_DICT:De,ATTRIBUTE_VALUE_PRIORITY:Xt},me=(t={})=>x.cloneDeep(x.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},t)),pe=(t={})=>x.cloneDeep(x.merge({id:"",attributes:{}},t)),Me=(t,n,s)=>{const i=x.orderBy(Object.values(n),["priority","id"],["asc","asc"]).map(a=>a.id);function o(a,u){return x.orderBy(a,j=>i.indexOf(j),["asc"]).map(j=>`${u}${j}`)}const r=[],l=[],c=[],m=[],b=[];return Object.entries(t.attributes).forEach(([a,u])=>{if(n[a])switch(u){case w.OPPOSITE:r.push(a);break;case w.DETERMINISTIC:l.push(a);break;case w.RELATED:c.push(a);break;case w.UNRELATED:m.push(a);break;case w.UNCLEAR:b.push(a);break;default:b.push(a);break}}),[...o(r,k.OPPOSITE),...o(l,k.DETERMINISTIC),...o(c,k.RELATED),...o(m,k.UNRELATED),...o(b,k.UNCLEAR)]},Ve=x.memoize(t=>{if(t.length===3)return{key:t,className:"",text:""};const n=t[0];return{key:t.slice(1,4),className:{[k.DETERMINISTIC]:"deterministic",[k.UNRELATED]:"unrelated",[k.UNCLEAR]:"unclear",[k.OPPOSITE]:"opposite"}[n],text:{[k.DETERMINISTIC]:"very",[k.UNRELATED]:"not",[k.UNCLEAR]:"maybe",[k.OPPOSITE]:"very not"}[n]}}),ke=(t,n,s)=>t.filter(i=>!(!n&&i.includes(k.UNCLEAR)||!s&&i.includes(k.UNRELATED)));function ge(t,n,s){const i=[];for(const[l,c]of Object.entries(t.attributes)){const m=n[l];if(m){const b=Object.values(K.ATTRIBUTE_VALUE_DICT).find(a=>a.value===c);b&&i.push({prefix:b.prefix,id:m.id,priority:m.priority})}}const o=x.sortBy(i,[l=>K.ATTRIBUTE_VALUE_PRIORITY.indexOf(l.prefix),l=>l.prefix===K.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:l.priority,["asc","asc"]]),r=s!=null&&s.length?o.slice(0,s==null?void 0:s.length):o;return s!=null&&s.onlyRelevant?r.filter(l=>[K.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,K.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(l.prefix)).map(l=>`${l.prefix}${l.id}`).join(""):r.map(l=>`${l.prefix}${l.id}`).join((s==null?void 0:s.delimiter)??"")}const es=x.keyBy(K.ATTRIBUTE_VALUE_DICT,"prefix");function ts(t){return(t.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((s,i)=>{const o=i[0],r=i.slice(1),l=es[o].value;return s[r]=l,s},{})}function ze(t){return Object.values(t.attributes).reduce((n,s)=>s<=0?(s===K.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(n+=s/2),n):n+s,0)}function Fe(t,n){const s=Object.values(t.attributes).filter(i=>i===K.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((n-s)/n*100)}function M(){const[t,n]=Ke(),s=(o,r)=>{t.set(o,`${r}`),n(t)},i=o=>{t.delete(o),n(t)};return{view:t.get("view")??"classifier",setView:o=>n({view:o}),addQueryParam:s,removeQueryParam:i,searchParams:t}}const re={};function ss(){const{notification:t,message:n}=he.useApp(),s=qe(),i=ie("items"),o=ie("items-attributes"),r=ie("items-attribute-values"),l=ut("tdr","itemsAttributeValues",{select:f=>ns({itemAttributesValues:f,itemAttributes:o.data??{}})}),[c,m]=v.useState({}),b=dt("tdr","itemsAttributeValues",{onSuccess:()=>{t.success({message:"itemsAttributeValues updated"}),s.refetchQueries({queryKey:["firebase","tdr","itemsAttributeValues"]}),m({})},onError:f=>{t.error({message:"itemsAttributeValues update failed",description:f.message})}}),a=v.useMemo(()=>({...r.data??{},...l.data??{}}),[r.data,l.data]),u=!x.isEmpty(c),j=(f,C)=>{m(d=>({...d,[f]:{...C,updatedAt:Date.now()}}))},h=f=>{m(C=>({...C,...x.mapKeys(f.map(d=>({...d,updatedAt:Date.now()})),"id")}))},p=l.data,g=()=>{b.mutate(rs({...p,...c},o.data))};return{availableItemIds:v.useMemo(()=>{const f=i.data??{};return x.orderBy(Object.keys(f).filter(C=>{var d;return(((d=f[C])==null?void 0:d.decks)??[]).includes("alien")}),C=>Number(C),"asc")},[i.data]),getItem:f=>{var C;return(C=i.data)!=null&&C[f]?i.data[f]:(f&&n.info(`Item ${f} not found in TDR. Creating a new item...`),me({id:f}))},getItemAttributeValues:f=>{const C=(a==null?void 0:a[f])??{},d=c[f]??{};return x.isEmpty(C)&&x.isEmpty(d)?(re[f]=pe({id:f}),re[f]):x.merge((re==null?void 0:re[f])??{},C,d)},attributes:o.data??{},isLoading:i.isLoading||o.isLoading||r.isLoading||l.isLoading,error:i.error||o.error||r.error||l.error,firebaseData:p,isSaving:b.isPending,save:g,addAttributesToUpdate:j,addMultipleAttributesToUpdate:h,attributesToUpdate:c,isDirty:u}}const rs=(t,n)=>lt(t,i=>({id:i.id,tempSignature:ge(i,n),updatedAt:i.updatedAt})),ns=t=>{const{itemAttributesValues:n,itemAttributes:s}=t,i=Object.keys(s).length;return at(n,r=>{const l=ts(r.tempSignature),c=Object.keys(l).length===i,m={id:r.id,updatedAt:r.updatedAt,attributes:l};return c?{...m,complete:c,reliability:Fe(m,i),score:ze(m)}:m})},Be=v.createContext({getItem:()=>me(),getItemAttributeValues:()=>pe(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:me(),itemAttributeValues:pe(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{}}),is=({children:t})=>{const{getItem:n,getItemAttributeValues:s,availableItemIds:i,isLoading:o,error:r,isSaving:l,save:c,addAttributesToUpdate:m,isDirty:b,attributes:a,addMultipleAttributesToUpdate:u,attributesToUpdate:j}=ss(),{message:h}=he.useApp(),p=v.useMemo(()=>x.orderBy(Object.values(a),"name.en","asc"),[a]),{searchParams:g}=M(),y=g.get("sortBy"),I=v.useMemo(()=>y==="id"?x.orderBy(i,E=>Number(E),"asc"):y==="updatedAt"?x.orderBy(i,E=>s(E).updatedAt,"desc"):y==="fewestAttributesLeft"?x.orderBy(i,E=>{const T=p.length-Object.keys(s(E).attributes).length;return T===0?Number.POSITIVE_INFINITY:T},"asc"):i,[i,y]),[R,f]=v.useState(x.random(0,I.length-1)),C=n(I[R]),d=s(C.id),D=(E,T)=>{if(E==="next"){f(A=>(A+1)%I.length);return}if(E==="previous"){f(A=>(A-1+I.length)%I.length);return}if(E==="random"){f(x.random(0,I.length-1));return}if(E==="first"){f(0);return}if(E==="last"){f(I.length-1);return}if(E==="next10"){f(A=>(A+10)%I.length);return}if(E==="previous10"){f(A=>(A-10+I.length)%I.length);return}if(E==="incomplete"){f(A=>{let V=A+1;for(;V<I.length;){const L=s(I[V]);if(Object.keys(L.attributes).length!==p.length)return V;if(V===I.length-1)return h.info("No more incomplete items found."),A;V++}return A});return}if(E==="goTo"&&T!==void 0){const A=I.indexOf(T);if(A!==-1){f(A);return}h.error(`Item ${T} is not available for attribution.`)}},z=(E,T)=>{m(C.id,{...d,attributes:{...d.attributes,[E]:T}})},N=()=>xe(i.reduce((E,T)=>{const A=s(T);return x.isEmpty(A.attributes)||(Object.keys(A.attributes).length===p.length?A.complete=!0:delete A.complete,E[A.id]=A),E},{}));return e.jsx(Be.Provider,{value:{getItem:n,getItemAttributeValues:s,availableItemIds:i,isLoading:o,error:r,hasResponseData:i.length>0&&!x.isEmpty(a),isDirty:b,itemAttributeValues:d,jumpToItem:D,activeItem:C,onAttributeChange:z,isSaving:l,save:c,attributes:a,attributesList:p,addAttributesToUpdate:m,addMultipleAttributesToUpdate:u,prepareItemsAttributesFileForDownload:N,attributesToUpdate:j},children:t})},U=()=>v.useContext(Be);function _({label:t,children:n}){return e.jsxs(O.Text,{children:[t," ",e.jsx(ne,{children:n})]})}function as(){const{getItemAttributeValues:t,availableItemIds:n,attributesList:s}=U(),{total:i,complete:o,completionPercentage:r,hasDataCount:l,initiatedPercentage:c,progress:m,progressTotal:b,currentProgress:a}=v.useMemo(()=>{const u=n.length;let j=0,h=0,p=0;n.map(I=>t(I)).forEach(({attributes:I})=>{x.isEmpty(I)||(j+=1),Object.values(I).length===s.length&&(h+=1),p+=Object.values(I).length});const y=Object.values(s).length*n.length;return{total:u,complete:h,completionPercentage:u>0?(h/u*100).toFixed(1):0,hasDataCount:j,initiatedPercentage:u>0?Math.floor(j/u*100):0,progress:(p/y*100).toFixed(1),currentProgress:p,progressTotal:y}},[s,n,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{vertical:!0,children:[e.jsx(O.Text,{strong:!0,className:"mb-2",children:"Items Stats"}),e.jsx(_,{label:"Total",children:i}),e.jsxs(_,{label:"Complete",children:[o," (",r,"%)"]}),e.jsxs(_,{label:"Initiated",children:[l," (",c,"%)"]}),e.jsx(O.Text,{strong:!0,className:"mt-4 mb-2",children:"Attributes Stats"}),e.jsx(_,{label:"Total",children:b}),e.jsx(_,{label:"Set",children:a}),e.jsxs(_,{label:"Progress",children:[m,"%"]})]}),e.jsx(G,{})]})}function ls(){const{jumpToItem:t}=U(),{searchParams:n,addQueryParam:s}=M();return e.jsxs(e.Fragment,{children:[e.jsx(P,{block:!0,onClick:()=>t("random"),type:"primary",children:"Random Item"}),e.jsx(Q,{label:"Unset Only",value:n.get("scope")==="unset",onChange:i=>s("scope",i?"unset":""),className:"mt-4"})]})}function os(){const{searchParams:t,addQueryParam:n}=M(),{attributesList:s}=U(),i=v.useMemo(()=>[{label:"Random Attribute",value:"random"},...s.map(({id:o,name:r})=>({label:r.en,value:o}))],[s]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Sampler Attribute",value:t.get("attribute")||"random",onChange:o=>n("attribute",o),options:i}),e.jsx(Pe,{label:"Sample Size",value:Number(t.get("size")||9),onChange:o=>n("size",String(o)),min:3,max:21,step:3})]})}function cs(){const{searchParams:t,addQueryParam:n}=M(),{attributesList:s}=U(),i=v.useMemo(()=>s.map(({id:o,name:r,...l})=>({label:`${r.en}${l.default?"*":""}`,value:o})),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Attribute",value:t.get("attribute")||"ali",onChange:o=>n("attribute",o),options:i}),e.jsx(se,{label:"Scope",value:t.get("scope")||"unset",onChange:o=>n("scope",o),options:[{value:"unset",label:"Unset"},...it]}),e.jsx(se,{label:"Results per page",value:t.get("pageSize")||12,onChange:o=>n("pageSize",o),options:[12,24,48,96]})]})}function us(){const{searchParams:t,addQueryParam:n}=M();return e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"Only Complete",value:t.get("showComplete")==="true",onChange:s=>n("showComplete",s?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unrelated",value:t.get("showUnrelated")==="true",onChange:s=>n("showUnrelated",s?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unclear",value:t.get("showUnclear")==="true",onChange:s=>n("showUnclear",s?"true":""),className:"full-width m-0"})]})}function ds(){const{searchParams:t,addQueryParam:n}=M();return e.jsx(e.Fragment,{children:e.jsx(Q,{label:"Show Glyphs",value:t.get("showGlyphs")==="true",onChange:s=>n("showGlyphs",s?"true":""),className:"full-width m-0"})})}function ms(){const{isDirty:t,save:n,prepareItemsAttributesFileForDownload:s,attributes:i,isSaving:o,attributesToUpdate:r}=U(),{view:l,setView:c}=M();return e.jsxs(rt,{children:[e.jsxs(S,{vertical:!0,gap:12,children:[e.jsx(nt,{isDirty:t,onSave:n,isSaving:o,dirt:JSON.stringify(r)}),e.jsx(Ne,{data:()=>ps(s(),i),fileName:"items-attribute-values.json",disabled:t,block:!0})]}),e.jsx(G,{}),e.jsx(as,{}),e.jsx(se,{label:"View",value:l,onChange:c,options:["classifier","sampler","grouping","comparator","simulator","stats"]}),e.jsx(G,{}),l==="classifier"&&e.jsx(ls,{}),l==="sampler"&&e.jsx(os,{}),l==="grouping"&&e.jsx(cs,{}),l==="comparator"&&e.jsx(us,{}),l==="stats"&&e.jsx(ds,{})]})}function ps(t,n){const s=Object.keys(n).length;Object.keys(t).forEach(o=>{const r=t[o],l=Object.keys(r.attributes);l.forEach(m=>{n[m]||delete r.attributes[m]}),l.length===s?(r.complete=!0,r.score=ze(r),r.reliability=Fe(r,s),r.signature=ge(r,n,{onlyRelevant:!0})):(r.complete=void 0,r.score=void 0,r.reliability=void 0,r.signature=void 0)});const i={};return Object.values(t).forEach(o=>{i[o.id]={id:o.id,updatedAt:o.updatedAt,signature:ge(o,n,{delimiter:":"})},o.complete&&(i[o.id].complete=o.complete)}),console.log(i),xe(Re(t))}function $e(t){const[n,s]=v.useState(!1),i=()=>{s(window.scrollY>300)},o=()=>{window.scrollTo({top:0,behavior:"smooth"})};return He(()=>(window.addEventListener("scroll",i),()=>{window.removeEventListener("scroll",i)})),e.jsx(P,{className:`go-to-top-button ${n?"visible":""}`,onClick:o,icon:e.jsx(mt,{}),...t,children:"Go to Top"})}function _e({title:t,icon:n}){return e.jsx(we,{title:t,children:n??e.jsx(Le,{})})}const Ce=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC}],Te=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC,disabled:!0}];function oe({attribute:t,value:n,onChange:s,onlyButtons:i,size:o}){return t?i?e.jsx(ve.Group,{options:t.limited?Te:Ce,onChange:({target:{value:r}})=>s(t.id,r),value:n,optionType:"button",buttonStyle:"solid",size:o}):e.jsxs("div",{className:"attribute-button-container__row",children:[e.jsxs("span",{className:"attribute-button-container__label",children:[x.truncate(t.name.en,{length:12})," ",e.jsx(_e,{title:t.description.en})]}),e.jsx(ve.Group,{options:t.limited?Te:Ce,onChange:({target:{value:r}})=>s(t.id,r),value:n,optionType:"button",buttonStyle:"solid",size:o}),e.jsx("span",{children:e.jsx(ue,{style:{color:n&&n>7?"green":"transparent"}})})]},t.id):e.jsx(e.Fragment,{})}function gs({itemAttributeValues:t,attributes:n}){const{searchParams:s,addQueryParam:i}=M(),o=s.get("showUnclear")==="true",r=s.get("showUnrelated")==="true",l=v.useMemo(()=>ke(Me(t,n),o,r),[t,n,o,r]),c=s.get("signs")==="true"?Ge:hs;return e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(Q,{label:"Show Unrelated",value:s.get("showUnrelated")==="true",onChange:m=>i("showUnrelated",m?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unclear",value:s.get("showUnclear")==="true",onChange:m=>i("showUnclear",m?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Alien Sings",value:s.get("signs")==="true",onChange:m=>i("signs",m?"true":""),className:"full-width m-0"}),e.jsx(S,{gap:6,wrap:"wrap",className:"item-attribute-value-statement",children:l.map((m,b,a)=>e.jsx(c,{keyVariant:m,attributes:n,firstElement:b===0,lastElement:b===a.length-1},m))})]})}function Ge({keyVariant:t,attributes:n,withText:s}){const{key:i,className:o,text:r}=Ve(t);return e.jsxs(S,{vertical:!0,align:"center",children:[e.jsx(q,{width:50,id:n[i].spriteId,className:de("item-attribute-alien-sign",`item-attribute-alien-sign--${o}`)}),s&&e.jsxs(S,{wrap:"wrap",justify:"center",align:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},children:[r," ",n[i].name.en.toLowerCase()]})]})}function hs({keyVariant:t,attributes:n,firstElement:s,lastElement:i}){const{key:o,text:r}=Ve(t),l=s?"It's ":"",c=i?".":", ";return e.jsxs(e.Fragment,{children:[l,r," ",n[o].name.en.toLowerCase(),c]})}function fs({attributesList:t,itemAttributeValues:n}){const{completion:s,isDeterministic:i,value:o,isOpposing:r,relevancy:l}=v.useMemo(()=>{const c=t.length,m=Object.keys(n.attributes).length,b=Math.floor(m/c*100);let a=!1,u=!1,j=0;const h=Object.values(n.attributes).reduce((g,y)=>y<=0?(y===w.UNCLEAR&&(j+=1),y===w.OPPOSITE&&(u=!0,g+=y/2),g):(y===w.DETERMINISTIC&&(a=!0),g+y),0),p=Math.floor((m-j)/c*100);return{completion:b,isDeterministic:a,value:h,isOpposing:u,relevancy:p}},[t,n.attributes]);return e.jsxs("div",{children:[e.jsx(O.Text,{strong:!0,children:"Completion"}),e.jsx(Oe,{percent:s,size:"small"}),e.jsx(O.Text,{strong:!0,children:"Stats"}),e.jsxs(S,{vertical:!0,children:[e.jsx(_,{label:"Deterministic",children:i?e.jsx(ue,{style:{color:"green"}}):e.jsx(Ae,{style:{color:"red"}})}),e.jsx(_,{label:"Opposing",children:r?e.jsx(ue,{style:{color:"CornflowerBlue"}}):e.jsx(Ae,{style:{color:"grey"}})}),e.jsx(_,{label:"Value",children:o}),e.jsx(we,{title:"The percentage of conclusive attributes (not unclear)",children:e.jsxs(_,{label:"Reliability",children:[l,"%"]})})]})]})}function xs(){const{activeItem:t,attributesList:n,itemAttributeValues:s,onAttributeChange:i,jumpToItem:o,attributes:r}=U(),{searchParams:l,removeQueryParam:c}=M(),m=l.get("itemId"),b=l.get("filters");v.useEffect(()=>{m&&(c("itemId"),o("goTo",m))},[m,o,c]);const a=l.get("scope")==="unset",u=v.useMemo(()=>{const j=a?n.filter(h=>!s.attributes[h.id]):n;if(b){const h=b.split(",").reduce((p,g)=>(p[g]=!0,p),{});return j.filter(p=>h[p.id])}return j},[a,t.id,b]);return t?e.jsx(Y,{children:e.jsxs("div",{className:"item-attribution-card",children:[e.jsx(gt,{offsetTop:120,className:"item-attribution-card__item",children:e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:t,width:150}),e.jsx(X,{item:t}),e.jsx(F,{item:t,language:"en"}),e.jsx(F,{item:t,language:"pt"}),e.jsx(G,{className:"my-2"}),e.jsx(fs,{attributesList:n,itemAttributeValues:s}),e.jsx(G,{className:"my-2"}),e.jsx(O.Text,{type:"secondary",children:e.jsx(gs,{itemAttributeValues:s,attributes:r})})]})}),e.jsx($,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(j=>e.jsx(oe,{attribute:j,value:s.attributes[j.id],onChange:i},j.id))})]},`${t.id}`)}):e.jsx(Y,{children:e.jsxs(O.Text,{type:"secondary",children:["No item selected."," ",e.jsx(P,{size:"small",type:"primary",onClick:()=>o("random"),children:"Random Item"})]})})}function bs(){const{jumpToItem:t}=U();return e.jsxs($.Compact,{children:[e.jsx(P,{onClick:()=>t("first"),icon:e.jsx(Jt,{}),children:"First"}),e.jsx(P,{onClick:()=>t("previous10"),icon:e.jsx(ft,{}),children:"Previous 10"}),e.jsx(P,{onClick:()=>t("previous"),icon:e.jsx(Ye,{}),children:"Previous"}),e.jsxs(P,{onClick:()=>t("next"),children:["Next ",e.jsx(Je,{})]}),e.jsxs(P,{onClick:()=>t("next10"),children:["Next 10 ",e.jsx(xt,{})]}),e.jsxs(P,{onClick:()=>t("last"),children:["Last ",e.jsx(qt,{})]}),e.jsx(fe,{content:e.jsx(js,{}),title:"Go to item",children:e.jsx(P,{children:"Go To"})}),e.jsx(P,{onClick:()=>t("incomplete"),children:"Next Incomplete"})]})}function js(){const{jumpToItem:t}=U();return e.jsx(ht,{isPending:!1,onFinish:n=>t("goTo",n)})}function Is(){const{addParam:t,queryParams:n}=be(),{attributesList:s}=U(),i=v.useMemo(()=>s.map(c=>({label:c.name.en,value:c.id})),[s]),o=c=>{t("filters",c.join(","))},r=n.get("filters"),l=e.jsx(te,{mode:"multiple",style:{width:300},options:i,value:r==null?void 0:r.split(","),onChange:c=>o(c),allowClear:!0});return e.jsx(fe,{content:l,title:"Filter Attributes",children:e.jsx(P,{children:r?e.jsx(jt,{style:{color:"gold"}}):e.jsx(Bt,{})})})}function vs(){const{addParam:t,queryParams:n}=be(),s=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],i=n.get("sortBy"),o=e.jsx(te,{style:{width:120},options:s,value:i,onChange:r=>t("sortBy",r),allowClear:!0});return e.jsx(fe,{content:o,title:"Sort By",children:e.jsx(P,{children:"Sort"})})}function ys(){const{attributes:t,getItemAttributeValues:n,availableItemIds:s,getItem:i,isLoading:o}=U(),{searchParams:r}=M(),l=r.get("showComplete")==="true",c=r.get("showUnclear")==="true",m=r.get("showUnrelated")==="true",{itemMessages:b,itemMessagesDict:a,grouping:u}=v.useMemo(()=>{if(o)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const j=x.orderBy(s.map(g=>{const y=n(g),I=Me(y,t);return{item:i(g),itemAttributesValues:y,message:ke(I,c,m),fullMessage:I}}).filter(({itemAttributesValues:g})=>l?g.complete:!0),["message"],["asc"]),h=j.reduce((g,{message:y,item:{id:I}})=>{const R=y.join(" ");return g[R]===void 0&&(g[R]=[]),g[R].push(I),g},{}),p=Object.values(h).filter(g=>g.length>1);return p.length>0&&console.log("More than one",p),{itemMessages:j,itemMessagesDict:x.keyBy(j,"item.id"),grouping:h}},[t,s,n,i,o,l,c,m]);return{itemMessages:b,itemMessagesDict:a,grouping:u}}function je(){const{searchParams:t,removeQueryParam:n}=M(),s=t.get("drawer"),[i,o]=v.useState(!1),{activeItem:r,attributesList:l,itemAttributeValues:c,onAttributeChange:m,jumpToItem:b}=U(),a=()=>{n("drawer")};v.useEffect(()=>{s&&b("goTo",s)},[s,b,n]);const u=v.useMemo(()=>i?l.filter(j=>!c.attributes[j.id]):l,[i,r.id]);return e.jsxs(vt,{open:!!s,title:`Edit: ${r.name.en}`,onClose:a,width:"640px",children:[e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:r,width:50}),e.jsx(X,{item:r})]}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(F,{item:r,language:"en"}),e.jsx(F,{item:r,language:"pt"})]}),e.jsx(S,{vertical:!0,gap:6,children:e.jsx(yt,{checked:i,onChange:o,checkedChildren:"Unset",unCheckedChildren:"All"})})]}),e.jsx(G,{className:"my-1"}),e.jsx($,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(j=>e.jsx(oe,{size:"small",attribute:j,value:c.attributes[j.id],onChange:m},j.id))})]})}function As(){const{attributes:t}=U(),{itemMessages:n,grouping:s}=ys(),{addQueryParam:i}=M(),o=[{title:"Item Id",dataIndex:"item",key:"id",render:r=>e.jsxs("div",{children:[e.jsx(X,{item:r}),e.jsxs(P.Group,{children:[e.jsx(le,{item:r}),e.jsx(P,{size:"small",shape:"round",onClick:()=>i("drawer",r.id),children:"Drawer"})]})]}),sorter:(r,l)=>Number(r.item.id)-Number(l.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:r=>e.jsx(W,{item:r,width:75})},{title:"Name",dataIndex:"item",key:"name",render:r=>e.jsxs(e.Fragment,{children:[e.jsx(F,{item:r,language:"en"}),e.jsx(F,{item:r,language:"pt"})]}),sorter:(r,l)=>r.item.name.en.localeCompare(l.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(r,{item:l})=>e.jsx(S,{gap:6,children:r.map((c,m,b)=>e.jsx(Ge,{keyVariant:c,attributes:t,firstElement:m===0,lastElement:m===b.length-1,withText:!0},`${c}-${l.id}`))}),sorter:(r,l)=>r.message.join(" ").localeCompare(l.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:r=>r.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:r=>{const l=s[r.join(" ")]??[];return e.jsx(e.Fragment,{children:l.length>1?l.length:"0"})},sorter:(r,l)=>{const c=s[r.message.join(" ")]??[];return(s[l.message.join(" ")]??[]).length-c.length}}];return e.jsxs("div",{className:"my-4",children:[e.jsx(O.Title,{level:5,children:"Item Comparator"}),e.jsx(Ue,{dataSource:n,columns:o,pagination:{showQuickJumper:!0}}),e.jsx(je,{})]})}function Cs(){const{attributesList:t,addAttributesToUpdate:n,getItemAttributeValues:s,availableItemIds:i,addMultipleAttributesToUpdate:o}=U(),{searchParams:r,addQueryParam:l}=M(),c=r.get("attribute")??"ali",m=r.get("scope")??"unset",b=r.get("page")??"1",a=r.get("pageSize")??"12",[u,j]=v.useState("ali"),[h,p]=v.useState("unset"),[g,y]=v.useState(null),[I,R]=v.useState("desc"),f=v.useMemo(()=>{const N=i.map(L=>s(L)),E=m==="unset"?void 0:w[m.toUpperCase()],T=N.filter(L=>{var B;return((B=L.attributes)==null?void 0:B[c])===E}).map(L=>L.id),[A,V]=(g??"::").split("::");return x.orderBy(T,[L=>{var B,H;return A==="attribute"?(H=(B=s(L))==null?void 0:B.attributes)==null?void 0:H[V]:!0},L=>A==="prop"?Number(L):!0,L=>{var B;return(B=s(L))==null?void 0:B.updatedAt},L=>Number(L)],[I,"asc","desc","asc"])},[c,m,g,I]),C=v.useMemo(()=>{if(u!==c||h!==m)return j(c),p(m),l("page","1"),f.slice(0,Number(a));const N=(Number(b)-1)*Number(a),E=N+Number(a);return f.slice(N,E)},[b,a,f]),d=t.find(N=>N.id===c),D=(N,E,T)=>{const A=s(N);n(N,{...A,attributes:{...A.attributes,[E]:T}})},z=()=>{o(C.map(N=>{const E=s(N);return E.attributes[c]||(E.attributes[c]=w.UNRELATED),E}))};return{group:f,stats:{total:i.length,group:f.length,percent:Math.round(f.length/i.length*100)},pageIds:C,attribute:d,updateAttributeValue:D,updatePageItemsAsUnrelated:z,sorting:{sortBy:g,setSortBy:y,sortOrder:I,setSortOrder:R},pagination:{total:f.length,current:Number(b),pageSize:Number(a),onChange:N=>l("page",String(N)),onShowSizeChange:(N,E)=>l("pageSize",String(E)),pageSizeOptions:[12,24,48,96]}}}const Ts=(t,n)=>n==="unset"||!n?`${100-t.percent}% done, ${t.group} left`:`${t.percent}%  - ${t.group} items`;function Es(){const{getItem:t,getItemAttributeValues:n,attributesList:s}=U(),{attribute:i,pageIds:o,updateAttributeValue:r,updatePageItemsAsUnrelated:l,pagination:c,stats:m,sorting:b}=Cs(),{searchParams:a,addQueryParam:u}=M(),j=Wt("(max-width: 1024px)");if(x.isEmpty(i))return e.jsx(Y,{className:"my-4",children:e.jsx(O.Text,{type:"secondary",children:"No group attribute has been selected."})});const h=e.jsx(bt,{onChange:c.onChange,current:c.current,total:c.total,pageSizeOptions:c.pageSizeOptions,pageSize:c.pageSize,onShowSizeChange:c.onShowSizeChange},"pagination"),p=e.jsxs(S,{align:"center",children:[e.jsx(O.Text,{className:"mr-2",children:"Sort by"}),e.jsxs(te,{style:{width:120},value:b.sortBy,onChange:I=>b.setSortBy(I),children:[e.jsx(te.Option,{value:null,children:"Last Updated"}),e.jsx(te.Option,{value:"prop::id",children:"Id"}),s.map(I=>e.jsx(te.Option,{value:`attribute::${I.id}`,children:I.name.en},I.id))]})]}),y=(a.get("scope")==="unset"||!a.get("scope"))&&e.jsx(Ct,{title:`Are you sure everything is unrelated to ${i.name.en}?`,onConfirm:l,children:e.jsx(P,{type:"primary",danger:!0,disabled:o.length===0,children:"Unrelate Unset Items on Page"})},"unrelate-button");return e.jsxs(Y,{className:"my-4",title:e.jsxs(O.Text,{children:[i==null?void 0:i.name.en," (",Ts(m,a.get("scope")),") -"," ",i.description.en]}),extra:e.jsxs(S,{align:"center",children:[p,h]}),actions:[y,e.jsx($e,{},"go-to-top"),h].filter(Boolean),children:[o.length===0&&e.jsx(ae,{description:"No items found in this scope for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),o.map(I=>{const R=n(I),f=t(I);return e.jsx(Y.Grid,{style:{width:j?"50%":"25%"},children:e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:f,width:75}),e.jsx(X,{item:f}),e.jsxs(P.Group,{children:[e.jsx(le,{item:f}),e.jsx(P,{size:"small",shape:"round",onClick:()=>u("drawer",f.id),children:"Drawer"})]}),e.jsx(F,{item:f,language:"en"}),e.jsx(F,{item:f,language:"pt"})]}),e.jsx(oe,{attribute:i,value:R.attributes[i.id],onlyButtons:!0,onChange:(C,d)=>r(f.id,C,d)})]})},`${I}-${R.updatedAt}`)}),e.jsx(je,{})]})}function Qe(){const{attributesList:t,availableItemIds:n,addAttributesToUpdate:s,getItemAttributeValues:i}=U(),{searchParams:o}=M(),[r,l]=v.useState([]),[c,m]=v.useState(),b=()=>{var R;const h=o.get("attribute")??((R=x.sample(t))==null?void 0:R.id)??"ali",p=t.find(f=>f.id===h)??x.sample(t),g=Number(o.get("size"))||9,y=[],I=x.shuffle(n);for(let f=0;f<I.length&&y.length!==g;f++){const C=I[f];i(C).attributes[h]||y.push(C)}return{selectedAttribute:p,selected:y}},a=()=>{let h=b(),p=0;for(;h.selected.length===0&&p<30;)h=b(),p++;m(h.selectedAttribute),l(h.selected)},u=v.useMemo(()=>c?n.filter(h=>!i(h).attributes[c==null?void 0:c.id]).length:0,[c,n]);return{sampleIds:r,attribute:c,itemsLeftForAttribute:u,onGetSample:a,updateAttributeValue:(h,p,g)=>{const y=i(h);s(h,{...y,attributes:{...y.attributes,[p]:g}})}}}function Ss(){const{getItem:t,getItemAttributeValues:n}=U(),{sampleIds:s,attribute:i,onGetSample:o,updateAttributeValue:r,itemsLeftForAttribute:l}=Qe(),{addQueryParam:c}=M();if(x.isEmpty(s)&&x.isEmpty(i))return e.jsxs(Y,{className:"my-4",children:[e.jsxs(O.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",e.jsx(P,{size:"small",type:"primary",onClick:o,children:"Get Sample"})]}),e.jsx(G,{}),e.jsx(Ee,{})]});const m=s.map(u=>({itemAttributes:n(u),item:t(u)})),b=m.filter(({itemAttributes:u})=>(i==null?void 0:i.id)&&!u.attributes[i.id]),a=()=>{b.forEach(({item:u})=>{i!=null&&i.id&&r(u.id,i.id,-3)})};return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),e.jsxs(Y,{className:"my-4",title:e.jsxs(O.Text,{children:[i==null?void 0:i.name.en," - ",i==null?void 0:i.description.en," (",l," items left)"]}),actions:[e.jsx(P,{onClick:a,danger:!0,disabled:b.length===0,children:"Mark rest as unrelated"},"1"),e.jsx(P,{type:"primary",ghost:!0,onClick:o,children:"Get New Sample"},"2")],extra:e.jsx(P,{type:"primary",size:"small",onClick:o,children:"Get New Sample"}),children:[e.jsxs(S,{vertical:!0,gap:6,children:[m.length===0&&e.jsx(ae,{description:"No unset items found for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),m.map(({item:u,itemAttributes:j})=>e.jsxs(v.Fragment,{children:[e.jsxs(S,{gap:6,children:[e.jsx(W,{item:u,width:75}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:u}),e.jsxs(P.Group,{children:[e.jsx(le,{item:u}),e.jsx(P,{size:"small",shape:"round",onClick:()=>c("drawer",u.id),children:"Drawer"})]})]}),e.jsx(F,{item:u,language:"en"}),e.jsx(F,{item:u,language:"pt"})]}),!!i&&e.jsx(oe,{attribute:i,value:j.attributes[i.id],onChange:(h,p)=>r(u.id,h,p)})]}),e.jsx(G,{className:"my-1"})]},`${u.id}-${j.updatedAt}`))]}),e.jsx(je,{})]})]})}function Ee(){const[t,n]=Tt(!1),{addQueryParam:s,removeQueryParam:i}=M(),{sampleIds:o,attribute:r,onGetSample:l,updateAttributeValue:c}=Qe(),{getItem:m,getItemAttributeValues:b}=U(),a=()=>{s("size","1"),n(!0),l()},u=()=>{i("size"),n(!1)},j=o[0],h=m(j),p=b(j);return e.jsxs(S,{className:"mt-4",children:[e.jsx(P,{type:"primary",onClick:a,children:"Single Sampler"}),e.jsxs(Et,{title:e.jsxs(O,{children:["Single Sampler: ",e.jsx("strong",{children:r==null?void 0:r.name.en})]}),open:t,width:"100vw",maskClosable:!1,onOk:u,onClose:u,onCancel:u,cancelButtonProps:{style:{display:"none"}},children:[j&&h&&p&&r&&e.jsxs(S,{gap:6,className:"my-10",wrap:"wrap",children:[e.jsx(W,{item:h,width:150}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:h}),e.jsx(le,{item:h})]}),e.jsx(F,{item:h,language:"en"}),e.jsx(F,{item:h,language:"pt"})]}),!!r&&e.jsx(oe,{size:"large",attribute:r,value:p.attributes[r.id],onChange:async(g,y)=>{c(h.id,g,y),await ot(500),l()}})]},j),e.jsx(P,{onClick:l,children:"Another Sample"})]})]})}function ws(){const t=ie("items-attributes"),n=ie("items-attribute-values"),[s,i]=v.useState(null),o=()=>{i(Se(t.data,n.data))},r=()=>{const l={};let c=0;for(;c<300||x.keys(l).length===15;){const m=Se(t.data,n.data);if(m.valid&&!l[m.setId]&&(l[m.setId]=m),x.keys(l).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(l).map((m,b)=>({...m,number:m.number-b})))};return e.jsxs("div",{className:"my-4",children:[e.jsx(O.Title,{level:3,children:"Daily Simulator"}),e.jsx(O.Paragraph,{children:"Generates a daily game for Alien Communication"}),e.jsxs($,{children:[e.jsx(P,{type:"primary",onClick:o,children:"Generate"}),e.jsx(P,{onClick:r,children:"Generate List"})]}),e.jsx("div",{children:!!s&&e.jsxs($,{direction:"vertical",children:[e.jsx(O.Title,{level:5,children:s==null?void 0:s.setId}),!(s!=null&&s.valid)&&e.jsx(Ze,{type:"error",message:"Invalid game"}),e.jsx($,{direction:"vertical",children:s==null?void 0:s.attributes.map(l=>e.jsxs(S,{gap:8,children:[e.jsx(q,{id:l.spriteId,width:50}),l.itemsIds.map(c=>e.jsx(ye,{id:c||"0",width:50},c))]},l.id))}),e.jsx(G,{className:"my-1"}),e.jsx($,{direction:"horizontal",children:s==null?void 0:s.requests.map(l=>e.jsxs(S,{vertical:!0,children:[e.jsx(q,{id:l.spritesIds[2],width:50}),e.jsx(q,{id:l.spritesIds[1],width:50}),e.jsx(q,{id:l.spritesIds[0],width:50})]},l.itemId))}),e.jsx(G,{className:"my-1"}),e.jsx($,{direction:"horizontal",children:s==null?void 0:s.itemsIds.map(l=>e.jsx(ye,{id:l||"0",width:50},l))})]},s==null?void 0:s.setId)})]})}const Se=(t,n)=>{const s=x.values(t).filter(d=>!d.limited||d.id==="sol"),i=x.shuffle(x.values(n).filter(d=>d.complete)),o=x.shuffle(ct(38,0)),r=x.sampleSize(s,3).map(d=>({...d,spriteId:`${o.pop()}`})),l=[],c=[],m=[],b=[],a=[],u=[],j=[],h=[];i.forEach(d=>{const D=[w.DETERMINISTIC,w.RELATED],z=d.attributes[r[0].id]===w.DETERMINISTIC,N=D.includes(d.attributes[r[0].id]),E=d.attributes[r[0].id]===w.UNRELATED,T=d.attributes[r[1].id]===w.DETERMINISTIC,A=D.includes(d.attributes[r[1].id]),V=d.attributes[r[1].id]===w.UNRELATED,L=d.attributes[r[2].id]===w.DETERMINISTIC,B=D.includes(d.attributes[r[2].id]),H=d.attributes[r[2].id]===w.UNRELATED;if(E&&V&&H)return h.push(d.id);z&&V&&H&&l.push(d.id),E&&T&&H&&c.push(d.id),E&&V&&L&&m.push(d.id),N&&A&&H&&b.push(d.id),N&&V&&B&&a.push(d.id),E&&A&&B&&u.push(d.id),N&&A&&B&&j.push(d.id)});const p=r.map(d=>({id:d.id,name:d.name.pt,description:d.description.pt,spriteId:d.spriteId,itemsIds:[]}));p[0].itemsIds=x.sampleSize(l,l.length>3?3:Math.max(l.length-1,1)),p[1].itemsIds=x.sampleSize(c,c.length>3?3:Math.max(l.length-1,1)),p[2].itemsIds=x.sampleSize(m,m.length>3?3:Math.max(l.length-1,1));const g=[];p.forEach(d=>{g.push(...d.itemsIds)});const y=[];b.length>0&&y.push({spritesIds:[r[0].spriteId,r[1].spriteId],itemId:x.sample(b)??""}),a.length>0&&y.push({spritesIds:[r[0].spriteId,r[2].spriteId],itemId:x.sample(a)??""}),u.length>0&&y.push({spritesIds:[r[1].spriteId,r[2].spriteId],itemId:x.sample(u)??""}),j.length>0&&y.push({spritesIds:r.map(d=>d.spriteId),itemId:x.sample(j)??""});const I=[];l.length>0&&I.push({spritesIds:[r[0].spriteId],itemId:l.filter(d=>!g.includes(d))[0]}),c.length>0&&I.push({spritesIds:[r[1].spriteId],itemId:c.filter(d=>!g.includes(d))[0]}),m.length>0&&I.push({spritesIds:[r[2].spriteId],itemId:m.filter(d=>!g.includes(d))[0]}),console.log({attributeA:l,attributeB:c,attributeC:m,attributeAB:b,attributeAC:a,attributeBC:u,attributeABC:j}),console.log("COMPLEX REQUEST SIZE",y.length),console.log("SIMPLE REQUEST SIZE",I.length);let R=x.sampleSize(y,4);console.log("REQUEST SIZE",R.length),R.length<3&&R.push(...x.sampleSize(I,4-R.length)),R.length<4&&console.warn("Not enough requests"),R=x.shuffle(R);const f=R.map(d=>d.itemId),C={id:"2024-00-00",setId:p.map(d=>d.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:p,requests:R,solution:f.join("-"),itemsIds:x.shuffle([...f,h[0],h[1],h[2],h[3]]).filter(Boolean),valid:!1};return C.valid=[C.attributes.length===3,C.requests.length===4,C.itemsIds.length>5,C.attributes.every(d=>d.itemsIds.length>0),C.requests.every(d=>d.itemId)].every(Boolean),console.log(C),C},Ps=["","I","II","III","IV","V"];function Ns(){const{attributes:t,availableItemIds:n,getItemAttributeValues:s,getItem:i}=U(),{message:o}=he.useApp(),[r,l]=v.useState(25),[c,m]=v.useState(80),[b,a]=v.useState(!1),[u,j]=v.useState([]),[h,p]=v.useState([]),[g,y]=v.useState(null),[I,R]=v.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),f=()=>{const d={},D=x.shuffle(n);for(;Object.values(d).length<r;){const T=D.pop();if(!T)break;const A=s(T);A&&(!A.complete||!A.reliability||A.reliability<c||!b&&i(T).nsfw||(A.signature&&!d[A.signature]?d[A.signature]=T:console.log("Item has identical key to another item. Skipping.",i(T).name.en)))}const z=Object.values(d);z.length<r&&o.error(`Could not generate sample. Got only ${z.length} items`),j(x.sortBy(z,T=>Number(T)));const N=Rs(z.map(T=>s(T)),25,t);if(N.length<25){const T=x.keys(t).filter(L=>!N.includes(L)),V=x.sortBy(T,L=>t[L].priority).slice(0,25-N.length);console.log("Adding more attributes by priority",V),N.push(...V)}const E=N.reduce((T,A)=>(z.forEach(V=>{const L=s(V);if(L)switch(L.attributes[A]){case w.RELATED:T.relatedCount[A]=(T.relatedCount[A]||0)+1;break;case w.DETERMINISTIC:T.deterministicCount[A]=(T.deterministicCount[A]||0)+1;break;case w.UNCLEAR:T.unclearCount[A]=(T.unclearCount[A]||0)+1;break;case w.OPPOSITE:T.oppositeCount[A]=(T.oppositeCount[A]||0)+1;break}}),T),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});p(N.sort().map(T=>({...t[T],relatedCount:E.relatedCount[T],deterministicCount:E.deterministicCount[T],unclearCount:E.unclearCount[T],oppositeCount:E.oppositeCount[T]})))},C=d=>{R(D=>({...D,[d]:!D[d]}))};return e.jsxs("div",{className:"my-4",children:[e.jsx(O.Title,{level:3,children:"Simulator"}),e.jsx(O.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(se,{label:"Grid Size",value:r,onChange:d=>l(d),options:[16,25]}),e.jsx(Pe,{label:"Reliability Threshold",value:c,onChange:d=>m(d),step:5,min:10,max:100}),e.jsx(Q,{label:"NSFW",value:b,onChange:a}),e.jsx(P,{onClick:f,type:"primary",children:"Get Sample Board"})]}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(ce,{label:"Show Id",value:!!I.id,onChange:()=>C("id")}),e.jsx(ce,{label:"Show Name (EN)",value:!!I.nameEn,onChange:()=>C("nameEn")}),e.jsx(ce,{label:"Show Name (PT)",value:!!I.namePt,onChange:()=>C("namePt")}),e.jsx(ce,{label:"Show Reliability",value:!!I.reliability,onChange:()=>C("reliability")})]}),e.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(r)}, 1fr)`},children:u.map(d=>{const D=i(d),z=s(d);return e.jsxs($,{direction:"vertical",className:de("simulator-grid__entry",g&&z.attributes[g]>0&&"simulator-grid__entry--highlighted"),align:"center",children:[e.jsxs($,{children:[e.jsxs(S,{vertical:!0,children:[I.id&&e.jsx(X,{item:D}),I.reliability&&e.jsx("span",{children:e.jsx(st,{prefix:e.jsx(Gt,{}),placeholder:"Reliability",variant:"borderless",size:"small",value:z.reliability,readOnly:!0,style:{width:"8ch"},formatter:N=>`${N}%`})}),I.id&&e.jsx(le,{item:D})]}),e.jsx(W,{item:D,width:50})]}),I.nameEn&&e.jsx(F,{item:D,language:"en"}),I.namePt&&e.jsx(F,{item:D,language:"pt"})]},d)})}),e.jsx("div",{className:"simulator-grid my-4",children:h.map(d=>e.jsxs(St,{className:de("simulator-grid__entry","simulator-grid__button",g===d.id&&"simulator-grid__entry--highlighted"),onClick:()=>y(d.id),children:[d.name.en," ",Ps[d.level],e.jsxs(S,{gap:6,justify:"center",className:"my-1",children:[e.jsxs("span",{children:[e.jsx(Ot,{style:{color:d.deterministicCount?"dodgerblue":void 0}})," ",d.deterministicCount??0]}),e.jsxs("span",{children:[e.jsx(It,{style:{color:d.relatedCount?"green":void 0}})," ",d.relatedCount??0]}),e.jsxs("span",{children:[e.jsx(kt,{style:{color:d.oppositeCount?"red":void 0}})," ",d.oppositeCount??0]}),e.jsxs("span",{children:[e.jsx(Le,{style:{color:d.unclearCount?"gold":void 0}})," ",d.unclearCount??0]})]})]},d.id))}),e.jsx(ws,{})]})}function Rs(t,n,s){const i={},o={};t.forEach(p=>{p&&Object.keys(p.attributes).forEach(g=>{p.attributes[g]>0&&(i[g]=(i[g]||0)+1),p.attributes[g]===w.DETERMINISTIC&&(o[g]=!0,i[g]=(i[g]||0)+2),p.attributes[g]===w.OPPOSITE&&(i[g]=(i[g]||0)+1)})});const r={1:0,2:0,3:0,4:0};function l(p){return p.filter(g=>(r[s[g].level]++,r[4]>1?(console.log("Discarding level 4 attribute",g),!1):!0))}const c=l(Object.keys(o)),m=l(x.keys(i).filter(p=>!c.includes(p)));if(console.log({levelCount:r}),n===c.length)return console.log("All keys are deterministic"),c;if(console.log(i),c.length===0)return[];const b=c.reduce((p,g)=>{const y=i[g];return p[y]||(p[y]=[]),p[y].push(g),p},{}),a=x.keys(b).sort((p,g)=>Number(g)-Number(p));console.log({sortedDeterministicTiedGroupsKeys:a});const u=m.reduce((p,g)=>{const y=i[g];return p[y]||(p[y]=[]),p[y].push(g),p},{});console.log(u);const j=x.keys(u).sort((p,g)=>Number(g)-Number(p)),h=[];for(const p of a){if(h.length===n)break;h.push(...x.sampleSize(b[p],n-h.length))}for(const p of j){if(h.length===n)break;h.push(...x.sampleSize(u[p],n-h.length))}return h}function Ls(){const{attributes:t}=U(),n=[{key:"1",label:"All Attributes",children:e.jsx(ee,{type:"all"})},{key:"2",label:"Default",children:e.jsx(ee,{type:"default"})},{key:"3",label:"Custom",children:e.jsx(ee,{type:"custom"})},{key:"4",label:"Limited",children:e.jsx(ee,{type:"limited"})},{key:"5",label:"Specific",children:e.jsx(ee,{type:"specific"})},{key:"6",label:"Opposite",children:e.jsx(ee,{type:"opposite"})}];return e.jsxs("div",{className:"my-4",children:[e.jsxs(S,{justify:"space-between",align:"center",children:[e.jsx(O.Title,{level:5,children:"Stats"}),e.jsx(Ne,{data:()=>Us(t),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),e.jsx(wt,{defaultActiveKey:"1",items:n})]})}const Os=(t,n)=>{let s=0,i=0,o=0,r=0,l=0,c=0,m=0,b=0;n.forEach(({attributes:f})=>{if(f[t.id]){s++;const C=f[t.id];C===10?i++:C===5?o++:C===0||!C?r++:C===-1?l++:C===-3?c++:C===-10&&m++,C>0&&b++}});const a=n.length,u=s/a*100,j=i/a*100,h=o/a*100,p=r/a*100,g=l/a*100,y=c/a*100,I=m/a*100,R=b/a*100;return{completionPercentage:u.toFixed(1),tensPercentage:j.toFixed(1),fivesPercentage:h.toFixed(1),zerosPercentage:p.toFixed(1),negativeOnesPercentage:g.toFixed(1),negativeThreesPercentage:y.toFixed(1),negativeTensPercentage:I.toFixed(1),positivePercentage:R.toFixed(1)}};function ee({type:t}){const{availableItemIds:n,getItemAttributeValues:s,attributesList:i}=U(),o=We(),{is:r}=be(),l=v.useMemo(()=>{const a=new Array(65).fill(0).map((j,h)=>h),u=i.map(j=>j.spriteId);return a.filter(j=>!u.includes(`sign-${j}`))},[i]),c=v.useMemo(()=>t==="default"?i.filter(a=>a.default):t==="custom"?i.filter(a=>!a.default):t==="limited"?i.filter(a=>a.limited):t==="specific"?i.filter(a=>a.specific):t==="opposite"?i.filter(a=>a.oppositeId):i,[i,t]),m=v.useMemo(()=>{const a=n.map(u=>s(u));return c.map(u=>({...u,...Os(u,a)}))},[c,n,s]),b=[{title:"Attribute",dataIndex:"name",key:"name",render:(a,u)=>e.jsxs(S,{align:"center",gap:8,children:[r("showGlyphs")&&e.jsx(q,{id:u.spriteId,width:30}),a.en,u.default&&e.jsx(ne,{className:"ml-1",children:"default"}),u.limited&&e.jsx(ne,{className:"ml-1",children:"limited"}),(u.specific||u.parentId)&&e.jsx(ne,{className:"ml-1",children:"specific"}),u.oppositeId&&e.jsx(ne,{className:"ml-1",children:e.jsx(Xe,{})}),e.jsx(_e,{title:u.description.en})]}),sorter:(a,u)=>a.name.en.localeCompare(u.name.en)},{title:e.jsx(Pt,{}),dataIndex:"spriteId",key:"spriteId",render:a=>e.jsx(q,{id:a,width:18,padding:0})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(a,u)=>a.priority-u.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.positivePercentage)-Number.parseFloat(u.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(a,u)=>u.limited?"-":`${a}%`,sorter:(a,u)=>Number.parseFloat(a.tensPercentage)-Number.parseFloat(u.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.fivesPercentage)-Number.parseFloat(u.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeOnesPercentage)-Number.parseFloat(u.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeThreesPercentage)-Number.parseFloat(u.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeTensPercentage)-Number.parseFloat(u.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:a=>e.jsx(Oe,{percent:Number.parseFloat(a),size:"small"}),sorter:(a,u)=>Number.parseFloat(a.completionPercentage)-Number.parseFloat(u.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:a=>e.jsx(Nt,{count:4,value:a,disabled:!0}),sorter:(a,u)=>a.level-u.level},{title:"Actions",key:"actions",render:a=>e.jsx($,{children:e.jsxs(P.Group,{children:[e.jsx(P,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=grouping&attribute=${a.id}&page=1`),children:"Grouping"}),e.jsx(P,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=sampler&attribute=${a.id}&size=6`),children:"Sample"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(O.Paragraph,{children:["Total: ",m.length]}),e.jsx(Ue,{columns:b,dataSource:m,pagination:!1,rowKey:"id",size:"small"}),e.jsx(S,{wrap:"wrap",gap:8,children:l.map(a=>e.jsxs("div",{children:["#",a,e.jsx(q,{id:`sign-${a}`},a)]},a))})]})}function Us(t){const n=x.cloneDeep(t);return xe(Re(n),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Ds(){const{view:t}=M();return t==="classifier"?e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"my-4",gap:8,children:[e.jsx(bs,{}),e.jsx(Is,{}),e.jsx(vs,{})]}),e.jsx(xs,{}),e.jsx(S,{justify:"flex-end",className:"my-4",children:e.jsx($e,{})})]}):t==="sampler"?e.jsx(Ss,{}):t==="grouping"?e.jsx(Es,{}):t==="comparator"?e.jsx(As,{}):t==="simulator"?e.jsx(Ns,{}):t==="stats"?e.jsx(Ls,{}):e.jsx(ae,{className:"my-10",description:"Unknown view has been selected"})}function Ms(){const{isLoading:t,error:n,hasResponseData:s}=U();return e.jsx(et,{title:"Items",subtitle:"Attribution",children:e.jsxs(Ie,{hasSider:!0,children:[e.jsx(pt,{children:e.jsx(ms,{})}),e.jsx(Ie.Content,{className:"content",children:e.jsx(tt,{isLoading:t,error:n,hasResponseData:s,children:e.jsx(Ds,{})})})]})})}function zr(){return e.jsx(is,{children:e.jsx(Ms,{})})}export{zr as default};
