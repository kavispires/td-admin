import{u as Q,D as Y,a as z,A as P}from"./useParsedHistory-B1n2wDHq.js";import{l as b}from"./useBaseUrl-CnhjxzNY.js";import{u as j}from"./useTDResource-CUg3mPxk.js";import{aZ as W,a_ as X,r as q}from"./index-BNJYKVIC.js";import{u as J}from"./useResourceFirestoreData-DQFh0yeH.js";const U="td-admin-debug-daily",K=()=>{const t={"aqui-o":!1,"arte-ruim":!1,artista:!1,"comunicacao-alienigena":!1,"controle-de-estoque":!1,espionagem:!1,filmaco:!1,organiku:!1,palavreado:!1,"portais-magicos":!1,quartetos:!1,"ta-na-cara":!1,"teoria-de-conjuntos":!1};try{const e=localStorage.getItem(U);return e?JSON.parse(e):t}catch{return t}},p=new X(K());p.subscribe(()=>{try{const t={"aqui-o":p.state["aqui-o"],"arte-ruim":p.state["arte-ruim"],artista:p.state.artista,"comunicacao-alienigena":p.state["comunicacao-alienigena"],"controle-de-estoque":p.state["controle-de-estoque"],espionagem:p.state.espionagem,filmaco:p.state.filmaco,organiku:p.state.organiku,palavreado:p.state.palavreado,"portais-magicos":p.state["portais-magicos"],quartetos:p.state.quartetos,"ta-na-cara":p.state["ta-na-cara"],"teoria-de-conjuntos":p.state["teoria-de-conjuntos"]};localStorage.setItem(U,JSON.stringify(t))}catch{}});const Se=(t,e)=>{p.setState(o=>({...o,[t]:!o[t]}))},Ee=()=>W(p,()=>p.state),V=(t,e,o)=>{const{reliabilityThreshold:a=4,projectionThreshold:s=55}={},n=`us-gb-${t.split("-")[1]}`,i=b.isEmpty(e[t])?[]:e[t];let c=0,m=0;i.forEach(S=>{S===3&&(c+=3),S===-3&&(m+=3),S===4&&(c+=4),S===-4&&(m+=4)});const u=i.filter(S=>![-4,-3,3,4].includes(S)),f=u.length+c+m,y=Math.max(f,5),d=i.filter(S=>S===1).length+c,g=Math.round(d/y*100),E=i.filter(S=>S===0).length+m,x=Math.round(E/y*100),w=Math.round((y-d-E)/y*100),k=u.length+c+m>=5,O=f>3,$=f>a,D=$&&Math.abs(g-x)>40?g>x?"üëç":"üëé":null,N=!O||Math.abs(g-x)<60?null:g>=s?"üëç":x>=s?"üëé":null;return{suspectCardId:t,imageId:n,enoughData:O,reliable:$,total:y,yesCount:d,yesPercentage:g,noCount:E,noPercentage:x,blankPercentage:w,complete:k,values:i,resolution:D,projection:N}};function xe(t){const e=t.filter(s=>![0,1].includes(s)),o=t.filter(s=>[0,1].includes(s)),a={0:0,1:0};return o.forEach(s=>{if(a[s]===void 0)throw Error(`what is this value? ${s}`);a[s]+=1}),Object.entries(a).forEach(([s,r])=>{if(r>0){const n=Math.floor(r/4),i=r%4;for(let c=0;c<n;c++)e.push(s==="0"?-4:4);if(i>0){const c=Array.from({length:i},()=>s==="0"?0:1);e.push(...c)}}}),e.sort((s,r)=>s-r)}const h=(...t)=>{p.state.espionagem&&console.log(...t)},Z=t=>{p.state.espionagem&&console.count(t)},ee=(...t)=>{p.state.espionagem&&console.error(...t)},te={male:"√© homem",female:"√© mulher",caucasian:"√© branco(a)",black:"√© negro(a)",asian:"√© asi√°tico(a)",latino:"√© latino(a)",thin:"√© magrelo(a)",fat:"√© gordo(a)",large:"√© gordo(a)",tall:"√© alto(a)",short:"√© baixinho(a)",young:"√© jovem",adult:"√© adulto(a)",senior:"√© da terceira idade",average:"tem corpo normal",medium:"√© de altura m√©dia",mixed:"√© mesti√ßo(a)",hat:"est√° usando um chap√©u",tie:"est√° usando uma gravata",glasses:"est√° usando √≥culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",scarf:"est√° usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"√© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"√© sarado(a)",blackHair:"tem cabelo preto",hoodie:"est√° usando um moletom",earrings:"est√° usando brincos",lipstick:"est√° usando batom",necklace:"est√° usando um colar",mediumHair:"tem cabelo m√©dio","middle-eastern":"√© do Oriente M√©dio",headscarf:"est√° usando um len√ßo na cabe√ßa",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"√© indiano(a)","native-american":"√© nativo-americano(a)",noAccessories:"est√° sem nenhum acess√≥rio",avoidingCamera:"est√° evitando olhar para a c√¢mera",wearingStripes:"tem listras na roupa",blackClothes:"est√° vestindo roupas pretas",blueClothes:"est√° vestindo roupas azuis",greenClothes:"est√° vestindo roupas verdes",redClothes:"est√° vestindo roupas vermelhas",yellowClothes:"est√° vestindo roupas amarelas",purpleClothes:"est√° vestindo roupas roxas",orangeClothes:"est√° vestindo roupas laranjas",brownClothes:"est√° vestindo roupas marrons",whiteShirt:"est√° usando camisa branca",pinkClothes:"est√° vestindo roupas rosas",patternedShirt:"est√° usando roupa estampada",buttonShirt:"est√° usando camisa com bot√µes",bow:"est√° usando um la√ßo",hairyChest:"tem peito peludo",wearingFlowers:"est√° usando flores",showTeeth:"est√° mostrando os dentes",hairTie:"est√° usando um xuxinha ou fita no cabelo","non-binary":"√© n√£o-bin√°rio(a)"},M=12,we=(t,e,o,a)=>{const[s]=Q(Y.ESPIONAGEM,a),r=j("suspects",t),n=j(`testimony-questions-${e}`,t),i=j("testimony-answers",t),c=j("crime-reasons",t),m=q.useMemo(()=>re(i.data),[i.dataUpdatedAt]),u=q.useMemo(()=>ie(r.data),[r.data]);return{entries:q.useMemo(()=>!t||!s||!r.isSuccess||!n.isSuccess||!i.isSuccess||!c.isSuccess?{}:se(o,s,r.data,n.data,m,u,c.data),[t,s,r,n,i,o,m,u,c]),isLoading:r.isLoading||n.isLoading||i.isLoading}},se=(t,e,o,a,s,r,n)=>{Z("Creating Espionagem...");let i=e.latestDate;const c=[],m={};for(let u=0;u<t;u++){const f=z(i);i=f;let y=null,l=0;for(;y===null&&l<P;)try{l++;const d=oe(o,a,s,r,c,n);if(de(d.statements))throw y=d,new Error(`Game is invalid after ${l} attempts`)}catch{}if(!y)throw new Error(`Failed to generate valid game for ${f} after ${l} attempts`);h(`Generated valid game for ${f} after ${l} attempts`),c.push(y.culpritId),m[f]={id:f,type:"espionagem",number:e.latestNumber+u+1,...y}}return m};function oe(t,e,o,a,s,r){const n=[],i={};h("SuspectTestimonyAnswers",o);const{selectedTestimonyId1:c,selectedTestimonyId2:m,culpritId:u,possibleSuspects:f,impossibleSuspects:y}=ce(o,s);if(f.length<2)throw new Error("Not enough possible suspects");let l=[...f];if(f.length<M-1){const C=b.sampleSize(Object.keys(t).filter(F=>!y.includes(F)&&!f.includes(F)),M-f.length-1);l.push(...C)}const d={};Object.keys(a).forEach(C=>{if(a[C][u]===void 0){const F=Object.keys(a[C]).filter(R=>l.includes(R));if(F.length>0){const R={};F.forEach(_=>{l.includes(_)&&(R[_]=!0)}),d[C]=R}}});const g=e[c],v=G(u,l,g,o[c]);n.push(v),I(i,v.excludes);const E=e[m],x=G(u,l,E,o[m]);n.push(x),I(i,x.excludes);const w=T(u,l,d,[],"best");if(w.excludes.length===M-2)throw new Error("Best feature statement excludes too many suspects");n.push(w),I(i,w.excludes);const k=T(u,l,d,[w],"best");n.push(k);const O=T(u,l,d,[w,k],"worst");n.push(O),I(i,O.excludes);const $=T(u,l,d,[w,k,O],"worst");if(n.push($),n.length<6)throw new Error("Not enough statements generated");l=b.shuffle([...l,u]);const D=A(u,l,n,"columns");n.push(D),I(i,D.excludes);const N=A(u,l,n,"rows");n.push(N);const S=[v,O,x,w,D,$],H=[k,N],L=me(t[u],r),B=ae([...S,...H]);return{isNsfw:g.nsfw||E.nsfw||!1,culpritId:u,statements:S,additionalStatements:H,suspects:ne(l,t,B),reason:L.title,setId:`${u}::${L.id}::${S[0].key}`,level:fe(S)}}const ae=t=>{const e={};t.forEach(a=>{if(a.key.includes(".feature.")){const s=a.key.split("not.feature.")[1];e[s]=!0}});const o={hairColor:["brownHair","blondeHair","greyHair","redHair","blackHair","coloredHair"],hairLength:["shortHair","mediumHair","longHair","bald"],facialHair:["beard","mustache","goatee"]};for(const[,a]of Object.entries(o))a.some(s=>e[s])&&a.forEach(s=>{e[s]=!0});return e},ne=(t,e,o)=>t.map(a=>{const s=e[a],r={"18-21":"young","21-30":"adult","30-40":"adult","40-50":"adult","50-60":"senior","60-70":"senior","70-80":"senior","80-90":"senior"}[s.age]||s.age,n=[s.gender,r,s.ethnicity,s.height,s.build],i=s.features.filter(c=>o[c]);return{id:s.id,name:s.name,gender:s.gender,features:[...n,...i]}}),re=t=>{const e={};h("‚öôÔ∏è Calculating suspect answers...");for(const o of Object.keys(t)){const a=t[o];for(const s of Object.keys(a)){const{resolution:r,projection:n}=V(s,a);if(!(!r&&!n)){if(e[o]===void 0&&(e[o]={}),r){e[o][s]=r==="üëç";continue}n&&(e[o][s]=n==="üëç")}}}return Object.keys(e).forEach(o=>{b.isEmpty(e[o])&&delete e[o]}),Object.keys(e).forEach(o=>{Object.keys(e[o]).length<3&&(h("‚ÅâÔ∏è Removing testimonies with less than 3 answers"),delete e[o])}),Object.keys(e).forEach(o=>{b.uniq(Object.values(e[o])).length===1&&(h("‚ÅâÔ∏è Removing testimonies with the same answer"),delete e[o])}),e},ie=t=>{const e={};for(const a of Object.keys(t)){const{gender:s,ethnicity:r,age:n,build:i,height:c,features:m}=t[a];if(!i){h("‚ÅâÔ∏è Ignoring suspect with missing build",a);continue}if(!c){h("‚ÅâÔ∏è Ignoring suspect with missing height",a);continue}if(!m||m.length===0){h("‚ÅâÔ∏è Ignoring suspect with missing features",a);continue}e[s]===void 0&&(e[s]={}),e[s][a]=!0,e[r]===void 0&&(e[r]={}),e[r][a]=!0,e[n]===void 0&&(e[n]={}),e[n][a]=!0,e[i]===void 0&&(e[i]={}),e[i][a]=!0,e[c]===void 0&&(e[c]={}),e[c][a]=!0,m.forEach(u=>{e[u]===void 0&&(e[u]={}),e[u][a]=!0})}return e.young=b.cloneDeep(e["18-21"]),e.adult=b.cloneDeep({...e["21-30"],...e["30-40"],...e["40-50"]}),e.senior=b.cloneDeep({...e["50-60"],...e["60-70"],...e["70-80"],...e["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(a=>{delete e[a]}),e},ce=(t,e)=>{let o=0,a,s,r=[];for(;o<P&&!s&&r.length===0;){if(o++,a=b.sample(Object.keys(t)),!a)throw new Error("Failed to find a testimony");const u=Object.keys(t[a]);if(s=b.sample(Object.keys(t).filter(f=>f!==a&&!b.isEmpty(b.difference(u,Object.keys(t[f]))))),s){r=b.intersection(Object.keys(t[a]),Object.keys(t[s]));break}}if(!a||!s||r.length<3)throw new Error("Failed to find two related testimonies");const n=b.sample(r.filter(u=>!e.includes(u)));if(!n)throw new Error("Failed to determine a culprit from common suspects");h("<===============>"),h(`‚öôÔ∏è Selected testimonies 1: ${a}`),h(t[a]),h(`‚öôÔ∏è Selected testimonies 2: ${s}`),h(t[s]),h(`‚öôÔ∏è Culprit ID: ${n}`),h(`Testimony 1 answers: ${t[a][n]}`),h(`Testimony 2 answers: ${t[s][n]}`);const i=`${t[a][n]}-${t[s][n]}`,c=b.sampleSize(r.filter(u=>u!==n&&`${t[a][u]}-${t[s][u]}`!==i),M-1),m=b.difference(r,c);return h(`‚öôÔ∏è Possible suspects: ${c.join(", ")}`),h(`‚öôÔ∏è Impossible suspects: ${m.join(", ")}`),h(`‚öôÔ∏è Attempts made: ${o}`),h(">===============<"),{selectedTestimonyId1:a,selectedTestimonyId2:s,culpritId:n,possibleSuspects:c,impossibleSuspects:m}},I=(t,e)=>{e.forEach(o=>{t[o]===void 0&&(t[o]=0),t[o]++})},G=(t,e,o,a)=>{const s=a[t],r=e.filter(c=>a[c]!==void 0&&a[c]!==s),n=o.answer.charAt(0).toLowerCase()+o.answer.slice(1),i={key:`testimony.${o.id}`,text:`O(a) suspeito(a) ${s?"":"n√£o "}${n}`,excludes:r,type:"testimony"};return i.text.includes("n√£o j√°")&&(i.text=i.text.replace("n√£o j√°","nunca")),i},ue={column1:{indexes:[0,4,8],text:"na primeira coluna"},column2:{indexes:[1,5,9],text:"na segunda coluna"},column3:{indexes:[2,6,10],text:"na terceira coluna"},column4:{indexes:[3,7,11],text:"na quarta coluna"},corners:{indexes:[0,3,8,11],text:"nos cantos"}},le={row1:{indexes:[0,1,2,3],text:"na primeira linha"},row2:{indexes:[4,5,6,7],text:"na segunda linha"},row3:{indexes:[8,9,10,11],text:"na terceira linha"}},A=(t,e,o,a)=>{const s=e.indexOf(t),r=o.slice(0,3),n=a==="rows"?le:ue,i={};for(const l of Object.keys(n)){const{indexes:d}=n[l];d.includes(s)||(i[l]=d.reduce((g,v)=>{const E=e[v],x=r.filter(w=>w.excludes.includes(E)).length;return x>0?g+x:g},0))}const c=Object.entries(i).reduce((l,[d,g])=>(l[g]||(l[g]=[]),l[g].push(d),l),{}),m=Math.min(...Object.keys(i).map(l=>i[l])),u=c[m.toString()],f=b.sample(u)||Object.keys(i)[0],y=n[f].indexes.map(l=>e[l]);return{key:`not.grid.${f}`,text:`O(a) suspeito(a) n√£o est√° ${n[f].text}`,excludes:y,type:"grid"}},T=(t,e,o,a=[],s="best")=>{const r=b.difference(e,[t]),n=a.filter(d=>d.key.startsWith("not.feature.")).map(d=>d.key.replace("not.feature.","")),i=new Set(a.flatMap(d=>d.excludes)),c=Object.keys(o).filter(d=>Object.keys(o[d]).length<=6&&!n.includes(d)).sort((d,g)=>Object.keys(o[g]).length-Object.keys(o[d]).length);let m,u=[],f=0;const y=500;for(;f<y;){f++;const d=s==="best"?c[0]:b.sample(c.slice(2,5))??c[2];if(!d)break;const g=r.filter(E=>o[d][E]);if(g.some(E=>!i.has(E))||f===y){m=d,u=g;break}c.splice(c.indexOf(d),1)}if(!m)throw Error(`No suitable feature found for ${s} selection after ${y} attempts`);h(`Selected feature after ${f} attempts: ${m}`);const l=te[m];return l||ee(`Feature ${m} not found in translations`),{key:`not.feature.${m}`,text:`O(a) suspeito(a) n√£o ${l||m}`,excludes:u,type:"feature"}},de=t=>{const e=t.slice(0,3);return e.reduce((s,r)=>s+r.excludes.length,0)<10?!1:new Set(e.flatMap(s=>s.excludes)).size===M-1},me=(t,e)=>{const o=[];Object.values(e).forEach(s=>{var r;s.feature==="general"&&o.push(s),(r=t.features)!=null&&r.includes(s.feature)&&o.push(s)});const a=b.sample(o);return a||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},fe=t=>{const e=t.slice(0,3),o=[],a={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};e.forEach(r=>{const n=r.excludes.length;a[n]!==void 0&&o.push(a[n])});const s=Math.round(o.reduce((r,n)=>r+n,0)/o.length);return Math.min(Math.max(s,1),3)};function ve(){const t=j("suspects"),e=j("testimony-questions-pt"),o=J({tdrResourceName:"testimony-answers",firestoreDataCollectionName:"testimonies",serialize:!0});return{...o,isLoading:o.isLoading||e.isLoading||t.isLoading,isSuccess:o.isSuccess&&e.isSuccess&&t.isSuccess,error:o.error||e.error||t.error,questions:e.data,suspects:t.data,hasNewData:o.hasFirestoreData}}const Oe=t=>t.reduce((e,o)=>{if(o===0||o===1)return e+1;const a=Math.abs(o);return a?e+a:e},0);export{Ee as a,V as b,Oe as c,p as d,ve as e,xe as n,Se as t,we as u};
