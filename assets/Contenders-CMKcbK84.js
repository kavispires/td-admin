import{j as e,F as n,h as k,aa as w,r as y,T as c,D as b,P as S,L as C}from"./index-CTf-mCqX.js";import{u as F,D as L}from"./DataFilters-B_r2szql.js";import{u as N,P}from"./useGridPagination-DIhkIZSb.js";import{l as d,P as T}from"./useBaseUrl-D2YOm4WP.js";import{L as m,D as v,N as O}from"./EditableFields-CKo7yaLp.js";import{L as g}from"./LanguageFlag-CPTsgPfU.js";import{I}from"./ImageCard-BF6qABLW.js";import{r as R,a as W,i as B}from"./index-B1cA-3FD.js";import{P as D}from"./constants-D2J5TbS7.js";import{C as j}from"./index-BM_xuoPx.js";import{S as M}from"./index-C920Py66.js";import{R as A}from"./index-DwUSrJnX.js";import{D as G}from"./DownloadButton-C5F2g6EI.js";import{S as _}from"./SaveButton-7yucFeRc.js";import{S as f}from"./SiderContent-BNiATzc9.js";import{D as z}from"./DataLoadingWrapper-gOz-iekJ.js";import{u as H}from"./useResourceFirestoreData-fnfl5kas.js";import"./useQueryParams-yhBqKdrw.js";import"./FilterEntries-C6mDosJ4.js";import"./index-DFmb7Kiu.js";import"./useId-Cj2VzGUM.js";import"./index-DfMWjrZa.js";import"./PlusOutlined-Dk0Fv5SP.js";import"./index-bNYZ7r0n.js";import"./Pagination-BSJTbaOJ.js";import"./useCopyToClipboardFunction-DmnIfl-E.js";import"./IdcardOutlined-CacJWG3w.js";import"./Item-Dsp7t-q7.js";import"./index-CWlxpIME.js";import"./Dropdown-BGUDzd0a.js";import"./index-Dodd8xBe.js";import"./moment-B-YVwB4U.js";import"./SaveOutlined-vh_oimCQ.js";import"./useGetFirestoreDoc-CKXhz1bK.js";import"./useTDResource-B7EIjaJI.js";import"./useUpdateFirestoreDoc-CvnIsjS5.js";import"./useMutation-NSzs5tB7.js";const h=[{value:"base",label:"Base"},{value:"anime",label:"Anime"},{value:"art",label:"Art"},{value:"cartoon",label:"Cartoon"},{value:"characters",label:"Characters"},{value:"comics",label:"Comics"},{value:"games",label:"Games"},{value:"history",label:"History"},{value:"internet",label:"Internet"},{value:"literature",label:"Literature"},{value:"movies",label:"Movies"},{value:"music",label:"Music"},{value:"mythology",label:"Mythology"},{value:"pop-culture",label:"Pop Culture"},{value:"random",label:"Random"},{value:"sports",label:"Sports"},{value:"television",label:"Television"},{value:"special-td",label:"Special TD"},{value:"special-td-bg",label:"Special TD BG"}],K=(s,l)=>{if(!s||s.length===0)return"warning";if(s.filter(r=>!h.some(i=>i.value===r)).length>0||l&&s.includes("base"))return"error"};function J({contender:s,addEntryToUpdate:l}){const a=(t,u,o)=>{l(s.id,d.merge({[u]:{en:"",pt:""}},s,{[u]:{[o]:t}}))},r=t=>{l(s.id,d.merge(s,{nsfw:t}))},i=t=>{l(s.id,{...s,decks:R(t).sort()})};return e.jsxs(j,{cover:e.jsx(I,{cardId:s.id,cardWidth:240}),hoverable:!0,style:{width:240,maxWidth:240},children:[e.jsx(j.Meta,{description:e.jsxs(n,{vertical:!0,children:[e.jsx(m,{children:"Name"}),e.jsx(v,{language:"en",onChange:t=>a(t.target.value,"name","en"),value:s.name}),e.jsx(v,{language:"pt",onChange:t=>a(t.target.value,"name","pt"),value:s.name}),e.jsx(m,{children:"Description"}),e.jsx(v,{language:"en",onChange:t=>a(t.target.value,"description","en"),value:s.description??D}),e.jsx(v,{language:"pt",onChange:t=>a(t.target.value,"description","pt"),value:s.description??D}),e.jsx(m,{children:"Decks"}),e.jsx(M,{defaultValue:s.decks??[],mode:"multiple",onChange:t=>i(t),options:h,size:"small",status:K(s.decks,s.exclusivity),style:{maxWidth:"calc(100vw / 9)"}}),e.jsxs(n,{align:"center",children:[e.jsx(m,{children:"NSFW"})," ",e.jsx(O,{onChange:t=>r(t),size:"small",value:s.nsfw})]}),e.jsxs(n,{align:"center",gap:8,children:[e.jsx(m,{children:"Exclusivity"})," ",e.jsx(U,{addEntryToUpdate:l,contender:s})]})]}),title:s.id}),e.jsx(j.Meta,{})]})}function U({contender:s,addEntryToUpdate:l}){const a=t=>{l(s.id,d.merge(s,{exclusivity:t}))},r=[{value:"en",label:e.jsx(g,{language:"en",style:{width:24}})},{value:"pt",label:e.jsx(g,{language:"pt",style:{width:24}})},{value:"none",label:"None"}],i=e.jsx(n,{gap:8,children:e.jsx(A.Group,{onChange:t=>a(t.target.value),options:r,value:s?.exclusivity})});return e.jsxs(n,{gap:8,children:[s?.exclusivity==="en"&&e.jsx(g,{language:"en",style:{width:24}}),s?.exclusivity==="pt"&&e.jsx(g,{language:"pt",style:{width:24}}),!s?.exclusivity&&"None",e.jsx(k,{content:i,title:"Change exclusivity?",trigger:"click",children:e.jsx(w,{})})]})}function Y({data:s,addEntryToUpdate:l}){const a=F(s),{page:r,pagination:i}=N({data:a,resetter:"",defaultPageSize:32});return y.useEffect(()=>V(s),[s]),e.jsxs(e.Fragment,{children:[e.jsxs(c.Title,{level:2,children:["Listing - Contenders (",a.length," | ",Object.values(s??{}).length,")"]}),e.jsx(P,{className:"full-width",pagination:i,children:e.jsx(n,{gap:16,wrap:"wrap",children:r.map(t=>e.jsx(J,{addEntryToUpdate:l,contender:t},t.id))})})]})}const Q=["random","cartoon","comics","pop-culture","movies","television"],V=s=>{const l=Object.values(d.cloneDeep(s)).reduce((r,i)=>{if(i.decks?.includes("base"))return r.base.push(i),i.decks=["base"],r;if(i.exclusivity==="pt")return r;const t=i.decks?.filter(o=>o!=="base")??[];t.length>1&&console.log("Multiple decks",i.name.en,i.decks);const u=t.find(o=>Q.includes(o))||t[0];return r[u]||(r[u]=[]),i.decks=[u],r[u].push(i),r},{base:[]});Object.keys(l).forEach(r=>{console.log(r,l[r].length),console.log(l[r].map(i=>({id:i.id,name:i.name.en,description:i.description?.en??"",deck:i.decks[0]}))),console.log("-----------------")});const a=[];Object.keys(l).forEach(r=>{a.push(...l[r].map(i=>({id:i.id,name:i.name.en,description:i.description?.en??"",deck:i.decks[0]})))}),console.log(a)};function q({data:s,isDirty:l,save:a,isSaving:r,entriesToUpdate:i,hasFirestoreData:t}){return e.jsxs(e.Fragment,{children:[e.jsx(f,{children:e.jsxs(n,{gap:12,vertical:!0,children:[e.jsx(_,{dirt:JSON.stringify(i),isDirty:l,isSaving:r,onSave:a}),e.jsx(G,{block:!0,data:()=>X(s),disabled:l,fileName:"contenders.json",hasNewData:t})]})}),e.jsx(f,{children:e.jsx(L,{data:s,ignoreKeys:["description"]})}),e.jsx(f,{children:e.jsx(Z,{data:s})})]})}function X(s){console.log("Preparing file for download...");const l=d.cloneDeep(s);return Object.values(l).forEach(a=>{const r=a.exclusivity;(a.exclusivity===void 0||r==="none")&&(a.exclusivity=void 0)}),W(B(l))}function Z({data:s}){const l=y.useMemo(()=>{let a=0,r=0,i=0;const t=Object.values(s).reduce((o,p)=>((p.decks??[]).forEach((x,$,E)=>{(x==="base"||!E.includes("base"))&&(o[x]=o[x]?o[x]+1:1)}),p.exclusivity==="en"&&a++,p.exclusivity==="pt"&&r++,p.exclusivity||i++,o),{}),u=Object.keys(t).filter(o=>!h.some(p=>p.value===o));return{deckCounts:t,invalidDecks:u,englishExclusivity:a,portugueseExclusivity:r,bothExclusivity:i}},[s]);return e.jsxs(n,{gap:8,vertical:!0,children:[e.jsx(c.Text,{strong:!0,children:"Deck Counts"}),e.jsx(n,{gap:8,style:{maxHeight:"300px",overflowY:"auto"},vertical:!0,children:h.map(a=>e.jsxs(c.Text,{children:[a.label,": ",l.deckCounts[a.value]??0]},a.value))}),e.jsx(b,{className:"my-2"}),e.jsx(c.Text,{strong:!0,children:"Invalid Decks"}),e.jsx(n,{gap:8,style:{maxHeight:"300px",overflowY:"auto"},vertical:!0,children:l.invalidDecks.map(a=>e.jsx(c.Text,{children:a},a))}),e.jsx(b,{className:"my-2"}),e.jsx(c.Text,{strong:!0,children:"Exclusivity"}),e.jsxs(n,{gap:8,vertical:!0,children:[e.jsxs(c.Text,{children:["English: ",l.englishExclusivity]}),e.jsxs(c.Text,{children:["Portuguese: ",l.portugueseExclusivity]}),e.jsxs(c.Text,{children:["Both: ",l.bothExclusivity]})]})]})}function Be(){const s=H({tdrResourceName:"contenders",firestoreDataCollectionName:"contenders",serialize:!0});return e.jsx(S,{subtitle:"Characters, Celebrities, Personalities",title:"Contenders",children:e.jsxs(C,{hasSider:!0,children:[e.jsx(T,{children:e.jsx(q,{...s})}),e.jsx(C.Content,{className:"content",children:e.jsx(z,{error:s.error,hasResponseData:!d.isEmpty(s.data),isLoading:s.isLoading,children:e.jsx(Y,{...s})})})]})})}export{Be as Contenders,Be as default};
