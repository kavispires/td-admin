import{r as S,a as Ie,_ as xe,j as n,aj as L,T as F,ae as je,B as J,aM as oe,aN as Ae,aO as ye,W as Se,V as De,X,Z as ee,Y as se,P as Ne,L as te}from"./index-BZlgVGyQ.js";import{R as Oe}from"./ResponseState-6UxQIJSy.js";import{u as Ee}from"./useQueryParams-SxpUkNbA.js";import{C as be,u as le}from"./useArteRuimDrawings-BOobBQHO.js";import{I as ie}from"./ImageCard-rVpUBcIx.js";import{f as Ce,W as Te,d as k,g as Y,h as Le}from"./constants--noGxxjp.js";import{I as q}from"./Item-i8IR1ffc.js";import{l as m}from"./lodash-C-CNgKU_.js";import{F as b}from"./index-D7ssyPOH.js";import{S as U}from"./index-BgmHRj3u.js";import{T as ve}from"./index-U_E-9KC3.js";import{u as we}from"./useGetFirebaseDoc-B_niq1mS.js";import{h as ne}from"./moment-C5S46NFB.js";import{I as _e}from"./index-Bqgz6ppr.js";import{F as ce}from"./Table-Dky-jnHG.js";import{m as Re,r as Q}from"./index-DSRbwsOq.js";import{u as Me}from"./daily-teoria-de-conjuntos-TQwtOEv8.js";import{u as Ge}from"./useMutation-SpvvL0jG.js";import{u as M,D as p,g as G,c as de,L as ue}from"./constants-BUmzK_IW.js";import{u as v}from"./useTDResource-DknGbtCY.js";import{u as me}from"./useDailyHistoryQuery-D2TOdY18.js";import{R as ke}from"./SaveOutlined-yncQWwYq.js";import{a as H}from"./FilterEntries-DOUp0Wt4.js";import{S as Qe}from"./SiderContent-CJEv_zZp.js";import{u as z}from"./useLoadWordLibrary-CfZBxx_r.js";import{D as Ue}from"./DataLoadingWrapper-BdBJ8MHz.js";import{P as Pe}from"./useBaseUrl-DfdTaQhG.js";import"./index-CRRJORQS.js";import"./gapSize-U1swVQyS.js";import"./Input-BKtyPqwb.js";import"./index-DAAN8KO-.js";import"./index-C7OCW9Iw.js";import"./index-7EuvvQI3.js";import"./index-C1yscgmY.js";import"./scrollTo-CznnqliU.js";import"./Pagination-CCO_kDKt.js";import"./extendsObject-keMuGWqj.js";import"./index-D2ShRf9Y.js";var qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M396 512a112 112 0 10224 0 112 112 0 10-224 0zm546.2-25.8C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM508 688c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z"}}]},name:"eye",theme:"filled"},Ve=function(r,a){return S.createElement(Ie,xe({},r,{ref:a,icon:qe}))},Be=S.forwardRef(Ve);function w({children:t}){return n.jsx(U,{direction:"vertical",style:{maxWidth:120},children:t})}function _({children:t}){return n.jsxs(ve,{color:"cyan",children:["#",t]})}function E({label:t,children:r}){return n.jsxs(F.Text,{children:[n.jsxs("strong",{children:[t,":"]})," ",r]})}function R({children:t}){return n.jsx(je,{trigger:"click",content:t,title:"Sneak Peek",children:n.jsx(J,{icon:n.jsx(Be,{})})})}const pe=[{title:"Id",dataIndex:"id",key:"id",fixed:"left"},{title:"Arte Ruim",dataIndex:"arte-ruim",key:"arte-ruim",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,cardId:a,text:o,drawings:e}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"CardId",children:a}),n.jsx(E,{label:"Drawings",children:e.length}),n.jsx(R,{children:n.jsxs(b,{gap:6,vertical:!0,children:[n.jsxs("div",{children:['"',o.split("").map((s,l)=>l<2||s===" "?s:"⏹").join(""),'"']}),n.jsx(U,{wrap:!0,children:e.map(s=>n.jsx(be,{drawing:s,width:75,height:75,className:"canvas"},s))})]})})]})}},{title:"Aqui O",dataIndex:"aqui-o",key:"aqui-o",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,setId:a,title:o,itemsIds:e}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"SetId",children:a}),n.jsx(E,{label:"Title",children:o.pt}),n.jsx(E,{label:"Items",children:e.length}),n.jsx(R,{children:n.jsx(b,{gap:6,wrap:!0,style:{maxWidth:500},children:e.map(s=>n.jsx(q,{id:s,width:50},s))})})]})}},{title:"Alienígena",dataIndex:"comunicacao-alienigena",key:"comunicacao-alienigena",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,itemsIds:a,attributes:o}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"Items",children:a.length}),n.jsx(R,{children:n.jsxs(b,{gap:6,style:{maxWidth:"300px"},vertical:!0,children:[n.jsx(U,{wrap:!0,children:o.map(e=>n.jsx(Ce,{id:`sign-${e.spriteId}`,width:50},e.spriteId))}),n.jsx(U,{wrap:!0,children:a.map(e=>n.jsx(q,{id:e,width:50},e))})]})})]})}},{title:"Conjuntos",dataIndex:"teoria-de-conjuntos",key:"teoria-de-conjuntos",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,rule1:a,intersectingThing:o,rule2:e,title:s}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"Title",children:s}),n.jsx(R,{children:n.jsxs(b,{gap:6,children:[n.jsx(q,{id:a.thing.id,width:50}),n.jsx(q,{id:o.id,width:50}),n.jsx(q,{id:e.thing.id,width:50})]})})]})}},{title:"Estoque",dataIndex:"controle-de-estoque",key:"controle-de-estoque",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,title:a,goods:o}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"Title",children:a}),n.jsx(E,{label:"Goods",children:o.length}),n.jsx(R,{children:n.jsx(b,{gap:6,wrap:!0,style:{maxWidth:245},children:o.map(e=>n.jsx(Te,{id:e,width:50},e))})})]})}},{title:"Filmaço",dataIndex:"filmaco",key:"filmaco",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,setId:a,title:o,year:e}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"SetId",children:a}),n.jsx(R,{children:n.jsxs(b,{gap:6,vertical:!0,children:[n.jsxs("span",{children:["Year: ",e]}),n.jsxs("span",{children:["Title:"," ",o.split("").map((s,l)=>l<1||s===" "?s:"⏹").join("")]})]})})]})}},{title:"Palavreado",dataIndex:"palavreado",key:"palavreado",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,letters:a,keyword:o,words:e}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"Letters",children:a.length}),n.jsx(E,{label:"Keyword",children:o}),n.jsx(R,{children:n.jsx(U,{direction:"vertical",children:e.map((s,l)=>n.jsx("span",{children:s.split("").map((c,i)=>i===l||c===" "?c:"⏹").join("")},`${r}-${s}`))})})]})}},{title:"Portais",dataIndex:"portais-magicos",key:"portais-magicos",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,setId:a,corridors:o}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"SetId",children:m.truncate(a,{length:9})}),n.jsx(R,{children:n.jsx(b,{gap:6,vertical:!0,children:o.map(e=>n.jsxs(b,{gap:6,vertical:!0,children:[n.jsxs("span",{children:["Passcode: ",e.passcode]}),n.jsx(b,{children:e.imagesIds.map(s=>n.jsx(ie,{id:s,width:50},s))})]},e.passcode))})})]})}},{title:"Quartetos",dataIndex:"quartetos",key:"quartetos",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,setId:a,sets:o}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"SetId",children:m.truncate(a,{length:9})}),n.jsx(R,{children:n.jsx(b,{gap:6,children:o.map(e=>n.jsx(b,{gap:6,vertical:!0,children:e.itemsIds.map(s=>n.jsx(q,{id:s,width:50},s))},e.id))})})]})}},{title:"Picaço",dataIndex:"artista",key:"artista",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,cards:a}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"Cards",children:a.length}),n.jsx(R,{children:n.jsx(b,{gap:6,vertical:!0,style:{maxHeight:500,overflowY:"auto"},children:a.map((o,e)=>n.jsx("span",{children:o.text},`${o.id}-${e}`))})})]})}},{title:"Tá Na Cara",dataIndex:"ta-na-cara",key:"ta-na-cara",render:t=>{if(!t)return n.jsx(L,{message:"No entry",type:"error"});const{number:r,suspectsIds:a,testimonies:o}=t;return n.jsxs(w,{children:[n.jsx(_,{children:r}),n.jsx(E,{label:"Suspects",children:a==null?void 0:a.length}),n.jsx(E,{label:"Questions",children:o.length}),n.jsx(R,{children:n.jsxs(b,{vertical:!0,children:[n.jsx(U,{direction:"vertical",style:{maxHeight:100,overflowY:"auto"},children:o.map(e=>n.jsx("span",{children:e.question},e.testimonyId))}),n.jsx(U,{wrap:!0,style:{maxHeight:200,maxWidth:"500px",overflowY:"auto"},children:a==null?void 0:a.map(e=>n.jsx(ie,{id:e,width:48},e))})]})})]})}}];function Fe(){const[t,r]=S.useState(""),[a,o]=S.useState(!1),{isLoading:e,data:s}=we("diario",t,{enabled:!!t&&a}),l=S.useMemo(()=>s?[s]:[],[s]),c=d=>{o(!1),r(d.trim())},i=()=>{console.log(t,ne(t,"YYYY-MM-DD",!0).isValid()),o(ne(t,"YYYY-MM-DD",!0).isValid())};return console.log(s),n.jsxs("div",{children:[n.jsx(F.Title,{level:2,children:"Data Verification"}),n.jsx(oe,{to:"/game/daily-setup",children:"Go to Setup"}),n.jsxs(b,{justify:"space-between",align:"center",className:"mb-2",children:[n.jsxs(U.Compact,{children:[n.jsx(_e,{placeholder:"YYYY-MM-DD",onChange:d=>c(d.target.value)}),n.jsx(J,{type:"primary",onClick:i,children:"Load"})]}),t," ",a?"Valid":"Invalid",n.jsx(J,{disabled:!0,type:"primary",size:"large",children:"Save"})]}),n.jsx(ce,{loading:e,columns:pe,dataSource:l,scroll:{x:"max-content"}})]})}const W=new ye({}),K=(t,r)=>{W.setState(a=>({...a,[t]:r}))},Je=()=>{W.setState(()=>({}))},We=()=>Ae(W,()=>W.state),Ye=(t,r,a,o)=>{const[e]=M(p.AQUI_O,o),s=v("items",t),l=v("daily-disc-sets",t);return{entries:S.useMemo(()=>!t||!l.isSuccess||!e||!s.isSuccess?{}:$e(a,e,l.data,s.data),[t,l,s,e,a]),isLoading:s.isLoading||l.isLoading}},$e=(t,r,a,o)=>{console.count("Creating Aqui Ó...");const e=m.shuffle(Object.values(a).filter(d=>d.itemsIds.filter(Boolean).length>=20)),s=e.filter(d=>!r.used.includes(d.id));s.length<t&&(console.log("🔆 Not enough aqui-o sets left, shuffling..."),K("aqui-o","Not enough aqui-o sets left"),s.push(...m.shuffle(e)));const l=Object.values(o).filter(d=>d!=null&&d.nsfw?!1:m.intersection(d.decks??[],["alien","dream","thing"]).length>0);let c=r.latestDate;const i={};for(let d=0;d<t;d++){const g=s[d];g||console.error("No aqui-o sets left");const u=G(c),I=de(u);c=u,I?i[u]={id:u,type:"aqui-o",number:r.latestNumber+d+1,setId:"special",title:{pt:"Especial Fim de Semana",en:"Weekend Special"},itemsIds:["0",...m.sampleSize(l,25).map(x=>x.id)]}:i[u]={id:u,type:"aqui-o",number:r.latestNumber+d+1,setId:g.id,title:g.title,itemsIds:["0",...m.sampleSize(g.itemsIds,20)]}}return i},Ze=(t,r,a,o)=>{const[e]=M(p.ARTE_RUIM,o),s=le(t,r);return{entries:S.useMemo(()=>!t||s.isLoading||!e?[]:He(a,e,s,r),[t,s,r,e,a,s.isLoading]),isLoading:s.isLoading}},He=(t,r,a,o)=>{console.count("Creating Arte Ruim...");const e=Object.values(a.drawings).filter(i=>!(r.used.includes(i.id)||i.drawings.length<3)).map(i=>({id:i.id,type:"arte-ruim",language:o??"pt",cardId:i.id,text:i.text,drawings:i.drawings.map(d=>d.drawing),number:0,dataIds:i.drawings.map(d=>d.id)})),s=m.sampleSize(m.shuffle(e),t);let l=r.latestDate;return s.map((i,d)=>{const g=G(l);return l=g,{...i,id:g,number:r.latestNumber+d+1}})},ze=(t,r,a,o,e)=>{const[s]=M(p.ARTISTA,o),[l]=M(p.ARTE_RUIM,o),c=v(`arte-ruim-cards-${r}`,t),i=le(t,r);return{entries:S.useMemo(()=>{if(!t||!c.isSuccess||i.isLoading||!s)return{};const g=e.map(u=>u.cardId);return Ke(a,s,l,c.data,g,i.drawings)},[t,c,l,s,a,e,i.drawings,i.isLoading]),isLoading:c.isLoading||i.isLoading}},Ke=(t,r,a,o,e,s)=>{console.count("Creating Artista...");let l=r.latestDate;const c={};for(let i=0;i<t;i++){const d=G(l),g=Object.keys(o??{}).filter(I=>{var x,A;return!a.used.includes(I)&&!e.includes(I)&&((A=(x=s==null?void 0:s[I])==null?void 0:x.drawings)==null?void 0:A.length)<3}),u=m.sampleSize(g,20).map(I=>o[I]);l=d,c[d]={id:d,type:"artista",number:r.latestNumber+i+1,cards:u}}return c},Xe=(t,r,a,o)=>{const[e]=M(p.COMUNICACAO_ALIENIGENA,o),s=v("items",t),l=v("items-attributes",t),c=v("items-attribute-values",t);return{entries:S.useMemo(()=>!t||!e||!l.isSuccess||!c.isSuccess||!s.isSuccess?{}:es(a,e,l.data,c.data,s.data),[t,a,e,e,l,c,s]),isLoading:s.isLoading||l.isLoading||c.isLoading}},es=(t,r,a,o,e)=>{console.count("Creating Comunicacao Alienigena...");let s=r.latestDate;const l=m.values(a),c=m.values(o).filter(u=>{var I;return u.complete&&((I=e==null?void 0:e[u.id])==null?void 0:I.nsfw)!==!0}),i={};let d=0;for(;m.keys(i).length<t&&d<100;){const u=ss(l,c);if(u.valid&&!i[u.setId]&&!r.used.includes(u.setId)&&(i[u.setId]=u),m.keys(i).length>=t)break;d+=1}console.log(`🔆 Generating this batch took ${d} tries`),d>=100&&K("comunicacao-alienigena","Not enough valid comunicacao alienigena games (over 100 attempts)");const g={};return Object.values(i).forEach((u,I)=>{const x=G(s);s=x,g[x]={...u,id:x,number:r.latestNumber+I+1}}),g},ss=(t,r)=>{const a=m.shuffle(r),o=m.shuffle(Re(50,0)),e=m.sampleSize(t,3).map(h=>({...h,spriteId:`${o.pop()}`})),s=[],l=[],c=[],i=[],d=[],g=[],u=[],I=[];a.forEach(h=>{const P=[k.DETERMINISTIC,k.RELATED],j=h.attributes[e[0].id]===k.DETERMINISTIC,C=P.includes(h.attributes[e[0].id]),T=h.attributes[e[0].id]===k.UNRELATED,he=h.attributes[e[1].id]===k.DETERMINISTIC,$=P.includes(h.attributes[e[1].id]),V=h.attributes[e[1].id]===k.UNRELATED,fe=h.attributes[e[2].id]===k.DETERMINISTIC,Z=P.includes(h.attributes[e[2].id]),B=h.attributes[e[2].id]===k.UNRELATED;if(T&&V&&B)return I.push(h.id);j&&V&&B&&s.push(h.id),T&&he&&B&&l.push(h.id),T&&V&&fe&&c.push(h.id),C&&$&&B&&i.push(h.id),C&&V&&Z&&d.push(h.id),T&&$&&Z&&g.push(h.id),C&&$&&Z&&u.push(h.id)});const x=e.map(h=>({id:h.id,name:h.name.pt,description:h.description.pt,spriteId:h.spriteId,itemsIds:[]}));x[0].itemsIds=m.sampleSize(s,s.length>3?3:Math.max(s.length-1,1)),x[1].itemsIds=m.sampleSize(l,l.length>3?3:Math.max(s.length-1,1)),x[2].itemsIds=m.sampleSize(c,c.length>3?3:Math.max(s.length-1,1));const A=[];x.forEach(h=>{A.push(...h.itemsIds)});const N=[];i.length>0&&N.push({spritesIds:[e[0].spriteId,e[1].spriteId],itemId:m.sample(i)??""}),d.length>0&&N.push({spritesIds:[e[0].spriteId,e[2].spriteId],itemId:m.sample(d)??""}),g.length>0&&N.push({spritesIds:[e[1].spriteId,e[2].spriteId],itemId:m.sample(g)??""}),u.length>0&&N.push({spritesIds:e.map(h=>h.spriteId),itemId:m.sample(u)??""});const D=[];s.length>0&&D.push({spritesIds:[e[0].spriteId],itemId:s.filter(h=>!A.includes(h))[0]}),l.length>0&&D.push({spritesIds:[e[1].spriteId],itemId:l.filter(h=>!A.includes(h))[0]}),c.length>0&&D.push({spritesIds:[e[2].spriteId],itemId:c.filter(h=>!A.includes(h))[0]});let O=m.sampleSize(N,4);O.length<3&&O.push(...m.sampleSize(D,4-O.length)),O.length<4&&console.log("🔆 Not enough requests for an alien communication, marking it as invalid"),O=m.shuffle(O);const y=O.map(h=>h.itemId),f={id:"0000-00-00",setId:x.map(h=>h.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:x,requests:O,solution:y.join("-"),itemsIds:m.shuffle([...y,...m.sampleSize([I[0],I[1],I[2],I[3]],m.random(1,3))]).filter(Boolean),valid:!1};return f.valid=[f.attributes.length===3,f.requests.length===4,f.itemsIds.length>4,f.attributes.every(h=>h.itemsIds.length>0),f.requests.every(h=>h.itemId)].every(Boolean),f},ts=(t,r,a,o)=>{const[e]=M(p.CONTROLE_DE_ESTOQUE,o);return{entries:S.useMemo(()=>!t||!e?{}:is(a,e),[t,a,e]),isLoading:!1}},is=(t,r)=>{console.count("Creating Controle de Estoque...");let a=r.latestDate;const o={};for(let e=0;e<t;e++){const s=G(a);a=s,o[s]=ls(s,r.latestNumber+e+1)}return o},ns=256,rs=16,as=4,os=1,ls=(t,r)=>{const[a,o,e]=t.split("-").map(Number),l=new Date(a,o-1,e).getDay(),c=["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"][l],i={id:t,number:r,type:"controle-de-estoque",language:"pt",title:c,goods:[],orders:[]},d=m.sampleSize(Array(ns).fill("").map((u,I)=>`good-${I+1}`),rs+os),g=d.pop();if(i.goods=d,i.orders=m.sampleSize(i.goods,as),!g)throw new Error("No out of stock good");return i.orders.push(g),i.orders=m.shuffle(i.orders),i},cs=(t,r,a,o)=>{const[e]=M(p.FILMACO,o),s=v("daily-movie-sets",t);return{entries:S.useMemo(()=>!t||!s.isSuccess||!e?{}:(Object.values(s.data).filter(i=>i.itemsIds.length>0&&!e.used.includes(i.id)).length<=a&&K("filmaco","Not enough unused films"),ds(a,e,s.data)),[t,s,e,a]),isLoading:s.isLoading}},ds=(t,r,a)=>{console.count("Creating Filmaço...");const o=m.shuffle(Object.values(a).filter(c=>c.itemsIds.filter(Boolean).length>0)),e=o.filter(c=>!r.used.includes(c.id));e.length<t&&e.push(...m.shuffle(o));let s=r.latestDate;const l={};for(let c=0;c<t;c++){const i=e[c];if(!i){console.error("No filmaço sets left");break}const d=G(s);s=d,l[d]={id:d,type:"filmaco",number:r.latestNumber+c+1,setId:i.id,title:i.title,itemsIds:i.itemsIds,year:i.year}}return l},us=(t,r,a,o)=>{const[e]=M(p.PALAVREADO,o),s=z(4,r,t),l=z(5,r,t);return{entries:S.useMemo(()=>!t||!s.data||!s.data.length||!l.data||!l.data.length||!e?{}:ms(a,e,s.data,l.data),[t,s,l,e,a]),isLoading:s.isLoading||l.isLoading}},ms=(t,r,a,o)=>{console.count("Creating Palavreado...");let e=r.latestDate;const s=[],l={};for(let c=0;c<t;c++){const i=G(e),d=de(i),g=d?5:4;e=i,l[i]={id:i,type:"palavreado",number:r.latestNumber+c+1,...ps(d?o:a,[...Object.values(l).map(u=>u.keyword),...r.used],s,g)}}return l},ps=(t,r,a,o=4,e)=>{let s=m.shuffle(m.difference(t,a,r));const l=e||(s.pop()??""),c=[];for(let i=0;i<o;i++){const d=gs(t,l,c,i);c.push(d)}return a.push(l,...c),{keyword:l,words:c,letters:hs(c,l.length)}},gs=(t,r,a,o)=>{const e=m.uniq([...m.flatMap(a.map(c=>c.split(""))),...r.split("")]),s=m.shuffle(t.filter(c=>c[o]===r[o]&&!a.includes(c)));return m.sortBy(s,c=>m.intersection(c.split(""),e).length)[0]},hs=(t,r)=>{const a=m.flatMap(t.map(l=>l.split(""))),o=r===4?[0,5,10,15]:[0,6,12,18,24],e=m.shuffle(a.filter((l,c)=>!o.includes(c))),s=[];for(let l=0;l<a.length;l++)o.includes(l)?s.push(a[l]):s.push(e.shift()??"");return s},fs=(t,r,a,o)=>{const[e]=M(p.PORTAIS_MAGICOS,o),s=v("daily-passcode-sets",t),l=z(3,r,t);return{entries:S.useMemo(()=>{if(!t||!s.isSuccess||!l.isSuccess||!e)return{};const i=l.data.reduce((d,g)=>(g.split("").forEach(u=>{d[u]||(d[u]=[]),d[u].push(g)}),d),{" ":["  "],"-":[" - "]});return Is(a,e,s.data,i)},[t,a,s.isSuccess,s.data,l.isSuccess,l.data,e]),isLoading:s.isLoading||l.isLoading}},Is=(t,r,a,o)=>{console.count("Creating Portais Mágicos...");let e=r.latestDate;const s=r.used,l={};let c=m.shuffle(Object.values(a).filter(d=>d.imageCardsIds.length>0));const i={};for(let d=0;d<t;d++){const g=G(e),u=[];let I=[...c];const x=[];for(;x.length<3;){const A=I.pop();if(!A)throw new Error("Not enough sets available");const N=m.sample(A.passcode.filter(f=>f.length<=12&&!s.includes(f)))||"";if(!N)continue;const D=x.length+1;u.push(A.id),l[A.id]=!0;const O=N.split("").map(f=>m.sample(o[f])||` ${f} `),y=m.sampleSize(A.imageCardsIds,D);x.push({passcode:N,imagesIds:y,words:O}),I=I.filter(f=>!l[f.id]&&f.imageCardsIds.length>D)}e=g,i[g]={id:g,type:"portais-magicos",setId:u.join(Y),number:r.latestNumber+d+1,corridors:x.reverse()},c=c.filter(A=>!l[A.id])}return i},xs=(t,r,a,o)=>{const[e]=M(p.QUARTETOS,o),s=v("daily-quartet-sets",t),l=v("items-groups",t);return{entries:S.useMemo(()=>!t||s.isLoading||l.isLoading||!e?{}:js(a,e,r,s.data,l.data),[t,r,e,a,s,l]),isLoading:s.isLoading||l.isLoading}},js=(t,r,a,o,e)=>{console.count("Creating Quartetos...");let s=Object.values(o).filter(i=>i.itemsIds.length>=4&&!r.used.includes(i.id)&&!i.flagged),l=r.latestDate;const c={};return Array.from({length:t}).forEach((i,d)=>{const g=[],u={};let I=m.cloneDeep(s),x=0;for(;g.length<3&&x<500;){const j=m.sample(I);if(!j)throw Error("No potential set found for Quartetos game");I=I.filter(T=>T.id!==j.id);const C=m.orderBy(m.sampleSize(j.itemsIds,4),T=>Number(T));if(C.some(T=>u[T])){x++;continue}j.itemsIds.forEach(T=>{u[T]=!0}),g.push({id:j.id,title:j.title,itemsIds:C,level:j.level??1}),x=0}const A=g.map(j=>j.id);s=s.filter(j=>!A.includes(j.id));const N=Object.values(e).filter(j=>j.itemsIds.some(C=>!u[C])&&j.itemsIds.length>=4&&j.nsfw!==!0),D=m.sample(N);if(!D)throw Error("No eligible group found for Quartetos game");g.push({id:D.id,title:m.capitalize(D.name[a]),itemsIds:m.sampleSize(D.itemsIds,4),level:1});const O=Math.ceil(g.reduce((j,C)=>j+C.level,0)/g.length),y=m.orderBy(g,["level"],["desc"]).map((j,C)=>(j.level=C,j)),f=g.map(j=>j.id).join(Y),h=m.shuffle(g.flatMap(j=>j.itemsIds)),P=G(l);l=P,c[P]={id:P,number:r.latestNumber+d+1,setId:f,type:"quartetos",grid:h,difficulty:O,sets:y}}),c},As=(t,r)=>Q([...t,...r.flatMap(a=>a.sets.map(o=>o.id))]),ys=(t,r,a,o)=>{const[e]=M(p.TA_NA_CARA,o),s=v("suspects",t),l=v(`testimony-questions-${r}`,t);return{entries:S.useMemo(()=>!t||!s.isSuccess||!l.isSuccess||!e?{}:Ss(a,e,s.data,l.data),[t,s,l,e,a]),isLoading:s.isLoading||l.isLoading}},re=15,ae=13,Ss=(t,r,a,o)=>{console.count("Creating Tá Na Cara...");const e=ge(r.used),s=m.orderBy(m.shuffle(Object.values(a)).map(d=>{const[,g]=d.id.split("-");return`us-gb-${g}`}),[d=>e==null?void 0:e[d]],["asc"]).slice(0,ae*2),l=m.orderBy(m.shuffle(Object.values(o)),[d=>e==null?void 0:e[d.id]],["asc"]).slice(0,re*2);let c=r.latestDate;const i={};for(let d=0;d<t;d++){const g=m.sampleSize(l,re).map(I=>({testimonyId:I.id,question:I.question,nsfw:!!I.nsfw})),u=G(c);c=u,i[u]={id:u,type:"ta-na-cara",number:r.latestNumber+d+1,suspectsIds:m.sampleSize(s,ae),testimonies:g}}return i},ge=t=>t.reduce((r,a)=>{const o=a.split(Y),e=o[0],s=Number(o[1]);return r[e]=s||0,r},{}),Ds=(t,r)=>{const a=ge(t);return r.forEach(o=>{var e;o.testimonies.forEach(s=>{a[s.testimonyId]===void 0&&(a[s.testimonyId]=0),a[s.testimonyId]+=1}),(e=o.suspectsIds)==null||e.forEach(s=>{a[s]===void 0&&(a[s]=0),a[s]+=1})}),Object.entries(a).map(([o,e])=>`${o}${Y}${e}`)};function Ns(t,r,a){const o=ue.DAILY[r??"pt"],e=me(o,{enabled:t});S.useEffect(()=>{Je()},[a,r]);const s=t&&e.isSuccess,l=Ye(s,r,a,e.data??{}),c=Ze(s,r,a,e.data??{}),i=Xe(s,r,a,e.data??{}),d=ts(s,r,a,e.data??{}),g=cs(s,r,a,e.data??{}),u=us(s,r,a,e.data??{}),I=xs(s,r,a,e.data??{}),x=Me(s,r,a,e.data??{}),A=fs(s,r,a,e.data??{}),N=ze(s,r,a,e.data??{},c.entries),D=ys(s,r,a,e.data??{}),O=S.useMemo(()=>c.entries.length===0?[]:(console.count("Bundling entries..."),c.entries.map(y=>({id:y.id,"arte-ruim":y,"aqui-o":l.entries[y.id],"comunicacao-alienigena":i.entries[y.id],"controle-de-estoque":d.entries[y.id],filmaco:g.entries[y.id],palavreado:u.entries[y.id],"portais-magicos":A.entries[y.id],quartetos:I.entries[y.id],"teoria-de-conjuntos":x.entries[y.id],artista:N.entries[y.id],"ta-na-cara":D.entries[y.id]}))),[c.entries,l.entries,g.entries,i.entries,d.entries,u.entries,A.entries,I.entries,x.entries,N.entries,D.entries]);return{isLoading:e.isLoading||l.isLoading||c.isLoading||i.isLoading||d.isLoading||g.isLoading||u.isLoading||A.isLoading||I.isLoading||x.isLoading||N.isLoading||D.isLoading,entries:O}}function Os(t){const{notification:r}=Se.useApp(),a=De(),o=ue.DAILY[t??"pt"],[e,s]=S.useState(!1),l=me(o,{enabled:!!o}),c=Ge({mutationFn:async i=>{var x,A,N,D,O,y;const d=i.map(f=>{const h=X(ee,`${o}/${f.id}`);return se(h,f)}),g=X(ee,`${o}/history`),u=l.data;if(!u)throw new Error("No previous history");const I={...u,[p.ARTE_RUIM]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.ARTE_RUIM].number,used:JSON.stringify(Q([...JSON.parse(u[p.ARTE_RUIM].used),...i.map(f=>f[p.ARTE_RUIM].cardId)]))},[p.AQUI_O]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.AQUI_O].number,used:JSON.stringify(Q([...JSON.parse(u[p.AQUI_O].used??"[]"),...i.map(f=>f[p.AQUI_O].setId)]))},[p.PALAVREADO]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.PALAVREADO].number,used:JSON.stringify(Q([...JSON.parse(u.palavreado.used),...i.map(f=>f[p.PALAVREADO].keyword)]))},[p.ARTISTA]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.ARTISTA].number,used:"[]"},[p.FILMACO]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.FILMACO].number,used:JSON.stringify(Q([...JSON.parse(((x=u==null?void 0:u[p.FILMACO])==null?void 0:x.used)??"[]"),...i.map(f=>f[p.FILMACO].setId)]))},[p.CONTROLE_DE_ESTOQUE]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.CONTROLE_DE_ESTOQUE].number,used:"[]"},[p.TEORIA_DE_CONJUNTOS]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.TEORIA_DE_CONJUNTOS].number,used:JSON.stringify(Q([...JSON.parse(((A=u==null?void 0:u[p.TEORIA_DE_CONJUNTOS])==null?void 0:A.used)??"[]"),...i.map(f=>f[p.TEORIA_DE_CONJUNTOS].setId),...i.map(f=>f[p.TEORIA_DE_CONJUNTOS].intersectingThing.id)]))},[p.COMUNICACAO_ALIENIGENA]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.COMUNICACAO_ALIENIGENA].number,used:JSON.stringify(Q([...JSON.parse(((N=u==null?void 0:u[p.COMUNICACAO_ALIENIGENA])==null?void 0:N.used)??"[]"),...i.map(f=>f[p.COMUNICACAO_ALIENIGENA].setId)]))},[p.QUARTETOS]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.QUARTETOS].number,used:JSON.stringify(As(JSON.parse(((D=u==null?void 0:u[p.QUARTETOS])==null?void 0:D.used)??"[]"),i.map(f=>f[p.QUARTETOS])))},[p.TA_NA_CARA]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.TA_NA_CARA].number,used:JSON.stringify(Ds(JSON.parse(((O=u==null?void 0:u[p.TA_NA_CARA])==null?void 0:O.used)??"[]"),i.map(f=>f[p.TA_NA_CARA])))},[p.PORTAIS_MAGICOS]:{latestDate:i[i.length-1].id,latestNumber:i[i.length-1][p.PORTAIS_MAGICOS].number,used:JSON.stringify(Q([...JSON.parse(((y=u==null?void 0:u[p.PORTAIS_MAGICOS])==null?void 0:y.used)??"[]"),...i.map(f=>f[p.PORTAIS_MAGICOS].corridors.map(h=>h.passcode))].flat()))}};return se(g,I),Promise.all(d)},onSuccess:()=>{r.info({message:"Data saved",placement:"bottomLeft"}),a.invalidateQueries({queryKey:[o,"history"]}),s(!1)},onError:()=>{r.error({message:"Error saving data",placement:"bottomLeft"})}});return{isDirty:e,setIsDirty:s,save:c.mutateAsync,isPending:c.isPending}}function Es({language:t,dataLoad:r}){const a=t,{is:o}=Ee(),e=We();console.log(e);const{save:s,isPending:l}=Os(a??"pt");return o("dataCheck")?n.jsx(Fe,{}):n.jsxs("div",{children:[n.jsx(F.Title,{level:2,children:"Data Population"}),r.isLoading&&n.jsx("div",{children:"Loading..."}),n.jsxs(b,{justify:"space-between",align:"center",children:[n.jsxs("span",{children:[n.jsx(oe,{to:"/game/daily-setup?dataCheck=true",children:"Go to Check"}),n.jsxs(F.Title,{level:4,children:["Total: ",r.entries.length]})]}),n.jsx(J,{onClick:()=>s(r.entries),loading:l,disabled:(r.entries??[]).length===0,type:"primary",size:"large",icon:n.jsx(ke,{}),children:"Save"})]}),Object.values(e).map(c=>n.jsx(L,{message:c,type:"warning",showIcon:!0,banner:!0},c)),n.jsx(ce,{columns:pe,dataSource:r.entries??[],scroll:{x:"max-content"}})]})}function bs({language:t,setLanguage:r,drawingsCount:a,setDrawingsCount:o,batchSize:e,setBatchSize:s}){return n.jsxs(Qe,{children:[n.jsx(H,{label:"Language",value:t,onChange:r,options:[Le],placeholder:"Select a language"}),n.jsx(H,{label:"Minimum Drawings",value:a,onChange:o,options:[2,3,4],placeholder:"Select a number"}),n.jsx(H,{label:"Batch Size",value:e,onChange:s,options:[3,7,14,21,28],placeholder:"Select a number"})]})}function mt(){const[t,r]=S.useState(""),[a,o]=S.useState(3),[e,s]=S.useState(7),l=Ns(!!t,t,e);return n.jsx(Ne,{title:"Daily Setup",children:n.jsxs(te,{hasSider:!0,children:[n.jsxs(Pe,{children:[n.jsx(Oe,{isLoading:l.isLoading,error:null,hasResponseData:!l.isLoading}),n.jsx(bs,{language:t,setLanguage:r,drawingsCount:a,setDrawingsCount:o,batchSize:e,setBatchSize:s})]}),n.jsx(te.Content,{className:"content",children:n.jsx(Ue,{isLoading:l.isLoading,error:null,hasResponseData:!l.isLoading,children:n.jsx(Es,{language:t,dataLoad:l})})})]})},e)}export{mt as default};
