import{y as oe,t as o,v as re,w as _,aI as z}from"./index-mWcf2fc_.js";import{t as F}from"./throttleByAnimationFrame-nAT8GtVv.js";const ie=t=>{const{componentCls:a}=t;return{[a]:{position:"fixed",zIndex:t.zIndexPopup}}},se=t=>({zIndexPopup:t.zIndexBase+10}),ae=oe("Affix",ie,se);function w(t){return t!==window?t.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function L(t,a,r){if(r!==void 0&&Math.round(a.top)>Math.round(t.top)-r)return r+a.top}function B(t,a,r){if(r!==void 0&&Math.round(a.bottom)<Math.round(t.bottom)+r){const s=window.innerHeight-a.bottom;return r+s}}var ce=function(t,a){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&a.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(t);c<s.length;c++)a.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(t,s[c])&&(r[s[c]]=t[s[c]]);return r};const j=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"];function le(){return typeof window<"u"?window:null}const M=0,U=1,he=o.forwardRef((t,a)=>{var r;const{style:s,offsetTop:c,offsetBottom:d,prefixCls:H,className:V,rootClassName:G,children:X,target:u,onChange:S,onTestUpdatePosition:fe}=t,k=ce(t,["style","offsetTop","offsetBottom","prefixCls","className","rootClassName","children","target","onChange","onTestUpdatePosition"]),{getPrefixCls:D,getTargetContainer:q}=o.useContext(re),T=D("affix",H),[C,J]=o.useState(!1),[f,K]=o.useState(),[Q,W]=o.useState(),R=o.useRef(M),E=o.useRef(null),h=o.useRef(null),p=o.useRef(null),A=o.useRef(null),x=o.useRef(null),l=(r=u??q)!==null&&r!==void 0?r:le,b=d===void 0&&c===void 0?0:c,Y=()=>{if(R.current!==U||!A.current||!p.current||!l)return;const i=l();if(i){const n={status:M},e=w(p.current);if(e.top===0&&e.left===0&&e.width===0&&e.height===0)return;const g=w(i),m=L(e,g,b),N=B(e,g,d);m!==void 0?(n.affixStyle={position:"fixed",top:m,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}):N!==void 0&&(n.affixStyle={position:"fixed",bottom:N,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}),n.lastAffix=!!n.affixStyle,C!==n.lastAffix&&S?.(n.lastAffix),R.current=n.status,K(n.affixStyle),W(n.placeholderStyle),J(n.lastAffix)}},P=()=>{R.current=U,Y()},v=F(()=>{P()}),y=F(()=>{if(l&&f){const i=l();if(i&&p.current){const n=w(i),e=w(p.current),g=L(e,n,b),m=B(e,n,d);if(g!==void 0&&f.top===g||m!==void 0&&f.bottom===m)return}}P()}),O=()=>{const i=l?.();i&&(j.forEach(n=>{var e;h.current&&((e=E.current)===null||e===void 0||e.removeEventListener(n,h.current)),i?.addEventListener(n,y)}),E.current=i,h.current=y)},I=()=>{const i=l?.();j.forEach(n=>{var e;i?.removeEventListener(n,y),h.current&&((e=E.current)===null||e===void 0||e.removeEventListener(n,h.current))}),v.cancel(),y.cancel()};o.useImperativeHandle(a,()=>({updatePosition:v})),o.useEffect(()=>(x.current=setTimeout(O),()=>{x.current&&(clearTimeout(x.current),x.current=null),I()}),[]),o.useEffect(()=>(O(),()=>I()),[u,f,C,c,d]),o.useEffect(()=>{v()},[u,c,d]);const[Z,$,ee]=ae(T),te=_(G,$,T,ee),ne=_({[te]:f});return Z(o.createElement(z,{onResize:v},o.createElement("div",Object.assign({style:s,className:V,ref:p},k),f&&o.createElement("div",{style:Q,"aria-hidden":"true"}),o.createElement("div",{className:ne,ref:A,style:f},o.createElement(z,{onResize:v},X)))))});export{he as A};
