import{r as g,a as T,_ as C,j as t,P as E,L as v}from"./index-7p9S7-5Q.js";import{D as O}from"./DataLoadingWrapper-Q0cHgBkg.js";import{P as F}from"./useBaseUrl-B1zVbX7A.js";import{u as D}from"./useQueryParams-D3xkYlWL.js";import{I as R}from"./ImageCard-DfLIu4nl.js";import{u as S}from"./useTableExpandableRows-Crg-Dak0.js";import{u as M}from"./useTablePagination-DRRW7-s2.js";import{l as f}from"./lodash-CXYs1tTD.js";import{S as y}from"./index-CYT-H2a5.js";import{F as w}from"./Table-B--K-D_k.js";import{F as N}from"./index-Brf5T-NR.js";import{P as b}from"./progress-Djh3ZUOf.js";import{T as P}from"./index-CPOoIMdh.js";import{u as I}from"./useCardWidth-BJB5dEbn.js";import{R as L}from"./FireFilled-Br9WqrZi.js";import{F as z}from"./FilterEntries-CVJpgIwk.js";import{S as k}from"./SiderContent-DCy5CBnO.js";import{D as Q}from"./DownloadButton-CjCtMk9e.js";import{a as H,d as A,e as B}from"./index-R29wutHV.js";import{R as $}from"./TableOutlined-BDu81hvd.js";import{u as q}from"./useGetFirebaseDoc-CXT6DOfG.js";import{u as j}from"./useTDResource-BfwnGVKJ.js";import"./gapSize-U1swVQyS.js";import"./index-BdNWoxqX.js";import"./index-BV8YiWYU.js";import"./index-BC93uJdk.js";import"./index-CSGUe6Gk.js";import"./scrollTo-UtO9W2Fp.js";import"./Pagination-CFAPv838.js";import"./extendsObject-keMuGWqj.js";import"./Input-CeVIIy2Q.js";import"./useMeasure-DZ4ilMVU.js";import"./util-CeAI_f06.js";import"./index-DYIgIhWk.js";import"./index-Dq8mb7GB.js";import"./constants-BlDp4p7m.js";import"./Item-uaY5w_LZ.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M594.3 601.5a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1 8 8 0 008 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"}}]},name:"contacts",theme:"outlined"},W=function(i,n){return g.createElement(T,C({},i,{ref:n,icon:K}))},J=g.forwardRef(W);function V({answersPerQuestion:r,questions:i}){const n=g.useMemo(()=>f.orderBy(Object.keys(r).map(d=>{const e=i[d],a=r[d],u=a.length>2,m=a.length,o=Math.max(a.length,5),s=Math.round(a.filter(p=>p===1).length/o*100),l=Math.round(a.filter(p=>p===0).length/o*100),h=Math.round((o-s+l)/o*100);return{id:d,question:e,enoughData:u,reliability:m,yesPercentage:s,noPercentage:l,blankPercentage:h}}),["reliability","enoughData","yesPercentage"],["desc","desc","desc"]),[r,i]),c=[{key:"id",title:"Id",dataIndex:"id"},{key:"question",title:"Question",dataIndex:"question",render:d=>d.question},{key:"answer",title:"Answer",dataIndex:"id",sorter:(d,e)=>d.reliability-e.reliability,render:d=>{const e=n.find(a=>a.id===d);return e?t.jsxs(N,{children:[t.jsx(b,{percent:e.noPercentage,size:e.enoughData?[100,20]:[100,10],status:e.enoughData?"exception":"active",success:{percent:e.yesPercentage},showInfo:!1}),e.yesPercentage>=e.noPercentage?t.jsxs(P,{color:"green-inverse",children:[e.yesPercentage,"% Yes"]}):t.jsxs(P,{color:"red-inverse",children:[e.noPercentage,"% No"]})]}):""}}];return t.jsx(y,{wrap:!0,size:"large",children:t.jsx(w,{rowKey:"id",columns:c,dataSource:n,bordered:!0})})}function _({isLoading:r,isSuccess:i,questions:n,data:c,suspects:d}){const e=g.useMemo(()=>Object.keys(c).reduce((s,l)=>{const h=c[l]??{};return Object.keys(h).forEach(p=>{const x=`us-${p.split("-")[2]}`;s[x]||(s[x]={}),s[x][l]=h[p]}),s},{}),[c]),a=g.useMemo(()=>f.orderBy(Object.values(d),s=>Number(s.id.split("-")[1]),"asc"),[d]),u=M({total:a.length,showQuickJumper:!0}),m=[{title:"Id",dataIndex:"id",key:"id",sorter:(s,l)=>Number(s.id.split("-")[1])-Number(l.id.split("-")[1])},{title:"Picture",dataIndex:"id",render:s=>{const l=s.split("-").join("-ct-");return t.jsx(R,{id:l,width:48})}},{title:"Name",dataIndex:"name",key:"name",sorter:(s,l)=>s.name.pt.localeCompare(l.name.pt),render:s=>s.pt},{title:"Answers",dataIndex:"id",key:"answers",render:s=>{const l=e[s];return l?Object.values(l).length:""}}],o=S({maxExpandedRows:1,expandedRowRender:s=>t.jsx(V,{suspect:s,answersPerQuestion:e[s.id],questions:n}),rowExpandable:()=>i});return t.jsx(w,{columns:m,dataSource:a,pagination:u,rowKey:"id",expandable:o,loading:r,bordered:!0,className:"full-width"})}function G({answers:r,suspects:i}){const[n,c]=I(12),d=g.useMemo(()=>f.orderBy(Object.keys(r??{}).map(e=>{const a=`us-${e.split("-")[2]}`,u=r[e],m=u.length>2,o=u.length>4,s=Math.max(u.length,5),l=Math.round(u.filter(x=>x===1).length/s*100),h=Math.round(u.filter(x=>x===0).length/s*100),p=Math.round((s-l+h)/s*100);return{imageId:e,suspectCardId:a,enoughData:m,reliability:o,yesPercentage:l,noPercentage:h,blankPercentage:p}}),["reliability","enoughData","percentage"],["desc","desc","desc"]),[r]);return t.jsx(y,{wrap:!0,ref:c,size:"large",children:d.map(e=>t.jsxs(N,{vertical:!0,gap:4,children:[t.jsx(R,{id:e.imageId,width:n,className:e.enoughData?void 0:"grayscale"}),t.jsx("div",{children:i[e.suspectCardId].name.pt}),e.enoughData?t.jsx(b,{percent:e.noPercentage,size:[n,20],status:"exception",success:{percent:e.yesPercentage},showInfo:!1}):t.jsx(b,{percent:e.noPercentage,size:[n,10],status:"active",success:{percent:e.yesPercentage},showInfo:!1})]},e.suspectCardId))})}function Y({data:r,questions:i,suspects:n,isLoading:c,isSuccess:d}){const e=g.useMemo(()=>f.orderBy(Object.values(i),o=>Number(o.id.split("-")[1]),"asc"),[i]),a=M({total:e.length,showQuickJumper:!0}),u=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,s)=>Number(o.id.split("-")[1])-Number(s.id.split("-")[1])},{title:"Question",dataIndex:"question",key:"question",sorter:(o,s)=>o.question.localeCompare(s.question)},{title:"NSFW",dataIndex:"nsfw",key:"nsfw",render:o=>o?t.jsx(L,{style:{color:"hotPink"}}):"",sorter:(o,s)=>Number(o.nsfw)-Number(s.nsfw)},{title:"Answers",dataIndex:"id",key:"answers",render:o=>{const s=r[o];return s?Object.values(s).length:""}}];console.log(e);const m=S({maxExpandedRows:1,expandedRowRender:o=>t.jsx(G,{answers:r[o.id]??{},suspects:n}),rowExpandable:()=>d});return t.jsx(y,{direction:"vertical",children:t.jsx(w,{columns:u,dataSource:e,pagination:a,rowKey:"id",expandable:m,loading:c,bordered:!0,className:"full-width"})})}function U(r){const{queryParams:i,is:n}=D();return t.jsxs(y,{direction:"vertical",children:[(n("display","questions")||!i.get("display"))&&t.jsx(Y,{...r}),n("display","suspects")&&t.jsx(_,{...r})]})}function X({data:r}){const{queryParams:i,addParams:n}=D();return t.jsxs(t.Fragment,{children:[t.jsx(k,{children:t.jsx(Q,{data:()=>Z(r),fileName:"testimony-answers.json",block:!0})}),t.jsx(k,{children:t.jsx(z,{label:"Display",value:i.get("display")??"questions",onChange:c=>n({display:c,page:1},{page:1}),options:[{title:"Questions",icon:t.jsx($,{}),value:"questions"},{title:"Suspects",icon:t.jsx(J,{}),value:"suspects"}]})})]})}function Z(r){return console.log("Preparing file for download..."),H(A(r))}function ee(){const r=j("suspects"),i=j("testimony-questions-pt"),n=j("testimony-answers"),c=q("data","testimonies",{select:B}),d=g.useMemo(()=>{if(!n.data||!c.data)return{};const e=f.cloneDeep(n.data);return Object.keys(c.data).forEach(a=>{const u=c.data[a];if(e[a]===void 0){e[a]=u;return}Object.keys(u).forEach(m=>{e[a][m]===void 0?e[a][m]=u[m]:(console.log("merging",a,m),e[a][m].push(...u[m]))})}),e},[n.data,c.data]);return{isLoading:n.isLoading||c.isLoading||i.isLoading||r.isLoading,isSuccess:n.isSuccess&&c.isSuccess&&i.isSuccess&&r.isSuccess,error:n.error||c.error,data:d,questions:i.data,suspects:r.data}}function Qe(){const r=ee();return t.jsx(E,{title:"Testimonies",subtitle:"Suspect Testimony Rates",children:t.jsxs(v,{hasSider:!0,children:[t.jsx(F,{children:t.jsx(X,{...r})}),t.jsx(v.Content,{className:"content",children:t.jsx(O,{isLoading:r.isLoading,error:r.error,hasResponseData:!f.isEmpty(r.data),children:t.jsx(U,{...r})})})]})})}export{Qe as TestimoniesPage,Qe as default};
