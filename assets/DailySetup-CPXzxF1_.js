import{r as S,a as xe,_ as je,j as i,ak as L,T as V,af as Ae,B as J,b1 as le,b2 as ye,b3 as Se,Y as De,X as Ne,Z as z,a0 as ee,$ as se,P as be,L as te}from"./index--ZN08wDu.js";import{R as Ee}from"./ResponseState-Bo_Y_Nf4.js";import{u as Oe}from"./useQueryParams-cx1saSCA.js";import{C as Ce,u as ce}from"./useArteRuimDrawings-DF-uaIHl.js";import{I as ie}from"./ImageCard-NVN8kv3H.js";import{f as Te,W as Le,d as k,g as $,h as ve}from"./constants-Blyo5O-7.js";import{I as q}from"./Item-CaPucQvD.js";import{l as m}from"./lodash-C4Hxytv_.js";import{F as O}from"./index-B-6VEyuq.js";import{S as U}from"./index-CILhh8AU.js";import{T as we}from"./index-C861Mivw.js";import{u as _e}from"./useGetFirebaseDoc-TTiolrDv.js";import{h as ne}from"./moment-C5S46NFB.js";import{I as Re}from"./index-DLRBWlvL.js";import{F as de}from"./Table-s6JZFxxk.js";import{m as Me,r as Q}from"./index-BdxyXXU_.js";import{u as Ge}from"./daily-teoria-de-conjuntos-ZIrjzr6h.js";import{u as ke}from"./useMutation-Cq17nn2b.js";import{u as M,D as p,g as G,c as ue,L as me}from"./constants-DuA_6HYF.js";import{u as v}from"./useTDResource-Bhl0DGmZ.js";import{u as pe}from"./useDailyHistoryQuery-BtknU7i2.js";import{R as Qe}from"./SaveOutlined-w-cKtu32.js";import{a as H}from"./FilterEntries-Bt5hb3C_.js";import{S as Ue}from"./SiderContent-BGog9jVv.js";import{u as K}from"./useLoadWordLibrary-C7MXq7Lm.js";import{D as Pe}from"./DataLoadingWrapper-Dj_-u3Q9.js";import{P as qe}from"./useBaseUrl-BBgSjbf3.js";import"./index-BDlbjGSh.js";import"./gapSize-U1swVQyS.js";import"./Input-D6Eu7mtO.js";import"./index-BREe-kUz.js";import"./index-Cy6P54MH.js";import"./index-CgJdUi3N.js";import"./index-tN6sZD5q.js";import"./scrollTo-DX6_30e9.js";import"./Pagination-ChnU4fFY.js";import"./extendsObject-keMuGWqj.js";import"./index-h5cVVWuI.js";var Be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M396 512a112 112 0 10224 0 112 112 0 10-224 0zm546.2-25.8C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM508 688c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z"}}]},name:"eye",theme:"filled"},Fe=function(n,a){return S.createElement(xe,je({},n,{ref:a,icon:Be}))},Ve=S.forwardRef(Fe);function w({children:t}){return i.jsx(U,{direction:"vertical",style:{maxWidth:120},children:t})}function _({children:t}){return i.jsxs(we,{color:"cyan",children:["#",t]})}function E({label:t,children:n}){return i.jsxs(V.Text,{children:[i.jsxs("strong",{children:[t,":"]})," ",n]})}function R({children:t}){return i.jsx(Ae,{trigger:"click",content:t,title:"Sneak Peek",children:i.jsx(J,{icon:i.jsx(Ve,{})})})}const ge=[{title:"Id",dataIndex:"id",key:"id",fixed:"left"},{title:"Arte Ruim",dataIndex:"arte-ruim",key:"arte-ruim",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,cardId:a,text:l,drawings:e}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"CardId",children:a}),i.jsx(E,{label:"Drawings",children:e.length}),i.jsx(R,{children:i.jsxs(O,{gap:6,vertical:!0,children:[i.jsxs("div",{children:['"',l.split("").map((s,o)=>o<2||s===" "?s:"⏹").join(""),'"']}),i.jsx(U,{wrap:!0,children:e.map(s=>i.jsx(Ce,{drawing:s,width:75,height:75,className:"canvas"},s))})]})})]})}},{title:"Aqui O",dataIndex:"aqui-o",key:"aqui-o",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,setId:a,title:l,itemsIds:e}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"SetId",children:a}),i.jsx(E,{label:"Title",children:l.pt}),i.jsx(E,{label:"Items",children:e.length}),i.jsx(R,{children:i.jsx(O,{gap:6,wrap:!0,style:{maxWidth:500},children:e.map(s=>i.jsx(q,{id:s,width:50},s))})})]})}},{title:"Alienígena",dataIndex:"comunicacao-alienigena",key:"comunicacao-alienigena",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,itemsIds:a,attributes:l}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"Items",children:a.length}),i.jsx(R,{children:i.jsxs(O,{gap:6,style:{maxWidth:"300px"},vertical:!0,children:[i.jsx(U,{wrap:!0,children:l.map(e=>i.jsx(Te,{id:`sign-${e.spriteId}`,width:50},e.spriteId))}),i.jsx(U,{wrap:!0,children:a.map(e=>i.jsx(q,{id:e,width:50},e))})]})})]})}},{title:"Conjuntos",dataIndex:"teoria-de-conjuntos",key:"teoria-de-conjuntos",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,rule1:a,intersectingThing:l,rule2:e,title:s,things:o}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"Title",children:s}),i.jsx(R,{children:i.jsxs(O,{vertical:!0,gap:6,children:[i.jsxs(O,{gap:6,children:[i.jsx(q,{id:a.thing.id,width:50}),i.jsx(q,{id:l.id,width:50}),i.jsx(q,{id:e.thing.id,width:50})]}),i.jsx(O,{gap:6,children:o.map(c=>i.jsx(q,{id:c.id,width:35},c.id))})]})})]})}},{title:"Estoque",dataIndex:"controle-de-estoque",key:"controle-de-estoque",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,title:a,goods:l}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"Title",children:a}),i.jsx(E,{label:"Goods",children:l.length}),i.jsx(R,{children:i.jsx(O,{gap:6,wrap:!0,style:{maxWidth:245},children:l.map(e=>i.jsx(Le,{id:e,width:50},e))})})]})}},{title:"Filmaço",dataIndex:"filmaco",key:"filmaco",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,setId:a,title:l,year:e}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"SetId",children:a}),i.jsx(R,{children:i.jsxs(O,{gap:6,vertical:!0,children:[i.jsxs("span",{children:["Year: ",e]}),i.jsxs("span",{children:["Title:"," ",l.split("").map((s,o)=>o<1||s===" "?s:"⏹").join("")]})]})})]})}},{title:"Palavreado",dataIndex:"palavreado",key:"palavreado",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,letters:a,keyword:l,words:e}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"Letters",children:a.length}),i.jsx(E,{label:"Keyword",children:l}),i.jsx(R,{children:i.jsx(U,{direction:"vertical",children:e.map((s,o)=>i.jsx("span",{children:s.split("").map((c,r)=>r===o||c===" "?c:"⏹").join("")},`${n}-${s}`))})})]})}},{title:"Portais",dataIndex:"portais-magicos",key:"portais-magicos",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,setId:a,corridors:l}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"SetId",children:m.truncate(a,{length:9})}),i.jsx(R,{children:i.jsx(O,{gap:6,vertical:!0,children:l.map(e=>i.jsxs(O,{gap:6,vertical:!0,children:[i.jsxs("span",{children:["Passcode: ",e.passcode]}),i.jsx(O,{children:e.imagesIds.map(s=>i.jsx(ie,{id:s,width:50},s))})]},e.passcode))})})]})}},{title:"Quartetos",dataIndex:"quartetos",key:"quartetos",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,setId:a,sets:l}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"SetId",children:m.truncate(a,{length:9})}),i.jsx(R,{children:i.jsx(O,{gap:6,children:l.map(e=>i.jsx(O,{gap:6,vertical:!0,children:e.itemsIds.map(s=>i.jsx(q,{id:s,width:50},s))},e.id))})})]})}},{title:"Picaço",dataIndex:"artista",key:"artista",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,cards:a}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"Cards",children:a.length}),i.jsx(R,{children:i.jsx(O,{gap:6,vertical:!0,style:{maxHeight:500,overflowY:"auto"},children:a.map((l,e)=>i.jsx("span",{children:l.text},`${l.id}-${e}`))})})]})}},{title:"Tá Na Cara",dataIndex:"ta-na-cara",key:"ta-na-cara",render:t=>{if(!t)return i.jsx(L,{message:"No entry",type:"error"});const{number:n,suspectsIds:a,testimonies:l}=t;return i.jsxs(w,{children:[i.jsx(_,{children:n}),i.jsx(E,{label:"Suspects",children:a==null?void 0:a.length}),i.jsx(E,{label:"Questions",children:l.length}),i.jsx(R,{children:i.jsxs(O,{vertical:!0,children:[i.jsx(U,{direction:"vertical",style:{maxHeight:100,overflowY:"auto"},children:l.map(e=>i.jsx("span",{children:e.question},e.testimonyId))}),i.jsx(U,{wrap:!0,style:{maxHeight:200,maxWidth:"500px",overflowY:"auto"},children:a==null?void 0:a.map(e=>i.jsx(ie,{id:e,width:48},e))})]})})]})}}];function Je(){const[t,n]=S.useState(""),[a,l]=S.useState(!1),{isLoading:e,data:s}=_e("diario",t,{enabled:!!t&&a}),o=S.useMemo(()=>s?[s]:[],[s]),c=d=>{l(!1),n(d.trim())},r=()=>{console.log(t,ne(t,"YYYY-MM-DD",!0).isValid()),l(ne(t,"YYYY-MM-DD",!0).isValid())};return console.log(s),i.jsxs("div",{children:[i.jsx(V.Title,{level:2,children:"Data Verification"}),i.jsx(le,{to:"/game/daily-setup",children:"Go to Setup"}),i.jsxs(O,{justify:"space-between",align:"center",className:"mb-2",children:[i.jsxs(U.Compact,{children:[i.jsx(Re,{placeholder:"YYYY-MM-DD",onChange:d=>c(d.target.value)}),i.jsx(J,{type:"primary",onClick:r,children:"Load"})]}),t," ",a?"Valid":"Invalid",i.jsx(J,{disabled:!0,type:"primary",size:"large",children:"Save"})]}),i.jsx(de,{loading:e,columns:ge,dataSource:o,scroll:{x:"max-content"}})]})}const W=new Se({}),X=(t,n)=>{W.setState(a=>({...a,[t]:n}))},We=()=>{W.setState(()=>({}))},$e=()=>ye(W,()=>W.state),Ye=(t,n,a,l)=>{const[e]=M(p.AQUI_O,l),s=v("items",t),o=v("daily-disc-sets",t);return{entries:S.useMemo(()=>!t||!o.isSuccess||!e||!s.isSuccess?{}:Ze(a,e,o.data,s.data),[t,o,s,e,a]),isLoading:s.isLoading||o.isLoading}},Ze=(t,n,a,l)=>{console.count("Creating Aqui Ó...");const e=m.shuffle(Object.values(a).filter(d=>d.itemsIds.filter(Boolean).length>=20)),s=e.filter(d=>!n.used.includes(d.id));s.length<t&&(console.log("🔆 Not enough aqui-o sets left, shuffling..."),X("aqui-o","Not enough aqui-o sets left"),s.push(...m.shuffle(e)));const o=Object.values(l).filter(d=>d!=null&&d.nsfw?!1:m.intersection(d.decks??[],["alien","dream","thing"]).length>0);let c=n.latestDate;const r={};for(let d=0;d<t;d++){const g=s[d];g||console.error("No aqui-o sets left");const u=G(c),I=ue(u);c=u,I?r[u]={id:u,type:"aqui-o",number:n.latestNumber+d+1,setId:"special",title:{pt:"Especial Fim de Semana",en:"Weekend Special"},itemsIds:["0",...m.sampleSize(o,45).map(x=>x.id)]}:r[u]={id:u,type:"aqui-o",number:n.latestNumber+d+1,setId:g.id,title:g.title,itemsIds:["0",...m.sampleSize(g.itemsIds,20)]}}return r},He=(t,n,a,l)=>{const[e]=M(p.ARTE_RUIM,l),s=ce(t,n);return{entries:S.useMemo(()=>!t||s.isLoading||!e?[]:Ke(a,e,s,n),[t,s,n,e,a,s.isLoading]),isLoading:s.isLoading}},Ke=(t,n,a,l)=>{console.count("Creating Arte Ruim...");const e=Object.values(a.drawings).filter(r=>!(n.used.includes(r.id)||r.drawings.length<3)).map(r=>({id:r.id,type:"arte-ruim",language:l??"pt",cardId:r.id,text:r.text,drawings:r.drawings.map(d=>d.drawing),number:0,dataIds:r.drawings.map(d=>d.id)})),s=m.sampleSize(m.shuffle(e),t);let o=n.latestDate;return s.map((r,d)=>{const g=G(o);return o=g,{...r,id:g,number:n.latestNumber+d+1}})},Xe=(t,n,a,l,e)=>{const[s]=M(p.ARTISTA,l),[o]=M(p.ARTE_RUIM,l),c=v(`arte-ruim-cards-${n}`,t),r=ce(t,n);return{entries:S.useMemo(()=>{if(!t||!c.isSuccess||r.isLoading||!s)return{};const g=e.map(u=>u.cardId);return ze(a,s,o,c.data,g,r.drawings)},[t,c,o,s,a,e,r.drawings,r.isLoading]),isLoading:c.isLoading||r.isLoading}},ze=(t,n,a,l,e,s)=>{console.count("Creating Artista...");let o=n.latestDate;const c={};for(let r=0;r<t;r++){const d=G(o),g=Object.keys(l??{}).filter(I=>{var x,A;return!a.used.includes(I)&&!e.includes(I)&&((A=(x=s==null?void 0:s[I])==null?void 0:x.drawings)==null?void 0:A.length)<3}),u=m.sampleSize(g,20).map(I=>l[I]);o=d,c[d]={id:d,type:"artista",number:n.latestNumber+r+1,cards:u}}return c},es=(t,n,a,l)=>{const[e]=M(p.COMUNICACAO_ALIENIGENA,l),s=v("items",t),o=v("items-attributes",t),c=v("items-attribute-values",t);return{entries:S.useMemo(()=>!t||!e||!o.isSuccess||!c.isSuccess||!s.isSuccess?{}:ss(a,e,o.data,c.data,s.data),[t,a,e,e,o,c,s]),isLoading:s.isLoading||o.isLoading||c.isLoading}},ss=(t,n,a,l,e)=>{console.count("Creating Comunicacao Alienigena...");let s=n.latestDate;const o=m.values(a),c=m.values(l).filter(u=>{var I;return u.complete&&((I=e==null?void 0:e[u.id])==null?void 0:I.nsfw)!==!0}),r={};let d=0;for(;m.keys(r).length<t&&d<100;){const u=ts(o,c);if(u.valid&&!r[u.setId]&&!n.used.includes(u.setId)&&(r[u.setId]=u),m.keys(r).length>=t)break;d+=1}console.log(`🔆 Generating this batch took ${d} tries`),d>=100&&X("comunicacao-alienigena","Not enough valid comunicacao alienigena games (over 100 attempts)");const g={};return Object.values(r).forEach((u,I)=>{const x=G(s);s=x,g[x]={...u,id:x,number:n.latestNumber+I+1}}),g},ts=(t,n)=>{const a=m.shuffle(n),l=m.shuffle(Me(50,0)),e=m.sampleSize(t,3).map(h=>({...h,spriteId:`${l.pop()}`})),s=[],o=[],c=[],r=[],d=[],g=[],u=[],I=[];a.forEach(h=>{const P=[k.DETERMINISTIC,k.RELATED],j=h.attributes[e[0].id]===k.DETERMINISTIC,C=P.includes(h.attributes[e[0].id]),T=h.attributes[e[0].id]===k.UNRELATED,fe=h.attributes[e[1].id]===k.DETERMINISTIC,Y=P.includes(h.attributes[e[1].id]),B=h.attributes[e[1].id]===k.UNRELATED,Ie=h.attributes[e[2].id]===k.DETERMINISTIC,Z=P.includes(h.attributes[e[2].id]),F=h.attributes[e[2].id]===k.UNRELATED;if(T&&B&&F)return I.push(h.id);j&&B&&F&&s.push(h.id),T&&fe&&F&&o.push(h.id),T&&B&&Ie&&c.push(h.id),C&&Y&&F&&r.push(h.id),C&&B&&Z&&d.push(h.id),T&&Y&&Z&&g.push(h.id),C&&Y&&Z&&u.push(h.id)});const x=e.map(h=>({id:h.id,name:h.name.pt,description:h.description.pt,spriteId:h.spriteId,itemsIds:[]}));x[0].itemsIds=m.sampleSize(s,s.length>3?3:Math.max(s.length-1,1)),x[1].itemsIds=m.sampleSize(o,o.length>3?3:Math.max(s.length-1,1)),x[2].itemsIds=m.sampleSize(c,c.length>3?3:Math.max(s.length-1,1));const A=[];x.forEach(h=>{A.push(...h.itemsIds)});const N=[];r.length>0&&N.push({spritesIds:[e[0].spriteId,e[1].spriteId],itemId:m.sample(r)??""}),d.length>0&&N.push({spritesIds:[e[0].spriteId,e[2].spriteId],itemId:m.sample(d)??""}),g.length>0&&N.push({spritesIds:[e[1].spriteId,e[2].spriteId],itemId:m.sample(g)??""}),u.length>0&&N.push({spritesIds:e.map(h=>h.spriteId),itemId:m.sample(u)??""});const D=[];s.length>0&&D.push({spritesIds:[e[0].spriteId],itemId:s.filter(h=>!A.includes(h))[0]}),o.length>0&&D.push({spritesIds:[e[1].spriteId],itemId:o.filter(h=>!A.includes(h))[0]}),c.length>0&&D.push({spritesIds:[e[2].spriteId],itemId:c.filter(h=>!A.includes(h))[0]});let b=m.sampleSize(N,4);b.length<3&&b.push(...m.sampleSize(D,4-b.length)),b.length<4&&console.log("🔆 Not enough requests for an alien communication, marking it as invalid"),b=m.shuffle(b);const y=b.map(h=>h.itemId),f={id:"0000-00-00",setId:x.map(h=>h.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:x,requests:b,solution:y.join("-"),itemsIds:m.shuffle([...y,...m.sampleSize([I[0],I[1],I[2],I[3]],m.random(1,3))]).filter(Boolean),valid:!1};return f.valid=[f.attributes.length===3,f.requests.length===4,f.itemsIds.length>4,f.attributes.every(h=>h.itemsIds.length>0),f.requests.every(h=>h.itemId)].every(Boolean),f},is=(t,n,a,l)=>{const[e]=M(p.CONTROLE_DE_ESTOQUE,l);return{entries:S.useMemo(()=>!t||!e?{}:ns(a,e),[t,a,e]),isLoading:!1}},ns=(t,n)=>{console.count("Creating Controle de Estoque...");let a=n.latestDate;const l={};for(let e=0;e<t;e++){const s=G(a);a=s,l[s]=cs(s,n.latestNumber+e+1)}return l},rs=256,as=16,os=4,ls=1,cs=(t,n)=>{const[a,l,e]=t.split("-").map(Number),o=new Date(a,l-1,e).getDay(),c=["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"][o],r={id:t,number:n,type:"controle-de-estoque",language:"pt",title:c,goods:[],orders:[]},d=m.sampleSize(Array(rs).fill("").map((u,I)=>`good-${I+1}`),as+ls),g=d.pop();if(r.goods=d,r.orders=m.sampleSize(r.goods,os),!g)throw new Error("No out of stock good");return r.orders.push(g),r.orders=m.shuffle(r.orders),r},ds=(t,n,a,l)=>{const[e]=M(p.FILMACO,l),s=v("daily-movie-sets",t);return{entries:S.useMemo(()=>!t||!s.isSuccess||!e?{}:(Object.values(s.data).filter(r=>r.itemsIds.length>0&&!e.used.includes(r.id)).length<=a&&X("filmaco","Not enough unused films"),us(a,e,s.data)),[t,s,e,a]),isLoading:s.isLoading}},us=(t,n,a)=>{console.count("Creating Filmaço...");const l=m.shuffle(Object.values(a).filter(c=>c.itemsIds.filter(Boolean).length>0)),e=l.filter(c=>!n.used.includes(c.id));e.length<t&&e.push(...m.shuffle(l));let s=n.latestDate;const o={};for(let c=0;c<t;c++){const r=e[c];if(!r){console.error("No filmaço sets left");break}const d=G(s);s=d,o[d]={id:d,type:"filmaco",number:n.latestNumber+c+1,setId:r.id,title:r.title,itemsIds:r.itemsIds,year:r.year}}return o},ms=(t,n,a,l)=>{const[e]=M(p.PALAVREADO,l),s=K(4,n,t),o=K(5,n,t);return{entries:S.useMemo(()=>!t||!s.data||!s.data.length||!o.data||!o.data.length||!e?{}:ps(a,e,s.data,o.data),[t,s,o,e,a]),isLoading:s.isLoading||o.isLoading}},ps=(t,n,a,l)=>{console.count("Creating Palavreado...");let e=n.latestDate;const s=[],o={};for(let c=0;c<t;c++){const r=G(e),d=ue(r),g=d?5:4;e=r,o[r]={id:r,type:"palavreado",number:n.latestNumber+c+1,...gs(d?l:a,[...Object.values(o).map(u=>u.keyword),...n.used],s,g)}}return o},gs=(t,n,a,l=4,e)=>{let s=m.shuffle(m.difference(t,a,n));const o=e||(s.pop()??""),c=[];for(let r=0;r<l;r++){const d=hs(t,o,c,r);c.push(d)}return a.push(o,...c),{keyword:o,words:c,letters:fs(c,o.length)}},hs=(t,n,a,l)=>{const e=m.uniq([...m.flatMap(a.map(c=>c.split(""))),...n.split("")]),s=m.shuffle(t.filter(c=>c[l]===n[l]&&!a.includes(c)));return m.sortBy(s,c=>m.intersection(c.split(""),e).length)[0]},fs=(t,n)=>{const a=m.flatMap(t.map(o=>o.split(""))),l=n===4?[0,5,10,15]:[0,6,12,18,24],e=m.shuffle(a.filter((o,c)=>!l.includes(c))),s=[];for(let o=0;o<a.length;o++)l.includes(o)?s.push(a[o]):s.push(e.shift()??"");return s},Is=(t,n,a,l)=>{const[e]=M(p.PORTAIS_MAGICOS,l),s=v("daily-passcode-sets",t),o=K(3,n,t);return{entries:S.useMemo(()=>{if(!t||!s.isSuccess||!o.isSuccess||!e)return{};const r=o.data.reduce((d,g)=>(g.split("").forEach(u=>{d[u]||(d[u]=[]),d[u].push(g)}),d),{" ":["  "],"-":[" - "]});return xs(a,e,s.data,r)},[t,a,s.isSuccess,s.data,o.isSuccess,o.data,e]),isLoading:s.isLoading||o.isLoading}},xs=(t,n,a,l)=>{console.count("Creating Portais Mágicos...");let e=n.latestDate;const s=n.used,o={};let c=m.shuffle(Object.values(a).filter(d=>d.imageCardsIds.length>0));const r={};for(let d=0;d<t;d++){const g=G(e),u=[];let I=[...c];const x=[];for(;x.length<3;){const A=I.pop();if(!A)throw new Error("Not enough sets available");const N=m.sample(A.passcode.filter(f=>f.length<=12&&!s.includes(f)))||"";if(!N)continue;const D=x.length+1;u.push(A.id),o[A.id]=!0;const b=N.split("").map(f=>m.sample(l[f])||` ${f} `),y=m.sampleSize(A.imageCardsIds,D);x.push({passcode:N,imagesIds:y,words:b}),I=I.filter(f=>!o[f.id]&&f.imageCardsIds.length>D)}e=g,r[g]={id:g,type:"portais-magicos",setId:u.join($),number:n.latestNumber+d+1,corridors:x.reverse()},c=c.filter(A=>!o[A.id])}return r},js=(t,n,a,l)=>{const[e]=M(p.QUARTETOS,l),s=v("daily-quartet-sets",t),o=v("items-groups",t);return{entries:S.useMemo(()=>!t||s.isLoading||o.isLoading||!e?{}:As(a,e,n,s.data,o.data),[t,n,e,a,s,o]),isLoading:s.isLoading||o.isLoading}},As=(t,n,a,l,e)=>{console.count("Creating Quartetos...");let s=Object.values(l).filter(r=>r.itemsIds.length>=4&&!n.used.includes(r.id)&&!r.flagged),o=n.latestDate;const c={};return Array.from({length:t}).forEach((r,d)=>{const g=[],u={};let I=m.cloneDeep(s),x=0;for(;g.length<3&&x<500;){const j=m.sample(I);if(!j)throw Error("No potential set found for Quartetos game");I=I.filter(T=>T.id!==j.id);const C=m.orderBy(m.sampleSize(j.itemsIds,4),T=>Number(T));if(C.some(T=>u[T])){x++;continue}j.itemsIds.forEach(T=>{u[T]=!0}),g.push({id:j.id,title:j.title,itemsIds:C,level:j.level??1}),x=0}const A=g.map(j=>j.id);s=s.filter(j=>!A.includes(j.id));const N=Object.values(e).filter(j=>j.itemsIds.some(C=>!u[C])&&j.itemsIds.length>=4&&j.nsfw!==!0),D=m.sample(N);if(!D)throw Error("No eligible group found for Quartetos game");g.push({id:D.id,title:m.capitalize(D.name[a]),itemsIds:m.sampleSize(D.itemsIds,4),level:1});const b=Math.ceil(g.reduce((j,C)=>j+C.level,0)/g.length),y=m.orderBy(g,["level"],["desc"]).map((j,C)=>(j.level=C,j)),f=g.map(j=>j.id).join($),h=m.shuffle(g.flatMap(j=>j.itemsIds)),P=G(o);o=P,c[P]={id:P,number:n.latestNumber+d+1,setId:f,type:"quartetos",grid:h,difficulty:b,sets:y}}),c},ys=(t,n)=>Q([...t,...n.flatMap(a=>a.sets.map(l=>l.id))]),Ss=(t,n,a,l)=>{const[e]=M(p.TA_NA_CARA,l),s=v("suspects",t),o=v(`testimony-questions-${n}`,t);return{entries:S.useMemo(()=>!t||!s.isSuccess||!o.isSuccess||!e?{}:Ds(a,e,s.data,o.data),[t,s,o,e,a]),isLoading:s.isLoading||o.isLoading}},re=15,ae=13,Ds=(t,n,a,l)=>{console.count("Creating Tá Na Cara...");const e=he(n.used),s=m.orderBy(m.shuffle(Object.values(a)),[d=>(e==null?void 0:e[d.id])??0],["asc"]).slice(0,ae*4).map(d=>{const[,g]=d.id.split("-");return{id:`us-gb-${g}`,used:0}}),o=m.orderBy(m.shuffle(Object.values(l)),[d=>e==null?void 0:e[d.id]],["asc"]).slice(0,re*4).map(d=>({testimony:d,used:0}));let c=n.latestDate;const r={};for(let d=0;d<t;d++){const g=oe(o,re).map(I=>({testimonyId:I.testimony.id,question:I.testimony.question,nsfw:!!I.testimony.nsfw})),u=G(c);c=u,r[u]={id:u,type:"ta-na-cara",number:n.latestNumber+d+1,suspectsIds:oe(s,ae).map(I=>I.id),testimonies:g}}return r},oe=(t,n)=>{const l=m.orderBy(t,[e=>e.used],["asc"]).slice(0,n);return l.forEach(e=>{e.used+=1}),l},he=t=>t.reduce((n,a)=>{const l=a.split($),e=l[0],s=Number(l[1]);if(e.startsWith("us")){const o=e.split("-"),c=`${o[0]}-${o[2]}`;return n[c]=s||0,n}return n[e]=s||0,n},{}),Ns=(t,n)=>{const a=he(t);return n.forEach(l=>{var e;l.testimonies.forEach(s=>{a[s.testimonyId]===void 0&&(a[s.testimonyId]=0),a[s.testimonyId]+=1}),(e=l.suspectsIds)==null||e.forEach(s=>{a[s]===void 0&&(a[s]=0),a[s]+=1})}),Object.entries(a).map(([l,e])=>`${l}${$}${e}`)};function bs(t,n,a){const l=me.DAILY[n??"pt"],e=pe(l,{enabled:t});S.useEffect(()=>{We()},[a,n]);const s=t&&e.isSuccess,o=Ye(s,n,a,e.data??{}),c=He(s,n,a,e.data??{}),r=es(s,n,a,e.data??{}),d=is(s,n,a,e.data??{}),g=ds(s,n,a,e.data??{}),u=ms(s,n,a,e.data??{}),I=js(s,n,a,e.data??{}),x=Ge(s,n,a,e.data??{}),A=Is(s,n,a,e.data??{}),N=Xe(s,n,a,e.data??{},c.entries),D=Ss(s,n,a,e.data??{}),b=S.useMemo(()=>c.entries.length===0?[]:(console.count("Bundling entries..."),c.entries.map(y=>({id:y.id,"arte-ruim":y,"aqui-o":o.entries[y.id],"comunicacao-alienigena":r.entries[y.id],"controle-de-estoque":d.entries[y.id],filmaco:g.entries[y.id],palavreado:u.entries[y.id],"portais-magicos":A.entries[y.id],quartetos:I.entries[y.id],"teoria-de-conjuntos":x.entries[y.id],artista:N.entries[y.id],"ta-na-cara":D.entries[y.id]}))),[c.entries,o.entries,g.entries,r.entries,d.entries,u.entries,A.entries,I.entries,x.entries,N.entries,D.entries]);return{isLoading:e.isLoading||o.isLoading||c.isLoading||r.isLoading||d.isLoading||g.isLoading||u.isLoading||A.isLoading||I.isLoading||x.isLoading||N.isLoading||D.isLoading,entries:b}}function Es(t){const{notification:n}=De.useApp(),a=Ne(),l=me.DAILY[t??"pt"],[e,s]=S.useState(!1),o=pe(l,{enabled:!!l}),c=ke({mutationFn:async r=>{var x,A,N,D,b,y;const d=r.map(f=>{const h=z(ee,`${l}/${f.id}`);return se(h,f)}),g=z(ee,`${l}/history`),u=o.data;if(!u)throw new Error("No previous history");const I={...u,[p.ARTE_RUIM]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.ARTE_RUIM].number,used:JSON.stringify(Q([...JSON.parse(u[p.ARTE_RUIM].used),...r.map(f=>f[p.ARTE_RUIM].cardId)]))},[p.AQUI_O]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.AQUI_O].number,used:JSON.stringify(Q([...JSON.parse(u[p.AQUI_O].used??"[]"),...r.map(f=>f[p.AQUI_O].setId)]))},[p.PALAVREADO]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.PALAVREADO].number,used:JSON.stringify(Q([...JSON.parse(u.palavreado.used),...r.map(f=>f[p.PALAVREADO].keyword)]))},[p.ARTISTA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.ARTISTA].number,used:"[]"},[p.FILMACO]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.FILMACO].number,used:JSON.stringify(Q([...JSON.parse(((x=u==null?void 0:u[p.FILMACO])==null?void 0:x.used)??"[]"),...r.map(f=>f[p.FILMACO].setId)]))},[p.CONTROLE_DE_ESTOQUE]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.CONTROLE_DE_ESTOQUE].number,used:"[]"},[p.TEORIA_DE_CONJUNTOS]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.TEORIA_DE_CONJUNTOS].number,used:JSON.stringify(Q([...JSON.parse(((A=u==null?void 0:u[p.TEORIA_DE_CONJUNTOS])==null?void 0:A.used)??"[]"),...r.map(f=>f[p.TEORIA_DE_CONJUNTOS].setId),...r.map(f=>f[p.TEORIA_DE_CONJUNTOS].intersectingThing.id)]))},[p.COMUNICACAO_ALIENIGENA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.COMUNICACAO_ALIENIGENA].number,used:JSON.stringify(Q([...JSON.parse(((N=u==null?void 0:u[p.COMUNICACAO_ALIENIGENA])==null?void 0:N.used)??"[]"),...r.map(f=>f[p.COMUNICACAO_ALIENIGENA].setId)]))},[p.QUARTETOS]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.QUARTETOS].number,used:JSON.stringify(ys(JSON.parse(((D=u==null?void 0:u[p.QUARTETOS])==null?void 0:D.used)??"[]"),r.map(f=>f[p.QUARTETOS])))},[p.TA_NA_CARA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.TA_NA_CARA].number,used:JSON.stringify(Ns(JSON.parse(((b=u==null?void 0:u[p.TA_NA_CARA])==null?void 0:b.used)??"[]"),r.map(f=>f[p.TA_NA_CARA])))},[p.PORTAIS_MAGICOS]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.PORTAIS_MAGICOS].number,used:JSON.stringify(Q([...JSON.parse(((y=u==null?void 0:u[p.PORTAIS_MAGICOS])==null?void 0:y.used)??"[]"),...r.map(f=>f[p.PORTAIS_MAGICOS].corridors.map(h=>h.passcode))].flat()))}};return se(g,I),Promise.all(d)},onSuccess:()=>{n.info({message:"Data saved",placement:"bottomLeft"}),a.invalidateQueries({queryKey:[l,"history"]}),s(!1)},onError:()=>{n.error({message:"Error saving data",placement:"bottomLeft"})}});return{isDirty:e,setIsDirty:s,save:c.mutateAsync,isPending:c.isPending}}function Os({language:t,dataLoad:n}){const a=t,{is:l}=Oe(),e=$e();console.log(e);const{save:s,isPending:o}=Es(a??"pt");return l("dataCheck")?i.jsx(Je,{}):i.jsxs("div",{children:[i.jsx(V.Title,{level:2,children:"Data Population"}),n.isLoading&&i.jsx("div",{children:"Loading..."}),i.jsxs(O,{justify:"space-between",align:"center",children:[i.jsxs("span",{children:[i.jsx(le,{to:"/game/daily-setup?dataCheck=true",children:"Go to Check"}),i.jsxs(V.Title,{level:4,children:["Total: ",n.entries.length]})]}),i.jsx(J,{onClick:()=>s(n.entries),loading:o,disabled:(n.entries??[]).length===0,type:"primary",size:"large",icon:i.jsx(Qe,{}),children:"Save"})]}),Object.values(e).map(c=>i.jsx(L,{message:c,type:"warning",showIcon:!0,banner:!0},c)),i.jsx(de,{columns:ge,dataSource:n.entries??[],scroll:{x:"max-content"}})]})}function Cs({language:t,setLanguage:n,drawingsCount:a,setDrawingsCount:l,batchSize:e,setBatchSize:s}){return i.jsxs(Ue,{children:[i.jsx(H,{label:"Language",value:t,onChange:n,options:[ve],placeholder:"Select a language"}),i.jsx(H,{label:"Minimum Drawings",value:a,onChange:l,options:[2,3,4],placeholder:"Select a number"}),i.jsx(H,{label:"Batch Size",value:e,onChange:s,options:[3,7,14,21,28],placeholder:"Select a number"})]})}function pt(){const[t,n]=S.useState(""),[a,l]=S.useState(3),[e,s]=S.useState(7),o=bs(!!t,t,e);return i.jsx(be,{title:"Daily Setup",children:i.jsxs(te,{hasSider:!0,children:[i.jsxs(qe,{children:[i.jsx(Ee,{isLoading:o.isLoading,error:null,hasResponseData:!o.isLoading}),i.jsx(Cs,{language:t,setLanguage:n,drawingsCount:a,setDrawingsCount:l,batchSize:e,setBatchSize:s})]}),i.jsx(te.Content,{className:"content",children:i.jsx(Pe,{isLoading:o.isLoading,error:null,hasResponseData:!o.isLoading,children:i.jsx(Os,{language:t,dataLoad:o})})})]})},e)}export{pt as default};
