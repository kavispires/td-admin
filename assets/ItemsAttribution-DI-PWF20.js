import{r as g,Q as qe,a as k,_ as z,ag as Ke,ah as He,ai as Ye,aj as Je,Y as he,X as Ze,j as e,T as D,D as q,B as N,V as We,y as we,af as fe,ak as Xe,al as et,P as tt,L as Ie}from"./index--ZN08wDu.js";import{D as st}from"./DataLoadingWrapper-Dj_-u3Q9.js";import{c as K,a as se,b as Pe,d as ce,T as rt}from"./FilterEntries-Bt5hb3C_.js";import{S as nt}from"./SiderContent-BGog9jVv.js";import{D as Ne}from"./DownloadButton-Bv12psgp.js";import{S as it}from"./SaveButton-fIKqx0J1.js";import{l as x}from"./lodash-C4Hxytv_.js";import{A as M,d as w,e as at,f as Y}from"./constants-Blyo5O-7.js";import{e as lt,g as ot,a as xe,d as Re,w as ct,m as ut}from"./index-BdxyXXU_.js";import{u as dt}from"./useGetFirebaseDoc-TTiolrDv.js";import{u as ie}from"./useTDResource-Bhl0DGmZ.js";import{u as mt}from"./useUpdateFirebaseDoc-C_CYbUVF.js";import{T as ne}from"./index-C861Mivw.js";import{F as S}from"./index-B-6VEyuq.js";import{V as pt}from"./VerticalAlignTopOutlined-v_ZPtoJ9.js";import{I as W,a as X,b as _,c as le}from"./ItemBuildingBlocks-DbJAZKXN.js";import{Q as gt}from"./index-BDlbjGSh.js";import{R as ve}from"./index-tN6sZD5q.js";import{R as ue}from"./CheckCircleFilled-C-D0Dvi6.js";import{c as de,E as ae,P as ht}from"./useBaseUrl-BBgSjbf3.js";import{I as ye}from"./Item-CaPucQvD.js";import{P as Oe}from"./progress-BDqoLgrn.js";import{R as Ae,u as ft}from"./CloseCircleOutlined-CN1d3iF4.js";import{C as Z}from"./index-BC-RKAwc.js";import{A as xt}from"./index-DRmNAu00.js";import{S as G}from"./index-CILhh8AU.js";import{u as be}from"./useQueryParams-cx1saSCA.js";import{I as bt}from"./ItemsTypeahead-BEcZ7TXc.js";import{D as jt,a as It,P as vt}from"./Pagination-ChnU4fFY.js";import{S as te}from"./index-BREe-kUz.js";import{a as yt,P as At,F as Le}from"./Table-s6JZFxxk.js";import{D as Tt}from"./index-edGriaUJ.js";import{S as Ct}from"./index-h5cVVWuI.js";import{P as Et}from"./index-DgzQw0l5.js";import{M as St}from"./index-BmzHl8Do.js";import{T as wt}from"./TransparentButton-afbOV1md.js";import{T as Pt}from"./index-Bexbogsc.js";import{R as Nt}from"./SkinOutlined-B92SFXuH.js";import{R as Rt}from"./index-E9A5NuQC.js";import"./index-Cy6P54MH.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-w-cKtu32.js";import"./useMutation-Cq17nn2b.js";import"./gapSize-U1swVQyS.js";import"./LanguageFlag-BwJSokXu.js";import"./useCopyToClipboardFunction-Cc0mc4E0.js";import"./index-DLRBWlvL.js";import"./Input-D6Eu7mtO.js";import"./FireFilled-MNouW6_0.js";import"./IdcardOutlined-CHUH6O1F.js";import"./throttleByAnimationFrame-ClkYbeUf.js";import"./useDebounce-C3uk4WDH.js";import"./index-CgJdUi3N.js";import"./scrollTo-DX6_30e9.js";import"./extendsObject-keMuGWqj.js";import"./PlusOutlined-ByZyTB3m.js";var Ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"},Lt={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},Dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},Ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},Vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},Ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Mt=function(s,r){return qe?window.matchMedia(s).matches:!1},kt=function(s,r){var t=g.useState(Mt(s)),n=t[0],o=t[1];return g.useEffect(function(){var i=!0,l=window.matchMedia(s),c=function(){i&&o(!!l.matches)};return l.addEventListener("change",c),o(l.matches),function(){i=!1,l.removeEventListener("change",c)}},[s]),n},zt=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:Ot}))},Bt=g.forwardRef(zt),$t=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:Lt}))},_t=g.forwardRef($t),Gt=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:jt}))},Qt=g.forwardRef(Gt),qt=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:It}))},Kt=g.forwardRef(qt),Ht=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:yt}))},Yt=g.forwardRef(Ht),Jt=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:Dt}))},Zt=g.forwardRef(Jt),Wt=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:Ke}))},Xt=g.forwardRef(Wt),es=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:Ut}))},ts=g.forwardRef(es),ss=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:At}))},rs=g.forwardRef(ss),ns=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:gt}))},De=g.forwardRef(ns),is=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:He}))},as=g.forwardRef(is),ls=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:Ye}))},os=g.forwardRef(ls),cs=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:pt}))},us=g.forwardRef(cs),ds=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:Vt}))},ms=g.forwardRef(ds),ps=function(r,t){return g.createElement(k,z({},r,{ref:t,icon:Ft}))},gs=g.forwardRef(ps);const Ue={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};x.keyBy(Ue,"prefix");const hs=["*","^","+","~","!"],H={ATTRIBUTE_VALUE_DICT:Ue,ATTRIBUTE_VALUE_PRIORITY:hs},me=(s={})=>x.cloneDeep(x.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},s)),pe=(s={})=>x.cloneDeep(x.merge({id:"",attributes:{}},s)),Ve=(s,r,t)=>{const n=x.orderBy(Object.values(r),["priority","id"],["asc","asc"]).map(a=>a.id);function o(a,u){return x.orderBy(a,j=>n.indexOf(j),["asc"]).map(j=>`${u}${j}`)}const i=[],l=[],c=[],m=[],b=[];return Object.entries(s.attributes).forEach(([a,u])=>{if(r[a])switch(u){case w.OPPOSITE:i.push(a);break;case w.DETERMINISTIC:l.push(a);break;case w.RELATED:c.push(a);break;case w.UNRELATED:m.push(a);break;case w.UNCLEAR:b.push(a);break;default:b.push(a);break}}),[...o(i,M.OPPOSITE),...o(l,M.DETERMINISTIC),...o(c,M.RELATED),...o(m,M.UNRELATED),...o(b,M.UNCLEAR)]},Fe=x.memoize(s=>{if(s.length===3)return{key:s,className:"",text:""};const r=s[0];return{key:s.slice(1,4),className:{[M.DETERMINISTIC]:"deterministic",[M.UNRELATED]:"unrelated",[M.UNCLEAR]:"unclear",[M.OPPOSITE]:"opposite"}[r],text:{[M.DETERMINISTIC]:"very",[M.UNRELATED]:"not",[M.UNCLEAR]:"maybe",[M.OPPOSITE]:"very not"}[r]}}),Me=(s,r,t)=>s.filter(n=>!(!r&&n.includes(M.UNCLEAR)||!t&&n.includes(M.UNRELATED)));function ge(s,r,t){const n=[];for(const[l,c]of Object.entries(s.attributes)){const m=r[l];if(m){const b=Object.values(H.ATTRIBUTE_VALUE_DICT).find(a=>a.value===c);b&&n.push({prefix:b.prefix,id:m.id,priority:m.priority})}}const o=x.sortBy(n,[l=>H.ATTRIBUTE_VALUE_PRIORITY.indexOf(l.prefix),l=>l.prefix===H.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:l.priority,["asc","asc"]]),i=t!=null&&t.length?o.slice(0,t==null?void 0:t.length):o;return t!=null&&t.onlyRelevant?i.filter(l=>[H.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,H.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(l.prefix)).map(l=>`${l.prefix}${l.id}`).join(""):i.map(l=>`${l.prefix}${l.id}`).join((t==null?void 0:t.delimiter)??"")}const fs=x.keyBy(H.ATTRIBUTE_VALUE_DICT,"prefix");function xs(s){return(s.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((t,n)=>{const o=n[0],i=n.slice(1),l=fs[o].value;return t[i]=l,t},{})}function ke(s){return Object.values(s.attributes).reduce((r,t)=>{let n=r;return t<=0?(t===H.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(n+=t/2),n):n+t},0)}function ze(s,r){const t=Object.values(s.attributes).filter(n=>n===H.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((r-t)/r*100)}function F(){const[s,r]=Je(),t=(o,i)=>{s.set(o,`${i}`),r(s)},n=o=>{s.delete(o),r(s)};return{view:s.get("view")??"classifier",setView:o=>r({view:o}),addQueryParam:t,removeQueryParam:n,searchParams:s}}const re={};function bs(){const{notification:s,message:r}=he.useApp(),t=Ze(),n=ie("items"),o=ie("items-attributes"),i=ie("items-attribute-values"),l=dt("tdr","itemsAttributeValues",{select:I=>Is({itemAttributesValues:I,itemAttributes:o.data??{}})}),[c,m]=g.useState({}),b=mt("tdr","itemsAttributeValues",{onSuccess:()=>{s.success({message:"itemsAttributeValues updated"}),t.refetchQueries({queryKey:["firebase","tdr","itemsAttributeValues"]}),m({})},onError:I=>{s.error({message:"itemsAttributeValues update failed",description:I.message})}}),a=g.useMemo(()=>({...i.data??{},...l.data??{}}),[i.data,l.data]),u=!x.isEmpty(c),j=(I,y)=>{m(d=>({...d,[I]:{...y,updatedAt:Date.now()}}))},f=I=>{m(y=>({...y,...x.mapKeys(I.map(d=>({...d,updatedAt:Date.now()})),"id")}))},p=l.data,h=()=>{b.mutate(js({...p,...c},o.data))};return{availableItemIds:g.useMemo(()=>{const I=n.data??{};return x.orderBy(Object.keys(I).filter(y=>{var d;return(((d=I[y])==null?void 0:d.decks)??[]).includes("alien")}),y=>Number(y),"asc")},[n.data]),getItem:I=>{var y;return(y=n.data)!=null&&y[I]?n.data[I]:(I&&r.info(`Item ${I} not found in TDR. Creating a new item...`),me({id:I}))},getItemAttributeValues:I=>{const y=(a==null?void 0:a[I])??{},d=c[I]??{};return x.isEmpty(y)&&x.isEmpty(d)?(re[I]=pe({id:I}),re[I]):x.merge((re==null?void 0:re[I])??{},y,d)},attributes:o.data??{},isLoading:n.isLoading||o.isLoading||i.isLoading||l.isLoading,error:n.error||o.error||i.error||l.error,firebaseData:p,hasFirestoreData:!x.isEmpty(l.data),isSaving:b.isPending,save:h,addAttributesToUpdate:j,addMultipleAttributesToUpdate:f,attributesToUpdate:c,isDirty:u}}const js=(s,r)=>ot(s,n=>({id:n.id,tempSignature:ge(n,r),updatedAt:n.updatedAt})),Is=s=>{const{itemAttributesValues:r,itemAttributes:t}=s,n=Object.keys(t).length;return lt(r,i=>{const l=xs(i.tempSignature),c=Object.keys(l).length===n,m={id:i.id,updatedAt:i.updatedAt,attributes:l};return c?{...m,complete:c,reliability:ze(m,n),score:ke(m)}:m})},Be=g.createContext({getItem:()=>me(),getItemAttributeValues:()=>pe(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:me(),itemAttributeValues:pe(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{},hasFirestoreData:!1}),vs=({children:s})=>{const{getItem:r,getItemAttributeValues:t,availableItemIds:n,isLoading:o,error:i,isSaving:l,save:c,addAttributesToUpdate:m,isDirty:b,attributes:a,addMultipleAttributesToUpdate:u,attributesToUpdate:j,hasFirestoreData:f}=bs(),{message:p}=he.useApp(),h=g.useMemo(()=>x.orderBy(Object.values(a),"name.en","asc"),[a]),{searchParams:T}=F(),A=T.get("sortBy"),C=g.useMemo(()=>A==="id"?x.orderBy(n,v=>Number(v),"asc"):A==="updatedAt"?x.orderBy(n,v=>t(v).updatedAt,"desc"):A==="fewestAttributesLeft"?x.orderBy(n,v=>{const E=h.length-Object.keys(t(v).attributes).length;return E===0?Number.POSITIVE_INFINITY:E},"asc"):n,[n,A]),[I,y]=g.useState(x.random(0,C.length-1)),d=r(C[I]),V=t(d.id),B=(v,E)=>{if(v==="next"){y(P=>(P+1)%C.length);return}if(v==="previous"){y(P=>(P-1+C.length)%C.length);return}if(v==="random"){y(x.random(0,C.length-1));return}if(v==="first"){y(0);return}if(v==="last"){y(C.length-1);return}if(v==="next10"){y(P=>(P+10)%C.length);return}if(v==="previous10"){y(P=>(P-10+C.length)%C.length);return}if(v==="incomplete"){y(P=>{let O=P+1;for(;O<C.length;){const $=t(C[O]);if(Object.keys($.attributes).length!==h.length)return O;if(O===C.length-1)return p.info("No more incomplete items found."),P;O++}return P});return}if(v==="goTo"&&E!==void 0){const P=C.indexOf(E);if(P!==-1){y(P);return}p.error(`Item ${E} is not available for attribution.`)}},R=(v,E)=>{m(d.id,{...V,attributes:{...V.attributes,[v]:E}})},L=()=>xe(n.reduce((v,E)=>{const P=t(E);return x.isEmpty(P.attributes)||(Object.keys(P.attributes).length===h.length?P.complete=!0:delete P.complete,v[P.id]=P),v},{}));return e.jsx(Be.Provider,{value:{getItem:r,getItemAttributeValues:t,availableItemIds:n,isLoading:o,error:i,hasResponseData:n.length>0&&!x.isEmpty(a),isDirty:b,itemAttributeValues:V,jumpToItem:B,activeItem:d,onAttributeChange:R,isSaving:l,save:c,attributes:a,attributesList:h,addAttributesToUpdate:m,addMultipleAttributesToUpdate:u,prepareItemsAttributesFileForDownload:L,attributesToUpdate:j,hasFirestoreData:f},children:s})},U=()=>g.useContext(Be);function Q({label:s,children:r}){return e.jsxs(D.Text,{children:[s," ",e.jsx(ne,{children:r})]})}function ys(){const{getItemAttributeValues:s,availableItemIds:r,attributesList:t}=U(),{total:n,complete:o,completionPercentage:i,hasDataCount:l,initiatedPercentage:c,progress:m,progressTotal:b,currentProgress:a}=g.useMemo(()=>{const u=r.length;let j=0,f=0,p=0;r.map(A=>s(A)).forEach(({attributes:A})=>{x.isEmpty(A)||(j+=1),Object.values(A).length===t.length&&(f+=1),p+=Object.values(A).length});const T=Object.values(t).length*r.length;return{total:u,complete:f,completionPercentage:u>0?(f/u*100).toFixed(1):0,hasDataCount:j,initiatedPercentage:u>0?Math.floor(j/u*100):0,progress:(p/T*100).toFixed(1),currentProgress:p,progressTotal:T}},[t,r,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{vertical:!0,children:[e.jsx(D.Text,{strong:!0,className:"mb-2",children:"Items Stats"}),e.jsx(Q,{label:"Total",children:n}),e.jsxs(Q,{label:"Complete",children:[o," (",i,"%)"]}),e.jsxs(Q,{label:"Initiated",children:[l," (",c,"%)"]}),e.jsx(D.Text,{strong:!0,className:"mt-4 mb-2",children:"Attributes Stats"}),e.jsx(Q,{label:"Total",children:b}),e.jsx(Q,{label:"Set",children:a}),e.jsxs(Q,{label:"Progress",children:[m,"%"]})]}),e.jsx(q,{})]})}function As(){const{jumpToItem:s}=U(),{searchParams:r,addQueryParam:t}=F();return e.jsxs(e.Fragment,{children:[e.jsx(N,{block:!0,onClick:()=>s("random"),type:"primary",children:"Random Item"}),e.jsx(K,{label:"Unset Only",value:r.get("scope")==="unset",onChange:n=>t("scope",n?"unset":""),className:"mt-4"})]})}function Ts(){const{searchParams:s,addQueryParam:r}=F(),{attributesList:t}=U(),n=g.useMemo(()=>[{label:"Random Attribute",value:"random"},...t.map(({id:o,name:i})=>({label:i.en,value:o}))],[t]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Sampler Attribute",value:s.get("attribute")||"random",onChange:o=>r("attribute",o),options:n}),e.jsx(Pe,{label:"Sample Size",value:Number(s.get("size")||9),onChange:o=>r("size",String(o)),min:3,max:21,step:3})]})}function Cs(){const{searchParams:s,addQueryParam:r}=F(),{attributesList:t}=U(),n=g.useMemo(()=>t.map(({id:o,name:i,...l})=>({label:`${i.en}${l.default?"*":""}`,value:o})),[t]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Attribute",value:s.get("attribute")||"ali",onChange:o=>r("attribute",o),options:n}),e.jsx(se,{label:"Scope",value:s.get("scope")||"unset",onChange:o=>r("scope",o),options:[{value:"unset",label:"Unset"},...at]}),e.jsx(se,{label:"Results per page",value:s.get("pageSize")||12,onChange:o=>r("pageSize",o),options:[12,24,48,96]})]})}function Es(){const{searchParams:s,addQueryParam:r}=F();return e.jsxs(e.Fragment,{children:[e.jsx(K,{label:"Only Complete",value:s.get("showComplete")==="true",onChange:t=>r("showComplete",t?"true":""),className:"full-width m-0"}),e.jsx(K,{label:"Show Unrelated",value:s.get("showUnrelated")==="true",onChange:t=>r("showUnrelated",t?"true":""),className:"full-width m-0"}),e.jsx(K,{label:"Show Unclear",value:s.get("showUnclear")==="true",onChange:t=>r("showUnclear",t?"true":""),className:"full-width m-0"})]})}function Ss(){const{searchParams:s,addQueryParam:r}=F();return e.jsx(e.Fragment,{children:e.jsx(K,{label:"Show Glyphs",value:s.get("showGlyphs")==="true",onChange:t=>r("showGlyphs",t?"true":""),className:"full-width m-0"})})}function ws(){const{isDirty:s,save:r,prepareItemsAttributesFileForDownload:t,attributes:n,isSaving:o,attributesToUpdate:i,hasFirestoreData:l}=U(),{view:c,setView:m}=F();return e.jsxs(nt,{children:[e.jsxs(S,{vertical:!0,gap:12,children:[e.jsx(it,{isDirty:s,onSave:r,isSaving:o,dirt:JSON.stringify(i)}),e.jsx(Ne,{data:()=>Ps(t(),n),fileName:"items-attribute-values.json",disabled:s,hasNewData:l,block:!0})]}),e.jsx(q,{}),e.jsx(ys,{}),e.jsx(se,{label:"View",value:c,onChange:m,options:["classifier","sampler","grouping","comparator","simulator","stats"]}),e.jsx(q,{}),c==="classifier"&&e.jsx(As,{}),c==="sampler"&&e.jsx(Ts,{}),c==="grouping"&&e.jsx(Cs,{}),c==="comparator"&&e.jsx(Es,{}),c==="stats"&&e.jsx(Ss,{})]})}function Ps(s,r){const t=Object.keys(r).length;Object.keys(s).forEach(o=>{const i=s[o],l=Object.keys(i.attributes);l.forEach(m=>{r[m]||delete i.attributes[m]}),l.length===t?(i.complete=!0,i.score=ke(i),i.reliability=ze(i,t),i.signature=ge(i,r,{onlyRelevant:!0})):(i.complete=void 0,i.score=void 0,i.reliability=void 0,i.signature=void 0)});const n={};return Object.values(s).forEach(o=>{n[o.id]={id:o.id,updatedAt:o.updatedAt,signature:ge(o,r,{delimiter:":"})},o.complete&&(n[o.id].complete=o.complete)}),console.log(n),xe(Re(s))}function $e(s){const[r,t]=g.useState(!1),n=()=>{t(window.scrollY>300)},o=()=>{window.scrollTo({top:0,behavior:"smooth"})};return We(()=>(window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)})),e.jsx(N,{className:`go-to-top-button ${r?"visible":""}`,onClick:o,icon:e.jsx(us,{}),...s,children:"Go to Top"})}function _e({title:s,icon:r}){return e.jsx(we,{title:s,children:r??e.jsx(De,{})})}const Te=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC}],Ce=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC,disabled:!0}];function oe({attribute:s,value:r,onChange:t,onlyButtons:n,size:o}){return s?n?e.jsx(ve.Group,{options:s.limited?Ce:Te,onChange:({target:{value:i}})=>t(s.id,i),value:r,optionType:"button",buttonStyle:"solid",size:o}):e.jsxs("div",{className:"attribute-button-container__row",children:[e.jsxs("span",{className:"attribute-button-container__label",children:[x.truncate(s.name.en,{length:12})," ",e.jsx(_e,{title:s.description.en})]}),e.jsx(ve.Group,{options:s.limited?Ce:Te,onChange:({target:{value:i}})=>t(s.id,i),value:r,optionType:"button",buttonStyle:"solid",size:o}),e.jsx("span",{children:e.jsx(ue,{style:{color:r&&r>7?"green":"transparent"}})})]},s.id):e.jsx(e.Fragment,{})}function Ns({itemAttributeValues:s,attributes:r}){const{searchParams:t,addQueryParam:n}=F(),o=t.get("showUnclear")==="true",i=t.get("showUnrelated")==="true",l=g.useMemo(()=>Me(Ve(s,r),o,i),[s,r,o,i]),c=t.get("signs")==="true"?Ge:Rs;return e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(K,{label:"Show Unrelated",value:t.get("showUnrelated")==="true",onChange:m=>n("showUnrelated",m?"true":""),className:"full-width m-0"}),e.jsx(K,{label:"Show Unclear",value:t.get("showUnclear")==="true",onChange:m=>n("showUnclear",m?"true":""),className:"full-width m-0"}),e.jsx(K,{label:"Alien Sings",value:t.get("signs")==="true",onChange:m=>n("signs",m?"true":""),className:"full-width m-0"}),e.jsx(S,{gap:6,wrap:"wrap",className:"item-attribute-value-statement",children:l.map((m,b,a)=>e.jsx(c,{keyVariant:m,attributes:r,firstElement:b===0,lastElement:b===a.length-1},m))})]})}function Ge({keyVariant:s,attributes:r,withText:t}){const{key:n,className:o,text:i}=Fe(s);return e.jsxs(S,{vertical:!0,align:"center",children:[e.jsx(Y,{width:50,id:r[n].spriteId,className:de("item-attribute-alien-sign",`item-attribute-alien-sign--${o}`)}),t&&e.jsxs(S,{wrap:"wrap",justify:"center",align:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},children:[i," ",r[n].name.en.toLowerCase()]})]})}function Rs({keyVariant:s,attributes:r,firstElement:t,lastElement:n}){const{key:o,text:i}=Fe(s),l=t?"It's ":"",c=n?".":", ";return e.jsxs(e.Fragment,{children:[l,i," ",r[o].name.en.toLowerCase(),c]})}function Os({attributesList:s,itemAttributeValues:r}){const{completion:t,isDeterministic:n,value:o,isOpposing:i,relevancy:l}=g.useMemo(()=>{const c=s.length,m=Object.keys(r.attributes).length,b=Math.floor(m/c*100);let a=!1,u=!1,j=0;const f=Object.values(r.attributes).reduce((h,T)=>T<=0?(T===w.UNCLEAR&&(j+=1),T===w.OPPOSITE&&(u=!0,h+=T/2),h):(T===w.DETERMINISTIC&&(a=!0),h+T),0),p=Math.floor((m-j)/c*100);return{completion:b,isDeterministic:a,value:f,isOpposing:u,relevancy:p}},[s,r.attributes]);return e.jsxs("div",{children:[e.jsx(D.Text,{strong:!0,children:"Completion"}),e.jsx(Oe,{percent:t,size:"small"}),e.jsx(D.Text,{strong:!0,children:"Stats"}),e.jsxs(S,{vertical:!0,children:[e.jsx(Q,{label:"Deterministic",children:n?e.jsx(ue,{style:{color:"green"}}):e.jsx(Ae,{style:{color:"red"}})}),e.jsx(Q,{label:"Opposing",children:i?e.jsx(ue,{style:{color:"CornflowerBlue"}}):e.jsx(Ae,{style:{color:"grey"}})}),e.jsx(Q,{label:"Value",children:o}),e.jsx(we,{title:"The percentage of conclusive attributes (not unclear)",children:e.jsxs(Q,{label:"Reliability",children:[l,"%"]})})]})]})}function Ls(){const{activeItem:s,attributesList:r,itemAttributeValues:t,onAttributeChange:n,jumpToItem:o,attributes:i}=U(),{searchParams:l,removeQueryParam:c}=F(),m=l.get("itemId"),b=l.get("filters");g.useEffect(()=>{m&&(c("itemId"),o("goTo",m))},[m,o,c]);const a=l.get("scope")==="unset",u=g.useMemo(()=>{const j=a?r.filter(f=>!t.attributes[f.id]):r;if(b){const f=b.split(",").reduce((p,h)=>(p[h]=!0,p),{});return j.filter(p=>f[p.id])}return j},[a,s.id,b]);return s?e.jsx(Z,{children:e.jsxs("div",{className:"item-attribution-card",children:[e.jsx(xt,{offsetTop:120,className:"item-attribution-card__item",children:e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:s,width:150}),e.jsx(X,{item:s}),e.jsx(_,{item:s,language:"en"}),e.jsx(_,{item:s,language:"pt"}),e.jsx(q,{className:"my-2"}),e.jsx(Os,{attributesList:r,itemAttributeValues:t}),e.jsx(q,{className:"my-2"}),e.jsx(D.Text,{type:"secondary",children:e.jsx(Ns,{itemAttributeValues:t,attributes:i})})]})}),e.jsx(G,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(j=>e.jsx(oe,{attribute:j,value:t.attributes[j.id],onChange:n},j.id))})]},`${s.id}`)}):e.jsx(Z,{children:e.jsxs(D.Text,{type:"secondary",children:["No item selected."," ",e.jsx(N,{size:"small",type:"primary",onClick:()=>o("random"),children:"Random Item"})]})})}function Ds(){const{jumpToItem:s}=U();return e.jsxs(G.Compact,{children:[e.jsx(N,{onClick:()=>s("first"),icon:e.jsx(gs,{}),children:"First"}),e.jsx(N,{onClick:()=>s("previous10"),icon:e.jsx(Qt,{}),children:"Previous 10"}),e.jsx(N,{onClick:()=>s("previous"),icon:e.jsx(Xt,{}),children:"Previous"}),e.jsxs(N,{onClick:()=>s("next"),children:["Next ",e.jsx(as,{})]}),e.jsxs(N,{onClick:()=>s("next10"),children:["Next 10 ",e.jsx(Kt,{})]}),e.jsxs(N,{onClick:()=>s("last"),children:["Last ",e.jsx(ms,{})]}),e.jsx(fe,{content:e.jsx(Us,{}),title:"Go to item",children:e.jsx(N,{children:"Go To"})}),e.jsx(N,{onClick:()=>s("incomplete"),children:"Next Incomplete"})]})}function Us(){const{jumpToItem:s}=U();return e.jsx(bt,{isPending:!1,onFinish:r=>s("goTo",r)})}function Vs(){const{addParam:s,queryParams:r}=be(),{attributesList:t}=U(),n=g.useMemo(()=>t.map(c=>({label:c.name.en,value:c.id})),[t]),o=c=>{s("filters",c.join(","))},i=r.get("filters"),l=e.jsx(te,{mode:"multiple",style:{width:300},options:n,value:i==null?void 0:i.split(","),onChange:c=>o(c),allowClear:!0});return e.jsx(fe,{content:l,title:"Filter Attributes",children:e.jsx(N,{children:i?e.jsx(Yt,{style:{color:"gold"}}):e.jsx(Zt,{})})})}function Fs(){const{addParam:s,queryParams:r}=be(),t=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],n=r.get("sortBy"),o=e.jsx(te,{style:{width:120},options:t,value:n,onChange:i=>s("sortBy",i),allowClear:!0});return e.jsx(fe,{content:o,title:"Sort By",children:e.jsx(N,{children:"Sort"})})}function Ms(){const{attributes:s,getItemAttributeValues:r,availableItemIds:t,getItem:n,isLoading:o}=U(),{searchParams:i}=F(),l=i.get("showComplete")==="true",c=i.get("showUnclear")==="true",m=i.get("showUnrelated")==="true",{itemMessages:b,itemMessagesDict:a,grouping:u}=g.useMemo(()=>{if(o)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const j=x.orderBy(t.map(h=>{const T=r(h),A=Ve(T,s);return{item:n(h),itemAttributesValues:T,message:Me(A,c,m),fullMessage:A}}).filter(({itemAttributesValues:h})=>l?h.complete:!0),["message"],["asc"]),f=j.reduce((h,{message:T,item:{id:A}})=>{const C=T.join(" ");return h[C]===void 0&&(h[C]=[]),h[C].push(A),h},{}),p=Object.values(f).filter(h=>h.length>1);return p.length>0&&console.log("More than one",p),{itemMessages:j,itemMessagesDict:x.keyBy(j,"item.id"),grouping:f}},[s,t,r,n,o,l,c,m]);return{itemMessages:b,itemMessagesDict:a,grouping:u}}function je(){const{searchParams:s,removeQueryParam:r}=F(),t=s.get("drawer"),[n,o]=g.useState(!1),{activeItem:i,attributesList:l,itemAttributeValues:c,onAttributeChange:m,jumpToItem:b}=U(),a=()=>{r("drawer")};g.useEffect(()=>{t&&b("goTo",t)},[t,b,r]);const u=g.useMemo(()=>n?l.filter(j=>!c.attributes[j.id]):l,[n,i.id]);return e.jsxs(Tt,{open:!!t,title:`Edit: ${i.name.en}`,onClose:a,width:"640px",children:[e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:i,width:50}),e.jsx(X,{item:i})]}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(_,{item:i,language:"en"}),e.jsx(_,{item:i,language:"pt"})]}),e.jsx(S,{vertical:!0,gap:6,children:e.jsx(Ct,{checked:n,onChange:o,checkedChildren:"Unset",unCheckedChildren:"All"})})]}),e.jsx(q,{className:"my-1"}),e.jsx(G,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(j=>e.jsx(oe,{size:"small",attribute:j,value:c.attributes[j.id],onChange:m},j.id))})]})}function ks(){const{attributes:s}=U(),{itemMessages:r,grouping:t}=Ms(),{addQueryParam:n}=F(),o=[{title:"Item Id",dataIndex:"item",key:"id",render:i=>e.jsxs("div",{children:[e.jsx(X,{item:i}),e.jsxs(N.Group,{children:[e.jsx(le,{item:i}),e.jsx(N,{size:"small",shape:"round",onClick:()=>n("drawer",i.id),children:"Drawer"})]})]}),sorter:(i,l)=>Number(i.item.id)-Number(l.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:i=>e.jsx(W,{item:i,width:75})},{title:"Name",dataIndex:"item",key:"name",render:i=>e.jsxs(e.Fragment,{children:[e.jsx(_,{item:i,language:"en"}),e.jsx(_,{item:i,language:"pt"})]}),sorter:(i,l)=>i.item.name.en.localeCompare(l.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(i,{item:l})=>e.jsx(S,{gap:6,children:i.map((c,m,b)=>e.jsx(Ge,{keyVariant:c,attributes:s,firstElement:m===0,lastElement:m===b.length-1,withText:!0},`${c}-${l.id}`))}),sorter:(i,l)=>i.message.join(" ").localeCompare(l.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:i=>i.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:i=>{const l=t[i.join(" ")]??[];return e.jsx(e.Fragment,{children:l.length>1?l.length:"0"})},sorter:(i,l)=>{const c=t[i.message.join(" ")]??[];return(t[l.message.join(" ")]??[]).length-c.length}}];return e.jsxs("div",{className:"my-4",children:[e.jsx(D.Title,{level:5,children:"Item Comparator"}),e.jsx(Le,{dataSource:r,columns:o,pagination:{showQuickJumper:!0}}),e.jsx(je,{})]})}function zs(){const{attributesList:s,addAttributesToUpdate:r,getItemAttributeValues:t,availableItemIds:n,addMultipleAttributesToUpdate:o}=U(),{searchParams:i,addQueryParam:l}=F(),c=i.get("attribute")??"ali",m=i.get("scope")??"unset",b=i.get("page")??"1",a=i.get("pageSize")??"12",[u,j]=g.useState("ali"),[f,p]=g.useState("unset"),[h,T]=g.useState(null),[A,C]=g.useState("desc"),I=g.useMemo(()=>{const R=n.map(O=>t(O)),L=m==="unset"?void 0:w[m.toUpperCase()],v=R.filter(O=>{var $;return(($=O.attributes)==null?void 0:$[c])===L}).map(O=>O.id),[E,P]=(h??"::").split("::");return x.orderBy(v,[O=>{var $,J;return E==="attribute"?(J=($=t(O))==null?void 0:$.attributes)==null?void 0:J[P]:!0},O=>E==="prop"?Number(O):!0,O=>{var $;return($=t(O))==null?void 0:$.updatedAt},O=>Number(O)],[A,"asc","desc","asc"])},[c,m,h,A]),y=g.useMemo(()=>{if(u!==c||f!==m)return j(c),p(m),l("page","1"),I.slice(0,Number(a));const R=(Number(b)-1)*Number(a),L=R+Number(a);return I.slice(R,L)},[b,a,I]),d=s.find(R=>R.id===c),V=(R,L,v)=>{const E=t(R);r(R,{...E,attributes:{...E.attributes,[L]:v}})},B=()=>{o(y.map(R=>{const L=t(R);return L.attributes[c]||(L.attributes[c]=w.UNRELATED),L}))};return{group:I,stats:{total:n.length,group:I.length,percent:Math.round(I.length/n.length*100)},pageIds:y,attribute:d,updateAttributeValue:V,updatePageItemsAsUnrelated:B,sorting:{sortBy:h,setSortBy:T,sortOrder:A,setSortOrder:C},pagination:{total:I.length,current:Number(b),pageSize:Number(a),onChange:R=>l("page",String(R)),onShowSizeChange:(R,L)=>l("pageSize",String(L)),pageSizeOptions:[12,24,48,96]}}}const Bs=(s,r)=>r==="unset"||!r?`${100-s.percent}% done, ${s.group} left`:`${s.percent}%  - ${s.group} items`;function $s(){const{getItem:s,getItemAttributeValues:r,attributesList:t}=U(),{attribute:n,pageIds:o,updateAttributeValue:i,updatePageItemsAsUnrelated:l,pagination:c,stats:m,sorting:b}=zs(),{searchParams:a,addQueryParam:u}=F(),j=kt("(max-width: 1024px)");if(x.isEmpty(n))return e.jsx(Z,{className:"my-4",children:e.jsx(D.Text,{type:"secondary",children:"No group attribute has been selected."})});const f=e.jsx(vt,{onChange:c.onChange,current:c.current,total:c.total,pageSizeOptions:c.pageSizeOptions,pageSize:c.pageSize,onShowSizeChange:c.onShowSizeChange},"pagination"),p=e.jsxs(S,{align:"center",children:[e.jsx(D.Text,{className:"mr-2",children:"Sort by"}),e.jsxs(te,{style:{width:120},value:b.sortBy,onChange:A=>b.setSortBy(A),children:[e.jsx(te.Option,{value:null,children:"Last Updated"}),e.jsx(te.Option,{value:"prop::id",children:"Id"}),t.map(A=>e.jsx(te.Option,{value:`attribute::${A.id}`,children:A.name.en},A.id))]})]}),T=(a.get("scope")==="unset"||!a.get("scope"))&&e.jsx(Et,{title:`Are you sure everything is unrelated to ${n.name.en}?`,onConfirm:l,children:e.jsx(N,{type:"primary",danger:!0,disabled:o.length===0,children:"Unrelate Unset Items on Page"})},"unrelate-button");return e.jsxs(Z,{className:"my-4",title:e.jsxs(D.Text,{children:[n==null?void 0:n.name.en," (",Bs(m,a.get("scope")),") -"," ",n.description.en]}),extra:e.jsxs(S,{align:"center",children:[p,f]}),actions:[T,e.jsx($e,{},"go-to-top"),f].filter(Boolean),children:[o.length===0&&e.jsx(ae,{description:"No items found in this scope for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),o.map(A=>{const C=r(A),I=s(A);return e.jsx(Z.Grid,{style:{width:j?"50%":"25%"},children:e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:I,width:75}),e.jsx(X,{item:I}),e.jsxs(N.Group,{children:[e.jsx(le,{item:I}),e.jsx(N,{size:"small",shape:"round",onClick:()=>u("drawer",I.id),children:"Drawer"})]}),e.jsx(_,{item:I,language:"en"}),e.jsx(_,{item:I,language:"pt"})]}),e.jsx(oe,{attribute:n,value:C.attributes[n.id],onlyButtons:!0,onChange:(y,d)=>i(I.id,y,d)})]})},`${A}-${C.updatedAt}`)}),e.jsx(je,{})]})}function Qe(){const{attributesList:s,availableItemIds:r,addAttributesToUpdate:t,getItemAttributeValues:n}=U(),{searchParams:o}=F(),[i,l]=g.useState([]),[c,m]=g.useState(),b=()=>{var C;const f=o.get("attribute")??((C=x.sample(s))==null?void 0:C.id)??"ali",p=s.find(I=>I.id===f)??x.sample(s),h=Number(o.get("size"))||9,T=[],A=x.shuffle(r);for(let I=0;I<A.length&&T.length!==h;I++){const y=A[I];n(y).attributes[f]||T.push(y)}return{selectedAttribute:p,selected:T}},a=()=>{let f=b(),p=0;for(;f.selected.length===0&&p<30;)f=b(),p++;m(f.selectedAttribute),l(f.selected)},u=g.useMemo(()=>c?r.filter(f=>!n(f).attributes[c==null?void 0:c.id]).length:0,[c,r]);return{sampleIds:i,attribute:c,itemsLeftForAttribute:u,onGetSample:a,updateAttributeValue:(f,p,h)=>{const T=n(f);t(f,{...T,attributes:{...T.attributes,[p]:h}})}}}function _s(){const{getItem:s,getItemAttributeValues:r}=U(),{sampleIds:t,attribute:n,onGetSample:o,updateAttributeValue:i,itemsLeftForAttribute:l}=Qe(),{addQueryParam:c}=F();if(x.isEmpty(t)&&x.isEmpty(n))return e.jsxs(Z,{className:"my-4",children:[e.jsxs(D.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",e.jsx(N,{size:"small",type:"primary",onClick:o,children:"Get Sample"})]}),e.jsx(q,{}),e.jsx(Ee,{})]});const m=t.map(u=>({itemAttributes:r(u),item:s(u)})),b=m.filter(({itemAttributes:u})=>(n==null?void 0:n.id)&&!u.attributes[n.id]),a=()=>{b.forEach(({item:u})=>{n!=null&&n.id&&i(u.id,n.id,-3)})};return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),e.jsxs(Z,{className:"my-4",title:e.jsxs(D.Text,{children:[n==null?void 0:n.name.en," - ",n==null?void 0:n.description.en," (",l," items left)"]}),actions:[e.jsx(N,{onClick:a,danger:!0,disabled:b.length===0,children:"Mark rest as unrelated"},"1"),e.jsx(N,{type:"primary",ghost:!0,onClick:o,children:"Get New Sample"},"2")],extra:e.jsx(N,{type:"primary",size:"small",onClick:o,children:"Get New Sample"}),children:[e.jsxs(S,{vertical:!0,gap:6,children:[m.length===0&&e.jsx(ae,{description:"No unset items found for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),m.map(({item:u,itemAttributes:j})=>e.jsxs(g.Fragment,{children:[e.jsxs(S,{gap:6,children:[e.jsx(W,{item:u,width:75}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:u}),e.jsxs(N.Group,{children:[e.jsx(le,{item:u}),e.jsx(N,{size:"small",shape:"round",onClick:()=>c("drawer",u.id),children:"Drawer"})]})]}),e.jsx(_,{item:u,language:"en"}),e.jsx(_,{item:u,language:"pt"})]}),!!n&&e.jsx(oe,{attribute:n,value:j.attributes[n.id],onChange:(f,p)=>i(u.id,f,p)})]}),e.jsx(q,{className:"my-1"})]},`${u.id}-${j.updatedAt}`))]}),e.jsx(je,{})]})]})}function Ee(){const[s,r]=ft(!1),{addQueryParam:t,removeQueryParam:n}=F(),{sampleIds:o,attribute:i,onGetSample:l,updateAttributeValue:c}=Qe(),{getItem:m,getItemAttributeValues:b}=U(),a=()=>{t("size","1"),r(!0),l()},u=()=>{n("size"),r(!1)},j=o[0],f=m(j),p=b(j);return e.jsxs(S,{className:"mt-4",children:[e.jsx(N,{type:"primary",onClick:a,children:"Single Sampler"}),e.jsxs(St,{title:e.jsxs(D,{children:["Single Sampler: ",e.jsx("strong",{children:i==null?void 0:i.name.en})]}),open:s,width:"100vw",maskClosable:!1,onOk:u,onClose:u,onCancel:u,cancelButtonProps:{style:{display:"none"}},children:[j&&f&&p&&i&&e.jsxs(S,{gap:6,className:"my-10",wrap:"wrap",children:[e.jsx(W,{item:f,width:150}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:f}),e.jsx(le,{item:f})]}),e.jsx(_,{item:f,language:"en"}),e.jsx(_,{item:f,language:"pt"})]}),!!i&&e.jsx(oe,{size:"large",attribute:i,value:p.attributes[i.id],onChange:async(h,T)=>{c(f.id,h,T),await ct(500),l()}})]},j),e.jsx(N,{onClick:l,children:"Another Sample"})]})]})}function Gs(){const s=ie("items-attributes"),r=ie("items-attribute-values"),[t,n]=g.useState(null),o=()=>{n(Se(s.data,r.data))},i=()=>{const l={};let c=0;for(;c<300||x.keys(l).length===15;){const m=Se(s.data,r.data);if(m.valid&&!l[m.setId]&&(l[m.setId]=m),x.keys(l).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(l).map((m,b)=>({...m,number:m.number-b})))};return e.jsxs("div",{className:"my-4",children:[e.jsx(D.Title,{level:3,children:"Daily Simulator"}),e.jsx(D.Paragraph,{children:"Generates a daily game for Alien Communication"}),e.jsxs(G,{children:[e.jsx(N,{type:"primary",onClick:o,children:"Generate"}),e.jsx(N,{onClick:i,children:"Generate List"})]}),e.jsx("div",{children:!!t&&e.jsxs(G,{direction:"vertical",children:[e.jsx(D.Title,{level:5,children:t==null?void 0:t.setId}),!(t!=null&&t.valid)&&e.jsx(Xe,{type:"error",message:"Invalid game"}),e.jsx(G,{direction:"vertical",children:t==null?void 0:t.attributes.map(l=>e.jsxs(S,{gap:8,children:[e.jsx(Y,{id:l.spriteId,width:50}),l.itemsIds.map(c=>e.jsx(ye,{id:c||"0",width:50},c))]},l.id))}),e.jsx(q,{className:"my-1"}),e.jsx(G,{direction:"horizontal",children:t==null?void 0:t.requests.map(l=>e.jsxs(S,{vertical:!0,children:[e.jsx(Y,{id:l.spritesIds[2],width:50}),e.jsx(Y,{id:l.spritesIds[1],width:50}),e.jsx(Y,{id:l.spritesIds[0],width:50})]},l.itemId))}),e.jsx(q,{className:"my-1"}),e.jsx(G,{direction:"horizontal",children:t==null?void 0:t.itemsIds.map(l=>e.jsx(ye,{id:l||"0",width:50},l))})]},t==null?void 0:t.setId)})]})}const Se=(s,r)=>{const t=x.values(s).filter(d=>!d.limited||d.id==="sol"),n=x.shuffle(x.values(r).filter(d=>d.complete)),o=x.shuffle(ut(38,0)),i=x.sampleSize(t,3).map(d=>({...d,spriteId:`${o.pop()}`})),l=[],c=[],m=[],b=[],a=[],u=[],j=[],f=[];n.forEach(d=>{const V=[w.DETERMINISTIC,w.RELATED],B=d.attributes[i[0].id]===w.DETERMINISTIC,R=V.includes(d.attributes[i[0].id]),L=d.attributes[i[0].id]===w.UNRELATED,v=d.attributes[i[1].id]===w.DETERMINISTIC,E=V.includes(d.attributes[i[1].id]),P=d.attributes[i[1].id]===w.UNRELATED,O=d.attributes[i[2].id]===w.DETERMINISTIC,$=V.includes(d.attributes[i[2].id]),J=d.attributes[i[2].id]===w.UNRELATED;if(L&&P&&J)return f.push(d.id);B&&P&&J&&l.push(d.id),L&&v&&J&&c.push(d.id),L&&P&&O&&m.push(d.id),R&&E&&J&&b.push(d.id),R&&P&&$&&a.push(d.id),L&&E&&$&&u.push(d.id),R&&E&&$&&j.push(d.id)});const p=i.map(d=>({id:d.id,name:d.name.pt,description:d.description.pt,spriteId:d.spriteId,itemsIds:[]}));p[0].itemsIds=x.sampleSize(l,l.length>3?3:Math.max(l.length-1,1)),p[1].itemsIds=x.sampleSize(c,c.length>3?3:Math.max(l.length-1,1)),p[2].itemsIds=x.sampleSize(m,m.length>3?3:Math.max(l.length-1,1));const h=[];p.forEach(d=>{h.push(...d.itemsIds)});const T=[];b.length>0&&T.push({spritesIds:[i[0].spriteId,i[1].spriteId],itemId:x.sample(b)??""}),a.length>0&&T.push({spritesIds:[i[0].spriteId,i[2].spriteId],itemId:x.sample(a)??""}),u.length>0&&T.push({spritesIds:[i[1].spriteId,i[2].spriteId],itemId:x.sample(u)??""}),j.length>0&&T.push({spritesIds:i.map(d=>d.spriteId),itemId:x.sample(j)??""});const A=[];l.length>0&&A.push({spritesIds:[i[0].spriteId],itemId:l.filter(d=>!h.includes(d))[0]}),c.length>0&&A.push({spritesIds:[i[1].spriteId],itemId:c.filter(d=>!h.includes(d))[0]}),m.length>0&&A.push({spritesIds:[i[2].spriteId],itemId:m.filter(d=>!h.includes(d))[0]}),console.log({attributeA:l,attributeB:c,attributeC:m,attributeAB:b,attributeAC:a,attributeBC:u,attributeABC:j}),console.log("COMPLEX REQUEST SIZE",T.length),console.log("SIMPLE REQUEST SIZE",A.length);let C=x.sampleSize(T,4);console.log("REQUEST SIZE",C.length),C.length<3&&C.push(...x.sampleSize(A,4-C.length)),C.length<4&&console.warn("Not enough requests"),C=x.shuffle(C);const I=C.map(d=>d.itemId),y={id:"2024-00-00",setId:p.map(d=>d.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:p,requests:C,solution:I.join("-"),itemsIds:x.shuffle([...I,f[0],f[1],f[2],f[3]]).filter(Boolean),valid:!1};return y.valid=[y.attributes.length===3,y.requests.length===4,y.itemsIds.length>5,y.attributes.every(d=>d.itemsIds.length>0),y.requests.every(d=>d.itemId)].every(Boolean),console.log(y),y},Qs=["","I","II","III","IV","V"];function qs(){const{attributes:s,availableItemIds:r,getItemAttributeValues:t,getItem:n}=U(),{message:o}=he.useApp(),[i,l]=g.useState(25),[c,m]=g.useState(80),[b,a]=g.useState(!1),[u,j]=g.useState([]),[f,p]=g.useState([]),[h,T]=g.useState(null),[A,C]=g.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),I=()=>{const d={},V=x.shuffle(r);for(;Object.values(d).length<i;){const v=V.pop();if(!v)break;const E=t(v);E&&(!E.complete||!E.reliability||E.reliability<c||!b&&n(v).nsfw||(E.signature&&!d[E.signature]?d[E.signature]=v:console.log("Item has identical key to another item. Skipping.",n(v).name.en)))}const B=Object.values(d);B.length<i&&o.error(`Could not generate sample. Got only ${B.length} items`),j(x.sortBy(B,v=>Number(v)));const R=Ks(B.map(v=>t(v)),25,s);if(R.length<25){const v=x.keys(s).filter(O=>!R.includes(O)),P=x.sortBy(v,O=>s[O].priority).slice(0,25-R.length);console.log("Adding more attributes by priority",P),R.push(...P)}const L=R.reduce((v,E)=>(B.forEach(P=>{const O=t(P);if(O)switch(O.attributes[E]){case w.RELATED:v.relatedCount[E]=(v.relatedCount[E]||0)+1;break;case w.DETERMINISTIC:v.deterministicCount[E]=(v.deterministicCount[E]||0)+1;break;case w.UNCLEAR:v.unclearCount[E]=(v.unclearCount[E]||0)+1;break;case w.OPPOSITE:v.oppositeCount[E]=(v.oppositeCount[E]||0)+1;break}}),v),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});p(R.sort().map(v=>({...s[v],relatedCount:L.relatedCount[v],deterministicCount:L.deterministicCount[v],unclearCount:L.unclearCount[v],oppositeCount:L.oppositeCount[v]})))},y=d=>{C(V=>({...V,[d]:!V[d]}))};return e.jsxs("div",{className:"my-4",children:[e.jsx(D.Title,{level:3,children:"Simulator"}),e.jsx(D.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(se,{label:"Grid Size",value:i,onChange:d=>l(d),options:[16,25]}),e.jsx(Pe,{label:"Reliability Threshold",value:c,onChange:d=>m(d),step:5,min:10,max:100}),e.jsx(K,{label:"NSFW",value:b,onChange:a}),e.jsx(N,{onClick:I,type:"primary",children:"Get Sample Board"})]}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(ce,{label:"Show Id",value:!!A.id,onChange:()=>y("id")}),e.jsx(ce,{label:"Show Name (EN)",value:!!A.nameEn,onChange:()=>y("nameEn")}),e.jsx(ce,{label:"Show Name (PT)",value:!!A.namePt,onChange:()=>y("namePt")}),e.jsx(ce,{label:"Show Reliability",value:!!A.reliability,onChange:()=>y("reliability")})]}),e.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(i)}, 1fr)`},children:u.map(d=>{const V=n(d),B=t(d);return e.jsxs(G,{direction:"vertical",className:de("simulator-grid__entry",h&&B.attributes[h]>0&&"simulator-grid__entry--highlighted"),align:"center",children:[e.jsxs(G,{children:[e.jsxs(S,{vertical:!0,children:[A.id&&e.jsx(X,{item:V}),A.reliability&&e.jsx("span",{children:e.jsx(rt,{prefix:e.jsx(ts,{}),placeholder:"Reliability",variant:"borderless",size:"small",value:B.reliability,readOnly:!0,style:{width:"8ch"},formatter:R=>`${R}%`})}),A.id&&e.jsx(le,{item:V})]}),e.jsx(W,{item:V,width:50})]}),A.nameEn&&e.jsx(_,{item:V,language:"en"}),A.namePt&&e.jsx(_,{item:V,language:"pt"})]},d)})}),e.jsx("div",{className:"simulator-grid my-4",children:f.map(d=>e.jsxs(wt,{className:de("simulator-grid__entry","simulator-grid__button",h===d.id&&"simulator-grid__entry--highlighted"),onClick:()=>T(d.id),children:[d.name.en," ",Qs[d.level],e.jsxs(S,{gap:6,justify:"center",className:"my-1",children:[e.jsxs("span",{children:[e.jsx(Bt,{style:{color:d.deterministicCount?"dodgerblue":void 0}})," ",d.deterministicCount??0]}),e.jsxs("span",{children:[e.jsx(rs,{style:{color:d.relatedCount?"green":void 0}})," ",d.relatedCount??0]}),e.jsxs("span",{children:[e.jsx(_t,{style:{color:d.oppositeCount?"red":void 0}})," ",d.oppositeCount??0]}),e.jsxs("span",{children:[e.jsx(De,{style:{color:d.unclearCount?"gold":void 0}})," ",d.unclearCount??0]})]})]},d.id))}),e.jsx(Gs,{})]})}function Ks(s,r,t){const n={},o={};s.forEach(p=>{p&&Object.keys(p.attributes).forEach(h=>{p.attributes[h]>0&&(n[h]=(n[h]||0)+1),p.attributes[h]===w.DETERMINISTIC&&(o[h]=!0,n[h]=(n[h]||0)+2),p.attributes[h]===w.OPPOSITE&&(n[h]=(n[h]||0)+1)})});const i={1:0,2:0,3:0,4:0};function l(p){return p.filter(h=>(i[t[h].level]++,i[4]>1?(console.log("Discarding level 4 attribute",h),!1):!0))}const c=l(Object.keys(o)),m=l(x.keys(n).filter(p=>!c.includes(p)));if(console.log({levelCount:i}),r===c.length)return console.log("All keys are deterministic"),c;if(console.log(n),c.length===0)return[];const b=c.reduce((p,h)=>{const T=n[h];return p[T]||(p[T]=[]),p[T].push(h),p},{}),a=x.keys(b).sort((p,h)=>Number(h)-Number(p));console.log({sortedDeterministicTiedGroupsKeys:a});const u=m.reduce((p,h)=>{const T=n[h];return p[T]||(p[T]=[]),p[T].push(h),p},{});console.log(u);const j=x.keys(u).sort((p,h)=>Number(h)-Number(p)),f=[];for(const p of a){if(f.length===r)break;f.push(...x.sampleSize(b[p],r-f.length))}for(const p of j){if(f.length===r)break;f.push(...x.sampleSize(u[p],r-f.length))}return f}function Hs(){const{attributes:s}=U(),r=[{key:"1",label:"All Attributes",children:e.jsx(ee,{type:"all"})},{key:"2",label:"Default",children:e.jsx(ee,{type:"default"})},{key:"3",label:"Custom",children:e.jsx(ee,{type:"custom"})},{key:"4",label:"Limited",children:e.jsx(ee,{type:"limited"})},{key:"5",label:"Specific",children:e.jsx(ee,{type:"specific"})},{key:"6",label:"Opposite",children:e.jsx(ee,{type:"opposite"})}];return e.jsxs("div",{className:"my-4",children:[e.jsxs(S,{justify:"space-between",align:"center",children:[e.jsx(D.Title,{level:5,children:"Stats"}),e.jsx(Ne,{data:()=>Js(s),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),e.jsx(Pt,{defaultActiveKey:"1",items:r})]})}const Ys=(s,r)=>{let t=0,n=0,o=0,i=0,l=0,c=0,m=0,b=0;r.forEach(({attributes:I})=>{if(I[s.id]){t++;const y=I[s.id];y===10?n++:y===5?o++:y===0||!y?i++:y===-1?l++:y===-3?c++:y===-10&&m++,y>0&&b++}});const a=r.length,u=t/a*100,j=n/a*100,f=o/a*100,p=i/a*100,h=l/a*100,T=c/a*100,A=m/a*100,C=b/a*100;return{completionPercentage:u.toFixed(1),tensPercentage:j.toFixed(1),fivesPercentage:f.toFixed(1),zerosPercentage:p.toFixed(1),negativeOnesPercentage:h.toFixed(1),negativeThreesPercentage:T.toFixed(1),negativeTensPercentage:A.toFixed(1),positivePercentage:C.toFixed(1)}};function ee({type:s}){const{availableItemIds:r,getItemAttributeValues:t,attributesList:n}=U(),o=et(),{is:i}=be(),l=g.useMemo(()=>{const a=new Array(65).fill(0).map((j,f)=>f),u=n.map(j=>j.spriteId);return a.filter(j=>!u.includes(`sign-${j}`))},[n]),c=g.useMemo(()=>s==="default"?n.filter(a=>a.default):s==="custom"?n.filter(a=>!a.default):s==="limited"?n.filter(a=>a.limited):s==="specific"?n.filter(a=>a.specific):s==="opposite"?n.filter(a=>a.oppositeId):n,[n,s]),m=g.useMemo(()=>{const a=r.map(u=>t(u));return c.map(u=>({...u,...Ys(u,a)}))},[c,r,t]),b=[{title:"Attribute",dataIndex:"name",key:"name",render:(a,u)=>e.jsxs(S,{align:"center",gap:8,children:[i("showGlyphs")&&e.jsx(Y,{id:u.spriteId,width:30}),a.en,u.default&&e.jsx(ne,{className:"ml-1",children:"default"}),u.limited&&e.jsx(ne,{className:"ml-1",children:"limited"}),(u.specific||u.parentId)&&e.jsx(ne,{className:"ml-1",children:"specific"}),u.oppositeId&&e.jsx(ne,{className:"ml-1",children:e.jsx(os,{})}),e.jsx(_e,{title:u.description.en})]}),sorter:(a,u)=>a.name.en.localeCompare(u.name.en)},{title:e.jsx(Nt,{}),dataIndex:"spriteId",key:"spriteId",render:a=>e.jsx(Y,{id:a,width:18,padding:0})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(a,u)=>a.priority-u.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.positivePercentage)-Number.parseFloat(u.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(a,u)=>u.limited?"-":`${a}%`,sorter:(a,u)=>Number.parseFloat(a.tensPercentage)-Number.parseFloat(u.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.fivesPercentage)-Number.parseFloat(u.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeOnesPercentage)-Number.parseFloat(u.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeThreesPercentage)-Number.parseFloat(u.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeTensPercentage)-Number.parseFloat(u.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:a=>e.jsx(Oe,{percent:Number.parseFloat(a),size:"small"}),sorter:(a,u)=>Number.parseFloat(a.completionPercentage)-Number.parseFloat(u.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:a=>e.jsx(Rt,{count:4,value:a,disabled:!0}),sorter:(a,u)=>a.level-u.level},{title:"Actions",key:"actions",render:a=>e.jsx(G,{children:e.jsxs(N.Group,{children:[e.jsx(N,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=grouping&attribute=${a.id}&page=1`),children:"Grouping"}),e.jsx(N,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=sampler&attribute=${a.id}&size=6`),children:"Sample"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(D.Paragraph,{children:["Total: ",m.length]}),e.jsx(Le,{columns:b,dataSource:m,pagination:!1,rowKey:"id",size:"small"}),e.jsx(S,{wrap:"wrap",gap:8,children:l.map(a=>e.jsxs("div",{children:["#",a,e.jsx(Y,{id:`sign-${a}`},a)]},a))})]})}function Js(s){const r=x.cloneDeep(s);return xe(Re(r),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Zs(){const{view:s}=F();return s==="classifier"?e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"my-4",gap:8,children:[e.jsx(Ds,{}),e.jsx(Vs,{}),e.jsx(Fs,{})]}),e.jsx(Ls,{}),e.jsx(S,{justify:"flex-end",className:"my-4",children:e.jsx($e,{})})]}):s==="sampler"?e.jsx(_s,{}):s==="grouping"?e.jsx($s,{}):s==="comparator"?e.jsx(ks,{}):s==="simulator"?e.jsx(qs,{}):s==="stats"?e.jsx(Hs,{}):e.jsx(ae,{className:"my-10",description:"Unknown view has been selected"})}function Ws(){const{isLoading:s,error:r,hasResponseData:t}=U();return e.jsx(tt,{title:"Items",subtitle:"Attribution",children:e.jsxs(Ie,{hasSider:!0,children:[e.jsx(ht,{children:e.jsx(ws,{})}),e.jsx(Ie.Content,{className:"content",children:e.jsx(st,{isLoading:s,error:r,hasResponseData:t,children:e.jsx(Zs,{})})})]})})}function tn(){return e.jsx(vs,{children:e.jsx(Ws,{})})}export{tn as default};
