import{j as e,D as S,r as I,T as g,B as b,P as F,L as v}from"./index-BcpMPOAg.js";import{D as R}from"./DataLoadingWrapper-Cb888-Fx.js";import{c as T}from"./FilterEntries-CknB04Jo.js";import{S as L}from"./SiderContent-JvxUDyEO.js";import{D as O}from"./DownloadButton-CuwcBA80.js";import{S as k}from"./SaveButton-DgrAWeEW.js";import{u as C}from"./useQueryParams-Dy4QSqde.js";import{a as B,r as w}from"./index-C0rILB8_.js";import{F as f}from"./index-CvollKDQ.js";import{u as D}from"./useCopyToClipboardFunction-BM64UHih.js";import{u as M}from"./useTDResource-D9INFiCY.js";import{l as c}from"./lodash-B_GpjCgW.js";import{I as A}from"./Item-DkDVx9Fs.js";import{u as E}from"./useTablePagination-CSP-YlsE.js";import{I as Q}from"./ItemsTypeahead-BdhbZXMx.js";import{u as Y}from"./useDailyHistoryQuery-DJB8eJ_j.js";import{u as G,L as $}from"./constants-Cap-L6e_.js";import{F as y}from"./Table-NDTOWd25.js";import{S as j}from"./index-Dgz3u-ss.js";import{P as H}from"./index-Bj4nJDgQ.js";import{R as J}from"./DeleteFilled-DKOndIJx.js";import{P as K}from"./useBaseUrl-VNOUWM6_.js";import{u as X}from"./useResourceFirebaseData-C0-K6THW.js";import"./index-CS0G3aBP.js";import"./index-152sXHsr.js";import"./index-CievdN-s.js";import"./index-BMo2W_I8.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-C8xYw-EB.js";import"./constants-CDABhm8f.js";import"./gapSize-U1swVQyS.js";import"./useDebounce-SpRY2kTB.js";import"./index-D26Mw3Et.js";import"./Input-DTnEziXo.js";import"./useGetFirebaseDoc-CRdbVXDQ.js";import"./index-DUuJIBpB.js";import"./index-BUdJ8DRP.js";import"./scrollTo-JemKOqnf.js";import"./Pagination-Br-dN2Q5.js";import"./extendsObject-keMuGWqj.js";import"./useUpdateFirebaseDoc-Byynv72i.js";import"./useMutation-VLxkg5Mr.js";function _({data:t,save:s,isDirty:i,isSaving:a,entriesToUpdate:o}){const{is:m,addParam:u}=C();return e.jsxs(L,{children:[e.jsxs(f,{vertical:!0,gap:12,children:[e.jsx(k,{isDirty:i,onSave:s,isSaving:a,dirt:JSON.stringify(o)}),e.jsx(O,{data:()=>z(t),fileName:"daily-movie-sets.json",disabled:i,block:!0})]}),e.jsx(S,{}),e.jsx(T,{label:"Pending Only",value:m("emptyOnly"),onChange:p=>u("emptyOnly",p,!1)})]})}function z(t){return B(t)}function W(){const t=$.DAILY.pt,s=Y(t,{enabled:!0}),[i]=G("filmaco",s.data);return I.useMemo(()=>c.mapValues(c.keyBy((i==null?void 0:i.used)??[]),()=>!0),[i])}function q(t){return c.orderBy(t,[s=>s.title]).map(s=>({...s,itemsIds:c.orderBy(s.itemsIds,i=>Number(i))}))}function Z({data:t,addEntryToUpdate:s}){const i=D(),a=M("items"),o=W(),{is:m}=C(),u=m("emptyOnly"),p=I.useMemo(()=>{const r=t?q(Object.values(t)):[];return u?r.filter(n=>n.itemsIds.length===0):r},[t,u]),l=p.filter(r=>r.itemsIds.length>0).length,d=E({total:p.length,showQuickJumper:!0}),x=[{title:"Title",dataIndex:"title",render:(r,n)=>e.jsx(h,{property:"title",value:r,movie:n,addEntryToUpdate:s}),sorter:(r,n)=>r.title.localeCompare(n.title)},{title:"Year",dataIndex:"year",render:(r,n)=>e.jsx(h,{property:"year",value:r,movie:n,addEntryToUpdate:s}),sorter:(r,n)=>r.year-n.year},y.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(r,n)=>e.jsx(P,{movie:n,itemsIds:r,copyToClipboard:i,addEntryToUpdate:s}),sorter:(r,n)=>r.itemsIds.length-n.itemsIds.length},{title:"Count",dataIndex:"itemsIds",render:r=>w(r).filter(Boolean).length},{title:"Used",dataIndex:"id",render:r=>o[r]?"Yes":"No",sorter:(r,n)=>o[r.id]&&!o[n.id]?-1:!o[r.id]&&o[n.id]?1:n.itemsIds.length-r.itemsIds.length}];return e.jsxs(j,{direction:"vertical",children:[e.jsxs(g.Title,{level:5,children:["Total Movies: ",p.length," | Complete Movies: ",l]}),e.jsx(y,{columns:x,rowKey:"id",dataSource:p,expandable:{expandedRowRender:r=>e.jsx(N,{movie:r,addEntryToUpdate:s}),rowExpandable:()=>a.isSuccess},pagination:d})]})}function N({movie:t,addEntryToUpdate:s}){const i=a=>{s(t.id,{...t,itemsIds:[...t.itemsIds,a]})};return e.jsx("div",{children:e.jsx(Q,{onFinish:i})})}function U({movie:t,addEntryToUpdate:s,itemId:i}){const a=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(o=>o!==i)})};return e.jsx(H,{title:"Are you sure you want to remove this item?",onConfirm:a,okText:"Yes",cancelText:"No",children:e.jsx(b,{icon:e.jsx(J,{}),size:"small",type:"text"})})}function P({movie:t,itemsIds:s,copyToClipboard:i,addEntryToUpdate:a}){return e.jsx(f,{gap:6,wrap:"wrap",children:s.map((o,m)=>e.jsxs(f,{gap:2,vertical:!0,children:[e.jsx(A,{id:o,width:60}),e.jsxs(f,{justify:"center",children:[e.jsx(g.Text,{onClick:()=>i(o),children:o}),e.jsx(U,{movie:t,addEntryToUpdate:a,itemId:o})]})]},`${t.title}-${o}-${m}`))},`items-${t.title}`)}function h({value:t,movie:s,addEntryToUpdate:i,property:a}){const o=m=>typeof t=="number"?m!==String(t)?i(s.id,{...s,[a]:Number(m)}):null:m!==t?i(s.id,{...s,[a]:m.trim()}):null;return e.jsx(j,{children:e.jsx(g.Text,{editable:{onChange:o},children:String(t)})})}function V({data:t,addEntryToUpdate:s}){const[i,a]=I.useState(null),o=M("items"),m=D(),u=()=>{var x;let l=c.sample(Object.keys(t??{})),d=0;for(;d<15&&(((x=t[String(l)])==null?void 0:x.itemsIds)??[]).length>0;)l=c.sample(Object.keys(t??{})),d++;if(d>=15)return console.warn("Could not find a sample with no itemsIds");a(l??null)},p=[{title:"Title",dataIndex:"title",render:(l,d)=>e.jsx(h,{property:"title",value:l,movie:d,addEntryToUpdate:s})},{title:"Year",dataIndex:"year",render:(l,d)=>e.jsx(h,{property:"year",value:l,movie:d,addEntryToUpdate:s})},y.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(l,d)=>e.jsx(P,{movie:d,itemsIds:l,copyToClipboard:m,addEntryToUpdate:s})},{title:"Count",dataIndex:"itemsIds",render:l=>w(l).filter(Boolean).length}];return e.jsxs(j,{direction:"vertical",className:"my-4",children:[e.jsx(b,{onClick:u,children:"Get Sample"}),i&&e.jsx(y,{columns:p,rowKey:"id",dataSource:[t[i]],expandable:{expandedRowRender:l=>e.jsx(N,{movie:l,addEntryToUpdate:s}),rowExpandable:()=>o.isSuccess},pagination:!1},String(i)),e.jsx(S,{})]})}function $e(){const t=X({tdrResourceName:"daily-movie-sets",firebaseDataCollectionName:"movieSets"});return e.jsx(F,{title:"Items",subtitle:"Movie Sets",children:e.jsxs(v,{hasSider:!0,children:[e.jsx(K,{children:e.jsx(_,{...t})}),e.jsx(v.Content,{className:"content",children:e.jsx(R,{isLoading:t.isLoading,error:t.error,hasResponseData:!c.isEmpty(t.data),children:e.jsxs(j,{direction:"vertical",children:[e.jsx(V,{...t}),e.jsx(Z,{...t})]})})})]})})}export{$e as ItemsMovieSets,$e as default};
