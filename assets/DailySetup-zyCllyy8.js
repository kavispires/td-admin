import{r as A,a as ge,_ as he,j as a,ak as v,T as B,ab as fe,B as W,aN as ne,aO as Ie,aP as xe,Q as je,O as Ae,U as X,W as ee,V as te,P as ye,L as se}from"./index-BcpMPOAg.js";import{R as De}from"./ResponseState-DwyI7LSp.js";import{u as Se}from"./useQueryParams-Dy4QSqde.js";import{C as Ne,u as re}from"./useArteRuimDrawings-D3l5PwlX.js";import{I as Ee}from"./ImageCard-D6JXHKUb.js";import{f as Oe,W as be,d as Q,g as z,h as Ce}from"./constants-CDABhm8f.js";import{I as P}from"./Item-DkDVx9Fs.js";import{l as m}from"./lodash-B_GpjCgW.js";import{F as C}from"./index-CvollKDQ.js";import{S as k}from"./index-Dgz3u-ss.js";import{T as Te}from"./index-CRyM46ac.js";import{u as Le}from"./useGetFirebaseDoc-CRdbVXDQ.js";import{h as ie}from"./moment-C5S46NFB.js";import{I as ve}from"./index-D26Mw3Et.js";import{F as ae}from"./Table-NDTOWd25.js";import{m as _e,r as q}from"./index-C0rILB8_.js";import{u as we}from"./daily-teoria-de-conjuntos-Bvy50xFl.js";import{u as Re}from"./useMutation-VLxkg5Mr.js";import{u as _,D as p,g as G,c as oe,L as le}from"./constants-Cap-L6e_.js";import{u as T}from"./useTDResource-D9INFiCY.js";import{u as ce}from"./useDailyHistoryQuery-DJB8eJ_j.js";import{R as Me}from"./SaveOutlined-C8xYw-EB.js";import{a as H}from"./FilterEntries-CknB04Jo.js";import{S as Ge}from"./SiderContent-JvxUDyEO.js";import{u as Z}from"./useLoadWordLibrary-CsvDrNUE.js";import{D as Qe}from"./DataLoadingWrapper-Cb888-Fx.js";import{P as ke}from"./useBaseUrl-VNOUWM6_.js";import"./index-CS0G3aBP.js";import"./gapSize-U1swVQyS.js";import"./Input-DTnEziXo.js";import"./index-CievdN-s.js";import"./index-152sXHsr.js";import"./index-DUuJIBpB.js";import"./index-BUdJ8DRP.js";import"./scrollTo-JemKOqnf.js";import"./Pagination-Br-dN2Q5.js";import"./extendsObject-keMuGWqj.js";import"./index-BMo2W_I8.js";var Ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M396 512a112 112 0 10224 0 112 112 0 10-224 0zm546.2-25.8C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM508 688c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z"}}]},name:"eye",theme:"filled"},qe=function(n,i){return A.createElement(ge,he({},n,{ref:i,icon:Ue}))},Pe=A.forwardRef(qe);function w({children:s}){return a.jsx(k,{direction:"vertical",style:{maxWidth:120},children:s})}function R({children:s}){return a.jsxs(Te,{color:"cyan",children:["#",s]})}function D({label:s,children:n}){return a.jsxs(B.Text,{children:[a.jsxs("strong",{children:[s,":"]})," ",n]})}function M({children:s}){return a.jsx(fe,{trigger:"click",content:s,title:"Sneak Peek",children:a.jsx(W,{icon:a.jsx(Pe,{})})})}const de=[{title:"Id",dataIndex:"id",key:"id",fixed:"left"},{title:"Arte Ruim",dataIndex:"arte-ruim",key:"arte-ruim",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,cardId:i,text:o,drawings:e}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"CardId",children:i}),a.jsx(D,{label:"Drawings",children:e.length}),a.jsx(M,{children:a.jsxs(C,{gap:6,vertical:!0,children:[a.jsxs("div",{children:['"',o.split("").map((t,l)=>l<2||t===" "?t:"â¹").join(""),'"']}),a.jsx(k,{wrap:!0,children:e.map(t=>a.jsx(Ne,{drawing:t,width:75,height:75,className:"canvas"},t))})]})})]})}},{title:"Aqui O",dataIndex:"aqui-o",key:"aqui-o",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,setId:i,title:o,itemsIds:e}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"SetId",children:i}),a.jsx(D,{label:"Title",children:o.pt}),a.jsx(D,{label:"Items",children:e.length}),a.jsx(M,{children:a.jsx(C,{gap:6,wrap:!0,style:{maxWidth:500},children:e.map(t=>a.jsx(P,{id:t,width:50},t))})})]})}},{title:"AlienÃ­gena",dataIndex:"comunicacao-alienigena",key:"comunicacao-alienigena",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,itemsIds:i,attributes:o}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"Items",children:i.length}),a.jsx(M,{children:a.jsxs(C,{gap:6,style:{maxWidth:"300px"},vertical:!0,children:[a.jsx(k,{wrap:!0,children:o.map(e=>a.jsx(Oe,{id:`sign-${e.spriteId}`,width:50},e.spriteId))}),a.jsx(k,{wrap:!0,children:i.map(e=>a.jsx(P,{id:e,width:50},e))})]})})]})}},{title:"Conjuntos",dataIndex:"teoria-de-conjuntos",key:"teoria-de-conjuntos",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,rule1:i,intersectingThing:o,rule2:e,title:t}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"Title",children:t}),a.jsx(M,{children:a.jsxs(C,{gap:6,children:[a.jsx(P,{id:i.thing.id,width:50}),a.jsx(P,{id:o.id,width:50}),a.jsx(P,{id:e.thing.id,width:50})]})})]})}},{title:"Estoque",dataIndex:"controle-de-estoque",key:"controle-de-estoque",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,title:i,goods:o}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"Title",children:i}),a.jsx(D,{label:"Goods",children:o.length}),a.jsx(M,{children:a.jsx(C,{gap:6,wrap:!0,style:{maxWidth:245},children:o.map(e=>a.jsx(be,{id:e,width:50},e))})})]})}},{title:"FilmaÃ§o",dataIndex:"filmaco",key:"filmaco",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,setId:i,title:o,year:e}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"SetId",children:i}),a.jsx(M,{children:a.jsxs(C,{gap:6,vertical:!0,children:[a.jsxs("span",{children:["Year: ",e]}),a.jsxs("span",{children:["Title:"," ",o.split("").map((t,l)=>l<1||t===" "?t:"â¹").join("")]})]})})]})}},{title:"Palavreado",dataIndex:"palavreado",key:"palavreado",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,letters:i,keyword:o,words:e}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"Letters",children:i.length}),a.jsx(D,{label:"Keyword",children:o}),a.jsx(M,{children:a.jsx(k,{direction:"vertical",children:e.map((t,l)=>a.jsx("span",{children:t.split("").map((c,r)=>r===l||c===" "?c:"â¹").join("")},`${n}-${t}`))})})]})}},{title:"Quartetos",dataIndex:"quartetos",key:"quartetos",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,setId:i,sets:o}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"SetId",children:m.truncate(i,{length:9})}),a.jsx(M,{children:a.jsx(C,{gap:6,children:o.map(e=>a.jsx(C,{gap:6,vertical:!0,children:e.itemsIds.map(t=>a.jsx(P,{id:t,width:50},t))},e.id))})})]})}},{title:"PicaÃ§o",dataIndex:"artista",key:"artista",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,cards:i}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"Cards",children:i.length}),a.jsx(M,{children:a.jsx(C,{gap:6,vertical:!0,style:{maxHeight:500,overflowY:"auto"},children:i.map((o,e)=>a.jsx("span",{children:o.text},`${o.id}-${e}`))})})]})}},{title:"TÃ¡ Na Cara",dataIndex:"ta-na-cara",key:"ta-na-cara",render:s=>{if(!s)return a.jsx(v,{message:"No entry",type:"error"});const{number:n,suspectsIds:i,testimonies:o}=s;return a.jsxs(w,{children:[a.jsx(R,{children:n}),a.jsx(D,{label:"Suspects",children:i==null?void 0:i.length}),a.jsx(D,{label:"Questions",children:o.length}),a.jsx(M,{children:a.jsxs(C,{vertical:!0,children:[a.jsx(k,{direction:"vertical",style:{maxHeight:100,overflowY:"auto"},children:o.map(e=>a.jsx("span",{children:e.question},e.testimonyId))}),a.jsx(k,{wrap:!0,style:{maxHeight:200,maxWidth:"500px",overflowY:"auto"},children:i==null?void 0:i.map(e=>a.jsx(Ee,{id:e,width:48},e))})]})})]})}}];function Ve(){const[s,n]=A.useState(""),[i,o]=A.useState(!1),{isLoading:e,data:t}=Le("diario",s,{enabled:!!s&&i}),l=A.useMemo(()=>t?[t]:[],[t]),c=d=>{o(!1),n(d.trim())},r=()=>{console.log(s,ie(s,"YYYY-MM-DD",!0).isValid()),o(ie(s,"YYYY-MM-DD",!0).isValid())};return console.log(t),a.jsxs("div",{children:[a.jsx(B.Title,{level:2,children:"Data Verification"}),a.jsx(ne,{to:"/game/daily-setup",children:"Go to Setup"}),a.jsxs(C,{justify:"space-between",align:"center",className:"mb-2",children:[a.jsxs(k.Compact,{children:[a.jsx(ve,{placeholder:"YYYY-MM-DD",onChange:d=>c(d.target.value)}),a.jsx(W,{type:"primary",onClick:r,children:"Load"})]}),s," ",i?"Valid":"Invalid",a.jsx(W,{disabled:!0,type:"primary",size:"large",children:"Save"})]}),a.jsx(ae,{loading:e,columns:de,dataSource:l,scroll:{x:"max-content"}})]})}const J=new xe({}),K=(s,n)=>{J.setState(i=>({...i,[s]:n}))},Fe=()=>{J.setState(()=>({}))},Be=()=>Ie(J,()=>J.state),We=(s,n,i,o)=>{const[e]=_(p.AQUI_O,o),t=T("items",s),l=T("daily-disc-sets",s);return{entries:A.useMemo(()=>!s||!l.isSuccess||!e||!t.isSuccess?{}:Je(i,e,l.data,t.data),[s,l,t,e,i]),isLoading:t.isLoading||l.isLoading}},Je=(s,n,i,o)=>{console.count("Creating Aqui Ã“...");const e=m.shuffle(Object.values(i).filter(d=>d.itemsIds.filter(Boolean).length>=20)),t=e.filter(d=>!n.used.includes(d.id));t.length<s&&(console.log("ðŸ”† Not enough aqui-o sets left, shuffling..."),K("aqui-o","Not enough aqui-o sets left"),t.push(...m.shuffle(e)));const l=Object.values(o).filter(d=>d!=null&&d.nsfw?!1:m.intersection(d.decks??[],["alien","dream","thing"]).length>0);let c=n.latestDate;const r={};for(let d=0;d<s;d++){const h=t[d];h||console.error("No aqui-o sets left");const u=G(c),I=oe(u);c=u,I?r[u]={id:u,type:"aqui-o",number:n.latestNumber+d+1,setId:"special",title:{pt:"Especial Fim de Semana",en:"Weekend Special"},itemsIds:["0",...m.sampleSize(l,25).map(x=>x.id)]}:r[u]={id:u,type:"aqui-o",number:n.latestNumber+d+1,setId:h.id,title:h.title,itemsIds:["0",...m.sampleSize(h.itemsIds,20)]}}return r},Ye=(s,n,i,o)=>{const[e]=_(p.ARTE_RUIM,o),t=re(s,n);return{entries:A.useMemo(()=>!s||t.isLoading||!e?[]:$e(i,e,t,n),[s,t,n,e,i,t.isLoading]),isLoading:t.isLoading}},$e=(s,n,i,o)=>{console.count("Creating Arte Ruim...");const e=Object.values(i.drawings).filter(r=>!(n.used.includes(r.id)||r.drawings.length<3)).map(r=>({id:r.id,type:"arte-ruim",language:o??"pt",cardId:r.id,text:r.text,drawings:r.drawings.map(d=>d.drawing),number:0,dataIds:r.drawings.map(d=>d.id)})),t=m.sampleSize(m.shuffle(e),s);let l=n.latestDate;return t.map((r,d)=>{const h=G(l);return l=h,{...r,id:h,number:n.latestNumber+d+1}})},He=(s,n,i,o,e)=>{const[t]=_(p.ARTISTA,o),[l]=_(p.ARTE_RUIM,o),c=T(`arte-ruim-cards-${n}`,s),r=re(s,n);return{entries:A.useMemo(()=>{if(!s||!c.isSuccess||r.isLoading||!t)return{};const h=e.map(u=>u.cardId);return Ze(i,t,l,c.data,h,r.drawings)},[s,c,l,t,i,e,r.drawings,r.isLoading]),isLoading:c.isLoading||r.isLoading}},Ze=(s,n,i,o,e,t)=>{console.count("Creating Artista...");let l=n.latestDate;const c={};for(let r=0;r<s;r++){const d=G(l),h=Object.keys(o??{}).filter(I=>{var x,N;return!i.used.includes(I)&&!e.includes(I)&&((N=(x=t==null?void 0:t[I])==null?void 0:x.drawings)==null?void 0:N.length)<4}),u=m.sampleSize(h,20).map(I=>o[I]);l=d,c[d]={id:d,type:"artista",number:n.latestNumber+r+1,cards:u}}return c},ze=(s,n,i,o)=>{const[e]=_(p.COMUNICACAO_ALIENIGENA,o),t=T("items",s),l=T("items-attributes",s),c=T("items-attribute-values",s);return{entries:A.useMemo(()=>!s||!e||!l.isSuccess||!c.isSuccess||!t.isSuccess?{}:Ke(i,e,l.data,c.data,t.data),[s,i,e,e,l,c,t]),isLoading:t.isLoading||l.isLoading||c.isLoading}},Ke=(s,n,i,o,e)=>{console.count("Creating Comunicacao Alienigena...");let t=n.latestDate;const l=m.values(i),c=m.values(o).filter(u=>{var I;return u.complete&&((I=e==null?void 0:e[u.id])==null?void 0:I.nsfw)!==!0}),r={};let d=0;for(;m.keys(r).length<s&&d<100;){const u=Xe(l,c);if(u.valid&&!r[u.setId]&&!n.used.includes(u.setId)&&(r[u.setId]=u),m.keys(r).length>=s)break;d+=1}console.log(`ðŸ”† Generating this batch took ${d} tries`),d>=100&&K("comunicacao-alienigena","Not enough valid comunicacao alienigena games (over 100 attempts)");const h={};return Object.values(r).forEach((u,I)=>{const x=G(t);t=x,h[x]={...u,id:x,number:n.latestNumber+I+1}}),h},Xe=(s,n)=>{const i=m.shuffle(n),o=m.shuffle(_e(50,0)),e=m.sampleSize(s,3).map(g=>({...g,spriteId:`${o.pop()}`})),t=[],l=[],c=[],r=[],d=[],h=[],u=[],I=[];i.forEach(g=>{const U=[Q.DETERMINISTIC,Q.RELATED],j=g.attributes[e[0].id]===Q.DETERMINISTIC,O=U.includes(g.attributes[e[0].id]),b=g.attributes[e[0].id]===Q.UNRELATED,me=g.attributes[e[1].id]===Q.DETERMINISTIC,Y=U.includes(g.attributes[e[1].id]),V=g.attributes[e[1].id]===Q.UNRELATED,pe=g.attributes[e[2].id]===Q.DETERMINISTIC,$=U.includes(g.attributes[e[2].id]),F=g.attributes[e[2].id]===Q.UNRELATED;if(b&&V&&F)return I.push(g.id);j&&V&&F&&t.push(g.id),b&&me&&F&&l.push(g.id),b&&V&&pe&&c.push(g.id),O&&Y&&F&&r.push(g.id),O&&V&&$&&d.push(g.id),b&&Y&&$&&h.push(g.id),O&&Y&&$&&u.push(g.id)});const x=e.map(g=>({id:g.id,name:g.name.pt,description:g.description.pt,spriteId:g.spriteId,itemsIds:[]}));x[0].itemsIds=m.sampleSize(t,t.length>3?3:Math.max(t.length-1,1)),x[1].itemsIds=m.sampleSize(l,l.length>3?3:Math.max(t.length-1,1)),x[2].itemsIds=m.sampleSize(c,c.length>3?3:Math.max(t.length-1,1));const N=[];x.forEach(g=>{N.push(...g.itemsIds)});const E=[];r.length>0&&E.push({spritesIds:[e[0].spriteId,e[1].spriteId],itemId:m.sample(r)??""}),d.length>0&&E.push({spritesIds:[e[0].spriteId,e[2].spriteId],itemId:m.sample(d)??""}),h.length>0&&E.push({spritesIds:[e[1].spriteId,e[2].spriteId],itemId:m.sample(h)??""}),u.length>0&&E.push({spritesIds:e.map(g=>g.spriteId),itemId:m.sample(u)??""});const y=[];t.length>0&&y.push({spritesIds:[e[0].spriteId],itemId:t.filter(g=>!N.includes(g))[0]}),l.length>0&&y.push({spritesIds:[e[1].spriteId],itemId:l.filter(g=>!N.includes(g))[0]}),c.length>0&&y.push({spritesIds:[e[2].spriteId],itemId:c.filter(g=>!N.includes(g))[0]});let S=m.sampleSize(E,4);S.length<3&&S.push(...m.sampleSize(y,4-S.length)),S.length<4&&console.log("ðŸ”† Not enough requests for an alien communication, marking it as invalid"),S=m.shuffle(S);const f=S.map(g=>g.itemId),L={id:"0000-00-00",setId:x.map(g=>g.id).sort().join("-"),number:0,type:"comunicaÃ§Ã£o-alienÃ­gena",attributes:x,requests:S,solution:f.join("-"),itemsIds:m.shuffle([...f,...m.sampleSize([I[0],I[1],I[2],I[3]],m.random(1,3))]).filter(Boolean),valid:!1};return L.valid=[L.attributes.length===3,L.requests.length===4,L.itemsIds.length>4,L.attributes.every(g=>g.itemsIds.length>0),L.requests.every(g=>g.itemId)].every(Boolean),L},et=(s,n,i,o)=>{const[e]=_(p.CONTROLE_DE_ESTOQUE,o);return{entries:A.useMemo(()=>!s||!e?{}:tt(i,e),[s,i,e]),isLoading:!1}},tt=(s,n)=>{console.count("Creating Controle de Estoque...");let i=n.latestDate;const o={};for(let e=0;e<s;e++){const t=G(i);i=t,o[t]=at(t,n.latestNumber+e+1)}return o},st=256,it=16,nt=4,rt=1,at=(s,n)=>{const[i,o,e]=s.split("-").map(Number),l=new Date(i,o-1,e).getDay(),c=["Domingo","Segunda-feira","TerÃ§a-feira","Quarta-feira","Quinta-feira","Sexta-feira","SÃ¡bado"][l],r={id:s,number:n,type:"controle-de-estoque",language:"pt",title:c,goods:[],orders:[]},d=m.sampleSize(Array(st).fill("").map((u,I)=>`good-${I+1}`),it+rt),h=d.pop();if(r.goods=d,r.orders=m.sampleSize(r.goods,nt),!h)throw new Error("No out of stock good");return r.orders.push(h),r.orders=m.shuffle(r.orders),r},ot=(s,n,i,o)=>{const[e]=_(p.FILMACO,o),t=T("daily-movie-sets",s);return{entries:A.useMemo(()=>!s||!t.isSuccess||!e?{}:(Object.values(t.data).filter(r=>r.itemsIds.length>0&&!e.used.includes(r.id)).length<=i&&K("filmaco","Not enough unused films"),lt(i,e,t.data)),[s,t,e,i]),isLoading:t.isLoading}},lt=(s,n,i)=>{console.count("Creating FilmaÃ§o...");const o=m.shuffle(Object.values(i).filter(c=>c.itemsIds.filter(Boolean).length>0)),e=o.filter(c=>!n.used.includes(c.id));e.length<s&&e.push(...m.shuffle(o));let t=n.latestDate;const l={};for(let c=0;c<s;c++){const r=e[c];if(!r){console.error("No filmaÃ§o sets left");break}const d=G(t);t=d,l[d]={id:d,type:"filmaco",number:n.latestNumber+c+1,setId:r.id,title:r.title,itemsIds:r.itemsIds,year:r.year}}return l},ct=(s,n,i,o)=>{const[e]=_(p.PALAVREADO,o),t=Z(4,n,s),l=Z(5,n,s);return{entries:A.useMemo(()=>!s||!t.data||!t.data.length||!l.data||!l.data.length||!e?{}:dt(i,e,t.data,l.data),[s,t,l,e,i]),isLoading:t.isLoading||l.isLoading}},dt=(s,n,i,o)=>{console.count("Creating Palavreado...");let e=n.latestDate;const t=[],l={};for(let c=0;c<s;c++){const r=G(e),d=oe(r),h=d?5:4;e=r,l[r]={id:r,type:"palavreado",number:n.latestNumber+c+1,...ut(d?o:i,[...Object.values(l).map(u=>u.keyword),...n.used],t,h)}}return l},ut=(s,n,i,o=4,e)=>{let t=m.shuffle(m.difference(s,i,n));const l=e||(t.pop()??""),c=[];for(let r=0;r<o;r++){const d=mt(s,l,c,r);c.push(d)}return i.push(l,...c),{keyword:l,words:c,letters:pt(c,l.length)}},mt=(s,n,i,o)=>{const e=m.uniq([...m.flatMap(i.map(c=>c.split(""))),...n.split("")]),t=m.shuffle(s.filter(c=>c[o]===n[o]&&!i.includes(c)));return m.sortBy(t,c=>m.intersection(c.split(""),e).length)[0]},pt=(s,n)=>{const i=m.flatMap(s.map(l=>l.split(""))),o=n===4?[0,5,10,15]:[0,6,12,18,24],e=m.shuffle(i.filter((l,c)=>!o.includes(c))),t=[];for(let l=0;l<i.length;l++)o.includes(l)?t.push(i[l]):t.push(e.shift()??"");return t},gt=(s,n,i,o)=>{const[e]=_(p.PORTAIS_MAGICOS,o),t=T("daily-passcode-sets",s),l=Z(3,n,s);return{entries:A.useMemo(()=>({}),[s,i,t.isSuccess,t.data,l.isSuccess,l.data,e]),isLoading:t.isLoading||l.isLoading}},ht=(s,n,i,o)=>{const[e]=_(p.QUARTETOS,o),t=T("daily-quartet-sets",s),l=T("items-groups",s);return{entries:A.useMemo(()=>!s||t.isLoading||l.isLoading||!e?{}:ft(i,e,n,t.data,l.data),[s,n,e,i,t,l]),isLoading:t.isLoading||l.isLoading}},ft=(s,n,i,o,e)=>{console.count("Creating Quartetos...");let t=Object.values(o).filter(r=>r.itemsIds.length>=4&&!n.used.includes(r.id)&&!r.flagged),l=n.latestDate;const c={};return Array.from({length:s}).forEach((r,d)=>{const h=[],u={};let I=m.cloneDeep(t),x=0;for(;h.length<3&&x<500;){const j=m.sample(I);if(!j)throw Error("No potential set found for Quartetos game");I=I.filter(b=>b.id!==j.id);const O=m.orderBy(m.sampleSize(j.itemsIds,4),b=>Number(b));if(O.some(b=>u[b])){x++;continue}j.itemsIds.forEach(b=>{u[b]=!0}),h.push({id:j.id,title:j.title,itemsIds:O,level:j.level??1}),x=0}const N=h.map(j=>j.id);t=t.filter(j=>!N.includes(j.id));const E=Object.values(e).filter(j=>j.itemsIds.some(O=>!u[O])&&j.itemsIds.length>=4),y=m.sample(E);if(!y)throw Error("No eligible group found for Quartetos game");h.push({id:y.id,title:m.capitalize(y.name[i]),itemsIds:m.sampleSize(y.itemsIds,4),level:1});const S=Math.ceil(h.reduce((j,O)=>j+O.level,0)/h.length),f=m.orderBy(h,["level"],["desc"]).map((j,O)=>(j.level=O,j)),L=h.map(j=>j.id).join(z),g=m.shuffle(h.flatMap(j=>j.itemsIds)),U=G(l);l=U,c[U]={id:U,number:n.latestNumber+d+1,setId:L,type:"quartetos",grid:g,difficulty:S,sets:f}}),c},It=(s,n)=>q([...s,...n.flatMap(i=>i.sets.map(o=>o.id))]),xt=(s,n,i,o)=>{const[e]=_(p.TA_NA_CARA,o),t=T("suspects",s),l=T(`testimony-questions-${n}`,s);return{entries:A.useMemo(()=>!s||!t.isSuccess||!l.isSuccess||!e?{}:yt(i,e,t.data,l.data),[s,t,l,e,i]),isLoading:t.isLoading||l.isLoading}},jt=12,At=15,yt=(s,n,i,o)=>{console.count("Creating TÃ¡ Na Cara...");const e=ue(n.used),t=m.orderBy(m.shuffle(Object.values(i)).map(d=>{const[,h]=d.id.split("-");return`us-ct-${h}`}),[d=>e==null?void 0:e[d]],["asc"]),l=m.shuffle(Object.values(o));let c=n.latestDate;const r={};for(let d=0;d<s;d++){const h=m.sampleSize(l,jt).map(I=>({testimonyId:I.id,question:I.question,nsfw:!!I.nsfw})),u=G(c);c=u,r[u]={id:u,type:"ta-na-cara",number:n.latestNumber+d+1,suspectsIds:m.sampleSize(t,At),testimonies:h}}return r},ue=s=>s.reduce((n,i)=>{const o=i.split(z),e=o[0],t=Number(o[1]);return n[e]=t||0,n},{}),Dt=(s,n)=>{const i=ue(s);return n.forEach(o=>{var e;o.testimonies.forEach(t=>{var l;i[t.testimonyId]===void 0&&(i[t.testimonyId]=0),i[t.testimonyId]+=1,(l=t==null?void 0:t.suspectsIds)==null||l.forEach(c=>{i[c]===void 0&&(i[c]=0),i[c]+=1})}),(e=o.suspectsIds)==null||e.forEach(t=>{i[t]===void 0&&(i[t]=0),i[t]+=1})}),Object.entries(i).map(([o,e])=>`${o}${z}${e}`)};function St(s,n,i){const o=le.DAILY[n??"pt"],e=ce(o,{enabled:s});A.useEffect(()=>{Fe()},[i,n]);const t=s&&e.isSuccess,l=We(t,n,i,e.data??{}),c=Ye(t,n,i,e.data??{}),r=ze(t,n,i,e.data??{}),d=et(t,n,i,e.data??{}),h=ot(t,n,i,e.data??{}),u=ct(t,n,i,e.data??{}),I=ht(t,n,i,e.data??{}),x=we(t,n,i,e.data??{}),N=gt(!1,n,i,e.data??{});console.log(N);const E=He(t,n,i,e.data??{},c.entries),y=xt(t,n,i,e.data??{}),S=A.useMemo(()=>c.entries.length===0?[]:(console.count("Bundling entries..."),c.entries.map(f=>({id:f.id,"arte-ruim":f,"aqui-o":l.entries[f.id],"comunicacao-alienigena":r.entries[f.id],"controle-de-estoque":d.entries[f.id],filmaco:h.entries[f.id],palavreado:u.entries[f.id],quartetos:I.entries[f.id],"teoria-de-conjuntos":x.entries[f.id],artista:E.entries[f.id],"ta-na-cara":y.entries[f.id]}))),[c.entries,l.entries,h.entries,r.entries,d.entries,u.entries,I.entries,x.entries,E.entries,y.entries]);return{isLoading:e.isLoading||l.isLoading||c.isLoading||r.isLoading||d.isLoading||h.isLoading||u.isLoading||I.isLoading||x.isLoading||E.isLoading||y.isLoading,entries:S}}function Nt(s){const{notification:n}=je.useApp(),i=Ae(),o=le.DAILY[s??"pt"],[e,t]=A.useState(!1),l=ce(o,{enabled:!!o}),c=Re({mutationFn:async r=>{var x,N,E,y,S;const d=r.map(f=>{const L=X(ee,`${o}/${f.id}`);return te(L,f)}),h=X(ee,`${o}/history`),u=l.data;if(!u)throw new Error("No previous history");const I={...u,[p.ARTE_RUIM]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.ARTE_RUIM].number,used:JSON.stringify(q([...JSON.parse(u[p.ARTE_RUIM].used),...r.map(f=>f[p.ARTE_RUIM].cardId)]))},[p.AQUI_O]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.AQUI_O].number,used:JSON.stringify(q([...JSON.parse(u[p.AQUI_O].used??"[]"),...r.map(f=>f[p.AQUI_O].setId)]))},[p.PALAVREADO]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.PALAVREADO].number,used:JSON.stringify(q([...JSON.parse(u.palavreado.used),...r.map(f=>f[p.PALAVREADO].keyword)]))},[p.ARTISTA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.ARTISTA].number,used:"[]"},[p.FILMACO]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.FILMACO].number,used:JSON.stringify(q([...JSON.parse(((x=u==null?void 0:u[p.FILMACO])==null?void 0:x.used)??"[]"),...r.map(f=>f[p.FILMACO].setId)]))},[p.CONTROLE_DE_ESTOQUE]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.CONTROLE_DE_ESTOQUE].number,used:"[]"},[p.TEORIA_DE_CONJUNTOS]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.TEORIA_DE_CONJUNTOS].number,used:JSON.stringify(q([...JSON.parse(((N=u==null?void 0:u[p.TEORIA_DE_CONJUNTOS])==null?void 0:N.used)??"[]"),...r.map(f=>f[p.TEORIA_DE_CONJUNTOS].setId),...r.map(f=>f[p.TEORIA_DE_CONJUNTOS].intersectingThing.id)]))},[p.COMUNICACAO_ALIENIGENA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.COMUNICACAO_ALIENIGENA].number,used:JSON.stringify(q([...JSON.parse(((E=u==null?void 0:u[p.COMUNICACAO_ALIENIGENA])==null?void 0:E.used)??"[]"),...r.map(f=>f[p.COMUNICACAO_ALIENIGENA].setId)]))},[p.QUARTETOS]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.QUARTETOS].number,used:JSON.stringify(It(JSON.parse(((y=u==null?void 0:u[p.QUARTETOS])==null?void 0:y.used)??"[]"),r.map(f=>f[p.QUARTETOS])))},[p.TA_NA_CARA]:{latestDate:r[r.length-1].id,latestNumber:r[r.length-1][p.TA_NA_CARA].number,used:JSON.stringify(Dt(JSON.parse(((S=u==null?void 0:u[p.TA_NA_CARA])==null?void 0:S.used)??"[]"),r.map(f=>f[p.TA_NA_CARA])))}};return te(h,I),Promise.all(d)},onSuccess:()=>{n.info({message:"Data saved",placement:"bottomLeft"}),i.invalidateQueries({queryKey:[o,"history"]}),t(!1)},onError:()=>{n.error({message:"Error saving data",placement:"bottomLeft"})}});return{isDirty:e,setIsDirty:t,save:c.mutateAsync,isPending:c.isPending}}function Et({language:s,dataLoad:n}){const i=s,{is:o}=Se(),e=Be();console.log(e);const{save:t,isPending:l}=Nt(i??"pt");return o("dataCheck")?a.jsx(Ve,{}):a.jsxs("div",{children:[a.jsx(B.Title,{level:2,children:"Data Population"}),n.isLoading&&a.jsx("div",{children:"Loading..."}),a.jsxs(C,{justify:"space-between",align:"center",children:[a.jsxs("span",{children:[a.jsx(ne,{to:"/game/daily-setup?dataCheck=true",children:"Go to Check"}),a.jsxs(B.Title,{level:4,children:["Total: ",n.entries.length]})]}),a.jsx(W,{onClick:()=>t(n.entries),loading:l,disabled:(n.entries??[]).length===0,type:"primary",size:"large",icon:a.jsx(Me,{}),children:"Save"})]}),Object.values(e).map(c=>a.jsx(v,{message:c,type:"warning",showIcon:!0,banner:!0},c)),a.jsx(ae,{columns:de,dataSource:n.entries??[],scroll:{x:"max-content"}})]})}function Ot({language:s,setLanguage:n,drawingsCount:i,setDrawingsCount:o,batchSize:e,setBatchSize:t}){return a.jsxs(Ge,{children:[a.jsx(H,{label:"Language",value:s,onChange:n,options:[Ce],placeholder:"Select a language"}),a.jsx(H,{label:"Minimum Drawings",value:i,onChange:o,options:[2,3,4],placeholder:"Select a number"}),a.jsx(H,{label:"Batch Size",value:e,onChange:t,options:[3,7,14,21,28],placeholder:"Select a number"})]})}function us(){const[s,n]=A.useState(""),[i,o]=A.useState(3),[e,t]=A.useState(7),l=St(!!s,s,e);return a.jsx(ye,{title:"Daily Setup",children:a.jsxs(se,{hasSider:!0,children:[a.jsxs(ke,{children:[a.jsx(De,{isLoading:l.isLoading,error:null,hasResponseData:!l.isLoading}),a.jsx(Ot,{language:s,setLanguage:n,drawingsCount:i,setDrawingsCount:o,batchSize:e,setBatchSize:t})]}),a.jsx(se.Content,{className:"content",children:a.jsx(Qe,{isLoading:l.isLoading,error:null,hasResponseData:!l.isLoading,children:a.jsx(Et,{language:s,dataLoad:l})})})]})},e)}export{us as default};
