import{r as m,j as x}from"./index-u4YAhSlc.js";import{u as b}from"./useTDResource-CUCNzABN.js";import{l as E}from"./lodash-Bjm1XJDL.js";import{u as P,A as R}from"./useDebounce-Cmnf63RE.js";import{I as w}from"./index-BGA14dYj.js";function N({items:c,isPending:u,style:C,size:A,placeholder:S,allowClear:$,onFinish:f,onFinishMultiple:p,...g}){const O=b("items",!c&&!u),{namesDict:n,options:j}=m.useMemo(()=>{console.log("Recomputing item names typeahead...");const s=Object.values(c??O.data??{}).reduce((r,e)=>{const a=`${e.name.en} (${e.id})`,d=`${e.name.pt} (${e.id})`;return r[a]=e.id,r[d]=e.id,e.aliasesEn&&e.aliasesEn.forEach(o=>{r[`${o} (${e.id})*`]=e.id}),e.aliasesPt&&e.aliasesPt.forEach(o=>{r[`${o} (${e.id})*`]=e.id}),r},{}),t=E.orderBy(Object.keys(s),[r=>r.toLowerCase()]).map(r=>({value:r}));return{namesDict:s,options:t}},[c,u]),[i,h]=m.useState([]),[l,D]=m.useState("");P(()=>{l&&I(l)},500,[l]);const I=s=>{if(!s){h([]);return}const t=s.trim().toUpperCase(),r=j.filter(a=>String((a==null?void 0:a.value)??"").toUpperCase().includes(t)),e=E.orderBy(r,[a=>{const d=String((a==null?void 0:a.value)??"").toUpperCase();if(d===t)return 0;const o=d.match(/\((.*?)\)/);if(o&&o[1]===t)return 1;const v=d.indexOf(t);return v===0?2:v>0?3:4}]);h(e)},T=()=>{if(i.length>0){const s=i.map(t=>n[t.value]).filter(Boolean);p&&s.length>0?p(s):n[i[0].value]!==void 0&&f(n[i[0].value])}},U=s=>{n[s]!==void 0&&f(n[s])};return x.jsx(R,{options:i,style:{width:250,...C},allowClear:$??!0,placeholder:S??"Search by name or id...",filterOption:(s,t)=>String((t==null?void 0:t.value)??"").toUpperCase().indexOf(s==null?void 0:s.toUpperCase())!==-1,onSearch:D,notFoundContent:l.length>0?"No items found":"Type to search...",onSelect:U,...g,children:x.jsx(w,{onPressEnter:T})})}export{N as I};
