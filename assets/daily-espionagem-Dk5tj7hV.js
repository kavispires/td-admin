import{u as Y,D as K,a as J,c as V,A as X}from"./useParsedHistory-CYM0Kk5f.js";import{t as Z,a as ee}from"./useTestimoniesResource-NALhrXC8.js";import{u as G}from"./useTDResource-B7EIjaJI.js";import{l as S}from"./useBaseUrl-D2YOm4WP.js";import{v as te,t as se,r as U}from"./index-CTf-mCqX.js";const W="td-admin-debug-daily",oe=()=>{const t={"aqui-o":!1,"arte-ruim":!1,artista:!1,"comunicacao-alienigena":!1,"controle-de-estoque":!1,espionagem:!1,filmaco:!1,organiku:!1,palavreado:!1,"portais-magicos":!1,quartetos:!1,"ta-na-cara":!1,"teoria-de-conjuntos":!1};try{const e=localStorage.getItem(W);return e?JSON.parse(e):t}catch{return t}},y=new se(oe());y.subscribe(()=>{try{const t={"aqui-o":y.state["aqui-o"],"arte-ruim":y.state["arte-ruim"],artista:y.state.artista,"comunicacao-alienigena":y.state["comunicacao-alienigena"],"controle-de-estoque":y.state["controle-de-estoque"],espionagem:y.state.espionagem,filmaco:y.state.filmaco,organiku:y.state.organiku,palavreado:y.state.palavreado,"portais-magicos":y.state["portais-magicos"],quartetos:y.state.quartetos,"ta-na-cara":y.state["ta-na-cara"],"teoria-de-conjuntos":y.state["teoria-de-conjuntos"]};localStorage.setItem(W,JSON.stringify(t))}catch{}});const Ie=(t,e)=>{y.setState(s=>({...s,[t]:!s[t]}))},ke=()=>te(y,()=>y.state),b=(...t)=>{y.state.espionagem&&console.log(...t)},ae=t=>{y.state.espionagem&&console.count(t)},ne=(...t)=>{y.state.espionagem&&console.error(...t)},ie={male:"Ã© homem",female:"Ã© mulher",caucasian:"Ã© branco(a)",black:"Ã© negro(a)",asian:"Ã© asiÃ¡tico(a)",latino:"Ã© latino(a)",thin:"Ã© magrelo(a)",fat:"Ã© gordo(a)",large:"Ã© gordo(a)",tall:"Ã© alto(a)",short:"Ã© baixinho(a)",young:"Ã© jovem",adult:"Ã© adulto(a)",senior:"Ã© da terceira idade",average:"tem corpo normal",medium:"Ã© de altura mÃ©dia",mixed:"Ã© mestiÃ§o(a)",hat:"estÃ¡ usando um chapÃ©u",tie:"estÃ¡ usando uma gravata",glasses:"estÃ¡ usando Ã³culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",scarf:"estÃ¡ usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"Ã© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"Ã© sarado(a)",blackHair:"tem cabelo preto",hoodie:"estÃ¡ usando um moletom",earrings:"estÃ¡ usando brincos",lipstick:"estÃ¡ usando batom",necklace:"estÃ¡ usando um colar",mediumHair:"tem cabelo mÃ©dio","middle-eastern":"Ã© do Oriente MÃ©dio",headscarf:"estÃ¡ usando um lenÃ§o na cabeÃ§a",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"Ã© indiano(a)","native-american":"Ã© nativo-americano(a)",noAccessories:"estÃ¡ sem nenhum acessÃ³rio",avoidingCamera:"estÃ¡ evitando olhar para a cÃ¢mera",wearingStripes:"tem listras na roupa",blackClothes:"estÃ¡ vestindo roupas pretas",blueClothes:"estÃ¡ vestindo roupas azuis",greenClothes:"estÃ¡ vestindo roupas verdes",redClothes:"estÃ¡ vestindo roupas vermelhas",yellowClothes:"estÃ¡ vestindo roupas amarelas",purpleClothes:"estÃ¡ vestindo roupas roxas",orangeClothes:"estÃ¡ vestindo roupas laranjas",brownClothes:"estÃ¡ vestindo roupas marrons",whiteShirt:"estÃ¡ usando camisa branca",pinkClothes:"estÃ¡ vestindo roupas rosas",patternedShirt:"estÃ¡ usando roupa estampada",buttonShirt:"estÃ¡ usando camisa com botÃµes",bow:"estÃ¡ usando um laÃ§o",hairyChest:"estÃ¡ mostrando o peito peludo",wearingFlowers:"estÃ¡ usando flores",showTeeth:"estÃ¡ mostrando os dentes",hairTie:"estÃ¡ usando um xuxinha ou fita no cabelo","non-binary":"Ã© nÃ£o-binÃ¡rio(a)"},P=12,T=16,Me=(t,e,s,o)=>{const[a]=Y(K.ESPIONAGEM,o),r=G("suspects",{enabled:t}),c=G(`testimony-questions-${e}`,{enabled:t}),i=G("testimony-answers",{select:Z,enabled:t}),n=G("crime-reasons",{enabled:t}),h=U.useMemo(()=>de(i.data),[i.dataUpdatedAt]),l=U.useMemo(()=>me(r.data),[r.data]);return{entries:U.useMemo(()=>!t||!a||!r.isSuccess||!c.isSuccess||!i.isSuccess||!n.isSuccess?{}:ce(s,a,r.data,c.data,h,l,n.data),[t,a,r,c,i,s,h,l,n]),isLoading:r.isLoading||c.isLoading||i.isLoading}},ce=(t,e,s,o,a,r,c)=>{ae("Creating Espionagem...");let i=e.latestDate;const n=[],h={};for(let l=0;l<t;l++){const x=J(i),E=V(x);i=x;let f=null,d=0;for(;f===null&&d<X;)try{d++;const u=re(s,o,a,r,n,c,E);xe(u.statements,E)&&(f=u)}catch{}if(!f)throw new Error(`Failed to generate valid game for ${x} after ${d} attempts`);b(`Generated valid game for ${x} after ${d} attempts`),n.push(f.culpritId),h[x]={id:x,type:"espionagem",number:e.latestNumber+l+1,...f}}return h};function re(t,e,s,o,a,r,c){const i=[],n={},h=c?T:P;b("SuspectTestimonyAnswers",s);const{selectedTestimonyId1:l,selectedTestimonyId2:x,selectedTestimonyId3:E,culpritId:f,suspectsIds:d}=fe(s,a,c),u={};Object.keys(o).forEach(C=>{if(o[C][f]===void 0){const R=Object.keys(o[C]).filter(q=>d.includes(q));if(R.length>0){const q={};R.forEach(A=>{d.includes(A)&&(q[A]=!0)}),u[C]=q}}});const m=e[l],w=z(f,d,m,s[l]);i.push(w),F(n,w.excludes);const j=e[x],g=z(f,d,j,s[x]);i.push(g),F(n,g.excludes);let p;if(c&&E){const C=e[E];p=z(f,d,C,s[E]),i.push(p),F(n,p.excludes)}const O=Q(f,d,u,[],"best",h);if(O.excludes.length===h-2)throw new Error("Best feature statement excludes too many suspects");i.push(O),F(n,O.excludes);const D=Q(f,d,u,[O],"best",h);i.push(D);const I=Q(f,d,u,[O,D],"worst",h);i.push(I),F(n,I.excludes);const v=Q(f,d,u,[O,D,I],"worst",h);if(i.push(v),i.length<6)throw new Error("Not enough statements generated");const k=S.shuffle(d),$=B(f,k,i,"columns",h);i.push($),F(n,$.excludes);const _=B(f,k,i,"rows",h);i.push(_);let M=[];c&&p?M=[w,I,g,O,p,$,v,_]:M=[w,I,g,O,$,v];const N=c?[D]:[D,_],H=be(t[f],r),L=le([...M,...N]);return{isNsfw:m.nsfw||j.nsfw||!1,culpritId:f,statements:M,additionalStatements:N,suspects:ue(k,t,L),reason:H.title,setId:`${f}::${H.id}::${M[0].key}`,level:Ee(M)}}const le=t=>{const e={};t.forEach(o=>{if(o.key.includes(".feature.")){const a=o.key.split("not.feature.")[1];e[a]=!0}});const s={hairColor:["brownHair","blondeHair","greyHair","redHair","blackHair","coloredHair"],hairLength:["shortHair","mediumHair","longHair","bald"],facialHair:["beard","mustache","goatee"]};for(const[,o]of Object.entries(s))o.some(a=>e[a])&&o.forEach(a=>{e[a]=!0});return e},ue=(t,e,s)=>t.map(o=>{const a=e[o],r={"18-21":"young","21-30":"adult","30-40":"adult","40-50":"adult","50-60":"senior","60-70":"senior","70-80":"senior","80-90":"senior"}[a.age]||a.age,c=[a.gender,r,a.ethnicity,a.height,a.build],i=a.features.filter(n=>s[n]);return{id:a.id,name:a.name,gender:a.gender,features:[...c,...i]}}),de=t=>{const e={};b("âš™ï¸ Calculating suspect answers...");for(const s of Object.keys(t)){const o=t[s];for(const a of Object.keys(o)){const{resolution:r,projection:c}=ee(a,s,o);if(!(!r&&!c)){if(e[s]===void 0&&(e[s]={}),r){e[s][a]=r==="ðŸ‘";continue}c&&(e[s][a]=c==="ðŸ‘")}}}return Object.keys(e).forEach(s=>{S.isEmpty(e[s])&&delete e[s]}),Object.keys(e).forEach(s=>{Object.keys(e[s]).length<3&&(b("â‰ï¸ Removing testimonies with less than 3 answers"),delete e[s])}),Object.keys(e).forEach(s=>{S.uniq(Object.values(e[s])).length===1&&(b("â‰ï¸ Removing testimonies with the same answer"),delete e[s])}),e},me=t=>{const e={};for(const o of Object.keys(t)){const{gender:a,ethnicity:r,age:c,build:i,height:n,features:h}=t[o];if(!i){b("â‰ï¸ Ignoring suspect with missing build",o);continue}if(!n){b("â‰ï¸ Ignoring suspect with missing height",o);continue}if(!h||h.length===0){b("â‰ï¸ Ignoring suspect with missing features",o);continue}e[a]===void 0&&(e[a]={}),e[a][o]=!0,e[r]===void 0&&(e[r]={}),e[r][o]=!0,e[c]===void 0&&(e[c]={}),e[c][o]=!0,e[i]===void 0&&(e[i]={}),e[i][o]=!0,e[n]===void 0&&(e[n]={}),e[n][o]=!0,h.forEach(l=>{e[l]===void 0&&(e[l]={}),e[l][o]=!0})}return e.young=S.cloneDeep(e["18-21"]),e.adult=S.cloneDeep({...e["21-30"],...e["30-40"],...e["40-50"]}),e.senior=S.cloneDeep({...e["50-60"],...e["60-70"],...e["70-80"],...e["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(o=>{delete e[o]}),e},fe=(t,e,s)=>{const o=Object.keys(t);let a=0;const r=s?T:P,c=Math.floor(r*.4),i=Math.ceil(r*.6);for(;a<X;){a++;const n=S.sample(o);if(!n)continue;const h=Object.keys(t[n]),l=S.sample(S.difference(h,e));if(!l)continue;const x=t[n][l],E=h.filter(u=>u!==l&&t[n][u]!==x),f=h.filter(u=>u!==l&&t[n][u]===x);if(E.length<c)continue;const d=S.sampleSize(o,20);for(const u of d){if(u===n||t[u][l]===void 0)continue;const m=t[u][l],w=f.filter(g=>t[u][g]!==void 0&&t[u][g]!==m),j=f.filter(g=>t[u][g]!==void 0&&t[u][g]===m);if(s){const g=S.sampleSize(o,10);for(const p of g){if(p===n||p===u||t[p][l]===void 0)continue;const O=t[p][l],D=j.filter(v=>t[p][v]!==void 0&&t[p][v]!==O),I=[];for(let v=c;v<=i;v++)if(E.length>=v){const k=r-1-v;w.length+D.length>=k&&I.push(v)}if(I.length>0){const v=S.sample(I)??I[0],k=r-1-v,_=Math.min(w.length,k-1),M=Math.max(1,k-D.length);if(_>=M){const N=Math.floor(Math.random()*(_-M+1))+M,H=k-N,L=S.sampleSize(E,v),C=S.sampleSize(w,N),R=S.sampleSize(D,H),q=[l,...L,...C,...R];return b("<===============>"),b(`âš™ï¸ Weekend Mode: ${r} Suspects`),b(`âš™ï¸ Culprit ID: ${l}`),b(`âš™ï¸ Q1: ${n} (Excludes ${L.length})`),b(`âš™ï¸ Q2: ${u} (Excludes ${C.length})`),b(`âš™ï¸ Q3: ${p} (Excludes ${R.length})`),b(">===============<"),{selectedTestimonyId1:n,selectedTestimonyId2:u,selectedTestimonyId3:p,culpritId:l,suspectsIds:q}}}}}else{const g=[c,c+1,i].filter(p=>E.length>=p&&w.length>=11-p);if(g.length>0){const p=S.sample(g)??g[0],O=S.sampleSize(w,11-p),D=E.filter($=>t[u][$]!==void 0&&t[u][$]!==m),I=S.difference(E,D);let v=[];D.length>=p?v=S.sampleSize(D,p):v=[...D,...S.sampleSize(I,p-D.length)];const k=[l,...v,...O];return b("<===============>"),b(`âš™ï¸ Culprit ID: ${l}`),b(`âš™ï¸ Selected Q1: ${n} (Excludes ${v.length})`),b(`âš™ï¸ Selected Q2: ${u} (Excludes remaining ${O.length})`),b(`âš™ï¸ Pool Size: ${k.length}`),b(">===============<"),{selectedTestimonyId1:n,selectedTestimonyId2:u,culpritId:l,suspectsIds:k}}}}}throw new Error("Failed to find a valid espionagem scenario")},F=(t,e)=>{e.forEach(s=>{t[s]===void 0&&(t[s]=0),t[s]++})},z=(t,e,s,o)=>{const a=o[t],r=e.filter(n=>o[n]!==void 0&&o[n]!==a),c=s.answer.charAt(0).toLowerCase()+s.answer.slice(1),i={key:`testimony.${s.id}`,text:`O(a) suspeito(a) ${a?"":"nÃ£o "}${c}`,excludes:r,type:"testimony"};return i.text.includes("nÃ£o jÃ¡")&&(i.text=i.text.replace("nÃ£o jÃ¡","nunca")),i},he={column1:{indexes:[0,4,8],text:"na primeira coluna"},column2:{indexes:[1,5,9],text:"na segunda coluna"},column3:{indexes:[2,6,10],text:"na terceira coluna"},column4:{indexes:[3,7,11],text:"na quarta coluna"},corners:{indexes:[0,3,8,11],text:"nos cantos"}},ge={row1:{indexes:[0,1,2,3],text:"na primeira linha"},row2:{indexes:[4,5,6,7],text:"na segunda linha"},row3:{indexes:[8,9,10,11],text:"na terceira linha"}},pe={column1:{indexes:[0,4,8,12],text:"na primeira coluna"},column2:{indexes:[1,5,9,13],text:"na segunda coluna"},column3:{indexes:[2,6,10,14],text:"na terceira coluna"},column4:{indexes:[3,7,11,15],text:"na quarta coluna"},corners:{indexes:[0,3,12,15],text:"nos cantos"}},Se={row1:{indexes:[0,1,2,3],text:"na primeira linha"},row2:{indexes:[4,5,6,7],text:"na segunda linha"},row3:{indexes:[8,9,10,11],text:"na terceira linha"},row4:{indexes:[12,13,14,15],text:"na quarta linha"}},B=(t,e,s,o,a)=>{const r=e.indexOf(t),c=s.slice(0,3);let i;a===T?i=o==="rows"?Se:pe:i=o==="rows"?ge:he;const n={};for(const d of Object.keys(i)){const{indexes:u}=i[d];u.includes(r)||(n[d]=u.reduce((m,w)=>{const j=e[w],g=c.filter(p=>p.excludes.includes(j)).length;return g>0?m+g:m},0))}const h=Object.entries(n).reduce((d,[u,m])=>(d[m]||(d[m]=[]),d[m].push(u),d),{}),l=Math.min(...Object.keys(n).map(d=>n[d])),x=h[l.toString()],E=S.sample(x)||Object.keys(n)[0],f=i[E].indexes.map(d=>e[d]);return{key:`not.grid.${E}`,text:`O(a) suspeito(a) nÃ£o estÃ¡ ${i[E].text}`,excludes:f,type:"grid"}},Q=(t,e,s,o=[],a="best",r=12)=>{const c=S.difference(e,[t]),i=o.filter(m=>m.key.startsWith("not.feature.")).map(m=>m.key.replace("not.feature.","")),n=new Set(o.flatMap(m=>m.excludes)),h=Math.ceil(r/2),l=Object.keys(s).filter(m=>Object.keys(s[m]).length<=h&&!i.includes(m)).sort((m,w)=>Object.keys(s[w]).length-Object.keys(s[m]).length);let x,E=[],f=0;const d=500;for(;f<d;){f++;let m;if(a==="best")m=l[0];else{const g=Math.min(2,l.length-1),p=Math.min(5,l.length);m=S.sample(l.slice(g,p))??l[g]}if(!m)break;const w=c.filter(g=>s[m][g]);if(w.some(g=>!n.has(g))||f===d){x=m,E=w;break}l.splice(l.indexOf(m),1)}if(!x)throw Error(`No suitable feature found for ${a} selection after ${d} attempts`);b(`Selected feature after ${f} attempts: ${x}`);const u=ie[x];return u||ne(`Feature ${x} not found in translations`),{key:`not.feature.${x}`,text:`O(a) suspeito(a) nÃ£o ${u||x}`,excludes:E,type:"feature"}},xe=(t,e)=>{const s=e?5:3,o=t.slice(0,s),a=e?T:P,r=e?13:10;return o.reduce((n,h)=>n+h.excludes.length,0)<r?!1:new Set(o.flatMap(n=>n.excludes)).size>=a-2},be=(t,e)=>{const s=[];Object.values(e).forEach(a=>{a.feature==="general"&&s.push(a),t.features?.includes(a.feature)&&s.push(a)});const o=S.sample(s);return o||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},Ee=t=>{const e=t.slice(0,3),s=[],o={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};e.forEach(r=>{const c=r.excludes.length;o[c]!==void 0&&s.push(o[c])});const a=Math.round(s.reduce((r,c)=>r+c,0)/s.length);return Math.min(Math.max(a,1),3)};export{ke as a,y as d,Ie as t,Me as u};
