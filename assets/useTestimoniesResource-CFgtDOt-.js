import{u as Q,D as z,a as W,A as P}from"./useParsedHistory-CUwW6U_p.js";import{l as b}from"./useBaseUrl-COECqrdK.js";import{u as F}from"./useTDResource-Cr-x85x9.js";import{a7 as V,a8 as X,r as L}from"./index-Dc5Qk1qg.js";import{u as Y}from"./useResourceFirestoreData-BTWBYoHq.js";const U="td-admin-debug-daily",J=()=>{const t={"aqui-o":!1,"arte-ruim":!1,artista:!1,"comunicacao-alienigena":!1,"controle-de-estoque":!1,espionagem:!1,filmaco:!1,organiku:!1,palavreado:!1,"portais-magicos":!1,quartetos:!1,"ta-na-cara":!1,"teoria-de-conjuntos":!1};try{const e=localStorage.getItem(U);return e?JSON.parse(e):t}catch{return t}},g=new X(J());g.subscribe(()=>{try{const t={"aqui-o":g.state["aqui-o"],"arte-ruim":g.state["arte-ruim"],artista:g.state.artista,"comunicacao-alienigena":g.state["comunicacao-alienigena"],"controle-de-estoque":g.state["controle-de-estoque"],espionagem:g.state.espionagem,filmaco:g.state.filmaco,organiku:g.state.organiku,palavreado:g.state.palavreado,"portais-magicos":g.state["portais-magicos"],quartetos:g.state.quartetos,"ta-na-cara":g.state["ta-na-cara"],"teoria-de-conjuntos":g.state["teoria-de-conjuntos"]};localStorage.setItem(U,JSON.stringify(t))}catch{}});const Se=(t,e)=>{g.setState(s=>({...s,[t]:!s[t]}))},Ee=()=>V(g,()=>g.state),K=(t,e,s,a)=>{const{reliabilityThreshold:o=4,projectionThreshold:i=55}=a||{},u=`us-gb-${t.split("-")[1]}`,n=b.isEmpty(s[t])?[]:s[t],m=n.some(S=>S===32||S===-32);let c=0,f=0,h=0,l=0,d=0;n.forEach(S=>{S===32?c+=35:S===-32?f+=35:S===4?c+=4:S===-4?f+=4:S>0?h+=S:S<0&&(l+=Math.abs(S)),d+=Math.abs(S)});const y=h+l,O=Math.max(d,o),E=d===0?0:Math.round((c+h)/O*100),x=d===0?0:Math.round((f+l)/O*100),w=c+h,k=f+l,j=d===0?100:Math.round((O-w-k)/O*100),H=m||d>=o,v=m||y>o/1.5||d>=4,D=d>o&&Math.abs(E-x)>=40,$=D&&Math.abs(E-x)>40?E>x?"ðŸ‘":"ðŸ‘Ž":null,N=!v||!D?null:E>=i?"ðŸ‘":x>=i?"ðŸ‘Ž":null;return{suspectCardId:t,imageId:u,questionId:e,enoughData:v,reliable:D,total:d,yesCount:w,yesPercentage:E,noCount:k,noPercentage:x,blankPercentage:j,complete:H,values:n,resolution:$,projection:N}};function xe(t){const e=t.map(n=>n===0?-1:n),s=t.filter(n=>n===-32||n===32||n===4||n===-4),a=e.filter(n=>n===-1||n===1),o=e.filter(n=>![-32,32,4,-4,-1,1].includes(n)).flatMap(n=>Array.from({length:Math.abs(n)},()=>n>0?1:-1)),i=[...a,...o].sort((n,m)=>n-m),r={"-1":0,1:0};i.forEach(n=>{(n===-1||n===1)&&(r[n]+=1)});const u=8;for(const[n,m]of Object.entries(r)){const c=Math.floor(m/u),f=m%u;for(let h=0;h<c;h++)s.push(n==="-1"?-u:u);if(f>0){const h=Array.from({length:f},()=>n==="-1"?-1:1);s.push(...h)}}return s.sort((n,m)=>n-m)}const p=(...t)=>{g.state.espionagem&&console.log(...t)},Z=t=>{g.state.espionagem&&console.count(t)},ee=(...t)=>{g.state.espionagem&&console.error(...t)},te={male:"Ã© homem",female:"Ã© mulher",caucasian:"Ã© branco(a)",black:"Ã© negro(a)",asian:"Ã© asiÃ¡tico(a)",latino:"Ã© latino(a)",thin:"Ã© magrelo(a)",fat:"Ã© gordo(a)",large:"Ã© gordo(a)",tall:"Ã© alto(a)",short:"Ã© baixinho(a)",young:"Ã© jovem",adult:"Ã© adulto(a)",senior:"Ã© da terceira idade",average:"tem corpo normal",medium:"Ã© de altura mÃ©dia",mixed:"Ã© mestiÃ§o(a)",hat:"estÃ¡ usando um chapÃ©u",tie:"estÃ¡ usando uma gravata",glasses:"estÃ¡ usando Ã³culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",scarf:"estÃ¡ usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"Ã© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"Ã© sarado(a)",blackHair:"tem cabelo preto",hoodie:"estÃ¡ usando um moletom",earrings:"estÃ¡ usando brincos",lipstick:"estÃ¡ usando batom",necklace:"estÃ¡ usando um colar",mediumHair:"tem cabelo mÃ©dio","middle-eastern":"Ã© do Oriente MÃ©dio",headscarf:"estÃ¡ usando um lenÃ§o na cabeÃ§a",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"Ã© indiano(a)","native-american":"Ã© nativo-americano(a)",noAccessories:"estÃ¡ sem nenhum acessÃ³rio",avoidingCamera:"estÃ¡ evitando olhar para a cÃ¢mera",wearingStripes:"tem listras na roupa",blackClothes:"estÃ¡ vestindo roupas pretas",blueClothes:"estÃ¡ vestindo roupas azuis",greenClothes:"estÃ¡ vestindo roupas verdes",redClothes:"estÃ¡ vestindo roupas vermelhas",yellowClothes:"estÃ¡ vestindo roupas amarelas",purpleClothes:"estÃ¡ vestindo roupas roxas",orangeClothes:"estÃ¡ vestindo roupas laranjas",brownClothes:"estÃ¡ vestindo roupas marrons",whiteShirt:"estÃ¡ usando camisa branca",pinkClothes:"estÃ¡ vestindo roupas rosas",patternedShirt:"estÃ¡ usando roupa estampada",buttonShirt:"estÃ¡ usando camisa com botÃµes",bow:"estÃ¡ usando um laÃ§o",hairyChest:"tem peito peludo",wearingFlowers:"estÃ¡ usando flores",showTeeth:"estÃ¡ mostrando os dentes",hairTie:"estÃ¡ usando um xuxinha ou fita no cabelo","non-binary":"Ã© nÃ£o-binÃ¡rio(a)"},R=12,we=(t,e,s,a)=>{const[o]=Q(z.ESPIONAGEM,a),i=F("suspects",t),r=F(`testimony-questions-${e}`,t),u=F("testimony-answers",t),n=F("crime-reasons",t),m=L.useMemo(()=>re(u.data),[u.dataUpdatedAt]),c=L.useMemo(()=>ie(i.data),[i.data]);return{entries:L.useMemo(()=>!t||!o||!i.isSuccess||!r.isSuccess||!u.isSuccess||!n.isSuccess?{}:se(s,o,i.data,r.data,m,c,n.data),[t,o,i,r,u,s,m,c,n]),isLoading:i.isLoading||r.isLoading||u.isLoading}},se=(t,e,s,a,o,i,r)=>{Z("Creating Espionagem...");let u=e.latestDate;const n=[],m={};for(let c=0;c<t;c++){const f=W(u);u=f;let h=null,l=0;for(;h===null&&l<P;)try{l++;const d=oe(s,a,o,i,n,r);if(de(d.statements))throw h=d,new Error(`Game is invalid after ${l} attempts`)}catch{}if(!h)throw new Error(`Failed to generate valid game for ${f} after ${l} attempts`);p(`Generated valid game for ${f} after ${l} attempts`),n.push(h.culpritId),m[f]={id:f,type:"espionagem",number:e.latestNumber+c+1,...h}}return m};function oe(t,e,s,a,o,i){const r=[],u={};p("SuspectTestimonyAnswers",s);const{selectedTestimonyId1:n,selectedTestimonyId2:m,culpritId:c,possibleSuspects:f,impossibleSuspects:h}=ce(s,o);if(f.length<2)throw new Error("Not enough possible suspects");let l=[...f];if(f.length<R-1){const C=b.sampleSize(Object.keys(t).filter(M=>!h.includes(M)&&!f.includes(M)),R-f.length-1);l.push(...C)}const d={};Object.keys(a).forEach(C=>{if(a[C][c]===void 0){const M=Object.keys(a[C]).filter(T=>l.includes(T));if(M.length>0){const T={};M.forEach(A=>{l.includes(A)&&(T[A]=!0)}),d[C]=T}}});const y=e[n],O=_(c,l,y,s[n]);r.push(O),I(u,O.excludes);const E=e[m],x=_(c,l,E,s[m]);r.push(x),I(u,x.excludes);const w=q(c,l,d,[],"best");if(w.excludes.length===R-2)throw new Error("Best feature statement excludes too many suspects");r.push(w),I(u,w.excludes);const k=q(c,l,d,[w],"best");r.push(k);const j=q(c,l,d,[w,k],"worst");r.push(j),I(u,j.excludes);const H=q(c,l,d,[w,k,j],"worst");if(r.push(H),r.length<6)throw new Error("Not enough statements generated");l=b.shuffle([...l,c]);const v=G(c,l,r,"columns");r.push(v),I(u,v.excludes);const D=G(c,l,r,"rows");r.push(D);const $=[O,j,x,w,v,H],N=[k,D],S=me(t[c],i),B=ae([...$,...N]);return{isNsfw:y.nsfw||E.nsfw||!1,culpritId:c,statements:$,additionalStatements:N,suspects:ne(l,t,B),reason:S.title,setId:`${c}::${S.id}::${$[0].key}`,level:fe($)}}const ae=t=>{const e={};t.forEach(a=>{if(a.key.includes(".feature.")){const o=a.key.split("not.feature.")[1];e[o]=!0}});const s={hairColor:["brownHair","blondeHair","greyHair","redHair","blackHair","coloredHair"],hairLength:["shortHair","mediumHair","longHair","bald"],facialHair:["beard","mustache","goatee"]};for(const[,a]of Object.entries(s))a.some(o=>e[o])&&a.forEach(o=>{e[o]=!0});return e},ne=(t,e,s)=>t.map(a=>{const o=e[a],i={"18-21":"young","21-30":"adult","30-40":"adult","40-50":"adult","50-60":"senior","60-70":"senior","70-80":"senior","80-90":"senior"}[o.age]||o.age,r=[o.gender,i,o.ethnicity,o.height,o.build],u=o.features.filter(n=>s[n]);return{id:o.id,name:o.name,gender:o.gender,features:[...r,...u]}}),re=t=>{const e={};p("âš™ï¸ Calculating suspect answers...");for(const s of Object.keys(t)){const a=t[s];for(const o of Object.keys(a)){const{resolution:i,projection:r}=K(o,s,a);if(!(!i&&!r)){if(e[s]===void 0&&(e[s]={}),i){e[s][o]=i==="ðŸ‘";continue}r&&(e[s][o]=r==="ðŸ‘")}}}return Object.keys(e).forEach(s=>{b.isEmpty(e[s])&&delete e[s]}),Object.keys(e).forEach(s=>{Object.keys(e[s]).length<3&&(p("â‰ï¸ Removing testimonies with less than 3 answers"),delete e[s])}),Object.keys(e).forEach(s=>{b.uniq(Object.values(e[s])).length===1&&(p("â‰ï¸ Removing testimonies with the same answer"),delete e[s])}),e},ie=t=>{const e={};for(const a of Object.keys(t)){const{gender:o,ethnicity:i,age:r,build:u,height:n,features:m}=t[a];if(!u){p("â‰ï¸ Ignoring suspect with missing build",a);continue}if(!n){p("â‰ï¸ Ignoring suspect with missing height",a);continue}if(!m||m.length===0){p("â‰ï¸ Ignoring suspect with missing features",a);continue}e[o]===void 0&&(e[o]={}),e[o][a]=!0,e[i]===void 0&&(e[i]={}),e[i][a]=!0,e[r]===void 0&&(e[r]={}),e[r][a]=!0,e[u]===void 0&&(e[u]={}),e[u][a]=!0,e[n]===void 0&&(e[n]={}),e[n][a]=!0,m.forEach(c=>{e[c]===void 0&&(e[c]={}),e[c][a]=!0})}return e.young=b.cloneDeep(e["18-21"]),e.adult=b.cloneDeep({...e["21-30"],...e["30-40"],...e["40-50"]}),e.senior=b.cloneDeep({...e["50-60"],...e["60-70"],...e["70-80"],...e["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(a=>{delete e[a]}),e},ce=(t,e)=>{let s=0,a,o,i=[];for(;s<P&&!o&&i.length===0;){if(s++,a=b.sample(Object.keys(t)),!a)throw new Error("Failed to find a testimony");const c=Object.keys(t[a]);if(o=b.sample(Object.keys(t).filter(f=>f!==a&&!b.isEmpty(b.difference(c,Object.keys(t[f]))))),o){i=b.intersection(Object.keys(t[a]),Object.keys(t[o]));break}}if(!a||!o||i.length<3)throw new Error("Failed to find two related testimonies");const r=b.sample(i.filter(c=>!e.includes(c)));if(!r)throw new Error("Failed to determine a culprit from common suspects");p("<===============>"),p(`âš™ï¸ Selected testimonies 1: ${a}`),p(t[a]),p(`âš™ï¸ Selected testimonies 2: ${o}`),p(t[o]),p(`âš™ï¸ Culprit ID: ${r}`),p(`Testimony 1 answers: ${t[a][r]}`),p(`Testimony 2 answers: ${t[o][r]}`);const u=`${t[a][r]}-${t[o][r]}`,n=b.sampleSize(i.filter(c=>c!==r&&`${t[a][c]}-${t[o][c]}`!==u),R-1),m=b.difference(i,n);return p(`âš™ï¸ Possible suspects: ${n.join(", ")}`),p(`âš™ï¸ Impossible suspects: ${m.join(", ")}`),p(`âš™ï¸ Attempts made: ${s}`),p(">===============<"),{selectedTestimonyId1:a,selectedTestimonyId2:o,culpritId:r,possibleSuspects:n,impossibleSuspects:m}},I=(t,e)=>{e.forEach(s=>{t[s]===void 0&&(t[s]=0),t[s]++})},_=(t,e,s,a)=>{const o=a[t],i=e.filter(n=>a[n]!==void 0&&a[n]!==o),r=s.answer.charAt(0).toLowerCase()+s.answer.slice(1),u={key:`testimony.${s.id}`,text:`O(a) suspeito(a) ${o?"":"nÃ£o "}${r}`,excludes:i,type:"testimony"};return u.text.includes("nÃ£o jÃ¡")&&(u.text=u.text.replace("nÃ£o jÃ¡","nunca")),u},ue={column1:{indexes:[0,4,8],text:"na primeira coluna"},column2:{indexes:[1,5,9],text:"na segunda coluna"},column3:{indexes:[2,6,10],text:"na terceira coluna"},column4:{indexes:[3,7,11],text:"na quarta coluna"},corners:{indexes:[0,3,8,11],text:"nos cantos"}},le={row1:{indexes:[0,1,2,3],text:"na primeira linha"},row2:{indexes:[4,5,6,7],text:"na segunda linha"},row3:{indexes:[8,9,10,11],text:"na terceira linha"}},G=(t,e,s,a)=>{const o=e.indexOf(t),i=s.slice(0,3),r=a==="rows"?le:ue,u={};for(const l of Object.keys(r)){const{indexes:d}=r[l];d.includes(o)||(u[l]=d.reduce((y,O)=>{const E=e[O],x=i.filter(w=>w.excludes.includes(E)).length;return x>0?y+x:y},0))}const n=Object.entries(u).reduce((l,[d,y])=>(l[y]||(l[y]=[]),l[y].push(d),l),{}),m=Math.min(...Object.keys(u).map(l=>u[l])),c=n[m.toString()],f=b.sample(c)||Object.keys(u)[0],h=r[f].indexes.map(l=>e[l]);return{key:`not.grid.${f}`,text:`O(a) suspeito(a) nÃ£o estÃ¡ ${r[f].text}`,excludes:h,type:"grid"}},q=(t,e,s,a=[],o="best")=>{const i=b.difference(e,[t]),r=a.filter(d=>d.key.startsWith("not.feature.")).map(d=>d.key.replace("not.feature.","")),u=new Set(a.flatMap(d=>d.excludes)),n=Object.keys(s).filter(d=>Object.keys(s[d]).length<=6&&!r.includes(d)).sort((d,y)=>Object.keys(s[y]).length-Object.keys(s[d]).length);let m,c=[],f=0;const h=500;for(;f<h;){f++;const d=o==="best"?n[0]:b.sample(n.slice(2,5))??n[2];if(!d)break;const y=i.filter(E=>s[d][E]);if(y.some(E=>!u.has(E))||f===h){m=d,c=y;break}n.splice(n.indexOf(d),1)}if(!m)throw Error(`No suitable feature found for ${o} selection after ${h} attempts`);p(`Selected feature after ${f} attempts: ${m}`);const l=te[m];return l||ee(`Feature ${m} not found in translations`),{key:`not.feature.${m}`,text:`O(a) suspeito(a) nÃ£o ${l||m}`,excludes:c,type:"feature"}},de=t=>{const e=t.slice(0,3);return e.reduce((o,i)=>o+i.excludes.length,0)<10?!1:new Set(e.flatMap(o=>o.excludes)).size===R-1},me=(t,e)=>{const s=[];Object.values(e).forEach(o=>{o.feature==="general"&&s.push(o),t.features?.includes(o.feature)&&s.push(o)});const a=b.sample(s);return a||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},fe=t=>{const e=t.slice(0,3),s=[],a={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};e.forEach(i=>{const r=i.excludes.length;a[r]!==void 0&&s.push(a[r])});const o=Math.round(s.reduce((i,r)=>i+r,0)/s.length);return Math.min(Math.max(o,1),3)};function Oe(){const t=F("suspects"),e=F("testimony-questions-pt"),s=Y({tdrResourceName:"testimony-answers",firestoreDataCollectionName:"testimonies",serialize:!0});return{...s,isLoading:s.isLoading||e.isLoading||t.isLoading,isSuccess:s.isSuccess&&e.isSuccess&&t.isSuccess,error:s.error||e.error||t.error,questions:e.data,suspects:t.data,hasNewData:s.hasFirestoreData}}const ke=t=>t.reduce((e,s)=>{const a=Math.abs(s);return a?e+a:e},0);export{Ee as a,K as b,ke as c,g as d,Oe as e,xe as n,Se as t,we as u};
