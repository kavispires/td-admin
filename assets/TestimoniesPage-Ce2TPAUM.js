import{r as h,a as T,_ as C,j as s,P as E,L as v}from"./index-JWAGMJpb.js";import{D as O}from"./DataLoadingWrapper-CCi4PeI-.js";import{P as F}from"./useBaseUrl-B9wI_6Pe.js";import{u as D}from"./useQueryParams-CT50qqcq.js";import{I as R}from"./ImageCard-BkaSb9qr.js";import{u as S}from"./useTableExpandableRows-DSFjd4GG.js";import{u as M}from"./useTablePagination-BERzTu2_.js";import{l as f}from"./lodash-CRtbtrxq.js";import{S as y}from"./index-CL5f_UtC.js";import{F as w}from"./Table-Bxe-ghl2.js";import{F as N}from"./index-uw4G1lDP.js";import{P as b}from"./progress-BfzOVZMz.js";import{T as P}from"./index-CmeM8N_j.js";import{u as I}from"./useCardWidth-D6InmqYc.js";import{R as L}from"./FireFilled-BW6XhD48.js";import{F as z}from"./FilterEntries-l4yWlRaU.js";import{S as k}from"./SiderContent-CX4jJHAg.js";import{D as Q}from"./DownloadButton-BXZQBMwa.js";import{a as H,d as A,e as B}from"./index-IknmYcnY.js";import{R as $}from"./TableOutlined-Co6s5PTl.js";import{u as q}from"./useGetFirebaseDoc--1sFOsL1.js";import{u as j}from"./useTDResource-C1Vu1dm2.js";import"./gapSize-U1swVQyS.js";import"./index-DxQT68k9.js";import"./index-Buyqji-I.js";import"./index-CbPxEepB.js";import"./index-C50j3otf.js";import"./scrollTo-DtoYfhRq.js";import"./Pagination-Cte7O8Ba.js";import"./extendsObject-keMuGWqj.js";import"./Input-BhUkDnUD.js";import"./useMeasure-BrHQBzW8.js";import"./util-CeAI_f06.js";import"./index-CGnPJCBB.js";import"./index-Df29ZO3S.js";import"./constants-DuHnCtza.js";import"./Item-BnpQ11CJ.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M594.3 601.5a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1 8 8 0 008 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"}}]},name:"contacts",theme:"outlined"},W=function(o,a){return h.createElement(T,C({},o,{ref:a,icon:K}))},J=h.forwardRef(W);function V({suspect:r,answersPerQuestion:o,questions:a}){console.log(o);const c=h.useMemo(()=>f.orderBy(Object.keys(o).map(t=>{const n=a[t],i=o[t],u=i.length>2,d=i.length,e=Math.max(i.length,5),l=Math.round(i.filter(p=>p===1).length/e*100),g=Math.round(i.filter(p=>p===0).length/e*100),x=Math.round((e-l+g)/e*100);return{id:t,question:n,enoughData:u,reliability:d,yesPercentage:l,noPercentage:g,blankPercentage:x}}),["reliability","enoughData","yesPercentage"],["desc","desc","desc"]),[o,a]),m=[{key:"id",title:"Id",dataIndex:"id"},{key:"question",title:"Question",dataIndex:"question",render:t=>t.question},{key:"answer",title:"Answer",dataIndex:"id",sorter:(t,n)=>t.reliability-n.reliability,render:t=>{const n=c.find(i=>i.id===t);return n?s.jsxs(N,{children:[s.jsx(b,{percent:n.noPercentage,size:n.enoughData?[100,20]:[100,10],status:n.enoughData?"exception":"active",success:{percent:n.yesPercentage},showInfo:!1}),n.yesPercentage>=n.noPercentage?s.jsxs(P,{color:"green-inverse",children:[n.yesPercentage,"% Yes"]}):s.jsxs(P,{color:"red-inverse",children:[n.noPercentage,"% No"]})]}):""}}];return s.jsx(y,{wrap:!0,size:"large",children:s.jsx(w,{rowKey:"id",columns:m,dataSource:c,bordered:!0})})}function _({isLoading:r,isSuccess:o,questions:a,data:c,suspects:m}){const t=h.useMemo(()=>Object.keys(c).reduce((e,l)=>{const g=c[l]??{};return Object.keys(g).forEach(x=>{const p=`us-${x.split("-")[2]}`;e[p]||(e[p]={}),e[p][l]=g[x]}),e},{}),[c]),n=h.useMemo(()=>f.orderBy(Object.values(m),e=>Number(e.id.split("-")[1]),"asc"),[m]),i=M({total:n.length,showQuickJumper:!0}),u=[{title:"Id",dataIndex:"id",key:"id",sorter:(e,l)=>Number(e.id.split("-")[1])-Number(l.id.split("-")[1])},{title:"Picture",dataIndex:"id",render:e=>{const l=e.split("-").join("-ct-");return s.jsx(R,{id:l,width:48})}},{title:"Name",dataIndex:"name",key:"name",sorter:(e,l)=>e.name.pt.localeCompare(l.name.pt),render:e=>e.pt},{title:"Answers",dataIndex:"id",key:"answers",render:e=>{const l=t[e];return l?Object.values(l).length:""}}],d=S({maxExpandedRows:1,expandedRowRender:e=>s.jsx(V,{suspect:e,answersPerQuestion:t[e.id],questions:a}),rowExpandable:()=>o});return s.jsx(w,{columns:u,dataSource:n,pagination:i,rowKey:"id",expandable:d,loading:r,bordered:!0,className:"full-width"})}function G({answers:r,suspects:o}){const[a,c]=I(12),m=h.useMemo(()=>f.orderBy(Object.keys(r??{}).map(t=>{const n=`us-${t.split("-")[2]}`,i=r[t],u=i.length>2,d=i.length>4,e=Math.max(i.length,5),l=Math.round(i.filter(p=>p===1).length/e*100),g=Math.round(i.filter(p=>p===0).length/e*100),x=Math.round((e-l+g)/e*100);return{imageId:t,suspectCardId:n,enoughData:u,reliability:d,yesPercentage:l,noPercentage:g,blankPercentage:x}}),["reliability","enoughData","percentage"],["desc","desc","desc"]),[r]);return s.jsx(y,{wrap:!0,ref:c,size:"large",children:m.map(t=>s.jsxs(N,{vertical:!0,gap:4,children:[s.jsx(R,{id:t.imageId,width:a,className:t.enoughData?void 0:"grayscale"}),s.jsx("div",{children:o[t.suspectCardId].name.pt}),t.enoughData?s.jsx(b,{percent:t.noPercentage,size:[a,20],status:"exception",success:{percent:t.yesPercentage},showInfo:!1}):s.jsx(b,{percent:t.noPercentage,size:[a,10],status:"active",success:{percent:t.yesPercentage},showInfo:!1})]},t.suspectCardId))})}function Y({data:r,questions:o,suspects:a,isLoading:c,isSuccess:m}){const t=h.useMemo(()=>f.orderBy(Object.values(o),d=>Number(d.id.split("-")[1]),"asc"),[o]),n=M({total:t.length,showQuickJumper:!0}),i=[{title:"Id",dataIndex:"id",key:"id",sorter:(d,e)=>Number(d.id.split("-")[1])-Number(e.id.split("-")[1])},{title:"Question",dataIndex:"question",key:"question",sorter:(d,e)=>d.question.localeCompare(e.question)},{title:"NSFW",dataIndex:"nsfw",key:"nsfw",render:d=>d?s.jsx(L,{style:{color:"hotPink"}}):"",sorter:(d,e)=>Number(d.nsfw)-Number(e.nsfw)},{title:"Answers",dataIndex:"id",key:"answers",render:d=>{const e=r[d];return e?Object.values(e).length:""}}];console.log(t);const u=S({maxExpandedRows:1,expandedRowRender:d=>s.jsx(G,{answers:r[d.id]??{},suspects:a}),rowExpandable:()=>m});return s.jsx(y,{direction:"vertical",children:s.jsx(w,{columns:i,dataSource:t,pagination:n,rowKey:"id",expandable:u,loading:c,bordered:!0,className:"full-width"})})}function U(r){const{queryParams:o,is:a}=D();return console.log(o.get("display")),s.jsxs(y,{direction:"vertical",children:[(a("display","questions")||!o.get("display"))&&s.jsx(Y,{...r}),a("display","suspects")&&s.jsx(_,{...r})]})}function X({data:r}){const{queryParams:o,addParams:a}=D();return s.jsxs(s.Fragment,{children:[s.jsx(k,{children:s.jsx(Q,{data:()=>Z(r),fileName:"testimony-answers.json",block:!0})}),s.jsx(k,{children:s.jsx(z,{label:"Display",value:o.get("display")??"questions",onChange:c=>a({display:c,page:1},{page:1}),options:[{title:"Questions",icon:s.jsx($,{}),value:"questions"},{title:"Suspects",icon:s.jsx(J,{}),value:"suspects"}]})})]})}function Z(r){return console.log("Preparing file for download..."),H(A(r))}function ee(){const r=j("suspects"),o=j("testimony-questions-pt"),a=j("placeholder"),c=q("data","testimonies",{select:B}),m=h.useMemo(()=>{if(!a.data||!c.data)return{};const t=f.cloneDeep(a.data);return Object.keys(c.data).forEach(n=>{const i=c.data[n];if(t[n]===void 0){t[n]=i;return}Object.keys(i).forEach(u=>{t[n][u]===void 0?t[n][u]=i[u]:(console.log("merging",n,u),t[n][u].push(...i[u]))})}),t},[a.data,c.data]);return{isLoading:a.isLoading||c.isLoading||o.isLoading||r.isLoading,isSuccess:a.isSuccess&&c.isSuccess&&o.isSuccess&&r.isSuccess,error:a.error||c.error,data:m,questions:o.data,suspects:r.data}}function Qe(){const r=ee();return console.log(r.data),s.jsx(E,{title:"Testimonies",subtitle:"Suspect Testimony Rates",children:s.jsxs(v,{hasSider:!0,children:[s.jsx(F,{children:s.jsx(X,{...r})}),s.jsx(v.Content,{className:"content",children:s.jsx(O,{isLoading:r.isLoading,error:r.error,hasResponseData:!f.isEmpty(r.data),children:s.jsx(U,{...r})})})]})})}export{Qe as TestimoniesPage,Qe as default};
