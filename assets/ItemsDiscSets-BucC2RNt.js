import{r as h,a as M,_ as $,j as e,T as y,B as v,D as q,P as Q,L as N}from"./index-CCPCqmwn.js";import{D as J}from"./DataLoadingWrapper-DYVUL6Fk.js";import{I as O}from"./Item-CtMuIS_J.js";import{u as P}from"./useQueryParams-DscI9L68.js";import{l as x,P as W}from"./useBaseUrl-BFZattM8.js";import{u as _}from"./useCopyToClipboardFunction-BDyBpcj_.js";import{u as E}from"./useTDResource-BwAXVVPu.js";import{u as K}from"./useTableExpandableRows-Bzg66QYI.js";import{u as G}from"./useTablePagination-DH9g9wHM.js";import{r as b,i as w,h as H,a as X}from"./index-DfZEHWc_.js";import{C as Y}from"./CopyIdsButton-CqKGrbe5.js";import{I as V}from"./InspirationSample-aI5j5DoT.js";import{I as Z}from"./ItemsTypeahead-xTU7mWCt.js";import{I as F}from"./index-DnnWv706.js";import{F as g}from"./index-CL2_8Yc_.js";import{F as R}from"./Table-Blwd8CG9.js";import{S as A}from"./index-1vF1OoDf.js";import{P as U}from"./index-C-acapna.js";import{R as ee}from"./DeleteFilled-CqWCgRPv.js";import{T as te}from"./TransparentButton-CIiXSjnW.js";import{u as se,P as re}from"./useGridPagination-Dx-aqe4-.js";import{S as ne}from"./index-Br7RFtJ1.js";import{D as oe}from"./index-Bs_F0O6B.js";import{S as ae}from"./index-Bi3nZmoQ.js";import{T as ie}from"./index-DylneJw_.js";import{F as le}from"./FilterEntries-DWt1NKTA.js";import{S as me}from"./SiderContent-5xS73I4L.js";import{D as ce}from"./DownloadButton-C_dAOCHp.js";import{S as de}from"./SaveButton-C94s-XBZ.js";import{L as B}from"./LanguageFlag-4xEJlq4D.js";import{F as I}from"./index-Cb0F2SWn.js";import{M as pe}from"./index-CF1ONuMX.js";import{R as ue}from"./TableOutlined-DlXR9G2b.js";import{u as he}from"./useResourceFirestoreData-DMXUytrV.js";import"./constants-mMo-QEqz.js";import"./SyncOutlined-CW_-Gy2C.js";import"./PlusOutlined-C1GWp2sD.js";import"./PlusOutlined-ByZyTB3m.js";import"./useDebounce-B0j3DUcN.js";import"./Input-DgNQyC7W.js";import"./gapSize-U1swVQyS.js";import"./index-NVZJvXHE.js";import"./index-vv4QFTLm.js";import"./index-CF1GbRTU.js";import"./scrollTo-B-2Ph30b.js";import"./Pagination-BfoenvKU.js";import"./extendsObject-keMuGWqj.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-Db7L5lLZ.js";import"./useGetFirestoreDoc-Ds9zYP1E.js";import"./useUpdateFirestoreDoc-BO7v8zZq.js";import"./useMutation-BYHBckkd.js";var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM512 533c-85.5 0-155.6 67.3-160 151.6a8 8 0 008 8.4h48.1c4.2 0 7.8-3.2 8.1-7.4C420 636.1 461.5 597 512 597s92.1 39.1 95.8 88.6c.3 4.2 3.9 7.4 8.1 7.4H664a8 8 0 008-8.4C667.6 600.3 597.5 533 512 533z"}}]},name:"frown",theme:"outlined"},fe=function(s,n){return h.createElement(M,$({},s,{ref:n,icon:xe}))},je=h.forwardRef(fe);function ge({onUpdateBatch:t}){const[s,n]=h.useState(""),a=()=>{try{const c=s.replace(/^\[|\]$/g,"").split(/\s*,\s*/).map(i=>i.replace(/^"|"$/g,"")).filter(Boolean);t(c),n("")}catch(r){console.error(r)}};return e.jsxs(y.Paragraph,{children:["Paste IDs",e.jsx(F.TextArea,{value:s,onChange:r=>n(r.target.value)}),e.jsx(v,{size:"small",onClick:a,children:"Add"})]})}function Se({disc:t,addEntryToUpdate:s}){const n=r=>{s(t.id,{...t,itemsIds:b(w([...t.itemsIds,r]))})},a=r=>{s(t.id,{...t,itemsIds:b(w([...t.itemsIds,...r]))})};return e.jsxs(g,{gap:16,children:[e.jsxs("div",{children:[e.jsx(y.Paragraph,{children:"Add Item"}),e.jsx(Z,{onFinish:n})]}),e.jsx(V,{onSelect:n,excludeList:t.itemsIds}),e.jsx(ge,{onUpdateBatch:a})]})}function ye(t){return x.orderBy(t,[s=>s.title.en]).map(s=>({...s,itemsIds:x.orderBy(s.itemsIds,n=>Number(n))}))}function Ce({data:t,addEntryToUpdate:s}){const n=E("items"),a=h.useMemo(()=>ye(Object.values(t)),[t]),r=_(),c=G({total:a.length,showQuickJumper:!0}),i=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,l)=>o.title.en.localeCompare(l.title.en)},{title:"Title",dataIndex:"title",key:"title",sorter:(o,l)=>o.title.en.localeCompare(l.title.en),render:(o,l)=>e.jsx(be,{value:o,disc:l,addEntryToUpdate:s})},R.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(o,l)=>e.jsx(we,{disc:l,itemsIds:w(o),copyToClipboard:r,addEntryToUpdate:s})},{title:"Count",dataIndex:"itemsIds",key:"count",render:o=>b(o).filter(Boolean).length}],u=K({maxExpandedRows:1,expandedRowRender:o=>e.jsx(Se,{disc:o,addEntryToUpdate:s}),rowExpandable:()=>n.isSuccess});return e.jsx(A,{direction:"vertical",children:e.jsx(R,{columns:i,dataSource:a,pagination:c,rowKey:"id",expandable:u})})}function Ie({disc:t,addEntryToUpdate:s,itemId:n}){const a=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(r=>r!==n)})};return e.jsx(U,{title:"Are you sure you want to remove this item?",onConfirm:a,okText:"Yes",cancelText:"No",children:e.jsx(v,{icon:e.jsx(ee,{}),size:"small",type:"text"})})}function be({value:t,disc:s,addEntryToUpdate:n}){const a=(r,c)=>{n(s.id,{...s,title:{...s.title,[c]:r}})};return e.jsxs(A,{direction:"vertical",size:"small",children:[e.jsx(y.Text,{editable:{onChange:r=>a(r,"pt")},children:String(t.pt)}),e.jsx(y.Text,{editable:{onChange:r=>a(r,"en")},children:String(t.en)})]})}function we({disc:t,itemsIds:s,copyToClipboard:n,addEntryToUpdate:a}){return e.jsxs(g,{gap:6,wrap:"wrap",children:[s.map((r,c)=>e.jsxs(g,{gap:2,vertical:!0,children:[e.jsx(O,{id:r,width:60}),e.jsxs(g,{justify:"center",children:[e.jsx(y.Text,{onClick:()=>n(r),children:r}),e.jsx(Ie,{disc:t,addEntryToUpdate:a,itemId:r})]})]},`${t.title}-${r}-${c}`)),e.jsx(Y,{ids:s})]},`items-${t.title}`)}function ve({data:t,addEntryToUpdate:s}){const{is:n,addParam:a}=P(),r=E("items"),[c,i]=h.useMemo(()=>{if(r.data){const p=Object.values(t).reduce((d,S)=>(S.itemsIds.forEach(k=>{d[k]||(d[k]=[]),d[k].push(S.id)}),d),{});Object.keys(r.data).reduce((d,S)=>(d[S]===void 0&&(d[S]=[]),d[S].push(S),d),{});const T=["black","blue","brown","green","orange","pink","purple","red","white","yellow"],L=Object.keys(r.data).filter(d=>p[d]===void 0||p[d].length===1&&T.includes(p[d][0])).map(d=>r.data[d]);return[p,L]}return[{},[]]},[t,r.data]),u=n("onlyOrphans"),{page:o,pagination:l}=se({data:u?i:Object.values(r.data),defaultPageSize:64,resetter:u?"orphans":"all"}),[f,j]=h.useState(null),[m,C]=h.useState(null),D=h.useMemo(()=>Object.values(t).sort((p,T)=>p.title.pt.localeCompare(T.title.pt)),[t]);return e.jsxs(e.Fragment,{children:[e.jsxs(y.Title,{level:4,children:["Orphan Items (",i.length,")"]}),e.jsx(A,{className:"mb-4",children:e.jsx(ne,{checkedChildren:"Only Orphans",unCheckedChildren:"All Items",onChange:p=>a("onlyOrphans",p,!1)})}),e.jsx(oe,{title:"Add Item to Set",open:!!f,onClose:()=>j(null),children:!!f&&e.jsx(De,{activeItem:f,activeItemSets:(c==null?void 0:c[f])??[],latestSetId:m,setLatestSetId:C,sortedSets:D,data:t,addEntryToUpdate:s})}),e.jsx(re,{pagination:l,className:"full-width",children:e.jsx(g,{gap:16,wrap:"wrap",children:o.map(p=>e.jsx(te,{onClick:()=>j(p.id),children:e.jsx(O,{id:p.id})},p.id))})})]})}function De({activeItem:t,activeItemSets:s,setLatestSetId:n,sortedSets:a,data:r,addEntryToUpdate:c}){const[i,u]=h.useState(s);if(!t)return null;const o=m=>{u(m)},l=m=>{u(C=>C.includes(m)?C.filter(D=>D!==m):[...C,m])},f=()=>{i.forEach(m=>{c(m,{...r[m],itemsIds:[...r[m].itemsIds,t]})}),n(i[i.length-1])},j=a.map(m=>({value:m.id,label:m.title.pt}));return e.jsxs(g,{vertical:!0,gap:16,children:[e.jsx(O,{id:t}),e.jsx(v,{type:"primary",onClick:f,disabled:x.isEqual(s,i),children:"Save to Sets"}),e.jsx(ae,{onChange:o,mode:"tags",value:i,options:j}),e.jsx(g,{wrap:"wrap",gap:8,children:a.map(m=>e.jsx(ie,{onClick:()=>l(m.id),color:i.includes(m.id)?"gold":void 0,children:m.title.pt},m.id))})]})}function Te({data:t,addEntryToUpdate:s}){const{is:n,queryParams:a}=P();return e.jsxs(e.Fragment,{children:[(n("display","sets")||!a.has("display"))&&e.jsx(Ce,{data:t,addEntryToUpdate:s}),(n("display","orphans")||!a.has("display"))&&e.jsx(ve,{data:t,addEntryToUpdate:s})]})}function ke({addEntryToUpdate:t,ids:s}){const[n,a]=h.useState(!1),[r]=I.useForm(),c=o=>{const l=x.camelCase(o.name);t(x.camelCase(l),{id:l,title:{pt:o.nome,en:o.name},itemsIds:[]})},i=I.useWatch("name",r),u=h.useMemo(()=>{const o={};if(i&&i.length>2){const l=x.camelCase(i);if(l)try{H.findBestMatch(l,s).ratings.forEach(j=>{j.rating>.4&&(o[j.target]=j.rating)})}catch(f){console.error(f)}}return Object.keys(o)},[i,s]);return e.jsxs(e.Fragment,{children:[e.jsx(v,{type:"dashed",block:!0,onClick:()=>a(!0),children:"Add New Set"}),e.jsxs(pe,{title:"Add New Set",open:n,onOk:r.submit,onCancel:()=>a(!1),maskClosable:!1,okText:"Add",okButtonProps:{htmlType:"submit"},children:[e.jsxs(I,{form:r,onFinish:c,children:[e.jsx(I.Item,{name:"nome",label:"Nome",rules:[{required:!0}],children:e.jsx(F,{prefix:e.jsx(B,{language:"pt",width:"1em"}),placeholder:"Name in pt",size:"small"})}),e.jsx(I.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(F,{prefix:e.jsx(B,{language:"en",width:"1em"}),placeholder:"Name in en",size:"small"})})]}),e.jsx(y.Text,{children:"Similar:"}),e.jsx("ul",{children:u.map(o=>e.jsx("li",{children:o},o))})]})]})}function Fe({data:t,save:s,isDirty:n,isSaving:a,entriesToUpdate:r,addEntryToUpdate:c,hasFirestoreData:i}){const{queryParams:u,addParams:o}=P();return e.jsxs(me,{children:[e.jsxs(g,{vertical:!0,gap:12,children:[e.jsx(de,{isDirty:n,onSave:s,isSaving:a,dirt:JSON.stringify(z(r))}),e.jsx(ce,{data:()=>Oe(t),fileName:"daily-disc-sets.json",disabled:n,hasNewData:i,block:!0})]}),e.jsx(q,{}),e.jsx(le,{label:"Display",value:u.get("display")??"sets",onChange:l=>o({display:l,page:1},{page:1,display:"table"}),options:[{title:"Sets",icon:e.jsx(ue,{}),value:"sets"},{title:"Orphan Items",icon:e.jsx(je,{}),value:"orphans"}]}),e.jsx(ke,{addEntryToUpdate:c,ids:Object.keys(t)})]})}function z(t){return x.omitBy(x.cloneDeep(t),s=>x.isEmpty(s.itemsIds))}function Oe(t){return Object.keys(t).forEach(s=>{t[s].itemsIds=w(b(t[s].itemsIds))}),X(z(t))}function Ft(){const t=he({tdrResourceName:"daily-disc-sets",firestoreDataCollectionName:"discSets",serialize:!0});return e.jsx(Q,{title:"Items",subtitle:"Disc Sets",children:e.jsxs(N,{hasSider:!0,children:[e.jsx(W,{children:e.jsx(Fe,{...t})}),e.jsx(N.Content,{className:"content",children:e.jsx(J,{isLoading:t.isLoading||t.isSaving,error:t.error,hasResponseData:!x.isEmpty(t.data),children:e.jsx(Te,{...t})})})]})})}export{Ft as ItemsDiscSets,Ft as default};
