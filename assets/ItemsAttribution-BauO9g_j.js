import{r as p,X as Ct,ac as St,Y as pe,a0 as Be,Z as At,$ as Et,a1 as Tt,ad as Re,c as xe,y as De,g as wt,m as Pt,e as Nt,d as $t,K as Rt,a6 as Ot,C as kt,x as Lt,ae as Dt,F as Ut,a9 as Ae,af as Mt,a as re,_ as se,O as Ue,N as Vt,j as t,ag as Ft,T as L,D as K,B as R,J as Bt,ah as _t,ai as zt,aa as tt,aj as Gt,ak as Wt,al as Qt,P as Kt,L as _e}from"./index-BeoNBKs9.js";import{D as Xt}from"./DataLoadingWrapper-BAIbgHVA.js";import{c as H,a as ce,b as rt,d as Se,T as Ht}from"./FilterEntries-DDU75NJO.js";import{S as qt}from"./SiderContent-BR9joc_E.js";import{D as st}from"./DownloadButton-CBe5Ah-P.js";import{S as Yt}from"./SaveButton-DH62QBtY.js";import{l as S}from"./lodash-BfoqcgmA.js";import{A as B,d as N,e as Zt,f as Z}from"./constants-C-pAzlKH.js";import{e as Jt,g as er,a as Me,d as nt,w as tr,m as rr}from"./index-B7Pvm-Wi.js";import{u as sr}from"./useGetFirebaseDoc-hBIdLnaQ.js";import{u as be}from"./useTDResource-BYFeggIw.js";import{u as nr}from"./useUpdateFirebaseDoc-CR2VTQUq.js";import{T as ge}from"./index-NGRzFZEu.js";import{F as P}from"./index-01HFekmo.js";import{R as ir}from"./VerticalAlignTopOutlined-v3sXEg4U.js";import{I as ne,a as ie,b as _,c as je}from"./ItemBuildingBlocks-B9FxoJk1.js";import{a as it}from"./index-eEnngwWv.js";import{R as ze}from"./index-DzPTLm1V.js";import{c as Oe,E as ve,P as ar}from"./useBaseUrl-C-sXWEDZ.js";import{I as Ge}from"./Item-Dgx22zWx.js";import{C as te,T as or}from"./index-Czci-A9k.js";import{A as lr}from"./index-DdFJ98gm.js";import{S as Q}from"./index-jDplZqGf.js";import{u as at}from"./useQueryParams-D35LH15O.js";import{I as cr}from"./ItemsTypeahead-AhD5Pjr6.js";import{R as ur,a as dr,P as mr}from"./Pagination-43qsrMa3.js";import{S as he}from"./index-BoOwgUzF.js";import{R as pr,F as ot,a as gr}from"./Table-BXo7dKq1.js";import{D as hr}from"./index-CeT0mVFY.js";import{S as fr}from"./index-D4cyhTcL.js";import{i as br}from"./util-CeAI_f06.js";import{P as xr}from"./index-D79qNC_r.js";import{u as vr}from"./useToggle-BtJLnyxo.js";import{M as jr}from"./index-DjeMA1e_.js";import{T as Ir}from"./TransparentButton-D6_21rPX.js";import{R as yr}from"./SkinOutlined-CRQzSL4D.js";import{R as Cr}from"./index-D7lhsWWk.js";import"./index-gs05Ph-e.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-C-FjKWJH.js";import"./useMutation-BVGb6nuV.js";import"./gapSize-U1swVQyS.js";import"./LanguageFlag-Rpz-knlB.js";import"./useCopyToClipboardFunction-tTANaWEC.js";import"./index-utiOfK6H.js";import"./Input-B7kDLKxQ.js";import"./FireFilled-7jwkOfRa.js";import"./IdcardOutlined-CQx0tek8.js";import"./PlusOutlined-DcgDwDxc.js";import"./throttleByAnimationFrame-13tjvY4a.js";import"./useDebounce-LNPDVP2J.js";import"./index-AyVJbRxX.js";import"./scrollTo-DmqHOZf-.js";import"./extendsObject-keMuGWqj.js";var Sr={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Ar=function(){var r=p.useRef([]),s=p.useRef(null);return p.useEffect(function(){var n=Date.now(),o=!1;r.current.forEach(function(i){if(i){o=!0;var a=i.style;a.transitionDuration=".3s, .3s, .3s, .06s",s.current&&n-s.current<100&&(a.transitionDuration="0s, 0s")}}),o&&(s.current=Date.now())}),r.current},We=0,Er=St();function Tr(){var e;return Er?(e=We,We+=1):e="TEST_OR_SSR",e}const wr=function(e){var r=p.useState(),s=Ct(r,2),n=s[0],o=s[1];return p.useEffect(function(){o("rc_progress_".concat(Tr()))},[]),e||n};var Qe=function(r){var s=r.bg,n=r.children;return p.createElement("div",{style:{width:"100%",height:"100%",background:s}},n)};function Ke(e,r){return Object.keys(e).map(function(s){var n=parseFloat(s),o="".concat(Math.floor(n*r),"%");return"".concat(e[s]," ").concat(o)})}var Pr=p.forwardRef(function(e,r){var s=e.prefixCls,n=e.color,o=e.gradientId,i=e.radius,a=e.style,c=e.ptg,u=e.strokeLinecap,f=e.strokeWidth,l=e.size,d=e.gapDegree,b=n&&pe(n)==="object",x=b?"#FFF":void 0,h=l/2,g=p.createElement("circle",{className:"".concat(s,"-circle-path"),r:i,cx:h,cy:h,stroke:x,strokeLinecap:u,strokeWidth:f,opacity:c===0?0:1,style:a,ref:r});if(!b)return g;var j="".concat(o,"-conic"),v=d?"".concat(180+d/2,"deg"):"0deg",E=Ke(n,(360-d)/360),I=Ke(n,1),A="conic-gradient(from ".concat(v,", ").concat(E.join(", "),")"),m="linear-gradient(to ".concat(d?"bottom":"top",", ").concat(I.join(", "),")");return p.createElement(p.Fragment,null,p.createElement("mask",{id:j},g),p.createElement("foreignObject",{x:0,y:0,width:l,height:l,mask:"url(#".concat(j,")")},p.createElement(Qe,{bg:m},p.createElement(Qe,{bg:A}))))}),fe=100,$e=function(r,s,n,o,i,a,c,u,f,l){var d=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,b=n/100*360*((360-a)/360),x=a===0?0:{bottom:0,top:180,left:90,right:-90}[c],h=(100-o)/100*s;f==="round"&&o!==100&&(h+=l/2,h>=s&&(h=s-.01));var g=fe/2;return{stroke:typeof u=="string"?u:void 0,strokeDasharray:"".concat(s,"px ").concat(r),strokeDashoffset:h+d,transform:"rotate(".concat(i+b+x,"deg)"),transformOrigin:"".concat(g,"px ").concat(g,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Nr=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function Xe(e){var r=e??[];return Array.isArray(r)?r:[r]}var $r=function(r){var s=Be(Be({},Sr),r),n=s.id,o=s.prefixCls,i=s.steps,a=s.strokeWidth,c=s.trailWidth,u=s.gapDegree,f=u===void 0?0:u,l=s.gapPosition,d=s.trailColor,b=s.strokeLinecap,x=s.style,h=s.className,g=s.strokeColor,j=s.percent,v=At(s,Nr),E=fe/2,I=wr(n),A="".concat(I,"-gradient"),m=E-a/2,T=Math.PI*2*m,O=f>0?90+f/2:-90,y=T*((360-f)/360),w=pe(i)==="object"?i:{count:i,gap:2},C=w.count,$=w.gap,V=Xe(j),k=Xe(g),U=k.find(function(G){return G&&pe(G)==="object"}),F=U&&pe(U)==="object",q=F?"butt":b,ue=$e(T,y,0,100,O,f,l,d,q,a),ye=Ar(),X=function(){var ae=0;return V.map(function(ee,oe){var Pe=k[oe]||k[k.length-1],de=$e(T,y,ae,ee,O,f,l,Pe,q,a);return ae+=ee,p.createElement(Pr,{key:oe,color:Pe,ptg:ee,radius:m,prefixCls:o,gradientId:A,style:de,strokeLinecap:q,strokeWidth:a,gapDegree:f,ref:function(Ne){ye[oe]=Ne},size:fe})}).reverse()},z=function(){var ae=Math.round(C*(V[0]/100)),ee=100/C,oe=0;return new Array(C).fill(null).map(function(Pe,de){var Ce=de<=ae-1?k[0]:d,Ne=Ce&&pe(Ce)==="object"?"url(#".concat(A,")"):void 0,Fe=$e(T,y,oe,ee,O,f,l,Ce,"butt",a,$);return oe+=(y-Fe.strokeDashoffset+$)*100/y,p.createElement("circle",{key:de,className:"".concat(o,"-circle-path"),r:m,cx:E,cy:E,stroke:Ne,strokeWidth:a,opacity:1,style:Fe,ref:function(yt){ye[de]=yt}})})};return p.createElement("svg",Et({className:Tt("".concat(o,"-circle"),h),viewBox:"0 0 ".concat(fe," ").concat(fe),style:x,id:n,role:"presentation"},v),!C&&p.createElement("circle",{className:"".concat(o,"-circle-trail"),r:m,cx:E,cy:E,stroke:d,strokeLinecap:q,strokeWidth:c||a,style:ue}),C?z():X())};function J(e){return!e||e<0?0:e>100?100:e}function Ee(e){let{success:r,successPercent:s}=e,n=s;return r&&"progress"in r&&(n=r.progress),r&&"percent"in r&&(n=r.percent),n}const Rr=e=>{let{percent:r,success:s,successPercent:n}=e;const o=J(Ee({success:s,successPercent:n}));return[o,J(J(r)-o)]},Or=e=>{let{success:r={},strokeColor:s}=e;const{strokeColor:n}=r;return[n||Re.green,s||null]},we=(e,r,s)=>{var n,o,i,a;let c=-1,u=-1;if(r==="step"){const f=s.steps,l=s.strokeWidth;typeof e=="string"||typeof e>"u"?(c=e==="small"?2:14,u=l??8):typeof e=="number"?[c,u]=[e,e]:[c=14,u=8]=Array.isArray(e)?e:[e.width,e.height],c*=f}else if(r==="line"){const f=s==null?void 0:s.strokeWidth;typeof e=="string"||typeof e>"u"?u=f||(e==="small"?6:8):typeof e=="number"?[c,u]=[e,e]:[c=-1,u=8]=Array.isArray(e)?e:[e.width,e.height]}else(r==="circle"||r==="dashboard")&&(typeof e=="string"||typeof e>"u"?[c,u]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[c,u]=[e,e]:Array.isArray(e)&&(c=(o=(n=e[0])!==null&&n!==void 0?n:e[1])!==null&&o!==void 0?o:120,u=(a=(i=e[0])!==null&&i!==void 0?i:e[1])!==null&&a!==void 0?a:120));return[c,u]},kr=3,Lr=e=>kr/e*100,Dr=e=>{const{prefixCls:r,trailColor:s=null,strokeLinecap:n="round",gapPosition:o,gapDegree:i,width:a=120,type:c,children:u,success:f,size:l=a,steps:d}=e,[b,x]=we(l,"circle");let{strokeWidth:h}=e;h===void 0&&(h=Math.max(Lr(b),6));const g={width:b,height:x,fontSize:b*.15+6},j=p.useMemo(()=>{if(i||i===0)return i;if(c==="dashboard")return 75},[i,c]),v=Rr(e),E=o||c==="dashboard"&&"bottom"||void 0,I=Object.prototype.toString.call(e.strokeColor)==="[object Object]",A=Or({success:f,strokeColor:e.strokeColor}),m=xe(`${r}-inner`,{[`${r}-circle-gradient`]:I}),T=p.createElement($r,{steps:d,percent:d?v[1]:v,strokeWidth:h,trailWidth:h,strokeColor:d?A[1]:A,strokeLinecap:n,trailColor:s,prefixCls:r,gapDegree:j,gapPosition:E}),O=b<=20,y=p.createElement("div",{className:m,style:g},T,!O&&u);return O?p.createElement(De,{title:u},y):y},Te="--progress-line-stroke-color",lt="--progress-percent",He=e=>{const r=e?"100%":"-100%";return new Rt(`antProgress${e?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${r}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${r}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Ur=e=>{const{componentCls:r,iconCls:s}=e;return{[r]:Object.assign(Object.assign({},Nt(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize},[`${r}-outer`]:{display:"inline-flex",alignItems:"center",width:"100%"},[`${r}-inner`]:{position:"relative",display:"inline-block",width:"100%",flex:1,overflow:"hidden",verticalAlign:"middle",backgroundColor:e.remainingColor,borderRadius:e.lineBorderRadius},[`${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.defaultColor}},[`${r}-success-bg, ${r}-bg`]:{position:"relative",background:e.defaultColor,borderRadius:e.lineBorderRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${r}-layout-bottom`]:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",[`${r}-text`]:{width:"max-content",marginInlineStart:0,marginTop:e.marginXXS}},[`${r}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Te})`]},height:"100%",width:`calc(1 / var(${lt}) * 100%)`,display:"block"},[`&${r}-bg-inner`]:{minWidth:"max-content","&::after":{content:"none"},[`${r}-text-inner`]:{color:e.colorWhite,[`&${r}-text-bright`]:{color:"rgba(0, 0, 0, 0.45)"}}}},[`${r}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${r}-text`]:{display:"inline-block",marginInlineStart:e.marginXS,color:e.colorText,lineHeight:1,width:"2em",whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[s]:{fontSize:e.fontSize},[`&${r}-text-outer`]:{width:"max-content"},[`&${r}-text-outer${r}-text-start`]:{width:"max-content",marginInlineStart:0,marginInlineEnd:e.marginXS}},[`${r}-text-inner`]:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",marginInlineStart:0,padding:`0 ${$t(e.paddingXXS)}`,[`&${r}-text-start`]:{justifyContent:"start"},[`&${r}-text-end`]:{justifyContent:"end"}},[`&${r}-status-active`]:{[`${r}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.lineBorderRadius,opacity:0,animationName:He(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${r}-rtl${r}-status-active`]:{[`${r}-bg::before`]:{animationName:He(!0)}},[`&${r}-status-exception`]:{[`${r}-bg`]:{backgroundColor:e.colorError},[`${r}-text`]:{color:e.colorError}},[`&${r}-status-exception ${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.colorError}},[`&${r}-status-success`]:{[`${r}-bg`]:{backgroundColor:e.colorSuccess},[`${r}-text`]:{color:e.colorSuccess}},[`&${r}-status-success ${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.colorSuccess}}})}},Mr=e=>{const{componentCls:r,iconCls:s}=e;return{[r]:{[`${r}-circle-trail`]:{stroke:e.remainingColor},[`&${r}-circle ${r}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${r}-circle ${r}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[s]:{fontSize:e.circleIconFontSize}},[`${r}-circle&-status-exception`]:{[`${r}-text`]:{color:e.colorError}},[`${r}-circle&-status-success`]:{[`${r}-text`]:{color:e.colorSuccess}}},[`${r}-inline-circle`]:{lineHeight:1,[`${r}-inner`]:{verticalAlign:"bottom"}}}},Vr=e=>{const{componentCls:r}=e;return{[r]:{[`${r}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},Fr=e=>{const{componentCls:r,iconCls:s}=e;return{[r]:{[`${r}-small&-line, ${r}-small&-line ${r}-text ${s}`]:{fontSize:e.fontSizeSM}}}},Br=e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}),_r=wt("Progress",e=>{const r=e.calc(e.marginXXS).div(2).equal(),s=Pt(e,{progressStepMarginInlineEnd:r,progressStepMinWidth:r,progressActiveMotionDuration:"2.4s"});return[Ur(s),Mr(s),Vr(s),Fr(s)]},Br);var zr=function(e,r){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(s[n[o]]=e[n[o]]);return s};const Gr=e=>{let r=[];return Object.keys(e).forEach(s=>{const n=parseFloat(s.replace(/%/g,""));Number.isNaN(n)||r.push({key:n,value:e[s]})}),r=r.sort((s,n)=>s.key-n.key),r.map(s=>{let{key:n,value:o}=s;return`${o} ${n}%`}).join(", ")},Wr=(e,r)=>{const{from:s=Re.blue,to:n=Re.blue,direction:o=r==="rtl"?"to left":"to right"}=e,i=zr(e,["from","to","direction"]);if(Object.keys(i).length!==0){const c=Gr(i),u=`linear-gradient(${o}, ${c})`;return{background:u,[Te]:u}}const a=`linear-gradient(${o}, ${s}, ${n})`;return{background:a,[Te]:a}},Qr=e=>{const{prefixCls:r,direction:s,percent:n,size:o,strokeWidth:i,strokeColor:a,strokeLinecap:c="round",children:u,trailColor:f=null,percentPosition:l,success:d}=e,{align:b,type:x}=l,h=a&&typeof a!="string"?Wr(a,s):{[Te]:a,background:a},g=c==="square"||c==="butt"?0:void 0,j=o??[-1,i||(o==="small"?6:8)],[v,E]=we(j,"line",{strokeWidth:i}),I={backgroundColor:f||void 0,borderRadius:g},A=Object.assign(Object.assign({width:`${J(n)}%`,height:E,borderRadius:g},h),{[lt]:J(n)/100}),m=Ee(e),T={width:`${J(m)}%`,height:E,borderRadius:g,backgroundColor:d==null?void 0:d.strokeColor},O={width:v<0?"100%":v},y=p.createElement("div",{className:`${r}-inner`,style:I},p.createElement("div",{className:xe(`${r}-bg`,`${r}-bg-${x}`),style:A},x==="inner"&&u),m!==void 0&&p.createElement("div",{className:`${r}-success-bg`,style:T})),w=x==="outer"&&b==="start",C=x==="outer"&&b==="end";return x==="outer"&&b==="center"?p.createElement("div",{className:`${r}-layout-bottom`},y,u):p.createElement("div",{className:`${r}-outer`,style:O},w&&u,y,C&&u)},Kr=e=>{const{size:r,steps:s,rounding:n=Math.round,percent:o=0,strokeWidth:i=8,strokeColor:a,trailColor:c=null,prefixCls:u,children:f}=e,l=n(s*(o/100)),b=r??[r==="small"?2:14,i],[x,h]=we(b,"step",{steps:s,strokeWidth:i}),g=x/s,j=Array.from({length:s});for(let v=0;v<s;v++){const E=Array.isArray(a)?a[v]:a;j[v]=p.createElement("div",{key:v,className:xe(`${u}-steps-item`,{[`${u}-steps-item-active`]:v<=l-1}),style:{backgroundColor:v<=l-1?E:c,width:g,height:h}})}return p.createElement("div",{className:`${u}-steps-outer`},j,f)};var Xr=function(e,r){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(s[n[o]]=e[n[o]]);return s};const Hr=["normal","exception","active","success"],ct=p.forwardRef((e,r)=>{const{prefixCls:s,className:n,rootClassName:o,steps:i,strokeColor:a,percent:c=0,size:u="default",showInfo:f=!0,type:l="line",status:d,format:b,style:x,percentPosition:h={}}=e,g=Xr(e,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style","percentPosition"]),{align:j="end",type:v="outer"}=h,E=Array.isArray(a)?a[0]:a,I=typeof a=="string"||Array.isArray(a)?a:void 0,A=p.useMemo(()=>{if(E){const X=typeof E=="string"?E:Object.values(E)[0];return new Ot(X).isLight()}return!1},[a]),m=p.useMemo(()=>{var X,z;const G=Ee(e);return parseInt(G!==void 0?(X=G??0)===null||X===void 0?void 0:X.toString():(z=c??0)===null||z===void 0?void 0:z.toString(),10)},[c,e.success,e.successPercent]),T=p.useMemo(()=>!Hr.includes(d)&&m>=100?"success":d||"normal",[d,m]),{getPrefixCls:O,direction:y,progress:w}=p.useContext(kt),C=O("progress",s),[$,V,k]=_r(C),U=l==="line",F=U&&!i,q=p.useMemo(()=>{if(!f)return null;const X=Ee(e);let z;const G=b||(ee=>`${ee}%`),ae=U&&A&&v==="inner";return v==="inner"||b||T!=="exception"&&T!=="success"?z=G(J(c),J(X)):T==="exception"?z=U?p.createElement(Dt,null):p.createElement(Ut,null):T==="success"&&(z=U?p.createElement(Ae,null):p.createElement(Mt,null)),p.createElement("span",{className:xe(`${C}-text`,{[`${C}-text-bright`]:ae,[`${C}-text-${j}`]:F,[`${C}-text-${v}`]:F}),title:typeof z=="string"?z:void 0},z)},[f,c,m,T,l,C,b]);let ue;l==="line"?ue=i?p.createElement(Kr,Object.assign({},e,{strokeColor:I,prefixCls:C,steps:typeof i=="object"?i.count:i}),q):p.createElement(Qr,Object.assign({},e,{strokeColor:E,prefixCls:C,direction:y,percentPosition:{align:j,type:v}}),q):(l==="circle"||l==="dashboard")&&(ue=p.createElement(Dr,Object.assign({},e,{strokeColor:E,prefixCls:C,progressStatus:T}),q));const ye=xe(C,`${C}-status-${T}`,{[`${C}-${l==="dashboard"&&"circle"||l}`]:l!=="line",[`${C}-inline-circle`]:l==="circle"&&we(u,"circle")[0]<=20,[`${C}-line`]:F,[`${C}-line-align-${j}`]:F,[`${C}-line-position-${v}`]:F,[`${C}-steps`]:i,[`${C}-show-info`]:f,[`${C}-${u}`]:typeof u=="string",[`${C}-rtl`]:y==="rtl"},w==null?void 0:w.className,n,o,V,k);return $(p.createElement("div",Object.assign({ref:r,style:Object.assign(Object.assign({},w==null?void 0:w.style),x),className:ye,role:"progressbar","aria-valuenow":m,"aria-valuemin":0,"aria-valuemax":100},Lt(g,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),ue))});var qr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"},Yr=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:qr}))},Zr=p.forwardRef(Yr),Jr={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},es=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:Jr}))},qe=p.forwardRef(es),ts={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},rs=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:ts}))},ss=p.forwardRef(rs),ns={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},is=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:ns}))},as=p.forwardRef(is),os={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},ls=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:os}))},cs=p.forwardRef(ls),us={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},ds=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:us}))},ms=p.forwardRef(ds),ps={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},gs=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:ps}))},hs=p.forwardRef(gs),fs=function(e,r){return br?window.matchMedia(e).matches:!1},bs=function(e,r){var s=p.useState(fs(e)),n=s[0],o=s[1];return p.useEffect(function(){var i=!0,a=window.matchMedia(e),c=function(){i&&o(!!a.matches)};return a.addEventListener("change",c),o(a.matches),function(){i=!1,a.removeEventListener("change",c)}},[e]),n};const ut={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};S.keyBy(ut,"prefix");const xs=["*","^","+","~","!"],Y={ATTRIBUTE_VALUE_DICT:ut,ATTRIBUTE_VALUE_PRIORITY:xs},ke=(e={})=>S.cloneDeep(S.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},e)),Le=(e={})=>S.cloneDeep(S.merge({id:"",attributes:{}},e)),dt=(e,r,s)=>{const n=S.orderBy(Object.values(r),["priority","id"],["asc","asc"]).map(l=>l.id);function o(l,d){return S.orderBy(l,b=>n.indexOf(b),["asc"]).map(b=>`${d}${b}`)}const i=[],a=[],c=[],u=[],f=[];return Object.entries(e.attributes).forEach(([l,d])=>{if(r[l])switch(d){case N.OPPOSITE:i.push(l);break;case N.DETERMINISTIC:a.push(l);break;case N.RELATED:c.push(l);break;case N.UNRELATED:u.push(l);break;case N.UNCLEAR:f.push(l);break;default:f.push(l);break}}),[...o(i,B.OPPOSITE),...o(a,B.DETERMINISTIC),...o(c,B.RELATED),...o(u,B.UNRELATED),...o(f,B.UNCLEAR)]},mt=S.memoize(e=>{if(e.length===3)return{key:e,className:"",text:""};const r=e[0];return{key:e.slice(1,4),className:{[B.DETERMINISTIC]:"deterministic",[B.UNRELATED]:"unrelated",[B.UNCLEAR]:"unclear",[B.OPPOSITE]:"opposite"}[r],text:{[B.DETERMINISTIC]:"very",[B.UNRELATED]:"not",[B.UNCLEAR]:"maybe",[B.OPPOSITE]:"very not"}[r]}}),pt=(e,r,s)=>e.filter(n=>!(!r&&n.includes(B.UNCLEAR)||!s&&n.includes(B.UNRELATED)));function gt(e,r,s){const n=[];for(const[a,c]of Object.entries(e.attributes)){const u=r[a];if(u){const f=Object.values(Y.ATTRIBUTE_VALUE_DICT).find(l=>l.value===c);f&&n.push({prefix:f.prefix,id:u.id,priority:u.priority})}}const o=S.sortBy(n,[a=>Y.ATTRIBUTE_VALUE_PRIORITY.indexOf(a.prefix),a=>a.prefix===Y.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:a.priority,["asc","asc"]]),i=s!=null&&s.length?o.slice(0,s==null?void 0:s.length):o;return s!=null&&s.onlyRelevant?i.filter(a=>[Y.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,Y.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(a.prefix)).map(a=>`${a.prefix}${a.id}`).join(""):i.map(a=>`${a.prefix}${a.id}`).join("")}const vs=S.keyBy(Y.ATTRIBUTE_VALUE_DICT,"prefix");function js(e){return(e.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((s,n)=>{const o=n[0],i=n.slice(1),a=vs[o].value;return s[i]=a,s},{})}function ht(e){return Object.values(e.attributes).reduce((r,s)=>s<=0?(s===Y.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(r+=s/2),r):r+s,0)}function ft(e,r){const s=Object.values(e.attributes).filter(n=>n===Y.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((r-s)/r*100)}const me={};function Is(){const{notification:e,message:r}=Ue.useApp(),s=Vt(),n=be("items"),o=be("items-attributes"),i=be("items-attribute-values"),a=sr("tdr","itemsAttributeValues",{select:I=>Cs({itemAttributesValues:I,itemAttributes:o.data??{}})}),[c,u]=p.useState({}),f=nr("tdr","itemsAttributeValues",{onSuccess:()=>{e.success({message:"itemsAttributeValues updated"}),s.refetchQueries({queryKey:["firebase","tdr","itemsAttributeValues"]}),u({})},onError:I=>{e.error({message:"itemsAttributeValues update failed",description:I.message})}}),l=p.useMemo(()=>({...i.data??{},...a.data??{}}),[i.data,a.data]),d=!S.isEmpty(c),b=(I,A)=>{u(m=>({...m,[I]:{...A,updatedAt:Date.now()}}))},x=I=>{u(A=>({...A,...S.mapKeys(I.map(m=>({...m,updatedAt:Date.now()})),"id")}))},h=a.data,g=()=>{f.mutate(ys({...h,...c},o.data))};return{availableItemIds:p.useMemo(()=>{const I=n.data??{};return S.orderBy(Object.keys(I).filter(A=>{var m;return(((m=I[A])==null?void 0:m.decks)??[]).includes("alien")}),A=>Number(A),"asc")},[n.data]),getItem:I=>{var A;return(A=n.data)!=null&&A[I]?n.data[I]:(I&&r.info(`Item ${I} not found in TDR. Creating a new item...`),ke({id:I}))},getItemAttributeValues:I=>{const A=(l==null?void 0:l[I])??{},m=c[I]??{};return S.isEmpty(A)&&S.isEmpty(m)?(me[I]=Le({id:I}),me[I]):S.merge((me==null?void 0:me[I])??{},A,m)},attributes:o.data??{},isLoading:n.isLoading||o.isLoading||i.isLoading||a.isLoading,error:n.error||o.error||i.error||a.error,firebaseData:h,isSaving:f.isPending,save:g,addAttributesToUpdate:b,addMultipleAttributesToUpdate:x,attributesToUpdate:c,isDirty:d}}const ys=(e,r)=>er(e,n=>({id:n.id,tempSignature:gt(n,r),updatedAt:n.updatedAt})),Cs=e=>{const{itemAttributesValues:r,itemAttributes:s}=e,n=Object.keys(s).length;return Jt(r,i=>{const a=js(i.tempSignature),c=Object.keys(a).length===n,u={id:i.id,updatedAt:i.updatedAt,attributes:a};return c?{...u,complete:c,reliability:ft(u,n),score:ht(u)}:u})},bt=p.createContext({getItem:()=>ke(),getItemAttributeValues:()=>Le(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:ke(),itemAttributeValues:Le(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{}}),Ss=({children:e})=>{const{getItem:r,getItemAttributeValues:s,availableItemIds:n,isLoading:o,error:i,isSaving:a,save:c,addAttributesToUpdate:u,isDirty:f,attributes:l,addMultipleAttributesToUpdate:d,attributesToUpdate:b}=Is(),{message:x}=Ue.useApp(),[h,g]=p.useState(S.random(0,n.length-1)),j=r(n[h]),v=s(j.id),E=(T,O)=>{if(T==="next"){g(y=>(y+1)%n.length);return}if(T==="previous"){g(y=>(y-1+n.length)%n.length);return}if(T==="random"){g(S.random(0,n.length-1));return}if(T==="first"){g(0);return}if(T==="last"){g(n.length-1);return}if(T==="next10"){g(y=>(y+10)%n.length);return}if(T==="previous10"){g(y=>(y-10+n.length)%n.length);return}if(T==="incomplete"){g(y=>{let w=y+1;for(;w<n.length;){const C=s(n[w]);if(Object.keys(C.attributes).length!==I.length)return w;if(w===n.length-1)return x.info("No more incomplete items found."),y;w++}return y});return}if(T==="goTo"&&O!==void 0){const y=n.indexOf(O);if(y!==-1){g(y);return}x.error(`Item ${O} is not available for attribution.`)}},I=p.useMemo(()=>S.orderBy(Object.values(l),"name.en","asc"),[l]),A=(T,O)=>{u(j.id,{...v,attributes:{...v.attributes,[T]:O}})},m=()=>Me(n.reduce((T,O)=>{const y=s(O);return S.isEmpty(y.attributes)||(Object.keys(y.attributes).length===I.length?y.complete=!0:delete y.complete,T[y.id]=y),T},{}));return t.jsx(bt.Provider,{value:{getItem:r,getItemAttributeValues:s,availableItemIds:n,isLoading:o,error:i,hasResponseData:n.length>0&&!S.isEmpty(l),isDirty:f,itemAttributeValues:v,jumpToItem:E,activeItem:j,onAttributeChange:A,isSaving:a,save:c,attributes:l,attributesList:I,addAttributesToUpdate:u,addMultipleAttributesToUpdate:d,prepareItemsAttributesFileForDownload:m,attributesToUpdate:b},children:e})},D=()=>p.useContext(bt);function M(){const[e,r]=Ft(),s=(o,i)=>{e.set(o,`${i}`),r(e)},n=o=>{e.delete(o),r(e)};return{view:e.get("view")??"classifier",setView:o=>r({view:o}),addQueryParam:s,removeQueryParam:n,searchParams:e}}function W({label:e,children:r}){return t.jsxs(L.Text,{children:[e," ",t.jsx(ge,{children:r})]})}function As(){const{getItemAttributeValues:e,availableItemIds:r,attributesList:s}=D(),{total:n,complete:o,completionPercentage:i,hasDataCount:a,initiatedPercentage:c,progress:u,progressTotal:f,currentProgress:l}=p.useMemo(()=>{const d=r.length;let b=0,x=0,h=0;r.map(v=>e(v)).forEach(({attributes:v})=>{S.isEmpty(v)||(b+=1),Object.values(v).length===s.length&&(x+=1),h+=Object.values(v).length});const j=Object.values(s).length*r.length;return{total:d,complete:x,completionPercentage:d>0?(x/d*100).toFixed(1):0,hasDataCount:b,initiatedPercentage:d>0?Math.floor(b/d*100):0,progress:(h/j*100).toFixed(1),currentProgress:h,progressTotal:j}},[s,r,e]);return t.jsxs(t.Fragment,{children:[t.jsxs(P,{vertical:!0,children:[t.jsx(L.Text,{strong:!0,className:"mb-2",children:"Items Stats"}),t.jsx(W,{label:"Total",children:n}),t.jsxs(W,{label:"Complete",children:[o," (",i,"%)"]}),t.jsxs(W,{label:"Initiated",children:[a," (",c,"%)"]}),t.jsx(L.Text,{strong:!0,className:"mt-4 mb-2",children:"Attributes Stats"}),t.jsx(W,{label:"Total",children:f}),t.jsx(W,{label:"Set",children:l}),t.jsxs(W,{label:"Progress",children:[u,"%"]})]}),t.jsx(K,{})]})}function Es(){const{jumpToItem:e}=D(),{searchParams:r,addQueryParam:s}=M();return t.jsxs(t.Fragment,{children:[t.jsx(R,{block:!0,onClick:()=>e("random"),type:"primary",children:"Random Item"}),t.jsx(H,{label:"Unset Only",value:r.get("scope")==="unset",onChange:n=>s("scope",n?"unset":""),className:"mt-4"})]})}function Ts(){const{searchParams:e,addQueryParam:r}=M(),{attributesList:s}=D(),n=p.useMemo(()=>[{label:"Random Attribute",value:"random"},...s.map(({id:o,name:i})=>({label:i.en,value:o}))],[s]);return t.jsxs(t.Fragment,{children:[t.jsx(ce,{label:"Sampler Attribute",value:e.get("attribute")||"random",onChange:o=>r("attribute",o),options:n}),t.jsx(rt,{label:"Sample Size",value:Number(e.get("size")||9),onChange:o=>r("size",String(o)),min:3,max:21,step:3})]})}function ws(){const{searchParams:e,addQueryParam:r}=M(),{attributesList:s}=D(),n=p.useMemo(()=>s.map(({id:o,name:i,...a})=>({label:`${i.en}${a.default?"*":""}`,value:o})),[s]);return t.jsxs(t.Fragment,{children:[t.jsx(ce,{label:"Attribute",value:e.get("attribute")||"ali",onChange:o=>r("attribute",o),options:n}),t.jsx(ce,{label:"Scope",value:e.get("scope")||"unset",onChange:o=>r("scope",o),options:[{value:"unset",label:"Unset"},...Zt]}),t.jsx(ce,{label:"Results per page",value:e.get("pageSize")||12,onChange:o=>r("pageSize",o),options:[12,24,48,96]})]})}function Ps(){const{searchParams:e,addQueryParam:r}=M();return t.jsxs(t.Fragment,{children:[t.jsx(H,{label:"Only Complete",value:e.get("showComplete")==="true",onChange:s=>r("showComplete",s?"true":""),className:"full-width m-0"}),t.jsx(H,{label:"Show Unrelated",value:e.get("showUnrelated")==="true",onChange:s=>r("showUnrelated",s?"true":""),className:"full-width m-0"}),t.jsx(H,{label:"Show Unclear",value:e.get("showUnclear")==="true",onChange:s=>r("showUnclear",s?"true":""),className:"full-width m-0"})]})}function Ns(){const{searchParams:e,addQueryParam:r}=M();return t.jsx(t.Fragment,{children:t.jsx(H,{label:"Show Glyphs",value:e.get("showGlyphs")==="true",onChange:s=>r("showGlyphs",s?"true":""),className:"full-width m-0"})})}function $s(){const{isDirty:e,save:r,prepareItemsAttributesFileForDownload:s,attributes:n,isSaving:o,attributesToUpdate:i}=D(),{view:a,setView:c}=M();return t.jsxs(qt,{children:[t.jsxs(P,{vertical:!0,gap:12,children:[t.jsx(Yt,{isDirty:e,onSave:r,isSaving:o,dirt:JSON.stringify(i)}),t.jsx(st,{data:()=>Rs(s(),n),fileName:"items-attribute-values.json",disabled:e,block:!0})]}),t.jsx(K,{}),t.jsx(As,{}),t.jsx(ce,{label:"View",value:a,onChange:c,options:["classifier","sampler","grouping","comparator","simulator","stats"]}),t.jsx(K,{}),a==="classifier"&&t.jsx(Es,{}),a==="sampler"&&t.jsx(Ts,{}),a==="grouping"&&t.jsx(ws,{}),a==="comparator"&&t.jsx(Ps,{}),a==="stats"&&t.jsx(Ns,{})]})}function Rs(e,r){const s=Object.keys(r).length;return Object.keys(e).forEach(n=>{const o=e[n],i=Object.keys(o.attributes);i.forEach(c=>{r[c]||delete o.attributes[c]}),i.length===s?(o.complete=!0,o.score=ht(o),o.reliability=ft(o,s),o.signature=gt(o,r,{onlyRelevant:!0})):(o.complete=void 0,o.score=void 0,o.reliability=void 0,o.signature=void 0)}),Me(nt(e))}function xt(e){const[r,s]=p.useState(!1),n=()=>{s(window.scrollY>300)},o=()=>{window.scrollTo({top:0,behavior:"smooth"})};return Bt(()=>(window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)})),t.jsx(R,{className:`go-to-top-button ${r?"visible":""}`,onClick:o,icon:t.jsx(ir,{}),...e,children:"Go to Top"})}function vt({title:e,icon:r}){return t.jsx(De,{title:e,children:r??t.jsx(it,{})})}const Ye=[{label:"Opposite",value:N.OPPOSITE},{label:"Unrelated",value:N.UNRELATED},{label:"Unclear",value:N.UNCLEAR},{label:"Related",value:N.RELATED},{label:"Deterministic",value:N.DETERMINISTIC}],Ze=[{label:"Opposite",value:N.OPPOSITE},{label:"Unrelated",value:N.UNRELATED},{label:"Unclear",value:N.UNCLEAR},{label:"Related",value:N.RELATED},{label:"Deterministic",value:N.DETERMINISTIC,disabled:!0}];function Ie({attribute:e,value:r,onChange:s,onlyButtons:n,size:o}){return e?n?t.jsx(ze.Group,{options:e.limited?Ze:Ye,onChange:({target:{value:i}})=>s(e.id,i),value:r,optionType:"button",buttonStyle:"solid",size:o}):t.jsxs("div",{className:"attribute-button-container__row",children:[t.jsxs("span",{className:"attribute-button-container__label",children:[S.truncate(e.name.en,{length:12})," ",t.jsx(vt,{title:e.description.en})]}),t.jsx(ze.Group,{options:e.limited?Ze:Ye,onChange:({target:{value:i}})=>s(e.id,i),value:r,optionType:"button",buttonStyle:"solid",size:o}),t.jsx("span",{children:t.jsx(Ae,{style:{color:r&&r>7?"green":"transparent"}})})]},e.id):t.jsx(t.Fragment,{})}function Os({itemAttributeValues:e,attributes:r}){const{searchParams:s,addQueryParam:n}=M(),o=s.get("showUnclear")==="true",i=s.get("showUnrelated")==="true",a=p.useMemo(()=>pt(dt(e,r),o,i),[e,r,o,i]),c=s.get("signs")==="true"?jt:ks;return t.jsxs(P,{gap:6,vertical:!0,children:[t.jsx(H,{label:"Show Unrelated",value:s.get("showUnrelated")==="true",onChange:u=>n("showUnrelated",u?"true":""),className:"full-width m-0"}),t.jsx(H,{label:"Show Unclear",value:s.get("showUnclear")==="true",onChange:u=>n("showUnclear",u?"true":""),className:"full-width m-0"}),t.jsx(H,{label:"Alien Sings",value:s.get("signs")==="true",onChange:u=>n("signs",u?"true":""),className:"full-width m-0"}),t.jsx(P,{gap:6,wrap:"wrap",className:"item-attribute-value-statement",children:a.map((u,f,l)=>t.jsx(c,{keyVariant:u,attributes:r,firstElement:f===0,lastElement:f===l.length-1},u))})]})}function jt({keyVariant:e,attributes:r,withText:s}){const{key:n,className:o,text:i}=mt(e);return t.jsxs(P,{vertical:!0,align:"center",children:[t.jsx(Z,{width:50,id:r[n].spriteId,className:Oe("item-attribute-alien-sign",`item-attribute-alien-sign--${o}`)}),s&&t.jsxs(P,{wrap:"wrap",justify:"center",align:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},children:[i," ",r[n].name.en.toLowerCase()]})]})}function ks({keyVariant:e,attributes:r,firstElement:s,lastElement:n}){const{key:o,text:i}=mt(e),a=s?"It's ":"",c=n?".":", ";return t.jsxs(t.Fragment,{children:[a,i," ",r[o].name.en.toLowerCase(),c]})}function Ls({attributesList:e,itemAttributeValues:r}){const{completion:s,isDeterministic:n,value:o,isOpposing:i,relevancy:a}=p.useMemo(()=>{const c=e.length,u=Object.keys(r.attributes).length,f=Math.floor(u/c*100);let l=!1,d=!1,b=0;const x=Object.values(r.attributes).reduce((g,j)=>j<=0?(j===N.UNCLEAR&&(b+=1),j===N.OPPOSITE&&(d=!0,g+=j/2),g):(j===N.DETERMINISTIC&&(l=!0),g+j),0),h=Math.floor((u-b)/c*100);return{completion:f,isDeterministic:l,value:x,isOpposing:d,relevancy:h}},[e,r.attributes]);return t.jsxs("div",{children:[t.jsx(L.Text,{strong:!0,children:"Completion"}),t.jsx(ct,{percent:s,size:"small"}),t.jsx(L.Text,{strong:!0,children:"Stats"}),t.jsxs(P,{vertical:!0,children:[t.jsx(W,{label:"Deterministic",children:n?t.jsx(Ae,{style:{color:"green"}}):t.jsx(qe,{style:{color:"red"}})}),t.jsx(W,{label:"Opposing",children:i?t.jsx(Ae,{style:{color:"CornflowerBlue"}}):t.jsx(qe,{style:{color:"grey"}})}),t.jsx(W,{label:"Value",children:o}),t.jsx(De,{title:"The percentage of conclusive attributes (not unclear)",children:t.jsxs(W,{label:"Reliability",children:[a,"%"]})})]})]})}function Ds(){const{activeItem:e,attributesList:r,itemAttributeValues:s,onAttributeChange:n,jumpToItem:o,attributes:i}=D(),{searchParams:a,removeQueryParam:c}=M(),u=a.get("itemId"),f=a.get("filters");p.useEffect(()=>{u&&(c("itemId"),o("goTo",u))},[u,o,c]);const l=a.get("scope")==="unset",d=p.useMemo(()=>{const b=l?r.filter(x=>!s.attributes[x.id]):r;if(f){const x=f.split(",").reduce((h,g)=>(h[g]=!0,h),{});return b.filter(h=>x[h.id])}return b},[l,e.id,f]);return e?t.jsx(te,{children:t.jsxs("div",{className:"item-attribution-card",children:[t.jsx(lr,{offsetTop:120,className:"item-attribution-card__item",children:t.jsxs(P,{vertical:!0,gap:6,children:[t.jsx(ne,{item:e,width:150}),t.jsx(ie,{item:e}),t.jsx(_,{item:e,language:"en"}),t.jsx(_,{item:e,language:"pt"}),t.jsx(K,{className:"my-2"}),t.jsx(Ls,{attributesList:r,itemAttributeValues:s}),t.jsx(K,{className:"my-2"}),t.jsx(L.Text,{type:"secondary",children:t.jsx(Os,{itemAttributeValues:s,attributes:i})})]})}),t.jsx(Q,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:d.map(b=>t.jsx(Ie,{attribute:b,value:s.attributes[b.id],onChange:n},b.id))})]},`${e.id}`)}):t.jsx(te,{children:t.jsxs(L.Text,{type:"secondary",children:["No item selected."," ",t.jsx(R,{size:"small",type:"primary",onClick:()=>o("random"),children:"Random Item"})]})})}function Us(){const{jumpToItem:e}=D();return t.jsxs(R.Group,{children:[t.jsx(R,{onClick:()=>e("first"),icon:t.jsx(hs,{}),children:"First"}),t.jsx(R,{onClick:()=>e("previous10"),icon:t.jsx(ur,{}),children:"Previous 10"}),t.jsx(R,{onClick:()=>e("previous"),icon:t.jsx(_t,{}),children:"Previous"}),t.jsxs(R,{onClick:()=>e("next"),children:["Next ",t.jsx(zt,{})]}),t.jsxs(R,{onClick:()=>e("next10"),children:["Next 10 ",t.jsx(dr,{})]}),t.jsxs(R,{onClick:()=>e("last"),children:["Last ",t.jsx(ms,{})]}),t.jsx(tt,{content:t.jsx(Ms,{}),title:"Go to item",children:t.jsx(R,{children:"Go To"})}),t.jsx(R,{onClick:()=>e("incomplete"),children:"Next Incomplete"})]})}function Ms(){const{jumpToItem:e}=D();return t.jsx(cr,{isPending:!1,onFinish:r=>e("goTo",r)})}function Vs(){const{addParam:e,queryParams:r}=at(),{attributesList:s}=D(),n=p.useMemo(()=>s.map(c=>({label:c.name.en,value:c.id})),[s]),o=c=>{e("filters",c.join(","))},i=r.get("filters"),a=t.jsx(he,{mode:"multiple",style:{width:300},options:n,value:i==null?void 0:i.split(","),onChange:c=>o(c),allowClear:!0});return t.jsx(tt,{content:a,title:"Filter Attributes",children:t.jsx(R,{children:i?t.jsx(pr,{style:{color:"gold"}}):t.jsx(as,{})})})}function Fs(){const{attributes:e,getItemAttributeValues:r,availableItemIds:s,getItem:n,isLoading:o}=D(),{searchParams:i}=M(),a=i.get("showComplete")==="true",c=i.get("showUnclear")==="true",u=i.get("showUnrelated")==="true",{itemMessages:f,itemMessagesDict:l,grouping:d}=p.useMemo(()=>{if(o)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const b=S.orderBy(s.map(g=>{const j=r(g),v=dt(j,e);return{item:n(g),itemAttributesValues:j,message:pt(v,c,u),fullMessage:v}}).filter(({itemAttributesValues:g})=>a?g.complete:!0),["message"],["asc"]),x=b.reduce((g,{message:j,item:{id:v}})=>{const E=j.join(" ");return g[E]===void 0&&(g[E]=[]),g[E].push(v),g},{}),h=Object.values(x).filter(g=>g.length>1);return h.length>0&&console.log("More than one",h),{itemMessages:b,itemMessagesDict:S.keyBy(b,"item.id"),grouping:x}},[e,s,r,n,o,a,c,u]);return{itemMessages:f,itemMessagesDict:l,grouping:d}}function Ve(){const{searchParams:e,removeQueryParam:r}=M(),s=e.get("drawer"),[n,o]=p.useState(!1),{activeItem:i,attributesList:a,itemAttributeValues:c,onAttributeChange:u,jumpToItem:f}=D(),l=()=>{r("drawer")};p.useEffect(()=>{s&&f("goTo",s)},[s,f,r]);const d=p.useMemo(()=>n?a.filter(b=>!c.attributes[b.id]):a,[n,i.id]);return t.jsxs(hr,{open:!!s,title:`Edit: ${i.name.en}`,onClose:l,width:"640px",children:[t.jsxs(P,{gap:6,children:[t.jsxs(P,{vertical:!0,gap:6,children:[t.jsx(ne,{item:i,width:50}),t.jsx(ie,{item:i})]}),t.jsxs(P,{vertical:!0,gap:6,children:[t.jsx(_,{item:i,language:"en"}),t.jsx(_,{item:i,language:"pt"})]}),t.jsx(P,{vertical:!0,gap:6,children:t.jsx(fr,{checked:n,onChange:o,checkedChildren:"Unset",unCheckedChildren:"All"})})]}),t.jsx(K,{className:"my-1"}),t.jsx(Q,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:d.map(b=>t.jsx(Ie,{size:"small",attribute:b,value:c.attributes[b.id],onChange:u},b.id))})]})}function Bs(){const{attributes:e}=D(),{itemMessages:r,grouping:s}=Fs(),{addQueryParam:n}=M(),o=[{title:"Item Id",dataIndex:"item",key:"id",render:i=>t.jsxs("div",{children:[t.jsx(ie,{item:i}),t.jsxs(R.Group,{children:[t.jsx(je,{item:i}),t.jsx(R,{size:"small",shape:"round",onClick:()=>n("drawer",i.id),children:"Drawer"})]})]}),sorter:(i,a)=>Number(i.item.id)-Number(a.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:i=>t.jsx(ne,{item:i,width:75})},{title:"Name",dataIndex:"item",key:"name",render:i=>t.jsxs(t.Fragment,{children:[t.jsx(_,{item:i,language:"en"}),t.jsx(_,{item:i,language:"pt"})]}),sorter:(i,a)=>i.item.name.en.localeCompare(a.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(i,{item:a})=>t.jsx(P,{gap:6,children:i.map((c,u,f)=>t.jsx(jt,{keyVariant:c,attributes:e,firstElement:u===0,lastElement:u===f.length-1,withText:!0},`${c}-${a.id}`))}),sorter:(i,a)=>i.message.join(" ").localeCompare(a.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:i=>i.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:i=>{const a=s[i.join(" ")]??[];return t.jsx(t.Fragment,{children:a.length>1?a.length:"0"})},sorter:(i,a)=>{const c=s[i.message.join(" ")]??[];return(s[a.message.join(" ")]??[]).length-c.length}}];return t.jsxs("div",{className:"my-4",children:[t.jsx(L.Title,{level:5,children:"Item Comparator"}),t.jsx(ot,{dataSource:r,columns:o,pagination:{showQuickJumper:!0}}),t.jsx(Ve,{})]})}function _s(){const{attributesList:e,addAttributesToUpdate:r,getItemAttributeValues:s,availableItemIds:n,addMultipleAttributesToUpdate:o}=D(),{searchParams:i,addQueryParam:a}=M(),c=i.get("attribute")??"ali",u=i.get("scope")??"unset",f=i.get("page")??"1",l=i.get("pageSize")??"12",[d,b]=p.useState("ali"),[x,h]=p.useState("unset"),[g,j]=p.useState(null),[v,E]=p.useState("desc"),I=p.useMemo(()=>{const y=n.map(k=>s(k)),w=u==="unset"?void 0:N[u.toUpperCase()],C=y.filter(k=>{var U;return((U=k.attributes)==null?void 0:U[c])===w}).map(k=>k.id),[$,V]=(g??"::").split("::");return S.orderBy(C,[k=>{var U,F;return $==="attribute"?(F=(U=s(k))==null?void 0:U.attributes)==null?void 0:F[V]:!0},k=>$==="prop"?Number(k):!0,k=>{var U;return(U=s(k))==null?void 0:U.updatedAt},k=>Number(k)],[v,"asc","desc","asc"])},[c,u,g,v]),A=p.useMemo(()=>{if(d!==c||x!==u)return b(c),h(u),a("page","1"),I.slice(0,Number(l));const y=(Number(f)-1)*Number(l),w=y+Number(l);return I.slice(y,w)},[f,l,I]),m=e.find(y=>y.id===c),T=(y,w,C)=>{const $=s(y);r(y,{...$,attributes:{...$.attributes,[w]:C}})},O=()=>{o(A.map(y=>{const w=s(y);return w.attributes[c]||(w.attributes[c]=N.UNRELATED),w}))};return{group:I,stats:{total:n.length,group:I.length,percent:Math.round(I.length/n.length*100)},pageIds:A,attribute:m,updateAttributeValue:T,updatePageItemsAsUnrelated:O,sorting:{sortBy:g,setSortBy:j,sortOrder:v,setSortOrder:E},pagination:{total:I.length,current:Number(f),pageSize:Number(l),onChange:y=>a("page",String(y)),onShowSizeChange:(y,w)=>a("pageSize",String(w)),pageSizeOptions:[12,24,48,96]}}}const zs=(e,r)=>r==="unset"||!r?`${100-e.percent}% done, ${e.group} left`:`${e.percent}%  - ${e.group} items`;function Gs(){const{getItem:e,getItemAttributeValues:r,attributesList:s}=D(),{attribute:n,pageIds:o,updateAttributeValue:i,updatePageItemsAsUnrelated:a,pagination:c,stats:u,sorting:f}=_s(),{searchParams:l,addQueryParam:d}=M(),b=bs("(max-width: 1024px)");if(S.isEmpty(n))return t.jsx(te,{className:"my-4",children:t.jsx(L.Text,{type:"secondary",children:"No group attribute has been selected."})});const x=t.jsx(mr,{onChange:c.onChange,current:c.current,total:c.total,pageSizeOptions:c.pageSizeOptions,pageSize:c.pageSize,onShowSizeChange:c.onShowSizeChange},"pagination"),h=t.jsxs(P,{align:"center",children:[t.jsx(L.Text,{className:"mr-2",children:"Sort by"}),t.jsxs(he,{style:{width:120},value:f.sortBy,onChange:v=>f.setSortBy(v),children:[t.jsx(he.Option,{value:null,children:"Last Updated"}),t.jsx(he.Option,{value:"prop::id",children:"Id"}),s.map(v=>t.jsx(he.Option,{value:`attribute::${v.id}`,children:v.name.en},v.id))]})]}),j=(l.get("scope")==="unset"||!l.get("scope"))&&t.jsx(xr,{title:`Are you sure everything is unrelated to ${n.name.en}?`,onConfirm:a,children:t.jsx(R,{type:"primary",danger:!0,disabled:o.length===0,children:"Unrelate Unset Items on Page"})},"unrelate-button");return t.jsxs(te,{className:"my-4",title:t.jsxs(L.Text,{children:[n==null?void 0:n.name.en," (",zs(u,l.get("scope")),") -"," ",n.description.en]}),extra:t.jsxs(P,{align:"center",children:[h,x]}),actions:[j,t.jsx(xt,{},"go-to-top"),x].filter(Boolean),children:[o.length===0&&t.jsx(ve,{description:"No items found in this scope for this attribute.",image:ve.PRESENTED_IMAGE_SIMPLE}),o.map(v=>{const E=r(v),I=e(v);return t.jsx(te.Grid,{style:{width:b?"50%":"25%"},children:t.jsxs(P,{gap:6,children:[t.jsxs(P,{vertical:!0,gap:6,children:[t.jsx(ne,{item:I,width:75}),t.jsx(ie,{item:I}),t.jsxs(R.Group,{children:[t.jsx(je,{item:I}),t.jsx(R,{size:"small",shape:"round",onClick:()=>d("drawer",I.id),children:"Drawer"})]}),t.jsx(_,{item:I,language:"en"}),t.jsx(_,{item:I,language:"pt"})]}),t.jsx(Ie,{attribute:n,value:E.attributes[n.id],onlyButtons:!0,onChange:(A,m)=>i(I.id,A,m)})]})},`${v}-${E.updatedAt}`)}),t.jsx(Ve,{})]})}function It(){const{attributesList:e,availableItemIds:r,addAttributesToUpdate:s,getItemAttributeValues:n}=D(),{searchParams:o}=M(),[i,a]=p.useState([]),[c,u]=p.useState(),f=()=>{var E;const x=o.get("attribute")??((E=S.sample(e))==null?void 0:E.id)??"ali",h=e.find(I=>I.id===x)??S.sample(e),g=Number(o.get("size"))||9,j=[],v=S.shuffle(r);for(let I=0;I<v.length&&j.length!==g;I++){const A=v[I];n(A).attributes[x]||j.push(A)}return{selectedAttribute:h,selected:j}},l=()=>{let x=f(),h=0;for(;x.selected.length===0&&h<30;)x=f(),h++;u(x.selectedAttribute),a(x.selected)},d=p.useMemo(()=>c?r.filter(x=>!n(x).attributes[c==null?void 0:c.id]).length:0,[c,r]);return{sampleIds:i,attribute:c,itemsLeftForAttribute:d,onGetSample:l,updateAttributeValue:(x,h,g)=>{const j=n(x);s(x,{...j,attributes:{...j.attributes,[h]:g}})}}}function Ws(){const{getItem:e,getItemAttributeValues:r}=D(),{sampleIds:s,attribute:n,onGetSample:o,updateAttributeValue:i,itemsLeftForAttribute:a}=It(),{addQueryParam:c}=M();if(S.isEmpty(s)&&S.isEmpty(n))return t.jsxs(te,{className:"my-4",children:[t.jsxs(L.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",t.jsx(R,{size:"small",type:"primary",onClick:o,children:"Get Sample"})]}),t.jsx(K,{}),t.jsx(Je,{})]});const u=s.map(d=>({itemAttributes:r(d),item:e(d)})),f=u.filter(({itemAttributes:d})=>(n==null?void 0:n.id)&&!d.attributes[n.id]),l=()=>{f.forEach(({item:d})=>{n!=null&&n.id&&i(d.id,n.id,-3)})};return t.jsxs(t.Fragment,{children:[t.jsx(Je,{}),t.jsxs(te,{className:"my-4",title:t.jsxs(L.Text,{children:[n==null?void 0:n.name.en," - ",n==null?void 0:n.description.en," (",a," items left)"]}),actions:[t.jsx(R,{onClick:l,danger:!0,disabled:f.length===0,children:"Mark rest as unrelated"},"1"),t.jsx(R,{type:"primary",ghost:!0,onClick:o,children:"Get New Sample"},"2")],extra:t.jsx(R,{type:"primary",size:"small",onClick:o,children:"Get New Sample"}),children:[t.jsxs(P,{vertical:!0,gap:6,children:[u.length===0&&t.jsx(ve,{description:"No unset items found for this attribute.",image:ve.PRESENTED_IMAGE_SIMPLE}),u.map(({item:d,itemAttributes:b})=>t.jsxs(p.Fragment,{children:[t.jsxs(P,{gap:6,children:[t.jsx(ne,{item:d,width:75}),t.jsxs(P,{vertical:!0,gap:6,children:[t.jsxs(P,{gap:6,children:[t.jsx(ie,{item:d}),t.jsxs(R.Group,{children:[t.jsx(je,{item:d}),t.jsx(R,{size:"small",shape:"round",onClick:()=>c("drawer",d.id),children:"Drawer"})]})]}),t.jsx(_,{item:d,language:"en"}),t.jsx(_,{item:d,language:"pt"})]}),!!n&&t.jsx(Ie,{attribute:n,value:b.attributes[n.id],onChange:(x,h)=>i(d.id,x,h)})]}),t.jsx(K,{className:"my-1"})]},`${d.id}-${b.updatedAt}`))]}),t.jsx(Ve,{})]})]})}function Je(){const[e,r]=vr(!1),{addQueryParam:s,removeQueryParam:n}=M(),{sampleIds:o,attribute:i,onGetSample:a,updateAttributeValue:c}=It(),{getItem:u,getItemAttributeValues:f}=D(),l=()=>{s("size","1"),r(!0),a()},d=()=>{n("size"),r(!1)},b=o[0],x=u(b),h=f(b);return t.jsxs(P,{className:"mt-4",children:[t.jsx(R,{type:"primary",onClick:l,children:"Single Sampler"}),t.jsxs(jr,{title:t.jsxs(L,{children:["Single Sampler: ",t.jsx("strong",{children:i==null?void 0:i.name.en})]}),open:e,width:"100vw",maskClosable:!1,onOk:d,onClose:d,onCancel:d,cancelButtonProps:{style:{display:"none"}},children:[b&&x&&h&&i&&t.jsxs(P,{gap:6,className:"my-10",wrap:"wrap",children:[t.jsx(ne,{item:x,width:150}),t.jsxs(P,{vertical:!0,gap:6,children:[t.jsxs(P,{gap:6,children:[t.jsx(ie,{item:x}),t.jsx(je,{item:x})]}),t.jsx(_,{item:x,language:"en"}),t.jsx(_,{item:x,language:"pt"})]}),!!i&&t.jsx(Ie,{size:"large",attribute:i,value:h.attributes[i.id],onChange:async(g,j)=>{c(x.id,g,j),await tr(500),a()}})]},b),t.jsx(R,{onClick:a,children:"Another Sample"})]})]})}function Qs(){const e=be("items-attributes"),r=be("items-attribute-values"),[s,n]=p.useState(null),o=()=>{n(et(e.data,r.data))},i=()=>{const a={};let c=0;for(;c<300||S.keys(a).length===15;){const u=et(e.data,r.data);if(u.valid&&!a[u.setId]&&(a[u.setId]=u),S.keys(a).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(a).map((u,f)=>({...u,number:u.number-f})))};return t.jsxs("div",{className:"my-4",children:[t.jsx(L.Title,{level:3,children:"Daily Simulator"}),t.jsx(L.Paragraph,{children:"Generates a daily game for Alien Communication"}),t.jsxs(Q,{children:[t.jsx(R,{type:"primary",onClick:o,children:"Generate"}),t.jsx(R,{onClick:i,children:"Generate List"})]}),t.jsx("div",{children:!!s&&t.jsxs(Q,{direction:"vertical",children:[t.jsx(L.Title,{level:5,children:s==null?void 0:s.setId}),!(s!=null&&s.valid)&&t.jsx(Gt,{type:"error",message:"Invalid game"}),t.jsx(Q,{direction:"vertical",children:s==null?void 0:s.attributes.map(a=>t.jsxs(P,{gap:8,children:[t.jsx(Z,{id:a.spriteId,width:50}),a.itemsIds.map(c=>t.jsx(Ge,{id:c||"0",width:50},c))]},a.id))}),t.jsx(K,{className:"my-1"}),t.jsx(Q,{direction:"horizontal",children:s==null?void 0:s.requests.map(a=>t.jsxs(P,{vertical:!0,children:[t.jsx(Z,{id:a.spritesIds[2],width:50}),t.jsx(Z,{id:a.spritesIds[1],width:50}),t.jsx(Z,{id:a.spritesIds[0],width:50})]},a.itemId))}),t.jsx(K,{className:"my-1"}),t.jsx(Q,{direction:"horizontal",children:s==null?void 0:s.itemsIds.map(a=>t.jsx(Ge,{id:a||"0",width:50},a))})]},s==null?void 0:s.setId)})]})}const et=(e,r)=>{const s=S.values(e).filter(m=>!m.limited||m.id==="sol"),n=S.shuffle(S.values(r).filter(m=>m.complete)),o=S.shuffle(rr(38,0)),i=S.sampleSize(s,3).map(m=>({...m,spriteId:`${o.pop()}`})),a=[],c=[],u=[],f=[],l=[],d=[],b=[],x=[];n.forEach(m=>{const T=[N.DETERMINISTIC,N.RELATED],O=m.attributes[i[0].id]===N.DETERMINISTIC,y=T.includes(m.attributes[i[0].id]),w=m.attributes[i[0].id]===N.UNRELATED,C=m.attributes[i[1].id]===N.DETERMINISTIC,$=T.includes(m.attributes[i[1].id]),V=m.attributes[i[1].id]===N.UNRELATED,k=m.attributes[i[2].id]===N.DETERMINISTIC,U=T.includes(m.attributes[i[2].id]),F=m.attributes[i[2].id]===N.UNRELATED;if(w&&V&&F)return x.push(m.id);O&&V&&F&&a.push(m.id),w&&C&&F&&c.push(m.id),w&&V&&k&&u.push(m.id),y&&$&&F&&f.push(m.id),y&&V&&U&&l.push(m.id),w&&$&&U&&d.push(m.id),y&&$&&U&&b.push(m.id)});const h=i.map(m=>({id:m.id,name:m.name.pt,description:m.description.pt,spriteId:m.spriteId,itemsIds:[]}));h[0].itemsIds=S.sampleSize(a,a.length>3?3:Math.max(a.length-1,1)),h[1].itemsIds=S.sampleSize(c,c.length>3?3:Math.max(a.length-1,1)),h[2].itemsIds=S.sampleSize(u,u.length>3?3:Math.max(a.length-1,1));const g=[];h.forEach(m=>{g.push(...m.itemsIds)});const j=[];f.length>0&&j.push({spritesIds:[i[0].spriteId,i[1].spriteId],itemId:S.sample(f)??""}),l.length>0&&j.push({spritesIds:[i[0].spriteId,i[2].spriteId],itemId:S.sample(l)??""}),d.length>0&&j.push({spritesIds:[i[1].spriteId,i[2].spriteId],itemId:S.sample(d)??""}),b.length>0&&j.push({spritesIds:i.map(m=>m.spriteId),itemId:S.sample(b)??""});const v=[];a.length>0&&v.push({spritesIds:[i[0].spriteId],itemId:a.filter(m=>!g.includes(m))[0]}),c.length>0&&v.push({spritesIds:[i[1].spriteId],itemId:c.filter(m=>!g.includes(m))[0]}),u.length>0&&v.push({spritesIds:[i[2].spriteId],itemId:u.filter(m=>!g.includes(m))[0]}),console.log({attributeA:a,attributeB:c,attributeC:u,attributeAB:f,attributeAC:l,attributeBC:d,attributeABC:b}),console.log("COMPLEX REQUEST SIZE",j.length),console.log("SIMPLE REQUEST SIZE",v.length);let E=S.sampleSize(j,4);console.log("REQUEST SIZE",E.length),E.length<3&&E.push(...S.sampleSize(v,4-E.length)),E.length<4&&console.warn("Not enough requests"),E=S.shuffle(E);const I=E.map(m=>m.itemId),A={id:"2024-00-00",setId:h.map(m=>m.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:h,requests:E,solution:I.join("-"),itemsIds:S.shuffle([...I,x[0],x[1],x[2],x[3]]).filter(Boolean),valid:!1};return A.valid=[A.attributes.length===3,A.requests.length===4,A.itemsIds.length>5,A.attributes.every(m=>m.itemsIds.length>0),A.requests.every(m=>m.itemId)].every(Boolean),console.log(A),A},Ks=["","I","II","III","IV","V"];function Xs(){const{attributes:e,availableItemIds:r,getItemAttributeValues:s,getItem:n}=D(),{message:o}=Ue.useApp(),[i,a]=p.useState(25),[c,u]=p.useState(80),[f,l]=p.useState(!1),[d,b]=p.useState([]),[x,h]=p.useState([]),[g,j]=p.useState(null),[v,E]=p.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),I=()=>{const m={},T=S.shuffle(r);for(;Object.values(m).length<i;){const C=T.pop();if(!C)break;const $=s(C);$&&(!$.complete||!$.reliability||$.reliability<c||!f&&n(C).nsfw||($.signature&&!m[$.signature]?m[$.signature]=C:console.log("Item has identical key to another item. Skipping.",n(C).name.en)))}const O=Object.values(m);O.length<i&&o.error(`Could not generate sample. Got only ${O.length} items`),b(S.sortBy(O,C=>Number(C)));const y=Hs(O.map(C=>s(C)),25,e);if(y.length<25){const C=S.keys(e).filter(k=>!y.includes(k)),V=S.sortBy(C,k=>e[k].priority).slice(0,25-y.length);console.log("Adding more attributes by priority",V),y.push(...V)}const w=y.reduce((C,$)=>(O.forEach(V=>{const k=s(V);if(k)switch(k.attributes[$]){case N.RELATED:C.relatedCount[$]=(C.relatedCount[$]||0)+1;break;case N.DETERMINISTIC:C.deterministicCount[$]=(C.deterministicCount[$]||0)+1;break;case N.UNCLEAR:C.unclearCount[$]=(C.unclearCount[$]||0)+1;break;case N.OPPOSITE:C.oppositeCount[$]=(C.oppositeCount[$]||0)+1;break}}),C),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});h(y.sort().map(C=>({...e[C],relatedCount:w.relatedCount[C],deterministicCount:w.deterministicCount[C],unclearCount:w.unclearCount[C],oppositeCount:w.oppositeCount[C]})))},A=m=>{E(T=>({...T,[m]:!T[m]}))};return t.jsxs("div",{className:"my-4",children:[t.jsx(L.Title,{level:3,children:"Simulator"}),t.jsx(L.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),t.jsxs(P,{wrap:!0,gap:12,children:[t.jsx(ce,{label:"Grid Size",value:i,onChange:m=>a(m),options:[16,25]}),t.jsx(rt,{label:"Reliability Threshold",value:c,onChange:m=>u(m),step:5,min:10,max:100}),t.jsx(H,{label:"NSFW",value:f,onChange:l}),t.jsx(R,{onClick:I,type:"primary",children:"Get Sample Board"})]}),t.jsxs(P,{wrap:!0,gap:12,children:[t.jsx(Se,{label:"Show Id",value:!!v.id,onChange:()=>A("id")}),t.jsx(Se,{label:"Show Name (EN)",value:!!v.nameEn,onChange:()=>A("nameEn")}),t.jsx(Se,{label:"Show Name (PT)",value:!!v.namePt,onChange:()=>A("namePt")}),t.jsx(Se,{label:"Show Reliability",value:!!v.reliability,onChange:()=>A("reliability")})]}),t.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(i)}, 1fr)`},children:d.map(m=>{const T=n(m),O=s(m);return t.jsxs(Q,{direction:"vertical",className:Oe("simulator-grid__entry",g&&O.attributes[g]>0&&"simulator-grid__entry--highlighted"),align:"center",children:[t.jsxs(Q,{children:[t.jsxs(P,{vertical:!0,children:[v.id&&t.jsx(ie,{item:T}),v.reliability&&t.jsx("span",{children:t.jsx(Ht,{prefix:t.jsx(cs,{}),placeholder:"Reliability",variant:"borderless",size:"small",value:O.reliability,readOnly:!0,style:{width:"8ch"},formatter:y=>`${y}%`})}),v.id&&t.jsx(je,{item:T})]}),t.jsx(ne,{item:T,width:50})]}),v.nameEn&&t.jsx(_,{item:T,language:"en"}),v.namePt&&t.jsx(_,{item:T,language:"pt"})]},m)})}),t.jsx("div",{className:"simulator-grid my-4",children:x.map(m=>t.jsxs(Ir,{className:Oe("simulator-grid__entry","simulator-grid__button",g===m.id&&"simulator-grid__entry--highlighted"),onClick:()=>j(m.id),children:[m.name.en," ",Ks[m.level],t.jsxs(P,{gap:6,justify:"center",className:"my-1",children:[t.jsxs("span",{children:[t.jsx(Zr,{style:{color:m.deterministicCount?"dodgerblue":void 0}})," ",m.deterministicCount??0]}),t.jsxs("span",{children:[t.jsx(gr,{style:{color:m.relatedCount?"green":void 0}})," ",m.relatedCount??0]}),t.jsxs("span",{children:[t.jsx(ss,{style:{color:m.oppositeCount?"red":void 0}})," ",m.oppositeCount??0]}),t.jsxs("span",{children:[t.jsx(it,{style:{color:m.unclearCount?"gold":void 0}})," ",m.unclearCount??0]})]})]},m.id))}),t.jsx(Qs,{})]})}function Hs(e,r,s){const n={},o={};e.forEach(h=>{h&&Object.keys(h.attributes).forEach(g=>{h.attributes[g]>0&&(n[g]=(n[g]||0)+1),h.attributes[g]===N.DETERMINISTIC&&(o[g]=!0,n[g]=(n[g]||0)+2),h.attributes[g]===N.OPPOSITE&&(n[g]=(n[g]||0)+1)})});const i={1:0,2:0,3:0,4:0};function a(h){return h.filter(g=>(i[s[g].level]++,i[4]>1?(console.log("Discarding level 4 attribute",g),!1):!0))}const c=a(Object.keys(o)),u=a(S.keys(n).filter(h=>!c.includes(h)));if(console.log({levelCount:i}),r===c.length)return console.log("All keys are deterministic"),c;if(console.log(n),c.length===0)return[];const f=c.reduce((h,g)=>{const j=n[g];return h[j]||(h[j]=[]),h[j].push(g),h},{}),l=S.keys(f).sort((h,g)=>Number(g)-Number(h));console.log({sortedDeterministicTiedGroupsKeys:l});const d=u.reduce((h,g)=>{const j=n[g];return h[j]||(h[j]=[]),h[j].push(g),h},{});console.log(d);const b=S.keys(d).sort((h,g)=>Number(g)-Number(h)),x=[];for(const h of l){if(x.length===r)break;x.push(...S.sampleSize(f[h],r-x.length))}for(const h of b){if(x.length===r)break;x.push(...S.sampleSize(d[h],r-x.length))}return x}function qs(){const{attributes:e}=D(),r=[{key:"1",label:"All Attributes",children:t.jsx(le,{type:"all"})},{key:"2",label:"Default",children:t.jsx(le,{type:"default"})},{key:"3",label:"Custom",children:t.jsx(le,{type:"custom"})},{key:"4",label:"Limited",children:t.jsx(le,{type:"limited"})},{key:"5",label:"Specific",children:t.jsx(le,{type:"specific"})},{key:"6",label:"Opposite",children:t.jsx(le,{type:"opposite"})}];return t.jsxs("div",{className:"my-4",children:[t.jsxs(P,{justify:"space-between",align:"center",children:[t.jsx(L.Title,{level:5,children:"Stats"}),t.jsx(st,{data:()=>Zs(e),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),t.jsx(or,{defaultActiveKey:"1",items:r})]})}const Ys=(e,r)=>{let s=0,n=0,o=0,i=0,a=0,c=0,u=0,f=0;r.forEach(({attributes:I})=>{if(I[e.id]){s++;const A=I[e.id];A===10?n++:A===5?o++:A===0||!A?i++:A===-1?a++:A===-3?c++:A===-10&&u++,A>0&&f++}});const l=r.length,d=s/l*100,b=n/l*100,x=o/l*100,h=i/l*100,g=a/l*100,j=c/l*100,v=u/l*100,E=f/l*100;return{completionPercentage:d.toFixed(1),tensPercentage:b.toFixed(1),fivesPercentage:x.toFixed(1),zerosPercentage:h.toFixed(1),negativeOnesPercentage:g.toFixed(1),negativeThreesPercentage:j.toFixed(1),negativeTensPercentage:v.toFixed(1),positivePercentage:E.toFixed(1)}};function le({type:e}){const{availableItemIds:r,getItemAttributeValues:s,attributesList:n}=D(),o=Wt(),{is:i}=at(),a=p.useMemo(()=>{const l=new Array(65).fill(0).map((b,x)=>x),d=n.map(b=>b.spriteId);return l.filter(b=>!d.includes(`sign-${b}`))},[n]),c=p.useMemo(()=>e==="default"?n.filter(l=>l.default):e==="custom"?n.filter(l=>!l.default):e==="limited"?n.filter(l=>l.limited):e==="specific"?n.filter(l=>l.specific):e==="opposite"?n.filter(l=>l.oppositeId):n,[n,e]),u=p.useMemo(()=>{const l=r.map(d=>s(d));return c.map(d=>({...d,...Ys(d,l)}))},[c,r,s]),f=[{title:"Attribute",dataIndex:"name",key:"name",render:(l,d)=>t.jsxs(P,{align:"center",gap:8,children:[i("showGlyphs")&&t.jsx(Z,{id:d.spriteId,width:30}),l.en,d.default&&t.jsx(ge,{className:"ml-1",children:"default"}),d.limited&&t.jsx(ge,{className:"ml-1",children:"limited"}),(d.specific||d.parentId)&&t.jsx(ge,{className:"ml-1",children:"specific"}),d.oppositeId&&t.jsx(ge,{className:"ml-1",children:t.jsx(Qt,{})}),t.jsx(vt,{title:d.description.en})]}),sorter:(l,d)=>l.name.en.localeCompare(d.name.en)},{title:t.jsx(yr,{}),dataIndex:"spriteId",key:"spriteId",render:l=>t.jsx(Z,{id:l,width:18,padding:0})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(l,d)=>l.priority-d.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.positivePercentage)-Number.parseFloat(d.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(l,d)=>d.limited?"-":`${l}%`,sorter:(l,d)=>Number.parseFloat(l.tensPercentage)-Number.parseFloat(d.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.fivesPercentage)-Number.parseFloat(d.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.negativeOnesPercentage)-Number.parseFloat(d.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.negativeThreesPercentage)-Number.parseFloat(d.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.negativeTensPercentage)-Number.parseFloat(d.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:l=>t.jsx(ct,{percent:Number.parseFloat(l),size:"small"}),sorter:(l,d)=>Number.parseFloat(l.completionPercentage)-Number.parseFloat(d.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:l=>t.jsx(Cr,{count:4,value:l,disabled:!0}),sorter:(l,d)=>l.level-d.level},{title:"Actions",key:"actions",render:l=>t.jsx(Q,{children:t.jsxs(R.Group,{children:[t.jsx(R,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=grouping&attribute=${l.id}&page=1`),children:"Grouping"}),t.jsx(R,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=sampler&attribute=${l.id}&size=6`),children:"Sample"})]})})}];return t.jsxs(t.Fragment,{children:[t.jsxs(L.Paragraph,{children:["Total: ",u.length]}),t.jsx(ot,{columns:f,dataSource:u,pagination:!1,rowKey:"id",size:"small"}),t.jsx(P,{wrap:"wrap",gap:8,children:a.map(l=>t.jsxs("div",{children:["#",l,t.jsx(Z,{id:`sign-${l}`},l)]},l))})]})}function Zs(e){const r=S.cloneDeep(e);return Me(nt(r),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Js(){const{view:e}=M();return e==="classifier"?t.jsxs(t.Fragment,{children:[t.jsxs(P,{className:"my-4",gap:8,children:[t.jsx(Us,{}),t.jsx(Vs,{})]}),t.jsx(Ds,{}),t.jsx(P,{justify:"flex-end",className:"my-4",children:t.jsx(xt,{})})]}):e==="sampler"?t.jsx(Ws,{}):e==="grouping"?t.jsx(Gs,{}):e==="comparator"?t.jsx(Bs,{}):e==="simulator"?t.jsx(Xs,{}):e==="stats"?t.jsx(qs,{}):t.jsx(ve,{className:"my-10",description:"Unknown view has been selected"})}function en(){const{isLoading:e,error:r,hasResponseData:s}=D();return t.jsx(Kt,{title:"Items",subtitle:"Attribution",children:t.jsxs(_e,{hasSider:!0,children:[t.jsx(ar,{children:t.jsx($s,{})}),t.jsx(_e.Content,{className:"content",children:t.jsx(Xt,{isLoading:e,error:r,hasResponseData:s,children:t.jsx(Js,{})})})]})})}function si(){return t.jsx(Ss,{children:t.jsx(en,{})})}export{si as default};
