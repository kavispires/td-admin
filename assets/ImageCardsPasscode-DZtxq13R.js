import{r as u,a as $,_,j as e,B as P,D as k,Y as J,T as C,P as Q,L as O}from"./index-BmKmifuD.js";import{D as V}from"./DataLoadingWrapper-DfqjV0Gf.js";import{u as A}from"./useQueryParams-Xp2SkAjz.js";import{l as b,P as K}from"./useBaseUrl-CV65xL7T.js";import{I as W}from"./IdTag-D4DpLOX_.js";import{u as Y}from"./useTablePagination-BZXZ9gnP.js";import{I as N}from"./ImageCard-C8XC0jEm.js";import{u as G,A as X}from"./useDebounce-DDgODX-l.js";import{I as w}from"./index-dopZDYz9.js";import{F as Z}from"./Table-t0JrhtBC.js";import{S as q}from"./index-C93JcBPZ.js";import{F as v}from"./index-DZkJ9OT8.js";import{b as U,r as ee,a as se}from"./index-DmSVtCoz.js";import{u as L}from"./useImageCardsDecks-D0C-ZWSS.js";import{S as T}from"./index-CXjb0pZw.js";import{R as M}from"./PlusOutlined-DpG5bC_Y.js";import{T as I}from"./index-3FN9VFKp.js";import{R as ae}from"./CheckCircleFilled-Dlux043B.js";import{F as te}from"./FilterEntries-CRanhvKv.js";import{S as re}from"./SiderContent-CQJYQry7.js";import{D as oe}from"./DownloadButton-tz6fwmNw.js";import{S as de}from"./SaveButton-E-BI8ZxD.js";import{R as ie}from"./TableOutlined-BqAByUUS.js";import{u as ne}from"./useResourceFirestoreData-IMf-Ll2Z.js";import"./useCopyToClipboardFunction-v2jZg77r.js";import"./Input-CEcyoz_o.js";import"./index-Dl0nHeYG.js";import"./index-Bp5RKnu_.js";import"./index-B3nqieae.js";import"./scrollTo-Bya_zsyU.js";import"./Pagination-BT7uN7Tb.js";import"./extendsObject-keMuGWqj.js";import"./gapSize-U1swVQyS.js";import"./constants-B4YYuuBb.js";import"./Item-BDgAGbk3.js";import"./useTDResource-C3kg2Dqy.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-CsRa4iyH.js";import"./index-DmgRV1Ct.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-Gppapl37.js";import"./useGetFirestoreDoc--hH88T1t.js";import"./useUpdateFirestoreDoc-C2ni2j9Y.js";import"./useMutation-Dczd92Es.js";var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"},le=function(r,a){return u.createElement($,_({},r,{ref:a,icon:ce}))},me=u.forwardRef(le);function D({sets:s,addEntryToUpdate:r,hidePagination:a}){const n=Y({total:s.length,showQuickJumper:!0}),i=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,t)=>o.id.localeCompare(t.id)},{title:"Passcode",dataIndex:"passcode",key:"passcode",sorter:(o,t)=>o.passcode[0].localeCompare(t.passcode[0]),render:(o,t)=>e.jsx(pe,{entry:t,addEntryToUpdate:r})},{title:"Cards",dataIndex:"imageCardsIds",key:"imageCardsIds",render:(o,t)=>e.jsx(ue,{entry:t,addEntryToUpdate:r})}];return e.jsx(Z,{columns:i,dataSource:s,className:"my-4",rowKey:"id",pagination:a?void 0:n})}function pe({entry:s,addEntryToUpdate:r}){const a=n=>{r(s.id,{...s,passcode:n})};return e.jsx(q,{mode:"tags",style:{width:300},placeholder:"Add passcode from easier to harder",defaultValue:s.passcode,onChange:a})}function ue({entry:s,addEntryToUpdate:r}){const[a,n]=u.useState(""),i=()=>{a&&(r(s.id,{...s,imageCardsIds:[...s.imageCardsIds,a.trim()]}),n(""))},o=t=>{r(s.id,{...s,imageCardsIds:s.imageCardsIds.filter(d=>d!==t)})};return e.jsxs(v,{gap:6,wrap:"wrap",align:"flex-end",children:[s.imageCardsIds.map(t=>e.jsxs(v,{gap:2,vertical:!0,children:[e.jsx(N,{id:t,width:60}),e.jsx(W,{children:t}),e.jsx(P,{size:"small",onClick:()=>o(t),children:"Remove"})]},t)),e.jsx("div",{children:e.jsx(w,{placeholder:"td-d*",style:{width:100},onChange:t=>n(t.target.value),onPressEnter:i,value:a})})]})}function B(s,r=!1){return u.useMemo(()=>{console.log("Recomputing passcode names typeahead...");const a={},n=Object.values(s).reduce((o,t)=>(t.passcode.forEach(d=>{const j=r?`${d} (${t.id})`:d;o[j]&&console.warn(`Duplicate passcode found: ${d}`,o[j],t.id),o[j]=t.id,t.imageCardsIds.forEach(p=>{a[p]||(a[p]=[]),a[p].push(d)})}),o),{}),i=b.orderBy(Object.keys(n),[o=>o.toLowerCase()]).map(o=>({value:o}));return{namesDict:n,options:i,imagesDict:a}},[s,r])}function he({data:s,onFinish:r}){const{namesDict:a,options:n}=B(s,!0),[i,o]=u.useState([]),[t,d]=u.useState("");G(()=>{t&&j(t)},500,[t]);const j=h=>{if(!h){o([]);return}const x=h.trim().toUpperCase(),y=n.filter(g=>String((g==null?void 0:g.value)??"").toUpperCase().includes(x)),S=b.orderBy(y,[g=>{const c=String((g==null?void 0:g.value)??"").toUpperCase();if(c===x)return 0;const m=c.match(/\((.*?)\)/);if(m&&m[1]===x)return 1;const l=c.indexOf(x);return l===0?2:l>0?3:4}]);o(S)},p=()=>{i.length>0&&a[i[0].value]!==void 0&&r(a[i[0].value])},f=h=>{a[h]!==void 0&&r(a[h])};return e.jsx(X,{options:i,style:{width:250},allowClear:!0,placeholder:"Search...",filterOption:(h,x)=>String((x==null?void 0:x.value)??"").toUpperCase().indexOf(h==null?void 0:h.toUpperCase())!==-1,onSearch:d,notFoundContent:t.length>0?"No items found":"Type to search...",onSelect:f,children:e.jsx(w,{onPressEnter:p})})}const z={id:"",passcode:[],imageCardsIds:[]},F=(s,r)=>Array.from({length:s},()=>({...b.cloneDeep(z),id:U(r)}));function ge(s){const[r,a]=u.useState(F(3,Object.keys(s.data))),n=()=>{a(d=>[...d,{...b.cloneDeep(z),id:crypto.randomUUID().substring(0,5)}])},i=(d,j)=>{a(p=>p.map(f=>f.id===d?j:f))},o=()=>{console.log("Add entries to database"),r.forEach(d=>{d.passcode.length>0&&d.imageCardsIds.length>0&&s.addEntryToUpdate(d.id,d)}),a(F(5,Object.keys(s.data)))},t=u.useMemo(()=>r.some(d=>d.passcode.length>0||d.imageCardsIds.length>0),[r]);return e.jsxs(T,{direction:"vertical",className:"full-width",children:[e.jsx(P,{type:"primary",onClick:o,disabled:!t,children:"Add Entries"}),e.jsx(D,{sets:r,addEntryToUpdate:i}),e.jsx(P,{icon:e.jsx(M,{}),onClick:n,children:"Add row"}),e.jsx(k,{}),e.jsx(xe,{data:s.data,addEntryToUpdate:s.addEntryToUpdate})]})}function xe({data:s,addEntryToUpdate:r}){var g;const[a,n]=u.useState(""),[i,o]=u.useState(""),{namesDict:t,imagesDict:d}=B(s),{onRandomCard:j}=L(),[p,f]=u.useState(""),{message:h}=J.useApp(),x=()=>{a&&o(a)},y=()=>{const c=j();o(c),n(c)},S=()=>{const c=p.split(",").map(m=>m.trim().toLowerCase()).filter(Boolean);c.length>0&&i&&c.forEach(m=>{if(t[m]){const l=s[t[m]];l.imageCardsIds.push(i),l.imageCardsIds=ee(l.imageCardsIds),r(l.id,l)}else{const l={id:U(Object.keys(s)),passcode:[m],imageCardsIds:[i]};r(l.id,l)}}),f(""),y(),h.success("Entries processed")};return e.jsxs(e.Fragment,{children:[e.jsx(C.Title,{level:4,className:"my-0",children:"Create Image Card Multiprompt"}),e.jsxs(T,{className:"full-width",children:[e.jsxs(v,{vertical:!0,gap:8,children:[e.jsxs(v,{children:[e.jsx(w,{onChange:c=>n(c.target.value),placeholder:"Image Card ID",onPressEnter:x,value:a}),e.jsx(P,{onClick:y,children:"Random"})]}),e.jsx(N,{id:i,width:200})]}),e.jsxs(v,{vertical:!0,gap:8,children:[e.jsxs(v,{children:[e.jsx(w,{placeholder:"Names",onChange:c=>f(c.target.value),value:p}),e.jsx(P,{type:"primary",disabled:!i||!p,onClick:S,children:"Process"})]}),e.jsx(v,{gap:8,wrap:!0,children:p.split(",").map(c=>{const m=c.trim().toLowerCase(),l=t[m];return e.jsx(I,{icon:l?e.jsx(ae,{}):e.jsx(M,{}),color:l?"blue":"green",children:m},m)})}),e.jsx(v,{gap:8,wrap:!0,children:d[i]&&e.jsxs(e.Fragment,{children:[e.jsx(C.Text,{type:"secondary",children:"Already in:"}),(g=d[i])==null?void 0:g.map(c=>e.jsx(I,{children:c},c))]})})]})]})]})}function je(s){L();const{is:r,queryParams:a}=A();return e.jsxs(e.Fragment,{children:[(r("display","table")||!a.has("display"))&&e.jsx(fe,{...s}),r("display","create")&&e.jsx(ge,{...s})]})}function fe(s){const r=u.useMemo(()=>b.orderBy(Object.values(s.data),["id","passcode"]),[s.data]),[a,n]=u.useState();return e.jsxs(T,{direction:"vertical",className:"full-width my-4",children:[e.jsx(he,{data:s.data,onFinish:i=>n(i)}),a&&e.jsxs(e.Fragment,{children:[e.jsx(D,{sets:[s.data[a]],addEntryToUpdate:s.addEntryToUpdate,hidePagination:!0}),e.jsx(P,{size:"small",onClick:()=>n(null),children:"Clear search"})]}),e.jsx(D,{sets:r,addEntryToUpdate:s.addEntryToUpdate})]})}function Ce({data:s,save:r,isDirty:a,isSaving:n,entriesToUpdate:i,hasFirestoreData:o}){const{addParams:t,queryParams:d}=A(),{complete:j,incomplete:p,varied:f,mappings:h,mappedImages:x,overdone:y}=u.useMemo(()=>{let S=0,g=0,c=0,m=0,l=0;const R={};return Object.values(s).forEach(E=>{E.imageCardsIds.length>=3&&S++,E.imageCardsIds.length>4&&c++,E.imageCardsIds.length<3&&g++,E.passcode.length>3&&m++,l+=E.imageCardsIds.length,E.imageCardsIds.forEach(H=>{R[H]=!0})}),{complete:S,incomplete:g,varied:m,mappings:l,mappedImages:Object.keys(R).length,overdone:c}},[s]);return e.jsxs(re,{children:[e.jsxs(v,{vertical:!0,gap:12,children:[e.jsx(de,{isDirty:a,onSave:r,isSaving:n,dirt:JSON.stringify(i)}),e.jsx(oe,{data:()=>Ie(s),fileName:"daily-passcode-sets.json",disabled:a,hasNewData:o,block:!0})]}),e.jsx(k,{}),e.jsx(te,{label:"Display",value:d.get("display")??"table",onChange:S=>t({display:S,page:1},{page:1,display:"table"}),options:[{title:"Table",icon:e.jsx(ie,{}),value:"table"},{title:"Create",icon:e.jsx(me,{}),value:"create"}]}),e.jsx("p",{children:"Stats"}),e.jsxs(C.Text,{children:["Passcode sets: ",e.jsx(I,{children:Object.keys(s).length})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Complete: ",e.jsx(I,{color:"green-inverse",children:j})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Incomplete: ",e.jsx(I,{color:"gold-inverse",children:p})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Overdone: ",e.jsx(I,{color:"purple",children:y})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Varied: ",e.jsx(I,{children:f})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Mappings: ",e.jsx(I,{children:h})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Unique images: ",e.jsx(I,{children:x})]})]})}function Ie(s){console.log("Preparing file for download...");const r=b.cloneDeep(s);return se(r)}function ms(){const s=ne({tdrResourceName:"daily-passcode-sets",firestoreDataCollectionName:"imagePasscode",serialize:!0});return e.jsx(Q,{title:"Image Cards Passcode Sets",subtitle:"Daily Set Entries",children:e.jsxs(O,{hasSider:!0,children:[e.jsx(K,{children:e.jsx(Ce,{...s})}),e.jsx(O.Content,{className:"content",children:e.jsx(V,{isLoading:s.isLoading,error:s.error,hasResponseData:!b.isEmpty(s.data),children:e.jsx(je,{...s})})})]})})}export{ms as ImageCardsPasscode,ms as default};
