import{r as S,a as xe,j as r,ai as L,T as F,ad as je,B as J,aL as le,aM as Ae,aN as ye,X as Se,W as De,Y as ee,$ as se,Z as te,P as Ne,L as ie}from"./index-BHrRQ1uq.js";import{R as Oe}from"./ResponseState-fIQi1M-X.js";import{u as be}from"./useQueryParams-Cr8fZCN0.js";import{C as Ee,u as ce}from"./useArteRuimDrawings-B927Zky7.js";import{I as ne}from"./ImageCard-DDGT4T7O.js";import{f as Ce,W as Te,d as Q,g as Y,h as Le}from"./constants-B_q3c2xJ.js";import{I as q}from"./Item-DXicAdtS.js";import{l as m}from"./lodash-f0m46xYx.js";import{F as E}from"./index-CjtWJUFP.js";import{S as U}from"./index-Co7aD7RO.js";import{T as ve}from"./index-Db_5R2-z.js";import{u as we}from"./useGetFirebaseDoc-xE0GJyOY.js";import{h as re}from"./moment-C5S46NFB.js";import{I as _e}from"./index-DuBa27hb.js";import{F as de}from"./Table-CGPLlxUi.js";import{m as Re,r as k}from"./index-Rk2ZCQ0l.js";import{u as Me}from"./daily-teoria-de-conjuntos-Cij07fYg.js";import{u as Ge}from"./useMutation-Cs1gCno8.js";import{u as M,D as p,g as G,c as ue,L as me}from"./constants-ddEaHlnY.js";import{u as v}from"./useTDResource-wK2jd69j.js";import{u as pe}from"./useDailyHistoryQuery-Djems2WT.js";import{R as Qe}from"./SaveOutlined-DugEzKbM.js";import{a as H}from"./FilterEntries-BiZjj4NT.js";import{S as ke}from"./SiderContent-Dj_cqrIg.js";import{u as z}from"./useLoadWordLibrary-B9XUDTfP.js";import{D as Ue}from"./DataLoadingWrapper-DKkg9HZe.js";import{P as Pe}from"./useBaseUrl--32bgvsR.js";import"./index-BHuPI7uO.js";import"./gapSize-U1swVQyS.js";import"./Input-cdsOURLH.js";import"./index-CkYVgnOz.js";import"./index-DL-QmAap.js";import"./index-BESd2kFy.js";import"./index-Cm-andhV.js";import"./scrollTo-CnYqteaX.js";import"./Pagination-DPx5Huu7.js";import"./extendsObject-keMuGWqj.js";import"./index-7mXcI-6s.js";var qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M396 512a112 112 0 10224 0 112 112 0 10-224 0zm546.2-25.8C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM508 688c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z"}}]},name:"eye",theme:"filled"};function K(){return K=Object.assign?Object.assign.bind():function(s){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(s[o]=a[o])}return s},K.apply(this,arguments)}const Ve=(s,i)=>S.createElement(xe,K({},s,{ref:i,icon:qe})),Be=S.forwardRef(Ve);function w({children:s}){return r.jsx(U,{direction:"vertical",style:{maxWidth:120},children:s})}function _({children:s}){return r.jsxs(ve,{color:"cyan",children:["#",s]})}function b({label:s,children:i}){return r.jsxs(F.Text,{children:[r.jsxs("strong",{children:[s,":"]})," ",i]})}function R({children:s}){return r.jsx(je,{trigger:"click",content:s,title:"Sneak Peek",children:r.jsx(J,{icon:r.jsx(Be,{})})})}const ge=[{title:"Id",dataIndex:"id",key:"id",fixed:"left"},{title:"Arte Ruim",dataIndex:"arte-ruim",key:"arte-ruim",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,cardId:a,text:o,drawings:e}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"CardId",children:a}),r.jsx(b,{label:"Drawings",children:e.length}),r.jsx(R,{children:r.jsxs(E,{gap:6,vertical:!0,children:[r.jsxs("div",{children:['"',o.split("").map((t,l)=>l<2||t===" "?t:"⏹").join(""),'"']}),r.jsx(U,{wrap:!0,children:e.map(t=>r.jsx(Ee,{drawing:t,width:75,height:75,className:"canvas"},t))})]})})]})}},{title:"Aqui O",dataIndex:"aqui-o",key:"aqui-o",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,setId:a,title:o,itemsIds:e}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"SetId",children:a}),r.jsx(b,{label:"Title",children:o.pt}),r.jsx(b,{label:"Items",children:e.length}),r.jsx(R,{children:r.jsx(E,{gap:6,wrap:!0,style:{maxWidth:500},children:e.map(t=>r.jsx(q,{id:t,width:50},t))})})]})}},{title:"Alienígena",dataIndex:"comunicacao-alienigena",key:"comunicacao-alienigena",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,itemsIds:a,attributes:o}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"Items",children:a.length}),r.jsx(R,{children:r.jsxs(E,{gap:6,style:{maxWidth:"300px"},vertical:!0,children:[r.jsx(U,{wrap:!0,children:o.map(e=>r.jsx(Ce,{id:`sign-${e.spriteId}`,width:50},e.spriteId))}),r.jsx(U,{wrap:!0,children:a.map(e=>r.jsx(q,{id:e,width:50},e))})]})})]})}},{title:"Conjuntos",dataIndex:"teoria-de-conjuntos",key:"teoria-de-conjuntos",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,rule1:a,intersectingThing:o,rule2:e,title:t}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"Title",children:t}),r.jsx(R,{children:r.jsxs(E,{gap:6,children:[r.jsx(q,{id:a.thing.id,width:50}),r.jsx(q,{id:o.id,width:50}),r.jsx(q,{id:e.thing.id,width:50})]})})]})}},{title:"Estoque",dataIndex:"controle-de-estoque",key:"controle-de-estoque",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,title:a,goods:o}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"Title",children:a}),r.jsx(b,{label:"Goods",children:o.length}),r.jsx(R,{children:r.jsx(E,{gap:6,wrap:!0,style:{maxWidth:245},children:o.map(e=>r.jsx(Te,{id:e,width:50},e))})})]})}},{title:"Filmaço",dataIndex:"filmaco",key:"filmaco",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,setId:a,title:o,year:e}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"SetId",children:a}),r.jsx(R,{children:r.jsxs(E,{gap:6,vertical:!0,children:[r.jsxs("span",{children:["Year: ",e]}),r.jsxs("span",{children:["Title:"," ",o.split("").map((t,l)=>l<1||t===" "?t:"⏹").join("")]})]})})]})}},{title:"Palavreado",dataIndex:"palavreado",key:"palavreado",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,letters:a,keyword:o,words:e}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"Letters",children:a.length}),r.jsx(b,{label:"Keyword",children:o}),r.jsx(R,{children:r.jsx(U,{direction:"vertical",children:e.map((t,l)=>r.jsx("span",{children:t.split("").map((c,n)=>n===l||c===" "?c:"⏹").join("")},`${i}-${t}`))})})]})}},{title:"Portais",dataIndex:"portais-magicos",key:"portais-magicos",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,setId:a,corridors:o}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"SetId",children:m.truncate(a,{length:9})}),r.jsx(R,{children:r.jsx(E,{gap:6,vertical:!0,children:o.map(e=>r.jsxs(E,{gap:6,vertical:!0,children:[r.jsxs("span",{children:["Passcode: ",e.passcode]}),r.jsx(E,{children:e.imagesIds.map(t=>r.jsx(ne,{id:t,width:50},t))})]},e.passcode))})})]})}},{title:"Quartetos",dataIndex:"quartetos",key:"quartetos",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,setId:a,sets:o}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"SetId",children:m.truncate(a,{length:9})}),r.jsx(R,{children:r.jsx(E,{gap:6,children:o.map(e=>r.jsx(E,{gap:6,vertical:!0,children:e.itemsIds.map(t=>r.jsx(q,{id:t,width:50},t))},e.id))})})]})}},{title:"Picaço",dataIndex:"artista",key:"artista",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,cards:a}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"Cards",children:a.length}),r.jsx(R,{children:r.jsx(E,{gap:6,vertical:!0,style:{maxHeight:500,overflowY:"auto"},children:a.map((o,e)=>r.jsx("span",{children:o.text},`${o.id}-${e}`))})})]})}},{title:"Tá Na Cara",dataIndex:"ta-na-cara",key:"ta-na-cara",render:s=>{if(!s)return r.jsx(L,{message:"No entry",type:"error"});const{number:i,suspectsIds:a,testimonies:o}=s;return r.jsxs(w,{children:[r.jsx(_,{children:i}),r.jsx(b,{label:"Suspects",children:a==null?void 0:a.length}),r.jsx(b,{label:"Questions",children:o.length}),r.jsx(R,{children:r.jsxs(E,{vertical:!0,children:[r.jsx(U,{direction:"vertical",style:{maxHeight:100,overflowY:"auto"},children:o.map(e=>r.jsx("span",{children:e.question},e.testimonyId))}),r.jsx(U,{wrap:!0,style:{maxHeight:200,maxWidth:"500px",overflowY:"auto"},children:a==null?void 0:a.map(e=>r.jsx(ne,{id:e,width:48},e))})]})})]})}}];function Fe(){const[s,i]=S.useState(""),[a,o]=S.useState(!1),{isLoading:e,data:t}=we("diario",s,{enabled:!!s&&a}),l=S.useMemo(()=>t?[t]:[],[t]),c=d=>{o(!1),i(d.trim())},n=()=>{console.log(s,re(s,"YYYY-MM-DD",!0).isValid()),o(re(s,"YYYY-MM-DD",!0).isValid())};return console.log(t),r.jsxs("div",{children:[r.jsx(F.Title,{level:2,children:"Data Verification"}),r.jsx(le,{to:"/game/daily-setup",children:"Go to Setup"}),r.jsxs(E,{justify:"space-between",align:"center",className:"mb-2",children:[r.jsxs(U.Compact,{children:[r.jsx(_e,{placeholder:"YYYY-MM-DD",onChange:d=>c(d.target.value)}),r.jsx(J,{type:"primary",onClick:n,children:"Load"})]}),s," ",a?"Valid":"Invalid",r.jsx(J,{disabled:!0,type:"primary",size:"large",children:"Save"})]}),r.jsx(de,{loading:e,columns:ge,dataSource:l,scroll:{x:"max-content"}})]})}const W=new ye({}),X=(s,i)=>{W.setState(a=>({...a,[s]:i}))},Je=()=>{W.setState(()=>({}))},We=()=>Ae(W,()=>W.state),Ye=(s,i,a,o)=>{const[e]=M(p.AQUI_O,o),t=v("items",s),l=v("daily-disc-sets",s);return{entries:S.useMemo(()=>!s||!l.isSuccess||!e||!t.isSuccess?{}:$e(a,e,l.data,t.data),[s,l,t,e,a]),isLoading:t.isLoading||l.isLoading}},$e=(s,i,a,o)=>{console.count("Creating Aqui Ó...");const e=m.shuffle(Object.values(a).filter(d=>d.itemsIds.filter(Boolean).length>=20)),t=e.filter(d=>!i.used.includes(d.id));t.length<s&&(console.log("🔆 Not enough aqui-o sets left, shuffling..."),X("aqui-o","Not enough aqui-o sets left"),t.push(...m.shuffle(e)));const l=Object.values(o).filter(d=>d!=null&&d.nsfw?!1:m.intersection(d.decks??[],["alien","dream","thing"]).length>0);let c=i.latestDate;const n={};for(let d=0;d<s;d++){const g=t[d];g||console.error("No aqui-o sets left");const u=G(c),I=ue(u);c=u,I?n[u]={id:u,type:"aqui-o",number:i.latestNumber+d+1,setId:"special",title:{pt:"Especial Fim de Semana",en:"Weekend Special"},itemsIds:["0",...m.sampleSize(l,25).map(x=>x.id)]}:n[u]={id:u,type:"aqui-o",number:i.latestNumber+d+1,setId:g.id,title:g.title,itemsIds:["0",...m.sampleSize(g.itemsIds,20)]}}return n},Ze=(s,i,a,o)=>{const[e]=M(p.ARTE_RUIM,o),t=ce(s,i);return{entries:S.useMemo(()=>!s||t.isLoading||!e?[]:He(a,e,t,i),[s,t,i,e,a,t.isLoading]),isLoading:t.isLoading}},He=(s,i,a,o)=>{console.count("Creating Arte Ruim...");const e=Object.values(a.drawings).filter(n=>!(i.used.includes(n.id)||n.drawings.length<3)).map(n=>({id:n.id,type:"arte-ruim",language:o??"pt",cardId:n.id,text:n.text,drawings:n.drawings.map(d=>d.drawing),number:0,dataIds:n.drawings.map(d=>d.id)})),t=m.sampleSize(m.shuffle(e),s);let l=i.latestDate;return t.map((n,d)=>{const g=G(l);return l=g,{...n,id:g,number:i.latestNumber+d+1}})},ze=(s,i,a,o,e)=>{const[t]=M(p.ARTISTA,o),[l]=M(p.ARTE_RUIM,o),c=v(`arte-ruim-cards-${i}`,s),n=ce(s,i);return{entries:S.useMemo(()=>{if(!s||!c.isSuccess||n.isLoading||!t)return{};const g=e.map(u=>u.cardId);return Ke(a,t,l,c.data,g,n.drawings)},[s,c,l,t,a,e,n.drawings,n.isLoading]),isLoading:c.isLoading||n.isLoading}},Ke=(s,i,a,o,e,t)=>{console.count("Creating Artista...");let l=i.latestDate;const c={};for(let n=0;n<s;n++){const d=G(l),g=Object.keys(o??{}).filter(I=>{var x,A;return!a.used.includes(I)&&!e.includes(I)&&((A=(x=t==null?void 0:t[I])==null?void 0:x.drawings)==null?void 0:A.length)<3}),u=m.sampleSize(g,20).map(I=>o[I]);l=d,c[d]={id:d,type:"artista",number:i.latestNumber+n+1,cards:u}}return c},Xe=(s,i,a,o)=>{const[e]=M(p.COMUNICACAO_ALIENIGENA,o),t=v("items",s),l=v("items-attributes",s),c=v("items-attribute-values",s);return{entries:S.useMemo(()=>!s||!e||!l.isSuccess||!c.isSuccess||!t.isSuccess?{}:es(a,e,l.data,c.data,t.data),[s,a,e,e,l,c,t]),isLoading:t.isLoading||l.isLoading||c.isLoading}},es=(s,i,a,o,e)=>{console.count("Creating Comunicacao Alienigena...");let t=i.latestDate;const l=m.values(a),c=m.values(o).filter(u=>{var I;return u.complete&&((I=e==null?void 0:e[u.id])==null?void 0:I.nsfw)!==!0}),n={};let d=0;for(;m.keys(n).length<s&&d<100;){const u=ss(l,c);if(u.valid&&!n[u.setId]&&!i.used.includes(u.setId)&&(n[u.setId]=u),m.keys(n).length>=s)break;d+=1}console.log(`🔆 Generating this batch took ${d} tries`),d>=100&&X("comunicacao-alienigena","Not enough valid comunicacao alienigena games (over 100 attempts)");const g={};return Object.values(n).forEach((u,I)=>{const x=G(t);t=x,g[x]={...u,id:x,number:i.latestNumber+I+1}}),g},ss=(s,i)=>{const a=m.shuffle(i),o=m.shuffle(Re(50,0)),e=m.sampleSize(s,3).map(h=>({...h,spriteId:`${o.pop()}`})),t=[],l=[],c=[],n=[],d=[],g=[],u=[],I=[];a.forEach(h=>{const P=[Q.DETERMINISTIC,Q.RELATED],j=h.attributes[e[0].id]===Q.DETERMINISTIC,C=P.includes(h.attributes[e[0].id]),T=h.attributes[e[0].id]===Q.UNRELATED,fe=h.attributes[e[1].id]===Q.DETERMINISTIC,$=P.includes(h.attributes[e[1].id]),V=h.attributes[e[1].id]===Q.UNRELATED,Ie=h.attributes[e[2].id]===Q.DETERMINISTIC,Z=P.includes(h.attributes[e[2].id]),B=h.attributes[e[2].id]===Q.UNRELATED;if(T&&V&&B)return I.push(h.id);j&&V&&B&&t.push(h.id),T&&fe&&B&&l.push(h.id),T&&V&&Ie&&c.push(h.id),C&&$&&B&&n.push(h.id),C&&V&&Z&&d.push(h.id),T&&$&&Z&&g.push(h.id),C&&$&&Z&&u.push(h.id)});const x=e.map(h=>({id:h.id,name:h.name.pt,description:h.description.pt,spriteId:h.spriteId,itemsIds:[]}));x[0].itemsIds=m.sampleSize(t,t.length>3?3:Math.max(t.length-1,1)),x[1].itemsIds=m.sampleSize(l,l.length>3?3:Math.max(t.length-1,1)),x[2].itemsIds=m.sampleSize(c,c.length>3?3:Math.max(t.length-1,1));const A=[];x.forEach(h=>{A.push(...h.itemsIds)});const N=[];n.length>0&&N.push({spritesIds:[e[0].spriteId,e[1].spriteId],itemId:m.sample(n)??""}),d.length>0&&N.push({spritesIds:[e[0].spriteId,e[2].spriteId],itemId:m.sample(d)??""}),g.length>0&&N.push({spritesIds:[e[1].spriteId,e[2].spriteId],itemId:m.sample(g)??""}),u.length>0&&N.push({spritesIds:e.map(h=>h.spriteId),itemId:m.sample(u)??""});const D=[];t.length>0&&D.push({spritesIds:[e[0].spriteId],itemId:t.filter(h=>!A.includes(h))[0]}),l.length>0&&D.push({spritesIds:[e[1].spriteId],itemId:l.filter(h=>!A.includes(h))[0]}),c.length>0&&D.push({spritesIds:[e[2].spriteId],itemId:c.filter(h=>!A.includes(h))[0]});let O=m.sampleSize(N,4);O.length<3&&O.push(...m.sampleSize(D,4-O.length)),O.length<4&&console.log("🔆 Not enough requests for an alien communication, marking it as invalid"),O=m.shuffle(O);const y=O.map(h=>h.itemId),f={id:"0000-00-00",setId:x.map(h=>h.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:x,requests:O,solution:y.join("-"),itemsIds:m.shuffle([...y,...m.sampleSize([I[0],I[1],I[2],I[3]],m.random(1,3))]).filter(Boolean),valid:!1};return f.valid=[f.attributes.length===3,f.requests.length===4,f.itemsIds.length>4,f.attributes.every(h=>h.itemsIds.length>0),f.requests.every(h=>h.itemId)].every(Boolean),f},ts=(s,i,a,o)=>{const[e]=M(p.CONTROLE_DE_ESTOQUE,o);return{entries:S.useMemo(()=>!s||!e?{}:is(a,e),[s,a,e]),isLoading:!1}},is=(s,i)=>{console.count("Creating Controle de Estoque...");let a=i.latestDate;const o={};for(let e=0;e<s;e++){const t=G(a);a=t,o[t]=ls(t,i.latestNumber+e+1)}return o},ns=256,rs=16,as=4,os=1,ls=(s,i)=>{const[a,o,e]=s.split("-").map(Number),l=new Date(a,o-1,e).getDay(),c=["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"][l],n={id:s,number:i,type:"controle-de-estoque",language:"pt",title:c,goods:[],orders:[]},d=m.sampleSize(Array(ns).fill("").map((u,I)=>`good-${I+1}`),rs+os),g=d.pop();if(n.goods=d,n.orders=m.sampleSize(n.goods,as),!g)throw new Error("No out of stock good");return n.orders.push(g),n.orders=m.shuffle(n.orders),n},cs=(s,i,a,o)=>{const[e]=M(p.FILMACO,o),t=v("daily-movie-sets",s);return{entries:S.useMemo(()=>!s||!t.isSuccess||!e?{}:(Object.values(t.data).filter(n=>n.itemsIds.length>0&&!e.used.includes(n.id)).length<=a&&X("filmaco","Not enough unused films"),ds(a,e,t.data)),[s,t,e,a]),isLoading:t.isLoading}},ds=(s,i,a)=>{console.count("Creating Filmaço...");const o=m.shuffle(Object.values(a).filter(c=>c.itemsIds.filter(Boolean).length>0)),e=o.filter(c=>!i.used.includes(c.id));e.length<s&&e.push(...m.shuffle(o));let t=i.latestDate;const l={};for(let c=0;c<s;c++){const n=e[c];if(!n){console.error("No filmaço sets left");break}const d=G(t);t=d,l[d]={id:d,type:"filmaco",number:i.latestNumber+c+1,setId:n.id,title:n.title,itemsIds:n.itemsIds,year:n.year}}return l},us=(s,i,a,o)=>{const[e]=M(p.PALAVREADO,o),t=z(4,i,s),l=z(5,i,s);return{entries:S.useMemo(()=>!s||!t.data||!t.data.length||!l.data||!l.data.length||!e?{}:ms(a,e,t.data,l.data),[s,t,l,e,a]),isLoading:t.isLoading||l.isLoading}},ms=(s,i,a,o)=>{console.count("Creating Palavreado...");let e=i.latestDate;const t=[],l={};for(let c=0;c<s;c++){const n=G(e),d=ue(n),g=d?5:4;e=n,l[n]={id:n,type:"palavreado",number:i.latestNumber+c+1,...ps(d?o:a,[...Object.values(l).map(u=>u.keyword),...i.used],t,g)}}return l},ps=(s,i,a,o=4,e)=>{let t=m.shuffle(m.difference(s,a,i));const l=e||(t.pop()??""),c=[];for(let n=0;n<o;n++){const d=gs(s,l,c,n);c.push(d)}return a.push(l,...c),{keyword:l,words:c,letters:hs(c,l.length)}},gs=(s,i,a,o)=>{const e=m.uniq([...m.flatMap(a.map(c=>c.split(""))),...i.split("")]),t=m.shuffle(s.filter(c=>c[o]===i[o]&&!a.includes(c)));return m.sortBy(t,c=>m.intersection(c.split(""),e).length)[0]},hs=(s,i)=>{const a=m.flatMap(s.map(l=>l.split(""))),o=i===4?[0,5,10,15]:[0,6,12,18,24],e=m.shuffle(a.filter((l,c)=>!o.includes(c))),t=[];for(let l=0;l<a.length;l++)o.includes(l)?t.push(a[l]):t.push(e.shift()??"");return t},fs=(s,i,a,o)=>{const[e]=M(p.PORTAIS_MAGICOS,o),t=v("daily-passcode-sets",s),l=z(3,i,s);return{entries:S.useMemo(()=>{if(!s||!t.isSuccess||!l.isSuccess||!e)return{};const n=l.data.reduce((d,g)=>(g.split("").forEach(u=>{d[u]||(d[u]=[]),d[u].push(g)}),d),{" ":["  "],"-":[" - "]});return Is(a,e,t.data,n)},[s,a,t.isSuccess,t.data,l.isSuccess,l.data,e]),isLoading:t.isLoading||l.isLoading}},Is=(s,i,a,o)=>{console.count("Creating Portais Mágicos...");let e=i.latestDate;const t=i.used,l={};let c=m.shuffle(Object.values(a).filter(d=>d.imageCardsIds.length>0));const n={};for(let d=0;d<s;d++){const g=G(e),u=[];let I=[...c];const x=[];for(;x.length<3;){const A=I.pop();if(!A)throw new Error("Not enough sets available");const N=m.sample(A.passcode.filter(f=>f.length<=12&&!t.includes(f)))||"";if(!N)continue;const D=x.length+1;u.push(A.id),l[A.id]=!0;const O=N.split("").map(f=>m.sample(o[f])||` ${f} `),y=m.sampleSize(A.imageCardsIds,D);x.push({passcode:N,imagesIds:y,words:O}),I=I.filter(f=>!l[f.id]&&f.imageCardsIds.length>D)}e=g,n[g]={id:g,type:"portais-magicos",setId:u.join(Y),number:i.latestNumber+d+1,corridors:x.reverse()},c=c.filter(A=>!l[A.id])}return n},xs=(s,i,a,o)=>{const[e]=M(p.QUARTETOS,o),t=v("daily-quartet-sets",s),l=v("items-groups",s);return{entries:S.useMemo(()=>!s||t.isLoading||l.isLoading||!e?{}:js(a,e,i,t.data,l.data),[s,i,e,a,t,l]),isLoading:t.isLoading||l.isLoading}},js=(s,i,a,o,e)=>{console.count("Creating Quartetos...");let t=Object.values(o).filter(n=>n.itemsIds.length>=4&&!i.used.includes(n.id)&&!n.flagged),l=i.latestDate;const c={};return Array.from({length:s}).forEach((n,d)=>{const g=[],u={};let I=m.cloneDeep(t),x=0;for(;g.length<3&&x<500;){const j=m.sample(I);if(!j)throw Error("No potential set found for Quartetos game");I=I.filter(T=>T.id!==j.id);const C=m.orderBy(m.sampleSize(j.itemsIds,4),T=>Number(T));if(C.some(T=>u[T])){x++;continue}j.itemsIds.forEach(T=>{u[T]=!0}),g.push({id:j.id,title:j.title,itemsIds:C,level:j.level??1}),x=0}const A=g.map(j=>j.id);t=t.filter(j=>!A.includes(j.id));const N=Object.values(e).filter(j=>j.itemsIds.some(C=>!u[C])&&j.itemsIds.length>=4&&j.nsfw!==!0),D=m.sample(N);if(!D)throw Error("No eligible group found for Quartetos game");g.push({id:D.id,title:m.capitalize(D.name[a]),itemsIds:m.sampleSize(D.itemsIds,4),level:1});const O=Math.ceil(g.reduce((j,C)=>j+C.level,0)/g.length),y=m.orderBy(g,["level"],["desc"]).map((j,C)=>(j.level=C,j)),f=g.map(j=>j.id).join(Y),h=m.shuffle(g.flatMap(j=>j.itemsIds)),P=G(l);l=P,c[P]={id:P,number:i.latestNumber+d+1,setId:f,type:"quartetos",grid:h,difficulty:O,sets:y}}),c},As=(s,i)=>k([...s,...i.flatMap(a=>a.sets.map(o=>o.id))]),ys=(s,i,a,o)=>{const[e]=M(p.TA_NA_CARA,o),t=v("suspects",s),l=v(`testimony-questions-${i}`,s);return{entries:S.useMemo(()=>!s||!t.isSuccess||!l.isSuccess||!e?{}:Ss(a,e,t.data,l.data),[s,t,l,e,a]),isLoading:t.isLoading||l.isLoading}},ae=15,oe=13,Ss=(s,i,a,o)=>{console.count("Creating Tá Na Cara...");const e=he(i.used),t=m.orderBy(m.shuffle(Object.values(a)).map(d=>{const[,g]=d.id.split("-");return`us-gb-${g}`}),[d=>e==null?void 0:e[d]],["asc"]).slice(0,oe*2),l=m.orderBy(m.shuffle(Object.values(o)),[d=>e==null?void 0:e[d.id]],["asc"]).slice(0,ae*2);let c=i.latestDate;const n={};for(let d=0;d<s;d++){const g=m.sampleSize(l,ae).map(I=>({testimonyId:I.id,question:I.question,nsfw:!!I.nsfw})),u=G(c);c=u,n[u]={id:u,type:"ta-na-cara",number:i.latestNumber+d+1,suspectsIds:m.sampleSize(t,oe),testimonies:g}}return n},he=s=>s.reduce((i,a)=>{const o=a.split(Y),e=o[0],t=Number(o[1]);return i[e]=t||0,i},{}),Ds=(s,i)=>{const a=he(s);return i.forEach(o=>{var e;o.testimonies.forEach(t=>{a[t.testimonyId]===void 0&&(a[t.testimonyId]=0),a[t.testimonyId]+=1}),(e=o.suspectsIds)==null||e.forEach(t=>{a[t]===void 0&&(a[t]=0),a[t]+=1})}),Object.entries(a).map(([o,e])=>`${o}${Y}${e}`)};function Ns(s,i,a){const o=me.DAILY[i??"pt"],e=pe(o,{enabled:s});S.useEffect(()=>{Je()},[a,i]);const t=s&&e.isSuccess,l=Ye(t,i,a,e.data??{}),c=Ze(t,i,a,e.data??{}),n=Xe(t,i,a,e.data??{}),d=ts(t,i,a,e.data??{}),g=cs(t,i,a,e.data??{}),u=us(t,i,a,e.data??{}),I=xs(t,i,a,e.data??{}),x=Me(t,i,a,e.data??{}),A=fs(t,i,a,e.data??{}),N=ze(t,i,a,e.data??{},c.entries),D=ys(t,i,a,e.data??{}),O=S.useMemo(()=>c.entries.length===0?[]:(console.count("Bundling entries..."),c.entries.map(y=>({id:y.id,"arte-ruim":y,"aqui-o":l.entries[y.id],"comunicacao-alienigena":n.entries[y.id],"controle-de-estoque":d.entries[y.id],filmaco:g.entries[y.id],palavreado:u.entries[y.id],"portais-magicos":A.entries[y.id],quartetos:I.entries[y.id],"teoria-de-conjuntos":x.entries[y.id],artista:N.entries[y.id],"ta-na-cara":D.entries[y.id]}))),[c.entries,l.entries,g.entries,n.entries,d.entries,u.entries,A.entries,I.entries,x.entries,N.entries,D.entries]);return{isLoading:e.isLoading||l.isLoading||c.isLoading||n.isLoading||d.isLoading||g.isLoading||u.isLoading||A.isLoading||I.isLoading||x.isLoading||N.isLoading||D.isLoading,entries:O}}function Os(s){const{notification:i}=Se.useApp(),a=De(),o=me.DAILY[s??"pt"],[e,t]=S.useState(!1),l=pe(o,{enabled:!!o}),c=Ge({mutationFn:async n=>{var x,A,N,D,O,y;const d=n.map(f=>{const h=ee(se,`${o}/${f.id}`);return te(h,f)}),g=ee(se,`${o}/history`),u=l.data;if(!u)throw new Error("No previous history");const I={...u,[p.ARTE_RUIM]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.ARTE_RUIM].number,used:JSON.stringify(k([...JSON.parse(u[p.ARTE_RUIM].used),...n.map(f=>f[p.ARTE_RUIM].cardId)]))},[p.AQUI_O]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.AQUI_O].number,used:JSON.stringify(k([...JSON.parse(u[p.AQUI_O].used??"[]"),...n.map(f=>f[p.AQUI_O].setId)]))},[p.PALAVREADO]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.PALAVREADO].number,used:JSON.stringify(k([...JSON.parse(u.palavreado.used),...n.map(f=>f[p.PALAVREADO].keyword)]))},[p.ARTISTA]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.ARTISTA].number,used:"[]"},[p.FILMACO]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.FILMACO].number,used:JSON.stringify(k([...JSON.parse(((x=u==null?void 0:u[p.FILMACO])==null?void 0:x.used)??"[]"),...n.map(f=>f[p.FILMACO].setId)]))},[p.CONTROLE_DE_ESTOQUE]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.CONTROLE_DE_ESTOQUE].number,used:"[]"},[p.TEORIA_DE_CONJUNTOS]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.TEORIA_DE_CONJUNTOS].number,used:JSON.stringify(k([...JSON.parse(((A=u==null?void 0:u[p.TEORIA_DE_CONJUNTOS])==null?void 0:A.used)??"[]"),...n.map(f=>f[p.TEORIA_DE_CONJUNTOS].setId),...n.map(f=>f[p.TEORIA_DE_CONJUNTOS].intersectingThing.id)]))},[p.COMUNICACAO_ALIENIGENA]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.COMUNICACAO_ALIENIGENA].number,used:JSON.stringify(k([...JSON.parse(((N=u==null?void 0:u[p.COMUNICACAO_ALIENIGENA])==null?void 0:N.used)??"[]"),...n.map(f=>f[p.COMUNICACAO_ALIENIGENA].setId)]))},[p.QUARTETOS]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.QUARTETOS].number,used:JSON.stringify(As(JSON.parse(((D=u==null?void 0:u[p.QUARTETOS])==null?void 0:D.used)??"[]"),n.map(f=>f[p.QUARTETOS])))},[p.TA_NA_CARA]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.TA_NA_CARA].number,used:JSON.stringify(Ds(JSON.parse(((O=u==null?void 0:u[p.TA_NA_CARA])==null?void 0:O.used)??"[]"),n.map(f=>f[p.TA_NA_CARA])))},[p.PORTAIS_MAGICOS]:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][p.PORTAIS_MAGICOS].number,used:JSON.stringify(k([...JSON.parse(((y=u==null?void 0:u[p.PORTAIS_MAGICOS])==null?void 0:y.used)??"[]"),...n.map(f=>f[p.PORTAIS_MAGICOS].corridors.map(h=>h.passcode))].flat()))}};return te(g,I),Promise.all(d)},onSuccess:()=>{i.info({message:"Data saved",placement:"bottomLeft"}),a.invalidateQueries({queryKey:[o,"history"]}),t(!1)},onError:()=>{i.error({message:"Error saving data",placement:"bottomLeft"})}});return{isDirty:e,setIsDirty:t,save:c.mutateAsync,isPending:c.isPending}}function bs({language:s,dataLoad:i}){const a=s,{is:o}=be(),e=We();console.log(e);const{save:t,isPending:l}=Os(a??"pt");return o("dataCheck")?r.jsx(Fe,{}):r.jsxs("div",{children:[r.jsx(F.Title,{level:2,children:"Data Population"}),i.isLoading&&r.jsx("div",{children:"Loading..."}),r.jsxs(E,{justify:"space-between",align:"center",children:[r.jsxs("span",{children:[r.jsx(le,{to:"/game/daily-setup?dataCheck=true",children:"Go to Check"}),r.jsxs(F.Title,{level:4,children:["Total: ",i.entries.length]})]}),r.jsx(J,{onClick:()=>t(i.entries),loading:l,disabled:(i.entries??[]).length===0,type:"primary",size:"large",icon:r.jsx(Qe,{}),children:"Save"})]}),Object.values(e).map(c=>r.jsx(L,{message:c,type:"warning",showIcon:!0,banner:!0},c)),r.jsx(de,{columns:ge,dataSource:i.entries??[],scroll:{x:"max-content"}})]})}function Es({language:s,setLanguage:i,drawingsCount:a,setDrawingsCount:o,batchSize:e,setBatchSize:t}){return r.jsxs(ke,{children:[r.jsx(H,{label:"Language",value:s,onChange:i,options:[Le],placeholder:"Select a language"}),r.jsx(H,{label:"Minimum Drawings",value:a,onChange:o,options:[2,3,4],placeholder:"Select a number"}),r.jsx(H,{label:"Batch Size",value:e,onChange:t,options:[3,7,14,21,28],placeholder:"Select a number"})]})}function mt(){const[s,i]=S.useState(""),[a,o]=S.useState(3),[e,t]=S.useState(7),l=Ns(!!s,s,e);return r.jsx(Ne,{title:"Daily Setup",children:r.jsxs(ie,{hasSider:!0,children:[r.jsxs(Pe,{children:[r.jsx(Oe,{isLoading:l.isLoading,error:null,hasResponseData:!l.isLoading}),r.jsx(Es,{language:s,setLanguage:i,drawingsCount:a,setDrawingsCount:o,batchSize:e,setBatchSize:t})]}),r.jsx(ie.Content,{className:"content",children:r.jsx(Ue,{isLoading:l.isLoading,error:null,hasResponseData:!l.isLoading,children:r.jsx(bs,{language:s,dataLoad:l})})})]})},e)}export{mt as default};
