import{r as j,a as B,_ as $,j as e,T as C,B as I,at as Y,ao as fe,G as F,D as re,aq as ge,P as je,L as G}from"./index-B3JH01iB.js";import{D as xe}from"./DataLoadingWrapper-dh3jacIT.js";import{l as O,c as ie,P as ye}from"./useBaseUrl-CZWZgKRs.js";import{u as D}from"./useQueryParams-BHv40m-x.js";import{R as be}from"./main-By60__D4.js";import{u as we,a as ce,c as ve,n as Se,b as ke}from"./useTestimoniesResource-Dw2-bEvN.js";import{g as Ce}from"./useParsedHistory-BsuIuV2K.js";import{S as H}from"./SuspectImageCard-D5_oTlYe.js";import{u as Oe}from"./useTDResource-b3rDQSkC.js";import{F as S}from"./index-BCvCL0ga.js";import{T as oe,S as Te,F as Ie}from"./FilterEntries-u2pKqJxX.js";import{B as U,D as Re}from"./DownloadButton-DJaKu1gp.js";import{S as A}from"./index-CaSPROP-.js";import{u as ae}from"./useTableExpandableRows-DiYsDkGa.js";import{u as le}from"./useTablePagination-BzQlYVOz.js";import{P as J}from"./progress-DwFhCbdw.js";import{S as z}from"./index-Dszr5pPb.js";import{F as Q}from"./Table-DC7vW2Ha.js";import{I as Pe}from"./index-DecZ6U45.js";import{u as De}from"./useCardWidth-BOeXBzIt.js";import{C as ue}from"./index-DGt5aRqD.js";import{P as K}from"./index-a4KRvsSI.js";import{R as Me}from"./FireFilled-D0Yiv99U.js";import{S as V}from"./SiderContent-y1ziTlGK.js";import{F as X}from"./FirestoreConsoleLink-C9VHUt98.js";import{S as Ne}from"./SaveButton-yEblVGPH.js";import{S as Ee}from"./SuspectsStyleVariantSelector-BD92BFbq.js";import{g as Ae}from"./useGetFirestoreDoc-DtxW3_7b.js";import{e as Fe,a as ze,d as Be}from"./index-D-qWoO__.js";import{u as de}from"./useWindowSize-BMj0-Ph1.js";import{M as he}from"./index-DwCN1xmH.js";import{R as $e}from"./TableOutlined-B3Z-WXWH.js";import{R as He}from"./RobotOutlined-D8moJpob.js";import"./useResourceFirestoreData-BQIrV1BQ.js";import"./useUpdateFirestoreDoc-Bh11gTIF.js";import"./useMutation-CY39LX1i.js";import"./moment-C5S46NFB.js";import"./ImageCard-4v7SFzeP.js";import"./gapSize-U1swVQyS.js";import"./index-Dt5YmjhO.js";import"./index-Ulf3nzcb.js";import"./index-CVDTN0au.js";import"./index-DZHJosB8.js";import"./scrollTo-BUBUSE1i.js";import"./Pagination-azJyVn8J.js";import"./Input-DYhQBLMT.js";import"./SaveOutlined-C6W0l_YX.js";import"./constants-CzmVoJc0.js";import"./Item-DsGe7FNE.js";var Le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zM464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z"}}]},name:"appstore",theme:"filled"},Ve=function(i,o){return j.createElement(B,$({},i,{ref:o,icon:Le}))},Ue=j.forwardRef(Ve),qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm330-170c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1z"}}]},name:"audio",theme:"filled"},Qe=function(i,o){return j.createElement(B,$({},i,{ref:o,icon:qe}))},We=j.forwardRef(Qe),_e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M594.3 601.5a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1 8 8 0 008 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"}}]},name:"contacts",theme:"outlined"},Ye=function(i,o){return j.createElement(B,$({},i,{ref:o,icon:_e}))},Ge=j.forwardRef(Ye),Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M870 126H663.8c-17.4 0-32.9 11.9-37 29.3C614.3 208.1 567 246 512 246s-102.3-37.9-114.8-90.7a37.93 37.93 0 00-37-29.3H154a44 44 0 00-44 44v252a44 44 0 0044 44h75v388a44 44 0 0044 44h478a44 44 0 0044-44V466h75a44 44 0 0044-44V170a44 44 0 00-44-44z"}}]},name:"skin",theme:"filled"},Ke=function(i,o){return j.createElement(B,$({},i,{ref:o,icon:Je}))},Xe=j.forwardRef(Ke),Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.6 630.2 359 721.8 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.8 758.4 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM248 439.6c-37.1-11.9-64-46.7-64-87.6V232h64v207.6zM840 352c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"filled"},et=function(i,o){return j.createElement(B,$({},i,{ref:o,icon:Ze}))},Z=j.forwardRef(et);function tt(){var t=j.useRef(!0);return t.current?(t.current=!1,!0):t.current}function nt(t,i){return typeof t=="function"?t.length?t(i):t():t}function me(t,i,o){if(i===void 0&&(i=10),i<1)throw new Error("Capacity has to be greater than 1, got '"+i+"'");var l=tt(),h=j.useState(t),p=h[0],d=h[1],a=j.useRef([]),s=j.useRef(0);l&&(a.current.length?(a.current[a.current.length-1]!==t&&a.current.push(t),a.current.length>i&&(a.current=a.current.slice(a.current.length-i))):a.current.push(t),s.current=a.current.length&&a.current.length-1);var x=j.useCallback(function(r){d(function(c){return r=nt(r,c),r!==c&&(s.current<a.current.length-1&&(a.current=a.current.slice(0,s.current+1)),s.current=a.current.push(r)-1,a.current.length>i&&(a.current=a.current.slice(a.current.length-i))),r})},[p,i]),u=j.useMemo(function(){return{history:a.current,position:s.current,capacity:i,back:function(r){r===void 0&&(r=1),s.current&&d(function(){return s.current-=Math.min(r,s.current),a.current[s.current]})},forward:function(r){r===void 0&&(r=1),s.current!==a.current.length-1&&d(function(){return s.current=Math.min(s.current+r,a.current.length-1),a.current[s.current]})},go:function(r){r!==s.current&&d(function(){return s.current=r<0?Math.max(a.current.length+r,0):Math.min(a.current.length-1,r),a.current[s.current]})}}},[p]);return[p,x,u]}function st(){const[t,i]=j.useState({batchSize:1,history:{}}),o=j.useRef(1),{entries:l}=we(!0,"pt",t.batchSize,t.history),h=Oe("suspects",!O.isEmpty(l));return console.log(it(l,h.data??{})),e.jsxs(S,{className:"p-4",gap:12,vertical:!0,children:[e.jsxs(S,{align:"center",justify:"space-between",children:[e.jsx(C.Title,{className:"my-0",level:4,children:"Espionagem Simulator"}),e.jsxs(S,{gap:6,children:[e.jsx(oe,{defaultValue:1,max:100,min:1,onChange:p=>{o.current=p??1}}),e.jsx(I,{onClick:()=>i({batchSize:o.current,history:{}}),type:"primary",children:"Re-run Simulation"})]})]}),e.jsx(rt,{entries:l})]})}function rt({entries:t}){const[i,o]=j.useState(!1),l=Ce(),h=t[l],p=j.useMemo(()=>h?h.statements.reduce((d,a)=>{const{excludes:s}=a;return s.forEach(x=>{d[x]?d[x]++:d[x]=1}),d},{}):{},[h]);return e.jsxs("div",{className:"full-width grid",style:{gridTemplateColumns:"2fr 3fr"},children:[e.jsx(be,{collapsed:3,src:t??{},theme:"twilight"}),e.jsx("div",{children:h&&e.jsxs(S,{className:"p-4",gap:18,children:[e.jsx("div",{children:e.jsx("div",{style:{width:`${105*4}px`,display:"grid",gap:"6px",gridTemplateColumns:"repeat(4, 1fr)"},children:h.suspects.map(d=>e.jsxs(U.Ribbon,{color:"cyan",text:i?p[d.id]:null,children:[e.jsx(H,{className:ie(i&&d.id===h.culpritId&&"red-border"),id:d.id,width:96},d.id),e.jsxs(S,{align:"center",gap:6,children:[e.jsx(A,{checkedChildren:"🚫",size:"small"})," ",d.id]})]},d.id))})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(A,{checked:i,checkedChildren:"Show Culprit",onChange:o,unCheckedChildren:"Hide Culprit"})}),h.statements.map(d=>e.jsx(C.Paragraph,{children:e.jsx(U,{color:"cyan",count:d.excludes.length,children:e.jsx(Y,{banner:!0,icon:ee(d.type),message:d.text,type:"info"},d.key)})},d.key)),h.additionalStatements.map(d=>e.jsx(C.Paragraph,{children:e.jsx(U,{color:"cyan",count:d.excludes.length,children:e.jsx(Y,{banner:!0,icon:ee(d.type),message:d.text,type:"warning"},d.key)})},d.key))]})]})})]})}const ee=t=>{switch(t){case"testimony":return e.jsx(We,{});case"feature":return e.jsx(Xe,{});case"grid":return e.jsx(Ue,{});default:return"❓"}},it=(t,i)=>{const o=Object.values(t).reduce((l,h)=>(h.suspects.forEach(p=>{l[p.id]=(l[p.id]||0)+1,p.id===h.culpritId&&(l[`${p.id}_culprit`]=(l[`${p.id}_culprit`]||0)+1)}),l),{});return Object.values(i).forEach(l=>{o[l.id]||(o[l.id]=0),o[`${l.id}_culprit`]||(o[`${l.id}_culprit`]=0)}),o};function pe({suspect:t,values:i,resolution:o,projection:l,yesPercentage:h,noPercentage:p,complete:d,enoughData:a,testimonyId:s,addEntryToUpdate:x,answers:u,barWidth:r,showName:c}){const n=g=>{const m={...u};m[g]=[...m[g]||[],3],x(s,m)},f=g=>{const m={...u};m[g]=[...m[g]||[],-3],x(s,m)},k=g=>{var b;const m={...u},w=(b=m[g])==null?void 0:b.findIndex(v=>v===3);w!==-1&&w!==void 0&&(m[g]=[...m[g].slice(0,w),...m[g].slice(w+1)]),x(s,m)},y=g=>{var b;const m={...u},w=(b=m[g])==null?void 0:b.findIndex(v=>v===-3);w!==-1&&w!==void 0&&(m[g]=[...m[g].slice(0,w),...m[g].slice(w+1)]),x(s,m)};return e.jsxs(fe,{content:e.jsxs(S,{gap:4,vertical:!0,children:[e.jsx(C.Text,{type:"secondary",children:i.join(", ")}),e.jsxs(I,{block:!0,icon:"👍",onClick:()=>n(t.id),children:[" ","Add strong fit"]}),e.jsxs(I,{block:!0,icon:"👎",onClick:()=>f(t.id),children:[" ","Add strong unfit"]}),e.jsxs(z.Compact,{children:[e.jsx(I,{block:!0,icon:"❌",onClick:()=>k(t.id),size:"small",children:"fit"}),e.jsx(I,{block:!0,icon:"❌",onClick:()=>y(t.id),size:"small",children:"unfit"})]})]}),title:`Add strong fit/unfit answer to ${t.name.pt}`,trigger:"click",children:[c&&e.jsxs("div",{children:[e.jsx(F,{title:t.id,children:t.name.pt})," ",d&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(Z,{style:{color:"gold"}})})]}),e.jsxs(S,{align:"flex-start",gap:12,children:[e.jsx(F,{title:`Values: ${i.join(", ")} : ${o||(l?`${l}*`:"")}`,children:a?e.jsx(J,{percent:p+h,showInfo:!1,size:[r,20],status:"exception",success:{percent:h}}):e.jsx(J,{percent:p+h,showInfo:!1,size:[r,10],status:"exception",success:{percent:h}})}),!c&&d&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(Z,{style:{color:"gold"}})})]})]})}function ct({suspect:t,answersPerQuestion:i={},questions:o,addEntryToUpdate:l,allAnswers:h}){const{queryParams:p}=D({sortSuspectsBy:"answers"}),d=p.get("sortSuspectsBy")??"answers",a=j.useMemo(()=>{const u=Object.values(o).map(r=>{const c=i[r.id]??{},{enoughData:n,reliable:f,yesPercentage:k,noPercentage:y,blankPercentage:g,values:m,total:w,resolution:b,projection:v,complete:T}=ce(t.id,{[t.id]:c});return{id:r.id,question:r,enoughData:n,reliable:f,yesPercentage:k,noPercentage:y,blankPercentage:g,values:m,total:w,resolution:b,projection:v,complete:T}});return d==="answers"?O.orderBy(u,["reliable","enoughData","yesPercentage",r=>r.values.length],["desc","desc","desc","desc"]):O.orderBy(u,r=>Number(r.id.split("-")[1]),["asc"])},[i,o,t.id,d]),s=j.useMemo(()=>ot(t,a),[t,a]),x=[{key:"id",title:"Id",dataIndex:"id"},{key:"question",title:"Question",dataIndex:"question",render:u=>u.question},{key:"answer",title:"Answer",dataIndex:"id",sorter:(u,r)=>u.total-r.total,render:u=>{const r=a.find(c=>c.id===u);return r?e.jsx(S,{gap:8,wrap:"nowrap",children:e.jsx(pe,{addEntryToUpdate:l,answers:h[r.question.id]||{},barWidth:120,complete:r.complete,enoughData:r.enoughData,noPercentage:r.noPercentage,projection:r.projection,resolution:r.resolution,suspect:t,testimonyId:r.question.id,values:r.values,yesPercentage:r.yesPercentage})}):""}}];return e.jsxs(z,{size:"large",wrap:!0,children:[e.jsx(Q,{bordered:!0,columns:x,dataSource:a,rowKey:"id"}),e.jsxs(S,{gap:8,vertical:!0,children:[e.jsx(C.Title,{level:5,children:"Suspect Description"}),e.jsx(Pe.TextArea,{className:"full-width",readOnly:!0,rows:7,value:s})]})]})}const ot=(t,i)=>{const o=i.filter(l=>l.resolution||l.projection).map(l=>{const{question:h,resolution:p,projection:d}=l,a=p||d;return`${t.gender==="male"?"ele":"ela"} ${a==="👍"?"":"não "}${h.answer.toLocaleLowerCase()}`});return`${t.name.pt}: ${o.join(", ")}`};function at({isLoading:t,isSuccess:i,questions:o,data:l,suspects:h,addEntryToUpdate:p}){const{queryParams:d,addParam:a}=D(),s=j.useMemo(()=>Object.keys(l).reduce((n,f)=>{const k=l[f]??{};return Object.keys(k).forEach(y=>{n[y]||(n[y]={}),n[y][f]=k[y]}),n},{}),[l]),x=j.useMemo(()=>O.orderBy(Object.values(h).map(n=>({...n,answers:s[n.id]})),n=>Number(n.id.split("-")[1]),"asc"),[h,s]),u=le({total:x.length,showQuickJumper:!0}),r=[{title:"Id",dataIndex:"id",key:"id",sorter:(n,f)=>Number(n.id.split("-")[1])-Number(f.id.split("-")[1])},{title:"Picture",dataIndex:"id",render:n=>e.jsx(H,{id:n,width:48})},{title:"Name",dataIndex:"name",key:"name",sorter:(n,f)=>n.name.pt.localeCompare(f.name.pt),render:(n,f)=>e.jsxs(S,{vertical:!0,children:[e.jsx(C.Text,{children:n.pt}),e.jsx(C.Text,{type:"secondary",children:n.en}),e.jsx(C.Text,{italic:!0,type:"secondary",children:e.jsx("small",{children:f.note})})]})},{title:"Questions Answered",dataIndex:"answers",key:"answers",sorter:(n,f)=>Object.keys(n.answers??{}).length-Object.keys(f.answers??{}).length,render:n=>n?Object.values(n).length:""}],c=ae({maxExpandedRows:1,expandedRowRender:n=>e.jsx(ct,{addEntryToUpdate:p,allAnswers:l,answersPerQuestion:s[n.id],questions:o,suspect:n}),rowExpandable:()=>i});return e.jsxs(S,{className:"full-width py-4",gap:12,vertical:!0,children:[e.jsxs(S,{align:"center",justify:"space-between",children:[e.jsx(C.Title,{className:"my-0",level:4,children:"Testimonies by Suspect"}),e.jsx(A,{checked:d.get("sortSuspectsBy")==="answers",checkedChildren:"Sort by Answers",onChange:n=>a("sortSuspectsBy",n?"answers":"id"),unCheckedChildren:"Sort by Id"})]}),e.jsx(Q,{bordered:!0,className:"full-width",columns:r,dataSource:x,expandable:c,loading:t,pagination:u,rowKey:"id"})]})}function lt({answers:t,suspects:i,addEntryToUpdate:o,testimonyId:l}){const[h,p]=De(12),{queryParams:d,is:a}=D({sortSuspectsBy:"answers"}),s=a("enableBatch"),x=d.get("sortSuspectsBy")??"answers",u=j.useMemo(()=>{const n=Object.keys(i).map(f=>ce(f,t));return x==="answers"?O.orderBy(n,["reliable","enoughData",f=>f.values.length,"yesPercentage","noPercentage",f=>Number(f.suspectCardId.split("-")[1])],["desc","desc","desc","desc","desc","asc"]):O.orderBy(n,f=>Number(f.suspectCardId.split("-")[1]),["asc"])},[t,i,x]),[r,c]=j.useState([]);return e.jsxs(z,{direction:"vertical",children:[e.jsx(ut,{addEntryToUpdate:o,answers:t,list:u,selection:r,setSelection:c,suspects:i,testimonyId:l}),e.jsx(z,{ref:p,size:"large",wrap:!0,children:u.map(n=>e.jsxs(S,{className:ie({"selection-outline":s&&r.includes(n.suspectCardId)}),gap:6,vertical:!0,children:[e.jsx(H,{className:n.values.length>1?void 0:"grayscale",id:n.imageId,width:h}),e.jsxs(S,{gap:4,children:[s&&e.jsx(ue,{checked:r.includes(n.suspectCardId),disabled:n.complete,onChange:f=>{const k=f.target.checked;c(y=>k?[...y,n.suspectCardId]:y.filter(g=>g!==n.suspectCardId))}}),e.jsx(pe,{addEntryToUpdate:o,answers:t,barWidth:h,complete:n.complete,enoughData:n.enoughData,noPercentage:n.noPercentage,projection:n.projection,resolution:n.resolution,showName:!0,suspect:i[n.suspectCardId],testimonyId:l,values:n.values,yesPercentage:n.yesPercentage})]})]},n.suspectCardId))})]})}function ut({testimonyId:t,selection:i,setSelection:o,suspects:l,addEntryToUpdate:h,list:p,answers:d}){const[a,s]=j.useState([]),{addParam:x,removeParam:u,is:r}=D({sortSuspectsBy:"answers"}),c=r("enableBatch"),n=y=>{s(g=>g.includes(y)?g.filter(m=>m!==y):[...g,y])},f=j.useMemo(()=>O.keyBy(p,"suspectCardId"),[p]);j.useEffect(()=>{if(a.length===0&&i.length>0){o([]);return}if(!a.length)return;const g=(i.length>0?i:Object.values(f).filter(m=>!m.complete&&!m.values.includes(3)&&!m.values.includes(-3)).map(m=>m.suspectCardId)).filter(m=>{const w=l[m],b=[w.gender,w.ethnicity,w.build,w.height];return w.age==="18-21"&&b.push("young"),(w.age==="21-30"||w.age==="30-40")&&b.push("adult"),w.age==="40-50"&&b.push("parent"),(w.age==="50-60"||w.age==="60-70"||w.age==="70-80"||w.age==="80-90")&&b.push("senior"),a.every(v=>b.includes(v))});o(g)},[a]);const k=y=>{const g=O.cloneDeep(d);i.forEach(m=>{g[m]=[...g[m]||[],y]}),h(t,g),s([])};return e.jsxs(S,{align:"center",className:"mb-4",gap:6,justify:"space-between",children:[e.jsxs(S,{gap:3,children:[e.jsx(C.Text,{className:"nowrap",style:{minWidth:"5ch"},children:"Batch"}),e.jsx(A,{checkedChildren:"On",onChange:y=>{y?x("enableBatch",!0):u("enableBatch")},unCheckedChildren:"Off",value:c})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs(C.Text,{className:"nowrap mr-2",children:["Selected ",i.length]}),e.jsxs(S,{align:"center",gap:6,justify:"center",wrap:!0,children:[e.jsx(P,{activeFilters:a,filter:"male",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"female",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"young",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"adult",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"parent",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"senior",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"thin",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"muscular",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"large",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"asian",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"black",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"caucasian",updateActiveFilter:n}),e.jsx(P,{activeFilters:a,filter:"latino",updateActiveFilter:n})]}),e.jsxs(S,{align:"center",gap:6,children:[e.jsx(I,{danger:!0,onClick:()=>s([]),size:"small",children:"Clear"}),e.jsx(K,{onConfirm:()=>k(3),title:"Apply +3 to selected suspects?",children:e.jsx(I,{className:"ml-10",disabled:i.length===0,size:"small",type:"primary",children:"Apply +3"})}),e.jsx(re,{type:"vertical"}),e.jsx(K,{onConfirm:()=>k(-3),title:"Apply -3 to selected suspects?",children:e.jsx(I,{disabled:i.length===0,size:"small",type:"primary",children:"Apply -3"})})]})]})]})}function P({filter:t,activeFilters:i,updateActiveFilter:o}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[e.jsx(ue,{checked:i.includes(t),onClick:()=>o(t)})," ",O.capitalize(t)]}),e.jsx(re,{type:"vertical"})]})}function dt({data:t,questions:i,suspects:o,isLoading:l,isSuccess:h,addEntryToUpdate:p}){const{queryParams:d,addParam:a}=D(),s=j.useMemo(()=>O.orderBy(Object.values(i).map(c=>({...c,answersCount:Object.values(t[c.id]??{}).length})),c=>Number(c.id.split("-")[1]),"asc"),[i]),x=le({total:s.length,showQuickJumper:!0}),u=[{title:"Id",dataIndex:"id",key:"id",sorter:(c,n)=>Number(c.id.split("-")[1])-Number(n.id.split("-")[1])},{title:"Question",dataIndex:"question",key:"question",sorter:(c,n)=>c.question.localeCompare(n.question)},{title:"NSFW",dataIndex:"nsfw",key:"nsfw",render:c=>c?e.jsx(Me,{style:{color:"hotPink"}}):"",sorter:(c,n)=>Number(c.nsfw)-Number(n.nsfw)},{title:"Answers",dataIndex:"answersCount",key:"answersCount",sorter:(c,n)=>c.answersCount-n.answersCount}],r=ae({maxExpandedRows:1,expandedRowRender:c=>e.jsx(lt,{addEntryToUpdate:p,answers:t[c.id]??{},suspects:o,testimonyId:c.id}),rowExpandable:()=>h});return e.jsxs(S,{className:"full-width py-4",gap:12,vertical:!0,children:[e.jsxs(S,{align:"center",justify:"space-between",children:[e.jsx(C.Title,{className:"my-0",level:4,children:"Suspects by Testimony"}),e.jsx(A,{checked:d.get("sortSuspectsBy")==="answers",checkedChildren:"Sort by Answers",onChange:c=>a("sortSuspectsBy",c?"answers":"id"),unCheckedChildren:"Sort by Id"})]}),e.jsx(Q,{bordered:!0,className:"full-width",columns:u,dataSource:s,expandable:r,loading:l,pagination:x,rowKey:"id"})]})}function ht(t){const{queryParams:i,is:o}=D();return e.jsxs(e.Fragment,{children:[(o("display","questions")||!i.get("display"))&&e.jsx(dt,{...t}),o("display","suspects")&&e.jsx(at,{...t}),o("display","simulator")&&e.jsx(st,{})]})}const mt="Left",pt="Right",ft="Up",gt="Down",E={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},q={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},te="mousemove",ne="mouseup",jt="touchend",xt="touchmove",yt="touchstart";function bt(t,i,o,l){return t>i?o>0?pt:mt:l>0?gt:ft}function se(t,i){if(i===0)return t;const o=Math.PI/180*i,l=t[0]*Math.cos(o)+t[1]*Math.sin(o),h=t[1]*Math.cos(o)-t[0]*Math.sin(o);return[l,h]}function wt(t,i){const o=u=>{const r="touches"in u;r&&u.touches.length>1||t((c,n)=>{n.trackMouse&&!r&&(document.addEventListener(te,l),document.addEventListener(ne,d));const{clientX:f,clientY:k}=r?u.touches[0]:u,y=se([f,k],n.rotationAngle);return n.onTouchStartOrOnMouseDown&&n.onTouchStartOrOnMouseDown({event:u}),Object.assign(Object.assign(Object.assign({},c),q),{initial:y.slice(),xy:y,start:u.timeStamp||0})})},l=u=>{t((r,c)=>{const n="touches"in u;if(n&&u.touches.length>1)return r;if(u.timeStamp-r.start>c.swipeDuration)return r.swiping?Object.assign(Object.assign({},r),{swiping:!1}):r;const{clientX:f,clientY:k}=n?u.touches[0]:u,[y,g]=se([f,k],c.rotationAngle),m=y-r.xy[0],w=g-r.xy[1],b=Math.abs(m),v=Math.abs(w),T=(u.timeStamp||0)-r.start,R=Math.sqrt(b*b+v*v)/(T||1),M=[m/(T||1),w/(T||1)],N=bt(b,v,m,w),W=typeof c.delta=="number"?c.delta:c.delta[N.toLowerCase()]||E.delta;if(b<W&&v<W&&!r.swiping)return r;const L={absX:b,absY:v,deltaX:m,deltaY:w,dir:N,event:u,first:r.first,initial:r.initial,velocity:R,vxvy:M};L.first&&c.onSwipeStart&&c.onSwipeStart(L),c.onSwiping&&c.onSwiping(L);let _=!1;return(c.onSwiping||c.onSwiped||c[`onSwiped${N}`])&&(_=!0),_&&c.preventScrollOnSwipe&&c.trackTouch&&u.cancelable&&u.preventDefault(),Object.assign(Object.assign({},r),{first:!1,eventData:L,swiping:!0})})},h=u=>{t((r,c)=>{let n;if(r.swiping&&r.eventData){if(u.timeStamp-r.start<c.swipeDuration){n=Object.assign(Object.assign({},r.eventData),{event:u}),c.onSwiped&&c.onSwiped(n);const f=c[`onSwiped${n.dir}`];f&&f(n)}}else c.onTap&&c.onTap({event:u});return c.onTouchEndOrOnMouseUp&&c.onTouchEndOrOnMouseUp({event:u}),Object.assign(Object.assign(Object.assign({},r),q),{eventData:n})})},p=()=>{document.removeEventListener(te,l),document.removeEventListener(ne,d)},d=u=>{p(),h(u)},a=(u,r)=>{let c=()=>{};if(u&&u.addEventListener){const n=Object.assign(Object.assign({},E.touchEventOptions),r.touchEventOptions),f=[[yt,o,n],[xt,l,Object.assign(Object.assign({},n),r.preventScrollOnSwipe?{passive:!1}:{})],[jt,h,n]];f.forEach(([k,y,g])=>u.addEventListener(k,y,g)),c=()=>f.forEach(([k,y])=>u.removeEventListener(k,y))}return c},x={ref:u=>{u!==null&&t((r,c)=>{if(r.el===u)return r;const n={};return r.el&&r.el!==u&&r.cleanUpTouch&&(r.cleanUpTouch(),n.cleanUpTouch=void 0),c.trackTouch&&u&&(n.cleanUpTouch=a(u,c)),Object.assign(Object.assign(Object.assign({},r),{el:u}),n)})}};return i.trackMouse&&(x.onMouseDown=o),[x,a]}function vt(t,i,o,l){return!i.trackTouch||!t.el?(t.cleanUpTouch&&t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:void 0})):t.cleanUpTouch?i.preventScrollOnSwipe!==o.preventScrollOnSwipe||i.touchEventOptions.passive!==o.touchEventOptions.passive?(t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:l(t.el,i)})):t:Object.assign(Object.assign({},t),{cleanUpTouch:l(t.el,i)})}function St(t){const{trackMouse:i}=t,o=j.useRef(Object.assign({},q)),l=j.useRef(Object.assign({},E)),h=j.useRef(Object.assign({},l.current));h.current=Object.assign({},l.current),l.current=Object.assign(Object.assign({},E),t);let p;for(p in E)l.current[p]===void 0&&(l.current[p]=E[p]);const[d,a]=j.useMemo(()=>wt(s=>o.current=s(o.current,l.current),{trackMouse:i}),[i]);return o.current=vt(o.current,l.current,h.current,a),d}function kt(t){const{addParam:i}=D();return e.jsxs(S,{gap:8,vertical:!0,children:[e.jsx(I,{block:!0,onClick:()=>i("testify","single"),children:"Testify Drawer"}),e.jsx(I,{block:!0,onClick:()=>i("testify","group"),children:"Testify Group"}),e.jsx(Ct,{...t}),e.jsx(Ot,{...t})]})}function Ct({suspects:t,questions:i,answers:o,addEntryToUpdate:l}){var g;const{width:h,height:p}=de(),{is:d,removeParam:a}=D(),[s,x,u]=me(),r=St({onSwipedLeft:()=>alert("Swiped Left"),onSwipedRight:()=>alert("Swiped Right"),onSwipedUp:()=>alert("Swiped Up"),preventScrollOnSwipe:!0,trackTouch:!0,trackMouse:!0}),c=()=>{x({suspectId:O.sample(Object.keys(t))||null,testimonyId:O.sample(Object.keys(i))||null})},n=()=>{c()},f=()=>{if(s!=null&&s.suspectId&&(s!=null&&s.testimonyId)){const m=O.cloneDeep(o[(s==null?void 0:s.testimonyId)??""]??{});m[s.suspectId]=[...m[s.suspectId]||[],1],l(s.testimonyId??"",m),c()}},k=()=>{if(s!=null&&s.suspectId&&(s!=null&&s.testimonyId)){const m=O.cloneDeep(o[(s==null?void 0:s.testimonyId)??""]??{});m[s.suspectId]=[...m[s.suspectId]||[],0],l(s.testimonyId??"",m),c()}},y=!!(s!=null&&s.suspectId)&&!!(s!=null&&s.testimonyId);return e.jsx(he,{footer:null,maskClosable:!1,onCancel:()=>a("testify"),open:d("testify","single"),title:e.jsx(C,{children:"Does this person do this??"}),width:h-64,children:e.jsxs("div",{...r,children:[y&&e.jsxs(S,{align:"center",className:"mb-8",gap:8,justify:"center",vertical:!0,children:[e.jsx(H,{id:s.suspectId??"",width:Math.max(p/4,128)}),e.jsx(C.Title,{className:"text-center",level:5,children:(g=i[s.testimonyId??""])==null?void 0:g.question})]}),e.jsxs(z.Compact,{block:!0,className:"mb-8",size:"large",children:[e.jsx(I,{block:!0,disabled:!y,icon:"👎",onClick:k,style:{height:64},children:"No"}),e.jsx(I,{block:!0,onClick:n,style:{height:64},children:"Skip"}),e.jsx(I,{block:!0,disabled:!y,icon:"👍",iconPosition:"end",onClick:f,style:{height:64},children:"Yes"})]})]})})}function Ot({suspects:t,questions:i,answers:o,addEntryToUpdate:l}){var w;const{width:h,height:p}=de(),{is:d,removeParam:a}=D(),[s,x,u]=me(),[r,c]=j.useState(6),[n,f]=j.useState(!0),k=()=>{var v;const b=(v=O.sampleSize(Object.keys(t),r))==null?void 0:v.reduce((T,R)=>(T[R]=null,T),{});x({suspectsIds:b,testimonyId:(n?O.sample(Object.keys(i)):s==null?void 0:s.testimonyId)??null})};ge(()=>k());const y=()=>{const b=Object.entries((s==null?void 0:s.suspectsIds)??{}).reduce((v,[T,R])=>(R!==null&&(v[T]=[R]),v),{});if(s!=null&&s.testimonyId&&Object.keys(b).length>0){const v=O.cloneDeep(o[s.testimonyId]??{});Object.entries(b).forEach(([T,R])=>{v[T]=[...v[T]||[],...R]}),l(s.testimonyId,v)}else console.log("No testimonyId or no judged suspects found, likely skipped");k()},g=!!(s!=null&&s.suspectsIds)&&!!(s!=null&&s.testimonyId),m=b=>{x(v=>{if(!v)return v;const T=Object.entries(v.suspectsIds).reduce((R,[M,N])=>(R[M]=N===null?b:N,R),{});return{...v,suspectsIds:T}})};return e.jsx(he,{footer:null,maskClosable:!1,onCancel:()=>a("testify"),open:d("testify","group"),title:e.jsx(C,{children:"Do these people do this??"}),width:h-64,children:e.jsxs("div",{children:[g&&e.jsxs(S,{align:"center",className:"mb-8",gap:8,justify:"center",vertical:!0,children:[e.jsxs(S,{align:"center",gap:6,justify:"center",children:[e.jsx(C.Text,{children:"Number of Suspects:"}),e.jsx(oe,{onChange:b=>c(b??6),size:"small",value:r}),e.jsx(C.Text,{children:"Random Questions:"}),e.jsx(A,{checked:n,onChange:f,size:"small"})]}),e.jsx(C.Title,{className:"text-center",level:4,children:(w=i[s.testimonyId??""])==null?void 0:w.question}),e.jsx(S,{gap:8,justify:"center",wrap:"wrap",children:Object.keys(s.suspectsIds).map(b=>{var v,T;return e.jsxs(S,{align:"center",justify:"center",vertical:!0,children:[e.jsx(C.Text,{className:"text-center",children:((T=(v=t[b])==null?void 0:v.name)==null?void 0:T.pt)||"Unknown"}),e.jsx(H,{id:b,width:Math.min(Math.max(p/3,128),128)},b),e.jsx(Te,{onChange:R=>x(M=>M&&{...M,suspectsIds:{...M.suspectsIds,[b]:R}}),options:[{value:0,icon:"👎"},{value:null,icon:"♾"},{value:1,icon:"👍"}],shape:"round",size:"large",value:s.suspectsIds[b]})]},b)})})]}),e.jsxs(S,{align:"center",className:"mt-8",justify:"space-between",children:[e.jsx("span",{}),e.jsxs(S,{gap:8,children:[e.jsx(I,{onClick:()=>m(0),children:"Set all ♾ to 👎"}),e.jsx(I,{onClick:()=>m(1),children:"Set all ♾ to 👍"})]}),e.jsx(I,{onClick:y,size:"large",children:"Next Set"})]})]})})}function Tt({suspects:t,questions:i,data:o,hasNewData:l,isDirty:h,save:p,isSaving:d,entriesToUpdate:a,addEntryToUpdate:s}){const{queryParams:x,addParams:u}=D(),r=j.useMemo(()=>{const c={};return Object.values(o).forEach(n=>{Object.keys(n).forEach(f=>{n[f]&&(c[f]||(c[f]=0),ve(n[f])>=5&&(c[f]+=1))})}),{queriedTestimoniesCount:Object.keys(o).length,suspectsCount:Object.keys(c).length,reliableSuspectsCount:Object.values(c).filter(n=>n>=5).length}},[o]);return e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsxs(S,{gap:12,vertical:!0,children:[e.jsx(Ne,{dirt:JSON.stringify(a),isDirty:h,isSaving:d,onSave:p}),e.jsx(Re,{block:!0,data:async()=>await It(o),disabled:h,fileName:"testimony-answers.json",hasNewData:l}),e.jsx(X,{className:"text-center",label:"Firestore Data",path:"data/testimonies"}),e.jsx(X,{className:"text-center",label:"Firestore TDR",path:"tdr/testimonies"})]})}),e.jsxs(V,{children:[e.jsx(Ie,{label:"Display",onChange:c=>u({display:c,page:1},{page:1}),options:[{title:"Questions",icon:e.jsx($e,{}),value:"questions"},{title:"Suspects",icon:e.jsx(Ge,{}),value:"suspects"},{title:"Simulator",icon:e.jsx(He,{}),value:"simulator"}],value:x.get("display")??"questions"}),e.jsx(Ee,{})]}),e.jsx(V,{children:e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Legend"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Reliability: At least 5 votes"}),e.jsx("li",{children:"Large Bars: There's enough data (at least 3)"}),e.jsx("li",{children:"Small blue bar: in progress negative"})]})]})}),e.jsxs(V,{children:[e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Counts"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Testimonies: ",r.queriedTestimoniesCount]}),e.jsxs("li",{children:["Suspects: ",r.suspectsCount]}),e.jsx("li",{children:e.jsxs(F,{title:"A reliable suspect is one that has at least 5 complete testimonies.",children:["Reliable suspects: ",r.reliableSuspectsCount]})})]})]}),e.jsx(kt,{addEntryToUpdate:s,answers:o,questions:i,suspects:t})]})]})}async function It(t){console.log("Preparing file for download...x");const i=await Ae("data","testimonies")(),o=Fe(i);console.log("Parsed data from Firestore:",o);const l=O.cloneDeep(t);return Object.keys(l).forEach(h=>{const p=l[h],d=o[h]||{};Object.keys(p).forEach(a=>{const s=d[a]||[],x=Se([...p[a],...s]);p[a]=x})}),ze(Be(l))}function Cn(){const t=ke();return e.jsx(je,{subtitle:"Suspect Testimony Rates",title:"Testimonies",children:e.jsxs(G,{hasSider:!0,children:[e.jsx(ye,{children:e.jsx(Tt,{...t})}),e.jsx(G.Content,{className:"content",children:e.jsx(xe,{error:t.error,hasResponseData:!O.isEmpty(t.data),isLoading:t.isLoading,children:e.jsx(ht,{...t})})})]})})}export{Cn as TestimoniesPage,Cn as default};
