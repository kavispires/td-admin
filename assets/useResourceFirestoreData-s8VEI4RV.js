import{i as Q,u as $,r as g}from"./index-CJP1NcLY.js";import{l as u}from"./useBaseUrl-7hhyaw6U.js";import{j as h,k as v}from"./index-BGplYY1j.js";import{u as x}from"./useGetFirestoreDoc-C_u6buBo.js";import{u as L}from"./useTDResource-BAk1Iz0J.js";import{u as M}from"./useUpdateFirestoreDoc-Dr4NdarP.js";function k({tdrResourceName:o,firestoreDataCollectionName:e,serialize:c}){const{notification:n}=Q.useApp(),m=$(),r=L(o),s=x("tdr",e,{select:c?h:void 0}),[t,d]=g.useState({}),i=M("tdr",e,{onSuccess:()=>{n.success({message:`${e} updated`}),m.refetchQueries({queryKey:["firestore","tdr",e]}),d({})},onError:a=>{n.error({message:`${e} update failed`,description:a.message})}}),f=g.useMemo(()=>!r.isSuccess||!s.isSuccess||i.isPending?{}:(console.log(`%cMerging ${o}+${e} data...`,"color: #f0f"),u.cloneDeep({...r.data??{},...s.data??{},...t})),[o,e,r.data,s.data,r.isSuccess,s.isSuccess,i.isPending,t]),y=!u.isEmpty(t),S=(a,F)=>{d(D=>({...D,[a]:F}))},p=s.data,E=()=>{i.mutate(c?v(t):t)};return{data:f,isLoading:r.isLoading||s.isLoading,isSuccess:r.isSuccess&&s.isSuccess,error:r.error||s.error,firestoreData:p,hasFirestoreData:!u.isEmpty(p),isSaving:i.isPending,save:E,addEntryToUpdate:S,entriesToUpdate:t,isDirty:y}}export{k as u};
