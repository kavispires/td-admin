import{j as e,F as d,T as h,a6 as L,B as Q,r as p,a2 as E,D as b,P as A,L as P}from"./index-BaGtrpxe.js";import{D as $}from"./DataLoadingWrapper-Civ0F0U2.js";import{T as z}from"./Typeahead-BmhbAUkt.js";import{R as D,I}from"./Item-mV7BmvTA.js";import{u as M}from"./useCopyToClipboardFunction-C-v7sKVN.js";import{u as G}from"./useTableExpandableRows--_PCBdFl.js";import{u as J}from"./useTablePagination-BxQ03ufM.js";import{u as v}from"./useTDResource-SzRM-R8i.js";import{l as y,P as W}from"./useBaseUrl-DZ0WramL.js";import{r as S,g as _,c as U,w as Y,a as K}from"./index-BctMEEuE.js";import{I as F}from"./InspirationSample-DMh6wJRI.js";import{I as X}from"./ItemsTypeahead-CgbfL-7a.js";import{F as N}from"./Table-BfBp678y.js";import{S as H}from"./index-CUujx2bG.js";import{R as V}from"./index-BqGu7BB4.js";import{S as Z}from"./index-CnsxmgJR.js";import{S as w}from"./index-PzlwI0c1.js";import{P as q}from"./index-ij8ui0iY.js";import{R as ee}from"./DeleteFilled-BdzYMudH.js";import{u as R}from"./useQueryParams-oAS7WoYB.js";import{b as te,F as se,T as k}from"./FilterEntries-DSTJ81PW.js";import{S as re}from"./SiderContent-DLEbiYhk.js";import{D as ae,B as ie}from"./DownloadButton-ok13zvHe.js";import{S as ne}from"./SaveButton-q0xtOqHL.js";import{C as oe}from"./index-C4qtf5-j.js";import{R as le}from"./TableOutlined-Beh5YKVp.js";import{R as ce}from"./FrownOutlined-xtmISrpT.js";import{R as de}from"./RobotOutlined-gNo92SLw.js";import{T as ue}from"./TransparentButton-BlmpSIZD.js";import{u as me,P as pe}from"./useGridPagination-CxNNTt78.js";import{I as B}from"./ItemBuildingBlocks-lkydVLUj.js";import{D as he}from"./index-Dt9ZaiQc.js";import{R as xe}from"./main-D8nK5sJd.js";import{u as je}from"./daily-quartetos-BHEU6xJ5.js";import{g as fe}from"./useParsedHistory-CTgKta7w.js";import{u as ge}from"./useResourceFirestoreData-D1sRneb9.js";import"./useDebounce-DvHwyNQd.js";import"./index-93U2BmjJ.js";import"./constants-CjASann7.js";import"./SyncOutlined-BiXgngUS.js";import"./PlusOutlined-BvRYjywJ.js";import"./index-BjNZmQLu.js";import"./index-DXW4ONct.js";import"./index-BHcnRMWb.js";import"./scrollTo-DitOR-Fp.js";import"./Pagination-DeUhj6uS.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-kyPRnTVN.js";import"./index-DdSeIvLn.js";import"./LanguageFlag-CZZFpZfj.js";import"./IdcardOutlined-CeWlrVDL.js";import"./useGetFirestoreDoc-Chzrr5dP.js";import"./useUpdateFirestoreDoc-BbMXRAhA.js";import"./useMutation-DVpYxgWm.js";const ye=y.orderBy(["general","visual","word","thematic","attribute"]).map(t=>({label:t,value:t}));function O({rows:t,addEntryToUpdate:s}){const r=M(),i=v("items"),n=J({total:t.length,showQuickJumper:!0}),l=[{title:"ID",dataIndex:"id",render(a,o){return e.jsxs(d,{align:"center",gap:3,children:[o.itemsIds.length>=4&&!o.level&&e.jsx(D,{style:{color:"red"}}),e.jsx(h.Text,{copyable:!0,children:a})]})}},{title:"Title",dataIndex:"title",render:(a,o)=>e.jsx(Ce,{addEntryToUpdate:s,property:"title",quartet:o,value:a}),sorter:(a,o)=>a.title.localeCompare(o.title)},N.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(a,o)=>e.jsx(we,{addEntryToUpdate:s,copyToClipboard:r,itemsIds:a,quartet:o}),sorter:(a,o)=>a.itemsIds.length-o.itemsIds.length},{title:"Count",dataIndex:"itemsIds",render:a=>S(a).filter(Boolean).length,sorter:(a,o)=>a.itemsIds.length-o.itemsIds.length},{title:"Type",dataIndex:"type",render:(a,o)=>e.jsx(H,{defaultValue:a,onChange:x=>s(o.id,{...o,type:x}),options:ye,size:"small",style:{width:100}}),sorter:(a,o)=>(a.type??"_").localeCompare(o.type??"_")},{title:"Level",dataIndex:"level",render:(a,o)=>e.jsx(V,{count:4,onChange:x=>s(o.id,{...o,level:x}),value:a}),sorter:(a,o)=>a.level-o.level},{title:"Perfect Quartet",dataIndex:"itemsIds",render:a=>S(a).filter(Boolean).length===4&&e.jsx(L,{style:{color:"dodgerblue"}})},{title:"Flagged",dataIndex:"flagged",render:(a,o)=>e.jsx(Z,{checked:a,checkedChildren:e.jsx(D,{style:{color:"red"}}),onChange:x=>{if(x)s(o.id,{...o,flagged:x});else{const f=y.cloneDeep(o);delete f.flagged,s(o.id,f)}}}),sorter:(a,o)=>(a.flagged?1:0)-(o.flagged?1:0)}],c=G({maxExpandedRows:1,expandedRowRender:a=>e.jsx(Ie,{addEntryToUpdate:s,quartet:a}),rowExpandable:()=>i.isSuccess});return e.jsx(N,{columns:l,dataSource:t,expandable:c,pagination:n,rowClassName:a=>a.itemsIds.length>=4&&!a.level?"table-row-error":"",rowKey:"id"})}function Ie({quartet:t,addEntryToUpdate:s}){const r=i=>{s(t.id,{...t,itemsIds:[...t.itemsIds,i]})};return e.jsxs("div",{children:[e.jsx(X,{onFinish:r}),e.jsx(F,{excludeList:t.itemsIds,initialQuantity:0,onSelect:r})]})}function ve({quartet:t,addEntryToUpdate:s,itemId:r}){const i=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(n=>n!==r)})};return e.jsx(q,{cancelText:"No",okText:"Yes",onConfirm:i,title:"Are you sure you want to remove this item?",children:e.jsx(Q,{icon:e.jsx(ee,{}),size:"small",type:"text"})})}function we({quartet:t,itemsIds:s,copyToClipboard:r,addEntryToUpdate:i}){return e.jsx(d,{gap:6,wrap:"wrap",children:s.map(n=>e.jsxs(d,{gap:2,vertical:!0,children:[n?e.jsx(I,{itemId:String(n),width:60}):'"ERROR"',e.jsxs(d,{justify:"center",children:[e.jsx(h.Text,{onClick:()=>r(n),children:n}),e.jsx(ve,{addEntryToUpdate:i,itemId:n,quartet:t})]})]},`${t.title}-${n}`))},`items-${t.title}`)}function Ce({value:t,quartet:s,addEntryToUpdate:r,property:i}){const n=l=>typeof t=="number"?l!==String(t)?r(s.id,{...s,[i]:Number(l)}):null:l!==t?r(s.id,{...s,[i]:l.trim()}):null;return e.jsx(w,{children:e.jsx(h.Text,{editable:{onChange:n},children:String(t)})})}function T({data:t,addEntryToUpdate:s}){const[r,i]=p.useState(null),n=p.useMemo(()=>r?t[r]:null,[r,t]);return e.jsxs(w,{direction:"vertical",children:[e.jsx(h.Title,{level:5,children:"Search Quartet"}),e.jsx(z,{data:t,onFinish:l=>i(l),parser:be,placeholder:"Search quartet by title..."}),!!n&&e.jsx(O,{addEntryToUpdate:s,rows:[n]})]})}const be=t=>Object.values(t??{}).reduce((s,r)=>(s[`${r.title} (${r.id})`]=r.id,s),{});function Se({data:t,addEntryToUpdate:s}){const{is:r}=R(),i=r("emptyOnly"),n=p.useMemo(()=>i?y.orderBy(Object.values(t).filter(c=>c.itemsIds.length<4),["id"],["asc"]):y.orderBy(Object.values(t),["id"],["asc"]),[t,i]),l=n.filter(c=>c.itemsIds.length===4).length;return e.jsxs(w,{direction:"vertical",children:[e.jsxs(h.Title,{level:5,children:["Total Quartets: ",n.length," | Complete Quartets: ",l]}),e.jsx(O,{addEntryToUpdate:s,rows:n})]})}function Te({data:t,addEntryToUpdate:s}){const[r,i]=p.useState(!1),n=p.useMemo(()=>_(Object.keys(t)),[t]),l=()=>y.cloneDeep({id:n,title:"",itemsIds:[],level:0}),[c,a]=p.useState(l()),o=(j,m)=>{a({...m})},x=j=>{a(m=>({...m,itemsIds:S([...m.itemsIds,j])}))},f=async()=>{s(c.id,y.cloneDeep(c)),i(!1),await Y(250),a(l())},u=p.useMemo(()=>c.title.length<3?[]:y.orderBy(Object.values(t),j=>U.compareTwoStrings(j.title.toLocaleLowerCase(),c.title.toLocaleLowerCase()),"desc").slice(0,5).filter(j=>j.id!==c.id),[c.title,c.id,t]);return e.jsxs(e.Fragment,{children:[e.jsx(Q,{block:!0,onClick:()=>i(!0),type:"dashed",children:"Add New Set"}),e.jsx(E,{maskClosable:!1,okButtonProps:{disabled:!c.title,onClick:f},onCancel:()=>i(!1),open:r,title:"Add Quartet",width:"80vw",children:!!c&&e.jsxs(e.Fragment,{children:[e.jsx(O,{addEntryToUpdate:o,expandedRowKeys:[c.id],rows:[c]}),u.length>0&&e.jsx(oe,{size:"small",children:e.jsx(d,{gap:4,vertical:!0,children:u.map(j=>e.jsx("div",{children:j.title},j.id))})}),e.jsx(F,{excludeList:c.itemsIds,onSelect:x})]})})]})}function Qe({data:t,save:s,isDirty:r,isSaving:i,entriesToUpdate:n,addEntryToUpdate:l,hasFirestoreData:c}){const{is:a,addParam:o,queryParams:x,addParams:f}=R();return Oe(),e.jsxs(re,{children:[e.jsxs(d,{gap:12,vertical:!0,children:[e.jsx(ne,{dirt:JSON.stringify(n),isDirty:r,isSaving:i,onSave:s}),e.jsx(ae,{block:!0,data:()=>Re(t),disabled:r,fileName:"daily-quartet-sets.json",hasNewData:c})]}),e.jsx(b,{}),e.jsx(te,{label:"Pending Only",onChange:u=>o("emptyOnly",u,!1),value:a("emptyOnly")}),e.jsx(Te,{addEntryToUpdate:l,data:t}),e.jsx(b,{}),e.jsx(se,{label:"Display",onChange:u=>f({display:u,page:1},{page:1,display:"table"}),options:[{title:"Table",icon:e.jsx(le,{}),value:"table"},{title:"Orphans",icon:e.jsx(ce,{}),value:"orphans"},{title:"Simulator",icon:e.jsx(de,{}),value:"simulator"}],value:x.get("display")??"table"})]})}function Re(t){return K(t)}function Oe(){const t=v("items");p.useEffect(()=>{if(!t.dataUpdatedAt)return;const s={twoChars:{},threeChars:{},fourChars:{}};Object.values(t.data??{}).forEach(r=>{const i=r.name.pt||r.aliasesPt?.find(a=>a.split(" ").length===1);if(!i||i.length<3)return;const n=i.slice(-2).trim();if(n.length<2)return;s.twoChars[n]||(s.twoChars[n]=[]),s.twoChars[n].push(r);const l=i.slice(-3).trim();if(l.length<3)return;s.threeChars[l]||(s.threeChars[l]=[]),s.threeChars[l].push(r);const c=i.slice(-4).trim();c.length<4||(s.fourChars[c]||(s.fourChars[c]=[]),s.fourChars[c].push(r))}),Object.keys(s).forEach(r=>{Object.keys(s[r]).forEach(i=>{s[r][i].length<4&&delete s[r][i]})}),console.log("Grouped Items by Name Ending:",s)},[t.dataUpdatedAt])}function Pe({data:t,...s}){const r=v("items"),[i,n]=p.useState(null),[l,c]=p.useState(1),{unusedItems:a,usedItems:o}=p.useMemo(()=>{const u=Object.values(t).reduce((m,g)=>(g.itemsIds.forEach(C=>{m[C]||(m[C]=[]),m[C].push(g.id)}),m),{}),j=Object.keys(r.data||{}).reduce((m,g)=>u[g]?(u[g].length<=l&&(m[g]=u[g].length),m):(m[g]=0,m),{});return{usedItems:u,unusedItems:Object.keys(j).map(m=>({id:m,count:j[m]}))}},[t,r.data,l]),{page:x,pagination:f}=me({data:a,defaultPageSize:64});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(h.Title,{className:"my-0",level:4,children:"Quartetos Orphans Items"}),e.jsx(h.Text,{type:"secondary",children:"These items are not used in any quartet. You can add them to a quartet by clicking on them."})]}),e.jsxs(d,{align:"center",gap:8,children:[e.jsxs("span",{children:[a.length," Orphans | ",Object.keys(o).length," Used"]}),e.jsx(k,{min:0,onChange:u=>c(u??1),size:"small",style:{width:120},suffix:"max uses",value:l})]}),e.jsx(pe,{className:"full-width",pagination:f,children:e.jsx(d,{gap:16,wrap:"wrap",children:x.map(u=>e.jsx(ue,{onClick:()=>n(u.id),children:e.jsxs(d,{style:{maxWidth:84},vertical:!0,children:[e.jsx(I,{itemId:u.id,width:64}),e.jsx(d,{align:"center",children:e.jsx(ie,{count:u.count,offset:[-8,0],children:e.jsx(B,{item:r.data[u.id]})})})]},u.id)},u.id))})}),e.jsx(De,{data:t,itemId:i,onClose:()=>n(null),...s})]})}function De({itemId:t,onClose:s,...r}){const i=v("items"),n=p.useMemo(()=>Object.values(r.data).filter(l=>l.itemsIds.includes(t??"")),[t,r.data]);return t===null?null:e.jsx(he,{onClose:s,open:!!t,placement:"bottom",title:"Item Details",children:e.jsxs(d,{gap:16,children:[e.jsxs(d,{gap:16,vertical:!0,children:[e.jsx(I,{itemId:t,width:64}),e.jsx(B,{item:i.data[t]})]}),e.jsxs(d,{vertical:!0,children:[e.jsxs(h.Text,{strong:!0,children:["Used in ",n.length," quartets:"]}),n.map(l=>e.jsxs(d,{vertical:!0,children:[e.jsx(h.Text,{children:l.title}),e.jsxs(h.Text,{type:"secondary",children:["(",l.id,")"]}),e.jsx(d,{gap:8,wrap:"wrap",children:l.itemsIds.map(c=>e.jsx(I,{itemId:c,width:32},c))}),e.jsx(b,{})]},l.id))]}),e.jsx(T,{...r})]})})}function Ne(){const[t,s]=p.useState({batchSize:1,history:{}}),r=p.useRef(1),{entries:i}=je(!0,"pt",t.batchSize,t.history);return e.jsxs(d,{className:"p-4",gap:12,vertical:!0,children:[e.jsxs(d,{align:"center",justify:"space-between",children:[e.jsx(h.Title,{className:"my-0",level:4,children:"Quartetos Simulator"}),e.jsxs(d,{gap:6,children:[e.jsx(k,{defaultValue:1,max:100,min:1,onChange:n=>{r.current=n??1}}),e.jsx(Q,{onClick:()=>s({batchSize:r.current,history:{}}),type:"primary",children:"Re-run Simulation"})]})]}),e.jsx(Fe,{entries:i})]})}function Fe({entries:t}){const s=fe(),r=t[s];return e.jsxs("div",{className:"full-width grid",style:{gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(xe,{collapsed:3,src:t??{},theme:"twilight"}),e.jsx("div",{children:r&&e.jsx(d,{vertical:!0,children:r.sets.map(i=>e.jsx(ke,{quartet:i},i.id))})})]})}function ke({quartet:t}){return e.jsxs(w,{direction:"vertical",children:[e.jsxs(h.Text,{strong:!0,children:[t.title," [",t.level,"]"]}),e.jsx(d,{gap:8,children:t.itemsIds.map(s=>e.jsxs(d,{vertical:!0,children:[e.jsx(I,{itemId:s,width:60}),e.jsx(h.Text,{type:"secondary",children:s})]},s))})]})}function Bt(){const{queryParams:t}=R(),s=t.get("display"),r=ge({tdrResourceName:"daily-quartet-sets",firestoreDataCollectionName:"quartetSets"});return e.jsx(A,{subtitle:"Quartet Sets",title:"Items",children:e.jsxs(P,{hasSider:!0,children:[e.jsx(W,{children:e.jsx(Qe,{...r})}),e.jsx(P.Content,{className:"content",children:e.jsxs($,{error:r.error,hasResponseData:!y.isEmpty(r.data),isLoading:r.isLoading,children:[s==="simulator"&&e.jsx(Ne,{}),s==="orphans"&&e.jsxs(d,{gap:24,vertical:!0,children:[e.jsx(T,{...r}),e.jsx(Pe,{...r})]}),!s&&e.jsxs(d,{gap:24,vertical:!0,children:[e.jsx(T,{...r}),e.jsx(Se,{...r})]})]})})]})})}export{Bt as ItemsQuartets,Bt as default};
