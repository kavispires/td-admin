import{r as h,a as F,_ as M,j as e,a7 as K,T as O,a9 as X,B as w,D as R,aa as U,P as Y,L as V}from"./index-DVQc80aL.js";import{D as Z}from"./DataLoadingWrapper-DrZAP9Hg.js";import{u as ee,P as se}from"./useGridPagination-DnKJs3ky.js";import{u as C}from"./useQueryParams-cZbALjai.js";import{u as ae}from"./useResourceFirebaseData-DgXm7J1z.js";import{l as j}from"./lodash-Cne9hxq2.js";import{L as N}from"./LanguageFlag-AhCVBZy9.js";import{I as ne}from"./Item-dNxgMdgm.js";import{u as $}from"./useCopyToClipboardFunction-CkdXVpCi.js";import{C as te}from"./index-5TY1n3-z.js";import{S as P}from"./index-DTVvqAJl.js";import{I as _}from"./index-Bf_bgK0s.js";import{S as z}from"./index-BQj2rA2_.js";import{F as S}from"./index-qapmTdyC.js";import{F as J}from"./index-ZSSHW14X.js";import{S as ie}from"./index-CmE3exUg.js";import{R as oe}from"./FireFilled-niw8qDHI.js";import{R as le}from"./SaveOutlined-C8rMiad3.js";import{u as re}from"./useToggle-CzvQsjqF.js";import{c as D,a as ce,T as de}from"./FilterEntries-BSVgz3Ob.js";import{S as me}from"./SiderContent-DGYX1Rj7.js";import{D as A}from"./DownloadButton-_GflqSws.js";import{S as pe}from"./SaveButton-8a4Lw99d.js";import{a as W,d as ue,r as he}from"./index-BnFUJhch.js";import{M as fe}from"./index-BkFVaKQQ.js";import{D as ge}from"./index-NlDbMdFz.js";import{I as xe}from"./ItemsTypeahead-BbDccx9F.js";import{R as je}from"./EnvironmentOutlined-CPRN6ucR.js";import{P as ve}from"./useBaseUrl-BLmwdZA9.js";import"./Pagination-D2MRnmnX.js";import"./useGetFirebaseDoc-DBDY5cQa.js";import"./useTDResource-CjZRhN2T.js";import"./useUpdateFirebaseDoc-DHL8Sbzz.js";import"./useMutation-D2a3OoZT.js";import"./index-DAdu6QfX.js";import"./PlusOutlined-DyphvtIW.js";import"./gapSize-U1swVQyS.js";import"./Input-CXqvnCxL.js";import"./index-D5vZVq88.js";import"./moment-C5S46NFB.js";import"./constants-BdgM9j1Q.js";import"./useDebounce-BQjEzufN.js";var ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"},ke=function(t,n){return h.createElement(F,M({},t,{ref:n,icon:ye}))},we=h.forwardRef(ke),be={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482.88 128c-84.35 0-156.58 52.8-185.68 126.98-60.89 8.13-115.3 43.63-146.6 97.84-42.16 73-32.55 161.88 17.14 224.16-23.38 56.75-19.85 121.6 11.42 175.78 42.18 73.02 124.1 109.15 202.94 97.23C419.58 898.63 477.51 928 540.12 928c84.35 0 156.58-52.8 185.68-126.98 60.89-8.13 115.3-43.62 146.6-97.84 42.16-73 32.55-161.88-17.14-224.16 23.38-56.75 19.85-121.6-11.42-175.78-42.18-73.02-124.1-109.15-202.94-97.23C603.42 157.38 545.49 128 482.88 128m0 61.54c35.6 0 68.97 13.99 94.22 37.74-1.93 1.03-3.92 1.84-5.83 2.94l-136.68 78.91a46.11 46.11 0 00-23.09 39.78l-.84 183.6-65.72-38.34V327.4c0-76 61.9-137.86 137.94-137.86m197.7 75.9c44.19 3.14 86.16 27.44 109.92 68.57 17.8 30.8 22.38 66.7 14.43 100.42-1.88-1.17-3.6-2.49-5.53-3.6l-136.73-78.91a46.23 46.23 0 00-46-.06l-159.47 91.1.36-76.02 144.5-83.41a137.19 137.19 0 0178.53-18.09m-396.92 55.4c-.07 2.2-.3 4.35-.3 6.56v157.75a46.19 46.19 0 0022.91 39.9l158.68 92.5-66.02 37.67-144.55-83.35c-65.86-38-88.47-122.53-50.45-188.34 17.78-30.78 46.55-52.69 79.73-62.68m340.4 79.93l144.54 83.35c65.86 38 88.47 122.53 50.45 188.34-17.78 30.78-46.55 52.69-79.73 62.68.07-2.19.3-4.34.3-6.55V570.85a46.19 46.19 0 00-22.9-39.9l-158.69-92.5zM511.8 464.84l54.54 31.79-.3 63.22-54.84 31.31-54.54-31.85.3-63.16zm100.54 58.65l65.72 38.35V728.6c0 76-61.9 137.86-137.94 137.86-35.6 0-68.97-13.99-94.22-37.74 1.93-1.03 3.92-1.84 5.83-2.94l136.68-78.9a46.11 46.11 0 0023.09-39.8zm-46.54 89.55l-.36 76.02-144.5 83.41c-65.85 38-150.42 15.34-188.44-50.48-17.8-30.8-22.38-66.7-14.43-100.42 1.88 1.17 3.6 2.5 5.53 3.6l136.74 78.91a46.23 46.23 0 0046 .06z"}}]},name:"open-a-i",theme:"outlined"},Ie=function(t,n){return h.createElement(F,M({},t,{ref:n,icon:be}))},Ce=h.forwardRef(Ie),Se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},Ne=function(t,n){return h.createElement(F,M({},t,{ref:n,icon:Se}))},Oe=h.forwardRef(Ne);const H=h.createContext({items:{},isLoading:!0,error:null,hasResponseData:!1,decksDict:{},decks:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1",hasFirestoreData:!1}),Te=({children:s})=>{const{queryParams:t}=C(),{data:n,isLoading:a,error:o,isSaving:m,save:c,addEntryToUpdate:g,entriesToUpdate:r,isDirty:x,hasFirestoreData:p}=ae({tdrResourceName:"items",firebaseDataCollectionName:"items"}),{decksDict:i,decks:u}=h.useMemo(()=>{console.log("Recomputing item decks typeahead...");const y={},d={},v={},I=[];Object.values(n).forEach(f=>{var L;const Q=`${f.name.en} (${f.id})`,G=`${f.name.pt} (${f.id})`;d[f.name.en]?I.push([`${f.name.en} (${d[f.name.en]})`,Q]):d[f.name.en]=f.id,v[f.name.pt]?I.push([`${f.name.pt} (${v[f.name.pt]})`,G]):v[f.name.pt]=f.id,(L=f==null?void 0:f.decks)==null||L.forEach(B=>{y[B]=B})});const T=j.orderBy(Object.keys(y)).map(f=>({value:f}));return I.length>0&&console.warn("Possible duplicated items",I),{decksDict:y,decks:T}},[n,m,a]),l=t.get("deck")??"all",k=h.useMemo(()=>{const y=j.orderBy(Object.values(n),[d=>Number(d.id)],"asc");switch(l){case"all":return y;case"!all":return y.filter(d=>{var v;return!((v=d==null?void 0:d.decks)!=null&&v.length)||!0});case"nsfw":return y.filter(d=>d.nsfw);case"!nsfw":return y.filter(d=>!d.nsfw);default:return l.startsWith("!")?y.filter(d=>{var v;return!((v=d==null?void 0:d.decks)!=null&&v.includes(l.slice(1)))}):y.filter(d=>{var v;return(v=d==null?void 0:d.decks)==null?void 0:v.includes(l)})}},[n,l]),q=h.useMemo(()=>{var I;const y=j.orderBy(Object.keys(r),[T=>Number(T)],"asc"),d=(I=k[k.length-1])==null?void 0:I.id,v=j.orderBy([...y,d],[T=>Number(T)],"desc")[0];return String(Number(v)+1)},[k,r]);return e.jsx(H.Provider,{value:{items:n,listing:k,isLoading:a,error:o,decksDict:i,decks:u,hasResponseData:k.length>0,isDirty:x,addItemToUpdate:g,isSaving:m,save:c,itemsToUpdate:r,newId:q,hasFirestoreData:p},children:s})},b=()=>h.useContext(H);function De(s,t=!1){const{addItemToUpdate:n,itemsToUpdate:a}=b(),[o,m]=h.useState(t),[c,g]=h.useState(j.cloneDeep(s)),r=a[s.id]??s,x=l=>{const k={...j.cloneDeep(c),...l};Object.keys(l).includes("nsfw")&&l.nsfw===!1&&(k.nsfw=void 0),g(k)},p=async()=>{n(c.id,c)},i=()=>{g(j.cloneDeep(s)),m(!1)},u=JSON.stringify(r)!==JSON.stringify(c);return{isEditing:o,toggleEditMode:()=>m(l=>!l),editableItem:c,onEdit:x,isDirty:u,onModify:p,onReset:i}}function E({item:s,editMode:t=!1,simplified:n}){const{decks:a}=b(),{isEditing:o,toggleEditMode:m,onEdit:c,isDirty:g,onModify:r,onReset:x,editableItem:p}=De(s,t),i=$(),{is:u}=C();return e.jsxs(te,{title:e.jsx(O.Text,{onClick:()=>i(s.id),children:s.id}),extra:e.jsx(ze,{item:s}),style:{maxWidth:250},size:n?"small":"default",actions:n?void 0:g?[e.jsx(Oe,{onClick:x},"reset"),e.jsx(le,{onClick:r},"save")]:[e.jsx(K,{onClick:m},"edit")],children:[e.jsx(ne,{id:s.id,width:n?75:125,title:`${s.name.en} | ${s.name.pt}`}),e.jsxs(P,{size:"small",direction:"vertical",className:"my-4",children:[e.jsx(_,{prefix:e.jsx(N,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:o?"outlined":"borderless",size:"small",defaultValue:s.name.en,readOnly:!o,onChange:l=>c({name:{...p.name,en:l.target.value}})},`en-${s.name.en}`),e.jsx(_,{prefix:e.jsx(N,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:o?"outlined":"borderless",size:"small",defaultValue:s.name.pt,readOnly:!o,onChange:l=>c({name:{...p.name,pt:l.target.value}})},`pt-${s.name.pt}`),!n&&e.jsxs(e.Fragment,{children:[!u("simplified")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(z,{mode:"multiple",style:{width:"100%"},placeholder:"Select a deck",defaultValue:s.decks,disabled:!o,options:a,variant:o?"outlined":"borderless",size:"small",onChange:l=>c({decks:l.sort()})},String(s.decks))}),e.jsxs(S,{gap:6,children:[e.jsx(N,{language:"en",width:"1em"}),e.jsx(z,{mode:"tags",style:{width:"100%"},placeholder:"Other names EN",defaultValue:s.aliasesEn,options:[],size:"small",onChange:l=>c({aliasesEn:l.sort()})})]}),e.jsxs(S,{gap:6,children:[e.jsx(N,{language:"pt",width:"1em"}),e.jsx(z,{mode:"tags",style:{width:"100%"},placeholder:"Other names PT",defaultValue:s.aliasesPt,options:[],size:"small",onChange:l=>c({aliasesPt:l.sort()})})]})]}),u("showVerifyThing")&&e.jsx("div",{children:e.jsx(Pe,{item:s})}),(o||s.nsfw)&&e.jsx("div",{children:e.jsx(J.Item,{label:"nsfw",valuePropName:"checked",children:e.jsx(ie,{checked:s.nsfw,onChange:l=>c({nsfw:l}),size:"small",checkedChildren:e.jsx(oe,{style:{color:"hotpink"}}),disabled:!o})})})]})]})]})}const Re=j.memoize(s=>{var c,g;const t=!!((c=s.decks)!=null&&c.includes("thing")),n=!!((g=s.decks)!=null&&g.includes("manufactured")),a=s.name.en.split(" ").length===1,o=s.name.pt.split(" ").length===1,m={en:t||a&&n,pt:t||o&&n};return!m.pt&&!m.en?"":e.jsxs(e.Fragment,{children:[m.en&&e.jsx(N,{language:"en",width:"1em"}),m.pt&&e.jsx(N,{language:"pt",width:"1em"})]})}),Pe=({item:s})=>{const t=Re(s);return t?e.jsxs(S,{gap:6,children:["Thing: ",t]}):e.jsx(e.Fragment,{})},Ee=s=>({id:s.id,type:"item",header:{title:{en:"Item",pt:"Item"},iconId:"2077"},metadata:{level:"basic",keyword:j.snakeCase(s.name.en).toUpperCase()},content:{itemId:s.id,caption:s.name}});function ze({item:s}){const[t,n]=re(!1),a=$();return e.jsx(X,{content:e.jsxs(P,{direction:"vertical",children:[e.jsx(w,{size:"small",onClick:()=>a(JSON.stringify(s,null,2)),children:"Complete Item"}),e.jsx(w,{size:"small",onClick:()=>a(s.name.en),children:"EN Name"}),e.jsx(w,{size:"small",onClick:()=>a(s.name.pt),children:"PT Name"}),e.jsx(w,{size:"small",onClick:()=>a(JSON.stringify(Ee(s),null,2)),children:"Escape Room Item"})]}),title:"Copy",trigger:"click",open:t,onOpenChange:n,children:e.jsx(w,{type:"text",icon:e.jsx(we,{})})})}function Fe(){const{queryParams:s}=C(),t=s.get("deck")??"all",{listing:n}=b(),{page:a,pagination:o}=ee({data:n,resetter:t}),{is:m}=C(),c=m("simplified");return e.jsxs(e.Fragment,{children:[e.jsxs(O.Title,{level:2,children:["Listing - ",j.capitalize(t)," items (",n.length,")"]}),e.jsx(se,{pagination:o,className:"full-width",children:e.jsx(S,{gap:16,wrap:"wrap",children:a.map(g=>e.jsx(E,{item:g,simplified:c},g.id))})})]})}const Me={id:"",name:{en:"",pt:""},groups:[]};function $e({isModalOpen:s,handleOk:t,handleCancel:n,newId:a}){const[o]=h.useState(j.cloneDeep({...Me,id:a}));return e.jsx(fe,{title:"Add new item",open:s,onOk:t,onCancel:n,children:e.jsx(E,{item:o,editMode:!0})})}function Le(){const[s,t]=h.useState(!1),{newId:n}=b(),a=()=>{t(!0)},o=()=>{t(!1)},m=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(w,{block:!0,onClick:a,children:"Add New Item"}),s&&e.jsx($e,{isModalOpen:s,handleOk:o,handleCancel:m,newId:n},n)]})}function Be(){const{isDirty:s,save:t,items:n,decks:a,itemsToUpdate:o,isSaving:m,hasFirestoreData:c}=b(),{queryParams:g,is:r,addParam:x}=C(),p=h.useMemo(()=>{const i=j.orderBy(a.map(({value:l})=>({label:j.capitalize(l),value:l})),"label"),u=i.map(({label:l,value:k})=>({label:`NOT ${l}`,value:`!${k}`}));return[...i,...u]},[a]);return e.jsxs(me,{children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(pe,{isDirty:s,dirt:JSON.stringify(o),onSave:t,isSaving:m}),e.jsx(A,{data:()=>Ue(n),fileName:"items.json",disabled:s,hasNewData:c,block:!0})]}),e.jsx(R,{className:"my-4"}),e.jsx(O.Text,{type:"secondary",children:"Tools"}),e.jsx(D,{label:"Show Search",value:!r("hideSearch"),onChange:i=>x("hideSearch",i?"":"true",""),className:"full-width m-0"}),e.jsx(D,{label:"Show Randomizer",value:r("showRandomizer"),onChange:i=>x("showRandomizer",i?"true":"",""),className:"full-width m-0"}),e.jsx(O.Text,{type:"secondary",children:"Display"}),e.jsx(D,{label:"Simplified UI",value:r("simplified"),onChange:i=>x("simplified",i?"true":""),className:"full-width m-0"}),e.jsx(D,{label:"Thing Verifier",value:r("showVerifyThing"),onChange:i=>x("showVerifyThing",i?"true":""),className:"full-width m-0",disabled:r("simplified")}),e.jsx(D,{label:"Other Names",value:r("showOtherNames"),onChange:i=>x("showOtherNames",i?"true":""),className:"full-width m-0",disabled:!0}),e.jsx(R,{className:"my-4"}),e.jsx(ce,{label:"Deck",value:g.get("deck")??"all",onChange:i=>x("deck",i,"all"),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...p,{label:"No decks",value:"!all"}]}),e.jsx(R,{className:"my-4"}),e.jsx(Le,{}),e.jsx(R,{className:"my-4"}),e.jsx(A,{data:()=>Ve(n),fileName:"items-gpt.json",disabled:s,block:!0,icon:e.jsx(Ce,{}),children:"Open AI JSON"})]})}function Ue(s){console.log("Preparing file for download...");const t=j.cloneDeep(s);return Object.values(t).reduce((n,a)=>(a.aliasesEn=Object.values(a.aliasesEn??{}).sort(),a.aliasesEn.length===0&&(a.aliasesEn=void 0),a.aliasesPt=Object.values(a.aliasesPt??{}).sort(),a.aliasesPt.length===0&&(a.aliasesPt=void 0),a.decks=Object.values((a==null?void 0:a.decks)??{}).sort(),a.decks.length===0&&(a.decks=void 0),n[a.id]=a,n),{}),W(ue(t))}function Ve(s){return W(Object.values(j.cloneDeep(s)).reduce((t,n)=>{const a={id:n.id,names:{"en-US":n.name.en,"pt-BR":n.name.pt},aliases:{"en-US":n.aliasesEn,"pt-BR":n.aliasesPt}};return t[a.id]=a,t},{}))}function _e(){const{listing:s}=b(),[t,n]=h.useState([]),a=$(),[o,m]=h.useState(5),c=()=>{n(j.sampleSize(s,o))},g=[{label:"Copy IDs",key:"copy_ids"},{label:"Copy Names EN",key:"copy_names_en"},{label:"Copy Names PT",key:"copy_names_pt"}],r=({key:p})=>{if(p==="copy_ids"){const i=t.map(u=>u.id);a(JSON.stringify(i));return}if(p==="copy_names_en"){const i=t.map(u=>u.name.en).join(", ");a(i);return}if(p==="copy_names_pt"){const i=t.map(u=>u.name.pt).join(", ");a(i);return}},x=()=>{const p=j.chunk(j.sampleSize(s,o*15),o).map(i=>i.filter(u=>!u.nsfw)).map(i=>i.map(u=>u.name.en).join(", ")).map((i,u)=>`${u+1}) ${i}`).join(`
`);a(p)};return e.jsxs("div",{children:[e.jsxs(O.Title,{level:2,children:["Randomized Sample"," ",e.jsx(w,{size:"small",icon:e.jsx(U,{}),onClick:x,children:"MJ"})]}),e.jsxs(S,{gap:12,children:[e.jsx(J.Item,{label:"Quantity"}),e.jsx("div",{children:e.jsx(de,{min:3,max:15,value:o,onChange:p=>m(Number(p)),style:{minWidth:"100px"}})}),e.jsx(w,{onClick:c,type:"primary",children:"Get Sample"}),e.jsx(ge.Button,{menu:{items:g,onClick:r},disabled:t.length===0,onClick:()=>a(JSON.stringify(t,null,2)),icon:e.jsx(U,{}),children:"Copy"})]}),e.jsx(P,{wrap:!0,className:"my-4",children:t.map(p=>e.jsx(E,{item:p,simplified:!0},p.id))})]})}function Ae(){const{items:s,isLoading:t,isSaving:n}=b(),[a,o]=h.useState(null),{queryParams:m,addParam:c}=C(),g=r=>{const x=Number(m.get("pageSize")??64),p=Number(r),i=Math.floor(p/x)+1;c("page",i.toString())};return e.jsxs(h.Fragment,{children:[e.jsx(O.Title,{level:2,children:"Search for an item"}),e.jsx("div",{children:e.jsx(xe,{items:s,isPending:t||n,onFinish:r=>o([s[r]]),onFinishMultiple:r=>o(he(r).map(x=>s[x]))})}),e.jsx(S,{className:"my-4",gap:8,children:a==null?void 0:a.map(r=>e.jsxs(P,{direction:"vertical",className:"my-4",children:[e.jsx(E,{item:r}),e.jsx(w,{onClick:()=>g(r.id),block:!0,icon:e.jsx(je,{}),children:"Find in listing"})]},r.id))})]},`item-search-${t}`)}function Je(){const{isLoading:s,error:t,hasResponseData:n}=b(),{is:a}=C();return e.jsx(Y,{title:"Items",subtitle:"Listing",children:e.jsxs(V,{hasSider:!0,children:[e.jsx(ve,{children:e.jsx(Be,{})}),e.jsx(V.Content,{className:"content",children:e.jsxs(Z,{isLoading:s,error:t,hasResponseData:n,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{size:"large",align:"start",children:[!a("hideSearch")&&e.jsx(Ae,{}),a("showRandomizer")&&e.jsx(_e,{})]}),e.jsx(R,{})]}),e.jsx(Fe,{})]})})]})})}function Es(){return e.jsx(Te,{children:e.jsx(Je,{})})}export{Es as default};
