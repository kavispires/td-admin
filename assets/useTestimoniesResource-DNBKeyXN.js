import{u as Q,D as z,a as W,A as P}from"./useParsedHistory-DN7rqNmV.js";import{c as X}from"./utils-9gjG7QhC.js";import{u as v}from"./useTDResource-BoO3ytz8.js";import{l as h}from"./useBaseUrl-BpXt1jR3.js";import{a7 as Y,a8 as J,r as q}from"./index-pwMPEs54.js";import{u as K}from"./useResourceFirestoreData-CQToDHwL.js";const U="td-admin-debug-daily",V=()=>{const t={"aqui-o":!1,"arte-ruim":!1,artista:!1,"comunicacao-alienigena":!1,"controle-de-estoque":!1,espionagem:!1,filmaco:!1,organiku:!1,palavreado:!1,"portais-magicos":!1,quartetos:!1,"ta-na-cara":!1,"teoria-de-conjuntos":!1};try{const e=localStorage.getItem(U);return e?JSON.parse(e):t}catch{return t}},g=new J(V());g.subscribe(()=>{try{const t={"aqui-o":g.state["aqui-o"],"arte-ruim":g.state["arte-ruim"],artista:g.state.artista,"comunicacao-alienigena":g.state["comunicacao-alienigena"],"controle-de-estoque":g.state["controle-de-estoque"],espionagem:g.state.espionagem,filmaco:g.state.filmaco,organiku:g.state.organiku,palavreado:g.state.palavreado,"portais-magicos":g.state["portais-magicos"],quartetos:g.state.quartetos,"ta-na-cara":g.state["ta-na-cara"],"teoria-de-conjuntos":g.state["teoria-de-conjuntos"]};localStorage.setItem(U,JSON.stringify(t))}catch{}});const xe=(t,e)=>{g.setState(s=>({...s,[t]:!s[t]}))},Ee=()=>Y(g,()=>g.state),p=(...t)=>{g.state.espionagem&&console.log(...t)},Z=t=>{g.state.espionagem&&console.count(t)},ee=(...t)=>{g.state.espionagem&&console.error(...t)},te={male:"Ã© homem",female:"Ã© mulher",caucasian:"Ã© branco(a)",black:"Ã© negro(a)",asian:"Ã© asiÃ¡tico(a)",latino:"Ã© latino(a)",thin:"Ã© magrelo(a)",fat:"Ã© gordo(a)",large:"Ã© gordo(a)",tall:"Ã© alto(a)",short:"Ã© baixinho(a)",young:"Ã© jovem",adult:"Ã© adulto(a)",senior:"Ã© da terceira idade",average:"tem corpo normal",medium:"Ã© de altura mÃ©dia",mixed:"Ã© mestiÃ§o(a)",hat:"estÃ¡ usando um chapÃ©u",tie:"estÃ¡ usando uma gravata",glasses:"estÃ¡ usando Ã³culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",scarf:"estÃ¡ usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"Ã© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"Ã© sarado(a)",blackHair:"tem cabelo preto",hoodie:"estÃ¡ usando um moletom",earrings:"estÃ¡ usando brincos",lipstick:"estÃ¡ usando batom",necklace:"estÃ¡ usando um colar",mediumHair:"tem cabelo mÃ©dio","middle-eastern":"Ã© do Oriente MÃ©dio",headscarf:"estÃ¡ usando um lenÃ§o na cabeÃ§a",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"Ã© indiano(a)","native-american":"Ã© nativo-americano(a)",noAccessories:"estÃ¡ sem nenhum acessÃ³rio",avoidingCamera:"estÃ¡ evitando olhar para a cÃ¢mera",wearingStripes:"tem listras na roupa",blackClothes:"estÃ¡ vestindo roupas pretas",blueClothes:"estÃ¡ vestindo roupas azuis",greenClothes:"estÃ¡ vestindo roupas verdes",redClothes:"estÃ¡ vestindo roupas vermelhas",yellowClothes:"estÃ¡ vestindo roupas amarelas",purpleClothes:"estÃ¡ vestindo roupas roxas",orangeClothes:"estÃ¡ vestindo roupas laranjas",brownClothes:"estÃ¡ vestindo roupas marrons",whiteShirt:"estÃ¡ usando camisa branca",pinkClothes:"estÃ¡ vestindo roupas rosas",patternedShirt:"estÃ¡ usando roupa estampada",buttonShirt:"estÃ¡ usando camisa com botÃµes",bow:"estÃ¡ usando um laÃ§o",hairyChest:"estÃ¡ mostrando o peito peludo",wearingFlowers:"estÃ¡ usando flores",showTeeth:"estÃ¡ mostrando os dentes",hairTie:"estÃ¡ usando um xuxinha ou fita no cabelo","non-binary":"Ã© nÃ£o-binÃ¡rio(a)"},$=12,we=(t,e,s,a)=>{const[o]=Q(z.ESPIONAGEM,a),r=v("suspects",t),n=v(`testimony-questions-${e}`,t),c=v("testimony-answers",t),l=v("crime-reasons",t),m=q.useMemo(()=>re(c.data),[c.dataUpdatedAt]),i=q.useMemo(()=>ie(r.data),[r.data]);return{entries:q.useMemo(()=>!t||!o||!r.isSuccess||!n.isSuccess||!c.isSuccess||!l.isSuccess?{}:se(s,o,r.data,n.data,m,i,l.data),[t,o,r,n,c,s,m,i,l]),isLoading:r.isLoading||n.isLoading||c.isLoading}},se=(t,e,s,a,o,r,n)=>{Z("Creating Espionagem...");let c=e.latestDate;const l=[],m={};for(let i=0;i<t;i++){const f=W(c);c=f;let S=null,u=0;for(;S===null&&u<P;)try{u++;const d=ae(s,a,o,r,l,n);if(de(d.statements))throw S=d,new Error(`Game is invalid after ${u} attempts`)}catch{}if(!S)throw new Error(`Failed to generate valid game for ${f} after ${u} attempts`);p(`Generated valid game for ${f} after ${u} attempts`),l.push(S.culpritId),m[f]={id:f,type:"espionagem",number:e.latestNumber+i+1,...S}}return m};function ae(t,e,s,a,o,r){const n=[],c={};p("SuspectTestimonyAnswers",s);const{selectedTestimonyId1:l,selectedTestimonyId2:m,culpritId:i,possibleSuspects:f,impossibleSuspects:S}=ce(s,o);if(f.length<2)throw new Error("Not enough possible suspects");let u=[...f];if(f.length<$-1){const O=h.sampleSize(Object.keys(t).filter(k=>!S.includes(k)&&!f.includes(k)),$-f.length-1);u.push(...O)}const d={};Object.keys(a).forEach(O=>{if(a[O][i]===void 0){const k=Object.keys(a[O]).filter(C=>u.includes(C));if(k.length>0){const C={};k.forEach(_=>{u.includes(_)&&(C[_]=!0)}),d[O]=C}}});const b=e[l],E=G(i,u,b,s[l]);n.push(E),j(c,E.excludes);const x=e[m],w=G(i,u,x,s[m]);n.push(w),j(c,w.excludes);const y=N(i,u,d,[],"best");if(y.excludes.length===$-2)throw new Error("Best feature statement excludes too many suspects");n.push(y),j(c,y.excludes);const D=N(i,u,d,[y],"best");n.push(D);const F=N(i,u,d,[y,D],"worst");n.push(F),j(c,F.excludes);const H=N(i,u,d,[y,D,F],"worst");if(n.push(H),n.length<6)throw new Error("Not enough statements generated");u=h.shuffle([...u,i]);const R=A(i,u,n,"columns");n.push(R),j(c,R.excludes);const L=A(i,u,n,"rows");n.push(L);const I=[E,F,w,y,R,H],T=[D,L],M=me(t[i],r),B=oe([...I,...T]);return{isNsfw:b.nsfw||x.nsfw||!1,culpritId:i,statements:I,additionalStatements:T,suspects:ne(u,t,B),reason:M.title,setId:`${i}::${M.id}::${I[0].key}`,level:fe(I)}}const oe=t=>{const e={};t.forEach(a=>{if(a.key.includes(".feature.")){const o=a.key.split("not.feature.")[1];e[o]=!0}});const s={hairColor:["brownHair","blondeHair","greyHair","redHair","blackHair","coloredHair"],hairLength:["shortHair","mediumHair","longHair","bald"],facialHair:["beard","mustache","goatee"]};for(const[,a]of Object.entries(s))a.some(o=>e[o])&&a.forEach(o=>{e[o]=!0});return e},ne=(t,e,s)=>t.map(a=>{const o=e[a],r={"18-21":"young","21-30":"adult","30-40":"adult","40-50":"adult","50-60":"senior","60-70":"senior","70-80":"senior","80-90":"senior"}[o.age]||o.age,n=[o.gender,r,o.ethnicity,o.height,o.build],c=o.features.filter(l=>s[l]);return{id:o.id,name:o.name,gender:o.gender,features:[...n,...c]}}),re=t=>{const e={};p("âš™ï¸ Calculating suspect answers...");for(const s of Object.keys(t)){const a=t[s];for(const o of Object.keys(a)){const{resolution:r,projection:n}=X(o,s,a);if(!(!r&&!n)){if(e[s]===void 0&&(e[s]={}),r){e[s][o]=r==="ðŸ‘";continue}n&&(e[s][o]=n==="ðŸ‘")}}}return Object.keys(e).forEach(s=>{h.isEmpty(e[s])&&delete e[s]}),Object.keys(e).forEach(s=>{Object.keys(e[s]).length<3&&(p("â‰ï¸ Removing testimonies with less than 3 answers"),delete e[s])}),Object.keys(e).forEach(s=>{h.uniq(Object.values(e[s])).length===1&&(p("â‰ï¸ Removing testimonies with the same answer"),delete e[s])}),e},ie=t=>{const e={};for(const a of Object.keys(t)){const{gender:o,ethnicity:r,age:n,build:c,height:l,features:m}=t[a];if(!c){p("â‰ï¸ Ignoring suspect with missing build",a);continue}if(!l){p("â‰ï¸ Ignoring suspect with missing height",a);continue}if(!m||m.length===0){p("â‰ï¸ Ignoring suspect with missing features",a);continue}e[o]===void 0&&(e[o]={}),e[o][a]=!0,e[r]===void 0&&(e[r]={}),e[r][a]=!0,e[n]===void 0&&(e[n]={}),e[n][a]=!0,e[c]===void 0&&(e[c]={}),e[c][a]=!0,e[l]===void 0&&(e[l]={}),e[l][a]=!0,m.forEach(i=>{e[i]===void 0&&(e[i]={}),e[i][a]=!0})}return e.young=h.cloneDeep(e["18-21"]),e.adult=h.cloneDeep({...e["21-30"],...e["30-40"],...e["40-50"]}),e.senior=h.cloneDeep({...e["50-60"],...e["60-70"],...e["70-80"],...e["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(a=>{delete e[a]}),e},ce=(t,e)=>{let s=0,a,o,r=[];for(;s<P&&!o&&r.length===0;){if(s++,a=h.sample(Object.keys(t)),!a)throw new Error("Failed to find a testimony");const i=Object.keys(t[a]);if(o=h.sample(Object.keys(t).filter(f=>f!==a&&!h.isEmpty(h.difference(i,Object.keys(t[f]))))),o){r=h.intersection(Object.keys(t[a]),Object.keys(t[o]));break}}if(!a||!o||r.length<3)throw new Error("Failed to find two related testimonies");const n=h.sample(r.filter(i=>!e.includes(i)));if(!n)throw new Error("Failed to determine a culprit from common suspects");p("<===============>"),p(`âš™ï¸ Selected testimonies 1: ${a}`),p(t[a]),p(`âš™ï¸ Selected testimonies 2: ${o}`),p(t[o]),p(`âš™ï¸ Culprit ID: ${n}`),p(`Testimony 1 answers: ${t[a][n]}`),p(`Testimony 2 answers: ${t[o][n]}`);const c=`${t[a][n]}-${t[o][n]}`,l=h.sampleSize(r.filter(i=>i!==n&&`${t[a][i]}-${t[o][i]}`!==c),$-1),m=h.difference(r,l);return p(`âš™ï¸ Possible suspects: ${l.join(", ")}`),p(`âš™ï¸ Impossible suspects: ${m.join(", ")}`),p(`âš™ï¸ Attempts made: ${s}`),p(">===============<"),{selectedTestimonyId1:a,selectedTestimonyId2:o,culpritId:n,possibleSuspects:l,impossibleSuspects:m}},j=(t,e)=>{e.forEach(s=>{t[s]===void 0&&(t[s]=0),t[s]++})},G=(t,e,s,a)=>{const o=a[t],r=e.filter(l=>a[l]!==void 0&&a[l]!==o),n=s.answer.charAt(0).toLowerCase()+s.answer.slice(1),c={key:`testimony.${s.id}`,text:`O(a) suspeito(a) ${o?"":"nÃ£o "}${n}`,excludes:r,type:"testimony"};return c.text.includes("nÃ£o jÃ¡")&&(c.text=c.text.replace("nÃ£o jÃ¡","nunca")),c},ue={column1:{indexes:[0,4,8],text:"na primeira coluna"},column2:{indexes:[1,5,9],text:"na segunda coluna"},column3:{indexes:[2,6,10],text:"na terceira coluna"},column4:{indexes:[3,7,11],text:"na quarta coluna"},corners:{indexes:[0,3,8,11],text:"nos cantos"}},le={row1:{indexes:[0,1,2,3],text:"na primeira linha"},row2:{indexes:[4,5,6,7],text:"na segunda linha"},row3:{indexes:[8,9,10,11],text:"na terceira linha"}},A=(t,e,s,a)=>{const o=e.indexOf(t),r=s.slice(0,3),n=a==="rows"?le:ue,c={};for(const u of Object.keys(n)){const{indexes:d}=n[u];d.includes(o)||(c[u]=d.reduce((b,E)=>{const x=e[E],w=r.filter(y=>y.excludes.includes(x)).length;return w>0?b+w:b},0))}const l=Object.entries(c).reduce((u,[d,b])=>(u[b]||(u[b]=[]),u[b].push(d),u),{}),m=Math.min(...Object.keys(c).map(u=>c[u])),i=l[m.toString()],f=h.sample(i)||Object.keys(c)[0],S=n[f].indexes.map(u=>e[u]);return{key:`not.grid.${f}`,text:`O(a) suspeito(a) nÃ£o estÃ¡ ${n[f].text}`,excludes:S,type:"grid"}},N=(t,e,s,a=[],o="best")=>{const r=h.difference(e,[t]),n=a.filter(d=>d.key.startsWith("not.feature.")).map(d=>d.key.replace("not.feature.","")),c=new Set(a.flatMap(d=>d.excludes)),l=Object.keys(s).filter(d=>Object.keys(s[d]).length<=6&&!n.includes(d)).sort((d,b)=>Object.keys(s[b]).length-Object.keys(s[d]).length);let m,i=[],f=0;const S=500;for(;f<S;){f++;const d=o==="best"?l[0]:h.sample(l.slice(2,5))??l[2];if(!d)break;const b=r.filter(x=>s[d][x]);if(b.some(x=>!c.has(x))||f===S){m=d,i=b;break}l.splice(l.indexOf(d),1)}if(!m)throw Error(`No suitable feature found for ${o} selection after ${S} attempts`);p(`Selected feature after ${f} attempts: ${m}`);const u=te[m];return u||ee(`Feature ${m} not found in translations`),{key:`not.feature.${m}`,text:`O(a) suspeito(a) nÃ£o ${u||m}`,excludes:i,type:"feature"}},de=t=>{const e=t.slice(0,3);return e.reduce((o,r)=>o+r.excludes.length,0)<10?!1:new Set(e.flatMap(o=>o.excludes)).size===$-1},me=(t,e)=>{const s=[];Object.values(e).forEach(o=>{o.feature==="general"&&s.push(o),t.features?.includes(o.feature)&&s.push(o)});const a=h.sample(s);return a||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},fe=t=>{const e=t.slice(0,3),s=[],a={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};e.forEach(r=>{const n=r.excludes.length;a[n]!==void 0&&s.push(a[n])});const o=Math.round(s.reduce((r,n)=>r+n,0)/s.length);return Math.min(Math.max(o,1),3)};function ve(){const t=v("suspects"),e=v("testimony-questions-pt"),s=K({tdrResourceName:"testimony-answers",firestoreDataCollectionName:"testimonies",serialize:!0});return{...s,isLoading:s.isLoading||e.isLoading||t.isLoading,isSuccess:s.isSuccess&&e.isSuccess&&t.isSuccess,error:s.error||e.error||t.error,questions:e.data,suspects:t.data,hasNewData:s.hasFirestoreData}}const Oe=t=>t.reduce((e,s)=>{const a=Math.abs(s);return a?e+a:e},0);export{Ee as a,ve as b,Oe as c,g as d,xe as t,we as u};
