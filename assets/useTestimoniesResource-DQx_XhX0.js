import{u as Q,D as Y,a as z,A as P}from"./useParsedHistory-FGxYETbN.js";import{l as y}from"./useBaseUrl-BN9cOw-T.js";import{u as j}from"./useTDResource-CNitcFAv.js";import{a7 as W,a8 as X,r as T}from"./index-D-60WIp5.js";import{u as J}from"./useResourceFirestoreData-CWHN77cH.js";const U="td-admin-debug-daily",K=()=>{const t={"aqui-o":!1,"arte-ruim":!1,artista:!1,"comunicacao-alienigena":!1,"controle-de-estoque":!1,espionagem:!1,filmaco:!1,organiku:!1,palavreado:!1,"portais-magicos":!1,quartetos:!1,"ta-na-cara":!1,"teoria-de-conjuntos":!1};try{const e=localStorage.getItem(U);return e?JSON.parse(e):t}catch{return t}},b=new X(K());b.subscribe(()=>{try{const t={"aqui-o":b.state["aqui-o"],"arte-ruim":b.state["arte-ruim"],artista:b.state.artista,"comunicacao-alienigena":b.state["comunicacao-alienigena"],"controle-de-estoque":b.state["controle-de-estoque"],espionagem:b.state.espionagem,filmaco:b.state.filmaco,organiku:b.state.organiku,palavreado:b.state.palavreado,"portais-magicos":b.state["portais-magicos"],quartetos:b.state.quartetos,"ta-na-cara":b.state["ta-na-cara"],"teoria-de-conjuntos":b.state["teoria-de-conjuntos"]};localStorage.setItem(U,JSON.stringify(t))}catch{}});const Se=(t,e)=>{b.setState(s=>({...s,[t]:!s[t]}))},Ee=()=>W(b,()=>b.state),V=(t,e,s)=>{const{reliabilityThreshold:o=4,projectionThreshold:a=55}={},r=`us-gb-${t.split("-")[1]}`,i=y.isEmpty(e[t])?[]:e[t];let n=0,l=0;i.forEach(S=>{S>0&&(n+=S),S<0&&(l+=Math.abs(S))});const u=i.filter(S=>![-4,-3,3,4,-32,32].includes(S)),f=u.length+n+l,h=Math.max(f,5),m=i.filter(S=>S===1).length+n,p=Math.round(m/h*100),E=i.filter(S=>S===0).length+l,x=Math.round(E/h*100),w=Math.round((h-m-E)/h*100),v=u.length+n+l>=5,k=f>3,$=f>o,D=$&&Math.abs(p-x)>40?p>x?"üëç":"üëé":null,N=!k||Math.abs(p-x)<60?null:p>=a?"üëç":x>=a?"üëé":null;return{suspectCardId:t,imageId:r,enoughData:k,reliable:$,total:h,yesCount:m,yesPercentage:p,noCount:E,noPercentage:x,blankPercentage:w,complete:v,values:i,resolution:D,projection:N}};function xe(t){const e=t.map(n=>n===0?-1:n),s=t.filter(n=>n===-32||n===32||n===4||n===-4),o=e.filter(n=>n===-1||n===1),a=e.filter(n=>![-32,32,3,-3,-1,1].includes(n)).flatMap(n=>Array.from({length:Math.abs(n)},()=>n>0?1:-1)),c=[...o,...a].sort((n,l)=>n-l),r={"-1":0,1:0};c.forEach(n=>{(n===-1||n===1)&&(r[n]+=1)});const i=8;for(const[n,l]of Object.entries(r)){const u=Math.floor(l/i),f=l%i;for(let h=0;h<u;h++)s.push(n==="-1"?-i:i);if(f>0){const h=Array.from({length:f},()=>n==="-1"?-1:1);s.push(...h)}}return s.sort((n,l)=>n-l)}const g=(...t)=>{b.state.espionagem&&console.log(...t)},Z=t=>{b.state.espionagem&&console.count(t)},ee=(...t)=>{b.state.espionagem&&console.error(...t)},te={male:"√© homem",female:"√© mulher",caucasian:"√© branco(a)",black:"√© negro(a)",asian:"√© asi√°tico(a)",latino:"√© latino(a)",thin:"√© magrelo(a)",fat:"√© gordo(a)",large:"√© gordo(a)",tall:"√© alto(a)",short:"√© baixinho(a)",young:"√© jovem",adult:"√© adulto(a)",senior:"√© da terceira idade",average:"tem corpo normal",medium:"√© de altura m√©dia",mixed:"√© mesti√ßo(a)",hat:"est√° usando um chap√©u",tie:"est√° usando uma gravata",glasses:"est√° usando √≥culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",scarf:"est√° usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"√© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"√© sarado(a)",blackHair:"tem cabelo preto",hoodie:"est√° usando um moletom",earrings:"est√° usando brincos",lipstick:"est√° usando batom",necklace:"est√° usando um colar",mediumHair:"tem cabelo m√©dio","middle-eastern":"√© do Oriente M√©dio",headscarf:"est√° usando um len√ßo na cabe√ßa",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"√© indiano(a)","native-american":"√© nativo-americano(a)",noAccessories:"est√° sem nenhum acess√≥rio",avoidingCamera:"est√° evitando olhar para a c√¢mera",wearingStripes:"tem listras na roupa",blackClothes:"est√° vestindo roupas pretas",blueClothes:"est√° vestindo roupas azuis",greenClothes:"est√° vestindo roupas verdes",redClothes:"est√° vestindo roupas vermelhas",yellowClothes:"est√° vestindo roupas amarelas",purpleClothes:"est√° vestindo roupas roxas",orangeClothes:"est√° vestindo roupas laranjas",brownClothes:"est√° vestindo roupas marrons",whiteShirt:"est√° usando camisa branca",pinkClothes:"est√° vestindo roupas rosas",patternedShirt:"est√° usando roupa estampada",buttonShirt:"est√° usando camisa com bot√µes",bow:"est√° usando um la√ßo",hairyChest:"tem peito peludo",wearingFlowers:"est√° usando flores",showTeeth:"est√° mostrando os dentes",hairTie:"est√° usando um xuxinha ou fita no cabelo","non-binary":"√© n√£o-bin√°rio(a)"},I=12,we=(t,e,s,o)=>{const[a]=Q(Y.ESPIONAGEM,o),c=j("suspects",t),r=j(`testimony-questions-${e}`,t),i=j("testimony-answers",t),n=j("crime-reasons",t),l=T.useMemo(()=>re(i.data),[i.dataUpdatedAt]),u=T.useMemo(()=>ie(c.data),[c.data]);return{entries:T.useMemo(()=>!t||!a||!c.isSuccess||!r.isSuccess||!i.isSuccess||!n.isSuccess?{}:se(s,a,c.data,r.data,l,u,n.data),[t,a,c,r,i,s,l,u,n]),isLoading:c.isLoading||r.isLoading||i.isLoading}},se=(t,e,s,o,a,c,r)=>{Z("Creating Espionagem...");let i=e.latestDate;const n=[],l={};for(let u=0;u<t;u++){const f=z(i);i=f;let h=null,d=0;for(;h===null&&d<P;)try{d++;const m=oe(s,o,a,c,n,r);if(de(m.statements))throw h=m,new Error(`Game is invalid after ${d} attempts`)}catch{}if(!h)throw new Error(`Failed to generate valid game for ${f} after ${d} attempts`);g(`Generated valid game for ${f} after ${d} attempts`),n.push(h.culpritId),l[f]={id:f,type:"espionagem",number:e.latestNumber+u+1,...h}}return l};function oe(t,e,s,o,a,c){const r=[],i={};g("SuspectTestimonyAnswers",s);const{selectedTestimonyId1:n,selectedTestimonyId2:l,culpritId:u,possibleSuspects:f,impossibleSuspects:h}=ce(s,a);if(f.length<2)throw new Error("Not enough possible suspects");let d=[...f];if(f.length<I-1){const C=y.sampleSize(Object.keys(t).filter(F=>!h.includes(F)&&!f.includes(F)),I-f.length-1);d.push(...C)}const m={};Object.keys(o).forEach(C=>{if(o[C][u]===void 0){const F=Object.keys(o[C]).filter(R=>d.includes(R));if(F.length>0){const R={};F.forEach(_=>{d.includes(_)&&(R[_]=!0)}),m[C]=R}}});const p=e[n],O=A(u,d,p,s[n]);r.push(O),M(i,O.excludes);const E=e[l],x=A(u,d,E,s[l]);r.push(x),M(i,x.excludes);const w=H(u,d,m,[],"best");if(w.excludes.length===I-2)throw new Error("Best feature statement excludes too many suspects");r.push(w),M(i,w.excludes);const v=H(u,d,m,[w],"best");r.push(v);const k=H(u,d,m,[w,v],"worst");r.push(k),M(i,k.excludes);const $=H(u,d,m,[w,v,k],"worst");if(r.push($),r.length<6)throw new Error("Not enough statements generated");d=y.shuffle([...d,u]);const D=G(u,d,r,"columns");r.push(D),M(i,D.excludes);const N=G(u,d,r,"rows");r.push(N);const S=[O,k,x,w,D,$],q=[v,N],L=me(t[u],c),B=ae([...S,...q]);return{isNsfw:p.nsfw||E.nsfw||!1,culpritId:u,statements:S,additionalStatements:q,suspects:ne(d,t,B),reason:L.title,setId:`${u}::${L.id}::${S[0].key}`,level:fe(S)}}const ae=t=>{const e={};t.forEach(o=>{if(o.key.includes(".feature.")){const a=o.key.split("not.feature.")[1];e[a]=!0}});const s={hairColor:["brownHair","blondeHair","greyHair","redHair","blackHair","coloredHair"],hairLength:["shortHair","mediumHair","longHair","bald"],facialHair:["beard","mustache","goatee"]};for(const[,o]of Object.entries(s))o.some(a=>e[a])&&o.forEach(a=>{e[a]=!0});return e},ne=(t,e,s)=>t.map(o=>{const a=e[o],c={"18-21":"young","21-30":"adult","30-40":"adult","40-50":"adult","50-60":"senior","60-70":"senior","70-80":"senior","80-90":"senior"}[a.age]||a.age,r=[a.gender,c,a.ethnicity,a.height,a.build],i=a.features.filter(n=>s[n]);return{id:a.id,name:a.name,gender:a.gender,features:[...r,...i]}}),re=t=>{const e={};g("‚öôÔ∏è Calculating suspect answers...");for(const s of Object.keys(t)){const o=t[s];for(const a of Object.keys(o)){const{resolution:c,projection:r}=V(a,o);if(!(!c&&!r)){if(e[s]===void 0&&(e[s]={}),c){e[s][a]=c==="üëç";continue}r&&(e[s][a]=r==="üëç")}}}return Object.keys(e).forEach(s=>{y.isEmpty(e[s])&&delete e[s]}),Object.keys(e).forEach(s=>{Object.keys(e[s]).length<3&&(g("‚ÅâÔ∏è Removing testimonies with less than 3 answers"),delete e[s])}),Object.keys(e).forEach(s=>{y.uniq(Object.values(e[s])).length===1&&(g("‚ÅâÔ∏è Removing testimonies with the same answer"),delete e[s])}),e},ie=t=>{const e={};for(const o of Object.keys(t)){const{gender:a,ethnicity:c,age:r,build:i,height:n,features:l}=t[o];if(!i){g("‚ÅâÔ∏è Ignoring suspect with missing build",o);continue}if(!n){g("‚ÅâÔ∏è Ignoring suspect with missing height",o);continue}if(!l||l.length===0){g("‚ÅâÔ∏è Ignoring suspect with missing features",o);continue}e[a]===void 0&&(e[a]={}),e[a][o]=!0,e[c]===void 0&&(e[c]={}),e[c][o]=!0,e[r]===void 0&&(e[r]={}),e[r][o]=!0,e[i]===void 0&&(e[i]={}),e[i][o]=!0,e[n]===void 0&&(e[n]={}),e[n][o]=!0,l.forEach(u=>{e[u]===void 0&&(e[u]={}),e[u][o]=!0})}return e.young=y.cloneDeep(e["18-21"]),e.adult=y.cloneDeep({...e["21-30"],...e["30-40"],...e["40-50"]}),e.senior=y.cloneDeep({...e["50-60"],...e["60-70"],...e["70-80"],...e["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(o=>{delete e[o]}),e},ce=(t,e)=>{let s=0,o,a,c=[];for(;s<P&&!a&&c.length===0;){if(s++,o=y.sample(Object.keys(t)),!o)throw new Error("Failed to find a testimony");const u=Object.keys(t[o]);if(a=y.sample(Object.keys(t).filter(f=>f!==o&&!y.isEmpty(y.difference(u,Object.keys(t[f]))))),a){c=y.intersection(Object.keys(t[o]),Object.keys(t[a]));break}}if(!o||!a||c.length<3)throw new Error("Failed to find two related testimonies");const r=y.sample(c.filter(u=>!e.includes(u)));if(!r)throw new Error("Failed to determine a culprit from common suspects");g("<===============>"),g(`‚öôÔ∏è Selected testimonies 1: ${o}`),g(t[o]),g(`‚öôÔ∏è Selected testimonies 2: ${a}`),g(t[a]),g(`‚öôÔ∏è Culprit ID: ${r}`),g(`Testimony 1 answers: ${t[o][r]}`),g(`Testimony 2 answers: ${t[a][r]}`);const i=`${t[o][r]}-${t[a][r]}`,n=y.sampleSize(c.filter(u=>u!==r&&`${t[o][u]}-${t[a][u]}`!==i),I-1),l=y.difference(c,n);return g(`‚öôÔ∏è Possible suspects: ${n.join(", ")}`),g(`‚öôÔ∏è Impossible suspects: ${l.join(", ")}`),g(`‚öôÔ∏è Attempts made: ${s}`),g(">===============<"),{selectedTestimonyId1:o,selectedTestimonyId2:a,culpritId:r,possibleSuspects:n,impossibleSuspects:l}},M=(t,e)=>{e.forEach(s=>{t[s]===void 0&&(t[s]=0),t[s]++})},A=(t,e,s,o)=>{const a=o[t],c=e.filter(n=>o[n]!==void 0&&o[n]!==a),r=s.answer.charAt(0).toLowerCase()+s.answer.slice(1),i={key:`testimony.${s.id}`,text:`O(a) suspeito(a) ${a?"":"n√£o "}${r}`,excludes:c,type:"testimony"};return i.text.includes("n√£o j√°")&&(i.text=i.text.replace("n√£o j√°","nunca")),i},ue={column1:{indexes:[0,4,8],text:"na primeira coluna"},column2:{indexes:[1,5,9],text:"na segunda coluna"},column3:{indexes:[2,6,10],text:"na terceira coluna"},column4:{indexes:[3,7,11],text:"na quarta coluna"},corners:{indexes:[0,3,8,11],text:"nos cantos"}},le={row1:{indexes:[0,1,2,3],text:"na primeira linha"},row2:{indexes:[4,5,6,7],text:"na segunda linha"},row3:{indexes:[8,9,10,11],text:"na terceira linha"}},G=(t,e,s,o)=>{const a=e.indexOf(t),c=s.slice(0,3),r=o==="rows"?le:ue,i={};for(const d of Object.keys(r)){const{indexes:m}=r[d];m.includes(a)||(i[d]=m.reduce((p,O)=>{const E=e[O],x=c.filter(w=>w.excludes.includes(E)).length;return x>0?p+x:p},0))}const n=Object.entries(i).reduce((d,[m,p])=>(d[p]||(d[p]=[]),d[p].push(m),d),{}),l=Math.min(...Object.keys(i).map(d=>i[d])),u=n[l.toString()],f=y.sample(u)||Object.keys(i)[0],h=r[f].indexes.map(d=>e[d]);return{key:`not.grid.${f}`,text:`O(a) suspeito(a) n√£o est√° ${r[f].text}`,excludes:h,type:"grid"}},H=(t,e,s,o=[],a="best")=>{const c=y.difference(e,[t]),r=o.filter(m=>m.key.startsWith("not.feature.")).map(m=>m.key.replace("not.feature.","")),i=new Set(o.flatMap(m=>m.excludes)),n=Object.keys(s).filter(m=>Object.keys(s[m]).length<=6&&!r.includes(m)).sort((m,p)=>Object.keys(s[p]).length-Object.keys(s[m]).length);let l,u=[],f=0;const h=500;for(;f<h;){f++;const m=a==="best"?n[0]:y.sample(n.slice(2,5))??n[2];if(!m)break;const p=c.filter(E=>s[m][E]);if(p.some(E=>!i.has(E))||f===h){l=m,u=p;break}n.splice(n.indexOf(m),1)}if(!l)throw Error(`No suitable feature found for ${a} selection after ${h} attempts`);g(`Selected feature after ${f} attempts: ${l}`);const d=te[l];return d||ee(`Feature ${l} not found in translations`),{key:`not.feature.${l}`,text:`O(a) suspeito(a) n√£o ${d||l}`,excludes:u,type:"feature"}},de=t=>{const e=t.slice(0,3);return e.reduce((a,c)=>a+c.excludes.length,0)<10?!1:new Set(e.flatMap(a=>a.excludes)).size===I-1},me=(t,e)=>{const s=[];Object.values(e).forEach(a=>{a.feature==="general"&&s.push(a),t.features?.includes(a.feature)&&s.push(a)});const o=y.sample(s);return o||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},fe=t=>{const e=t.slice(0,3),s=[],o={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};e.forEach(c=>{const r=c.excludes.length;o[r]!==void 0&&s.push(o[r])});const a=Math.round(s.reduce((c,r)=>c+r,0)/s.length);return Math.min(Math.max(a,1),3)};function Oe(){const t=j("suspects"),e=j("testimony-questions-pt"),s=J({tdrResourceName:"testimony-answers",firestoreDataCollectionName:"testimonies",serialize:!0});return{...s,isLoading:s.isLoading||e.isLoading||t.isLoading,isSuccess:s.isSuccess&&e.isSuccess&&t.isSuccess,error:s.error||e.error||t.error,questions:e.data,suspects:t.data,hasNewData:s.hasFirestoreData}}const ke=t=>t.reduce((e,s)=>{const o=Math.abs(s);return o?e+o:e},0);export{Ee as a,V as b,ke as c,b as d,Oe as e,xe as n,Se as t,we as u};
