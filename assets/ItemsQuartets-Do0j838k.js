import{j as e,T as j,ah as F,B as w,r as x,D as Q,P as k,L as T}from"./index-CD2lQx4f.js";import{D as L}from"./DataLoadingWrapper-BVfG3l-0.js";import{T as B}from"./Typeahead-WF7Cboma.js";import{R as P,I as y}from"./Item-Bz0_XYJY.js";import{u as E}from"./useCopyToClipboardFunction-HXJCF-BI.js";import{u as A}from"./useTableExpandableRows-BenSI3ku.js";import{u as $}from"./useTablePagination-cfXPHmmI.js";import{u as b}from"./useTDResource-idwmPnrO.js";import{l as f,P as z}from"./useBaseUrl-Bgww8MYZ.js";import{r as v,b as M,h as G,w as J,a as _}from"./index-CLQIfBBa.js";import{I as O}from"./InspirationSample-BLN_-9x3.js";import{I as W}from"./ItemsTypeahead-bUlFmiR1.js";import{F as D}from"./Table-axzLO2_4.js";import{F as d}from"./index-DKHdniSb.js";import{S as K}from"./index-DNGCIE4G.js";import{R as Y}from"./index-B5SnzZ1K.js";import{S as U}from"./index-CTbYdUvi.js";import{S as I}from"./index-B96rb3bS.js";import{P as X}from"./index-D7bv13ez.js";import{R as H}from"./DeleteFilled-ChvOQuMs.js";import{u as S}from"./useQueryParams-CF8Hi25q.js";import{c as V,F as Z,T as q}from"./FilterEntries-Bs0G3S2r.js";import{S as ee}from"./SiderContent-t1h7BugK.js";import{D as te}from"./DownloadButton-BOgfzdWt.js";import{S as se}from"./SaveButton-BseHkRpP.js";import{M as re}from"./index-XFHZ6HLo.js";import{C as ie}from"./index-D747eGrK.js";import{R as ae}from"./TableOutlined-CBOtnQUU.js";import{R as oe}from"./FrownOutlined-BxlHjNY1.js";import{R as ne}from"./RobotOutlined-vq0EZ1nG.js";import{T as le}from"./TransparentButton-DQfyphkw.js";import{u as ce,P as de}from"./useGridPagination-BQQ6ZqM5.js";import{a as N}from"./ItemBuildingBlocks-Bx6L25JB.js";import{D as me}from"./index-D1BQZejG.js";import{R as ue}from"./main-k96QP3Gh.js";import{u as pe}from"./daily-quartetos-CMKx5fdv.js";import{g as he}from"./constants-D1QS-T8p.js";import{u as xe}from"./useResourceFirestoreData-Ckcka-iX.js";import"./useDebounce-CYjpp--u.js";import"./index-DtyFOrZD.js";import"./index-DiFhVfyK.js";import"./Input-CTphaWZv.js";import"./constants-DFs3AddX.js";import"./SyncOutlined-fYlQirXm.js";import"./PlusOutlined-C1HVgwg7.js";import"./index-C_ir9kit.js";import"./index-iy7Kw0c8.js";import"./index-CZZ5P_rD.js";import"./scrollTo-CaqoTRmm.js";import"./Pagination-BJrOBp74.js";import"./extendsObject-keMuGWqj.js";import"./gapSize-U1swVQyS.js";import"./index-BA8x64Vc.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-M2mo2AsX.js";import"./index-npxyzaEn.js";import"./LanguageFlag-Qhm-pAz2.js";import"./FireFilled-DfCiSQTM.js";import"./IdcardOutlined-aSK3dTi2.js";import"./useGetFirestoreDoc-Dl3MhrIg.js";import"./useUpdateFirestoreDoc-DX3j66JU.js";import"./useMutation-DZuVovRz.js";const fe=f.orderBy(["general","visual","word","thematic","attribute"]).map(t=>({label:t,value:t}));function R({rows:t,addEntryToUpdate:s}){const r=E(),o=b("items"),n=$({total:t.length,showQuickJumper:!0}),c=[{title:"ID",dataIndex:"id",render(a,i){return e.jsxs(d,{align:"center",gap:3,children:[i.itemsIds.length>=4&&!i.level&&e.jsx(P,{style:{color:"red"}}),e.jsx(j.Text,{copyable:!0,children:a})]})}},{title:"Title",dataIndex:"title",render:(a,i)=>e.jsx(Ie,{addEntryToUpdate:s,property:"title",quartet:i,value:a}),sorter:(a,i)=>a.title.localeCompare(i.title)},D.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(a,i)=>e.jsx(ye,{addEntryToUpdate:s,copyToClipboard:r,itemsIds:a,quartet:i}),sorter:(a,i)=>a.itemsIds.length-i.itemsIds.length},{title:"Count",dataIndex:"itemsIds",render:a=>v(a).filter(Boolean).length,sorter:(a,i)=>a.itemsIds.length-i.itemsIds.length},{title:"Type",dataIndex:"type",render:(a,i)=>e.jsx(K,{defaultValue:a,onChange:p=>s(i.id,{...i,type:p}),options:fe,size:"small",style:{width:100}}),sorter:(a,i)=>(a.type??"_").localeCompare(i.type??"_")},{title:"Level",dataIndex:"level",render:(a,i)=>e.jsx(Y,{count:4,onChange:p=>s(i.id,{...i,level:p}),value:a}),sorter:(a,i)=>a.level-i.level},{title:"Perfect Quartet",dataIndex:"itemsIds",render:a=>v(a).filter(Boolean).length===4&&e.jsx(F,{style:{color:"dodgerblue"}})},{title:"Flagged",dataIndex:"flagged",render:(a,i)=>e.jsx(U,{checked:a,checkedChildren:e.jsx(P,{style:{color:"red"}}),onChange:p=>{if(p)s(i.id,{...i,flagged:p});else{const m=f.cloneDeep(i);delete m.flagged,s(i.id,m)}}}),sorter:(a,i)=>(a.flagged?1:0)-(i.flagged?1:0)}],l=A({maxExpandedRows:1,expandedRowRender:a=>e.jsx(je,{addEntryToUpdate:s,quartet:a}),rowExpandable:()=>o.isSuccess});return e.jsx(D,{columns:c,dataSource:t,expandable:l,pagination:n,rowClassName:a=>a.itemsIds.length>=4&&!a.level?"table-row-error":"",rowKey:"id"})}function je({quartet:t,addEntryToUpdate:s}){const r=o=>{s(t.id,{...t,itemsIds:[...t.itemsIds,o]})};return e.jsxs("div",{children:[e.jsx(W,{onFinish:r}),e.jsx(O,{excludeList:t.itemsIds,initialQuantity:0,onSelect:r})]})}function ge({quartet:t,addEntryToUpdate:s,itemId:r}){const o=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(n=>n!==r)})};return e.jsx(X,{cancelText:"No",okText:"Yes",onConfirm:o,title:"Are you sure you want to remove this item?",children:e.jsx(w,{icon:e.jsx(H,{}),size:"small",type:"text"})})}function ye({quartet:t,itemsIds:s,copyToClipboard:r,addEntryToUpdate:o}){return e.jsx(d,{gap:6,wrap:"wrap",children:s.map(n=>e.jsxs(d,{gap:2,vertical:!0,children:[n?e.jsx(y,{id:String(n),width:60}):'"ERROR"',e.jsxs(d,{justify:"center",children:[e.jsx(j.Text,{onClick:()=>r(n),children:n}),e.jsx(ge,{addEntryToUpdate:o,itemId:n,quartet:t})]})]},`${t.title}-${n}`))},`items-${t.title}`)}function Ie({value:t,quartet:s,addEntryToUpdate:r,property:o}){const n=c=>typeof t=="number"?c!==String(t)?r(s.id,{...s,[o]:Number(c)}):null:c!==t?r(s.id,{...s,[o]:c.trim()}):null;return e.jsx(I,{children:e.jsx(j.Text,{editable:{onChange:n},children:String(t)})})}function C({data:t,addEntryToUpdate:s}){const[r,o]=x.useState(null),n=x.useMemo(()=>r?t[r]:null,[r,t]);return e.jsxs(I,{direction:"vertical",children:[e.jsx(j.Title,{level:5,children:"Search Quartet"}),e.jsx(B,{data:t,onFinish:c=>o(c),parser:ve,placeholder:"Search quartet by title..."}),!!n&&e.jsx(R,{addEntryToUpdate:s,rows:[n]})]})}const ve=t=>Object.values(t??{}).reduce((s,r)=>(s[`${r.title} (${r.id})`]=r.id,s),{});function Ce({data:t,addEntryToUpdate:s}){const{is:r}=S(),o=r("emptyOnly"),n=x.useMemo(()=>o?f.orderBy(Object.values(t).filter(l=>l.itemsIds.length<4),["id"],["asc"]):f.orderBy(Object.values(t),["id"],["asc"]),[t,o]),c=n.filter(l=>l.itemsIds.length===4).length;return e.jsxs(I,{direction:"vertical",children:[e.jsxs(j.Title,{level:5,children:["Total Quartets: ",n.length," | Complete Quartets: ",c]}),e.jsx(R,{addEntryToUpdate:s,rows:n})]})}function we({data:t,addEntryToUpdate:s}){const[r,o]=x.useState(!1),n=x.useMemo(()=>M(Object.keys(t)),[t]),c=()=>f.cloneDeep({id:n,title:"",itemsIds:[],level:0}),[l,a]=x.useState(c()),i=(u,g)=>{a({...g})},p=u=>{a(g=>({...g,itemsIds:v([...g.itemsIds,u])}))},m=async()=>{s(l.id,f.cloneDeep(l)),o(!1),await J(250),a(c())},h=x.useMemo(()=>l.title.length<3?[]:f.orderBy(Object.values(t),u=>G.compareTwoStrings(u.title.toLocaleLowerCase(),l.title.toLocaleLowerCase()),"desc").slice(0,5).filter(u=>u.id!==l.id),[l.title,l.id,t]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{block:!0,onClick:()=>o(!0),type:"dashed",children:"Add New Set"}),e.jsx(re,{maskClosable:!1,okButtonProps:{disabled:!l.title,onClick:m},onCancel:()=>o(!1),open:r,title:"Add Quartet",width:"80vw",children:!!l&&e.jsxs(e.Fragment,{children:[e.jsx(R,{addEntryToUpdate:i,expandedRowKeys:[l.id],rows:[l]}),h.length>0&&e.jsx(ie,{size:"small",children:e.jsx(d,{gap:4,vertical:!0,children:h.map(u=>e.jsx("div",{children:u.title},u.id))})}),e.jsx(O,{excludeList:l.itemsIds,onSelect:p})]})})]})}function be({data:t,save:s,isDirty:r,isSaving:o,entriesToUpdate:n,addEntryToUpdate:c,hasFirestoreData:l}){const{is:a,addParam:i,queryParams:p,addParams:m}=S();return Re(),e.jsxs(ee,{children:[e.jsxs(d,{gap:12,vertical:!0,children:[e.jsx(se,{dirt:JSON.stringify(n),isDirty:r,isSaving:o,onSave:s}),e.jsx(te,{block:!0,data:()=>Se(t),disabled:r,fileName:"daily-quartet-sets.json",hasNewData:l})]}),e.jsx(Q,{}),e.jsx(V,{label:"Pending Only",onChange:h=>i("emptyOnly",h,!1),value:a("emptyOnly")}),e.jsx(we,{addEntryToUpdate:c,data:t}),e.jsx(Q,{}),e.jsx(Z,{label:"Display",onChange:h=>m({display:h,page:1},{page:1,display:"table"}),options:[{title:"Table",icon:e.jsx(ae,{}),value:"table"},{title:"Orphans",icon:e.jsx(oe,{}),value:"orphans"},{title:"Simulator",icon:e.jsx(ne,{}),value:"simulator"}],value:p.get("display")??"table"})]})}function Se(t){return _(t)}function Re(){const t=b("items");x.useEffect(()=>{if(!t.dataUpdatedAt)return;const s={twoChars:{},threeChars:{},fourChars:{}};Object.values(t.data??{}).forEach(r=>{var a;const o=r.name.pt||((a=r.aliasesPt)==null?void 0:a.find(i=>i.split(" ").length===1));if(!o||o.length<3)return;const n=o.slice(-2).trim();if(n.length<2)return;s.twoChars[n]||(s.twoChars[n]=[]),s.twoChars[n].push(r);const c=o.slice(-3).trim();if(c.length<3)return;s.threeChars[c]||(s.threeChars[c]=[]),s.threeChars[c].push(r);const l=o.slice(-4).trim();l.length<4||(s.fourChars[l]||(s.fourChars[l]=[]),s.fourChars[l].push(r))}),Object.keys(s).forEach(r=>{Object.keys(s[r]).forEach(o=>{s[r][o].length<4&&delete s[r][o]})}),console.log("Grouped Items by Name Ending:",s)},[t.dataUpdatedAt])}function Qe({data:t,...s}){const r=b("items"),[o,n]=x.useState(null),{unusedItems:c}=x.useMemo(()=>{const i=Object.values(t).reduce((m,h)=>(h.itemsIds.forEach(u=>{m[u]||(m[u]=[]),m[u].push(h.id)}),m),{}),p=Object.keys(r.data||{}).reduce((m,h)=>(i[h]||m.push(r.data[h]),m),[]);return{usedItems:i,unusedItems:p}},[t,r.data]),{page:l,pagination:a}=ce({data:c,defaultPageSize:64});return e.jsxs(e.Fragment,{children:[e.jsx(j.Title,{className:"my-0",level:4,children:"Quartetos Simulator"}),e.jsxs("div",{children:[c.length," Orphans"]}),e.jsx(de,{className:"full-width",pagination:a,children:e.jsx(d,{gap:16,wrap:"wrap",children:l.map(i=>e.jsx(le,{onClick:()=>n(i.id),children:e.jsxs(d,{style:{maxWidth:84},vertical:!0,children:[e.jsx(y,{id:i.id,width:64}),e.jsx(N,{item:i})]},i.id)},i.id))})}),e.jsx(me,{onClose:()=>n(null),open:!!o,placement:"bottom",title:"Item Details",children:o&&e.jsxs(d,{gap:16,children:[e.jsxs(d,{gap:16,vertical:!0,children:[e.jsx(y,{id:o,width:64}),e.jsx(N,{item:r.data[o]})]}),e.jsx(C,{data:t,...s})]})})]})}function Te(){const[t,s]=x.useState({batchSize:1,history:{}}),r=x.useRef(1),{entries:o}=pe(!0,"pt",t.batchSize,t.history);return e.jsxs(d,{className:"p-4",gap:12,vertical:!0,children:[e.jsxs(d,{align:"center",justify:"space-between",children:[e.jsx(j.Title,{className:"my-0",level:4,children:"Quartetos Simulator"}),e.jsxs(d,{gap:6,children:[e.jsx(q,{defaultValue:1,max:100,min:1,onChange:n=>{r.current=n??1}}),e.jsx(w,{onClick:()=>s({batchSize:r.current,history:{}}),type:"primary",children:"Re-run Simulation"})]})]}),e.jsx(Pe,{entries:o})]})}function Pe({entries:t}){const s=he(),r=t[s];return e.jsxs("div",{className:"full-width grid",style:{gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(ue,{collapsed:3,src:t??{},theme:"twilight"}),e.jsx("div",{children:r&&e.jsx(d,{vertical:!0,children:r.sets.map(o=>e.jsx(De,{quartet:o},o.id))})})]})}function De({quartet:t}){return e.jsxs(I,{direction:"vertical",children:[e.jsxs(j.Text,{strong:!0,children:[t.title," [",t.level,"]"]}),e.jsx(d,{gap:8,children:t.itemsIds.map(s=>e.jsx(y,{id:s,width:60},s))})]})}function $t(){const{queryParams:t}=S(),s=t.get("display"),r=xe({tdrResourceName:"daily-quartet-sets",firestoreDataCollectionName:"quartetSets"});return e.jsx(k,{subtitle:"Quartet Sets",title:"Items",children:e.jsxs(T,{hasSider:!0,children:[e.jsx(z,{children:e.jsx(be,{...r})}),e.jsx(T.Content,{className:"content",children:e.jsxs(L,{error:r.error,hasResponseData:!f.isEmpty(r.data),isLoading:r.isLoading,children:[s==="simulator"&&e.jsx(Te,{}),s==="orphans"&&e.jsxs(d,{gap:24,vertical:!0,children:[e.jsx(C,{...r}),e.jsx(Qe,{...r})]}),!s&&e.jsxs(d,{gap:24,vertical:!0,children:[e.jsx(C,{...r}),e.jsx(Ce,{...r})]})]})})]})})}export{$t as ItemsQuartets,$t as default};
