import{u as G,D as Q,a as w}from"./useParsedHistory-CrcJ1DDF.js";import{u as v}from"./useTDResource-CRRJlTEU.js";import{l as u}from"./useBaseUrl-B43mDP-v.js";import{Z as L,$ as M,r as R}from"./index-CanllrSk.js";import{c as j}from"./constants-C9NZ99od.js";const h=new M({}),N=(t,n)=>{h.setState(s=>({...s,[t]:n}))},U=()=>{h.setState(()=>({}))},_=()=>L(h,()=>h.state),q=(t,n,s,a)=>{const[l]=G(Q.QUARTETOS,a),c=v("daily-quartet-sets",t),i=v("items-groups",t);return{entries:R.useMemo(()=>!t||c.isLoading||i.isLoading||!l?{}:k(s,l,n,c.data,i.data),[t,n,l,s,c.dataUpdatedAt,i.dataUpdatedAt]),isLoading:c.isLoading||i.isLoading}},k=(t,n,s,a,l)=>{console.count("Creating Quartetos...");const c=u.shuffle(Object.values(a).filter(m=>m.itemsIds.length>=4&&!n.used.includes(m.id)&&!m.flagged));let i=n.latestDate;const o={},f=x(c,5);return Array.from({length:t}).forEach((m,g)=>{const d=[],I={};for(let e=0;e<3;e++){const r=f[g*3+e];r&&(d.push({id:r.id,title:r.title,itemsIds:u.sampleSize(r.itemsIds,4),level:r.level??1}),r.itemsIds.forEach(b=>{I[b]=!0}))}const S=u.shuffle(Object.values(l)).filter(e=>e.itemsIds.length>=6&&!e.itemsIds.some(r=>I[r]));if(S.length>0){const e=u.sampleSize(S,1)[0];d.push({id:e.id,title:`${u.capitalize(e.name[s])}*`,itemsIds:u.sampleSize(e.itemsIds,4),level:1})}if(d.length<4)throw new Error("Kaboom! Could not get 4 sets");const E=Math.ceil(d.reduce((e,r)=>e+r.level,0)/d.length),y=u.orderBy(d,["level"],["asc"]).map((e,r)=>(e.level=r,e)),A=d.map(e=>e.id).join(j),D=u.shuffle(d.flatMap(e=>e.itemsIds)),p=w(i);i=p,o[p]={id:p,number:n.latestNumber+g+1,setId:A,type:"quartetos",grid:D,difficulty:E,sets:y}}),o},x=(t,n=5)=>{if(t.length<=1)return t;const s=[t[0]],a=t.slice(1);for(;a.length>0;){const l=new Set,c=Math.min(s.length,n);for(let o=1;o<=c;o++)s[s.length-o].itemsIds.forEach(m=>l.add(m));let i=!1;for(let o=0;o<a.length;o++){const f=a[o];if(!f.itemsIds.some(g=>l.has(g))){s.push(f),a.splice(o,1),i=!0;break}}!i&&a.length>0&&(s.push(a[0]),a.splice(0,1))}return s};export{N as a,_ as b,U as c,q as u};
