import{h as D,u as Q,r as g}from"./index-D37itX2d.js";import{l as u}from"./useBaseUrl-BRxm3gcj.js";import{j as $,k as v}from"./index-DyrmBSk6.js";import{u as x}from"./useGetFirestoreDoc-C87ZD_I3.js";import{u as L}from"./useTDResource-CagVVubj.js";import{u as M}from"./useUpdateFirestoreDoc-eF0U8SW6.js";function k({tdrResourceName:o,firestoreDataCollectionName:e,serialize:c}){const{notification:n}=D.useApp(),m=Q(),r=L(o),s=x("tdr",e,{select:c?$:void 0}),[t,d]=g.useState({}),i=M("tdr",e,{onSuccess:()=>{n.success({message:`${e} updated`}),m.refetchQueries({queryKey:["firestore","tdr",e]}),d({})},onError:a=>{n.error({message:`${e} update failed`,description:a.message})}}),f=g.useMemo(()=>!r.isSuccess||!s.isSuccess||i.isPending?{}:(console.log(`%cMerging ${o}+${e} data...`,"color: #f0f"),u.cloneDeep({...r.data??{},...s.data??{},...t})),[o,e,r.data,s.data,r.isSuccess,s.isSuccess,i.isPending,t]),y=!u.isEmpty(t),S=(a,F)=>{d(h=>({...h,[a]:F}))},p=s.data,E=()=>{i.mutate(c?v(t):t)};return{data:f,isLoading:r.isLoading||s.isLoading,isSuccess:r.isSuccess&&s.isSuccess,error:r.error||s.error,firestoreData:p,hasFirestoreData:!u.isEmpty(p),isSaving:i.isPending,save:E,addEntryToUpdate:S,entriesToUpdate:t,isDirty:y}}export{k as u};
