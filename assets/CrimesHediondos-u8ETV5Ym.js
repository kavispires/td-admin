import{r as b,a as M,j as e,ae as B,T as S,B as R,aj as U,D as W,P as A,L as F}from"./index-YrxXJCRo.js";import{u as E}from"./useQueryParams-Bdhq2aAO.js";import{u as H,c as C,P as K}from"./useBaseUrl-C6NB5AVO.js";import{D as k}from"./EditableFields-3ecQz5Bp.js";import{C as w}from"./CopyToClipboardButton-B0w94BJq.js";import{u as z}from"./useCopyToClipboardFunction-DLn4amDY.js";import{u as $}from"./useTableExpandableRows-CZFDR8Km.js";import{u as _}from"./useTablePagination-FdmIcu2U.js";import{l as x}from"./lodash-DHSXaBCI.js";import{I as V}from"./Item-DhRhcEKB.js";import{T as q}from"./index-DaDAmdSV.js";import{F as O}from"./Table-e_j_niQa.js";import{F as h}from"./index-CGTHWfcT.js";import{I as G}from"./index-C7MVWxrt.js";import{S as T}from"./index-CTPuhsUj.js";import{T as X}from"./index-X64WGjtd.js";import{F as Y,c as Z}from"./FilterEntries-SHPIZRcQ.js";import{S as Q}from"./SiderContent-Cw0bn2HP.js";import{D as g}from"./DownloadButton-COz1tbcl.js";import{S as v}from"./SaveButton-8cgWxSCL.js";import{a as J}from"./index-Ie4GiVIN.js";import{R as ee}from"./SkinOutlined-B6RSCMmy.js";import{R as ae}from"./EnvironmentOutlined-Bo9wxJ52.js";import{D as te}from"./DataLoadingWrapper-PpUqHkgV.js";import{u as y}from"./useResourceFirebaseData-1K82SYK-.js";import{u as ie}from"./useTDResource-CDxaXFWP.js";import"./LanguageFlag-DDMdmxf8.js";import"./index-C3pi46bp.js";import"./FireFilled-Cd9Mhj0G.js";import"./IdcardOutlined--kqf3tnX.js";import"./CopyOutlined-DC66PhiR.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-BHZnLOj_.js";import"./index-BlsZn4o0.js";import"./index-C3cyCUJ1.js";import"./index-jo0E7T7E.js";import"./scrollTo-BOLcqtwO.js";import"./Pagination-Bs8rgT4I.js";import"./extendsObject-keMuGWqj.js";import"./Input-C7GOHm5-.js";import"./gapSize-U1swVQyS.js";import"./index-CXekz8d8.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-CCBaQX56.js";import"./constants-OlFzuvYk.js";import"./useGetFirebaseDoc-B2OdLxyM.js";import"./useUpdateFirebaseDoc-BKyxfK8p.js";import"./useMutation-csmyFkac.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"};function I(){return I=Object.assign?Object.assign.bind():function(a){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},I.apply(this,arguments)}const re=(a,i)=>b.createElement(M,I({},a,{ref:i,icon:se})),ne=b.forwardRef(re);function oe({item:a,cardWidth:i,activeColor:s,isSelected:r=!1,className:n=""}){const{getUrl:p}=H("images"),d=`back/crime${x.capitalize(a.type)}`;return a.itemId?e.jsxs("div",{className:C("crime-item-card",`crime-item-card--${a.type}`,r&&"crime-item-card--selected",n),style:{width:i,backgroundImage:`url(${p(`${d}.jpg`)})`,...s&&r?{borderColor:s,backgroundColor:s}:{}},children:[e.jsx(B,{content:e.jsxs(e.Fragment,{children:[a.name.pt," | ",a.name.en]}),children:e.jsx("div",{className:"crime-item-card__name",style:{maxWidth:`${i}px`},children:e.jsx("span",{children:a.name.en})})}),e.jsx("div",{className:C("crime-item-card__item-container",`crime-item-card__item-container--${a.type}`),children:e.jsx(V,{id:a.itemId,width:i*.75,className:"crime-item-card__item"})})]}):e.jsx(e.Fragment,{children:a.id})}function le({rows:a,onUpdateCard:i,weapons:s,evidence:r,locations:n,victims:p,scenes:d}){const{queryParams:m,addParams:o}=E(),t=m.get("type"),l=[{key:"all",label:"All",children:e.jsx(f,{rows:a,onUpdateCard:i,scenes:d})},{key:"weapons",label:"Weapons",children:e.jsx(f,{rows:s,onUpdateCard:i,scenes:d})},{key:"evidence",label:"Evidence",children:e.jsx(f,{rows:r,onUpdateCard:i,scenes:d})},{key:"locations",label:"Locations",children:e.jsx(f,{rows:n,onUpdateCard:i,scenes:d})},{key:"victims",label:"Victims",children:e.jsx(f,{rows:p,onUpdateCard:i,scenes:d})}],c=u=>{o({type:u,page:"1"})};return e.jsx("div",{className:"my-4",children:e.jsx(q,{defaultActiveKey:t||"all",items:l,onChange:c})})}function f({rows:a,onUpdateCard:i,scenes:s}){const r=z(),n=_({total:a.length,showQuickJumper:!0}),p=(t,l,c)=>{const u=x.cloneDeep(c);u.name[l]=t,i(u)},d=[O.EXPAND_COLUMN,{title:"Id",dataIndex:"id",key:"id",render:t=>e.jsxs("span",{children:[t,e.jsx(w,{content:t})]}),sorter:(t,l)=>t.id.localeCompare(l.id)},{title:"Card",dataIndex:"itemId",key:"itemId",render:(t,l)=>e.jsxs(h,{align:"center",gap:8,children:[e.jsx(oe,{item:l,cardWidth:70}),e.jsx("div",{children:e.jsx(G,{defaultValue:l.itemId,size:"small",onBlur:c=>{var u,j,N,L;if(console.log((u=c==null?void 0:c.target)==null?void 0:u.value),console.log("onBlur"),(j=c==null?void 0:c.target)!=null&&j.value&&((N=c==null?void 0:c.target)==null?void 0:N.value)!==l.itemId){const P=x.cloneDeep(l);P.itemId=(L=c==null?void 0:c.target)==null?void 0:L.value,i(P)}}})})]})},{title:"Name",dataIndex:"name",key:"name",sorter:(t,l)=>t.name.en.localeCompare(l.name.en),render:(t,l)=>e.jsxs(T,{direction:"vertical",style:{minWidth:150},children:[e.jsx(k,{value:t,language:"en",onPressEnter:c=>{var u;return p(((u=c.target)==null?void 0:u.value)||l.name.en,"en",l)}}),e.jsx(k,{value:t,language:"pt",onPressEnter:c=>{var u;return p(((u=c.target)==null?void 0:u.value)||l.name.pt,"pt",l)}})]})},{title:"Type",dataIndex:"type",key:"type",render:t=>e.jsx("span",{children:t}),sorter:(t,l)=>t.type.localeCompare(l.type)}],m=$({maxExpandedRows:1,expandedRowRender:t=>e.jsx(de,{card:t,scenes:s})}),o=()=>{if(n){const{current:t=1,pageSize:l=10}=n,c=a.slice((t-1)*l,t*l),u=[];c.forEach((j,N)=>{u.push(`${N+1}) ${j.name.en}}`)}),console.log(u),r(u.join(`
`))}};return e.jsxs("div",{className:"my-4",children:[e.jsxs(T,{className:"mb-4",children:[e.jsxs(S,{children:[a.length," cards total"]}),e.jsx(R,{onClick:o,children:"Copy Page Cards"})]}),e.jsx(O,{columns:d,dataSource:a,rowKey:"id",expandable:m,pagination:n})]})}function de({card:a,scenes:i}){return e.jsxs("div",{children:[e.jsx(S.Title,{level:5,children:"Scene Likelihood"}),e.jsx("div",{className:"likelihood",children:Object.values(i).map(s=>{var t,l,c,u,j;const[r,n]=((t=a.likelihood)==null?void 0:t[s.id])??[],p=r!==void 0,d=(c=(l=s.values)==null?void 0:l[r])==null?void 0:c.en,m=n!==void 0,o=(j=(u=s.values)==null?void 0:u[n])==null?void 0:j.en;return e.jsxs("div",{className:"likelihood-entry",children:[e.jsx("div",{className:"bold",children:s.title.en}),e.jsx("div",{className:C("likely-result",{"likely-result--no-data":!p||!d}),children:d||"No most likely value"}),e.jsx("div",{className:C("likely-result--2",{"likely-result--no-data":!m||!o}),children:o||"No second most likely value"})]},s.id)})})]})}function ce({sceneQuery:a,objects:i}){const s=z(),r=Object.values(a.data??[]),n=_({total:r.length,showQuickJumper:!0}),p=o=>{const t=[];t.push(`"${o.description.en}"`),o.values.forEach((l,c)=>{t.push(`${c}) ${l.en}`)}),s(t.join(`
`))},d=[{title:"Id",dataIndex:"id",key:"id",render:o=>e.jsxs("span",{children:[o,e.jsx(w,{content:o})]}),sorter:(o,t)=>o.id.localeCompare(t.id)},{title:"Title",dataIndex:"title",key:"title",render:(o,t)=>e.jsxs(T,{direction:"vertical",style:{minWidth:150},children:[e.jsx(k,{value:t.title,language:"en",readOnly:!0}),e.jsx(k,{value:t.title,language:"pt",readOnly:!0})]})},{title:"Type",dataIndex:"type",key:"type",render:o=>e.jsx("span",{children:o}),sorter:(o,t)=>o.type.localeCompare(t.type)},O.EXPAND_COLUMN,{title:"Options",dataIndex:"values",key:"tags",render:(o,t)=>e.jsxs(e.Fragment,{children:[e.jsx(R,{onClick:()=>p(t),children:"Copy options"}),e.jsx("ul",{children:o.map(l=>e.jsx("li",{children:e.jsxs(S,{children:[l.en," / ",l.pt]})},l.en))})]})}],m=$({maxExpandedRows:1,expandedRowRender:o=>e.jsx(me,{scene:o,objects:i})});return e.jsxs("div",{className:"my-4",children:[e.jsx(S.Title,{level:2,className:"my-0",children:"Scenes"}),e.jsx(O,{columns:d,dataSource:r,rowKey:"id",expandable:m,pagination:n})]})}function me({scene:a,objects:i}){const s=b.useMemo(()=>{let r=0;const n={};return i.forEach(d=>{var m;if((m=d.likelihood)!=null&&m[a.id]){const t=d.likelihood[a.id][0];n[t]=(n[t]||0)+1,r+=1}}),Object.entries(n).map(([d,m])=>({value:d,percentage:m/r*100}))},[i,a.id]);return e.jsxs("div",{children:[e.jsxs("h3",{children:[a.title.en," / ",a.title.pt]}),e.jsx("ul",{children:s.map(({value:r,percentage:n})=>e.jsxs("li",{children:[e.jsx(X,{children:a.values[Number(r)].en})," ",n.toFixed(2),"%"]},r))})]})}function pe({weaponsQuery:a,evidenceQuery:i,scenesQuery:s,locationsQuery:r,victimsQuery:n}){const{is:p,queryParams:d}=E(),m=b.useMemo(()=>[...Object.values(a.data),...Object.values(i.data),...Object.values(r.data),...Object.values(n.data)],[a.data,i.data,r.data,n.data]),o=t=>{if(t.type==="weapon")a.addEntryToUpdate(t.id,t);else if(t.type==="evidence")i.addEntryToUpdate(t.id,t);else throw new Error("Invalid card type")};return e.jsxs(e.Fragment,{children:[(p("display","cards")||!d.has("display"))&&e.jsx(le,{rows:m,onUpdateCard:o,weapons:Object.values(a.data),evidence:Object.values(i.data),locations:Object.values(r.data),victims:Object.values(n.data),scenes:s.data}),p("display","tags")&&e.jsx(U,{type:"info",message:"Tags table is not implemented yet",showIcon:!0,closable:!0}),p("display","scenes")&&e.jsx(ce,{sceneQuery:s,objects:m})]})}function ue({weaponsQuery:a,evidenceQuery:i,scenesQuery:s,locationsQuery:r,victimsQuery:n}){const{queryParams:p,addParam:d,addParams:m,is:o}=E();return e.jsxs(Q,{children:[e.jsxs(h,{vertical:!0,gap:12,children:[e.jsxs(h,{gap:6,children:[e.jsxs(h,{vertical:!0,gap:6,children:[e.jsx("span",{children:"Weapons"}),e.jsx(v,{isDirty:a.isDirty,onSave:a.save,isSaving:a.isSaving,dirt:JSON.stringify(a.entriesToUpdate),size:"middle"}),e.jsx(g,{data:()=>D(a.data),fileName:"crime-weapons.json",disabled:a.isDirty,hasNewData:a.hasFirestoreData,block:!0,children:"JSON"})]}),e.jsxs(h,{vertical:!0,gap:6,children:[e.jsx("span",{children:"Evidence"}),e.jsx(v,{isDirty:i.isDirty,onSave:i.save,isSaving:i.isSaving,dirt:JSON.stringify(i.entriesToUpdate),size:"middle"}),e.jsx(g,{data:()=>D(i.data),fileName:"crime-evidence.json",disabled:i.isDirty,hasNewData:i.hasFirestoreData,block:!0,children:"JSON"})]})]}),e.jsxs(h,{gap:6,children:[e.jsxs(h,{vertical:!0,gap:6,children:[e.jsx("span",{children:"Locations"}),e.jsx(v,{isDirty:a.isDirty,onSave:a.save,isSaving:a.isSaving,dirt:JSON.stringify(a.entriesToUpdate),size:"middle"}),e.jsx(g,{data:()=>D(r.data),fileName:"crime-locations.json",disabled:a.isDirty,hasNewData:a.hasFirestoreData,block:!0,children:"JSON"})]}),e.jsxs(h,{vertical:!0,gap:6,children:[e.jsx("span",{children:"Victims"}),e.jsx(v,{isDirty:a.isDirty,onSave:a.save,isSaving:a.isSaving,dirt:JSON.stringify(a.entriesToUpdate),size:"middle"}),e.jsx(g,{data:()=>D(n.data),fileName:"crime-victims.json",disabled:a.isDirty,hasNewData:a.hasFirestoreData,children:"JSON"})]})]}),e.jsx("span",{children:"Scenes"}),e.jsx(v,{isDirty:s.isDirty,onSave:s.save,isSaving:s.isSaving,dirt:JSON.stringify(s.entriesToUpdate)}),e.jsx(g,{data:()=>xe(s.data),fileName:"crime-scenes.json",disabled:s.isDirty,hasNewData:s.hasFirestoreData,block:!0})]}),e.jsx(W,{}),e.jsx(Y,{label:"Display",value:p.get("display")??"listing",onChange:t=>m({display:t,page:1},{page:1}),options:[{title:"Cards",icon:e.jsx(ee,{}),value:"cards"},{title:"Tags",icon:e.jsx(ne,{}),value:"tags"},{title:"Scenes",icon:e.jsx(ae,{}),value:"scenes"}]}),o("display","item")&&e.jsx(Z,{label:"No Groups Only",value:o("emptyOnly"),onChange:t=>d("emptyOnly",t,!1)})]})}function D(a){console.log("Preparing file for download...");const i=x.cloneDeep(a);return Object.values(i).forEach(s=>{s.likelihood||(s.likelihood={})}),J(i)}function xe(a){console.log("Preparing scenes file for download...");const i=x.cloneDeep(a);return J(i)}function da(){const a=y({tdrResourceName:"crime-weapons",firebaseDataCollectionName:"crimeWeapons",serialize:!0}),i=y({tdrResourceName:"crime-evidence",firebaseDataCollectionName:"crimeEvidence",serialize:!0}),s=y({tdrResourceName:"crime-locations",firebaseDataCollectionName:"crimeLocations",serialize:!0}),r=y({tdrResourceName:"crime-victims",firebaseDataCollectionName:"crimeVictims",serialize:!0}),n=y({tdrResourceName:"crime-scenes",firebaseDataCollectionName:"crimeScenes",serialize:!0}),p=ie("items");return b.useEffect(()=>{const d=Object.values(n.data).map(m=>({id:m.id,title:m.title.en,description:m.description.en,values:m.values.map(o=>o.en)}));x.isEmpty(d)||console.log("Slim Scenes for GPT:",d)},[n.data]),e.jsx(A,{title:"Crimes Hediondos",subtitle:"Categorizer",children:e.jsxs(F,{hasSider:!0,children:[e.jsx(K,{children:e.jsx(ue,{weaponsQuery:a,evidenceQuery:i,scenesQuery:n,locationsQuery:s,victimsQuery:r})}),e.jsx(F.Content,{className:"content",children:e.jsx(te,{isLoading:a.isLoading||i.isLoading||n.isLoading||s.isLoading||r.isLoading||p.isLoading,error:a.error||i.error||n.error||p.error||s.error||r.error,hasResponseData:!x.isEmpty(a.data)&&!x.isEmpty(i.data)&&!x.isEmpty(n.data)&&!x.isEmpty(s.data)&&!x.isEmpty(r.data)&&!x.isEmpty(p.data),children:e.jsx(pe,{weaponsQuery:a,evidenceQuery:i,scenesQuery:n,locationsQuery:s,victimsQuery:r})})})]})})}export{da as default};
