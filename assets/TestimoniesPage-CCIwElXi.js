import{aA as xe,r as g,d as B,_ as z,j as e,F as v,T as k,B as S,A as G,h as ge,a4 as F,D as W,b as U,aB as ie,R as ye,a2 as oe,aC as we,P as be,L as J}from"./index-D-60WIp5.js";import{D as ve}from"./DataLoadingWrapper-DgRadhOw.js";import{l as O,c as ce,P as Se}from"./useBaseUrl-BN9cOw-T.js";import{u as R}from"./useQueryParams-fOvBTbO0.js";import{R as Ce}from"./main-LERpApj4.js";import{u as ke,b as ae,c as Oe,n as Te,e as Ie}from"./useTestimoniesResource-DQx_XhX0.js";import{g as Re}from"./useParsedHistory-FGxYETbN.js";import{S as L}from"./SuspectImageCard-BoiU2JOv.js";import{u as De}from"./useTDResource-CNitcFAv.js";import{T as le,S as Me,F as Ne}from"./FilterEntries-DoKmEsYC.js";import{B as q,D as ue}from"./DownloadButton-Wmg55xu_.js";import{S as E}from"./index-BpwuExKZ.js";import{u as de}from"./useTableExpandableRows-BVjVSjGG.js";import{u as he}from"./useTablePagination-CSSSzpop.js";import{P as X}from"./progress-BakpIMgT.js";import{S as M}from"./index-0iBCdNy5.js";import{F as Y}from"./Table-C7q24B2N.js";import{u as Pe}from"./useCardWidth-Bd_hi6dp.js";import{C as me}from"./index-BqOdDXEe.js";import{P as Z}from"./index-DHPheOWX.js";import{S as V}from"./SiderContent-CQbL2Ewc.js";import{F as Ee,a as Ae}from"./FirestoreConsoleLink-lJ8C9zT-.js";import{S as Fe}from"./SaveButton-CozKx99m.js";import{S as Be}from"./SuspectsStyleVariantSelector-B3tDe_B5.js";import{g as ze}from"./useGetFirestoreDoc-cn81L98J.js";import{j as Le,a as $e,i as Ve}from"./index-Dpy1R-z5.js";import{u as pe}from"./useWindowSize-e0nLNmld.js";import{R as qe}from"./TableOutlined--qM-xg5_.js";import{R as He}from"./RobotOutlined-CQ_CyV8s.js";import"./useResourceFirestoreData-CWHN77cH.js";import"./useUpdateFirestoreDoc-lCGyoWqS.js";import"./useMutation-Blw5x71x.js";import"./moment-C5S46NFB.js";import"./ImageCard-BFFVwWJJ.js";import"./index-qMQxFsmF.js";import"./index-CA2LrZhN.js";import"./index-9g_bi3sM.js";import"./scrollTo-BYEA0zeB.js";import"./Pagination-Dbb-UKtW.js";import"./SaveOutlined-gqtVKcAX.js";import"./constants-DELKGLpC.js";import"./Item-DlFc8MNF.js";function Ue(t,n){return typeof t=="function"?t.length?t(n):t():t}function fe(t,n,a){if(n===void 0&&(n=10),n<1)throw new Error("Capacity has to be greater than 1, got '"+n+"'");var l=xe(),m=g.useState(t),j=m[0],h=m[1],i=g.useRef([]),c=g.useRef(0);l&&(i.current.length?(i.current[i.current.length-1]!==t&&i.current.push(t),i.current.length>n&&(i.current=i.current.slice(i.current.length-n))):i.current.push(t),c.current=i.current.length&&i.current.length-1);var x=g.useCallback(function(o){h(function(p){return o=Ue(o,p),o!==p&&(c.current<i.current.length-1&&(i.current=i.current.slice(0,c.current+1)),c.current=i.current.push(o)-1,i.current.length>n&&(i.current=i.current.slice(i.current.length-n))),o})},[j,n]),d=g.useMemo(function(){return{history:i.current,position:c.current,capacity:n,back:function(o){o===void 0&&(o=1),c.current&&h(function(){return c.current-=Math.min(o,c.current),i.current[c.current]})},forward:function(o){o===void 0&&(o=1),c.current!==i.current.length-1&&h(function(){return c.current=Math.min(c.current+o,i.current.length-1),i.current[c.current]})},go:function(o){o!==c.current&&h(function(){return c.current=o<0?Math.max(i.current.length+o,0):Math.min(i.current.length-1,o),i.current[c.current]})}}},[j]);return[j,x,d]}var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zM464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z"}}]},name:"appstore",theme:"filled"},We=function(n,a){return g.createElement(B,z({},n,{ref:a,icon:Qe}))},Ye=g.forwardRef(We),_e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm330-170c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1z"}}]},name:"audio",theme:"filled"},Ke=function(n,a){return g.createElement(B,z({},n,{ref:a,icon:_e}))},Ge=g.forwardRef(Ke),Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M594.3 601.5a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1 8 8 0 008 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"}}]},name:"contacts",theme:"outlined"},Xe=function(n,a){return g.createElement(B,z({},n,{ref:a,icon:Je}))},Ze=g.forwardRef(Xe),et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M870 126H663.8c-17.4 0-32.9 11.9-37 29.3C614.3 208.1 567 246 512 246s-102.3-37.9-114.8-90.7a37.93 37.93 0 00-37-29.3H154a44 44 0 00-44 44v252a44 44 0 0044 44h75v388a44 44 0 0044 44h478a44 44 0 0044-44V466h75a44 44 0 0044-44V170a44 44 0 00-44-44z"}}]},name:"skin",theme:"filled"},tt=function(n,a){return g.createElement(B,z({},n,{ref:a,icon:et}))},st=g.forwardRef(tt),nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.6 630.2 359 721.8 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.8 758.4 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM248 439.6c-37.1-11.9-64-46.7-64-87.6V232h64v207.6zM840 352c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"filled"},rt=function(n,a){return g.createElement(B,z({},n,{ref:a,icon:nt}))},ee=g.forwardRef(rt);function it(){const[t,n]=g.useState({batchSize:1,history:{}}),a=g.useRef(1),{entries:l}=ke(!0,"pt",t.batchSize,t.history),m=De("suspects",!O.isEmpty(l));return console.log(ct(l,m.data??{})),e.jsxs(v,{className:"p-4",gap:12,vertical:!0,children:[e.jsxs(v,{align:"center",justify:"space-between",children:[e.jsx(k.Title,{className:"my-0",level:4,children:"Espionagem Simulator"}),e.jsxs(v,{gap:6,children:[e.jsx(le,{defaultValue:1,max:100,min:1,onChange:j=>{a.current=j??1}}),e.jsx(S,{onClick:()=>n({batchSize:a.current,history:{}}),type:"primary",children:"Re-run Simulation"})]})]}),e.jsx(ot,{entries:l})]})}function ot({entries:t}){const[n,a]=g.useState(!1),l=Re(),m=t[l],j=g.useMemo(()=>m?m.statements.reduce((h,i)=>{const{excludes:c}=i;return c.forEach(x=>{h[x]?h[x]++:h[x]=1}),h},{}):{},[m]);return e.jsxs("div",{className:"full-width grid",style:{gridTemplateColumns:"2fr 3fr"},children:[e.jsx(Ce,{collapsed:3,src:t??{},theme:"twilight"}),e.jsx("div",{children:m&&e.jsxs(v,{className:"p-4",gap:18,children:[e.jsx("div",{children:e.jsx("div",{style:{width:`${105*4}px`,display:"grid",gap:"6px",gridTemplateColumns:"repeat(4, 1fr)"},children:m.suspects.map(h=>e.jsxs(q.Ribbon,{color:"cyan",text:n?j[h.id]:null,children:[e.jsx(L,{cardId:h.id,cardWidth:96,className:ce(n&&h.id===m.culpritId&&"red-border")},h.id),e.jsxs(v,{align:"center",gap:6,children:[e.jsx(E,{checkedChildren:"ðŸš«",size:"small"})," ",h.id]})]},h.id))})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(E,{checked:n,checkedChildren:"Show Culprit",onChange:a,unCheckedChildren:"Hide Culprit"})}),m.statements.map(h=>e.jsx(k.Paragraph,{children:e.jsx(q,{color:"cyan",count:h.excludes.length,children:e.jsx(G,{banner:!0,icon:te(h.type),message:h.text,type:"info"},h.key)})},h.key)),m.additionalStatements.map(h=>e.jsx(k.Paragraph,{children:e.jsx(q,{color:"cyan",count:h.excludes.length,children:e.jsx(G,{banner:!0,icon:te(h.type),message:h.text,type:"warning"},h.key)})},h.key))]})]})})]})}const te=t=>{switch(t){case"testimony":return e.jsx(Ge,{});case"feature":return e.jsx(st,{});case"grid":return e.jsx(Ye,{});default:return"â“"}},ct=(t,n)=>{const a=Object.values(t).reduce((l,m)=>(m.suspects.forEach(j=>{l[j.id]=(l[j.id]||0)+1,j.id===m.culpritId&&(l[`${j.id}_culprit`]=(l[`${j.id}_culprit`]||0)+1)}),l),{});return Object.values(n).forEach(l=>{a[l.id]||(a[l.id]=0),a[`${l.id}_culprit`]||(a[`${l.id}_culprit`]=0)}),a};function je({suspect:t,values:n,resolution:a,projection:l,yesPercentage:m,noPercentage:j,complete:h,enoughData:i,testimonyId:c,addEntryToUpdate:x,answers:d,barWidth:o,showName:p}){const r=(u,f)=>{const w={...d};w[u]=[...w[u]||[],f],x(c,w)},s=(u,f)=>{const w={...d},y=w[u]?.findIndex(b=>b===f);y!==-1&&y!==void 0&&(w[u]=[...w[u].slice(0,y),...w[u].slice(y+1)]),x(c,w)};return e.jsxs(ge,{content:e.jsxs(v,{align:"center",vertical:!0,children:[e.jsx(k.Text,{type:"secondary",children:n.join(", ")}),e.jsxs(M.Compact,{children:[e.jsx(S,{block:!0,icon:"ðŸ‘",onClick:()=>r(t.id,4),children:"Fit"}),e.jsx(S,{icon:"âŒ",onClick:()=>s(t.id,4)}),e.jsx(S,{block:!0,icon:"ðŸ‘Ž",onClick:()=>r(t.id,-4),children:"Unfit"}),e.jsx(S,{icon:"âŒ",onClick:()=>s(t.id,-4)})]}),e.jsx(W,{className:"my-1"}),e.jsxs(M.Compact,{children:[e.jsx(S,{block:!0,icon:"â¬†ï¸",onClick:()=>r(t.id,32),children:"Sure"}),e.jsx(S,{icon:"âœ–ï¸",onClick:()=>s(t.id,32)}),e.jsx(S,{block:!0,icon:"â¬‡ï¸",onClick:()=>r(t.id,-32),children:"Sure"}),e.jsx(S,{icon:"âœ–ï¸",onClick:()=>s(t.id,-32)})]})]}),title:`Add strong fit/unfit answer to ${t.name.pt}`,trigger:"click",children:[p&&e.jsxs("div",{children:[e.jsx(F,{title:t.id,children:t.name.pt})," ",h&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(ee,{style:{color:"gold"}})})]}),e.jsxs(v,{align:"flex-start",gap:12,children:[e.jsx(F,{title:`Values: ${n.join(", ")} : ${a||(l?`${l}*`:"")}`,children:i?e.jsx(X,{percent:j+m,showInfo:!1,size:[o,20],status:"exception",success:{percent:m}}):e.jsx(X,{percent:j+m,showInfo:!1,size:[o,10],status:"exception",success:{percent:m}})}),!p&&h&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(ee,{style:{color:"gold"}})})]})]})}function at({suspect:t,answersPerQuestion:n={},questions:a,addEntryToUpdate:l,allAnswers:m}){const{queryParams:j}=R({sortSuspectsBy:"answers"}),h=j.get("sortSuspectsBy")??"answers",[i,c]=g.useState(""),x=g.useMemo(()=>{const r=Object.values(a).map(s=>{const u=n[s.id]??{},{enoughData:f,reliable:w,yesPercentage:y,noPercentage:b,blankPercentage:C,values:T,total:D,resolution:N,projection:H,complete:A}=ae(t.id,{[t.id]:u});return{id:s.id,question:s,enoughData:f,reliable:w,yesPercentage:y,noPercentage:b,blankPercentage:C,values:T,total:D,resolution:N,projection:H,complete:A}});return h==="answers"?O.orderBy(r,["reliable","enoughData","yesPercentage",s=>s.values.length],["desc","desc","desc","desc"]):O.orderBy(r,s=>Number(s.id.split("-")[1]),["asc"])},[n,a,t.id,h]),d=g.useMemo(()=>lt(t,x),[t,x]),o=[{key:"id",title:"Id",dataIndex:"id",width:"7%"},{key:"question",title:"Question",dataIndex:"question",render:r=>r.question},{key:"answer",title:"Answer",dataIndex:"id",width:"170px",sorter:(r,s)=>r.total-s.total,render:r=>{const s=x.find(u=>u.id===r);return s?e.jsx(v,{gap:8,wrap:"nowrap",children:e.jsx(je,{addEntryToUpdate:l,answers:m[s.question.id]||{},barWidth:120,complete:s.complete,enoughData:s.enoughData,noPercentage:s.noPercentage,projection:s.projection,resolution:s.resolution,suspect:t,testimonyId:s.question.id,values:s.values,yesPercentage:s.yesPercentage})}):""}},{key:"actions",title:"Actions",dataIndex:"id",width:"auto",render:r=>{const s=x.find(u=>u.id===r);return s?e.jsx(ut,{addEntryToUpdate:l,answers:m[s.question.id]||{},suspect:t,testimonyId:s.question.id}):""}}],p=g.useMemo(()=>i.trim()?x.filter(r=>r.question.question.toLowerCase().includes(i.toLowerCase())||r.id.toLowerCase().includes(i.toLowerCase())):x,[x,i]);return e.jsxs(M,{size:"large",wrap:!0,children:[e.jsxs(v,{className:"full-width",gap:16,vertical:!0,children:[e.jsx(U,{allowClear:!0,onChange:r=>c(r.target.value),placeholder:"Search questions...",prefix:e.jsx(ie,{}),style:{marginBottom:16,width:320},value:i}),e.jsx(Y,{bordered:!0,className:"full-width",columns:o,dataSource:p,rowKey:"id",tableLayout:"fixed"})]}),e.jsxs(v,{gap:8,vertical:!0,children:[e.jsx(k.Title,{level:5,children:"Suspect Description"}),e.jsx(U.TextArea,{className:"full-width",readOnly:!0,rows:7,value:d})]})]})}const lt=(t,n)=>{const a=n.filter(l=>l.resolution||l.projection).map(l=>{const{question:m,resolution:j,projection:h}=l,i=j||h;return`${t.gender==="male"?"ele":"ela"} ${i==="ðŸ‘"?"":"nÃ£o "}${m.answer.toLocaleLowerCase()}`});return`${t.name.pt}: ${a.join(", ")}`};function ut({suspect:t,testimonyId:n,addEntryToUpdate:a,answers:l}){const m=(i,c)=>{const x={...l};x[i]=[...x[i]||[],c],a(n,x)},j=(i,c)=>{const x={...l},d=x[i]?.findIndex(o=>o===c);d!==-1&&d!==void 0&&(x[i]=[...x[i].slice(0,d),...x[i].slice(d+1)]),a(n,x)},h=g.useMemo(()=>Object.values(l[t.id]||{}).reduce((i,c)=>i+Math.abs(c===0?-1:c),0),[l,t.id]);return console.log(l[t.id]),e.jsxs(v,{align:"center",gap:6,wrap:"nowrap",children:[e.jsx(q,{color:h>20?"gold":"grey",count:h,showZero:!0,style:{minWidth:32}}),e.jsxs(M.Compact,{children:[e.jsx(S,{block:!0,icon:"ðŸ‘",onClick:()=>m(t.id,4),children:"FIT"}),e.jsx(S,{icon:"âŒ",onClick:()=>j(t.id,4)}),e.jsx(S,{block:!0,icon:"ðŸ‘Ž",onClick:()=>m(t.id,-4),children:"UNFIT"}),e.jsx(S,{icon:"âŒ",onClick:()=>j(t.id,-4)}),e.jsx(S,{block:!0,icon:"â¬†ï¸",onClick:()=>m(t.id,32),children:"Sure"}),e.jsx(S,{icon:"âœ–ï¸",onClick:()=>j(t.id,32)}),e.jsx(S,{block:!0,icon:"â¬‡ï¸",onClick:()=>m(t.id,-32),children:"Sure"}),e.jsx(S,{icon:"âœ–ï¸",onClick:()=>j(t.id,-32)})]})]})}function dt({isLoading:t,isSuccess:n,questions:a,data:l,suspects:m,addEntryToUpdate:j}){const{queryParams:h,addParam:i}=R(),c=Object.values(a).map(({id:s,question:u})=>({id:s,question:u})),x=g.useMemo(()=>Object.keys(l).reduce((s,u)=>{const f=l[u]??{};return Object.keys(f).forEach(w=>{s[w]||(s[w]={}),s[w][u]=f[w]}),s},{}),[l]),d=g.useMemo(()=>O.orderBy(Object.values(m).map(s=>({...s,answers:x[s.id]})),s=>Number(s.id.split("-")[1]),"asc"),[m,x]),o=he({total:d.length,showQuickJumper:!0}),p=[{title:"Id",dataIndex:"id",key:"id",sorter:(s,u)=>Number(s.id.split("-")[1])-Number(u.id.split("-")[1])},{title:"Picture",dataIndex:"id",render:s=>e.jsx(L,{cardId:s,cardWidth:48})},{title:"Name",dataIndex:"name",key:"name",sorter:(s,u)=>s.name.pt.localeCompare(u.name.pt),render:(s,u)=>e.jsxs(v,{vertical:!0,children:[e.jsx(k.Text,{children:s.pt}),e.jsx(k.Text,{type:"secondary",children:s.en}),e.jsx(k.Text,{italic:!0,type:"secondary",children:e.jsx("small",{children:u.persona.en})})]})},{title:"Questions Answered",dataIndex:"answers",key:"answers",sorter:(s,u)=>Object.keys(s.answers??{}).length-Object.keys(u.answers??{}).length,render:s=>s?Object.values(s).length:""}],r=de({maxExpandedRows:1,expandedRowRender:s=>e.jsx(at,{addEntryToUpdate:j,allAnswers:l,answersPerQuestion:s.answers,questions:a,suspect:s}),rowExpandable:()=>n});return e.jsxs(v,{className:"full-width py-4",gap:12,vertical:!0,children:[e.jsxs(v,{align:"center",justify:"space-between",children:[e.jsx(k.Title,{className:"my-0",level:4,children:"Testimonies by Suspect"}),e.jsx(ue,{data:c,fileName:"newQuestions.json"}),e.jsx(E,{checked:h.get("sortSuspectsBy")==="answers",checkedChildren:"Sort by Answers",onChange:s=>i("sortSuspectsBy",s?"answers":"id"),unCheckedChildren:"Sort by Id"})]}),e.jsx(Y,{bordered:!0,className:"full-width",columns:p,dataSource:d,expandable:r,loading:t,pagination:o,rowKey:"id"})]})}function ht({answers:t,suspects:n,addEntryToUpdate:a,testimonyId:l}){const[m,j]=Pe(12),{queryParams:h,is:i}=R({sortSuspectsBy:"answers"}),c=i("enableBatch"),x=h.get("sortSuspectsBy")??"answers",d=g.useMemo(()=>{const r=Object.keys(n).map(s=>ae(s,t));return x==="answers"?O.orderBy(r,["reliable","enoughData",s=>s.values.length,"yesPercentage","noPercentage",s=>Number(s.suspectCardId.split("-")[1])],["desc","desc","desc","desc","desc","asc"]):O.orderBy(r,s=>Number(s.suspectCardId.split("-")[1]),["asc"])},[t,n,x]),[o,p]=g.useState([]);return e.jsxs(M,{direction:"vertical",children:[e.jsx(mt,{addEntryToUpdate:a,answers:t,list:d,selection:o,setSelection:p,suspects:n,testimonyId:l}),e.jsx(M,{ref:j,size:"large",wrap:!0,children:d.map(r=>e.jsxs(v,{className:ce({"selection-outline":c&&o.includes(r.suspectCardId)}),gap:6,vertical:!0,children:[e.jsx(L,{cardId:r.imageId,cardWidth:m,className:r.values.length>1||r.enoughData?void 0:"grayscale"}),e.jsxs(v,{gap:4,children:[c&&e.jsx(me,{checked:o.includes(r.suspectCardId),disabled:r.complete,onChange:s=>{const u=s.target.checked;p(f=>u?[...f,r.suspectCardId]:f.filter(w=>w!==r.suspectCardId))}}),e.jsx(je,{addEntryToUpdate:a,answers:t,barWidth:m,complete:r.complete,enoughData:r.enoughData,noPercentage:r.noPercentage,projection:r.projection,resolution:r.resolution,showName:!0,suspect:n[r.suspectCardId],testimonyId:l,values:r.values,yesPercentage:r.yesPercentage})]})]},r.suspectCardId))})]})}function mt({testimonyId:t,selection:n,setSelection:a,suspects:l,addEntryToUpdate:m,list:j,answers:h}){const[i,c]=g.useState([]),{addParam:x,removeParam:d,is:o}=R({sortSuspectsBy:"answers"}),p=o("enableBatch"),r=f=>{c(w=>w.includes(f)?w.filter(y=>y!==f):[...w,f])},s=g.useMemo(()=>O.keyBy(j,"suspectCardId"),[j]);g.useEffect(()=>{if(i.length===0&&n.length>0){a([]);return}if(!i.length)return;const w=(n.length>0?n:Object.values(s).filter(y=>!y.complete&&!y.values.includes(4)&&!y.values.includes(-4)).map(y=>y.suspectCardId)).filter(y=>{const b=l[y],C=[b.gender,b.ethnicity,b.build,b.height];return b.age==="18-21"&&C.push("young"),(b.age==="21-30"||b.age==="30-40")&&C.push("adult"),b.age==="40-50"&&C.push("parent"),(b.age==="50-60"||b.age==="60-70"||b.age==="70-80"||b.age==="80-90")&&C.push("senior"),i.every(T=>C.includes(T))});a(w)},[i]);const u=f=>{const w=O.cloneDeep(h);n.forEach(y=>{w[y]=[...w[y]||[],f]}),m(t,w),c([])};return e.jsxs(v,{align:"center",className:"mb-4",gap:6,justify:"space-between",children:[e.jsxs(v,{gap:3,children:[e.jsx(k.Text,{className:"nowrap",style:{minWidth:"5ch"},children:"Batch"}),e.jsx(E,{checkedChildren:"On",onChange:f=>{f?x("enableBatch",!0):d("enableBatch")},unCheckedChildren:"Off",value:p})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs(k.Text,{className:"nowrap mr-2",children:["Selected ",n.length]}),e.jsxs(v,{align:"center",gap:6,justify:"center",wrap:!0,children:[e.jsx(I,{activeFilters:i,filter:"male",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"female",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"young",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"adult",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"parent",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"senior",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"thin",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"muscular",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"large",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"asian",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"black",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"caucasian",updateActiveFilter:r}),e.jsx(I,{activeFilters:i,filter:"latino",updateActiveFilter:r})]}),e.jsxs(v,{align:"center",gap:6,children:[e.jsx(S,{danger:!0,onClick:()=>c([]),size:"small",children:"Clear"}),e.jsx(Z,{onConfirm:()=>u(4),title:"Apply +4 to selected suspects?",children:e.jsx(S,{className:"ml-10",disabled:n.length===0,size:"small",type:"primary",children:"Apply +4"})}),e.jsx(W,{type:"vertical"}),e.jsx(Z,{onConfirm:()=>u(-4),title:"Apply -4 to selected suspects?",children:e.jsx(S,{disabled:n.length===0,size:"small",type:"primary",children:"Apply -4"})})]})]})]})}function I({filter:t,activeFilters:n,updateActiveFilter:a}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[e.jsx(me,{checked:n.includes(t),onClick:()=>a(t)})," ",O.capitalize(t)]}),e.jsx(W,{type:"vertical"})]})}function pt({data:t,questions:n,suspects:a,isLoading:l,isSuccess:m,addEntryToUpdate:j}){const{queryParams:h,addParam:i}=R(),[c,x]=g.useState(""),d=g.useMemo(()=>O.orderBy(Object.values(n).map(u=>({...u,answersCount:Object.values(t[u.id]??{}).length})),u=>Number(u.id.split("-")[1]),"asc"),[n]),o=g.useMemo(()=>c.trim()?d.filter(u=>u.question.toLowerCase().includes(c.toLowerCase())||u.id.toLowerCase().includes(c.toLowerCase())):d,[d,c]),p=he({total:o.length,showQuickJumper:!0}),r=[{title:"Id",dataIndex:"id",key:"id",sorter:(u,f)=>Number(u.id.split("-")[1])-Number(f.id.split("-")[1])},{title:"Question",dataIndex:"question",key:"question",sorter:(u,f)=>u.question.localeCompare(f.question)},{title:"NSFW",dataIndex:"nsfw",key:"nsfw",render:u=>u?e.jsx(ye,{style:{color:"hotPink"}}):"",sorter:(u,f)=>Number(u.nsfw)-Number(f.nsfw)},{title:"Answers",dataIndex:"answersCount",key:"answersCount",sorter:(u,f)=>u.answersCount-f.answersCount}],s=de({maxExpandedRows:1,expandedRowRender:u=>e.jsx(ht,{addEntryToUpdate:j,answers:t[u.id]??{},suspects:a,testimonyId:u.id}),rowExpandable:()=>m});return e.jsxs(v,{className:"full-width py-4",gap:12,vertical:!0,children:[e.jsxs(v,{align:"center",justify:"space-between",children:[e.jsx(k.Title,{className:"my-0",level:4,children:"Suspects by Testimony"}),e.jsx(E,{checked:h.get("sortSuspectsBy")==="answers",checkedChildren:"Sort by Answers",onChange:u=>i("sortSuspectsBy",u?"answers":"id"),unCheckedChildren:"Sort by Id"})]}),e.jsx(U,{allowClear:!0,onChange:u=>x(u.target.value),placeholder:"Search questions by text or ID...",prefix:e.jsx(ie,{}),style:{width:320},value:c}),e.jsx(Y,{bordered:!0,className:"full-width",columns:r,dataSource:o,expandable:s,loading:l,pagination:p,rowKey:"id"})]})}function ft(t){const{queryParams:n,is:a}=R();return e.jsxs(e.Fragment,{children:[(a("display","questions")||!n.get("display"))&&e.jsx(pt,{...t}),a("display","suspects")&&e.jsx(dt,{...t}),a("display","simulator")&&e.jsx(it,{})]})}const jt="Left",xt="Right",gt="Up",yt="Down",P={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},Q={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},se="mousemove",ne="mouseup",wt="touchend",bt="touchmove",vt="touchstart";function St(t,n,a,l){return t>n?a>0?xt:jt:l>0?yt:gt}function re(t,n){if(n===0)return t;const a=Math.PI/180*n,l=t[0]*Math.cos(a)+t[1]*Math.sin(a),m=t[1]*Math.cos(a)-t[0]*Math.sin(a);return[l,m]}function Ct(t,n){const a=d=>{const o="touches"in d;o&&d.touches.length>1||t((p,r)=>{r.trackMouse&&!o&&(document.addEventListener(se,l),document.addEventListener(ne,h));const{clientX:s,clientY:u}=o?d.touches[0]:d,f=re([s,u],r.rotationAngle);return r.onTouchStartOrOnMouseDown&&r.onTouchStartOrOnMouseDown({event:d}),Object.assign(Object.assign(Object.assign({},p),Q),{initial:f.slice(),xy:f,start:d.timeStamp||0})})},l=d=>{t((o,p)=>{const r="touches"in d;if(r&&d.touches.length>1)return o;if(d.timeStamp-o.start>p.swipeDuration)return o.swiping?Object.assign(Object.assign({},o),{swiping:!1}):o;const{clientX:s,clientY:u}=r?d.touches[0]:d,[f,w]=re([s,u],p.rotationAngle),y=f-o.xy[0],b=w-o.xy[1],C=Math.abs(y),T=Math.abs(b),D=(d.timeStamp||0)-o.start,N=Math.sqrt(C*C+T*T)/(D||1),H=[y/(D||1),b/(D||1)],A=St(C,T,y,b),_=typeof p.delta=="number"?p.delta:p.delta[A.toLowerCase()]||P.delta;if(C<_&&T<_&&!o.swiping)return o;const $={absX:C,absY:T,deltaX:y,deltaY:b,dir:A,event:d,first:o.first,initial:o.initial,velocity:N,vxvy:H};$.first&&p.onSwipeStart&&p.onSwipeStart($),p.onSwiping&&p.onSwiping($);let K=!1;return(p.onSwiping||p.onSwiped||p[`onSwiped${A}`])&&(K=!0),K&&p.preventScrollOnSwipe&&p.trackTouch&&d.cancelable&&d.preventDefault(),Object.assign(Object.assign({},o),{first:!1,eventData:$,swiping:!0})})},m=d=>{t((o,p)=>{let r;if(o.swiping&&o.eventData){if(d.timeStamp-o.start<p.swipeDuration){r=Object.assign(Object.assign({},o.eventData),{event:d}),p.onSwiped&&p.onSwiped(r);const s=p[`onSwiped${r.dir}`];s&&s(r)}}else p.onTap&&p.onTap({event:d});return p.onTouchEndOrOnMouseUp&&p.onTouchEndOrOnMouseUp({event:d}),Object.assign(Object.assign(Object.assign({},o),Q),{eventData:r})})},j=()=>{document.removeEventListener(se,l),document.removeEventListener(ne,h)},h=d=>{j(),m(d)},i=(d,o)=>{let p=()=>{};if(d&&d.addEventListener){const r=Object.assign(Object.assign({},P.touchEventOptions),o.touchEventOptions),s=[[vt,a,r],[bt,l,Object.assign(Object.assign({},r),o.preventScrollOnSwipe?{passive:!1}:{})],[wt,m,r]];s.forEach(([u,f,w])=>d.addEventListener(u,f,w)),p=()=>s.forEach(([u,f])=>d.removeEventListener(u,f))}return p},x={ref:d=>{d!==null&&t((o,p)=>{if(o.el===d)return o;const r={};return o.el&&o.el!==d&&o.cleanUpTouch&&(o.cleanUpTouch(),r.cleanUpTouch=void 0),p.trackTouch&&d&&(r.cleanUpTouch=i(d,p)),Object.assign(Object.assign(Object.assign({},o),{el:d}),r)})}};return n.trackMouse&&(x.onMouseDown=a),[x,i]}function kt(t,n,a,l){return!n.trackTouch||!t.el?(t.cleanUpTouch&&t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:void 0})):t.cleanUpTouch?n.preventScrollOnSwipe!==a.preventScrollOnSwipe||n.touchEventOptions.passive!==a.touchEventOptions.passive?(t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:l(t.el,n)})):t:Object.assign(Object.assign({},t),{cleanUpTouch:l(t.el,n)})}function Ot(t){const{trackMouse:n}=t,a=g.useRef(Object.assign({},Q)),l=g.useRef(Object.assign({},P)),m=g.useRef(Object.assign({},l.current));m.current=Object.assign({},l.current),l.current=Object.assign(Object.assign({},P),t);let j;for(j in P)l.current[j]===void 0&&(l.current[j]=P[j]);const[h,i]=g.useMemo(()=>Ct(c=>a.current=c(a.current,l.current),{trackMouse:n}),[n]);return a.current=kt(a.current,l.current,m.current,i),h}function Tt(t){const{addParam:n}=R();return e.jsxs(v,{gap:8,vertical:!0,children:[e.jsx(S,{block:!0,onClick:()=>n("testify","single"),children:"Testify Drawer"}),e.jsx(S,{block:!0,onClick:()=>n("testify","group"),children:"Testify Group"}),e.jsx(It,{...t}),e.jsx(Rt,{...t})]})}function It({suspects:t,questions:n,answers:a,addEntryToUpdate:l}){const{width:m,height:j}=pe(),{is:h,removeParam:i}=R(),[c,x]=fe(),d=Ot({onSwipedLeft:()=>alert("Swiped Left"),onSwipedRight:()=>alert("Swiped Right"),onSwipedUp:()=>alert("Swiped Up"),preventScrollOnSwipe:!0,trackTouch:!0,trackMouse:!0}),o=()=>{x({suspectId:O.sample(Object.keys(t))||null,testimonyId:O.sample(Object.keys(n))||null})},p=()=>{o()},r=()=>{if(c?.suspectId&&c?.testimonyId){const f=O.cloneDeep(a[c?.testimonyId??""]??{});f[c.suspectId]=[...f[c.suspectId]||[],1],l(c.testimonyId??"",f),o()}},s=()=>{if(c?.suspectId&&c?.testimonyId){const f=O.cloneDeep(a[c?.testimonyId??""]??{});f[c.suspectId]=[...f[c.suspectId]||[],0],l(c.testimonyId??"",f),o()}},u=!!c?.suspectId&&!!c?.testimonyId;return e.jsx(oe,{footer:null,maskClosable:!1,onCancel:()=>i("testify"),open:h("testify","single"),title:e.jsx(k,{children:"Does this person do this??"}),width:m-64,children:e.jsxs("div",{...d,children:[u&&e.jsxs(v,{align:"center",className:"mb-8",gap:8,justify:"center",vertical:!0,children:[e.jsx(L,{cardId:c.suspectId??"",cardWidth:Math.max(j/4,128)}),e.jsx(k.Title,{className:"text-center",level:5,children:n[c.testimonyId??""]?.question})]}),e.jsxs(M.Compact,{block:!0,className:"mb-8",size:"large",children:[e.jsx(S,{block:!0,disabled:!u,icon:"ðŸ‘Ž",onClick:s,style:{height:64},children:"No"}),e.jsx(S,{block:!0,onClick:p,style:{height:64},children:"Skip"}),e.jsx(S,{block:!0,disabled:!u,icon:"ðŸ‘",iconPosition:"end",onClick:r,style:{height:64},children:"Yes"})]})]})})}function Rt({suspects:t,questions:n,answers:a,addEntryToUpdate:l}){const{width:m,height:j}=pe(),{is:h,removeParam:i}=R(),[c,x]=fe(),[d,o]=g.useState(6),[p,r]=g.useState(!0),s=()=>{const y=O.sampleSize(Object.keys(t),d)?.reduce((b,C)=>(b[C]=null,b),{});x({suspectsIds:y,testimonyId:(p?O.sample(Object.keys(n)):c?.testimonyId)??null})};we(()=>s());const u=()=>{const y=Object.entries(c?.suspectsIds??{}).reduce((b,[C,T])=>(T!==null&&(b[C]=[T]),b),{});if(c?.testimonyId&&Object.keys(y).length>0){const b=O.cloneDeep(a[c.testimonyId]??{});Object.entries(y).forEach(([C,T])=>{b[C]=[...b[C]||[],...T]}),l(c.testimonyId,b)}else console.log("No testimonyId or no judged suspects found, likely skipped");s()},f=!!c?.suspectsIds&&!!c?.testimonyId,w=y=>{x(b=>{if(!b)return b;const C=Object.entries(b.suspectsIds).reduce((T,[D,N])=>(T[D]=N===null?y:N,T),{});return{...b,suspectsIds:C}})};return e.jsx(oe,{footer:null,maskClosable:!1,onCancel:()=>i("testify"),open:h("testify","group"),title:e.jsx(k,{children:"Do these people do this??"}),width:m-64,children:e.jsxs("div",{children:[f&&e.jsxs(v,{align:"center",className:"mb-8",gap:8,justify:"center",vertical:!0,children:[e.jsxs(v,{align:"center",gap:6,justify:"center",children:[e.jsx(k.Text,{children:"Number of Suspects:"}),e.jsx(le,{onChange:y=>o(y??6),size:"small",value:d}),e.jsx(k.Text,{children:"Random Questions:"}),e.jsx(E,{checked:p,onChange:r,size:"small"})]}),e.jsxs(k.Title,{className:"text-center",level:4,children:[c.testimonyId," - ",n[c.testimonyId??""]?.question]}),e.jsx(v,{gap:8,justify:"center",wrap:"wrap",children:Object.keys(c.suspectsIds).map(y=>e.jsxs(v,{align:"center",justify:"center",vertical:!0,children:[e.jsx(k.Text,{className:"text-center",children:t[y]?.name?.pt||"Unknown"}),e.jsx(L,{cardId:y,cardWidth:Math.min(Math.max(j/3,128),128)},y),e.jsx(Me,{onChange:b=>x(C=>C&&{...C,suspectsIds:{...C.suspectsIds,[y]:b}}),options:[{value:0,icon:"ðŸ‘Ž"},{value:null,icon:"â™¾"},{value:1,icon:"ðŸ‘"}],shape:"round",size:"large",value:c.suspectsIds[y]})]},y))})]}),e.jsxs(v,{align:"center",className:"mt-8",justify:"space-between",children:[e.jsx("span",{}),e.jsxs(v,{gap:8,children:[e.jsx(S,{onClick:()=>w(0),children:"Set all â™¾ to ðŸ‘Ž"}),e.jsx(S,{onClick:()=>w(1),children:"Set all â™¾ to ðŸ‘"})]}),e.jsx(S,{onClick:u,size:"large",children:"Next Set"})]})]})})}function Dt({suspects:t,questions:n,data:a,hasNewData:l,isDirty:m,save:j,isSaving:h,entriesToUpdate:i,addEntryToUpdate:c}){const{queryParams:x,addParams:d}=R(),o=g.useMemo(()=>{let r=0;const s={};return Object.values(a).forEach(u=>{Object.keys(u).forEach(f=>{if(u[f]){s[f]||(s[f]=0);const w=Oe(u[f]);w>=5&&(s[f]+=1),w>=3&&(r+=1)}})}),{absoluteTotal:r,queriedTestimoniesCount:Object.keys(a).length,suspectsCount:Object.keys(s).length,reliableSuspectsCount:Object.values(s).filter(u=>u>=30).length}},[a]),p=o.queriedTestimoniesCount*o.suspectsCount;return e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsxs(v,{gap:12,vertical:!0,children:[e.jsx(Fe,{dirt:JSON.stringify(i),isDirty:m,isSaving:h,onSave:j}),e.jsx(ue,{block:!0,data:async()=>await Mt(a),disabled:m,fileName:"testimony-answers.json",hasNewData:l}),e.jsx(Ee,{label:"FS Data",path:"data/testimonies"}),e.jsx(Ae,{docId:"testimonies",label:"FS TDR",path:"tdr",queryKey:["tdr","testimonies"]})]})}),e.jsxs(V,{children:[e.jsx(Ne,{label:"Display",onChange:r=>d({display:r,page:1},{page:1}),options:[{title:"Questions",icon:e.jsx(qe,{}),value:"questions"},{title:"Suspects",icon:e.jsx(Ze,{}),value:"suspects"},{title:"Simulator",icon:e.jsx(He,{}),value:"simulator"}],value:x.get("display")??"questions"}),e.jsx(Be,{})]}),e.jsx(V,{children:e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Legend"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Reliability: At least 5 votes"}),e.jsx("li",{children:"Large Bars: There's enough data (at least 3)"}),e.jsx("li",{children:"Small blue bar: in progress negative"})]})]})}),e.jsxs(V,{children:[e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Counts"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Testimonies: ",o.queriedTestimoniesCount]}),e.jsxs("li",{children:["Suspects: ",o.suspectsCount]}),e.jsx("li",{children:e.jsxs(F,{title:"A reliable suspect is one that has at least 5 complete testimonies.",children:["Reliable suspects: ",o.reliableSuspectsCount]})}),e.jsxs("li",{children:["Complete: ",o.absoluteTotal]}),e.jsxs("li",{children:["Total: ",p]}),e.jsxs("li",{children:["Percentage: ",(o.absoluteTotal/p*100).toFixed(1),"%"]})]})]}),e.jsx(Tt,{addEntryToUpdate:c,answers:a,questions:n,suspects:t})]})]})}async function Mt(t){console.log("Preparing file for download...x");const n=await ze("data","testimonies")(),a=Le(n);console.log("Parsed data from Firestore:",a);const l=O.cloneDeep(t);return Object.keys(l).forEach(m=>{const j=l[m],h=a[m]||{};Object.keys(j).forEach(i=>{const c=h[i]||[],x=Te([...j[i],...c]);j[i]=x})}),$e(Ve(l))}function ws(){const t=Ie();return e.jsx(be,{subtitle:"Suspect Testimony Rates",title:"Testimonies",children:e.jsxs(J,{hasSider:!0,children:[e.jsx(Se,{children:e.jsx(Dt,{...t})}),e.jsx(J.Content,{className:"content",children:e.jsx(ve,{error:t.error,hasResponseData:!O.isEmpty(t.data),isLoading:t.isLoading,children:e.jsx(ft,{...t})})})]})})}export{ws as TestimoniesPage,ws as default};
