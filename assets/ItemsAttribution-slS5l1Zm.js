import{r as v,a as J,_ as Z,ad as Ke,Q as ge,O as qe,j as e,T as O,D as G,B as P,M as He,z as Se,aa as ue,ae as Ye,af as Je,ab as he,ag as Ze,ah as We,ai as Xe,P as et,L as je}from"./index-JWAGMJpb.js";import{D as tt}from"./DataLoadingWrapper-CCi4PeI-.js";import{c as Q,a as se,b as we,d as ce,T as st}from"./FilterEntries-l4yWlRaU.js";import{S as rt}from"./SiderContent-CX4jJHAg.js";import{D as Pe}from"./DownloadButton-BXZQBMwa.js";import{S as nt}from"./SaveButton-CqaScz3T.js";import{l as x}from"./lodash-CRtbtrxq.js";import{A as k,d as w,e as it,f as q}from"./constants-DuHnCtza.js";import{e as at,g as lt,a as fe,d as Ne,w as ot,m as ct}from"./index-IknmYcnY.js";import{u as ut}from"./useGetFirebaseDoc--1sFOsL1.js";import{u as ie}from"./useTDResource-C1Vu1dm2.js";import{u as dt}from"./useUpdateFirebaseDoc-C7ftN37z.js";import{T as ne}from"./index-CmeM8N_j.js";import{F as S}from"./index-uw4G1lDP.js";import{R as mt}from"./VerticalAlignTopOutlined-DlgYXFiH.js";import{I as W,a as X,b as F,c as le}from"./ItemBuildingBlocks-aNDeP6zb.js";import{a as Re}from"./index-CGnPJCBB.js";import{R as Ie}from"./index-C50j3otf.js";import{c as de,E as ae,P as pt}from"./useBaseUrl-B9wI_6Pe.js";import{I as ve}from"./Item-BnpQ11CJ.js";import{P as Le}from"./progress-BfzOVZMz.js";import{C as Y,T as gt}from"./index-BxXSDHYD.js";import{A as ht}from"./index-DWPZ8GS1.js";import{S as $}from"./index-CL5f_UtC.js";import{u as xe}from"./useQueryParams-CT50qqcq.js";import{I as ft}from"./ItemsTypeahead-CgoOxoxp.js";import{R as xt,a as bt,P as jt}from"./Pagination-Cte7O8Ba.js";import{S as te}from"./index-DxQT68k9.js";import{R as It,F as Oe,a as vt}from"./Table-Bxe-ghl2.js";import{D as yt}from"./index-DsGmNjb3.js";import{S as At}from"./index-Df29ZO3S.js";import{i as Ct}from"./util-CeAI_f06.js";import{P as Tt}from"./index-Bnb6V9YN.js";import{u as Et}from"./useToggle-D8HfEPKH.js";import{M as St}from"./index-DijjTx4z.js";import{T as wt}from"./TransparentButton-DzpDo7UT.js";import{R as Pt}from"./SkinOutlined-DgUnKyO0.js";import{R as Nt}from"./index-B50ipSwE.js";import"./index-Buyqji-I.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-CndnibDu.js";import"./useMutation-HrApwi-n.js";import"./gapSize-U1swVQyS.js";import"./LanguageFlag-BNVvKCiB.js";import"./useCopyToClipboardFunction-Bw-hnPIR.js";import"./index-2EX6VwZs.js";import"./Input-BhUkDnUD.js";import"./FireFilled-BW6XhD48.js";import"./IdcardOutlined-Bg4d-ObI.js";import"./PlusOutlined-BYgM_2Ac.js";import"./throttleByAnimationFrame-CFQuhjh_.js";import"./useDebounce-mhaJADyF.js";import"./index-CbPxEepB.js";import"./scrollTo-DtoYfhRq.js";import"./extendsObject-keMuGWqj.js";var Rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"},Lt=function(r,s){return v.createElement(J,Z({},r,{ref:s,icon:Rt}))},Ot=v.forwardRef(Lt),Ut={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},Dt=function(r,s){return v.createElement(J,Z({},r,{ref:s,icon:Ut}))},ye=v.forwardRef(Dt),Vt={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},Mt=function(r,s){return v.createElement(J,Z({},r,{ref:s,icon:Vt}))},kt=v.forwardRef(Mt),zt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},Ft=function(r,s){return v.createElement(J,Z({},r,{ref:s,icon:zt}))},Bt=v.forwardRef(Ft),$t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},_t=function(r,s){return v.createElement(J,Z({},r,{ref:s,icon:$t}))},Gt=v.forwardRef(_t),Qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},Kt=function(r,s){return v.createElement(J,Z({},r,{ref:s,icon:Qt}))},qt=v.forwardRef(Kt),Ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Yt=function(r,s){return v.createElement(J,Z({},r,{ref:s,icon:Ht}))},Jt=v.forwardRef(Yt),Zt=function(t,r){return Ct?window.matchMedia(t).matches:!1},Wt=function(t,r){var s=v.useState(Zt(t)),n=s[0],o=s[1];return v.useEffect(function(){var i=!0,l=window.matchMedia(t),c=function(){i&&o(!!l.matches)};return l.addEventListener("change",c),o(l.matches),function(){i=!1,l.removeEventListener("change",c)}},[t]),n};const Ue={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};x.keyBy(Ue,"prefix");const Xt=["*","^","+","~","!"],K={ATTRIBUTE_VALUE_DICT:Ue,ATTRIBUTE_VALUE_PRIORITY:Xt},me=(t={})=>x.cloneDeep(x.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},t)),pe=(t={})=>x.cloneDeep(x.merge({id:"",attributes:{}},t)),De=(t,r,s)=>{const n=x.orderBy(Object.values(r),["priority","id"],["asc","asc"]).map(a=>a.id);function o(a,u){return x.orderBy(a,j=>n.indexOf(j),["asc"]).map(j=>`${u}${j}`)}const i=[],l=[],c=[],m=[],b=[];return Object.entries(t.attributes).forEach(([a,u])=>{if(r[a])switch(u){case w.OPPOSITE:i.push(a);break;case w.DETERMINISTIC:l.push(a);break;case w.RELATED:c.push(a);break;case w.UNRELATED:m.push(a);break;case w.UNCLEAR:b.push(a);break;default:b.push(a);break}}),[...o(i,k.OPPOSITE),...o(l,k.DETERMINISTIC),...o(c,k.RELATED),...o(m,k.UNRELATED),...o(b,k.UNCLEAR)]},Ve=x.memoize(t=>{if(t.length===3)return{key:t,className:"",text:""};const r=t[0];return{key:t.slice(1,4),className:{[k.DETERMINISTIC]:"deterministic",[k.UNRELATED]:"unrelated",[k.UNCLEAR]:"unclear",[k.OPPOSITE]:"opposite"}[r],text:{[k.DETERMINISTIC]:"very",[k.UNRELATED]:"not",[k.UNCLEAR]:"maybe",[k.OPPOSITE]:"very not"}[r]}}),Me=(t,r,s)=>t.filter(n=>!(!r&&n.includes(k.UNCLEAR)||!s&&n.includes(k.UNRELATED)));function ke(t,r,s){const n=[];for(const[l,c]of Object.entries(t.attributes)){const m=r[l];if(m){const b=Object.values(K.ATTRIBUTE_VALUE_DICT).find(a=>a.value===c);b&&n.push({prefix:b.prefix,id:m.id,priority:m.priority})}}const o=x.sortBy(n,[l=>K.ATTRIBUTE_VALUE_PRIORITY.indexOf(l.prefix),l=>l.prefix===K.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:l.priority,["asc","asc"]]),i=s!=null&&s.length?o.slice(0,s==null?void 0:s.length):o;return s!=null&&s.onlyRelevant?i.filter(l=>[K.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,K.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(l.prefix)).map(l=>`${l.prefix}${l.id}`).join(""):i.map(l=>`${l.prefix}${l.id}`).join("")}const es=x.keyBy(K.ATTRIBUTE_VALUE_DICT,"prefix");function ts(t){return(t.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((s,n)=>{const o=n[0],i=n.slice(1),l=es[o].value;return s[i]=l,s},{})}function ze(t){return Object.values(t.attributes).reduce((r,s)=>s<=0?(s===K.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(r+=s/2),r):r+s,0)}function Fe(t,r){const s=Object.values(t.attributes).filter(n=>n===K.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((r-s)/r*100)}function V(){const[t,r]=Ke(),s=(o,i)=>{t.set(o,`${i}`),r(t)},n=o=>{t.delete(o),r(t)};return{view:t.get("view")??"classifier",setView:o=>r({view:o}),addQueryParam:s,removeQueryParam:n,searchParams:t}}const re={};function ss(){const{notification:t,message:r}=ge.useApp(),s=qe(),n=ie("items"),o=ie("items-attributes"),i=ie("items-attribute-values"),l=ut("tdr","itemsAttributeValues",{select:f=>ns({itemAttributesValues:f,itemAttributes:o.data??{}})}),[c,m]=v.useState({}),b=dt("tdr","itemsAttributeValues",{onSuccess:()=>{t.success({message:"itemsAttributeValues updated"}),s.refetchQueries({queryKey:["firebase","tdr","itemsAttributeValues"]}),m({})},onError:f=>{t.error({message:"itemsAttributeValues update failed",description:f.message})}}),a=v.useMemo(()=>({...i.data??{},...l.data??{}}),[i.data,l.data]),u=!x.isEmpty(c),j=(f,C)=>{m(d=>({...d,[f]:{...C,updatedAt:Date.now()}}))},h=f=>{m(C=>({...C,...x.mapKeys(f.map(d=>({...d,updatedAt:Date.now()})),"id")}))},p=l.data,g=()=>{b.mutate(rs({...p,...c},o.data))};return{availableItemIds:v.useMemo(()=>{const f=n.data??{};return x.orderBy(Object.keys(f).filter(C=>{var d;return(((d=f[C])==null?void 0:d.decks)??[]).includes("alien")}),C=>Number(C),"asc")},[n.data]),getItem:f=>{var C;return(C=n.data)!=null&&C[f]?n.data[f]:(f&&r.info(`Item ${f} not found in TDR. Creating a new item...`),me({id:f}))},getItemAttributeValues:f=>{const C=(a==null?void 0:a[f])??{},d=c[f]??{};return x.isEmpty(C)&&x.isEmpty(d)?(re[f]=pe({id:f}),re[f]):x.merge((re==null?void 0:re[f])??{},C,d)},attributes:o.data??{},isLoading:n.isLoading||o.isLoading||i.isLoading||l.isLoading,error:n.error||o.error||i.error||l.error,firebaseData:p,isSaving:b.isPending,save:g,addAttributesToUpdate:j,addMultipleAttributesToUpdate:h,attributesToUpdate:c,isDirty:u}}const rs=(t,r)=>lt(t,n=>({id:n.id,tempSignature:ke(n,r),updatedAt:n.updatedAt})),ns=t=>{const{itemAttributesValues:r,itemAttributes:s}=t,n=Object.keys(s).length;return at(r,i=>{const l=ts(i.tempSignature),c=Object.keys(l).length===n,m={id:i.id,updatedAt:i.updatedAt,attributes:l};return c?{...m,complete:c,reliability:Fe(m,n),score:ze(m)}:m})},Be=v.createContext({getItem:()=>me(),getItemAttributeValues:()=>pe(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:me(),itemAttributeValues:pe(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{}}),is=({children:t})=>{const{getItem:r,getItemAttributeValues:s,availableItemIds:n,isLoading:o,error:i,isSaving:l,save:c,addAttributesToUpdate:m,isDirty:b,attributes:a,addMultipleAttributesToUpdate:u,attributesToUpdate:j}=ss(),{message:h}=ge.useApp(),p=v.useMemo(()=>x.orderBy(Object.values(a),"name.en","asc"),[a]),{searchParams:g}=V(),y=g.get("sortBy"),I=v.useMemo(()=>y==="id"?x.orderBy(n,E=>Number(E),"asc"):y==="updatedAt"?x.orderBy(n,E=>s(E).updatedAt,"desc"):y==="fewestAttributesLeft"?x.orderBy(n,E=>{const T=p.length-Object.keys(s(E).attributes).length;return T===0?Number.POSITIVE_INFINITY:T},"asc"):n,[n,y]),[R,f]=v.useState(x.random(0,I.length-1)),C=r(I[R]),d=s(C.id),D=(E,T)=>{if(E==="next"){f(A=>(A+1)%I.length);return}if(E==="previous"){f(A=>(A-1+I.length)%I.length);return}if(E==="random"){f(x.random(0,I.length-1));return}if(E==="first"){f(0);return}if(E==="last"){f(I.length-1);return}if(E==="next10"){f(A=>(A+10)%I.length);return}if(E==="previous10"){f(A=>(A-10+I.length)%I.length);return}if(E==="incomplete"){f(A=>{let M=A+1;for(;M<I.length;){const L=s(I[M]);if(Object.keys(L.attributes).length!==p.length)return M;if(M===I.length-1)return h.info("No more incomplete items found."),A;M++}return A});return}if(E==="goTo"&&T!==void 0){const A=I.indexOf(T);if(A!==-1){f(A);return}h.error(`Item ${T} is not available for attribution.`)}},z=(E,T)=>{m(C.id,{...d,attributes:{...d.attributes,[E]:T}})},N=()=>fe(n.reduce((E,T)=>{const A=s(T);return x.isEmpty(A.attributes)||(Object.keys(A.attributes).length===p.length?A.complete=!0:delete A.complete,E[A.id]=A),E},{}));return e.jsx(Be.Provider,{value:{getItem:r,getItemAttributeValues:s,availableItemIds:n,isLoading:o,error:i,hasResponseData:n.length>0&&!x.isEmpty(a),isDirty:b,itemAttributeValues:d,jumpToItem:D,activeItem:C,onAttributeChange:z,isSaving:l,save:c,attributes:a,attributesList:p,addAttributesToUpdate:m,addMultipleAttributesToUpdate:u,prepareItemsAttributesFileForDownload:N,attributesToUpdate:j},children:t})},U=()=>v.useContext(Be);function _({label:t,children:r}){return e.jsxs(O.Text,{children:[t," ",e.jsx(ne,{children:r})]})}function as(){const{getItemAttributeValues:t,availableItemIds:r,attributesList:s}=U(),{total:n,complete:o,completionPercentage:i,hasDataCount:l,initiatedPercentage:c,progress:m,progressTotal:b,currentProgress:a}=v.useMemo(()=>{const u=r.length;let j=0,h=0,p=0;r.map(I=>t(I)).forEach(({attributes:I})=>{x.isEmpty(I)||(j+=1),Object.values(I).length===s.length&&(h+=1),p+=Object.values(I).length});const y=Object.values(s).length*r.length;return{total:u,complete:h,completionPercentage:u>0?(h/u*100).toFixed(1):0,hasDataCount:j,initiatedPercentage:u>0?Math.floor(j/u*100):0,progress:(p/y*100).toFixed(1),currentProgress:p,progressTotal:y}},[s,r,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{vertical:!0,children:[e.jsx(O.Text,{strong:!0,className:"mb-2",children:"Items Stats"}),e.jsx(_,{label:"Total",children:n}),e.jsxs(_,{label:"Complete",children:[o," (",i,"%)"]}),e.jsxs(_,{label:"Initiated",children:[l," (",c,"%)"]}),e.jsx(O.Text,{strong:!0,className:"mt-4 mb-2",children:"Attributes Stats"}),e.jsx(_,{label:"Total",children:b}),e.jsx(_,{label:"Set",children:a}),e.jsxs(_,{label:"Progress",children:[m,"%"]})]}),e.jsx(G,{})]})}function ls(){const{jumpToItem:t}=U(),{searchParams:r,addQueryParam:s}=V();return e.jsxs(e.Fragment,{children:[e.jsx(P,{block:!0,onClick:()=>t("random"),type:"primary",children:"Random Item"}),e.jsx(Q,{label:"Unset Only",value:r.get("scope")==="unset",onChange:n=>s("scope",n?"unset":""),className:"mt-4"})]})}function os(){const{searchParams:t,addQueryParam:r}=V(),{attributesList:s}=U(),n=v.useMemo(()=>[{label:"Random Attribute",value:"random"},...s.map(({id:o,name:i})=>({label:i.en,value:o}))],[s]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Sampler Attribute",value:t.get("attribute")||"random",onChange:o=>r("attribute",o),options:n}),e.jsx(we,{label:"Sample Size",value:Number(t.get("size")||9),onChange:o=>r("size",String(o)),min:3,max:21,step:3})]})}function cs(){const{searchParams:t,addQueryParam:r}=V(),{attributesList:s}=U(),n=v.useMemo(()=>s.map(({id:o,name:i,...l})=>({label:`${i.en}${l.default?"*":""}`,value:o})),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Attribute",value:t.get("attribute")||"ali",onChange:o=>r("attribute",o),options:n}),e.jsx(se,{label:"Scope",value:t.get("scope")||"unset",onChange:o=>r("scope",o),options:[{value:"unset",label:"Unset"},...it]}),e.jsx(se,{label:"Results per page",value:t.get("pageSize")||12,onChange:o=>r("pageSize",o),options:[12,24,48,96]})]})}function us(){const{searchParams:t,addQueryParam:r}=V();return e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"Only Complete",value:t.get("showComplete")==="true",onChange:s=>r("showComplete",s?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unrelated",value:t.get("showUnrelated")==="true",onChange:s=>r("showUnrelated",s?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unclear",value:t.get("showUnclear")==="true",onChange:s=>r("showUnclear",s?"true":""),className:"full-width m-0"})]})}function ds(){const{searchParams:t,addQueryParam:r}=V();return e.jsx(e.Fragment,{children:e.jsx(Q,{label:"Show Glyphs",value:t.get("showGlyphs")==="true",onChange:s=>r("showGlyphs",s?"true":""),className:"full-width m-0"})})}function ms(){const{isDirty:t,save:r,prepareItemsAttributesFileForDownload:s,attributes:n,isSaving:o,attributesToUpdate:i}=U(),{view:l,setView:c}=V();return e.jsxs(rt,{children:[e.jsxs(S,{vertical:!0,gap:12,children:[e.jsx(nt,{isDirty:t,onSave:r,isSaving:o,dirt:JSON.stringify(i)}),e.jsx(Pe,{data:()=>ps(s(),n),fileName:"items-attribute-values.json",disabled:t,block:!0})]}),e.jsx(G,{}),e.jsx(as,{}),e.jsx(se,{label:"View",value:l,onChange:c,options:["classifier","sampler","grouping","comparator","simulator","stats"]}),e.jsx(G,{}),l==="classifier"&&e.jsx(ls,{}),l==="sampler"&&e.jsx(os,{}),l==="grouping"&&e.jsx(cs,{}),l==="comparator"&&e.jsx(us,{}),l==="stats"&&e.jsx(ds,{})]})}function ps(t,r){const s=Object.keys(r).length;return Object.keys(t).forEach(n=>{const o=t[n],i=Object.keys(o.attributes);i.forEach(c=>{r[c]||delete o.attributes[c]}),i.length===s?(o.complete=!0,o.score=ze(o),o.reliability=Fe(o,s),o.signature=ke(o,r,{onlyRelevant:!0})):(o.complete=void 0,o.score=void 0,o.reliability=void 0,o.signature=void 0)}),fe(Ne(t))}function $e(t){const[r,s]=v.useState(!1),n=()=>{s(window.scrollY>300)},o=()=>{window.scrollTo({top:0,behavior:"smooth"})};return He(()=>(window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)})),e.jsx(P,{className:`go-to-top-button ${r?"visible":""}`,onClick:o,icon:e.jsx(mt,{}),...t,children:"Go to Top"})}function _e({title:t,icon:r}){return e.jsx(Se,{title:t,children:r??e.jsx(Re,{})})}const Ae=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC}],Ce=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC,disabled:!0}];function oe({attribute:t,value:r,onChange:s,onlyButtons:n,size:o}){return t?n?e.jsx(Ie.Group,{options:t.limited?Ce:Ae,onChange:({target:{value:i}})=>s(t.id,i),value:r,optionType:"button",buttonStyle:"solid",size:o}):e.jsxs("div",{className:"attribute-button-container__row",children:[e.jsxs("span",{className:"attribute-button-container__label",children:[x.truncate(t.name.en,{length:12})," ",e.jsx(_e,{title:t.description.en})]}),e.jsx(Ie.Group,{options:t.limited?Ce:Ae,onChange:({target:{value:i}})=>s(t.id,i),value:r,optionType:"button",buttonStyle:"solid",size:o}),e.jsx("span",{children:e.jsx(ue,{style:{color:r&&r>7?"green":"transparent"}})})]},t.id):e.jsx(e.Fragment,{})}function gs({itemAttributeValues:t,attributes:r}){const{searchParams:s,addQueryParam:n}=V(),o=s.get("showUnclear")==="true",i=s.get("showUnrelated")==="true",l=v.useMemo(()=>Me(De(t,r),o,i),[t,r,o,i]),c=s.get("signs")==="true"?Ge:hs;return e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(Q,{label:"Show Unrelated",value:s.get("showUnrelated")==="true",onChange:m=>n("showUnrelated",m?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unclear",value:s.get("showUnclear")==="true",onChange:m=>n("showUnclear",m?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Alien Sings",value:s.get("signs")==="true",onChange:m=>n("signs",m?"true":""),className:"full-width m-0"}),e.jsx(S,{gap:6,wrap:"wrap",className:"item-attribute-value-statement",children:l.map((m,b,a)=>e.jsx(c,{keyVariant:m,attributes:r,firstElement:b===0,lastElement:b===a.length-1},m))})]})}function Ge({keyVariant:t,attributes:r,withText:s}){const{key:n,className:o,text:i}=Ve(t);return e.jsxs(S,{vertical:!0,align:"center",children:[e.jsx(q,{width:50,id:r[n].spriteId,className:de("item-attribute-alien-sign",`item-attribute-alien-sign--${o}`)}),s&&e.jsxs(S,{wrap:"wrap",justify:"center",align:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},children:[i," ",r[n].name.en.toLowerCase()]})]})}function hs({keyVariant:t,attributes:r,firstElement:s,lastElement:n}){const{key:o,text:i}=Ve(t),l=s?"It's ":"",c=n?".":", ";return e.jsxs(e.Fragment,{children:[l,i," ",r[o].name.en.toLowerCase(),c]})}function fs({attributesList:t,itemAttributeValues:r}){const{completion:s,isDeterministic:n,value:o,isOpposing:i,relevancy:l}=v.useMemo(()=>{const c=t.length,m=Object.keys(r.attributes).length,b=Math.floor(m/c*100);let a=!1,u=!1,j=0;const h=Object.values(r.attributes).reduce((g,y)=>y<=0?(y===w.UNCLEAR&&(j+=1),y===w.OPPOSITE&&(u=!0,g+=y/2),g):(y===w.DETERMINISTIC&&(a=!0),g+y),0),p=Math.floor((m-j)/c*100);return{completion:b,isDeterministic:a,value:h,isOpposing:u,relevancy:p}},[t,r.attributes]);return e.jsxs("div",{children:[e.jsx(O.Text,{strong:!0,children:"Completion"}),e.jsx(Le,{percent:s,size:"small"}),e.jsx(O.Text,{strong:!0,children:"Stats"}),e.jsxs(S,{vertical:!0,children:[e.jsx(_,{label:"Deterministic",children:n?e.jsx(ue,{style:{color:"green"}}):e.jsx(ye,{style:{color:"red"}})}),e.jsx(_,{label:"Opposing",children:i?e.jsx(ue,{style:{color:"CornflowerBlue"}}):e.jsx(ye,{style:{color:"grey"}})}),e.jsx(_,{label:"Value",children:o}),e.jsx(Se,{title:"The percentage of conclusive attributes (not unclear)",children:e.jsxs(_,{label:"Reliability",children:[l,"%"]})})]})]})}function xs(){const{activeItem:t,attributesList:r,itemAttributeValues:s,onAttributeChange:n,jumpToItem:o,attributes:i}=U(),{searchParams:l,removeQueryParam:c}=V(),m=l.get("itemId"),b=l.get("filters");v.useEffect(()=>{m&&(c("itemId"),o("goTo",m))},[m,o,c]);const a=l.get("scope")==="unset",u=v.useMemo(()=>{const j=a?r.filter(h=>!s.attributes[h.id]):r;if(b){const h=b.split(",").reduce((p,g)=>(p[g]=!0,p),{});return j.filter(p=>h[p.id])}return j},[a,t.id,b]);return t?e.jsx(Y,{children:e.jsxs("div",{className:"item-attribution-card",children:[e.jsx(ht,{offsetTop:120,className:"item-attribution-card__item",children:e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:t,width:150}),e.jsx(X,{item:t}),e.jsx(F,{item:t,language:"en"}),e.jsx(F,{item:t,language:"pt"}),e.jsx(G,{className:"my-2"}),e.jsx(fs,{attributesList:r,itemAttributeValues:s}),e.jsx(G,{className:"my-2"}),e.jsx(O.Text,{type:"secondary",children:e.jsx(gs,{itemAttributeValues:s,attributes:i})})]})}),e.jsx($,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(j=>e.jsx(oe,{attribute:j,value:s.attributes[j.id],onChange:n},j.id))})]},`${t.id}`)}):e.jsx(Y,{children:e.jsxs(O.Text,{type:"secondary",children:["No item selected."," ",e.jsx(P,{size:"small",type:"primary",onClick:()=>o("random"),children:"Random Item"})]})})}function bs(){const{jumpToItem:t}=U();return e.jsxs($.Compact,{children:[e.jsx(P,{onClick:()=>t("first"),icon:e.jsx(Jt,{}),children:"First"}),e.jsx(P,{onClick:()=>t("previous10"),icon:e.jsx(xt,{}),children:"Previous 10"}),e.jsx(P,{onClick:()=>t("previous"),icon:e.jsx(Ye,{}),children:"Previous"}),e.jsxs(P,{onClick:()=>t("next"),children:["Next ",e.jsx(Je,{})]}),e.jsxs(P,{onClick:()=>t("next10"),children:["Next 10 ",e.jsx(bt,{})]}),e.jsxs(P,{onClick:()=>t("last"),children:["Last ",e.jsx(qt,{})]}),e.jsx(he,{content:e.jsx(js,{}),title:"Go to item",children:e.jsx(P,{children:"Go To"})}),e.jsx(P,{onClick:()=>t("incomplete"),children:"Next Incomplete"})]})}function js(){const{jumpToItem:t}=U();return e.jsx(ft,{isPending:!1,onFinish:r=>t("goTo",r)})}function Is(){const{addParam:t,queryParams:r}=xe(),{attributesList:s}=U(),n=v.useMemo(()=>s.map(c=>({label:c.name.en,value:c.id})),[s]),o=c=>{t("filters",c.join(","))},i=r.get("filters"),l=e.jsx(te,{mode:"multiple",style:{width:300},options:n,value:i==null?void 0:i.split(","),onChange:c=>o(c),allowClear:!0});return e.jsx(he,{content:l,title:"Filter Attributes",children:e.jsx(P,{children:i?e.jsx(It,{style:{color:"gold"}}):e.jsx(Bt,{})})})}function vs(){const{addParam:t,queryParams:r}=xe(),s=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],n=r.get("sortBy"),o=e.jsx(te,{style:{width:120},options:s,value:n,onChange:i=>t("sortBy",i),allowClear:!0});return e.jsx(he,{content:o,title:"Sort By",children:e.jsx(P,{children:"Sort"})})}function ys(){const{attributes:t,getItemAttributeValues:r,availableItemIds:s,getItem:n,isLoading:o}=U(),{searchParams:i}=V(),l=i.get("showComplete")==="true",c=i.get("showUnclear")==="true",m=i.get("showUnrelated")==="true",{itemMessages:b,itemMessagesDict:a,grouping:u}=v.useMemo(()=>{if(o)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const j=x.orderBy(s.map(g=>{const y=r(g),I=De(y,t);return{item:n(g),itemAttributesValues:y,message:Me(I,c,m),fullMessage:I}}).filter(({itemAttributesValues:g})=>l?g.complete:!0),["message"],["asc"]),h=j.reduce((g,{message:y,item:{id:I}})=>{const R=y.join(" ");return g[R]===void 0&&(g[R]=[]),g[R].push(I),g},{}),p=Object.values(h).filter(g=>g.length>1);return p.length>0&&console.log("More than one",p),{itemMessages:j,itemMessagesDict:x.keyBy(j,"item.id"),grouping:h}},[t,s,r,n,o,l,c,m]);return{itemMessages:b,itemMessagesDict:a,grouping:u}}function be(){const{searchParams:t,removeQueryParam:r}=V(),s=t.get("drawer"),[n,o]=v.useState(!1),{activeItem:i,attributesList:l,itemAttributeValues:c,onAttributeChange:m,jumpToItem:b}=U(),a=()=>{r("drawer")};v.useEffect(()=>{s&&b("goTo",s)},[s,b,r]);const u=v.useMemo(()=>n?l.filter(j=>!c.attributes[j.id]):l,[n,i.id]);return e.jsxs(yt,{open:!!s,title:`Edit: ${i.name.en}`,onClose:a,width:"640px",children:[e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:i,width:50}),e.jsx(X,{item:i})]}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(F,{item:i,language:"en"}),e.jsx(F,{item:i,language:"pt"})]}),e.jsx(S,{vertical:!0,gap:6,children:e.jsx(At,{checked:n,onChange:o,checkedChildren:"Unset",unCheckedChildren:"All"})})]}),e.jsx(G,{className:"my-1"}),e.jsx($,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(j=>e.jsx(oe,{size:"small",attribute:j,value:c.attributes[j.id],onChange:m},j.id))})]})}function As(){const{attributes:t}=U(),{itemMessages:r,grouping:s}=ys(),{addQueryParam:n}=V(),o=[{title:"Item Id",dataIndex:"item",key:"id",render:i=>e.jsxs("div",{children:[e.jsx(X,{item:i}),e.jsxs(P.Group,{children:[e.jsx(le,{item:i}),e.jsx(P,{size:"small",shape:"round",onClick:()=>n("drawer",i.id),children:"Drawer"})]})]}),sorter:(i,l)=>Number(i.item.id)-Number(l.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:i=>e.jsx(W,{item:i,width:75})},{title:"Name",dataIndex:"item",key:"name",render:i=>e.jsxs(e.Fragment,{children:[e.jsx(F,{item:i,language:"en"}),e.jsx(F,{item:i,language:"pt"})]}),sorter:(i,l)=>i.item.name.en.localeCompare(l.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(i,{item:l})=>e.jsx(S,{gap:6,children:i.map((c,m,b)=>e.jsx(Ge,{keyVariant:c,attributes:t,firstElement:m===0,lastElement:m===b.length-1,withText:!0},`${c}-${l.id}`))}),sorter:(i,l)=>i.message.join(" ").localeCompare(l.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:i=>i.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:i=>{const l=s[i.join(" ")]??[];return e.jsx(e.Fragment,{children:l.length>1?l.length:"0"})},sorter:(i,l)=>{const c=s[i.message.join(" ")]??[];return(s[l.message.join(" ")]??[]).length-c.length}}];return e.jsxs("div",{className:"my-4",children:[e.jsx(O.Title,{level:5,children:"Item Comparator"}),e.jsx(Oe,{dataSource:r,columns:o,pagination:{showQuickJumper:!0}}),e.jsx(be,{})]})}function Cs(){const{attributesList:t,addAttributesToUpdate:r,getItemAttributeValues:s,availableItemIds:n,addMultipleAttributesToUpdate:o}=U(),{searchParams:i,addQueryParam:l}=V(),c=i.get("attribute")??"ali",m=i.get("scope")??"unset",b=i.get("page")??"1",a=i.get("pageSize")??"12",[u,j]=v.useState("ali"),[h,p]=v.useState("unset"),[g,y]=v.useState(null),[I,R]=v.useState("desc"),f=v.useMemo(()=>{const N=n.map(L=>s(L)),E=m==="unset"?void 0:w[m.toUpperCase()],T=N.filter(L=>{var B;return((B=L.attributes)==null?void 0:B[c])===E}).map(L=>L.id),[A,M]=(g??"::").split("::");return x.orderBy(T,[L=>{var B,H;return A==="attribute"?(H=(B=s(L))==null?void 0:B.attributes)==null?void 0:H[M]:!0},L=>A==="prop"?Number(L):!0,L=>{var B;return(B=s(L))==null?void 0:B.updatedAt},L=>Number(L)],[I,"asc","desc","asc"])},[c,m,g,I]),C=v.useMemo(()=>{if(u!==c||h!==m)return j(c),p(m),l("page","1"),f.slice(0,Number(a));const N=(Number(b)-1)*Number(a),E=N+Number(a);return f.slice(N,E)},[b,a,f]),d=t.find(N=>N.id===c),D=(N,E,T)=>{const A=s(N);r(N,{...A,attributes:{...A.attributes,[E]:T}})},z=()=>{o(C.map(N=>{const E=s(N);return E.attributes[c]||(E.attributes[c]=w.UNRELATED),E}))};return{group:f,stats:{total:n.length,group:f.length,percent:Math.round(f.length/n.length*100)},pageIds:C,attribute:d,updateAttributeValue:D,updatePageItemsAsUnrelated:z,sorting:{sortBy:g,setSortBy:y,sortOrder:I,setSortOrder:R},pagination:{total:f.length,current:Number(b),pageSize:Number(a),onChange:N=>l("page",String(N)),onShowSizeChange:(N,E)=>l("pageSize",String(E)),pageSizeOptions:[12,24,48,96]}}}const Ts=(t,r)=>r==="unset"||!r?`${100-t.percent}% done, ${t.group} left`:`${t.percent}%  - ${t.group} items`;function Es(){const{getItem:t,getItemAttributeValues:r,attributesList:s}=U(),{attribute:n,pageIds:o,updateAttributeValue:i,updatePageItemsAsUnrelated:l,pagination:c,stats:m,sorting:b}=Cs(),{searchParams:a,addQueryParam:u}=V(),j=Wt("(max-width: 1024px)");if(x.isEmpty(n))return e.jsx(Y,{className:"my-4",children:e.jsx(O.Text,{type:"secondary",children:"No group attribute has been selected."})});const h=e.jsx(jt,{onChange:c.onChange,current:c.current,total:c.total,pageSizeOptions:c.pageSizeOptions,pageSize:c.pageSize,onShowSizeChange:c.onShowSizeChange},"pagination"),p=e.jsxs(S,{align:"center",children:[e.jsx(O.Text,{className:"mr-2",children:"Sort by"}),e.jsxs(te,{style:{width:120},value:b.sortBy,onChange:I=>b.setSortBy(I),children:[e.jsx(te.Option,{value:null,children:"Last Updated"}),e.jsx(te.Option,{value:"prop::id",children:"Id"}),s.map(I=>e.jsx(te.Option,{value:`attribute::${I.id}`,children:I.name.en},I.id))]})]}),y=(a.get("scope")==="unset"||!a.get("scope"))&&e.jsx(Tt,{title:`Are you sure everything is unrelated to ${n.name.en}?`,onConfirm:l,children:e.jsx(P,{type:"primary",danger:!0,disabled:o.length===0,children:"Unrelate Unset Items on Page"})},"unrelate-button");return e.jsxs(Y,{className:"my-4",title:e.jsxs(O.Text,{children:[n==null?void 0:n.name.en," (",Ts(m,a.get("scope")),") -"," ",n.description.en]}),extra:e.jsxs(S,{align:"center",children:[p,h]}),actions:[y,e.jsx($e,{},"go-to-top"),h].filter(Boolean),children:[o.length===0&&e.jsx(ae,{description:"No items found in this scope for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),o.map(I=>{const R=r(I),f=t(I);return e.jsx(Y.Grid,{style:{width:j?"50%":"25%"},children:e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(W,{item:f,width:75}),e.jsx(X,{item:f}),e.jsxs(P.Group,{children:[e.jsx(le,{item:f}),e.jsx(P,{size:"small",shape:"round",onClick:()=>u("drawer",f.id),children:"Drawer"})]}),e.jsx(F,{item:f,language:"en"}),e.jsx(F,{item:f,language:"pt"})]}),e.jsx(oe,{attribute:n,value:R.attributes[n.id],onlyButtons:!0,onChange:(C,d)=>i(f.id,C,d)})]})},`${I}-${R.updatedAt}`)}),e.jsx(be,{})]})}function Qe(){const{attributesList:t,availableItemIds:r,addAttributesToUpdate:s,getItemAttributeValues:n}=U(),{searchParams:o}=V(),[i,l]=v.useState([]),[c,m]=v.useState(),b=()=>{var R;const h=o.get("attribute")??((R=x.sample(t))==null?void 0:R.id)??"ali",p=t.find(f=>f.id===h)??x.sample(t),g=Number(o.get("size"))||9,y=[],I=x.shuffle(r);for(let f=0;f<I.length&&y.length!==g;f++){const C=I[f];n(C).attributes[h]||y.push(C)}return{selectedAttribute:p,selected:y}},a=()=>{let h=b(),p=0;for(;h.selected.length===0&&p<30;)h=b(),p++;m(h.selectedAttribute),l(h.selected)},u=v.useMemo(()=>c?r.filter(h=>!n(h).attributes[c==null?void 0:c.id]).length:0,[c,r]);return{sampleIds:i,attribute:c,itemsLeftForAttribute:u,onGetSample:a,updateAttributeValue:(h,p,g)=>{const y=n(h);s(h,{...y,attributes:{...y.attributes,[p]:g}})}}}function Ss(){const{getItem:t,getItemAttributeValues:r}=U(),{sampleIds:s,attribute:n,onGetSample:o,updateAttributeValue:i,itemsLeftForAttribute:l}=Qe(),{addQueryParam:c}=V();if(x.isEmpty(s)&&x.isEmpty(n))return e.jsxs(Y,{className:"my-4",children:[e.jsxs(O.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",e.jsx(P,{size:"small",type:"primary",onClick:o,children:"Get Sample"})]}),e.jsx(G,{}),e.jsx(Te,{})]});const m=s.map(u=>({itemAttributes:r(u),item:t(u)})),b=m.filter(({itemAttributes:u})=>(n==null?void 0:n.id)&&!u.attributes[n.id]),a=()=>{b.forEach(({item:u})=>{n!=null&&n.id&&i(u.id,n.id,-3)})};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsxs(Y,{className:"my-4",title:e.jsxs(O.Text,{children:[n==null?void 0:n.name.en," - ",n==null?void 0:n.description.en," (",l," items left)"]}),actions:[e.jsx(P,{onClick:a,danger:!0,disabled:b.length===0,children:"Mark rest as unrelated"},"1"),e.jsx(P,{type:"primary",ghost:!0,onClick:o,children:"Get New Sample"},"2")],extra:e.jsx(P,{type:"primary",size:"small",onClick:o,children:"Get New Sample"}),children:[e.jsxs(S,{vertical:!0,gap:6,children:[m.length===0&&e.jsx(ae,{description:"No unset items found for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),m.map(({item:u,itemAttributes:j})=>e.jsxs(v.Fragment,{children:[e.jsxs(S,{gap:6,children:[e.jsx(W,{item:u,width:75}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:u}),e.jsxs(P.Group,{children:[e.jsx(le,{item:u}),e.jsx(P,{size:"small",shape:"round",onClick:()=>c("drawer",u.id),children:"Drawer"})]})]}),e.jsx(F,{item:u,language:"en"}),e.jsx(F,{item:u,language:"pt"})]}),!!n&&e.jsx(oe,{attribute:n,value:j.attributes[n.id],onChange:(h,p)=>i(u.id,h,p)})]}),e.jsx(G,{className:"my-1"})]},`${u.id}-${j.updatedAt}`))]}),e.jsx(be,{})]})]})}function Te(){const[t,r]=Et(!1),{addQueryParam:s,removeQueryParam:n}=V(),{sampleIds:o,attribute:i,onGetSample:l,updateAttributeValue:c}=Qe(),{getItem:m,getItemAttributeValues:b}=U(),a=()=>{s("size","1"),r(!0),l()},u=()=>{n("size"),r(!1)},j=o[0],h=m(j),p=b(j);return e.jsxs(S,{className:"mt-4",children:[e.jsx(P,{type:"primary",onClick:a,children:"Single Sampler"}),e.jsxs(St,{title:e.jsxs(O,{children:["Single Sampler: ",e.jsx("strong",{children:i==null?void 0:i.name.en})]}),open:t,width:"100vw",maskClosable:!1,onOk:u,onClose:u,onCancel:u,cancelButtonProps:{style:{display:"none"}},children:[j&&h&&p&&i&&e.jsxs(S,{gap:6,className:"my-10",wrap:"wrap",children:[e.jsx(W,{item:h,width:150}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:h}),e.jsx(le,{item:h})]}),e.jsx(F,{item:h,language:"en"}),e.jsx(F,{item:h,language:"pt"})]}),!!i&&e.jsx(oe,{size:"large",attribute:i,value:p.attributes[i.id],onChange:async(g,y)=>{c(h.id,g,y),await ot(500),l()}})]},j),e.jsx(P,{onClick:l,children:"Another Sample"})]})]})}function ws(){const t=ie("items-attributes"),r=ie("items-attribute-values"),[s,n]=v.useState(null),o=()=>{n(Ee(t.data,r.data))},i=()=>{const l={};let c=0;for(;c<300||x.keys(l).length===15;){const m=Ee(t.data,r.data);if(m.valid&&!l[m.setId]&&(l[m.setId]=m),x.keys(l).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(l).map((m,b)=>({...m,number:m.number-b})))};return e.jsxs("div",{className:"my-4",children:[e.jsx(O.Title,{level:3,children:"Daily Simulator"}),e.jsx(O.Paragraph,{children:"Generates a daily game for Alien Communication"}),e.jsxs($,{children:[e.jsx(P,{type:"primary",onClick:o,children:"Generate"}),e.jsx(P,{onClick:i,children:"Generate List"})]}),e.jsx("div",{children:!!s&&e.jsxs($,{direction:"vertical",children:[e.jsx(O.Title,{level:5,children:s==null?void 0:s.setId}),!(s!=null&&s.valid)&&e.jsx(Ze,{type:"error",message:"Invalid game"}),e.jsx($,{direction:"vertical",children:s==null?void 0:s.attributes.map(l=>e.jsxs(S,{gap:8,children:[e.jsx(q,{id:l.spriteId,width:50}),l.itemsIds.map(c=>e.jsx(ve,{id:c||"0",width:50},c))]},l.id))}),e.jsx(G,{className:"my-1"}),e.jsx($,{direction:"horizontal",children:s==null?void 0:s.requests.map(l=>e.jsxs(S,{vertical:!0,children:[e.jsx(q,{id:l.spritesIds[2],width:50}),e.jsx(q,{id:l.spritesIds[1],width:50}),e.jsx(q,{id:l.spritesIds[0],width:50})]},l.itemId))}),e.jsx(G,{className:"my-1"}),e.jsx($,{direction:"horizontal",children:s==null?void 0:s.itemsIds.map(l=>e.jsx(ve,{id:l||"0",width:50},l))})]},s==null?void 0:s.setId)})]})}const Ee=(t,r)=>{const s=x.values(t).filter(d=>!d.limited||d.id==="sol"),n=x.shuffle(x.values(r).filter(d=>d.complete)),o=x.shuffle(ct(38,0)),i=x.sampleSize(s,3).map(d=>({...d,spriteId:`${o.pop()}`})),l=[],c=[],m=[],b=[],a=[],u=[],j=[],h=[];n.forEach(d=>{const D=[w.DETERMINISTIC,w.RELATED],z=d.attributes[i[0].id]===w.DETERMINISTIC,N=D.includes(d.attributes[i[0].id]),E=d.attributes[i[0].id]===w.UNRELATED,T=d.attributes[i[1].id]===w.DETERMINISTIC,A=D.includes(d.attributes[i[1].id]),M=d.attributes[i[1].id]===w.UNRELATED,L=d.attributes[i[2].id]===w.DETERMINISTIC,B=D.includes(d.attributes[i[2].id]),H=d.attributes[i[2].id]===w.UNRELATED;if(E&&M&&H)return h.push(d.id);z&&M&&H&&l.push(d.id),E&&T&&H&&c.push(d.id),E&&M&&L&&m.push(d.id),N&&A&&H&&b.push(d.id),N&&M&&B&&a.push(d.id),E&&A&&B&&u.push(d.id),N&&A&&B&&j.push(d.id)});const p=i.map(d=>({id:d.id,name:d.name.pt,description:d.description.pt,spriteId:d.spriteId,itemsIds:[]}));p[0].itemsIds=x.sampleSize(l,l.length>3?3:Math.max(l.length-1,1)),p[1].itemsIds=x.sampleSize(c,c.length>3?3:Math.max(l.length-1,1)),p[2].itemsIds=x.sampleSize(m,m.length>3?3:Math.max(l.length-1,1));const g=[];p.forEach(d=>{g.push(...d.itemsIds)});const y=[];b.length>0&&y.push({spritesIds:[i[0].spriteId,i[1].spriteId],itemId:x.sample(b)??""}),a.length>0&&y.push({spritesIds:[i[0].spriteId,i[2].spriteId],itemId:x.sample(a)??""}),u.length>0&&y.push({spritesIds:[i[1].spriteId,i[2].spriteId],itemId:x.sample(u)??""}),j.length>0&&y.push({spritesIds:i.map(d=>d.spriteId),itemId:x.sample(j)??""});const I=[];l.length>0&&I.push({spritesIds:[i[0].spriteId],itemId:l.filter(d=>!g.includes(d))[0]}),c.length>0&&I.push({spritesIds:[i[1].spriteId],itemId:c.filter(d=>!g.includes(d))[0]}),m.length>0&&I.push({spritesIds:[i[2].spriteId],itemId:m.filter(d=>!g.includes(d))[0]}),console.log({attributeA:l,attributeB:c,attributeC:m,attributeAB:b,attributeAC:a,attributeBC:u,attributeABC:j}),console.log("COMPLEX REQUEST SIZE",y.length),console.log("SIMPLE REQUEST SIZE",I.length);let R=x.sampleSize(y,4);console.log("REQUEST SIZE",R.length),R.length<3&&R.push(...x.sampleSize(I,4-R.length)),R.length<4&&console.warn("Not enough requests"),R=x.shuffle(R);const f=R.map(d=>d.itemId),C={id:"2024-00-00",setId:p.map(d=>d.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:p,requests:R,solution:f.join("-"),itemsIds:x.shuffle([...f,h[0],h[1],h[2],h[3]]).filter(Boolean),valid:!1};return C.valid=[C.attributes.length===3,C.requests.length===4,C.itemsIds.length>5,C.attributes.every(d=>d.itemsIds.length>0),C.requests.every(d=>d.itemId)].every(Boolean),console.log(C),C},Ps=["","I","II","III","IV","V"];function Ns(){const{attributes:t,availableItemIds:r,getItemAttributeValues:s,getItem:n}=U(),{message:o}=ge.useApp(),[i,l]=v.useState(25),[c,m]=v.useState(80),[b,a]=v.useState(!1),[u,j]=v.useState([]),[h,p]=v.useState([]),[g,y]=v.useState(null),[I,R]=v.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),f=()=>{const d={},D=x.shuffle(r);for(;Object.values(d).length<i;){const T=D.pop();if(!T)break;const A=s(T);A&&(!A.complete||!A.reliability||A.reliability<c||!b&&n(T).nsfw||(A.signature&&!d[A.signature]?d[A.signature]=T:console.log("Item has identical key to another item. Skipping.",n(T).name.en)))}const z=Object.values(d);z.length<i&&o.error(`Could not generate sample. Got only ${z.length} items`),j(x.sortBy(z,T=>Number(T)));const N=Rs(z.map(T=>s(T)),25,t);if(N.length<25){const T=x.keys(t).filter(L=>!N.includes(L)),M=x.sortBy(T,L=>t[L].priority).slice(0,25-N.length);console.log("Adding more attributes by priority",M),N.push(...M)}const E=N.reduce((T,A)=>(z.forEach(M=>{const L=s(M);if(L)switch(L.attributes[A]){case w.RELATED:T.relatedCount[A]=(T.relatedCount[A]||0)+1;break;case w.DETERMINISTIC:T.deterministicCount[A]=(T.deterministicCount[A]||0)+1;break;case w.UNCLEAR:T.unclearCount[A]=(T.unclearCount[A]||0)+1;break;case w.OPPOSITE:T.oppositeCount[A]=(T.oppositeCount[A]||0)+1;break}}),T),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});p(N.sort().map(T=>({...t[T],relatedCount:E.relatedCount[T],deterministicCount:E.deterministicCount[T],unclearCount:E.unclearCount[T],oppositeCount:E.oppositeCount[T]})))},C=d=>{R(D=>({...D,[d]:!D[d]}))};return e.jsxs("div",{className:"my-4",children:[e.jsx(O.Title,{level:3,children:"Simulator"}),e.jsx(O.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(se,{label:"Grid Size",value:i,onChange:d=>l(d),options:[16,25]}),e.jsx(we,{label:"Reliability Threshold",value:c,onChange:d=>m(d),step:5,min:10,max:100}),e.jsx(Q,{label:"NSFW",value:b,onChange:a}),e.jsx(P,{onClick:f,type:"primary",children:"Get Sample Board"})]}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(ce,{label:"Show Id",value:!!I.id,onChange:()=>C("id")}),e.jsx(ce,{label:"Show Name (EN)",value:!!I.nameEn,onChange:()=>C("nameEn")}),e.jsx(ce,{label:"Show Name (PT)",value:!!I.namePt,onChange:()=>C("namePt")}),e.jsx(ce,{label:"Show Reliability",value:!!I.reliability,onChange:()=>C("reliability")})]}),e.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(i)}, 1fr)`},children:u.map(d=>{const D=n(d),z=s(d);return e.jsxs($,{direction:"vertical",className:de("simulator-grid__entry",g&&z.attributes[g]>0&&"simulator-grid__entry--highlighted"),align:"center",children:[e.jsxs($,{children:[e.jsxs(S,{vertical:!0,children:[I.id&&e.jsx(X,{item:D}),I.reliability&&e.jsx("span",{children:e.jsx(st,{prefix:e.jsx(Gt,{}),placeholder:"Reliability",variant:"borderless",size:"small",value:z.reliability,readOnly:!0,style:{width:"8ch"},formatter:N=>`${N}%`})}),I.id&&e.jsx(le,{item:D})]}),e.jsx(W,{item:D,width:50})]}),I.nameEn&&e.jsx(F,{item:D,language:"en"}),I.namePt&&e.jsx(F,{item:D,language:"pt"})]},d)})}),e.jsx("div",{className:"simulator-grid my-4",children:h.map(d=>e.jsxs(wt,{className:de("simulator-grid__entry","simulator-grid__button",g===d.id&&"simulator-grid__entry--highlighted"),onClick:()=>y(d.id),children:[d.name.en," ",Ps[d.level],e.jsxs(S,{gap:6,justify:"center",className:"my-1",children:[e.jsxs("span",{children:[e.jsx(Ot,{style:{color:d.deterministicCount?"dodgerblue":void 0}})," ",d.deterministicCount??0]}),e.jsxs("span",{children:[e.jsx(vt,{style:{color:d.relatedCount?"green":void 0}})," ",d.relatedCount??0]}),e.jsxs("span",{children:[e.jsx(kt,{style:{color:d.oppositeCount?"red":void 0}})," ",d.oppositeCount??0]}),e.jsxs("span",{children:[e.jsx(Re,{style:{color:d.unclearCount?"gold":void 0}})," ",d.unclearCount??0]})]})]},d.id))}),e.jsx(ws,{})]})}function Rs(t,r,s){const n={},o={};t.forEach(p=>{p&&Object.keys(p.attributes).forEach(g=>{p.attributes[g]>0&&(n[g]=(n[g]||0)+1),p.attributes[g]===w.DETERMINISTIC&&(o[g]=!0,n[g]=(n[g]||0)+2),p.attributes[g]===w.OPPOSITE&&(n[g]=(n[g]||0)+1)})});const i={1:0,2:0,3:0,4:0};function l(p){return p.filter(g=>(i[s[g].level]++,i[4]>1?(console.log("Discarding level 4 attribute",g),!1):!0))}const c=l(Object.keys(o)),m=l(x.keys(n).filter(p=>!c.includes(p)));if(console.log({levelCount:i}),r===c.length)return console.log("All keys are deterministic"),c;if(console.log(n),c.length===0)return[];const b=c.reduce((p,g)=>{const y=n[g];return p[y]||(p[y]=[]),p[y].push(g),p},{}),a=x.keys(b).sort((p,g)=>Number(g)-Number(p));console.log({sortedDeterministicTiedGroupsKeys:a});const u=m.reduce((p,g)=>{const y=n[g];return p[y]||(p[y]=[]),p[y].push(g),p},{});console.log(u);const j=x.keys(u).sort((p,g)=>Number(g)-Number(p)),h=[];for(const p of a){if(h.length===r)break;h.push(...x.sampleSize(b[p],r-h.length))}for(const p of j){if(h.length===r)break;h.push(...x.sampleSize(u[p],r-h.length))}return h}function Ls(){const{attributes:t}=U(),r=[{key:"1",label:"All Attributes",children:e.jsx(ee,{type:"all"})},{key:"2",label:"Default",children:e.jsx(ee,{type:"default"})},{key:"3",label:"Custom",children:e.jsx(ee,{type:"custom"})},{key:"4",label:"Limited",children:e.jsx(ee,{type:"limited"})},{key:"5",label:"Specific",children:e.jsx(ee,{type:"specific"})},{key:"6",label:"Opposite",children:e.jsx(ee,{type:"opposite"})}];return e.jsxs("div",{className:"my-4",children:[e.jsxs(S,{justify:"space-between",align:"center",children:[e.jsx(O.Title,{level:5,children:"Stats"}),e.jsx(Pe,{data:()=>Us(t),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),e.jsx(gt,{defaultActiveKey:"1",items:r})]})}const Os=(t,r)=>{let s=0,n=0,o=0,i=0,l=0,c=0,m=0,b=0;r.forEach(({attributes:f})=>{if(f[t.id]){s++;const C=f[t.id];C===10?n++:C===5?o++:C===0||!C?i++:C===-1?l++:C===-3?c++:C===-10&&m++,C>0&&b++}});const a=r.length,u=s/a*100,j=n/a*100,h=o/a*100,p=i/a*100,g=l/a*100,y=c/a*100,I=m/a*100,R=b/a*100;return{completionPercentage:u.toFixed(1),tensPercentage:j.toFixed(1),fivesPercentage:h.toFixed(1),zerosPercentage:p.toFixed(1),negativeOnesPercentage:g.toFixed(1),negativeThreesPercentage:y.toFixed(1),negativeTensPercentage:I.toFixed(1),positivePercentage:R.toFixed(1)}};function ee({type:t}){const{availableItemIds:r,getItemAttributeValues:s,attributesList:n}=U(),o=We(),{is:i}=xe(),l=v.useMemo(()=>{const a=new Array(65).fill(0).map((j,h)=>h),u=n.map(j=>j.spriteId);return a.filter(j=>!u.includes(`sign-${j}`))},[n]),c=v.useMemo(()=>t==="default"?n.filter(a=>a.default):t==="custom"?n.filter(a=>!a.default):t==="limited"?n.filter(a=>a.limited):t==="specific"?n.filter(a=>a.specific):t==="opposite"?n.filter(a=>a.oppositeId):n,[n,t]),m=v.useMemo(()=>{const a=r.map(u=>s(u));return c.map(u=>({...u,...Os(u,a)}))},[c,r,s]),b=[{title:"Attribute",dataIndex:"name",key:"name",render:(a,u)=>e.jsxs(S,{align:"center",gap:8,children:[i("showGlyphs")&&e.jsx(q,{id:u.spriteId,width:30}),a.en,u.default&&e.jsx(ne,{className:"ml-1",children:"default"}),u.limited&&e.jsx(ne,{className:"ml-1",children:"limited"}),(u.specific||u.parentId)&&e.jsx(ne,{className:"ml-1",children:"specific"}),u.oppositeId&&e.jsx(ne,{className:"ml-1",children:e.jsx(Xe,{})}),e.jsx(_e,{title:u.description.en})]}),sorter:(a,u)=>a.name.en.localeCompare(u.name.en)},{title:e.jsx(Pt,{}),dataIndex:"spriteId",key:"spriteId",render:a=>e.jsx(q,{id:a,width:18,padding:0})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(a,u)=>a.priority-u.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.positivePercentage)-Number.parseFloat(u.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(a,u)=>u.limited?"-":`${a}%`,sorter:(a,u)=>Number.parseFloat(a.tensPercentage)-Number.parseFloat(u.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.fivesPercentage)-Number.parseFloat(u.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeOnesPercentage)-Number.parseFloat(u.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeThreesPercentage)-Number.parseFloat(u.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeTensPercentage)-Number.parseFloat(u.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:a=>e.jsx(Le,{percent:Number.parseFloat(a),size:"small"}),sorter:(a,u)=>Number.parseFloat(a.completionPercentage)-Number.parseFloat(u.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:a=>e.jsx(Nt,{count:4,value:a,disabled:!0}),sorter:(a,u)=>a.level-u.level},{title:"Actions",key:"actions",render:a=>e.jsx($,{children:e.jsxs(P.Group,{children:[e.jsx(P,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=grouping&attribute=${a.id}&page=1`),children:"Grouping"}),e.jsx(P,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=sampler&attribute=${a.id}&size=6`),children:"Sample"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(O.Paragraph,{children:["Total: ",m.length]}),e.jsx(Oe,{columns:b,dataSource:m,pagination:!1,rowKey:"id",size:"small"}),e.jsx(S,{wrap:"wrap",gap:8,children:l.map(a=>e.jsxs("div",{children:["#",a,e.jsx(q,{id:`sign-${a}`},a)]},a))})]})}function Us(t){const r=x.cloneDeep(t);return fe(Ne(r),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Ds(){const{view:t}=V();return t==="classifier"?e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"my-4",gap:8,children:[e.jsx(bs,{}),e.jsx(Is,{}),e.jsx(vs,{})]}),e.jsx(xs,{}),e.jsx(S,{justify:"flex-end",className:"my-4",children:e.jsx($e,{})})]}):t==="sampler"?e.jsx(Ss,{}):t==="grouping"?e.jsx(Es,{}):t==="comparator"?e.jsx(As,{}):t==="simulator"?e.jsx(Ns,{}):t==="stats"?e.jsx(Ls,{}):e.jsx(ae,{className:"my-10",description:"Unknown view has been selected"})}function Vs(){const{isLoading:t,error:r,hasResponseData:s}=U();return e.jsx(et,{title:"Items",subtitle:"Attribution",children:e.jsxs(je,{hasSider:!0,children:[e.jsx(pt,{children:e.jsx(ms,{})}),e.jsx(je.Content,{className:"content",children:e.jsx(tt,{isLoading:t,error:r,hasResponseData:s,children:e.jsx(Ds,{})})})]})})}function kr(){return e.jsx(is,{children:e.jsx(Vs,{})})}export{kr as default};
