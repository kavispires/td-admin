import{r as j,a as J,_ as W,N as Ke,ag as qe,W as he,V as He,j as e,T as D,D as G,B as P,Q as Ye,w as we,ad as ue,ah as Je,ai as We,ae as fe,aj as Ze,ak as Xe,al as et,P as tt,L as Ie}from"./index-BZlgVGyQ.js";import{D as st}from"./DataLoadingWrapper-BdBJ8MHz.js";import{c as Q,a as se,b as Ne,d as ce,T as rt}from"./FilterEntries-DOUp0Wt4.js";import{S as nt}from"./SiderContent-CJEv_zZp.js";import{D as Pe}from"./DownloadButton-BN5Z1CNS.js";import{S as it}from"./SaveButton-Btowi3Fc.js";import{l as f}from"./lodash-C-CNgKU_.js";import{A as k,d as w,e as at,f as q}from"./constants--noGxxjp.js";import{e as lt,g as ot,a as xe,d as Re,w as ct,m as ut}from"./index-DSRbwsOq.js";import{u as dt}from"./useGetFirebaseDoc-B_niq1mS.js";import{u as ie}from"./useTDResource-DknGbtCY.js";import{u as mt}from"./useUpdateFirebaseDoc-DTMj9F0I.js";import{T as ne}from"./index-U_E-9KC3.js";import{F as S}from"./index-D7ssyPOH.js";import{R as pt}from"./VerticalAlignTopOutlined-C-xr0q5t.js";import{I as Z,a as X,b as B,c as le}from"./ItemBuildingBlocks-D16D6jJx.js";import{a as Le}from"./index-CRRJORQS.js";import{R as ve}from"./index-C1yscgmY.js";import{c as de,E as ae,P as gt}from"./useBaseUrl-DfdTaQhG.js";import{I as ye}from"./Item-i8IR1ffc.js";import{P as Oe}from"./progress-BNBrWQg4.js";import{C as Y}from"./index-CAEa4a2p.js";import{A as ht}from"./index-BrStD7AF.js";import{S as $}from"./index-BgmHRj3u.js";import{u as be}from"./useQueryParams-SxpUkNbA.js";import{I as ft}from"./ItemsTypeahead-DT7ybRLb.js";import{R as xt,a as bt,P as jt}from"./Pagination-CCO_kDKt.js";import{S as te}from"./index-DAAN8KO-.js";import{R as It,F as De,a as vt}from"./Table-Dky-jnHG.js";import{D as yt}from"./index-DNIXPw_l.js";import{S as At}from"./index-D2ShRf9Y.js";import{P as Ct}from"./index-vAgVumoY.js";import{u as Tt}from"./useToggle-CcNTKhrs.js";import{M as Et}from"./index-DVe6Ar9s.js";import{T as St}from"./TransparentButton-iiuSTFm_.js";import{T as wt}from"./index-CbZFFArY.js";import{R as Nt}from"./SkinOutlined-CvVSZWVr.js";import{R as Pt}from"./index-Bb1lpkSM.js";import"./index-C7OCW9Iw.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-yncQWwYq.js";import"./useMutation-SpvvL0jG.js";import"./gapSize-U1swVQyS.js";import"./LanguageFlag-EHBDUfga.js";import"./useCopyToClipboardFunction-B_oksN_x.js";import"./index-Bqgz6ppr.js";import"./Input-BKtyPqwb.js";import"./FireFilled-oR0rDV-w.js";import"./IdcardOutlined-xp4GWKkG.js";import"./throttleByAnimationFrame-RU6zNSdY.js";import"./useDebounce-CqWLOG1u.js";import"./index-7EuvvQI3.js";import"./scrollTo-CznnqliU.js";import"./extendsObject-keMuGWqj.js";import"./PlusOutlined-Crih-cvM.js";var Rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"},Lt=function(n,s){return j.createElement(J,W({},n,{ref:s,icon:Rt}))},Ot=j.forwardRef(Lt),Dt={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},Ut=function(n,s){return j.createElement(J,W({},n,{ref:s,icon:Dt}))},Ae=j.forwardRef(Ut),Mt={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},Vt=function(n,s){return j.createElement(J,W({},n,{ref:s,icon:Mt}))},kt=j.forwardRef(Vt),Ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},zt=function(n,s){return j.createElement(J,W({},n,{ref:s,icon:Ft}))},Bt=j.forwardRef(zt),$t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},_t=function(n,s){return j.createElement(J,W({},n,{ref:s,icon:$t}))},Gt=j.forwardRef(_t),Qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},Kt=function(n,s){return j.createElement(J,W({},n,{ref:s,icon:Qt}))},qt=j.forwardRef(Kt),Ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Yt=function(n,s){return j.createElement(J,W({},n,{ref:s,icon:Ht}))},Jt=j.forwardRef(Yt),Wt=function(t,n){return Ke?window.matchMedia(t).matches:!1},Zt=function(t,n){var s=j.useState(Wt(t)),i=s[0],o=s[1];return j.useEffect(function(){var r=!0,l=window.matchMedia(t),c=function(){r&&o(!!l.matches)};return l.addEventListener("change",c),o(l.matches),function(){r=!1,l.removeEventListener("change",c)}},[t]),i};const Ue={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};f.keyBy(Ue,"prefix");const Xt=["*","^","+","~","!"],K={ATTRIBUTE_VALUE_DICT:Ue,ATTRIBUTE_VALUE_PRIORITY:Xt},me=(t={})=>f.cloneDeep(f.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},t)),pe=(t={})=>f.cloneDeep(f.merge({id:"",attributes:{}},t)),Me=(t,n,s)=>{const i=f.orderBy(Object.values(n),["priority","id"],["asc","asc"]).map(a=>a.id);function o(a,u){return f.orderBy(a,b=>i.indexOf(b),["asc"]).map(b=>`${u}${b}`)}const r=[],l=[],c=[],m=[],x=[];return Object.entries(t.attributes).forEach(([a,u])=>{if(n[a])switch(u){case w.OPPOSITE:r.push(a);break;case w.DETERMINISTIC:l.push(a);break;case w.RELATED:c.push(a);break;case w.UNRELATED:m.push(a);break;case w.UNCLEAR:x.push(a);break;default:x.push(a);break}}),[...o(r,k.OPPOSITE),...o(l,k.DETERMINISTIC),...o(c,k.RELATED),...o(m,k.UNRELATED),...o(x,k.UNCLEAR)]},Ve=f.memoize(t=>{if(t.length===3)return{key:t,className:"",text:""};const n=t[0];return{key:t.slice(1,4),className:{[k.DETERMINISTIC]:"deterministic",[k.UNRELATED]:"unrelated",[k.UNCLEAR]:"unclear",[k.OPPOSITE]:"opposite"}[n],text:{[k.DETERMINISTIC]:"very",[k.UNRELATED]:"not",[k.UNCLEAR]:"maybe",[k.OPPOSITE]:"very not"}[n]}}),ke=(t,n,s)=>t.filter(i=>!(!n&&i.includes(k.UNCLEAR)||!s&&i.includes(k.UNRELATED)));function ge(t,n,s){const i=[];for(const[l,c]of Object.entries(t.attributes)){const m=n[l];if(m){const x=Object.values(K.ATTRIBUTE_VALUE_DICT).find(a=>a.value===c);x&&i.push({prefix:x.prefix,id:m.id,priority:m.priority})}}const o=f.sortBy(i,[l=>K.ATTRIBUTE_VALUE_PRIORITY.indexOf(l.prefix),l=>l.prefix===K.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:l.priority,["asc","asc"]]),r=s!=null&&s.length?o.slice(0,s==null?void 0:s.length):o;return s!=null&&s.onlyRelevant?r.filter(l=>[K.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,K.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(l.prefix)).map(l=>`${l.prefix}${l.id}`).join(""):r.map(l=>`${l.prefix}${l.id}`).join((s==null?void 0:s.delimiter)??"")}const es=f.keyBy(K.ATTRIBUTE_VALUE_DICT,"prefix");function ts(t){return(t.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((s,i)=>{const o=i[0],r=i.slice(1),l=es[o].value;return s[r]=l,s},{})}function Fe(t){return Object.values(t.attributes).reduce((n,s)=>s<=0?(s===K.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(n+=s/2),n):n+s,0)}function ze(t,n){const s=Object.values(t.attributes).filter(i=>i===K.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((n-s)/n*100)}function V(){const[t,n]=qe(),s=(o,r)=>{t.set(o,`${r}`),n(t)},i=o=>{t.delete(o),n(t)};return{view:t.get("view")??"classifier",setView:o=>n({view:o}),addQueryParam:s,removeQueryParam:i,searchParams:t}}const re={};function ss(){const{notification:t,message:n}=he.useApp(),s=He(),i=ie("items"),o=ie("items-attributes"),r=ie("items-attribute-values"),l=dt("tdr","itemsAttributeValues",{select:I=>ns({itemAttributesValues:I,itemAttributes:o.data??{}})}),[c,m]=j.useState({}),x=mt("tdr","itemsAttributeValues",{onSuccess:()=>{t.success({message:"itemsAttributeValues updated"}),s.refetchQueries({queryKey:["firebase","tdr","itemsAttributeValues"]}),m({})},onError:I=>{t.error({message:"itemsAttributeValues update failed",description:I.message})}}),a=j.useMemo(()=>({...r.data??{},...l.data??{}}),[r.data,l.data]),u=!f.isEmpty(c),b=(I,y)=>{m(d=>({...d,[I]:{...y,updatedAt:Date.now()}}))},h=I=>{m(y=>({...y,...f.mapKeys(I.map(d=>({...d,updatedAt:Date.now()})),"id")}))},p=l.data,g=()=>{x.mutate(rs({...p,...c},o.data))};return{availableItemIds:j.useMemo(()=>{const I=i.data??{};return f.orderBy(Object.keys(I).filter(y=>{var d;return(((d=I[y])==null?void 0:d.decks)??[]).includes("alien")}),y=>Number(y),"asc")},[i.data]),getItem:I=>{var y;return(y=i.data)!=null&&y[I]?i.data[I]:(I&&n.info(`Item ${I} not found in TDR. Creating a new item...`),me({id:I}))},getItemAttributeValues:I=>{const y=(a==null?void 0:a[I])??{},d=c[I]??{};return f.isEmpty(y)&&f.isEmpty(d)?(re[I]=pe({id:I}),re[I]):f.merge((re==null?void 0:re[I])??{},y,d)},attributes:o.data??{},isLoading:i.isLoading||o.isLoading||r.isLoading||l.isLoading,error:i.error||o.error||r.error||l.error,firebaseData:p,hasFirestoreData:!f.isEmpty(l.data),isSaving:x.isPending,save:g,addAttributesToUpdate:b,addMultipleAttributesToUpdate:h,attributesToUpdate:c,isDirty:u}}const rs=(t,n)=>ot(t,i=>({id:i.id,tempSignature:ge(i,n),updatedAt:i.updatedAt})),ns=t=>{const{itemAttributesValues:n,itemAttributes:s}=t,i=Object.keys(s).length;return lt(n,r=>{const l=ts(r.tempSignature),c=Object.keys(l).length===i,m={id:r.id,updatedAt:r.updatedAt,attributes:l};return c?{...m,complete:c,reliability:ze(m,i),score:Fe(m)}:m})},Be=j.createContext({getItem:()=>me(),getItemAttributeValues:()=>pe(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:me(),itemAttributeValues:pe(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{},hasFirestoreData:!1}),is=({children:t})=>{const{getItem:n,getItemAttributeValues:s,availableItemIds:i,isLoading:o,error:r,isSaving:l,save:c,addAttributesToUpdate:m,isDirty:x,attributes:a,addMultipleAttributesToUpdate:u,attributesToUpdate:b,hasFirestoreData:h}=ss(),{message:p}=he.useApp(),g=j.useMemo(()=>f.orderBy(Object.values(a),"name.en","asc"),[a]),{searchParams:C}=V(),A=C.get("sortBy"),T=j.useMemo(()=>A==="id"?f.orderBy(i,v=>Number(v),"asc"):A==="updatedAt"?f.orderBy(i,v=>s(v).updatedAt,"desc"):A==="fewestAttributesLeft"?f.orderBy(i,v=>{const E=g.length-Object.keys(s(v).attributes).length;return E===0?Number.POSITIVE_INFINITY:E},"asc"):i,[i,A]),[I,y]=j.useState(f.random(0,T.length-1)),d=n(T[I]),M=s(d.id),F=(v,E)=>{if(v==="next"){y(N=>(N+1)%T.length);return}if(v==="previous"){y(N=>(N-1+T.length)%T.length);return}if(v==="random"){y(f.random(0,T.length-1));return}if(v==="first"){y(0);return}if(v==="last"){y(T.length-1);return}if(v==="next10"){y(N=>(N+10)%T.length);return}if(v==="previous10"){y(N=>(N-10+T.length)%T.length);return}if(v==="incomplete"){y(N=>{let L=N+1;for(;L<T.length;){const z=s(T[L]);if(Object.keys(z.attributes).length!==g.length)return L;if(L===T.length-1)return p.info("No more incomplete items found."),N;L++}return N});return}if(v==="goTo"&&E!==void 0){const N=T.indexOf(E);if(N!==-1){y(N);return}p.error(`Item ${E} is not available for attribution.`)}},R=(v,E)=>{m(d.id,{...M,attributes:{...M.attributes,[v]:E}})},O=()=>xe(i.reduce((v,E)=>{const N=s(E);return f.isEmpty(N.attributes)||(Object.keys(N.attributes).length===g.length?N.complete=!0:delete N.complete,v[N.id]=N),v},{}));return e.jsx(Be.Provider,{value:{getItem:n,getItemAttributeValues:s,availableItemIds:i,isLoading:o,error:r,hasResponseData:i.length>0&&!f.isEmpty(a),isDirty:x,itemAttributeValues:M,jumpToItem:F,activeItem:d,onAttributeChange:R,isSaving:l,save:c,attributes:a,attributesList:g,addAttributesToUpdate:m,addMultipleAttributesToUpdate:u,prepareItemsAttributesFileForDownload:O,attributesToUpdate:b,hasFirestoreData:h},children:t})},U=()=>j.useContext(Be);function _({label:t,children:n}){return e.jsxs(D.Text,{children:[t," ",e.jsx(ne,{children:n})]})}function as(){const{getItemAttributeValues:t,availableItemIds:n,attributesList:s}=U(),{total:i,complete:o,completionPercentage:r,hasDataCount:l,initiatedPercentage:c,progress:m,progressTotal:x,currentProgress:a}=j.useMemo(()=>{const u=n.length;let b=0,h=0,p=0;n.map(A=>t(A)).forEach(({attributes:A})=>{f.isEmpty(A)||(b+=1),Object.values(A).length===s.length&&(h+=1),p+=Object.values(A).length});const C=Object.values(s).length*n.length;return{total:u,complete:h,completionPercentage:u>0?(h/u*100).toFixed(1):0,hasDataCount:b,initiatedPercentage:u>0?Math.floor(b/u*100):0,progress:(p/C*100).toFixed(1),currentProgress:p,progressTotal:C}},[s,n,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{vertical:!0,children:[e.jsx(D.Text,{strong:!0,className:"mb-2",children:"Items Stats"}),e.jsx(_,{label:"Total",children:i}),e.jsxs(_,{label:"Complete",children:[o," (",r,"%)"]}),e.jsxs(_,{label:"Initiated",children:[l," (",c,"%)"]}),e.jsx(D.Text,{strong:!0,className:"mt-4 mb-2",children:"Attributes Stats"}),e.jsx(_,{label:"Total",children:x}),e.jsx(_,{label:"Set",children:a}),e.jsxs(_,{label:"Progress",children:[m,"%"]})]}),e.jsx(G,{})]})}function ls(){const{jumpToItem:t}=U(),{searchParams:n,addQueryParam:s}=V();return e.jsxs(e.Fragment,{children:[e.jsx(P,{block:!0,onClick:()=>t("random"),type:"primary",children:"Random Item"}),e.jsx(Q,{label:"Unset Only",value:n.get("scope")==="unset",onChange:i=>s("scope",i?"unset":""),className:"mt-4"})]})}function os(){const{searchParams:t,addQueryParam:n}=V(),{attributesList:s}=U(),i=j.useMemo(()=>[{label:"Random Attribute",value:"random"},...s.map(({id:o,name:r})=>({label:r.en,value:o}))],[s]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Sampler Attribute",value:t.get("attribute")||"random",onChange:o=>n("attribute",o),options:i}),e.jsx(Ne,{label:"Sample Size",value:Number(t.get("size")||9),onChange:o=>n("size",String(o)),min:3,max:21,step:3})]})}function cs(){const{searchParams:t,addQueryParam:n}=V(),{attributesList:s}=U(),i=j.useMemo(()=>s.map(({id:o,name:r,...l})=>({label:`${r.en}${l.default?"*":""}`,value:o})),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{label:"Attribute",value:t.get("attribute")||"ali",onChange:o=>n("attribute",o),options:i}),e.jsx(se,{label:"Scope",value:t.get("scope")||"unset",onChange:o=>n("scope",o),options:[{value:"unset",label:"Unset"},...at]}),e.jsx(se,{label:"Results per page",value:t.get("pageSize")||12,onChange:o=>n("pageSize",o),options:[12,24,48,96]})]})}function us(){const{searchParams:t,addQueryParam:n}=V();return e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"Only Complete",value:t.get("showComplete")==="true",onChange:s=>n("showComplete",s?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unrelated",value:t.get("showUnrelated")==="true",onChange:s=>n("showUnrelated",s?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unclear",value:t.get("showUnclear")==="true",onChange:s=>n("showUnclear",s?"true":""),className:"full-width m-0"})]})}function ds(){const{searchParams:t,addQueryParam:n}=V();return e.jsx(e.Fragment,{children:e.jsx(Q,{label:"Show Glyphs",value:t.get("showGlyphs")==="true",onChange:s=>n("showGlyphs",s?"true":""),className:"full-width m-0"})})}function ms(){const{isDirty:t,save:n,prepareItemsAttributesFileForDownload:s,attributes:i,isSaving:o,attributesToUpdate:r,hasFirestoreData:l}=U(),{view:c,setView:m}=V();return e.jsxs(nt,{children:[e.jsxs(S,{vertical:!0,gap:12,children:[e.jsx(it,{isDirty:t,onSave:n,isSaving:o,dirt:JSON.stringify(r)}),e.jsx(Pe,{data:()=>ps(s(),i),fileName:"items-attribute-values.json",disabled:t,hasNewData:l,block:!0})]}),e.jsx(G,{}),e.jsx(as,{}),e.jsx(se,{label:"View",value:c,onChange:m,options:["classifier","sampler","grouping","comparator","simulator","stats"]}),e.jsx(G,{}),c==="classifier"&&e.jsx(ls,{}),c==="sampler"&&e.jsx(os,{}),c==="grouping"&&e.jsx(cs,{}),c==="comparator"&&e.jsx(us,{}),c==="stats"&&e.jsx(ds,{})]})}function ps(t,n){const s=Object.keys(n).length;Object.keys(t).forEach(o=>{const r=t[o],l=Object.keys(r.attributes);l.forEach(m=>{n[m]||delete r.attributes[m]}),l.length===s?(r.complete=!0,r.score=Fe(r),r.reliability=ze(r,s),r.signature=ge(r,n,{onlyRelevant:!0})):(r.complete=void 0,r.score=void 0,r.reliability=void 0,r.signature=void 0)});const i={};return Object.values(t).forEach(o=>{i[o.id]={id:o.id,updatedAt:o.updatedAt,signature:ge(o,n,{delimiter:":"})},o.complete&&(i[o.id].complete=o.complete)}),console.log(i),xe(Re(t))}function $e(t){const[n,s]=j.useState(!1),i=()=>{s(window.scrollY>300)},o=()=>{window.scrollTo({top:0,behavior:"smooth"})};return Ye(()=>(window.addEventListener("scroll",i),()=>{window.removeEventListener("scroll",i)})),e.jsx(P,{className:`go-to-top-button ${n?"visible":""}`,onClick:o,icon:e.jsx(pt,{}),...t,children:"Go to Top"})}function _e({title:t,icon:n}){return e.jsx(we,{title:t,children:n??e.jsx(Le,{})})}const Ce=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC}],Te=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC,disabled:!0}];function oe({attribute:t,value:n,onChange:s,onlyButtons:i,size:o}){return t?i?e.jsx(ve.Group,{options:t.limited?Te:Ce,onChange:({target:{value:r}})=>s(t.id,r),value:n,optionType:"button",buttonStyle:"solid",size:o}):e.jsxs("div",{className:"attribute-button-container__row",children:[e.jsxs("span",{className:"attribute-button-container__label",children:[f.truncate(t.name.en,{length:12})," ",e.jsx(_e,{title:t.description.en})]}),e.jsx(ve.Group,{options:t.limited?Te:Ce,onChange:({target:{value:r}})=>s(t.id,r),value:n,optionType:"button",buttonStyle:"solid",size:o}),e.jsx("span",{children:e.jsx(ue,{style:{color:n&&n>7?"green":"transparent"}})})]},t.id):e.jsx(e.Fragment,{})}function gs({itemAttributeValues:t,attributes:n}){const{searchParams:s,addQueryParam:i}=V(),o=s.get("showUnclear")==="true",r=s.get("showUnrelated")==="true",l=j.useMemo(()=>ke(Me(t,n),o,r),[t,n,o,r]),c=s.get("signs")==="true"?Ge:hs;return e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(Q,{label:"Show Unrelated",value:s.get("showUnrelated")==="true",onChange:m=>i("showUnrelated",m?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Show Unclear",value:s.get("showUnclear")==="true",onChange:m=>i("showUnclear",m?"true":""),className:"full-width m-0"}),e.jsx(Q,{label:"Alien Sings",value:s.get("signs")==="true",onChange:m=>i("signs",m?"true":""),className:"full-width m-0"}),e.jsx(S,{gap:6,wrap:"wrap",className:"item-attribute-value-statement",children:l.map((m,x,a)=>e.jsx(c,{keyVariant:m,attributes:n,firstElement:x===0,lastElement:x===a.length-1},m))})]})}function Ge({keyVariant:t,attributes:n,withText:s}){const{key:i,className:o,text:r}=Ve(t);return e.jsxs(S,{vertical:!0,align:"center",children:[e.jsx(q,{width:50,id:n[i].spriteId,className:de("item-attribute-alien-sign",`item-attribute-alien-sign--${o}`)}),s&&e.jsxs(S,{wrap:"wrap",justify:"center",align:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},children:[r," ",n[i].name.en.toLowerCase()]})]})}function hs({keyVariant:t,attributes:n,firstElement:s,lastElement:i}){const{key:o,text:r}=Ve(t),l=s?"It's ":"",c=i?".":", ";return e.jsxs(e.Fragment,{children:[l,r," ",n[o].name.en.toLowerCase(),c]})}function fs({attributesList:t,itemAttributeValues:n}){const{completion:s,isDeterministic:i,value:o,isOpposing:r,relevancy:l}=j.useMemo(()=>{const c=t.length,m=Object.keys(n.attributes).length,x=Math.floor(m/c*100);let a=!1,u=!1,b=0;const h=Object.values(n.attributes).reduce((g,C)=>C<=0?(C===w.UNCLEAR&&(b+=1),C===w.OPPOSITE&&(u=!0,g+=C/2),g):(C===w.DETERMINISTIC&&(a=!0),g+C),0),p=Math.floor((m-b)/c*100);return{completion:x,isDeterministic:a,value:h,isOpposing:u,relevancy:p}},[t,n.attributes]);return e.jsxs("div",{children:[e.jsx(D.Text,{strong:!0,children:"Completion"}),e.jsx(Oe,{percent:s,size:"small"}),e.jsx(D.Text,{strong:!0,children:"Stats"}),e.jsxs(S,{vertical:!0,children:[e.jsx(_,{label:"Deterministic",children:i?e.jsx(ue,{style:{color:"green"}}):e.jsx(Ae,{style:{color:"red"}})}),e.jsx(_,{label:"Opposing",children:r?e.jsx(ue,{style:{color:"CornflowerBlue"}}):e.jsx(Ae,{style:{color:"grey"}})}),e.jsx(_,{label:"Value",children:o}),e.jsx(we,{title:"The percentage of conclusive attributes (not unclear)",children:e.jsxs(_,{label:"Reliability",children:[l,"%"]})})]})]})}function xs(){const{activeItem:t,attributesList:n,itemAttributeValues:s,onAttributeChange:i,jumpToItem:o,attributes:r}=U(),{searchParams:l,removeQueryParam:c}=V(),m=l.get("itemId"),x=l.get("filters");j.useEffect(()=>{m&&(c("itemId"),o("goTo",m))},[m,o,c]);const a=l.get("scope")==="unset",u=j.useMemo(()=>{const b=a?n.filter(h=>!s.attributes[h.id]):n;if(x){const h=x.split(",").reduce((p,g)=>(p[g]=!0,p),{});return b.filter(p=>h[p.id])}return b},[a,t.id,x]);return t?e.jsx(Y,{children:e.jsxs("div",{className:"item-attribution-card",children:[e.jsx(ht,{offsetTop:120,className:"item-attribution-card__item",children:e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(Z,{item:t,width:150}),e.jsx(X,{item:t}),e.jsx(B,{item:t,language:"en"}),e.jsx(B,{item:t,language:"pt"}),e.jsx(G,{className:"my-2"}),e.jsx(fs,{attributesList:n,itemAttributeValues:s}),e.jsx(G,{className:"my-2"}),e.jsx(D.Text,{type:"secondary",children:e.jsx(gs,{itemAttributeValues:s,attributes:r})})]})}),e.jsx($,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(b=>e.jsx(oe,{attribute:b,value:s.attributes[b.id],onChange:i},b.id))})]},`${t.id}`)}):e.jsx(Y,{children:e.jsxs(D.Text,{type:"secondary",children:["No item selected."," ",e.jsx(P,{size:"small",type:"primary",onClick:()=>o("random"),children:"Random Item"})]})})}function bs(){const{jumpToItem:t}=U();return e.jsxs($.Compact,{children:[e.jsx(P,{onClick:()=>t("first"),icon:e.jsx(Jt,{}),children:"First"}),e.jsx(P,{onClick:()=>t("previous10"),icon:e.jsx(xt,{}),children:"Previous 10"}),e.jsx(P,{onClick:()=>t("previous"),icon:e.jsx(Je,{}),children:"Previous"}),e.jsxs(P,{onClick:()=>t("next"),children:["Next ",e.jsx(We,{})]}),e.jsxs(P,{onClick:()=>t("next10"),children:["Next 10 ",e.jsx(bt,{})]}),e.jsxs(P,{onClick:()=>t("last"),children:["Last ",e.jsx(qt,{})]}),e.jsx(fe,{content:e.jsx(js,{}),title:"Go to item",children:e.jsx(P,{children:"Go To"})}),e.jsx(P,{onClick:()=>t("incomplete"),children:"Next Incomplete"})]})}function js(){const{jumpToItem:t}=U();return e.jsx(ft,{isPending:!1,onFinish:n=>t("goTo",n)})}function Is(){const{addParam:t,queryParams:n}=be(),{attributesList:s}=U(),i=j.useMemo(()=>s.map(c=>({label:c.name.en,value:c.id})),[s]),o=c=>{t("filters",c.join(","))},r=n.get("filters"),l=e.jsx(te,{mode:"multiple",style:{width:300},options:i,value:r==null?void 0:r.split(","),onChange:c=>o(c),allowClear:!0});return e.jsx(fe,{content:l,title:"Filter Attributes",children:e.jsx(P,{children:r?e.jsx(It,{style:{color:"gold"}}):e.jsx(Bt,{})})})}function vs(){const{addParam:t,queryParams:n}=be(),s=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],i=n.get("sortBy"),o=e.jsx(te,{style:{width:120},options:s,value:i,onChange:r=>t("sortBy",r),allowClear:!0});return e.jsx(fe,{content:o,title:"Sort By",children:e.jsx(P,{children:"Sort"})})}function ys(){const{attributes:t,getItemAttributeValues:n,availableItemIds:s,getItem:i,isLoading:o}=U(),{searchParams:r}=V(),l=r.get("showComplete")==="true",c=r.get("showUnclear")==="true",m=r.get("showUnrelated")==="true",{itemMessages:x,itemMessagesDict:a,grouping:u}=j.useMemo(()=>{if(o)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const b=f.orderBy(s.map(g=>{const C=n(g),A=Me(C,t);return{item:i(g),itemAttributesValues:C,message:ke(A,c,m),fullMessage:A}}).filter(({itemAttributesValues:g})=>l?g.complete:!0),["message"],["asc"]),h=b.reduce((g,{message:C,item:{id:A}})=>{const T=C.join(" ");return g[T]===void 0&&(g[T]=[]),g[T].push(A),g},{}),p=Object.values(h).filter(g=>g.length>1);return p.length>0&&console.log("More than one",p),{itemMessages:b,itemMessagesDict:f.keyBy(b,"item.id"),grouping:h}},[t,s,n,i,o,l,c,m]);return{itemMessages:x,itemMessagesDict:a,grouping:u}}function je(){const{searchParams:t,removeQueryParam:n}=V(),s=t.get("drawer"),[i,o]=j.useState(!1),{activeItem:r,attributesList:l,itemAttributeValues:c,onAttributeChange:m,jumpToItem:x}=U(),a=()=>{n("drawer")};j.useEffect(()=>{s&&x("goTo",s)},[s,x,n]);const u=j.useMemo(()=>i?l.filter(b=>!c.attributes[b.id]):l,[i,r.id]);return e.jsxs(yt,{open:!!s,title:`Edit: ${r.name.en}`,onClose:a,width:"640px",children:[e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(Z,{item:r,width:50}),e.jsx(X,{item:r})]}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(B,{item:r,language:"en"}),e.jsx(B,{item:r,language:"pt"})]}),e.jsx(S,{vertical:!0,gap:6,children:e.jsx(At,{checked:i,onChange:o,checkedChildren:"Unset",unCheckedChildren:"All"})})]}),e.jsx(G,{className:"my-1"}),e.jsx($,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:u.map(b=>e.jsx(oe,{size:"small",attribute:b,value:c.attributes[b.id],onChange:m},b.id))})]})}function As(){const{attributes:t}=U(),{itemMessages:n,grouping:s}=ys(),{addQueryParam:i}=V(),o=[{title:"Item Id",dataIndex:"item",key:"id",render:r=>e.jsxs("div",{children:[e.jsx(X,{item:r}),e.jsxs(P.Group,{children:[e.jsx(le,{item:r}),e.jsx(P,{size:"small",shape:"round",onClick:()=>i("drawer",r.id),children:"Drawer"})]})]}),sorter:(r,l)=>Number(r.item.id)-Number(l.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:r=>e.jsx(Z,{item:r,width:75})},{title:"Name",dataIndex:"item",key:"name",render:r=>e.jsxs(e.Fragment,{children:[e.jsx(B,{item:r,language:"en"}),e.jsx(B,{item:r,language:"pt"})]}),sorter:(r,l)=>r.item.name.en.localeCompare(l.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(r,{item:l})=>e.jsx(S,{gap:6,children:r.map((c,m,x)=>e.jsx(Ge,{keyVariant:c,attributes:t,firstElement:m===0,lastElement:m===x.length-1,withText:!0},`${c}-${l.id}`))}),sorter:(r,l)=>r.message.join(" ").localeCompare(l.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:r=>r.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:r=>{const l=s[r.join(" ")]??[];return e.jsx(e.Fragment,{children:l.length>1?l.length:"0"})},sorter:(r,l)=>{const c=s[r.message.join(" ")]??[];return(s[l.message.join(" ")]??[]).length-c.length}}];return e.jsxs("div",{className:"my-4",children:[e.jsx(D.Title,{level:5,children:"Item Comparator"}),e.jsx(De,{dataSource:n,columns:o,pagination:{showQuickJumper:!0}}),e.jsx(je,{})]})}function Cs(){const{attributesList:t,addAttributesToUpdate:n,getItemAttributeValues:s,availableItemIds:i,addMultipleAttributesToUpdate:o}=U(),{searchParams:r,addQueryParam:l}=V(),c=r.get("attribute")??"ali",m=r.get("scope")??"unset",x=r.get("page")??"1",a=r.get("pageSize")??"12",[u,b]=j.useState("ali"),[h,p]=j.useState("unset"),[g,C]=j.useState(null),[A,T]=j.useState("desc"),I=j.useMemo(()=>{const R=i.map(L=>s(L)),O=m==="unset"?void 0:w[m.toUpperCase()],v=R.filter(L=>{var z;return((z=L.attributes)==null?void 0:z[c])===O}).map(L=>L.id),[E,N]=(g??"::").split("::");return f.orderBy(v,[L=>{var z,H;return E==="attribute"?(H=(z=s(L))==null?void 0:z.attributes)==null?void 0:H[N]:!0},L=>E==="prop"?Number(L):!0,L=>{var z;return(z=s(L))==null?void 0:z.updatedAt},L=>Number(L)],[A,"asc","desc","asc"])},[c,m,g,A]),y=j.useMemo(()=>{if(u!==c||h!==m)return b(c),p(m),l("page","1"),I.slice(0,Number(a));const R=(Number(x)-1)*Number(a),O=R+Number(a);return I.slice(R,O)},[x,a,I]),d=t.find(R=>R.id===c),M=(R,O,v)=>{const E=s(R);n(R,{...E,attributes:{...E.attributes,[O]:v}})},F=()=>{o(y.map(R=>{const O=s(R);return O.attributes[c]||(O.attributes[c]=w.UNRELATED),O}))};return{group:I,stats:{total:i.length,group:I.length,percent:Math.round(I.length/i.length*100)},pageIds:y,attribute:d,updateAttributeValue:M,updatePageItemsAsUnrelated:F,sorting:{sortBy:g,setSortBy:C,sortOrder:A,setSortOrder:T},pagination:{total:I.length,current:Number(x),pageSize:Number(a),onChange:R=>l("page",String(R)),onShowSizeChange:(R,O)=>l("pageSize",String(O)),pageSizeOptions:[12,24,48,96]}}}const Ts=(t,n)=>n==="unset"||!n?`${100-t.percent}% done, ${t.group} left`:`${t.percent}%  - ${t.group} items`;function Es(){const{getItem:t,getItemAttributeValues:n,attributesList:s}=U(),{attribute:i,pageIds:o,updateAttributeValue:r,updatePageItemsAsUnrelated:l,pagination:c,stats:m,sorting:x}=Cs(),{searchParams:a,addQueryParam:u}=V(),b=Zt("(max-width: 1024px)");if(f.isEmpty(i))return e.jsx(Y,{className:"my-4",children:e.jsx(D.Text,{type:"secondary",children:"No group attribute has been selected."})});const h=e.jsx(jt,{onChange:c.onChange,current:c.current,total:c.total,pageSizeOptions:c.pageSizeOptions,pageSize:c.pageSize,onShowSizeChange:c.onShowSizeChange},"pagination"),p=e.jsxs(S,{align:"center",children:[e.jsx(D.Text,{className:"mr-2",children:"Sort by"}),e.jsxs(te,{style:{width:120},value:x.sortBy,onChange:A=>x.setSortBy(A),children:[e.jsx(te.Option,{value:null,children:"Last Updated"}),e.jsx(te.Option,{value:"prop::id",children:"Id"}),s.map(A=>e.jsx(te.Option,{value:`attribute::${A.id}`,children:A.name.en},A.id))]})]}),C=(a.get("scope")==="unset"||!a.get("scope"))&&e.jsx(Ct,{title:`Are you sure everything is unrelated to ${i.name.en}?`,onConfirm:l,children:e.jsx(P,{type:"primary",danger:!0,disabled:o.length===0,children:"Unrelate Unset Items on Page"})},"unrelate-button");return e.jsxs(Y,{className:"my-4",title:e.jsxs(D.Text,{children:[i==null?void 0:i.name.en," (",Ts(m,a.get("scope")),") -"," ",i.description.en]}),extra:e.jsxs(S,{align:"center",children:[p,h]}),actions:[C,e.jsx($e,{},"go-to-top"),h].filter(Boolean),children:[o.length===0&&e.jsx(ae,{description:"No items found in this scope for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),o.map(A=>{const T=n(A),I=t(A);return e.jsx(Y.Grid,{style:{width:b?"50%":"25%"},children:e.jsxs(S,{gap:6,children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(Z,{item:I,width:75}),e.jsx(X,{item:I}),e.jsxs(P.Group,{children:[e.jsx(le,{item:I}),e.jsx(P,{size:"small",shape:"round",onClick:()=>u("drawer",I.id),children:"Drawer"})]}),e.jsx(B,{item:I,language:"en"}),e.jsx(B,{item:I,language:"pt"})]}),e.jsx(oe,{attribute:i,value:T.attributes[i.id],onlyButtons:!0,onChange:(y,d)=>r(I.id,y,d)})]})},`${A}-${T.updatedAt}`)}),e.jsx(je,{})]})}function Qe(){const{attributesList:t,availableItemIds:n,addAttributesToUpdate:s,getItemAttributeValues:i}=U(),{searchParams:o}=V(),[r,l]=j.useState([]),[c,m]=j.useState(),x=()=>{var T;const h=o.get("attribute")??((T=f.sample(t))==null?void 0:T.id)??"ali",p=t.find(I=>I.id===h)??f.sample(t),g=Number(o.get("size"))||9,C=[],A=f.shuffle(n);for(let I=0;I<A.length&&C.length!==g;I++){const y=A[I];i(y).attributes[h]||C.push(y)}return{selectedAttribute:p,selected:C}},a=()=>{let h=x(),p=0;for(;h.selected.length===0&&p<30;)h=x(),p++;m(h.selectedAttribute),l(h.selected)},u=j.useMemo(()=>c?n.filter(h=>!i(h).attributes[c==null?void 0:c.id]).length:0,[c,n]);return{sampleIds:r,attribute:c,itemsLeftForAttribute:u,onGetSample:a,updateAttributeValue:(h,p,g)=>{const C=i(h);s(h,{...C,attributes:{...C.attributes,[p]:g}})}}}function Ss(){const{getItem:t,getItemAttributeValues:n}=U(),{sampleIds:s,attribute:i,onGetSample:o,updateAttributeValue:r,itemsLeftForAttribute:l}=Qe(),{addQueryParam:c}=V();if(f.isEmpty(s)&&f.isEmpty(i))return e.jsxs(Y,{className:"my-4",children:[e.jsxs(D.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",e.jsx(P,{size:"small",type:"primary",onClick:o,children:"Get Sample"})]}),e.jsx(G,{}),e.jsx(Ee,{})]});const m=s.map(u=>({itemAttributes:n(u),item:t(u)})),x=m.filter(({itemAttributes:u})=>(i==null?void 0:i.id)&&!u.attributes[i.id]),a=()=>{x.forEach(({item:u})=>{i!=null&&i.id&&r(u.id,i.id,-3)})};return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),e.jsxs(Y,{className:"my-4",title:e.jsxs(D.Text,{children:[i==null?void 0:i.name.en," - ",i==null?void 0:i.description.en," (",l," items left)"]}),actions:[e.jsx(P,{onClick:a,danger:!0,disabled:x.length===0,children:"Mark rest as unrelated"},"1"),e.jsx(P,{type:"primary",ghost:!0,onClick:o,children:"Get New Sample"},"2")],extra:e.jsx(P,{type:"primary",size:"small",onClick:o,children:"Get New Sample"}),children:[e.jsxs(S,{vertical:!0,gap:6,children:[m.length===0&&e.jsx(ae,{description:"No unset items found for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),m.map(({item:u,itemAttributes:b})=>e.jsxs(j.Fragment,{children:[e.jsxs(S,{gap:6,children:[e.jsx(Z,{item:u,width:75}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:u}),e.jsxs(P.Group,{children:[e.jsx(le,{item:u}),e.jsx(P,{size:"small",shape:"round",onClick:()=>c("drawer",u.id),children:"Drawer"})]})]}),e.jsx(B,{item:u,language:"en"}),e.jsx(B,{item:u,language:"pt"})]}),!!i&&e.jsx(oe,{attribute:i,value:b.attributes[i.id],onChange:(h,p)=>r(u.id,h,p)})]}),e.jsx(G,{className:"my-1"})]},`${u.id}-${b.updatedAt}`))]}),e.jsx(je,{})]})]})}function Ee(){const[t,n]=Tt(!1),{addQueryParam:s,removeQueryParam:i}=V(),{sampleIds:o,attribute:r,onGetSample:l,updateAttributeValue:c}=Qe(),{getItem:m,getItemAttributeValues:x}=U(),a=()=>{s("size","1"),n(!0),l()},u=()=>{i("size"),n(!1)},b=o[0],h=m(b),p=x(b);return e.jsxs(S,{className:"mt-4",children:[e.jsx(P,{type:"primary",onClick:a,children:"Single Sampler"}),e.jsxs(Et,{title:e.jsxs(D,{children:["Single Sampler: ",e.jsx("strong",{children:r==null?void 0:r.name.en})]}),open:t,width:"100vw",maskClosable:!1,onOk:u,onClose:u,onCancel:u,cancelButtonProps:{style:{display:"none"}},children:[b&&h&&p&&r&&e.jsxs(S,{gap:6,className:"my-10",wrap:"wrap",children:[e.jsx(Z,{item:h,width:150}),e.jsxs(S,{vertical:!0,gap:6,children:[e.jsxs(S,{gap:6,children:[e.jsx(X,{item:h}),e.jsx(le,{item:h})]}),e.jsx(B,{item:h,language:"en"}),e.jsx(B,{item:h,language:"pt"})]}),!!r&&e.jsx(oe,{size:"large",attribute:r,value:p.attributes[r.id],onChange:async(g,C)=>{c(h.id,g,C),await ct(500),l()}})]},b),e.jsx(P,{onClick:l,children:"Another Sample"})]})]})}function ws(){const t=ie("items-attributes"),n=ie("items-attribute-values"),[s,i]=j.useState(null),o=()=>{i(Se(t.data,n.data))},r=()=>{const l={};let c=0;for(;c<300||f.keys(l).length===15;){const m=Se(t.data,n.data);if(m.valid&&!l[m.setId]&&(l[m.setId]=m),f.keys(l).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(l).map((m,x)=>({...m,number:m.number-x})))};return e.jsxs("div",{className:"my-4",children:[e.jsx(D.Title,{level:3,children:"Daily Simulator"}),e.jsx(D.Paragraph,{children:"Generates a daily game for Alien Communication"}),e.jsxs($,{children:[e.jsx(P,{type:"primary",onClick:o,children:"Generate"}),e.jsx(P,{onClick:r,children:"Generate List"})]}),e.jsx("div",{children:!!s&&e.jsxs($,{direction:"vertical",children:[e.jsx(D.Title,{level:5,children:s==null?void 0:s.setId}),!(s!=null&&s.valid)&&e.jsx(Ze,{type:"error",message:"Invalid game"}),e.jsx($,{direction:"vertical",children:s==null?void 0:s.attributes.map(l=>e.jsxs(S,{gap:8,children:[e.jsx(q,{id:l.spriteId,width:50}),l.itemsIds.map(c=>e.jsx(ye,{id:c||"0",width:50},c))]},l.id))}),e.jsx(G,{className:"my-1"}),e.jsx($,{direction:"horizontal",children:s==null?void 0:s.requests.map(l=>e.jsxs(S,{vertical:!0,children:[e.jsx(q,{id:l.spritesIds[2],width:50}),e.jsx(q,{id:l.spritesIds[1],width:50}),e.jsx(q,{id:l.spritesIds[0],width:50})]},l.itemId))}),e.jsx(G,{className:"my-1"}),e.jsx($,{direction:"horizontal",children:s==null?void 0:s.itemsIds.map(l=>e.jsx(ye,{id:l||"0",width:50},l))})]},s==null?void 0:s.setId)})]})}const Se=(t,n)=>{const s=f.values(t).filter(d=>!d.limited||d.id==="sol"),i=f.shuffle(f.values(n).filter(d=>d.complete)),o=f.shuffle(ut(38,0)),r=f.sampleSize(s,3).map(d=>({...d,spriteId:`${o.pop()}`})),l=[],c=[],m=[],x=[],a=[],u=[],b=[],h=[];i.forEach(d=>{const M=[w.DETERMINISTIC,w.RELATED],F=d.attributes[r[0].id]===w.DETERMINISTIC,R=M.includes(d.attributes[r[0].id]),O=d.attributes[r[0].id]===w.UNRELATED,v=d.attributes[r[1].id]===w.DETERMINISTIC,E=M.includes(d.attributes[r[1].id]),N=d.attributes[r[1].id]===w.UNRELATED,L=d.attributes[r[2].id]===w.DETERMINISTIC,z=M.includes(d.attributes[r[2].id]),H=d.attributes[r[2].id]===w.UNRELATED;if(O&&N&&H)return h.push(d.id);F&&N&&H&&l.push(d.id),O&&v&&H&&c.push(d.id),O&&N&&L&&m.push(d.id),R&&E&&H&&x.push(d.id),R&&N&&z&&a.push(d.id),O&&E&&z&&u.push(d.id),R&&E&&z&&b.push(d.id)});const p=r.map(d=>({id:d.id,name:d.name.pt,description:d.description.pt,spriteId:d.spriteId,itemsIds:[]}));p[0].itemsIds=f.sampleSize(l,l.length>3?3:Math.max(l.length-1,1)),p[1].itemsIds=f.sampleSize(c,c.length>3?3:Math.max(l.length-1,1)),p[2].itemsIds=f.sampleSize(m,m.length>3?3:Math.max(l.length-1,1));const g=[];p.forEach(d=>{g.push(...d.itemsIds)});const C=[];x.length>0&&C.push({spritesIds:[r[0].spriteId,r[1].spriteId],itemId:f.sample(x)??""}),a.length>0&&C.push({spritesIds:[r[0].spriteId,r[2].spriteId],itemId:f.sample(a)??""}),u.length>0&&C.push({spritesIds:[r[1].spriteId,r[2].spriteId],itemId:f.sample(u)??""}),b.length>0&&C.push({spritesIds:r.map(d=>d.spriteId),itemId:f.sample(b)??""});const A=[];l.length>0&&A.push({spritesIds:[r[0].spriteId],itemId:l.filter(d=>!g.includes(d))[0]}),c.length>0&&A.push({spritesIds:[r[1].spriteId],itemId:c.filter(d=>!g.includes(d))[0]}),m.length>0&&A.push({spritesIds:[r[2].spriteId],itemId:m.filter(d=>!g.includes(d))[0]}),console.log({attributeA:l,attributeB:c,attributeC:m,attributeAB:x,attributeAC:a,attributeBC:u,attributeABC:b}),console.log("COMPLEX REQUEST SIZE",C.length),console.log("SIMPLE REQUEST SIZE",A.length);let T=f.sampleSize(C,4);console.log("REQUEST SIZE",T.length),T.length<3&&T.push(...f.sampleSize(A,4-T.length)),T.length<4&&console.warn("Not enough requests"),T=f.shuffle(T);const I=T.map(d=>d.itemId),y={id:"2024-00-00",setId:p.map(d=>d.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:p,requests:T,solution:I.join("-"),itemsIds:f.shuffle([...I,h[0],h[1],h[2],h[3]]).filter(Boolean),valid:!1};return y.valid=[y.attributes.length===3,y.requests.length===4,y.itemsIds.length>5,y.attributes.every(d=>d.itemsIds.length>0),y.requests.every(d=>d.itemId)].every(Boolean),console.log(y),y},Ns=["","I","II","III","IV","V"];function Ps(){const{attributes:t,availableItemIds:n,getItemAttributeValues:s,getItem:i}=U(),{message:o}=he.useApp(),[r,l]=j.useState(25),[c,m]=j.useState(80),[x,a]=j.useState(!1),[u,b]=j.useState([]),[h,p]=j.useState([]),[g,C]=j.useState(null),[A,T]=j.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),I=()=>{const d={},M=f.shuffle(n);for(;Object.values(d).length<r;){const v=M.pop();if(!v)break;const E=s(v);E&&(!E.complete||!E.reliability||E.reliability<c||!x&&i(v).nsfw||(E.signature&&!d[E.signature]?d[E.signature]=v:console.log("Item has identical key to another item. Skipping.",i(v).name.en)))}const F=Object.values(d);F.length<r&&o.error(`Could not generate sample. Got only ${F.length} items`),b(f.sortBy(F,v=>Number(v)));const R=Rs(F.map(v=>s(v)),25,t);if(R.length<25){const v=f.keys(t).filter(L=>!R.includes(L)),N=f.sortBy(v,L=>t[L].priority).slice(0,25-R.length);console.log("Adding more attributes by priority",N),R.push(...N)}const O=R.reduce((v,E)=>(F.forEach(N=>{const L=s(N);if(L)switch(L.attributes[E]){case w.RELATED:v.relatedCount[E]=(v.relatedCount[E]||0)+1;break;case w.DETERMINISTIC:v.deterministicCount[E]=(v.deterministicCount[E]||0)+1;break;case w.UNCLEAR:v.unclearCount[E]=(v.unclearCount[E]||0)+1;break;case w.OPPOSITE:v.oppositeCount[E]=(v.oppositeCount[E]||0)+1;break}}),v),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});p(R.sort().map(v=>({...t[v],relatedCount:O.relatedCount[v],deterministicCount:O.deterministicCount[v],unclearCount:O.unclearCount[v],oppositeCount:O.oppositeCount[v]})))},y=d=>{T(M=>({...M,[d]:!M[d]}))};return e.jsxs("div",{className:"my-4",children:[e.jsx(D.Title,{level:3,children:"Simulator"}),e.jsx(D.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(se,{label:"Grid Size",value:r,onChange:d=>l(d),options:[16,25]}),e.jsx(Ne,{label:"Reliability Threshold",value:c,onChange:d=>m(d),step:5,min:10,max:100}),e.jsx(Q,{label:"NSFW",value:x,onChange:a}),e.jsx(P,{onClick:I,type:"primary",children:"Get Sample Board"})]}),e.jsxs(S,{wrap:!0,gap:12,children:[e.jsx(ce,{label:"Show Id",value:!!A.id,onChange:()=>y("id")}),e.jsx(ce,{label:"Show Name (EN)",value:!!A.nameEn,onChange:()=>y("nameEn")}),e.jsx(ce,{label:"Show Name (PT)",value:!!A.namePt,onChange:()=>y("namePt")}),e.jsx(ce,{label:"Show Reliability",value:!!A.reliability,onChange:()=>y("reliability")})]}),e.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(r)}, 1fr)`},children:u.map(d=>{const M=i(d),F=s(d);return e.jsxs($,{direction:"vertical",className:de("simulator-grid__entry",g&&F.attributes[g]>0&&"simulator-grid__entry--highlighted"),align:"center",children:[e.jsxs($,{children:[e.jsxs(S,{vertical:!0,children:[A.id&&e.jsx(X,{item:M}),A.reliability&&e.jsx("span",{children:e.jsx(rt,{prefix:e.jsx(Gt,{}),placeholder:"Reliability",variant:"borderless",size:"small",value:F.reliability,readOnly:!0,style:{width:"8ch"},formatter:R=>`${R}%`})}),A.id&&e.jsx(le,{item:M})]}),e.jsx(Z,{item:M,width:50})]}),A.nameEn&&e.jsx(B,{item:M,language:"en"}),A.namePt&&e.jsx(B,{item:M,language:"pt"})]},d)})}),e.jsx("div",{className:"simulator-grid my-4",children:h.map(d=>e.jsxs(St,{className:de("simulator-grid__entry","simulator-grid__button",g===d.id&&"simulator-grid__entry--highlighted"),onClick:()=>C(d.id),children:[d.name.en," ",Ns[d.level],e.jsxs(S,{gap:6,justify:"center",className:"my-1",children:[e.jsxs("span",{children:[e.jsx(Ot,{style:{color:d.deterministicCount?"dodgerblue":void 0}})," ",d.deterministicCount??0]}),e.jsxs("span",{children:[e.jsx(vt,{style:{color:d.relatedCount?"green":void 0}})," ",d.relatedCount??0]}),e.jsxs("span",{children:[e.jsx(kt,{style:{color:d.oppositeCount?"red":void 0}})," ",d.oppositeCount??0]}),e.jsxs("span",{children:[e.jsx(Le,{style:{color:d.unclearCount?"gold":void 0}})," ",d.unclearCount??0]})]})]},d.id))}),e.jsx(ws,{})]})}function Rs(t,n,s){const i={},o={};t.forEach(p=>{p&&Object.keys(p.attributes).forEach(g=>{p.attributes[g]>0&&(i[g]=(i[g]||0)+1),p.attributes[g]===w.DETERMINISTIC&&(o[g]=!0,i[g]=(i[g]||0)+2),p.attributes[g]===w.OPPOSITE&&(i[g]=(i[g]||0)+1)})});const r={1:0,2:0,3:0,4:0};function l(p){return p.filter(g=>(r[s[g].level]++,r[4]>1?(console.log("Discarding level 4 attribute",g),!1):!0))}const c=l(Object.keys(o)),m=l(f.keys(i).filter(p=>!c.includes(p)));if(console.log({levelCount:r}),n===c.length)return console.log("All keys are deterministic"),c;if(console.log(i),c.length===0)return[];const x=c.reduce((p,g)=>{const C=i[g];return p[C]||(p[C]=[]),p[C].push(g),p},{}),a=f.keys(x).sort((p,g)=>Number(g)-Number(p));console.log({sortedDeterministicTiedGroupsKeys:a});const u=m.reduce((p,g)=>{const C=i[g];return p[C]||(p[C]=[]),p[C].push(g),p},{});console.log(u);const b=f.keys(u).sort((p,g)=>Number(g)-Number(p)),h=[];for(const p of a){if(h.length===n)break;h.push(...f.sampleSize(x[p],n-h.length))}for(const p of b){if(h.length===n)break;h.push(...f.sampleSize(u[p],n-h.length))}return h}function Ls(){const{attributes:t}=U(),n=[{key:"1",label:"All Attributes",children:e.jsx(ee,{type:"all"})},{key:"2",label:"Default",children:e.jsx(ee,{type:"default"})},{key:"3",label:"Custom",children:e.jsx(ee,{type:"custom"})},{key:"4",label:"Limited",children:e.jsx(ee,{type:"limited"})},{key:"5",label:"Specific",children:e.jsx(ee,{type:"specific"})},{key:"6",label:"Opposite",children:e.jsx(ee,{type:"opposite"})}];return e.jsxs("div",{className:"my-4",children:[e.jsxs(S,{justify:"space-between",align:"center",children:[e.jsx(D.Title,{level:5,children:"Stats"}),e.jsx(Pe,{data:()=>Ds(t),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),e.jsx(wt,{defaultActiveKey:"1",items:n})]})}const Os=(t,n)=>{let s=0,i=0,o=0,r=0,l=0,c=0,m=0,x=0;n.forEach(({attributes:I})=>{if(I[t.id]){s++;const y=I[t.id];y===10?i++:y===5?o++:y===0||!y?r++:y===-1?l++:y===-3?c++:y===-10&&m++,y>0&&x++}});const a=n.length,u=s/a*100,b=i/a*100,h=o/a*100,p=r/a*100,g=l/a*100,C=c/a*100,A=m/a*100,T=x/a*100;return{completionPercentage:u.toFixed(1),tensPercentage:b.toFixed(1),fivesPercentage:h.toFixed(1),zerosPercentage:p.toFixed(1),negativeOnesPercentage:g.toFixed(1),negativeThreesPercentage:C.toFixed(1),negativeTensPercentage:A.toFixed(1),positivePercentage:T.toFixed(1)}};function ee({type:t}){const{availableItemIds:n,getItemAttributeValues:s,attributesList:i}=U(),o=Xe(),{is:r}=be(),l=j.useMemo(()=>{const a=new Array(65).fill(0).map((b,h)=>h),u=i.map(b=>b.spriteId);return a.filter(b=>!u.includes(`sign-${b}`))},[i]),c=j.useMemo(()=>t==="default"?i.filter(a=>a.default):t==="custom"?i.filter(a=>!a.default):t==="limited"?i.filter(a=>a.limited):t==="specific"?i.filter(a=>a.specific):t==="opposite"?i.filter(a=>a.oppositeId):i,[i,t]),m=j.useMemo(()=>{const a=n.map(u=>s(u));return c.map(u=>({...u,...Os(u,a)}))},[c,n,s]),x=[{title:"Attribute",dataIndex:"name",key:"name",render:(a,u)=>e.jsxs(S,{align:"center",gap:8,children:[r("showGlyphs")&&e.jsx(q,{id:u.spriteId,width:30}),a.en,u.default&&e.jsx(ne,{className:"ml-1",children:"default"}),u.limited&&e.jsx(ne,{className:"ml-1",children:"limited"}),(u.specific||u.parentId)&&e.jsx(ne,{className:"ml-1",children:"specific"}),u.oppositeId&&e.jsx(ne,{className:"ml-1",children:e.jsx(et,{})}),e.jsx(_e,{title:u.description.en})]}),sorter:(a,u)=>a.name.en.localeCompare(u.name.en)},{title:e.jsx(Nt,{}),dataIndex:"spriteId",key:"spriteId",render:a=>e.jsx(q,{id:a,width:18,padding:0})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(a,u)=>a.priority-u.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.positivePercentage)-Number.parseFloat(u.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(a,u)=>u.limited?"-":`${a}%`,sorter:(a,u)=>Number.parseFloat(a.tensPercentage)-Number.parseFloat(u.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.fivesPercentage)-Number.parseFloat(u.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeOnesPercentage)-Number.parseFloat(u.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeThreesPercentage)-Number.parseFloat(u.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeTensPercentage)-Number.parseFloat(u.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:a=>e.jsx(Oe,{percent:Number.parseFloat(a),size:"small"}),sorter:(a,u)=>Number.parseFloat(a.completionPercentage)-Number.parseFloat(u.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:a=>e.jsx(Pt,{count:4,value:a,disabled:!0}),sorter:(a,u)=>a.level-u.level},{title:"Actions",key:"actions",render:a=>e.jsx($,{children:e.jsxs(P.Group,{children:[e.jsx(P,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=grouping&attribute=${a.id}&page=1`),children:"Grouping"}),e.jsx(P,{size:"small",shape:"round",onClick:()=>o(`/items/attribution?view=sampler&attribute=${a.id}&size=6`),children:"Sample"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(D.Paragraph,{children:["Total: ",m.length]}),e.jsx(De,{columns:x,dataSource:m,pagination:!1,rowKey:"id",size:"small"}),e.jsx(S,{wrap:"wrap",gap:8,children:l.map(a=>e.jsxs("div",{children:["#",a,e.jsx(q,{id:`sign-${a}`},a)]},a))})]})}function Ds(t){const n=f.cloneDeep(t);return xe(Re(n),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Us(){const{view:t}=V();return t==="classifier"?e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"my-4",gap:8,children:[e.jsx(bs,{}),e.jsx(Is,{}),e.jsx(vs,{})]}),e.jsx(xs,{}),e.jsx(S,{justify:"flex-end",className:"my-4",children:e.jsx($e,{})})]}):t==="sampler"?e.jsx(Ss,{}):t==="grouping"?e.jsx(Es,{}):t==="comparator"?e.jsx(As,{}):t==="simulator"?e.jsx(Ps,{}):t==="stats"?e.jsx(Ls,{}):e.jsx(ae,{className:"my-10",description:"Unknown view has been selected"})}function Ms(){const{isLoading:t,error:n,hasResponseData:s}=U();return e.jsx(tt,{title:"Items",subtitle:"Attribution",children:e.jsxs(Ie,{hasSider:!0,children:[e.jsx(gt,{children:e.jsx(ms,{})}),e.jsx(Ie.Content,{className:"content",children:e.jsx(st,{isLoading:t,error:n,hasResponseData:s,children:e.jsx(Us,{})})})]})})}function kr(){return e.jsx(is,{children:e.jsx(Ms,{})})}export{kr as default};
