import{r as f,d as _,j as e,m as N,h as J,F as h,b as M,S as k,T as D,B as E,A as B,D as U,P as A,L as I}from"./index-Bl1jfJHn.js";import{u as T}from"./useQueryParams-BmQiP3JR.js";import{D as S}from"./EditableFields-BbbDzNYg.js";import{C as L}from"./CopyToClipboardButton-DoK9eXNN.js";import{u as P}from"./useCopyToClipboardFunction-CmXuRkRd.js";import{u as F}from"./useTableExpandableRows-BHCQH1-n.js";import{u as R}from"./useTablePagination-EmfgtKLV.js";import{a as W,l as u,P as H}from"./useBaseUrl-Dk0cVXCz.js";import{I as K}from"./Item-BHxkj8-I.js";import{T as V}from"./index-Ds5tz_gH.js";import{F as C}from"./Table-OgMT2KJS.js";import{T as q}from"./index-DAR1ycs3.js";import{F as G,b as X}from"./FilterEntries-CrUHyoRW.js";import{S as Y}from"./SiderContent-CEm5V-VF.js";import{D as j}from"./DownloadButton-DUp2TkVd.js";import{S as g}from"./SaveButton-D4wCmARW.js";import{a as w}from"./index-C8-I1wI_.js";import{R as Z}from"./SkinOutlined-ByFmXAXw.js";import{R as Q}from"./EnvironmentOutlined-FCNOgYF2.js";import{D as ee}from"./DataLoadingWrapper-Bps_4g2X.js";import{u as v}from"./useResourceFirestoreData-JvuRoPo2.js";import{u as ae}from"./useTDResource-DMA8QwN5.js";import"./LanguageFlag-Dimx84n0.js";import"./index-CpcfmBtc.js";import"./IdcardOutlined-Cb8oF7DX.js";import"./PlusOutlined-78NXxaF9.js";import"./Dropdown-BUMd9h61.js";import"./index-BpL3IJlO.js";import"./index-CZEJRKee.js";import"./index-BHfkKfMc.js";import"./index-d5hN45Li.js";import"./scrollTo-LCsUDcON.js";import"./Pagination-DndbgHRq.js";import"./index-C9yLx269.js";import"./moment-B-YVwB4U.js";import"./SaveOutlined-D0d549j5.js";import"./constants-DXzj78ES.js";import"./useGetFirestoreDoc-CLYR9ssq.js";import"./useUpdateFirestoreDoc-SeBKhASe.js";import"./useMutation-DKqmMZTu.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"};function O(){return O=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},O.apply(this,arguments)}const ie=(a,t)=>f.createElement(_,O({},a,{ref:t,icon:te})),se=f.forwardRef(ie);function re({item:a,cardWidth:t,activeColor:s,isSelected:r=!1,className:o=""}){const{getUrl:c}=W("images"),d=`back/crime${u.capitalize(a.type)}`;return a.itemId?e.jsxs("div",{className:N("crime-item-card",`crime-item-card--${a.type}`,r&&"crime-item-card--selected",o),style:{width:t,backgroundImage:`url(${c(`${d}.jpg`)})`,...s&&r?{borderColor:s,backgroundColor:s}:{}},children:[e.jsx(J,{content:e.jsxs(e.Fragment,{children:[a.name.pt," | ",a.name.en]}),children:e.jsx("div",{className:"crime-item-card__name",style:{maxWidth:`${t}px`},children:e.jsx("span",{children:a.name.en})})}),e.jsx("div",{className:N("crime-item-card__item-container",`crime-item-card__item-container--${a.type}`),children:e.jsx(K,{className:"crime-item-card__item",itemId:a.itemId,width:t*.75})})]}):e.jsx(e.Fragment,{children:a.id})}function ne({rows:a,onUpdateCard:t,weapons:s,evidence:r,locations:o,victims:c,scenes:d}){const{queryParams:m,addParams:n}=T(),i=m.get("type"),l=[{key:"all",label:"All",children:e.jsx(y,{onUpdateCard:t,rows:a,scenes:d})},{key:"weapons",label:"Weapons",children:e.jsx(y,{onUpdateCard:t,rows:s,scenes:d})},{key:"evidence",label:"Evidence",children:e.jsx(y,{onUpdateCard:t,rows:r,scenes:d})},{key:"locations",label:"Locations",children:e.jsx(y,{onUpdateCard:t,rows:o,scenes:d})},{key:"victims",label:"Victims",children:e.jsx(y,{onUpdateCard:t,rows:c,scenes:d})}],p=x=>{n({type:x,page:"1"})};return e.jsx("div",{className:"my-4",children:e.jsx(V,{defaultActiveKey:i||"all",items:l,onChange:p})})}function y({rows:a,onUpdateCard:t,scenes:s}){const r=P(),o=R({total:a.length,showQuickJumper:!0}),c=(i,l,p)=>{const x=u.cloneDeep(p);x.name[l]=i,t(x)},d=[C.EXPAND_COLUMN,{title:"Id",dataIndex:"id",key:"id",render:i=>e.jsxs("span",{children:[i,e.jsx(L,{content:i})]}),sorter:(i,l)=>i.id.localeCompare(l.id)},{title:"Card",dataIndex:"itemId",key:"itemId",render:(i,l)=>e.jsxs(h,{align:"center",gap:8,children:[e.jsx(re,{cardWidth:70,item:l}),e.jsx("div",{children:e.jsx(M,{defaultValue:l.itemId,onBlur:p=>{if(console.log(p?.target?.value),console.log("onBlur"),p?.target?.value&&p?.target?.value!==l.itemId){const x=u.cloneDeep(l);x.itemId=p?.target?.value,t(x)}},size:"small"})})]})},{title:"Name",dataIndex:"name",key:"name",sorter:(i,l)=>i.name.en.localeCompare(l.name.en),render:(i,l)=>e.jsxs(k,{orientation:"vertical",style:{minWidth:150},children:[e.jsx(S,{language:"en",onPressEnter:p=>c(p.target?.value||l.name.en,"en",l),value:i}),e.jsx(S,{language:"pt",onPressEnter:p=>c(p.target?.value||l.name.pt,"pt",l),value:i})]})},{title:"Type",dataIndex:"type",key:"type",render:i=>e.jsx("span",{children:i}),sorter:(i,l)=>i.type.localeCompare(l.type)}],m=F({maxExpandedRows:1,expandedRowRender:i=>e.jsx(oe,{card:i,scenes:s})}),n=()=>{if(o){const{current:i=1,pageSize:l=10}=o,p=a.slice((i-1)*l,i*l),x=[];p.forEach((z,$)=>{x.push(`${$+1}) ${z.name.en}}`)}),console.log(x),r(x.join(`
`))}};return e.jsxs("div",{className:"my-4",children:[e.jsxs(k,{className:"mb-4",children:[e.jsxs(D,{children:[a.length," cards total"]}),e.jsx(E,{onClick:n,children:"Copy Page Cards"})]}),e.jsx(C,{columns:d,dataSource:a,expandable:m,pagination:o,rowKey:"id"})]})}function oe({card:a,scenes:t}){return e.jsxs("div",{children:[e.jsx(D.Title,{level:5,children:"Scene Likelihood"}),e.jsx("div",{className:"likelihood",children:Object.values(t).map(s=>{const[r,o]=a.likelihood?.[s.id]??[],c=r!==void 0,d=s.values?.[r]?.en,m=o!==void 0,n=s.values?.[o]?.en;return e.jsxs("div",{className:"likelihood-entry",children:[e.jsx("div",{className:"bold",children:s.title.en}),e.jsx("div",{className:N("likely-result",{"likely-result--no-data":!c||!d}),children:d||"No most likely value"}),e.jsx("div",{className:N("likely-result--2",{"likely-result--no-data":!m||!n}),children:n||"No second most likely value"})]},s.id)})})]})}function le({sceneQuery:a,objects:t}){const s=P(),r=Object.values(a.data??[]),o=R({total:r.length,showQuickJumper:!0}),c=n=>{const i=[];i.push(`"${n.description.en}"`),n.values.forEach((l,p)=>{i.push(`${p}) ${l.en}`)}),s(i.join(`
`))},d=[{title:"Id",dataIndex:"id",key:"id",render:n=>e.jsxs("span",{children:[n,e.jsx(L,{content:n})]}),sorter:(n,i)=>n.id.localeCompare(i.id)},{title:"Title",dataIndex:"title",key:"title",render:(n,i)=>e.jsxs(k,{orientation:"vertical",style:{minWidth:150},children:[e.jsx(S,{language:"en",readOnly:!0,value:i.title}),e.jsx(S,{language:"pt",readOnly:!0,value:i.title})]})},{title:"Type",dataIndex:"type",key:"type",render:n=>e.jsx("span",{children:n}),sorter:(n,i)=>n.type.localeCompare(i.type)},C.EXPAND_COLUMN,{title:"Options",dataIndex:"values",key:"tags",render:(n,i)=>e.jsxs(e.Fragment,{children:[e.jsx(E,{onClick:()=>c(i),children:"Copy options"}),e.jsx("ul",{children:n.map(l=>e.jsx("li",{children:e.jsxs(D,{children:[l.en," / ",l.pt]})},l.en))})]})}],m=F({maxExpandedRows:1,expandedRowRender:n=>e.jsx(de,{objects:t,scene:n})});return e.jsxs("div",{className:"my-4",children:[e.jsx(D.Title,{className:"my-0",level:2,children:"Scenes"}),e.jsx(C,{columns:d,dataSource:r,expandable:m,pagination:o,rowKey:"id"})]})}function de({scene:a,objects:t}){const s=f.useMemo(()=>{let r=0;const o={};return t.forEach(d=>{if(d.likelihood?.[a.id]){const n=d.likelihood[a.id][0];o[n]=(o[n]||0)+1,r+=1}}),Object.entries(o).map(([d,m])=>({value:d,percentage:m/r*100}))},[t,a.id]);return e.jsxs("div",{children:[e.jsxs("h3",{children:[a.title.en," / ",a.title.pt]}),e.jsx("ul",{children:s.map(({value:r,percentage:o})=>e.jsxs("li",{children:[e.jsx(q,{children:a.values[Number(r)].en})," ",o.toFixed(2),"%"]},r))})]})}function ce({weaponsQuery:a,evidenceQuery:t,scenesQuery:s,locationsQuery:r,victimsQuery:o}){const{is:c,queryParams:d}=T(),m=f.useMemo(()=>[...Object.values(a.data),...Object.values(t.data),...Object.values(r.data),...Object.values(o.data)],[a.data,t.data,r.data,o.data]),n=i=>{if(i.type==="weapon")a.addEntryToUpdate(i.id,i);else if(i.type==="evidence")t.addEntryToUpdate(i.id,i);else throw new Error("Invalid card type")};return e.jsxs(e.Fragment,{children:[(c("display","cards")||!d.has("display"))&&e.jsx(ne,{evidence:Object.values(t.data),locations:Object.values(r.data),onUpdateCard:n,rows:m,scenes:s.data,victims:Object.values(o.data),weapons:Object.values(a.data)}),c("display","tags")&&e.jsx(B,{closable:!0,message:"Tags table is not implemented yet",showIcon:!0,type:"info"}),c("display","scenes")&&e.jsx(le,{objects:m,sceneQuery:s})]})}function me({weaponsQuery:a,evidenceQuery:t,scenesQuery:s,locationsQuery:r,victimsQuery:o}){const{queryParams:c,addParam:d,addParams:m,is:n}=T();return e.jsxs(Y,{children:[e.jsxs(h,{gap:12,vertical:!0,children:[e.jsxs(h,{gap:6,children:[e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Weapons"}),e.jsx(g,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(j,{block:!0,data:()=>b(a.data),disabled:a.isDirty,fileName:"crime-weapons.json",hasNewData:a.hasFirestoreData,children:"JSON"})]}),e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Evidence"}),e.jsx(g,{dirt:JSON.stringify(t.entriesToUpdate),isDirty:t.isDirty,isSaving:t.isSaving,onSave:t.save,size:"middle"}),e.jsx(j,{block:!0,data:()=>b(t.data),disabled:t.isDirty,fileName:"crime-evidence.json",hasNewData:t.hasFirestoreData,children:"JSON"})]})]}),e.jsxs(h,{gap:6,children:[e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Locations"}),e.jsx(g,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(j,{block:!0,data:()=>b(r.data),disabled:a.isDirty,fileName:"crime-locations.json",hasNewData:a.hasFirestoreData,children:"JSON"})]}),e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Victims"}),e.jsx(g,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(j,{data:()=>b(o.data),disabled:a.isDirty,fileName:"crime-victims.json",hasNewData:a.hasFirestoreData,children:"JSON"})]})]}),e.jsx("span",{children:"Scenes"}),e.jsx(g,{dirt:JSON.stringify(s.entriesToUpdate),isDirty:s.isDirty,isSaving:s.isSaving,onSave:s.save}),e.jsx(j,{block:!0,data:()=>pe(s.data),disabled:s.isDirty,fileName:"crime-scenes.json",hasNewData:s.hasFirestoreData})]}),e.jsx(U,{}),e.jsx(G,{label:"Display",onChange:i=>m({display:i,page:1},{page:1}),options:[{title:"Cards",icon:e.jsx(Z,{}),value:"cards"},{title:"Tags",icon:e.jsx(se,{}),value:"tags"},{title:"Scenes",icon:e.jsx(Q,{}),value:"scenes"}],value:c.get("display")??"listing"}),n("display","item")&&e.jsx(X,{label:"No Groups Only",onChange:i=>d("emptyOnly",i,!1),value:n("emptyOnly")})]})}function b(a){console.log("Preparing file for download...");const t=u.cloneDeep(a);return Object.values(t).forEach(s=>{s.likelihood||(s.likelihood={})}),w(t)}function pe(a){console.log("Preparing scenes file for download...");const t=u.cloneDeep(a);return w(t)}function Qe(){const a=v({tdrResourceName:"crime-weapons",firestoreDataCollectionName:"crimeWeapons",serialize:!0}),t=v({tdrResourceName:"crime-evidence",firestoreDataCollectionName:"crimeEvidence",serialize:!0}),s=v({tdrResourceName:"crime-locations",firestoreDataCollectionName:"crimeLocations",serialize:!0}),r=v({tdrResourceName:"crime-victims",firestoreDataCollectionName:"crimeVictims",serialize:!0}),o=v({tdrResourceName:"crime-scenes",firestoreDataCollectionName:"crimeScenes",serialize:!0}),c=ae("items");return f.useEffect(()=>{const d=Object.values(o.data).map(m=>({id:m.id,title:m.title.en,description:m.description.en,values:m.values.map(n=>n.en)}));u.isEmpty(d)||console.log("Slim Scenes for GPT:",d)},[o.data]),e.jsx(A,{subtitle:"Categorizer",title:"Crimes Hediondos",children:e.jsxs(I,{hasSider:!0,children:[e.jsx(H,{children:e.jsx(me,{evidenceQuery:t,locationsQuery:s,scenesQuery:o,victimsQuery:r,weaponsQuery:a})}),e.jsx(I.Content,{className:"content",children:e.jsx(ee,{error:a.error||t.error||o.error||c.error||s.error||r.error,hasResponseData:!u.isEmpty(a.data)&&!u.isEmpty(t.data)&&!u.isEmpty(o.data)&&!u.isEmpty(s.data)&&!u.isEmpty(r.data)&&!u.isEmpty(c.data),isLoading:a.isLoading||t.isLoading||o.isLoading||s.isLoading||r.isLoading||c.isLoading,children:e.jsx(ce,{evidenceQuery:t,locationsQuery:s,scenesQuery:o,victimsQuery:r,weaponsQuery:a})})})]})})}export{Qe as default};
