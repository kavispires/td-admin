import{r as b,a as J,_ as M,j as e,ao as B,T as S,B as F,at as U,D as W,P as A,L as P}from"./index-B3JH01iB.js";import{u as I}from"./useQueryParams-BHv40m-x.js";import{u as H,l as x,c as k,P as K}from"./useBaseUrl-CZWZgKRs.js";import{D as C}from"./EditableFields-QZDUbqgf.js";import{C as R}from"./CopyToClipboardButton-B6Ok36KF.js";import{u as w}from"./useCopyToClipboardFunction-DvRK2P3Q.js";import{u as z}from"./useTableExpandableRows-DiYsDkGa.js";import{u as _}from"./useTablePagination-BzQlYVOz.js";import{I as V}from"./Item-DsGe7FNE.js";import{T as q}from"./index-Cst7AYXC.js";import{F as T}from"./Table-DC7vW2Ha.js";import{F as h}from"./index-BCvCL0ga.js";import{I as G}from"./index-DecZ6U45.js";import{S as O}from"./index-Dszr5pPb.js";import{T as X}from"./index-QBggA2J0.js";import{F as Y,c as Z}from"./FilterEntries-u2pKqJxX.js";import{S as Q}from"./SiderContent-y1ziTlGK.js";import{D as g}from"./DownloadButton-DJaKu1gp.js";import{S as v}from"./SaveButton-yEblVGPH.js";import{a as $}from"./index-D-qWoO__.js";import{R as ee}from"./SkinOutlined-Dnvs89gD.js";import{R as ae}from"./EnvironmentOutlined-CDIjv-O-.js";import{D as te}from"./DataLoadingWrapper-dh3jacIT.js";import{u as y}from"./useResourceFirestoreData-BQIrV1BQ.js";import{u as ie}from"./useTDResource-b3rDQSkC.js";import"./LanguageFlag-CBU9M51y.js";import"./index-CaSPROP-.js";import"./FireFilled-D0Yiv99U.js";import"./IdcardOutlined-CghYbHQl.js";import"./PlusOutlined-C-HTnxQk.js";import"./index-Ulf3nzcb.js";import"./index-DGt5aRqD.js";import"./index-CVDTN0au.js";import"./index-DZHJosB8.js";import"./scrollTo-BUBUSE1i.js";import"./Pagination-azJyVn8J.js";import"./Input-DYhQBLMT.js";import"./gapSize-U1swVQyS.js";import"./index-Dt5YmjhO.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-C6W0l_YX.js";import"./constants-CzmVoJc0.js";import"./useGetFirestoreDoc-DtxW3_7b.js";import"./useUpdateFirestoreDoc-Bh11gTIF.js";import"./useMutation-CY39LX1i.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"},re=function(i,s){return b.createElement(J,M({},i,{ref:s,icon:se}))},oe=b.forwardRef(re);function ne({item:a,cardWidth:i,activeColor:s,isSelected:l=!1,className:r=""}){const{getUrl:p}=H("images"),d=`back/crime${x.capitalize(a.type)}`;return a.itemId?e.jsxs("div",{className:k("crime-item-card",`crime-item-card--${a.type}`,l&&"crime-item-card--selected",r),style:{width:i,backgroundImage:`url(${p(`${d}.jpg`)})`,...s&&l?{borderColor:s,backgroundColor:s}:{}},children:[e.jsx(B,{content:e.jsxs(e.Fragment,{children:[a.name.pt," | ",a.name.en]}),children:e.jsx("div",{className:"crime-item-card__name",style:{maxWidth:`${i}px`},children:e.jsx("span",{children:a.name.en})})}),e.jsx("div",{className:k("crime-item-card__item-container",`crime-item-card__item-container--${a.type}`),children:e.jsx(V,{className:"crime-item-card__item",id:a.itemId,width:i*.75})})]}):e.jsx(e.Fragment,{children:a.id})}function le({rows:a,onUpdateCard:i,weapons:s,evidence:l,locations:r,victims:p,scenes:d}){const{queryParams:m,addParams:o}=I(),t=m.get("type"),n=[{key:"all",label:"All",children:e.jsx(f,{onUpdateCard:i,rows:a,scenes:d})},{key:"weapons",label:"Weapons",children:e.jsx(f,{onUpdateCard:i,rows:s,scenes:d})},{key:"evidence",label:"Evidence",children:e.jsx(f,{onUpdateCard:i,rows:l,scenes:d})},{key:"locations",label:"Locations",children:e.jsx(f,{onUpdateCard:i,rows:r,scenes:d})},{key:"victims",label:"Victims",children:e.jsx(f,{onUpdateCard:i,rows:p,scenes:d})}],c=u=>{o({type:u,page:"1"})};return e.jsx("div",{className:"my-4",children:e.jsx(q,{defaultActiveKey:t||"all",items:n,onChange:c})})}function f({rows:a,onUpdateCard:i,scenes:s}){const l=w(),r=_({total:a.length,showQuickJumper:!0}),p=(t,n,c)=>{const u=x.cloneDeep(c);u.name[n]=t,i(u)},d=[T.EXPAND_COLUMN,{title:"Id",dataIndex:"id",key:"id",render:t=>e.jsxs("span",{children:[t,e.jsx(R,{content:t})]}),sorter:(t,n)=>t.id.localeCompare(n.id)},{title:"Card",dataIndex:"itemId",key:"itemId",render:(t,n)=>e.jsxs(h,{align:"center",gap:8,children:[e.jsx(ne,{cardWidth:70,item:n}),e.jsx("div",{children:e.jsx(G,{defaultValue:n.itemId,onBlur:c=>{var u,j,N,E;if(console.log((u=c==null?void 0:c.target)==null?void 0:u.value),console.log("onBlur"),(j=c==null?void 0:c.target)!=null&&j.value&&((N=c==null?void 0:c.target)==null?void 0:N.value)!==n.itemId){const L=x.cloneDeep(n);L.itemId=(E=c==null?void 0:c.target)==null?void 0:E.value,i(L)}},size:"small"})})]})},{title:"Name",dataIndex:"name",key:"name",sorter:(t,n)=>t.name.en.localeCompare(n.name.en),render:(t,n)=>e.jsxs(O,{direction:"vertical",style:{minWidth:150},children:[e.jsx(C,{language:"en",onPressEnter:c=>{var u;return p(((u=c.target)==null?void 0:u.value)||n.name.en,"en",n)},value:t}),e.jsx(C,{language:"pt",onPressEnter:c=>{var u;return p(((u=c.target)==null?void 0:u.value)||n.name.pt,"pt",n)},value:t})]})},{title:"Type",dataIndex:"type",key:"type",render:t=>e.jsx("span",{children:t}),sorter:(t,n)=>t.type.localeCompare(n.type)}],m=z({maxExpandedRows:1,expandedRowRender:t=>e.jsx(de,{card:t,scenes:s})}),o=()=>{if(r){const{current:t=1,pageSize:n=10}=r,c=a.slice((t-1)*n,t*n),u=[];c.forEach((j,N)=>{u.push(`${N+1}) ${j.name.en}}`)}),console.log(u),l(u.join(`
`))}};return e.jsxs("div",{className:"my-4",children:[e.jsxs(O,{className:"mb-4",children:[e.jsxs(S,{children:[a.length," cards total"]}),e.jsx(F,{onClick:o,children:"Copy Page Cards"})]}),e.jsx(T,{columns:d,dataSource:a,expandable:m,pagination:r,rowKey:"id"})]})}function de({card:a,scenes:i}){return e.jsxs("div",{children:[e.jsx(S.Title,{level:5,children:"Scene Likelihood"}),e.jsx("div",{className:"likelihood",children:Object.values(i).map(s=>{var t,n,c,u,j;const[l,r]=((t=a.likelihood)==null?void 0:t[s.id])??[],p=l!==void 0,d=(c=(n=s.values)==null?void 0:n[l])==null?void 0:c.en,m=r!==void 0,o=(j=(u=s.values)==null?void 0:u[r])==null?void 0:j.en;return e.jsxs("div",{className:"likelihood-entry",children:[e.jsx("div",{className:"bold",children:s.title.en}),e.jsx("div",{className:k("likely-result",{"likely-result--no-data":!p||!d}),children:d||"No most likely value"}),e.jsx("div",{className:k("likely-result--2",{"likely-result--no-data":!m||!o}),children:o||"No second most likely value"})]},s.id)})})]})}function ce({sceneQuery:a,objects:i}){const s=w(),l=Object.values(a.data??[]),r=_({total:l.length,showQuickJumper:!0}),p=o=>{const t=[];t.push(`"${o.description.en}"`),o.values.forEach((n,c)=>{t.push(`${c}) ${n.en}`)}),s(t.join(`
`))},d=[{title:"Id",dataIndex:"id",key:"id",render:o=>e.jsxs("span",{children:[o,e.jsx(R,{content:o})]}),sorter:(o,t)=>o.id.localeCompare(t.id)},{title:"Title",dataIndex:"title",key:"title",render:(o,t)=>e.jsxs(O,{direction:"vertical",style:{minWidth:150},children:[e.jsx(C,{language:"en",readOnly:!0,value:t.title}),e.jsx(C,{language:"pt",readOnly:!0,value:t.title})]})},{title:"Type",dataIndex:"type",key:"type",render:o=>e.jsx("span",{children:o}),sorter:(o,t)=>o.type.localeCompare(t.type)},T.EXPAND_COLUMN,{title:"Options",dataIndex:"values",key:"tags",render:(o,t)=>e.jsxs(e.Fragment,{children:[e.jsx(F,{onClick:()=>p(t),children:"Copy options"}),e.jsx("ul",{children:o.map(n=>e.jsx("li",{children:e.jsxs(S,{children:[n.en," / ",n.pt]})},n.en))})]})}],m=z({maxExpandedRows:1,expandedRowRender:o=>e.jsx(me,{objects:i,scene:o})});return e.jsxs("div",{className:"my-4",children:[e.jsx(S.Title,{className:"my-0",level:2,children:"Scenes"}),e.jsx(T,{columns:d,dataSource:l,expandable:m,pagination:r,rowKey:"id"})]})}function me({scene:a,objects:i}){const s=b.useMemo(()=>{let l=0;const r={};return i.forEach(d=>{var m;if((m=d.likelihood)!=null&&m[a.id]){const t=d.likelihood[a.id][0];r[t]=(r[t]||0)+1,l+=1}}),Object.entries(r).map(([d,m])=>({value:d,percentage:m/l*100}))},[i,a.id]);return e.jsxs("div",{children:[e.jsxs("h3",{children:[a.title.en," / ",a.title.pt]}),e.jsx("ul",{children:s.map(({value:l,percentage:r})=>e.jsxs("li",{children:[e.jsx(X,{children:a.values[Number(l)].en})," ",r.toFixed(2),"%"]},l))})]})}function pe({weaponsQuery:a,evidenceQuery:i,scenesQuery:s,locationsQuery:l,victimsQuery:r}){const{is:p,queryParams:d}=I(),m=b.useMemo(()=>[...Object.values(a.data),...Object.values(i.data),...Object.values(l.data),...Object.values(r.data)],[a.data,i.data,l.data,r.data]),o=t=>{if(t.type==="weapon")a.addEntryToUpdate(t.id,t);else if(t.type==="evidence")i.addEntryToUpdate(t.id,t);else throw new Error("Invalid card type")};return e.jsxs(e.Fragment,{children:[(p("display","cards")||!d.has("display"))&&e.jsx(le,{evidence:Object.values(i.data),locations:Object.values(l.data),onUpdateCard:o,rows:m,scenes:s.data,victims:Object.values(r.data),weapons:Object.values(a.data)}),p("display","tags")&&e.jsx(U,{closable:!0,message:"Tags table is not implemented yet",showIcon:!0,type:"info"}),p("display","scenes")&&e.jsx(ce,{objects:m,sceneQuery:s})]})}function ue({weaponsQuery:a,evidenceQuery:i,scenesQuery:s,locationsQuery:l,victimsQuery:r}){const{queryParams:p,addParam:d,addParams:m,is:o}=I();return e.jsxs(Q,{children:[e.jsxs(h,{gap:12,vertical:!0,children:[e.jsxs(h,{gap:6,children:[e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Weapons"}),e.jsx(v,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(g,{block:!0,data:()=>D(a.data),disabled:a.isDirty,fileName:"crime-weapons.json",hasNewData:a.hasFirestoreData,children:"JSON"})]}),e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Evidence"}),e.jsx(v,{dirt:JSON.stringify(i.entriesToUpdate),isDirty:i.isDirty,isSaving:i.isSaving,onSave:i.save,size:"middle"}),e.jsx(g,{block:!0,data:()=>D(i.data),disabled:i.isDirty,fileName:"crime-evidence.json",hasNewData:i.hasFirestoreData,children:"JSON"})]})]}),e.jsxs(h,{gap:6,children:[e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Locations"}),e.jsx(v,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(g,{block:!0,data:()=>D(l.data),disabled:a.isDirty,fileName:"crime-locations.json",hasNewData:a.hasFirestoreData,children:"JSON"})]}),e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Victims"}),e.jsx(v,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(g,{data:()=>D(r.data),disabled:a.isDirty,fileName:"crime-victims.json",hasNewData:a.hasFirestoreData,children:"JSON"})]})]}),e.jsx("span",{children:"Scenes"}),e.jsx(v,{dirt:JSON.stringify(s.entriesToUpdate),isDirty:s.isDirty,isSaving:s.isSaving,onSave:s.save}),e.jsx(g,{block:!0,data:()=>xe(s.data),disabled:s.isDirty,fileName:"crime-scenes.json",hasNewData:s.hasFirestoreData})]}),e.jsx(W,{}),e.jsx(Y,{label:"Display",onChange:t=>m({display:t,page:1},{page:1}),options:[{title:"Cards",icon:e.jsx(ee,{}),value:"cards"},{title:"Tags",icon:e.jsx(oe,{}),value:"tags"},{title:"Scenes",icon:e.jsx(ae,{}),value:"scenes"}],value:p.get("display")??"listing"}),o("display","item")&&e.jsx(Z,{label:"No Groups Only",onChange:t=>d("emptyOnly",t,!1),value:o("emptyOnly")})]})}function D(a){console.log("Preparing file for download...");const i=x.cloneDeep(a);return Object.values(i).forEach(s=>{s.likelihood||(s.likelihood={})}),$(i)}function xe(a){console.log("Preparing scenes file for download...");const i=x.cloneDeep(a);return $(i)}function oa(){const a=y({tdrResourceName:"crime-weapons",firestoreDataCollectionName:"crimeWeapons",serialize:!0}),i=y({tdrResourceName:"crime-evidence",firestoreDataCollectionName:"crimeEvidence",serialize:!0}),s=y({tdrResourceName:"crime-locations",firestoreDataCollectionName:"crimeLocations",serialize:!0}),l=y({tdrResourceName:"crime-victims",firestoreDataCollectionName:"crimeVictims",serialize:!0}),r=y({tdrResourceName:"crime-scenes",firestoreDataCollectionName:"crimeScenes",serialize:!0}),p=ie("items");return b.useEffect(()=>{const d=Object.values(r.data).map(m=>({id:m.id,title:m.title.en,description:m.description.en,values:m.values.map(o=>o.en)}));x.isEmpty(d)||console.log("Slim Scenes for GPT:",d)},[r.data]),e.jsx(A,{subtitle:"Categorizer",title:"Crimes Hediondos",children:e.jsxs(P,{hasSider:!0,children:[e.jsx(K,{children:e.jsx(ue,{evidenceQuery:i,locationsQuery:s,scenesQuery:r,victimsQuery:l,weaponsQuery:a})}),e.jsx(P.Content,{className:"content",children:e.jsx(te,{error:a.error||i.error||r.error||p.error||s.error||l.error,hasResponseData:!x.isEmpty(a.data)&&!x.isEmpty(i.data)&&!x.isEmpty(r.data)&&!x.isEmpty(s.data)&&!x.isEmpty(l.data)&&!x.isEmpty(p.data),isLoading:a.isLoading||i.isLoading||r.isLoading||s.isLoading||l.isLoading||p.isLoading,children:e.jsx(pe,{evidenceQuery:i,locationsQuery:s,scenesQuery:r,victimsQuery:l,weaponsQuery:a})})})]})})}export{oa as default};
