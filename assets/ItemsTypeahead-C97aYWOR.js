import{r as m,j as x}from"./index-ClMoIjJ-.js";import{u as b}from"./useTDResource-D1CzKPY8.js";import{l as E}from"./useBaseUrl-CoCZ9vEc.js";import{u as P}from"./useDebounce-BDe8LsIT.js";import{A as R}from"./index-CrxOa4YX.js";import{I as w}from"./index-BdklHplT.js";function Q({items:c,isPending:f,style:C,size:A,placeholder:S,allowClear:$,onFinish:u,onFinishMultiple:p,...g}){const O=b("items",!c&&!f),{namesDict:i,options:j}=m.useMemo(()=>{console.log("Recomputing item names typeahead...");const s=Object.values(c??O.data??{}).reduce((r,e)=>{const o=`${e.name.en} (${e.id})`,d=`${e.name.pt} (${e.id})`;return r[o]=e.id,r[d]=e.id,e.aliasesEn&&e.aliasesEn.forEach(a=>{r[`${a} (${e.id})*`]=e.id}),e.aliasesPt&&e.aliasesPt.forEach(a=>{r[`${a} (${e.id})*`]=e.id}),r},{}),t=E.orderBy(Object.keys(s),[r=>r.toLowerCase()]).map(r=>({value:r}));return{namesDict:s,options:t}},[c,f]),[n,h]=m.useState([]),[l,D]=m.useState("");P(()=>{l&&I(l)},500,[l]);const I=s=>{if(!s){h([]);return}const t=s.trim().toUpperCase(),r=j.filter(o=>String((o==null?void 0:o.value)??"").toUpperCase().includes(t)),e=E.orderBy(r,[o=>{const d=String((o==null?void 0:o.value)??"").toUpperCase();if(d===t)return 0;const a=d.match(/\((.*?)\)/);if(a&&a[1]===t)return 1;const v=d.indexOf(t);return v===0?2:v>0?3:4}]);h(e)},T=()=>{if(n.length>0){const s=n.map(t=>i[t.value]).filter(Boolean);p&&s.length>0?p(s):i[n[0].value]!==void 0&&u(i[n[0].value])}},U=s=>{i[s]!==void 0&&u(i[s])};return x.jsx(R,{allowClear:$??!0,filterOption:(s,t)=>String((t==null?void 0:t.value)??"").toUpperCase().indexOf(s==null?void 0:s.toUpperCase())!==-1,notFoundContent:l.length>0?"No items found":"Type to search...",onSearch:D,onSelect:U,options:n,placeholder:S??"Search by name or id...",style:{width:250,...C},...g,children:x.jsx(w,{onPressEnter:T})})}export{Q as I};
