import{r as u,q as H,s as V,j as e,a as w,F as I,B as E,D as k,E as $,T as f,a3 as J,P as Q,L as R}from"./index-CanllrSk.js";import{D as _}from"./DataLoadingWrapper-vXoV61ey.js";import{u as A}from"./useQueryParams-XgA6jFDT.js";import{l as S,P as K}from"./useBaseUrl-B43mDP-v.js";import{I as W}from"./IdTag-CG-kNEi0.js";import{u as G}from"./useTablePagination-CrFBxJLc.js";import{I as N}from"./ImageCard-CpJ-D51F.js";import{u as X}from"./useDebounce-wk92xX8_.js";import{A as Y}from"./index-BqyVy3oY.js";import{F as Z}from"./Table-Bz_8HMI1.js";import{S as q}from"./index-D2ksPqDf.js";import{h as U,r as ee,a as se}from"./index-TCzX2xix.js";import{u as ae}from"./useImageCardsDecks-BU67e95q.js";import{S as T}from"./index-mHHXKI02.js";import{R as L}from"./PlusOutlined-ByV4qAjn.js";import{T as C}from"./index-D5DOv0Jq.js";import{F as te}from"./FilterEntries-B4PKao0P.js";import{S as re}from"./SiderContent-DYn-Om6c.js";import{D as oe}from"./DownloadButton-DFPgTM7o.js";import{S as ne}from"./SaveButton-h6LhOIa-.js";import{R as ie}from"./TableOutlined-ByoGFlxG.js";import{u as de}from"./useResourceFirestoreData-JW1TlUiD.js";import"./useCopyToClipboardFunction-B4hkKLUF.js";import"./index-B7Nx7_fE.js";import"./index-daj5-_0A.js";import"./index-CCcOHLLg.js";import"./scrollTo-DD1Er_35.js";import"./Pagination-DseXutt5.js";import"./constants-C9NZ99od.js";import"./Item-CO6fyZEj.js";import"./useTDResource-CRRJlTEU.js";import"./index-2YQ9aqP_.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-Bp0Ps0LL.js";import"./useGetFirestoreDoc-Bsapsowp.js";import"./useUpdateFirestoreDoc-OXPFzs9H.js";import"./useMutation-BFSNhaud.js";var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"},le=function(r,a){return u.createElement(H,V({},r,{ref:a,icon:ce}))},me=u.forwardRef(le);function D({sets:s,addEntryToUpdate:r,hidePagination:a}){const d=G({total:s.length,showQuickJumper:!0}),i=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,t)=>o.id.localeCompare(t.id)},{title:"Passcode",dataIndex:"passcode",key:"passcode",sorter:(o,t)=>o.passcode[0].localeCompare(t.passcode[0]),render:(o,t)=>e.jsx(pe,{addEntryToUpdate:r,entry:t})},{title:"Cards",dataIndex:"imageCardsIds",key:"imageCardsIds",render:(o,t)=>e.jsx(ue,{addEntryToUpdate:r,entry:t})}];return e.jsx(Z,{className:"my-4",columns:i,dataSource:s,pagination:a?void 0:d,rowKey:"id"})}function pe({entry:s,addEntryToUpdate:r}){const a=d=>{r(s.id,{...s,passcode:d})};return e.jsx(q,{defaultValue:s.passcode,mode:"tags",onChange:a,placeholder:"Add passcode from easier to harder",style:{width:300}})}function ue({entry:s,addEntryToUpdate:r}){const[a,d]=u.useState(""),i=()=>{a&&(r(s.id,{...s,imageCardsIds:[...s.imageCardsIds,a.trim()]}),d(""))},o=t=>{r(s.id,{...s,imageCardsIds:s.imageCardsIds.filter(n=>n!==t)})};return e.jsxs(I,{align:"flex-end",gap:6,wrap:"wrap",children:[s.imageCardsIds.map(t=>e.jsxs(I,{gap:2,vertical:!0,children:[e.jsx(N,{cardId:t,width:60}),e.jsx(W,{children:t}),e.jsx(E,{onClick:()=>o(t),size:"small",children:"Remove"})]},t)),e.jsx("div",{children:e.jsx(w,{onChange:t=>d(t.target.value),onPressEnter:i,placeholder:"td-d*",style:{width:100},value:a})})]})}function M(s,r=!1){return u.useMemo(()=>{console.log("Recomputing passcode names typeahead...");const a={},d=Object.values(s).reduce((o,t)=>(t.passcode.forEach(n=>{const h=r?`${n} (${t.id})`:n;o[h]&&console.warn(`Duplicate passcode found: ${n}`,o[h],t.id),o[h]=t.id,t.imageCardsIds.forEach(p=>{a[p]||(a[p]=[]),a[p].push(n)})}),o),{}),i=S.orderBy(Object.keys(d),[o=>o.toLowerCase()]).map(o=>({value:o}));return{namesDict:d,options:i,imagesDict:a}},[s,r])}function he({data:s,onFinish:r}){const{namesDict:a,options:d}=M(s,!0),[i,o]=u.useState([]),[t,n]=u.useState("");X(()=>{t&&h(t)},500,[t]);const h=g=>{if(!g){o([]);return}const x=g.trim().toUpperCase(),y=d.filter(c=>String(c?.value??"").toUpperCase().includes(x)),v=S.orderBy(y,[c=>{const m=String(c?.value??"").toUpperCase();if(m===x)return 0;const l=m.match(/\((.*?)\)/);if(l&&l[1]===x)return 1;const P=m.indexOf(x);return P===0?2:P>0?3:4}]);o(v)},p=()=>{i.length>0&&a[i[0].value]!==void 0&&r(a[i[0].value])},j=g=>{a[g]!==void 0&&r(a[g])};return e.jsx(Y,{allowClear:!0,filterOption:(g,x)=>String(x?.value??"").toUpperCase().indexOf(g?.toUpperCase())!==-1,notFoundContent:t.length>0?"No items found":"Type to search...",onSearch:n,onSelect:j,options:i,placeholder:"Search...",style:{width:250},children:e.jsx(w,{onPressEnter:p})})}const B={id:"",passcode:[],imageCardsIds:[]},F=(s,r)=>Array.from({length:s},()=>({...S.cloneDeep(B),id:U(r)}));function ge(s){const[r,a]=u.useState(F(3,Object.keys(s.data))),d=()=>{a(n=>[...n,{...S.cloneDeep(B),id:crypto.randomUUID().substring(0,5)}])},i=(n,h)=>{a(p=>p.map(j=>j.id===n?h:j))},o=()=>{console.log("Add entries to database"),r.forEach(n=>{n.passcode.length>0&&n.imageCardsIds.length>0&&s.addEntryToUpdate(n.id,n)}),a(F(5,Object.keys(s.data)))},t=u.useMemo(()=>r.some(n=>n.passcode.length>0||n.imageCardsIds.length>0),[r]);return e.jsxs(T,{className:"full-width",direction:"vertical",children:[e.jsx(E,{disabled:!t,onClick:o,type:"primary",children:"Add Entries"}),e.jsx(D,{addEntryToUpdate:i,sets:r}),e.jsx(E,{icon:e.jsx(L,{}),onClick:d,children:"Add row"}),e.jsx(k,{}),e.jsx(xe,{addEntryToUpdate:s.addEntryToUpdate,data:s.data})]})}function xe({data:s,addEntryToUpdate:r}){const[a,d]=u.useState(""),[i,o]=u.useState(""),{namesDict:t,imagesDict:n}=M(s),{onRandomCard:h}=ae(),[p,j]=u.useState(""),{message:g}=$.useApp(),x=()=>{a&&o(a)},y=()=>{const c=h();o(c),d(c)},v=()=>{const c=p.split(",").map(m=>m.trim().toLowerCase()).filter(Boolean);c.length>0&&i&&c.forEach(m=>{if(t[m]){const l=s[t[m]];l.imageCardsIds.push(i),l.imageCardsIds=ee(l.imageCardsIds),r(l.id,l)}else{const l={id:U(Object.keys(s)),passcode:[m],imageCardsIds:[i]};r(l.id,l)}}),j(""),y(),g.success("Entries processed")};return e.jsxs(e.Fragment,{children:[e.jsx(f.Title,{className:"my-0",level:4,children:"Create Image Card Multiprompt"}),e.jsxs(T,{className:"full-width",children:[e.jsxs(I,{gap:8,vertical:!0,children:[e.jsxs(I,{children:[e.jsx(w,{onChange:c=>d(c.target.value),onPressEnter:x,placeholder:"Image Card ID",value:a}),e.jsx(E,{onClick:y,children:"Random"})]}),e.jsx(N,{cardId:i,width:200})]}),e.jsxs(I,{gap:8,vertical:!0,children:[e.jsxs(I,{children:[e.jsx(w,{onChange:c=>j(c.target.value),placeholder:"Names",value:p}),e.jsx(E,{disabled:!i||!p,onClick:v,type:"primary",children:"Process"})]}),e.jsx(I,{gap:8,wrap:!0,children:p.split(",").map(c=>{const m=c.trim().toLowerCase(),l=t[m];return e.jsx(C,{color:l?"blue":"green",icon:l?e.jsx(J,{}):e.jsx(L,{}),children:m},m)})}),e.jsx(I,{gap:8,wrap:!0,children:n[i]&&e.jsxs(e.Fragment,{children:[e.jsx(f.Text,{type:"secondary",children:"Already in:"}),n[i]?.map(c=>e.jsx(C,{children:c},c))]})})]})]})]})}function je(s){const{is:r,queryParams:a}=A();return e.jsxs(e.Fragment,{children:[(r("display","table")||!a.has("display"))&&e.jsx(fe,{...s}),r("display","create")&&e.jsx(ge,{...s})]})}function fe(s){const r=u.useMemo(()=>S.orderBy(Object.values(s.data),["id","passcode"]),[s.data]),[a,d]=u.useState();return e.jsxs(T,{className:"full-width my-4",direction:"vertical",children:[e.jsx(he,{data:s.data,onFinish:i=>d(i)}),a&&e.jsxs(e.Fragment,{children:[e.jsx(D,{addEntryToUpdate:s.addEntryToUpdate,hidePagination:!0,sets:[s.data[a]]}),e.jsx(E,{onClick:()=>d(null),size:"small",children:"Clear search"})]}),e.jsx(D,{addEntryToUpdate:s.addEntryToUpdate,sets:r})]})}function Ce({data:s,save:r,isDirty:a,isSaving:d,entriesToUpdate:i,hasFirestoreData:o}){const{addParams:t,queryParams:n}=A(),{complete:h,incomplete:p,varied:j,mappings:g,mappedImages:x,overdone:y}=u.useMemo(()=>{let v=0,c=0,m=0,l=0,P=0;const O={};return Object.values(s).forEach(b=>{b.imageCardsIds.length>=3&&v++,b.imageCardsIds.length>4&&m++,b.imageCardsIds.length<3&&c++,b.passcode.length>3&&l++,P+=b.imageCardsIds.length,b.imageCardsIds.forEach(z=>{O[z]=!0})}),{complete:v,incomplete:c,varied:l,mappings:P,mappedImages:Object.keys(O).length,overdone:m}},[s]);return e.jsxs(re,{children:[e.jsxs(I,{gap:12,vertical:!0,children:[e.jsx(ne,{dirt:JSON.stringify(i),isDirty:a,isSaving:d,onSave:r}),e.jsx(oe,{block:!0,data:()=>Ie(s),disabled:a,fileName:"daily-passcode-sets.json",hasNewData:o})]}),e.jsx(k,{}),e.jsx(te,{label:"Display",onChange:v=>t({display:v,page:1},{page:1,display:"table"}),options:[{title:"Table",icon:e.jsx(ie,{}),value:"table"},{title:"Create",icon:e.jsx(me,{}),value:"create"}],value:n.get("display")??"table"}),e.jsx("p",{children:"Stats"}),e.jsxs(f.Text,{children:["Passcode sets: ",e.jsx(C,{children:Object.keys(s).length})]}),e.jsx("br",{}),e.jsxs(f.Text,{children:["Complete: ",e.jsx(C,{color:"green-inverse",children:h})]}),e.jsx("br",{}),e.jsxs(f.Text,{children:["Incomplete: ",e.jsx(C,{color:"gold-inverse",children:p})]}),e.jsx("br",{}),e.jsxs(f.Text,{children:["Overdone: ",e.jsx(C,{color:"purple",children:y})]}),e.jsx("br",{}),e.jsxs(f.Text,{children:["Varied: ",e.jsx(C,{children:j})]}),e.jsx("br",{}),e.jsxs(f.Text,{children:["Mappings: ",e.jsx(C,{children:g})]}),e.jsx("br",{}),e.jsxs(f.Text,{children:["Unique images: ",e.jsx(C,{children:x})]})]})}function Ie(s){console.log("Preparing file for download...");const r=S.cloneDeep(s);return se(r)}function rs(){const s=de({tdrResourceName:"daily-passcode-sets",firestoreDataCollectionName:"imagePasscode",serialize:!0});return e.jsx(Q,{subtitle:"Daily Set Entries",title:"Image Cards Passcode Sets",children:e.jsxs(R,{hasSider:!0,children:[e.jsx(K,{children:e.jsx(Ce,{...s})}),e.jsx(R.Content,{className:"content",children:e.jsx(_,{error:s.error,hasResponseData:!S.isEmpty(s.data),isLoading:s.isLoading,children:e.jsx(je,{...s})})})]})})}export{rs as ImageCardsPasscode,rs as default};
