import{u as G,D as Q,a as w}from"./useParsedHistory-DN7rqNmV.js";import{u as v}from"./useTDResource-BoO3ytz8.js";import{l as u}from"./useBaseUrl-BpXt1jR3.js";import{a7 as L,a8 as M,r as R}from"./index-pwMPEs54.js";import{c as j}from"./constants-OYCK7fF1.js";const h=new M({}),N=(t,n)=>{h.setState(s=>({...s,[t]:n}))},U=()=>{h.setState(()=>({}))},_=()=>L(h,()=>h.state),q=(t,n,s,r)=>{const[l]=G(Q.QUARTETOS,r),c=v("daily-quartet-sets",t),i=v("items-groups",t);return{entries:R.useMemo(()=>!t||c.isLoading||i.isLoading||!l?{}:k(s,l,n,c.data,i.data),[t,n,l,s,c.dataUpdatedAt,i.dataUpdatedAt]),isLoading:c.isLoading||i.isLoading}},k=(t,n,s,r,l)=>{console.count("Creating Quartetos...");const c=u.shuffle(Object.values(r).filter(m=>m.itemsIds.length>=4&&!n.used.includes(m.id)&&!m.flagged));let i=n.latestDate;const o={},f=x(c,5);return Array.from({length:t}).forEach((m,g)=>{const d=[],I={};for(let e=0;e<3;e++){const a=f[g*3+e];a&&(d.push({id:a.id,title:a.title,itemsIds:u.sampleSize(a.itemsIds,4),level:a.level??1}),a.itemsIds.forEach(b=>{I[b]=!0}))}const S=u.shuffle(Object.values(l)).filter(e=>e.itemsIds.length>=6&&!e.itemsIds.some(a=>I[a]));if(S.length>0){const e=u.sampleSize(S,1)[0];d.push({id:e.id,title:`${u.capitalize(e.name[s])}*`,itemsIds:u.sampleSize(e.itemsIds,4),level:1})}if(d.length<4)throw new Error("Kaboom! Could not get 4 sets");const E=Math.ceil(d.reduce((e,a)=>e+a.level,0)/d.length),y=u.orderBy(d,["level"],["asc"]).map((e,a)=>(e.level=a,e)),A=d.map(e=>e.id).join(j),D=u.shuffle(d.flatMap(e=>e.itemsIds)),p=w(i);i=p,o[p]={id:p,number:n.latestNumber+g+1,setId:A,type:"quartetos",grid:D,difficulty:E,sets:y}}),o},x=(t,n=5)=>{if(t.length<=1)return t;const s=[t[0]],r=t.slice(1);for(;r.length>0;){const l=new Set,c=Math.min(s.length,n);for(let o=1;o<=c;o++)s[s.length-o].itemsIds.forEach(m=>l.add(m));let i=!1;for(let o=0;o<r.length;o++){const f=r[o];if(!f.itemsIds.some(g=>l.has(g))){s.push(f),r.splice(o,1),i=!0;break}}!i&&r.length>0&&(s.push(r[0]),r.splice(0,1))}return s};export{N as a,_ as b,U as c,q as u};
