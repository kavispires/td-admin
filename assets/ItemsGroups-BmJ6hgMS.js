import{j as e,T as v,r as b,D as R,P as k,L as w}from"./index-BcpMPOAg.js";import{D as E}from"./DataLoadingWrapper-Cb888-Fx.js";import{u as B,P as L}from"./useGridPagination-1aLL9hCJ.js";import{I as Q}from"./Item-DkDVx9Fs.js";import{u as D}from"./useCopyToClipboardFunction-BM64UHih.js";import{u as C}from"./useQueryParams-Dy4QSqde.js";import{u as S}from"./useTDResource-D9INFiCY.js";import{l as y}from"./lodash-B_GpjCgW.js";import{r as I,h as W,a as A}from"./index-C0rILB8_.js";import{T as M}from"./TransparentButton-BUJvVicD.js";import{D as T}from"./EditableFields-C9MnEPSH.js";import{u as $}from"./useTablePagination-CSP-YlsE.js";import{C as z}from"./CopyIdsButton-BvhFCT-l.js";import{I as J}from"./ItemsTypeahead-BdhbZXMx.js";import{I as q,b as F,d as K}from"./ItemBuildingBlocks-xtuoZ3Qf.js";import{C as U}from"./index-DitlW1w1.js";import{S as V}from"./index-Dgz3u-ss.js";import{S as X}from"./index-CievdN-s.js";import{F as G}from"./Table-NDTOWd25.js";import{F as g}from"./index-CvollKDQ.js";import{D as _}from"./index-DpXreo2o.js";import{R as H,C as Y}from"./index-CS0G3aBP.js";import{F as Z,c as ee}from"./FilterEntries-CknB04Jo.js";import{S as se}from"./SiderContent-JvxUDyEO.js";import{D as te}from"./DownloadButton-CuwcBA80.js";import{S as re}from"./SaveButton-DgrAWeEW.js";import{R as oe}from"./ClusterOutlined-DeLmMR-P.js";import{R as ie}from"./TableOutlined-Jqu1X4Yx.js";import{P as ae}from"./useBaseUrl-VNOUWM6_.js";import{u as ne}from"./useResourceFirebaseData-C0-K6THW.js";import"./Pagination-Br-dN2Q5.js";import"./constants-CDABhm8f.js";import"./LanguageFlag-C1u0qMtj.js";import"./index-D26Mw3Et.js";import"./Input-DTnEziXo.js";import"./index-BMo2W_I8.js";import"./FireFilled-C8cwD51i.js";import"./IdcardOutlined-BvpdvmLt.js";import"./useDebounce-SpRY2kTB.js";import"./PlusOutlined-SX4cjdA7.js";import"./gapSize-U1swVQyS.js";import"./index-152sXHsr.js";import"./index-DUuJIBpB.js";import"./index-BUdJ8DRP.js";import"./scrollTo-JemKOqnf.js";import"./extendsObject-keMuGWqj.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-C8xYw-EB.js";import"./useGetFirebaseDoc-CRdbVXDQ.js";import"./useUpdateFirebaseDoc-Byynv72i.js";import"./useMutation-VLxkg5Mr.js";function O({item:s,itemGroups:t,groupsTypeahead:m,onUpdateItemGroups:c}){const u=D();return e.jsxs(U,{title:e.jsxs(e.Fragment,{children:[e.jsx(v.Text,{onClick:()=>u(s.id),children:s.id}),e.jsx(K,{item:s})]}),style:{maxWidth:250},children:[e.jsx(q,{item:s,width:75}),e.jsxs(V,{size:"small",direction:"vertical",className:"my-4",children:[e.jsx(F,{item:s,language:"en"}),e.jsx(F,{item:s,language:"pt"}),e.jsx(X,{mode:"tags",style:{width:"100%"},placeholder:"Select a group",defaultValue:t,options:m,showSearch:!0,size:"small",onChange:d=>c(s.id,d)},String(t))]})]})}function me({data:s,addEntryToUpdate:t}){const{is:m,queryParams:c}=C(),u=S("items"),d=b.useMemo(()=>Object.values(s??[]).reduce((r,l)=>(l.itemsIds||console.warn("Group without items",l),l.itemsIds.forEach(p=>{r[p]||(r[p]=[]),r[p].push(l.id)}),r),{}),[s]),x=b.useMemo(()=>y.orderBy(Object.keys(s).map(r=>({label:r,value:r})),"label"),[s]),f=(r,l)=>{const p=d[r]??[],j=l.filter(a=>!p.includes(a)),n=p.filter(a=>!l.includes(a));j.forEach(a=>{const o=s[a];t(a,{...o,itemsIds:I([...(o==null?void 0:o.itemsIds)??[],r])})}),n.forEach(a=>{const o=s[a];t(a,{...o,itemsIds:I(o==null?void 0:o.itemsIds.filter(N=>N!==r))})})},h=(r,l)=>{const p=s[r];t(r,{...p,itemsIds:I(l)})},i=(r,l,p)=>{const j=s[p];t(p,{...j,name:{...j.name,[l]:r}})};return e.jsxs(e.Fragment,{children:[(m("display","group")||!c.has("display"))&&e.jsx(le,{data:s,items:u.data,grousByItem:d,groupsTypeahead:x,onUpdateItemGroups:f,onUpdateGroupItems:h,onUpdateName:i}),m("display","item")&&e.jsx(de,{data:s,items:u.data,grousByItem:d,groupsTypeahead:x,onUpdateItemGroups:f,onUpdateGroupItems:h,onUpdateName:i})]})}function le({data:s,items:t,grousByItem:m,groupsTypeahead:c,onUpdateItemGroups:u,onUpdateGroupItems:d,onUpdateName:x}){const f=D(),h=S("items"),[i,r]=b.useState(null),l=$({showQuickJumper:!0,total:Object.keys(s).length}),p=[{title:"id",dataIndex:"id",key:"id",render:n=>e.jsx("span",{children:n})},{title:"Name",dataIndex:"name",key:"name",render:(n,a)=>e.jsxs(g,{vertical:!0,gap:4,children:[e.jsx(T,{value:n,language:"en",style:{minWidth:150},onChange:o=>x(o.target.value,"en",a.id)}),e.jsx(T,{value:n,language:"pt",style:{minWidth:150},onChange:o=>x(o.target.value,"pt",a.id)})]})},{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(n,a)=>e.jsx(g,{gap:6,wrap:"wrap",children:n.map(o=>e.jsxs(g,{gap:2,vertical:!0,children:[e.jsx(M,{onClick:()=>r(o),children:e.jsx(Q,{id:o,width:60})}),e.jsx(g,{justify:"center",children:e.jsx(v.Text,{onClick:()=>f(o),children:o})})]},`${a.id}-${o}`))},`items-${a.id}`)},G.EXPAND_COLUMN,{title:"Count",dataIndex:"itemsIds",key:"count",render:n=>I(n).filter(Boolean).length},{title:"Actions",dataIndex:"itemsIds",key:"actions",render:n=>e.jsx(z,{ids:n})}],j=i?t[i]:null;return e.jsxs(e.Fragment,{children:[e.jsx(G,{columns:p,dataSource:Object.values(s),className:"my-4",rowKey:"id",pagination:l,expandable:{expandedRowRender:n=>e.jsx(pe,{group:n,onUpdateGroupItems:d}),rowExpandable:()=>h.isSuccess}}),e.jsx(_,{title:"Edit Item Group",onClose:()=>r(null),open:!!j,children:j&&e.jsx(O,{item:j,itemGroups:m[j.id],groupsTypeahead:c,onUpdateItemGroups:u})})]})}function pe({group:s,onUpdateGroupItems:t}){const m=c=>{t(s.id,[...s.itemsIds,c])};return e.jsx("div",{children:e.jsx(J,{onFinish:m})})}function de({items:s,grousByItem:t,groupsTypeahead:m,onUpdateItemGroups:c}){const{is:u}=C(),d=u("emptyOnly"),x=b.useMemo(()=>d?Object.values(s).filter(i=>!t[i.id]):Object.values(s),[s,t,d]),{page:f,pagination:h}=B({data:x});return e.jsxs(e.Fragment,{children:[e.jsxs(v.Title,{level:2,children:["Groups by Items (",x.length,")"]}),e.jsx(L,{pagination:h,children:e.jsx(H,{gutter:[16,16],className:"my-4",children:f.map(i=>e.jsx(Y,{xs:24,sm:24,md:12,lg:6,xl:4,children:e.jsx(O,{item:i,itemGroups:t[i.id],groupsTypeahead:m,onUpdateItemGroups:c})},i.id))})})]})}function ce({data:s,save:t,isDirty:m,isSaving:c,entriesToUpdate:u}){const{queryParams:d,addParam:x,addParams:f,is:h}=C();return e.jsxs(se,{children:[e.jsxs(g,{vertical:!0,gap:12,children:[e.jsx(re,{isDirty:m,onSave:t,isSaving:c,dirt:JSON.stringify(P(u))}),e.jsx(te,{data:()=>ue(s),fileName:"items-groups.json",disabled:m,block:!0})]}),e.jsx(R,{}),e.jsx(Z,{label:"Display",value:d.get("display")??"group",onChange:i=>f({display:i,page:1},{page:1}),options:[{title:"By Groups",icon:e.jsx(oe,{}),value:"group"},{title:"By Items",icon:e.jsx(ie,{}),value:"item"}]}),h("display","item")&&e.jsx(ee,{label:"No Groups Only",value:h("emptyOnly"),onChange:i=>x("emptyOnly",i,!1)})]})}function P(s){return y.omitBy(y.cloneDeep(s),t=>y.isEmpty(t.itemsIds))}function ue(s){return Object.keys(s).forEach(t=>{s[t].itemsIds=W(I(s[t].itemsIds))}),A(P(s))}function ds(){const s=ne({tdrResourceName:"items-groups",firebaseDataCollectionName:"itemsGroups",serialize:!0}),t=S("items");return e.jsx(k,{title:"Items",subtitle:"Groups Sets",children:e.jsxs(w,{hasSider:!0,children:[e.jsx(ae,{children:e.jsx(ce,{...s})}),e.jsx(w.Content,{className:"content",children:e.jsx(E,{isLoading:s.isLoading||t.isLoading,error:s.error||t.error,hasResponseData:!y.isEmpty(s.data)&&!y.isEmpty(t.data),children:e.jsx(me,{...s})})})]})})}export{ds as ItemsGroups,ds as default};
