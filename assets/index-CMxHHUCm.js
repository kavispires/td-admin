import{E as oe,w as t,K as re,x as se,m as E,ba as b}from"./index-Kr2nSB3H.js";import{t as F}from"./throttleByAnimationFrame-mT83l8eq.js";const ie=o=>{const{componentCls:s}=o;return{[s]:{position:"fixed",zIndex:o.zIndexPopup}}},ce=o=>({zIndexPopup:o.zIndexBase+10}),ae=oe("Affix",ie,ce);function S(o){return o!==window?o.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function L(o,s,i){if(i!==void 0&&Math.round(s.top)>Math.round(o.top)-i)return i+s.top}function B(o,s,i){if(i!==void 0&&Math.round(s.bottom)<Math.round(o.bottom)+i){const a=window.innerHeight-s.bottom;return i+a}}const M=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"];function fe(){return typeof window<"u"?window:null}const _=0,H=1,he=t.forwardRef((o,s)=>{const{style:i,offsetTop:a,offsetBottom:l,prefixCls:O,className:U,rootClassName:G,children:V,target:w,onChange:X,onTestUpdatePosition:le,...k}=o,{getPrefixCls:D,className:K,style:j}=re("affix"),{getTargetContainer:q}=t.useContext(se),v=D("affix",O),[T,J]=t.useState(!1),[c,Q]=t.useState(),[W,Y]=t.useState(),y=t.useRef(_),R=t.useRef(null),u=t.useRef(null),d=t.useRef(null),C=t.useRef(null),m=t.useRef(null),f=w??q??fe,A=l===void 0&&a===void 0?0:a,Z=()=>{if(y.current!==H||!C.current||!d.current||!f)return;const r=f();if(r){const e={status:_},n=S(d.current);if(n.top===0&&n.left===0&&n.width===0&&n.height===0)return;const p=S(r),x=L(n,p,A),I=B(n,p,l);x!==void 0?(e.affixStyle={position:"fixed",top:x,width:n.width,height:n.height},e.placeholderStyle={width:n.width,height:n.height}):I!==void 0&&(e.affixStyle={position:"fixed",bottom:I,width:n.width,height:n.height},e.placeholderStyle={width:n.width,height:n.height}),e.lastAffix=!!e.affixStyle,T!==e.lastAffix&&X?.(e.lastAffix),y.current=e.status,Q(e.affixStyle),Y(e.placeholderStyle),J(e.lastAffix)}},N=()=>{y.current=H,Z()},h=F(()=>{N()}),g=F(()=>{if(f&&c){const r=f();if(r&&d.current){const e=S(r),n=S(d.current),p=L(n,e,A),x=B(n,e,l);if(p!==void 0&&c.top===p||x!==void 0&&c.bottom===x)return}}N()}),P=()=>{const r=f?.();r&&(M.forEach(e=>{u.current&&R.current?.removeEventListener(e,u.current),r?.addEventListener(e,g)}),R.current=r,u.current=g)},z=()=>{const r=f?.();M.forEach(e=>{r?.removeEventListener(e,g),u.current&&R.current?.removeEventListener(e,u.current)}),h.cancel(),g.cancel()};t.useImperativeHandle(s,()=>({updatePosition:h})),t.useEffect(()=>(m.current=setTimeout(P),()=>{m.current&&(clearTimeout(m.current),m.current=null),z()}),[]),t.useEffect(()=>(P(),()=>z()),[w,c,T,a,l]),t.useEffect(()=>{h()},[w,a,l]);const[$,ee]=ae(v),te=E(G,$,v,ee),ne=E({[te]:c});return t.createElement(b,{onResize:h},t.createElement("div",{style:{...j,...i},className:E(U,K),ref:d,...k},c&&t.createElement("div",{style:W,"aria-hidden":"true"}),t.createElement("div",{className:ne,ref:C,style:c},t.createElement(b,{onResize:h},V))))});export{he as A};
