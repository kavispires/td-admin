import{r as j,d as z,_ as W,a8 as Q,a7 as X}from"./index-DiQmi0MW.js";import{u as Y,D as J,a as K,c as V,A as P}from"./useParsedHistory-CUKpG8Px.js";import{t as Z,a as ee}from"./useTestimoniesResource-DvyMOYkX.js";import{u as R}from"./useTDResource-B7rQYhkN.js";import{l as p}from"./useBaseUrl-D1bg9UhE.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}},{tag:"path",attrs:{d:"M376.9 656.4c1.8-33.5 15.7-64.7 39.5-88.6 25.4-25.5 60-39.8 96-39.8 36.2 0 70.3 14.1 96 39.8 1.4 1.4 2.7 2.8 4.1 4.3l-25 19.6a8 8 0 003 14.1l98.2 24c5 1.2 9.9-2.6 9.9-7.7l.5-101.3c0-6.7-7.6-10.5-12.9-6.3L663 532.7c-36.6-42-90.4-68.6-150.5-68.6-107.4 0-195 85.1-199.4 191.7-.2 4.5 3.4 8.3 8 8.3H369c4.2-.1 7.7-3.4 7.9-7.7zM703 664h-47.9c-4.2 0-7.7 3.3-8 7.6-1.8 33.5-15.7 64.7-39.5 88.6-25.4 25.5-60 39.8-96 39.8-36.2 0-70.3-14.1-96-39.8-1.4-1.4-2.7-2.8-4.1-4.3l25-19.6a8 8 0 00-3-14.1l-98.2-24c-5-1.2-9.9 2.6-9.9 7.7l-.4 101.4c0 6.7 7.6 10.5 12.9 6.3l23.2-18.2c36.6 42 90.4 68.6 150.5 68.6 107.4 0 195-85.1 199.4-191.7.2-4.5-3.4-8.3-8-8.3z"}}]},name:"cloud-sync",theme:"outlined"},se=function(e,s){return j.createElement(z,W({},e,{ref:s,icon:te}))},Oe=j.forwardRef(se);const U="td-admin-debug-daily",ae=()=>{const t={"aqui-o":!1,"arte-ruim":!1,artista:!1,"comunicacao-alienigena":!1,"controle-de-estoque":!1,espionagem:!1,filmaco:!1,organiku:!1,palavreado:!1,"portais-magicos":!1,quartetos:!1,"ta-na-cara":!1,"teoria-de-conjuntos":!1};try{const e=localStorage.getItem(U);return e?JSON.parse(e):t}catch{return t}},h=new X(ae());h.subscribe(()=>{try{const t={"aqui-o":h.state["aqui-o"],"arte-ruim":h.state["arte-ruim"],artista:h.state.artista,"comunicacao-alienigena":h.state["comunicacao-alienigena"],"controle-de-estoque":h.state["controle-de-estoque"],espionagem:h.state.espionagem,filmaco:h.state.filmaco,organiku:h.state.organiku,palavreado:h.state.palavreado,"portais-magicos":h.state["portais-magicos"],quartetos:h.state.quartetos,"ta-na-cara":h.state["ta-na-cara"],"teoria-de-conjuntos":h.state["teoria-de-conjuntos"]};localStorage.setItem(U,JSON.stringify(t))}catch{}});const ke=(t,e)=>{h.setState(s=>({...s,[t]:!s[t]}))},je=()=>Q(h,()=>h.state),g=(...t)=>{h.state.espionagem&&console.log(...t)},oe=t=>{h.state.espionagem&&console.count(t)},ne=(...t)=>{h.state.espionagem&&console.error(...t)},ie={male:"Ã© homem",female:"Ã© mulher",caucasian:"Ã© branco(a)",black:"Ã© negro(a)",asian:"Ã© asiÃ¡tico(a)",latino:"Ã© latino(a)",thin:"Ã© magrelo(a)",fat:"Ã© gordo(a)",large:"Ã© gordo(a)",tall:"Ã© alto(a)",short:"Ã© baixinho(a)",young:"Ã© jovem",adult:"Ã© adulto(a)",senior:"Ã© da terceira idade",average:"tem corpo normal",medium:"Ã© de altura mÃ©dia",mixed:"Ã© mestiÃ§o(a)",hat:"estÃ¡ usando um chapÃ©u",tie:"estÃ¡ usando uma gravata",glasses:"estÃ¡ usando Ã³culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",scarf:"estÃ¡ usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"Ã© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"Ã© sarado(a)",blackHair:"tem cabelo preto",hoodie:"estÃ¡ usando um moletom",earrings:"estÃ¡ usando brincos",lipstick:"estÃ¡ usando batom",necklace:"estÃ¡ usando um colar",mediumHair:"tem cabelo mÃ©dio","middle-eastern":"Ã© do Oriente MÃ©dio",headscarf:"estÃ¡ usando um lenÃ§o na cabeÃ§a",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"Ã© indiano(a)","native-american":"Ã© nativo-americano(a)",noAccessories:"estÃ¡ sem nenhum acessÃ³rio",avoidingCamera:"estÃ¡ evitando olhar para a cÃ¢mera",wearingStripes:"tem listras na roupa",blackClothes:"estÃ¡ vestindo roupas pretas",blueClothes:"estÃ¡ vestindo roupas azuis",greenClothes:"estÃ¡ vestindo roupas verdes",redClothes:"estÃ¡ vestindo roupas vermelhas",yellowClothes:"estÃ¡ vestindo roupas amarelas",purpleClothes:"estÃ¡ vestindo roupas roxas",orangeClothes:"estÃ¡ vestindo roupas laranjas",brownClothes:"estÃ¡ vestindo roupas marrons",whiteShirt:"estÃ¡ usando camisa branca",pinkClothes:"estÃ¡ vestindo roupas rosas",patternedShirt:"estÃ¡ usando roupa estampada",buttonShirt:"estÃ¡ usando camisa com botÃµes",bow:"estÃ¡ usando um laÃ§o",hairyChest:"estÃ¡ mostrando o peito peludo",wearingFlowers:"estÃ¡ usando flores",showTeeth:"estÃ¡ mostrando os dentes",hairTie:"estÃ¡ usando um xuxinha ou fita no cabelo","non-binary":"Ã© nÃ£o-binÃ¡rio(a)"},$=12,$e=(t,e,s,o)=>{const[a]=Y(J.ESPIONAGEM,o),i=R("suspects",{enabled:t}),n=R(`testimony-questions-${e}`,{enabled:t}),c=R("testimony-answers",{select:Z,enabled:t}),u=R("crime-reasons",{enabled:t}),m=j.useMemo(()=>de(c.data),[c.dataUpdatedAt]),r=j.useMemo(()=>me(i.data),[i.data]);return{entries:j.useMemo(()=>!t||!a||!i.isSuccess||!n.isSuccess||!c.isSuccess||!u.isSuccess?{}:re(s,a,i.data,n.data,m,r,u.data),[t,a,i,n,c,s,m,r,u]),isLoading:i.isLoading||n.isLoading||c.isLoading}},re=(t,e,s,o,a,i,n)=>{oe("Creating Espionagem...");let c=e.latestDate;const u=[],m={};for(let r=0;r<t;r++){const f=K(c);V(f),c=f;let S=null,l=0;for(;S===null&&l<P;)try{l++;const d=ce(s,o,a,i,u,n);pe(d.statements)&&(S=d)}catch{}if(!S)throw new Error(`Failed to generate valid game for ${f} after ${l} attempts`);g(`Generated valid game for ${f} after ${l} attempts`),u.push(S.culpritId),m[f]={id:f,type:"espionagem",number:e.latestNumber+r+1,...S}}return m};function ce(t,e,s,o,a,i){const n=[],c={};g("SuspectTestimonyAnswers",s);const{selectedTestimonyId1:u,selectedTestimonyId2:m,culpritId:r,possibleSuspects:f,impossibleSuspects:S}=fe(s,a);if(f.length<2)throw new Error("Not enough possible suspects");let l=[...f];if(f.length<$-1){const v=p.sampleSize(Object.keys(t).filter(O=>!S.includes(O)&&!f.includes(O)),$-f.length-1);l.push(...v)}const d={};Object.keys(o).forEach(v=>{if(o[v][r]===void 0){const O=Object.keys(o[v]).filter(F=>l.includes(F));if(O.length>0){const F={};O.forEach(L=>{l.includes(L)&&(F[L]=!0)}),d[v]=F}}});const b=e[u],E=G(r,l,b,s[u]);n.push(E),k(c,E.excludes);const x=e[m],w=G(r,l,x,s[m]);n.push(w),k(c,w.excludes);const y=H(r,l,d,[],"best");if(y.excludes.length===$-2)throw new Error("Best feature statement excludes too many suspects");n.push(y),k(c,y.excludes);const I=H(r,l,d,[y],"best");n.push(I);const C=H(r,l,d,[y,I],"worst");n.push(C),k(c,C.excludes);const N=H(r,l,d,[y,I,C],"worst");if(n.push(N),n.length<6)throw new Error("Not enough statements generated");l=p.shuffle([...l,r]);const M=A(r,l,n,"columns");n.push(M),k(c,M.excludes);const _=A(r,l,n,"rows");n.push(_);const D=[E,C,w,y,M,N],T=[I,_],q=be(t[r],i),B=le([...D,...T]);return{isNsfw:b.nsfw||x.nsfw||!1,culpritId:r,statements:D,additionalStatements:T,suspects:ue(l,t,B),reason:q.title,setId:`${r}::${q.id}::${D[0].key}`,level:Se(D)}}const le=t=>{const e={};t.forEach(o=>{if(o.key.includes(".feature.")){const a=o.key.split("not.feature.")[1];e[a]=!0}});const s={hairColor:["brownHair","blondeHair","greyHair","redHair","blackHair","coloredHair"],hairLength:["shortHair","mediumHair","longHair","bald"],facialHair:["beard","mustache","goatee"]};for(const[,o]of Object.entries(s))o.some(a=>e[a])&&o.forEach(a=>{e[a]=!0});return e},ue=(t,e,s)=>t.map(o=>{const a=e[o],i={"18-21":"young","21-30":"adult","30-40":"adult","40-50":"adult","50-60":"senior","60-70":"senior","70-80":"senior","80-90":"senior"}[a.age]||a.age,n=[a.gender,i,a.ethnicity,a.height,a.build],c=a.features.filter(u=>s[u]);return{id:a.id,name:a.name,gender:a.gender,features:[...n,...c]}}),de=t=>{const e={};g("âš™ï¸ Calculating suspect answers...");for(const s of Object.keys(t)){const o=t[s];for(const a of Object.keys(o)){const{resolution:i,projection:n}=ee(a,s,o);if(!(!i&&!n)){if(e[s]===void 0&&(e[s]={}),i){e[s][a]=i==="ðŸ‘";continue}n&&(e[s][a]=n==="ðŸ‘")}}}return Object.keys(e).forEach(s=>{p.isEmpty(e[s])&&delete e[s]}),Object.keys(e).forEach(s=>{Object.keys(e[s]).length<3&&(g("â‰ï¸ Removing testimonies with less than 3 answers"),delete e[s])}),Object.keys(e).forEach(s=>{p.uniq(Object.values(e[s])).length===1&&(g("â‰ï¸ Removing testimonies with the same answer"),delete e[s])}),e},me=t=>{const e={};for(const o of Object.keys(t)){const{gender:a,ethnicity:i,age:n,build:c,height:u,features:m}=t[o];if(!c){g("â‰ï¸ Ignoring suspect with missing build",o);continue}if(!u){g("â‰ï¸ Ignoring suspect with missing height",o);continue}if(!m||m.length===0){g("â‰ï¸ Ignoring suspect with missing features",o);continue}e[a]===void 0&&(e[a]={}),e[a][o]=!0,e[i]===void 0&&(e[i]={}),e[i][o]=!0,e[n]===void 0&&(e[n]={}),e[n][o]=!0,e[c]===void 0&&(e[c]={}),e[c][o]=!0,e[u]===void 0&&(e[u]={}),e[u][o]=!0,m.forEach(r=>{e[r]===void 0&&(e[r]={}),e[r][o]=!0})}return e.young=p.cloneDeep(e["18-21"]),e.adult=p.cloneDeep({...e["21-30"],...e["30-40"],...e["40-50"]}),e.senior=p.cloneDeep({...e["50-60"],...e["60-70"],...e["70-80"],...e["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(o=>{delete e[o]}),e},fe=(t,e)=>{let s=0,o,a,i=[];for(;s<P&&!a&&i.length===0;){if(s++,o=p.sample(Object.keys(t)),!o)throw new Error("Failed to find a testimony");const r=Object.keys(t[o]);if(a=p.sample(Object.keys(t).filter(f=>f!==o&&!p.isEmpty(p.difference(r,Object.keys(t[f]))))),a){i=p.intersection(Object.keys(t[o]),Object.keys(t[a]));break}}if(!o||!a||i.length<3)throw new Error("Failed to find two related testimonies");const n=p.sample(i.filter(r=>!e.includes(r)));if(!n)throw new Error("Failed to determine a culprit from common suspects");g("<===============>"),g(`âš™ï¸ Selected testimonies 1: ${o}`),g(t[o]),g(`âš™ï¸ Selected testimonies 2: ${a}`),g(t[a]),g(`âš™ï¸ Culprit ID: ${n}`),g(`Testimony 1 answers: ${t[o][n]}`),g(`Testimony 2 answers: ${t[a][n]}`);const c=`${t[o][n]}-${t[a][n]}`,u=p.sampleSize(i.filter(r=>r!==n&&`${t[o][r]}-${t[a][r]}`!==c),$-1),m=p.difference(i,u);return g(`âš™ï¸ Possible suspects: ${u.join(", ")}`),g(`âš™ï¸ Impossible suspects: ${m.join(", ")}`),g(`âš™ï¸ Attempts made: ${s}`),g(">===============<"),{selectedTestimonyId1:o,selectedTestimonyId2:a,culpritId:n,possibleSuspects:u,impossibleSuspects:m}},k=(t,e)=>{e.forEach(s=>{t[s]===void 0&&(t[s]=0),t[s]++})},G=(t,e,s,o)=>{const a=o[t],i=e.filter(u=>o[u]!==void 0&&o[u]!==a),n=s.answer.charAt(0).toLowerCase()+s.answer.slice(1),c={key:`testimony.${s.id}`,text:`O(a) suspeito(a) ${a?"":"nÃ£o "}${n}`,excludes:i,type:"testimony"};return c.text.includes("nÃ£o jÃ¡")&&(c.text=c.text.replace("nÃ£o jÃ¡","nunca")),c},ge={column1:{indexes:[0,4,8],text:"na primeira coluna"},column2:{indexes:[1,5,9],text:"na segunda coluna"},column3:{indexes:[2,6,10],text:"na terceira coluna"},column4:{indexes:[3,7,11],text:"na quarta coluna"},corners:{indexes:[0,3,8,11],text:"nos cantos"}},he={row1:{indexes:[0,1,2,3],text:"na primeira linha"},row2:{indexes:[4,5,6,7],text:"na segunda linha"},row3:{indexes:[8,9,10,11],text:"na terceira linha"}},A=(t,e,s,o)=>{const a=e.indexOf(t),i=s.slice(0,3),n=o==="rows"?he:ge,c={};for(const l of Object.keys(n)){const{indexes:d}=n[l];d.includes(a)||(c[l]=d.reduce((b,E)=>{const x=e[E],w=i.filter(y=>y.excludes.includes(x)).length;return w>0?b+w:b},0))}const u=Object.entries(c).reduce((l,[d,b])=>(l[b]||(l[b]=[]),l[b].push(d),l),{}),m=Math.min(...Object.keys(c).map(l=>c[l])),r=u[m.toString()],f=p.sample(r)||Object.keys(c)[0],S=n[f].indexes.map(l=>e[l]);return{key:`not.grid.${f}`,text:`O(a) suspeito(a) nÃ£o estÃ¡ ${n[f].text}`,excludes:S,type:"grid"}},H=(t,e,s,o=[],a="best")=>{const i=p.difference(e,[t]),n=o.filter(d=>d.key.startsWith("not.feature.")).map(d=>d.key.replace("not.feature.","")),c=new Set(o.flatMap(d=>d.excludes)),u=Object.keys(s).filter(d=>Object.keys(s[d]).length<=6&&!n.includes(d)).sort((d,b)=>Object.keys(s[b]).length-Object.keys(s[d]).length);let m,r=[],f=0;const S=500;for(;f<S;){f++;const d=a==="best"?u[0]:p.sample(u.slice(2,5))??u[2];if(!d)break;const b=i.filter(x=>s[d][x]);if(b.some(x=>!c.has(x))||f===S){m=d,r=b;break}u.splice(u.indexOf(d),1)}if(!m)throw Error(`No suitable feature found for ${a} selection after ${S} attempts`);g(`Selected feature after ${f} attempts: ${m}`);const l=ie[m];return l||ne(`Feature ${m} not found in translations`),{key:`not.feature.${m}`,text:`O(a) suspeito(a) nÃ£o ${l||m}`,excludes:r,type:"feature"}},pe=t=>{const e=t.slice(0,3);return e.reduce((a,i)=>a+i.excludes.length,0)<10?!1:new Set(e.flatMap(a=>a.excludes)).size===$-1},be=(t,e)=>{const s=[];Object.values(e).forEach(a=>{a.feature==="general"&&s.push(a),t.features?.includes(a.feature)&&s.push(a)});const o=p.sample(s);return o||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},Se=t=>{const e=t.slice(0,3),s=[],o={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};e.forEach(i=>{const n=i.excludes.length;o[n]!==void 0&&s.push(o[n])});const a=Math.round(s.reduce((i,n)=>i+n,0)/s.length);return Math.min(Math.max(a,1),3)};export{Oe as R,je as a,h as d,ke as t,$e as u};
