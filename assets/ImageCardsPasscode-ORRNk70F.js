import{r as u,a as J,j as e,B as P,D as A,X as Q,T as C,P as V,L as F}from"./index-BHrRQ1uq.js";import{D as _}from"./DataLoadingWrapper-DKkg9HZe.js";import{u as k}from"./useQueryParams-Cr8fZCN0.js";import{l as S}from"./lodash-f0m46xYx.js";import{I as K}from"./IdTag-BlCPBJi1.js";import{u as W}from"./useTablePagination-T_HopZaN.js";import{I as U}from"./ImageCard-DDGT4T7O.js";import{u as X,A as G}from"./useDebounce-Ji8LYoFL.js";import{I as w}from"./index-DuBa27hb.js";import{F as Y}from"./Table-CGPLlxUi.js";import{S as Z}from"./index-CkYVgnOz.js";import{F as v}from"./index-CjtWJUFP.js";import{b as L,r as q,a as ee}from"./index-Rk2ZCQ0l.js";import{u as M}from"./useImageCardsDecks-DdHaIsjg.js";import{S as O}from"./index-Co7aD7RO.js";import{R as B}from"./PlusOutlined-CRekmatR.js";import{T as I}from"./index-Db_5R2-z.js";import{R as se}from"./CheckCircleFilled-nK5aAMTS.js";import{F as ae}from"./FilterEntries-BiZjj4NT.js";import{S as te}from"./SiderContent-Dj_cqrIg.js";import{D as re}from"./DownloadButton-DRTPYwYl.js";import{S as oe}from"./SaveButton-DzoI0xQq.js";import{R as ne}from"./TableOutlined-nZjEACr8.js";import{P as ie}from"./useBaseUrl--32bgvsR.js";import{u as de}from"./useResourceFirebaseData-DpbqY9uc.js";import"./useCopyToClipboardFunction-BL5Fj3Nl.js";import"./Input-cdsOURLH.js";import"./index-DL-QmAap.js";import"./index-BESd2kFy.js";import"./index-Cm-andhV.js";import"./scrollTo-CnYqteaX.js";import"./Pagination-DPx5Huu7.js";import"./extendsObject-keMuGWqj.js";import"./gapSize-U1swVQyS.js";import"./constants-B_q3c2xJ.js";import"./Item-DXicAdtS.js";import"./useTDResource-wK2jd69j.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-BHuPI7uO.js";import"./index-7mXcI-6s.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-DugEzKbM.js";import"./useGetFirebaseDoc-xE0GJyOY.js";import"./useUpdateFirebaseDoc-B5eSaqtP.js";import"./useMutation-Cs1gCno8.js";var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"};function D(){return D=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},D.apply(this,arguments)}const le=(s,a)=>u.createElement(J,D({},s,{ref:a,icon:ce})),me=u.forwardRef(le);function T({sets:s,addEntryToUpdate:a,hidePagination:t}){const n=W({total:s.length,showQuickJumper:!0}),d=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,r)=>o.id.localeCompare(r.id)},{title:"Passcode",dataIndex:"passcode",key:"passcode",sorter:(o,r)=>o.passcode[0].localeCompare(r.passcode[0]),render:(o,r)=>e.jsx(pe,{entry:r,addEntryToUpdate:a})},{title:"Cards",dataIndex:"imageCardsIds",key:"imageCardsIds",render:(o,r)=>e.jsx(ue,{entry:r,addEntryToUpdate:a})}];return e.jsx(Y,{columns:d,dataSource:s,className:"my-4",rowKey:"id",pagination:t?void 0:n})}function pe({entry:s,addEntryToUpdate:a}){const t=n=>{a(s.id,{...s,passcode:n})};return e.jsx(Z,{mode:"tags",style:{width:300},placeholder:"Add passcode from easier to harder",defaultValue:s.passcode,onChange:t})}function ue({entry:s,addEntryToUpdate:a}){const[t,n]=u.useState(""),d=()=>{t&&(a(s.id,{...s,imageCardsIds:[...s.imageCardsIds,t.trim()]}),n(""))},o=r=>{a(s.id,{...s,imageCardsIds:s.imageCardsIds.filter(i=>i!==r)})};return e.jsxs(v,{gap:6,wrap:"wrap",align:"flex-end",children:[s.imageCardsIds.map(r=>e.jsxs(v,{gap:2,vertical:!0,children:[e.jsx(U,{id:r,width:60}),e.jsx(K,{children:r}),e.jsx(P,{size:"small",onClick:()=>o(r),children:"Remove"})]},r)),e.jsx("div",{children:e.jsx(w,{placeholder:"td-d*",style:{width:100},onChange:r=>n(r.target.value),onPressEnter:d,value:t})})]})}function z(s,a=!1){return u.useMemo(()=>{console.log("Recomputing passcode names typeahead...");const t={},n=Object.values(s).reduce((o,r)=>(r.passcode.forEach(i=>{const f=a?`${i} (${r.id})`:i;o[f]&&console.warn(`Duplicate passcode found: ${i}`,o[f],r.id),o[f]=r.id,r.imageCardsIds.forEach(p=>{t[p]||(t[p]=[]),t[p].push(i)})}),o),{}),d=S.orderBy(Object.keys(n),[o=>o.toLowerCase()]).map(o=>({value:o}));return{namesDict:n,options:d,imagesDict:t}},[s,a])}function he({data:s,onFinish:a}){const{namesDict:t,options:n}=z(s,!0),[d,o]=u.useState([]),[r,i]=u.useState("");X(()=>{r&&f(r)},500,[r]);const f=h=>{if(!h){o([]);return}const x=h.trim().toUpperCase(),y=n.filter(g=>String((g==null?void 0:g.value)??"").toUpperCase().includes(x)),b=S.orderBy(y,[g=>{const c=String((g==null?void 0:g.value)??"").toUpperCase();if(c===x)return 0;const m=c.match(/\((.*?)\)/);if(m&&m[1]===x)return 1;const l=c.indexOf(x);return l===0?2:l>0?3:4}]);o(b)},p=()=>{d.length>0&&t[d[0].value]!==void 0&&a(t[d[0].value])},j=h=>{t[h]!==void 0&&a(t[h])};return e.jsx(G,{options:d,style:{width:250},allowClear:!0,placeholder:"Search...",filterOption:(h,x)=>String((x==null?void 0:x.value)??"").toUpperCase().indexOf(h==null?void 0:h.toUpperCase())!==-1,onSearch:i,notFoundContent:r.length>0?"No items found":"Type to search...",onSelect:j,children:e.jsx(w,{onPressEnter:p})})}const H={id:"",passcode:[],imageCardsIds:[]},N=(s,a)=>Array.from({length:s},()=>({...S.cloneDeep(H),id:L(a)}));function ge(s){const[a,t]=u.useState(N(3,Object.keys(s.data))),n=()=>{t(i=>[...i,{...S.cloneDeep(H),id:crypto.randomUUID().substring(0,5)}])},d=(i,f)=>{t(p=>p.map(j=>j.id===i?f:j))},o=()=>{console.log("Add entries to database"),a.forEach(i=>{i.passcode.length>0&&i.imageCardsIds.length>0&&s.addEntryToUpdate(i.id,i)}),t(N(5,Object.keys(s.data)))},r=u.useMemo(()=>a.some(i=>i.passcode.length>0||i.imageCardsIds.length>0),[a]);return e.jsxs(O,{direction:"vertical",className:"full-width",children:[e.jsx(P,{type:"primary",onClick:o,disabled:!r,children:"Add Entries"}),e.jsx(T,{sets:a,addEntryToUpdate:d}),e.jsx(P,{icon:e.jsx(B,{}),onClick:n,children:"Add row"}),e.jsx(A,{}),e.jsx(xe,{data:s.data,addEntryToUpdate:s.addEntryToUpdate})]})}function xe({data:s,addEntryToUpdate:a}){var g;const[t,n]=u.useState(""),[d,o]=u.useState(""),{namesDict:r,imagesDict:i}=z(s),{onRandomCard:f}=M(),[p,j]=u.useState(""),{message:h}=Q.useApp(),x=()=>{t&&o(t)},y=()=>{const c=f();o(c),n(c)},b=()=>{const c=p.split(",").map(m=>m.trim().toLowerCase()).filter(Boolean);c.length>0&&d&&c.forEach(m=>{if(r[m]){const l=s[r[m]];l.imageCardsIds.push(d),l.imageCardsIds=q(l.imageCardsIds),a(l.id,l)}else{const l={id:L(Object.keys(s)),passcode:[m],imageCardsIds:[d]};a(l.id,l)}}),j(""),y(),h.success("Entries processed")};return e.jsxs(e.Fragment,{children:[e.jsx(C.Title,{level:4,className:"my-0",children:"Create Image Card Multiprompt"}),e.jsxs(O,{className:"full-width",children:[e.jsxs(v,{vertical:!0,gap:8,children:[e.jsxs(v,{children:[e.jsx(w,{onChange:c=>n(c.target.value),placeholder:"Image Card ID",onPressEnter:x,value:t}),e.jsx(P,{onClick:y,children:"Random"})]}),e.jsx(U,{id:d,width:200})]}),e.jsxs(v,{vertical:!0,gap:8,children:[e.jsxs(v,{children:[e.jsx(w,{placeholder:"Names",onChange:c=>j(c.target.value),value:p}),e.jsx(P,{type:"primary",disabled:!d||!p,onClick:b,children:"Process"})]}),e.jsx(v,{gap:8,wrap:!0,children:p.split(",").map(c=>{const m=c.trim().toLowerCase(),l=r[m];return e.jsx(I,{icon:l?e.jsx(se,{}):e.jsx(B,{}),color:l?"blue":"green",children:m},m)})}),e.jsx(v,{gap:8,wrap:!0,children:i[d]&&e.jsxs(e.Fragment,{children:[e.jsx(C.Text,{type:"secondary",children:"Already in:"}),(g=i[d])==null?void 0:g.map(c=>e.jsx(I,{children:c},c))]})})]})]})]})}function fe(s){M();const{is:a,queryParams:t}=k();return e.jsxs(e.Fragment,{children:[(a("display","table")||!t.has("display"))&&e.jsx(je,{...s}),a("display","create")&&e.jsx(ge,{...s})]})}function je(s){const a=u.useMemo(()=>S.orderBy(Object.values(s.data),["id","passcode"]),[s.data]),[t,n]=u.useState();return e.jsxs(O,{direction:"vertical",className:"full-width my-4",children:[e.jsx(he,{data:s.data,onFinish:d=>n(d)}),t&&e.jsxs(e.Fragment,{children:[e.jsx(T,{sets:[s.data[t]],addEntryToUpdate:s.addEntryToUpdate,hidePagination:!0}),e.jsx(P,{size:"small",onClick:()=>n(null),children:"Clear search"})]}),e.jsx(T,{sets:a,addEntryToUpdate:s.addEntryToUpdate})]})}function Ce({data:s,save:a,isDirty:t,isSaving:n,entriesToUpdate:d,hasFirestoreData:o}){const{addParams:r,queryParams:i}=k(),{complete:f,incomplete:p,varied:j,mappings:h,mappedImages:x,overdone:y}=u.useMemo(()=>{let b=0,g=0,c=0,m=0,l=0;const R={};return Object.values(s).forEach(E=>{E.imageCardsIds.length>=3&&b++,E.imageCardsIds.length>4&&c++,E.imageCardsIds.length<3&&g++,E.passcode.length>3&&m++,l+=E.imageCardsIds.length,E.imageCardsIds.forEach($=>{R[$]=!0})}),{complete:b,incomplete:g,varied:m,mappings:l,mappedImages:Object.keys(R).length,overdone:c}},[s]);return e.jsxs(te,{children:[e.jsxs(v,{vertical:!0,gap:12,children:[e.jsx(oe,{isDirty:t,onSave:a,isSaving:n,dirt:JSON.stringify(d)}),e.jsx(re,{data:()=>Ie(s),fileName:"daily-passcode-sets.json",disabled:t,hasNewData:o,block:!0})]}),e.jsx(A,{}),e.jsx(ae,{label:"Display",value:i.get("display")??"table",onChange:b=>r({display:b,page:1},{page:1,display:"table"}),options:[{title:"Table",icon:e.jsx(ne,{}),value:"table"},{title:"Create",icon:e.jsx(me,{}),value:"create"}]}),e.jsx("p",{children:"Stats"}),e.jsxs(C.Text,{children:["Passcode sets: ",e.jsx(I,{children:Object.keys(s).length})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Complete: ",e.jsx(I,{color:"green-inverse",children:f})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Incomplete: ",e.jsx(I,{color:"gold-inverse",children:p})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Overdone: ",e.jsx(I,{color:"purple",children:y})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Varied: ",e.jsx(I,{children:j})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Mappings: ",e.jsx(I,{children:h})]}),e.jsx("br",{}),e.jsxs(C.Text,{children:["Unique images: ",e.jsx(I,{children:x})]})]})}function Ie(s){console.log("Preparing file for download...");const a=S.cloneDeep(s);return ee(a)}function ps(){const s=de({tdrResourceName:"daily-passcode-sets",firebaseDataCollectionName:"imagePasscode",serialize:!0});return e.jsx(V,{title:"Image Cards Passcode Sets",subtitle:"Daily Set Entries",children:e.jsxs(F,{hasSider:!0,children:[e.jsx(ie,{children:e.jsx(Ce,{...s})}),e.jsx(F.Content,{className:"content",children:e.jsx(_,{isLoading:s.isLoading,error:s.error,hasResponseData:!S.isEmpty(s.data),children:e.jsx(fe,{...s})})})]})})}export{ps as ImageCardsPasscode,ps as default};
