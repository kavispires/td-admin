import{N as oe,m as o,J as re,M as _,aI as z}from"./index-pwMPEs54.js";import{t as F}from"./throttleByAnimationFrame-bT5Y5o0E.js";const ie=t=>{const{componentCls:a}=t;return{[a]:{position:"fixed",zIndex:t.zIndexPopup}}},se=t=>({zIndexPopup:t.zIndexBase+10}),ae=oe("Affix",ie,se);function S(t){return t!==window?t.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function L(t,a,r){if(r!==void 0&&Math.round(a.top)>Math.round(t.top)-r)return r+a.top}function B(t,a,r){if(r!==void 0&&Math.round(a.bottom)<Math.round(t.bottom)+r){const s=window.innerHeight-a.bottom;return r+s}}var ce=function(t,a){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&a.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(t);c<s.length;c++)a.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(t,s[c])&&(r[s[c]]=t[s[c]]);return r};const M=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"];function le(){return typeof window<"u"?window:null}const j=0,U=1,he=o.forwardRef((t,a)=>{var r;const{style:s,offsetTop:c,offsetBottom:d,prefixCls:H,className:V,rootClassName:G,children:X,target:u,onChange:w,onTestUpdatePosition:fe}=t,k=ce(t,["style","offsetTop","offsetBottom","prefixCls","className","rootClassName","children","target","onChange","onTestUpdatePosition"]),{getPrefixCls:D,getTargetContainer:J}=o.useContext(re),T=D("affix",H),[C,q]=o.useState(!1),[f,K]=o.useState(),[Q,W]=o.useState(),R=o.useRef(j),E=o.useRef(null),h=o.useRef(null),p=o.useRef(null),A=o.useRef(null),x=o.useRef(null),l=(r=u??J)!==null&&r!==void 0?r:le,b=d===void 0&&c===void 0?0:c,Y=()=>{if(R.current!==U||!A.current||!p.current||!l)return;const i=l();if(i){const n={status:j},e=S(p.current);if(e.top===0&&e.left===0&&e.width===0&&e.height===0)return;const m=S(i),g=L(e,m,b),I=B(e,m,d);g!==void 0?(n.affixStyle={position:"fixed",top:g,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}):I!==void 0&&(n.affixStyle={position:"fixed",bottom:I,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}),n.lastAffix=!!n.affixStyle,C!==n.lastAffix&&w?.(n.lastAffix),R.current=n.status,K(n.affixStyle),W(n.placeholderStyle),q(n.lastAffix)}},P=()=>{R.current=U,Y()},v=F(()=>{P()}),y=F(()=>{if(l&&f){const i=l();if(i&&p.current){const n=S(i),e=S(p.current),m=L(e,n,b),g=B(e,n,d);if(m!==void 0&&f.top===m||g!==void 0&&f.bottom===g)return}}P()}),O=()=>{const i=l?.();i&&(M.forEach(n=>{var e;h.current&&((e=E.current)===null||e===void 0||e.removeEventListener(n,h.current)),i?.addEventListener(n,y)}),E.current=i,h.current=y)},N=()=>{const i=l?.();M.forEach(n=>{var e;i?.removeEventListener(n,y),h.current&&((e=E.current)===null||e===void 0||e.removeEventListener(n,h.current))}),v.cancel(),y.cancel()};o.useImperativeHandle(a,()=>({updatePosition:v})),o.useEffect(()=>(x.current=setTimeout(O),()=>{x.current&&(clearTimeout(x.current),x.current=null),N()}),[]),o.useEffect(()=>(O(),()=>N()),[u,f,C,c,d]),o.useEffect(()=>{v()},[u,c,d]);const[Z,$,ee]=ae(T),te=_(G,$,T,ee),ne=_({[te]:f});return Z(o.createElement(z,{onResize:v},o.createElement("div",Object.assign({style:s,className:V,ref:p},k),f&&o.createElement("div",{style:Q,"aria-hidden":"true"}),o.createElement("div",{className:ne,ref:A,style:f},o.createElement(z,{onResize:v},X)))))});export{he as A};
