import{r as I,aE as qe,d as re,_ as ie,i as he,u as Ke,j as e,T as V,F as E,D as _,B as P,c as Qe,aC as He,a4 as Se,aF as Ne,a6 as ue,aG as Ye,Z as Ze,h as fe,a2 as Je,A as We,aH as Xe,aq as et,P as tt,L as je}from"./index-CZbY-XP4.js";import{D as st}from"./DataLoadingWrapper-CA7x-E6v.js";import{b as G,a as W,c as we,d as le,T as rt}from"./FilterEntries-9UYxPg59.js";import{S as it}from"./SiderContent-D6Zehf8p.js";import{D as Pe,R as nt}from"./DownloadButton-Cj4R2nep.js";import{a as at,F as ot}from"./FirestoreConsoleLink-DkE4Yejo.js";import{S as lt}from"./SaveButton-C9Fu7wzN.js";import{l as x,c as de,E as se,P as ct}from"./useBaseUrl-I-cx4ZRs.js";import{e as M,b as N,f as ut,A as K}from"./constants-eyt814VY.js";import{j as dt,k as mt,a as xe,i as Re,w as pt,m as gt}from"./index-j2h0sxJg.js";import{u as ht}from"./useGetFirestoreDoc-C598Hj0F.js";import{u as te}from"./useTDResource-uo7TtuHP.js";import{u as ft}from"./useUpdateFirestoreDoc-BKn38yNS.js";import{u as O}from"./useQueryParams-MugQh_UL.js";import{T as ee}from"./index-BPQyuLEv.js";import{R as xt}from"./VerticalAlignTopOutlined-B2hsiIYI.js";import{a as H,I as Y,b as z,d as ne}from"./ItemBuildingBlocks-B3KhlcVv.js";import{R as Ie}from"./index-BgHjlLhR.js";import{I as ve}from"./Item-Dv8hSfWh.js";import{P as Le}from"./progress-XF0QsnPD.js";import{R as ye,u as bt}from"./CloseCircleOutlined-FcdwDb9I.js";import{C as Q}from"./index-SGIeBn69.js";import{A as jt}from"./index-SlMFIHuq.js";import{S as k}from"./index-DXISCQ9l.js";import{I as It}from"./ItemsTypeahead-DJ3utIBu.js";import{R as vt,a as yt,P as At}from"./Pagination-Cq8nAro0.js";import{S as J}from"./index-BCaFrP1-.js";import{a as Ct,F as De,R as Tt}from"./Table-yhtxXp_R.js";import{D as Et}from"./index-BTAS2hHI.js";import{S as St}from"./index-1sI5TGf-.js";import{P as Nt}from"./index-DBwsWKr0.js";import{T as wt}from"./TransparentButton-LdDFWkbo.js";import{T as Pt}from"./index-_kGXIQ7G.js";import{R as Rt}from"./SkinOutlined-CqhOXioO.js";import{R as Lt}from"./index-Df4GNZug.js";import"./index-BObE2w6-.js";import"./index-C-IhtPJN.js";import"./useMutation-4vwTa6Qj.js";import"./moment-BYTvHWBW.js";import"./SaveOutlined-Lipb5y1_.js";import"./LanguageFlag-BGjZwIYr.js";import"./useCopyToClipboardFunction-DWPYjTS2.js";import"./IdcardOutlined-DenG0nrQ.js";import"./throttleByAnimationFrame-Lcb1mHdJ.js";import"./useDebounce-BwOwXwEQ.js";import"./index-BNx6cWQY.js";import"./scrollTo-DC2elTTn.js";import"./PlusOutlined-DeN17l-F.js";var Dt=function(t,r){return qe?window.matchMedia(t).matches:!1},Ot=function(t,r){var s=I.useState(Dt(t)),n=s[0],l=s[1];return I.useEffect(function(){var i=!0,o=window.matchMedia(t),c=function(){i&&l(!!o.matches)};return o.addEventListener("change",c),l(o.matches),function(){i=!1,o.removeEventListener("change",c)}},[t]),n},Ut={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},Vt=function(r,s){return I.createElement(re,ie({},r,{ref:s,icon:Ut}))},Ft=I.forwardRef(Vt),Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},kt=function(r,s){return I.createElement(re,ie({},r,{ref:s,icon:Mt}))},Bt=I.forwardRef(kt),zt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},$t=function(r,s){return I.createElement(re,ie({},r,{ref:s,icon:zt}))},_t=I.forwardRef($t),Gt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},qt=function(r,s){return I.createElement(re,ie({},r,{ref:s,icon:Gt}))},Kt=I.forwardRef(qt),Qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Ht=function(r,s){return I.createElement(re,ie({},r,{ref:s,icon:Qt}))},Yt=I.forwardRef(Ht);const Oe={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};x.keyBy(Oe,"prefix");const Zt=["*","^","+","~","!"],q={ATTRIBUTE_VALUE_DICT:Oe,ATTRIBUTE_VALUE_PRIORITY:Zt},me=(t={})=>x.cloneDeep(x.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},t)),pe=(t={})=>x.cloneDeep(x.merge({id:"",attributes:{}},t)),Ue=(t,r,s)=>{const n=x.orderBy(Object.values(r),["priority","id"],["asc","asc"]).map(a=>a.id);function l(a,u){return x.orderBy(a,b=>n.indexOf(b),["asc"]).map(b=>`${u}${b}`)}const i=[],o=[],c=[],d=[],h=[];return Object.entries(t.attributes).forEach(([a,u])=>{if(r[a])switch(u){case N.OPPOSITE:i.push(a);break;case N.DETERMINISTIC:o.push(a);break;case N.RELATED:c.push(a);break;case N.UNRELATED:d.push(a);break;case N.UNCLEAR:h.push(a);break;default:h.push(a);break}}),[...l(i,M.OPPOSITE),...l(o,M.DETERMINISTIC),...l(c,M.RELATED),...l(d,M.UNRELATED),...l(h,M.UNCLEAR)]},Ve=x.memoize(t=>{if(t.length===3)return{key:t,className:"",text:""};const r=t[0];return{key:t.slice(1,4),className:{[M.DETERMINISTIC]:"deterministic",[M.UNRELATED]:"unrelated",[M.UNCLEAR]:"unclear",[M.OPPOSITE]:"opposite"}[r],text:{[M.DETERMINISTIC]:"very",[M.UNRELATED]:"not",[M.UNCLEAR]:"maybe",[M.OPPOSITE]:"very not"}[r]}}),Fe=(t,r,s)=>t.filter(n=>!(!r&&n.includes(M.UNCLEAR)||!s&&n.includes(M.UNRELATED)));function ge(t,r,s){const n=[];for(const[o,c]of Object.entries(t.attributes)){const d=r[o];if(d){const h=Object.values(q.ATTRIBUTE_VALUE_DICT).find(a=>a.value===c);h&&n.push({prefix:h.prefix,id:d.id,priority:d.priority})}}const l=x.sortBy(n,[o=>q.ATTRIBUTE_VALUE_PRIORITY.indexOf(o.prefix),o=>o.prefix===q.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:o.priority,["asc","asc"]]),i=s?.length?l.slice(0,s?.length):l;return s?.onlyRelevant?i.filter(o=>[q.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,q.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(o.prefix)).map(o=>`${o.prefix}${o.id}`).join(""):i.map(o=>`${o.prefix}${o.id}`).join(s?.delimiter??"")}const Jt=x.keyBy(q.ATTRIBUTE_VALUE_DICT,"prefix");function Wt(t){return(t.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((s,n)=>{const l=n[0],i=n.slice(1),o=Jt[l].value;return s[i]=o,s},{})}function Me(t){return Object.values(t.attributes).reduce((r,s)=>{let n=r;return s<=0?(s===q.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(n+=s/2),n):n+s},0)}function ke(t,r){const s=Object.values(t.attributes).filter(n=>n===q.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((r-s)/r*100)}const ce={};function Xt(){const{notification:t,message:r}=he.useApp(),s=Ke(),n=te("items"),l=te("items-attributes"),i=te("items-attribute-values"),o=ht("tdr","itemsAttributeValues",{select:v=>ts({itemAttributesValues:v,itemAttributes:l.data??{}})}),[c,d]=I.useState({}),h=ft("tdr","itemsAttributeValues",{onSuccess:()=>{t.success({message:"itemsAttributeValues updated"}),s.refetchQueries({queryKey:["firestore","tdr","itemsAttributeValues"]}),d({})},onError:v=>{t.error({message:"itemsAttributeValues update failed",description:v.message})}}),a=I.useMemo(()=>({...i.data??{},...o.data??{}}),[i.data,o.data]),u=!x.isEmpty(c),b=(v,C)=>{d(m=>({...m,[v]:{...C,updatedAt:Date.now()}}))},f=v=>{d(C=>({...C,...x.mapKeys(v.map(m=>({...m,updatedAt:Date.now()})),"id")}))},g=o.data,p=()=>{h.mutate(es({...g,...c},l.data))};return{availableItemIds:I.useMemo(()=>{const v=n.data??{};return x.orderBy(Object.keys(v).filter(C=>(v[C]?.decks??[]).includes("alien")),C=>Number(C),"asc")},[n.data]),getItem:v=>n.data?.[v]?n.data[v]:(v&&r.info(`Item ${v} not found in TDR. Creating a new item...`),me({id:v})),getItemAttributeValues:v=>{const C=a?.[v]??{},m=c[v]??{};return x.isEmpty(C)&&x.isEmpty(m)?(ce[v]=pe({id:v}),ce[v]):x.merge(ce?.[v]??{},C,m)},attributes:l.data??{},isLoading:n.isLoading||l.isLoading||i.isLoading||o.isLoading,error:n.error||l.error||i.error||o.error,firestoreData:g,hasFirestoreData:!x.isEmpty(o.data),isSaving:h.isPending,save:p,addAttributesToUpdate:b,addMultipleAttributesToUpdate:f,attributesToUpdate:c,isDirty:u}}const es=(t,r)=>mt(t,n=>({id:n.id,tempSignature:ge(n,r),updatedAt:n.updatedAt})),ts=t=>{const{itemAttributesValues:r,itemAttributes:s}=t,n=Object.keys(s).length;return dt(r,i=>{const o=Wt(i.tempSignature),c=Object.keys(o).length===n,d={id:i.id,updatedAt:i.updatedAt,attributes:o};return c?{...d,complete:c,reliability:ke(d,n),score:Me(d)}:d})},Be=I.createContext({getItem:()=>me(),getItemAttributeValues:()=>pe(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:me(),itemAttributeValues:pe(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{},hasFirestoreData:!1}),ss=({children:t})=>{const{getItem:r,getItemAttributeValues:s,availableItemIds:n,isLoading:l,error:i,isSaving:o,save:c,addAttributesToUpdate:d,isDirty:h,attributes:a,addMultipleAttributesToUpdate:u,attributesToUpdate:b,hasFirestoreData:f}=Xt(),{message:g}=he.useApp(),p=I.useMemo(()=>x.orderBy(Object.values(a),"name.en","asc"),[a]),{queryParams:y}=O(),A=y.get("sortBy"),T=I.useMemo(()=>A==="id"?x.orderBy(n,j=>Number(j),"asc"):A==="updatedAt"?x.orderBy(n,j=>s(j).updatedAt,"desc"):A==="fewestAttributesLeft"?x.orderBy(n,j=>{const S=p.length-Object.keys(s(j).attributes).length;return S===0?Number.POSITIVE_INFINITY:S},"asc"):n,[n,A]),[v,C]=I.useState(x.random(0,T.length-1)),m=r(T[v]),F=s(m.id),B=(j,S)=>{if(j==="next"){C(w=>(w+1)%T.length);return}if(j==="previous"){C(w=>(w-1+T.length)%T.length);return}if(j==="random"){C(x.random(0,T.length-1));return}if(j==="first"){C(0);return}if(j==="last"){C(T.length-1);return}if(j==="next10"){C(w=>(w+10)%T.length);return}if(j==="previous10"){C(w=>(w-10+T.length)%T.length);return}if(j==="incomplete"){C(w=>{let L=w+1;for(;L<T.length;){const X=s(T[L]);if(Object.keys(X.attributes).length!==p.length)return L;if(L===T.length-1)return g.info("No more incomplete items found."),w;L++}return w});return}if(j==="goTo"&&S!==void 0){const w=T.indexOf(S);if(w!==-1){C(w);return}g.error(`Item ${S} is not available for attribution.`)}},R=(j,S)=>{d(m.id,{...F,attributes:{...F.attributes,[j]:S}})},D=()=>xe(n.reduce((j,S)=>{const w=s(S);return x.isEmpty(w.attributes)||(Object.keys(w.attributes).length===p.length?w.complete=!0:delete w.complete,j[w.id]=w),j},{}));return e.jsx(Be.Provider,{value:{getItem:r,getItemAttributeValues:s,availableItemIds:n,isLoading:l,error:i,hasResponseData:n.length>0&&!x.isEmpty(a),isDirty:h,itemAttributeValues:F,jumpToItem:B,activeItem:m,onAttributeChange:R,isSaving:o,save:c,attributes:a,attributesList:p,addAttributesToUpdate:d,addMultipleAttributesToUpdate:u,prepareItemsAttributesFileForDownload:D,attributesToUpdate:b,hasFirestoreData:f},children:t})},U=()=>I.useContext(Be);function $({label:t,children:r}){return e.jsxs(V.Text,{children:[t," ",e.jsx(ee,{children:r})]})}function rs(){const{getItemAttributeValues:t,availableItemIds:r,attributesList:s}=U(),{total:n,complete:l,completionPercentage:i,hasDataCount:o,initiatedPercentage:c,progress:d,progressTotal:h,currentProgress:a}=I.useMemo(()=>{const u=r.length;let b=0,f=0,g=0;r.map(A=>t(A)).forEach(({attributes:A})=>{x.isEmpty(A)||(b+=1),Object.values(A).length===s.length&&(f+=1),g+=Object.values(A).length});const y=Object.values(s).length*r.length;return{total:u,complete:f,completionPercentage:u>0?(f/u*100).toFixed(1):0,hasDataCount:b,initiatedPercentage:u>0?Math.floor(b/u*100):0,progress:(g/y*100).toFixed(1),currentProgress:g,progressTotal:y}},[s,r,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(E,{vertical:!0,children:[e.jsx(V.Text,{className:"mb-2",strong:!0,children:"Items Stats"}),e.jsx($,{label:"Total",children:n}),e.jsxs($,{label:"Complete",children:[l," (",i,"%)"]}),e.jsxs($,{label:"Initiated",children:[o," (",c,"%)"]}),e.jsx(V.Text,{className:"mt-4 mb-2",strong:!0,children:"Attributes Stats"}),e.jsx($,{label:"Total",children:h}),e.jsx($,{label:"Set",children:a}),e.jsxs($,{label:"Progress",children:[d,"%"]})]}),e.jsx(_,{})]})}function is(){const{jumpToItem:t}=U(),{addParam:r,is:s}=O();return e.jsxs(e.Fragment,{children:[e.jsx(P,{block:!0,onClick:()=>t("random"),type:"primary",children:"Random Item"}),e.jsx(G,{className:"mt-4",label:"Unset Only",onChange:n=>r("scope",n?"unset":""),value:s("scope","unset")})]})}function ns(){const{queryParams:t,addParam:r}=O(),{attributesList:s}=U(),n=I.useMemo(()=>[{label:"Random Attribute",value:"random"},...s.map(({id:l,name:i})=>({label:i.en,value:l}))],[s]);return e.jsxs(e.Fragment,{children:[e.jsx(W,{label:"Sampler Attribute",onChange:l=>r("attribute",l),options:n,value:t.get("attribute")||"random"}),e.jsx(we,{label:"Sample Size",max:21,min:3,onChange:l=>r("size",String(l)),step:3,value:Number(t.get("size")||9)})]})}function as(){const{queryParams:t,addParam:r}=O(),{attributesList:s}=U(),n=I.useMemo(()=>s.map(({id:l,name:i,...o})=>({label:`${i.en}${o.default?"*":""}`,value:l})),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(W,{label:"Attribute",onChange:l=>r("attribute",l),options:n,value:t.get("attribute")||"ali"}),e.jsx(W,{label:"Scope",onChange:l=>r("scope",l),options:[{value:"unset",label:"Unset"},...ut],value:t.get("scope")||"unset"}),e.jsx(W,{label:"Results per page",onChange:l=>r("pageSize",l),options:[12,24,48,96],value:t.get("pageSize")||12})]})}function os(){const{addParam:t,is:r}=O();return e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"full-width m-0",label:"Only Complete",onChange:s=>t("showComplete",s?"true":""),value:r("showComplete")}),e.jsx(G,{className:"full-width m-0",label:"Show Unrelated",onChange:s=>t("showUnrelated",s?"true":""),value:r("showUnrelated")}),e.jsx(G,{className:"full-width m-0",label:"Show Unclear",onChange:s=>t("showUnclear",s?"true":""),value:r("showUnclear")})]})}function ls(){const{addParam:t,is:r}=O();return e.jsx(G,{className:"full-width m-0",label:"Show Glyphs",onChange:s=>t("showGlyphs",s?"true":""),value:r("showGlyphs")})}function cs(){const{isDirty:t,save:r,prepareItemsAttributesFileForDownload:s,attributes:n,isSaving:l,attributesToUpdate:i,hasFirestoreData:o}=U(),{queryParams:c,addParam:d}=O(),h=c.get("display")??"classifier";return e.jsxs(it,{children:[e.jsxs(E,{gap:12,vertical:!0,children:[e.jsx(lt,{dirt:JSON.stringify(i),isDirty:t,isSaving:l,onSave:r}),e.jsx(Pe,{block:!0,data:()=>us(s(),n),disabled:t,fileName:"items-attribute-values.json",hasNewData:o}),e.jsx(E,{justify:"center",children:e.jsx(at,{docId:"itemsAttributeValues",path:"tdr",queryKey:["tdr","itemsAttributeValues"]})})]}),e.jsx(_,{}),e.jsx(rs,{}),e.jsx(Qe,{layout:"vertical",children:e.jsx(W,{label:"Display",onChange:a=>d("display",a),options:["classifier","sampler","grouping","comparator","simulator","stats"],value:h})}),e.jsx(_,{}),h==="classifier"&&e.jsx(is,{}),h==="sampler"&&e.jsx(ns,{}),h==="grouping"&&e.jsx(as,{}),h==="comparator"&&e.jsx(os,{}),h==="stats"&&e.jsx(ls,{})]})}function us(t,r){const s=Object.keys(r).length;Object.keys(t).forEach(l=>{const i=t[l],o=Object.keys(i.attributes);o.forEach(d=>{r[d]||delete i.attributes[d]}),o.length===s?(i.complete=!0,i.score=Me(i),i.reliability=ke(i,s),i.signature=ge(i,r,{onlyRelevant:!0})):(i.complete=void 0,i.score=void 0,i.reliability=void 0,i.signature=void 0)});const n={};return Object.values(t).forEach(l=>{n[l.id]={id:l.id,updatedAt:l.updatedAt,signature:ge(l,r,{delimiter:":"})},l.complete&&(n[l.id].complete=l.complete)}),console.log(n),xe(Re(t))}function ze(t){const[r,s]=I.useState(!1),n=()=>{s(window.scrollY>300)},l=()=>{window.scrollTo({top:0,behavior:"smooth"})};return He(()=>(window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)})),e.jsx(P,{className:`go-to-top-button ${r?"visible":""}`,icon:e.jsx(xt,{}),onClick:l,...t,children:"Go to Top"})}function $e({title:t,icon:r}){return e.jsx(Se,{title:t,children:r??e.jsx(Ne,{})})}const Ae=[{label:"Opposite",value:N.OPPOSITE},{label:"Unrelated",value:N.UNRELATED},{label:"Unclear",value:N.UNCLEAR},{label:"Related",value:N.RELATED},{label:"Deterministic",value:N.DETERMINISTIC}],Ce=[{label:"Opposite",value:N.OPPOSITE},{label:"Unrelated",value:N.UNRELATED},{label:"Unclear",value:N.UNCLEAR},{label:"Related",value:N.RELATED},{label:"Deterministic",value:N.DETERMINISTIC,disabled:!0}];function ae({attribute:t,value:r,onChange:s,onlyButtons:n,size:l}){return t?n?e.jsx(Ie.Group,{buttonStyle:"solid",onChange:({target:{value:i}})=>s(t.id,i),options:t.limited?Ce:Ae,optionType:"button",size:l,value:r}):e.jsxs("div",{className:"attribute-button-container__row",children:[e.jsxs("span",{className:"attribute-button-container__label",children:[x.truncate(t.name.en,{length:12})," ",e.jsx($e,{title:t.description.en})]}),e.jsx(Ie.Group,{buttonStyle:"solid",onChange:({target:{value:i}})=>s(t.id,i),options:t.limited?Ce:Ae,optionType:"button",size:l,value:r}),e.jsx("span",{children:e.jsx(ue,{style:{color:r&&r>7?"green":"transparent"}})})]},t.id):null}function ds({itemAttributeValues:t,attributes:r}){const{is:s,addParam:n}=O(),l=s("showUnclear"),i=s("showUnrelated"),o=I.useMemo(()=>Fe(Ue(t,r),l,i),[t,r,l,i]),c=s("signs")?_e:ms;return e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(G,{className:"full-width m-0",label:"Show Unrelated",onChange:d=>n("showUnrelated",d?"true":""),value:s("showUnrelated")}),e.jsx(G,{className:"full-width m-0",label:"Show Unclear",onChange:d=>n("showUnclear",d?"true":""),value:s("showUnclear")}),e.jsx(G,{className:"full-width m-0",label:"Alien Signs",onChange:d=>n("signs",d?"true":""),value:s("signs")}),e.jsx(E,{className:"item-attribute-value-statement",gap:6,wrap:"wrap",children:o.map((d,h,a)=>e.jsx(c,{attributes:r,firstElement:h===0,keyVariant:d,lastElement:h===a.length-1},d))})]})}function _e({keyVariant:t,attributes:r,withText:s}){const{key:n,className:l,text:i}=Ve(t);return e.jsxs(E,{align:"center",vertical:!0,children:[e.jsx(K,{className:de("item-attribute-alien-sign",`item-attribute-alien-sign--${l}`),signId:r[n].spriteId,width:50}),s&&e.jsxs(E,{align:"center",justify:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},wrap:"wrap",children:[i," ",r[n].name.en.toLowerCase()]})]})}function ms({keyVariant:t,attributes:r,firstElement:s,lastElement:n}){const{key:l,text:i}=Ve(t),o=s?"It's ":"",c=n?".":", ";return e.jsxs(e.Fragment,{children:[o,i," ",r[l].name.en.toLowerCase(),c]})}function ps({attributesList:t,itemAttributeValues:r}){const{completion:s,isDeterministic:n,value:l,isOpposing:i,relevancy:o}=I.useMemo(()=>{const c=t.length,d=Object.keys(r.attributes).length,h=Math.floor(d/c*100);let a=!1,u=!1,b=0;const f=Object.values(r.attributes).reduce((p,y)=>y<=0?(y===N.UNCLEAR&&(b+=1),y===N.OPPOSITE&&(u=!0,p+=y/2),p):(y===N.DETERMINISTIC&&(a=!0),p+y),0),g=Math.floor((d-b)/c*100);return{completion:h,isDeterministic:a,value:f,isOpposing:u,relevancy:g}},[t,r.attributes]);return e.jsxs("div",{children:[e.jsx(V.Text,{strong:!0,children:"Completion"}),e.jsx(Le,{percent:s,size:"small"}),e.jsx(V.Text,{strong:!0,children:"Stats"}),e.jsxs(E,{vertical:!0,children:[e.jsx($,{label:"Deterministic",children:n?e.jsx(ue,{style:{color:"green"}}):e.jsx(ye,{style:{color:"red"}})}),e.jsx($,{label:"Opposing",children:i?e.jsx(ue,{style:{color:"CornflowerBlue"}}):e.jsx(ye,{style:{color:"grey"}})}),e.jsx($,{label:"Value",children:l}),e.jsx(Se,{title:"The percentage of conclusive attributes (not unclear)",children:e.jsxs($,{label:"Reliability",children:[o,"%"]})})]})]})}function gs(){const{activeItem:t,attributesList:r,itemAttributeValues:s,onAttributeChange:n,jumpToItem:l,attributes:i}=U(),{queryParams:o,removeParam:c,is:d}=O(),h=o.get("itemId"),a=o.get("filters");I.useEffect(()=>{h&&(c("itemId"),l("goTo",h))},[h]);const u=d("scope","unset"),b=I.useMemo(()=>{const f=u?r.filter(g=>!s.attributes[g.id]):r;if(a){const g=a.split(",").reduce((p,y)=>(p[y]=!0,p),{});return f.filter(p=>g[p.id])}return f},[u,t.id,a]);return t?e.jsx(Q,{children:e.jsxs("div",{className:"item-attribution-card",children:[e.jsx(jt,{className:"item-attribution-card__item",offsetTop:120,children:e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(H,{item:t,width:150}),e.jsx(Y,{item:t}),e.jsx(z,{item:t,language:"en"}),e.jsx(z,{item:t,language:"pt"}),e.jsx(_,{className:"my-2"}),e.jsx(ps,{attributesList:r,itemAttributeValues:s}),e.jsx(_,{className:"my-2"}),e.jsx(V.Text,{type:"secondary",children:e.jsx(ds,{attributes:i,itemAttributeValues:s})})]})}),e.jsx(k,{className:"my-4 attribute-button-container",direction:"vertical",size:"small",wrap:!0,children:b.map(f=>e.jsx(ae,{attribute:f,onChange:n,value:s.attributes[f.id]},f.id))})]},`${t.id}`)}):e.jsx(Q,{children:e.jsxs(V.Text,{type:"secondary",children:["No item selected."," ",e.jsx(P,{onClick:()=>l("random"),size:"small",type:"primary",children:"Random Item"})]})})}function hs(){const{jumpToItem:t}=U();return e.jsxs(k.Compact,{children:[e.jsx(P,{icon:e.jsx(Yt,{}),onClick:()=>t("first"),children:"First"}),e.jsx(P,{icon:e.jsx(vt,{}),onClick:()=>t("previous10"),children:"Previous 10"}),e.jsx(P,{icon:e.jsx(Ye,{}),onClick:()=>t("previous"),children:"Previous"}),e.jsxs(P,{onClick:()=>t("next"),children:["Next ",e.jsx(Ze,{})]}),e.jsxs(P,{onClick:()=>t("next10"),children:["Next 10 ",e.jsx(yt,{})]}),e.jsxs(P,{onClick:()=>t("last"),children:["Last ",e.jsx(Kt,{})]}),e.jsx(fe,{content:e.jsx(fs,{}),title:"Go to item",children:e.jsx(P,{children:"Go To"})}),e.jsx(P,{onClick:()=>t("incomplete"),children:"Next Incomplete"})]})}function fs(){const{jumpToItem:t}=U();return e.jsx(It,{isPending:!1,onFinish:r=>t("goTo",r)})}function xs(){const{addParam:t,queryParams:r}=O(),{attributesList:s}=U(),n=I.useMemo(()=>s.map(c=>({label:c.name.en,value:c.id})),[s]),l=c=>{t("filters",c.join(","))},i=r.get("filters"),o=e.jsx(J,{allowClear:!0,mode:"multiple",onChange:c=>l(c),options:n,style:{width:300},value:i?.split(",")});return e.jsx(fe,{content:o,title:"Filter Attributes",children:e.jsx(P,{children:i?e.jsx(Ct,{style:{color:"gold"}}):e.jsx(Bt,{})})})}function bs(){const{addParam:t,queryParams:r}=O(),s=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],n=r.get("sortBy"),l=e.jsx(J,{allowClear:!0,onChange:i=>t("sortBy",i),options:s,style:{width:120},value:n});return e.jsx(fe,{content:l,title:"Sort By",children:e.jsx(P,{children:"Sort"})})}function js(){const{attributes:t,getItemAttributeValues:r,availableItemIds:s,getItem:n,isLoading:l}=U(),{is:i}=O(),o=i("showComplete"),c=i("showUnclear"),d=i("showUnrelated"),{itemMessages:h,itemMessagesDict:a,grouping:u}=I.useMemo(()=>{if(l)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const b=x.orderBy(s.map(p=>{const y=r(p),A=Ue(y,t);return{item:n(p),itemAttributesValues:y,message:Fe(A,c,d),fullMessage:A}}).filter(({itemAttributesValues:p})=>o?p.complete:!0),["message"],["asc"]),f=b.reduce((p,{message:y,item:{id:A}})=>{const T=y.join(" ");return p[T]===void 0&&(p[T]=[]),p[T].push(A),p},{}),g=Object.values(f).filter(p=>p.length>1);return g.length>0&&console.log("More than one",g),{itemMessages:b,itemMessagesDict:x.keyBy(b,"item.id"),grouping:f}},[t,s,r,n,l,o,c,d]);return{itemMessages:h,itemMessagesDict:a,grouping:u}}function be(){const{queryParams:t,removeParam:r}=O(),s=t.get("drawer"),[n,l]=I.useState(!1),{activeItem:i,attributesList:o,itemAttributeValues:c,onAttributeChange:d,jumpToItem:h}=U(),a=()=>{r("drawer")};I.useEffect(()=>{s&&h("goTo",s)},[s]);const u=I.useMemo(()=>n?o.filter(b=>!c.attributes[b.id]):o,[n,i.id]);return e.jsxs(Et,{onClose:a,open:!!s,title:`Edit: ${i.name.en}`,width:"640px",children:[e.jsxs(E,{gap:6,children:[e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(H,{item:i,width:50}),e.jsx(Y,{item:i})]}),e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(z,{item:i,language:"en"}),e.jsx(z,{item:i,language:"pt"})]}),e.jsx(E,{gap:6,vertical:!0,children:e.jsx(St,{checked:n,checkedChildren:"Unset",onChange:l,unCheckedChildren:"All"})})]}),e.jsx(_,{className:"my-1"}),e.jsx(k,{className:"my-4 attribute-button-container",direction:"vertical",size:"small",wrap:!0,children:u.map(b=>e.jsx(ae,{attribute:b,onChange:d,size:"small",value:c.attributes[b.id]},b.id))})]})}function Is(){const{attributes:t}=U(),{itemMessages:r,grouping:s}=js(),{addParam:n}=O(),l=[{title:"Item Id",dataIndex:"item",key:"id",render:i=>e.jsxs("div",{children:[e.jsx(Y,{item:i}),e.jsxs(k.Compact,{children:[e.jsx(ne,{item:i}),e.jsx(P,{onClick:()=>n("drawer",i.id),shape:"round",size:"small",children:"Drawer"})]})]}),sorter:(i,o)=>Number(i.item.id)-Number(o.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:i=>e.jsx(H,{item:i,width:75})},{title:"Name",dataIndex:"item",key:"name",render:i=>e.jsxs(e.Fragment,{children:[e.jsx(z,{item:i,language:"en"}),e.jsx(z,{item:i,language:"pt"})]}),sorter:(i,o)=>i.item.name.en.localeCompare(o.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(i,{item:o})=>e.jsx(E,{gap:6,children:i.map((c,d,h)=>e.jsx(_e,{attributes:t,firstElement:d===0,keyVariant:c,lastElement:d===h.length-1,withText:!0},`${c}-${o.id}`))}),sorter:(i,o)=>i.message.join(" ").localeCompare(o.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:i=>i.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:i=>{const o=s[i.join(" ")]??[];return e.jsx(e.Fragment,{children:o.length>1?o.length:"0"})},sorter:(i,o)=>{const c=s[i.message.join(" ")]??[];return(s[o.message.join(" ")]??[]).length-c.length}}];return e.jsxs("div",{className:"my-4",children:[e.jsx(V.Title,{level:5,children:"Item Comparator"}),e.jsx(De,{columns:l,dataSource:r,pagination:{showQuickJumper:!0}}),e.jsx(be,{})]})}function vs(){const{attributesList:t,addAttributesToUpdate:r,getItemAttributeValues:s,availableItemIds:n,addMultipleAttributesToUpdate:l}=U(),{queryParams:i,addParam:o}=O(),c=i.get("attribute")??"ali",d=i.get("scope")??"unset",h=i.get("page")??"1",a=i.get("pageSize")??"12",[u,b]=I.useState("ali"),[f,g]=I.useState("unset"),[p,y]=I.useState(null),[A,T]=I.useState("desc"),v=I.useMemo(()=>{const R=n.map(L=>s(L)),D=d==="unset"?void 0:N[d.toUpperCase()],j=R.filter(L=>L.attributes?.[c]===D).map(L=>L.id),[S,w]=(p??"::").split("::");return x.orderBy(j,[L=>S==="attribute"?s(L)?.attributes?.[w]:!0,L=>S==="prop"?Number(L):!0,L=>s(L)?.updatedAt,L=>Number(L)],[A,"asc","desc","asc"])},[c,d,p,A]),C=I.useMemo(()=>{if(u!==c||f!==d)return b(c),g(d),o("page","1"),v.slice(0,Number(a));const R=(Number(h)-1)*Number(a),D=R+Number(a);return v.slice(R,D)},[h,a,v]),m=t.find(R=>R.id===c),F=(R,D,j)=>{const S=s(R);r(R,{...S,attributes:{...S.attributes,[D]:j}})},B=()=>{l(C.map(R=>{const D=s(R);return D.attributes[c]||(D.attributes[c]=N.UNRELATED),D}))};return{group:v,stats:{total:n.length,group:v.length,percent:Math.round(v.length/n.length*100)},pageIds:C,attribute:m,updateAttributeValue:F,updatePageItemsAsUnrelated:B,sorting:{sortBy:p,setSortBy:y,sortOrder:A,setSortOrder:T},pagination:{total:v.length,current:Number(h),pageSize:Number(a),onChange:R=>o("page",String(R)),onShowSizeChange:(R,D)=>o("pageSize",String(D)),pageSizeOptions:[12,24,48,96]}}}const ys=(t,r)=>r==="unset"||!r?`${100-t.percent}% done, ${t.group} left`:`${t.percent}%  - ${t.group} items`;function As(){const{getItem:t,getItemAttributeValues:r,attributesList:s}=U(),{attribute:n,pageIds:l,updateAttributeValue:i,updatePageItemsAsUnrelated:o,pagination:c,stats:d,sorting:h}=vs(),{queryParams:a,addParam:u}=O(),b=Ot("(max-width: 1024px)");if(x.isEmpty(n))return e.jsx(Q,{className:"my-4",children:e.jsx(V.Text,{type:"secondary",children:"No group attribute has been selected."})});const f=e.jsx(E,{justify:"center",children:e.jsx(At,{current:c.current,onChange:c.onChange,onShowSizeChange:c.onShowSizeChange,pageSize:c.pageSize,pageSizeOptions:c.pageSizeOptions,total:c.total},"pagination")}),g=e.jsxs(E,{align:"center",children:[e.jsx(V.Text,{className:"mr-2",children:"Sort by"}),e.jsxs(J,{onChange:A=>h.setSortBy(A),style:{width:120},value:h.sortBy,children:[e.jsx(J.Option,{value:null,children:"Last Updated"}),e.jsx(J.Option,{value:"prop::id",children:"Id"}),s.map(A=>e.jsx(J.Option,{value:`attribute::${A.id}`,children:A.name.en},A.id))]})]}),y=(a.get("scope")==="unset"||!a.get("scope"))&&e.jsx(Nt,{onConfirm:o,title:`Are you sure everything is unrelated to ${n.name.en}?`,children:e.jsx(P,{className:"mx-2",danger:!0,disabled:l.length===0,type:"primary",children:"Unrelate Unset Items on Page"})},"unrelate-button");return e.jsxs(Q,{actions:[e.jsxs(E,{justify:"space-between",children:[y,e.jsx(Cs,{},"navigation-buttons")]},"options"),f].filter(Boolean),className:"my-4",extra:e.jsxs(E,{align:"center",className:"mx-2",justify:"space-around",children:[g,f]}),title:e.jsxs(V.Text,{children:[n?.name.en," (",ys(d,a.get("scope")),") -"," ",n.description.en]}),children:[l.length===0&&e.jsx(se,{description:"No items found in this scope for this attribute.",image:se.PRESENTED_IMAGE_SIMPLE}),l.map(A=>{const T=r(A),v=t(A);return e.jsx(Q.Grid,{style:{width:b?"50%":"25%"},children:e.jsxs(E,{gap:6,children:[e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(H,{item:v,width:75}),e.jsx(Y,{item:v}),e.jsxs(k.Compact,{children:[e.jsx(ne,{item:v}),e.jsx(P,{onClick:()=>u("drawer",v.id),shape:"round",size:"small",children:"Drawer"})]}),e.jsx(z,{item:v,language:"en"}),e.jsx(z,{item:v,language:"pt"})]}),e.jsx(ae,{attribute:n,onChange:(C,m)=>i(v.id,C,m),onlyButtons:!0,value:T.attributes[n.id]})]})},`${A}-${T.updatedAt}`)}),e.jsx(be,{})]})}function Cs(){const{queryParams:t,addParam:r}=O(),{attributesList:s}=U(),n=t.get("attribute"),l=()=>{const o=s.findIndex(d=>d.id===n),c=s[o-1];c&&r("attribute",c.id)},i=()=>{const o=s.findIndex(d=>d.id===n),c=s[o+1];c&&r("attribute",c.id)};return e.jsxs(E,{className:"mx-8",gap:6,justify:"space-between",children:[e.jsx(P,{disabled:n===s[0]?.id,onClick:l,children:"Previous Attribute"},"previous"),e.jsx(ze,{},"go-to-top"),e.jsx(P,{disabled:n===s[s.length-1]?.id,onClick:i,children:"Next Attribute"},"next")]})}function Ge(){const{attributesList:t,availableItemIds:r,addAttributesToUpdate:s,getItemAttributeValues:n}=U(),{queryParams:l}=O(),[i,o]=I.useState([]),[c,d]=I.useState(),h=()=>{const f=l.get("attribute")??x.sample(t)?.id??"ali",g=t.find(T=>T.id===f)??x.sample(t),p=Number(l.get("size"))||9,y=[],A=x.shuffle(r);for(let T=0;T<A.length&&y.length!==p;T++){const v=A[T];n(v).attributes[f]||y.push(v)}return{selectedAttribute:g,selected:y}},a=()=>{let f=h(),g=0;for(;f.selected.length===0&&g<30;)f=h(),g++;d(f.selectedAttribute),o(f.selected)},u=I.useMemo(()=>c?r.filter(f=>!n(f).attributes[c?.id]).length:0,[c,r]);return{sampleIds:i,attribute:c,itemsLeftForAttribute:u,onGetSample:a,updateAttributeValue:(f,g,p)=>{const y=n(f);s(f,{...y,attributes:{...y.attributes,[g]:p}})}}}function Ts(){const{getItem:t,getItemAttributeValues:r}=U(),{sampleIds:s,attribute:n,onGetSample:l,updateAttributeValue:i,itemsLeftForAttribute:o}=Ge(),{addParam:c}=O();if(x.isEmpty(s)&&x.isEmpty(n))return e.jsxs(Q,{className:"my-4",children:[e.jsxs(V.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",e.jsx(P,{onClick:l,size:"small",type:"primary",children:"Get Sample"})]}),e.jsx(_,{}),e.jsx(Te,{})]});const d=s.map(u=>({itemAttributes:r(u),item:t(u)})),h=d.filter(({itemAttributes:u})=>n?.id&&!u.attributes[n.id]),a=()=>{h.forEach(({item:u})=>{n?.id&&i(u.id,n.id,-3)})};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsxs(Q,{actions:[e.jsx(P,{danger:!0,disabled:h.length===0,onClick:a,children:"Mark rest as unrelated"},"1"),e.jsx(P,{ghost:!0,onClick:l,type:"primary",children:"Get New Sample"},"2")],className:"my-4",extra:e.jsx(P,{onClick:l,size:"small",type:"primary",children:"Get New Sample"}),title:e.jsxs(V.Text,{children:[n?.name.en," - ",n?.description.en," (",o," items left)"]}),children:[e.jsxs(E,{gap:6,vertical:!0,children:[d.length===0&&e.jsx(se,{description:"No unset items found for this attribute.",image:se.PRESENTED_IMAGE_SIMPLE}),d.map(({item:u,itemAttributes:b})=>e.jsxs(I.Fragment,{children:[e.jsxs(E,{gap:6,children:[e.jsx(H,{item:u,width:75}),e.jsxs(E,{gap:6,vertical:!0,children:[e.jsxs(E,{gap:6,children:[e.jsx(Y,{item:u}),e.jsxs(k.Compact,{children:[e.jsx(ne,{item:u}),e.jsx(P,{onClick:()=>c("drawer",u.id),shape:"round",size:"small",children:"Drawer"})]})]}),e.jsx(z,{item:u,language:"en"}),e.jsx(z,{item:u,language:"pt"})]}),!!n&&e.jsx(ae,{attribute:n,onChange:(f,g)=>i(u.id,f,g),value:b.attributes[n.id]})]}),e.jsx(_,{className:"my-1"})]},`${u.id}-${b.updatedAt}`))]}),e.jsx(be,{})]})]})}function Te(){const[t,r]=bt(!1),{addParam:s,removeParam:n}=O(),{sampleIds:l,attribute:i,onGetSample:o,updateAttributeValue:c}=Ge(),{getItem:d,getItemAttributeValues:h}=U(),a=()=>{s("size","1"),r(!0),o()},u=()=>{n("size"),r(!1)},b=l[0],f=d(b),g=h(b);return e.jsxs(E,{className:"mt-4",children:[e.jsx(P,{onClick:a,type:"primary",children:"Single Sampler"}),e.jsxs(Je,{cancelButtonProps:{style:{display:"none"}},maskClosable:!1,onCancel:u,onOk:u,open:t,title:e.jsxs(V,{children:["Single Sampler: ",e.jsx("strong",{children:i?.name.en})]}),width:"100vw",children:[b&&f&&g&&i&&e.jsxs(E,{className:"my-10",gap:6,wrap:"wrap",children:[e.jsx(H,{item:f,width:150}),e.jsxs(E,{gap:6,vertical:!0,children:[e.jsxs(E,{gap:6,children:[e.jsx(Y,{item:f}),e.jsx(ne,{item:f})]}),e.jsx(z,{item:f,language:"en"}),e.jsx(z,{item:f,language:"pt"})]}),!!i&&e.jsx(ae,{attribute:i,onChange:async(p,y)=>{c(f.id,p,y),await pt(500),o()},size:"large",value:g.attributes[i.id]})]},b),e.jsx(P,{onClick:o,children:"Another Sample"})]})]})}function Es(){const t=te("items-attributes"),r=te("items-attribute-values"),[s,n]=I.useState(null),l=()=>{n(Ee(t.data,r.data))},i=()=>{const o={};let c=0;for(;c<300||x.keys(o).length===15;){const d=Ee(t.data,r.data);if(d.valid&&!o[d.setId]&&(o[d.setId]=d),x.keys(o).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(o).map((d,h)=>({...d,number:d.number-h})))};return e.jsxs("div",{className:"my-4",children:[e.jsx(V.Title,{level:3,children:"Daily Simulator"}),e.jsx(V.Paragraph,{children:"Generates a daily game for Alien Communication"}),e.jsxs(k,{children:[e.jsx(P,{onClick:l,type:"primary",children:"Generate"}),e.jsx(P,{onClick:i,children:"Generate List"})]}),e.jsx("div",{children:!!s&&e.jsxs(k,{direction:"vertical",children:[e.jsx(V.Title,{level:5,children:s?.setId}),!s?.valid&&e.jsx(We,{message:"Invalid game",type:"error"}),e.jsx(k,{direction:"vertical",children:s?.attributes.map(o=>e.jsxs(E,{gap:8,children:[e.jsx(K,{signId:o.spriteId,width:50}),o.itemsIds.map(c=>e.jsx(ve,{itemId:c||"0",width:50},c))]},o.id))}),e.jsx(_,{className:"my-1"}),e.jsx(k,{direction:"horizontal",children:s?.requests.map(o=>e.jsxs(E,{vertical:!0,children:[e.jsx(K,{signId:o.spritesIds[2],width:50}),e.jsx(K,{signId:o.spritesIds[1],width:50}),e.jsx(K,{signId:o.spritesIds[0],width:50})]},o.itemId))}),e.jsx(_,{className:"my-1"}),e.jsx(k,{direction:"horizontal",children:s?.itemsIds.map(o=>e.jsx(ve,{itemId:o||"0",width:50},o))})]},s?.setId)})]})}const Ee=(t,r)=>{const s=x.values(t).filter(m=>!m.limited||m.id==="sol"),n=x.shuffle(x.values(r).filter(m=>m.complete)),l=x.shuffle(gt(38,0)),i=x.sampleSize(s,3).map(m=>({...m,spriteId:`${l.pop()}`})),o=[],c=[],d=[],h=[],a=[],u=[],b=[],f=[];n.forEach(m=>{const F=[N.DETERMINISTIC,N.RELATED],B=m.attributes[i[0].id]===N.DETERMINISTIC,R=F.includes(m.attributes[i[0].id]),D=m.attributes[i[0].id]===N.UNRELATED,j=m.attributes[i[1].id]===N.DETERMINISTIC,S=F.includes(m.attributes[i[1].id]),w=m.attributes[i[1].id]===N.UNRELATED,L=m.attributes[i[2].id]===N.DETERMINISTIC,X=F.includes(m.attributes[i[2].id]),oe=m.attributes[i[2].id]===N.UNRELATED;if(D&&w&&oe){f.push(m.id);return}B&&w&&oe&&o.push(m.id),D&&j&&oe&&c.push(m.id),D&&w&&L&&d.push(m.id),R&&S&&oe&&h.push(m.id),R&&w&&X&&a.push(m.id),D&&S&&X&&u.push(m.id),R&&S&&X&&b.push(m.id)});const g=i.map(m=>({id:m.id,name:m.name.pt,description:m.description.pt,spriteId:m.spriteId,itemsIds:[]}));g[0].itemsIds=x.sampleSize(o,o.length>3?3:Math.max(o.length-1,1)),g[1].itemsIds=x.sampleSize(c,c.length>3?3:Math.max(o.length-1,1)),g[2].itemsIds=x.sampleSize(d,d.length>3?3:Math.max(o.length-1,1));const p=[];g.forEach(m=>{p.push(...m.itemsIds)});const y=[];h.length>0&&y.push({spritesIds:[i[0].spriteId,i[1].spriteId],itemId:x.sample(h)??""}),a.length>0&&y.push({spritesIds:[i[0].spriteId,i[2].spriteId],itemId:x.sample(a)??""}),u.length>0&&y.push({spritesIds:[i[1].spriteId,i[2].spriteId],itemId:x.sample(u)??""}),b.length>0&&y.push({spritesIds:i.map(m=>m.spriteId),itemId:x.sample(b)??""});const A=[];o.length>0&&A.push({spritesIds:[i[0].spriteId],itemId:o.filter(m=>!p.includes(m))[0]}),c.length>0&&A.push({spritesIds:[i[1].spriteId],itemId:c.filter(m=>!p.includes(m))[0]}),d.length>0&&A.push({spritesIds:[i[2].spriteId],itemId:d.filter(m=>!p.includes(m))[0]}),console.log({attributeA:o,attributeB:c,attributeC:d,attributeAB:h,attributeAC:a,attributeBC:u,attributeABC:b}),console.log("COMPLEX REQUEST SIZE",y.length),console.log("SIMPLE REQUEST SIZE",A.length);let T=x.sampleSize(y,4);console.log("REQUEST SIZE",T.length),T.length<3&&T.push(...x.sampleSize(A,4-T.length)),T.length<4&&console.warn("Not enough requests"),T=x.shuffle(T);const v=T.map(m=>m.itemId),C={id:"2024-00-00",setId:g.map(m=>m.id).sort().join("-"),number:0,type:"comunicacao-alienigena",attributes:g,requests:T,solution:v.join("-"),itemsIds:x.shuffle([...v,f[0],f[1],f[2],f[3]]).filter(Boolean),valid:!1};return C.valid=[C.attributes.length===3,C.requests.length===4,C.itemsIds.length>5,C.attributes.every(m=>m.itemsIds.length>0),C.requests.every(m=>m.itemId)].every(Boolean),console.log(C),C},Ss=["","I","II","III","IV","V"];function Ns(){const{attributes:t,availableItemIds:r,getItemAttributeValues:s,getItem:n}=U(),{message:l}=he.useApp(),[i,o]=I.useState(25),[c,d]=I.useState(80),[h,a]=I.useState(!1),[u,b]=I.useState([]),[f,g]=I.useState([]),[p,y]=I.useState(null),[A,T]=I.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),v=()=>{const m={},F=x.shuffle(r);for(;Object.values(m).length<i;){const j=F.pop();if(!j)break;const S=s(j);S&&(!S.complete||!S.reliability||S.reliability<c||!h&&n(j).nsfw||(S.signature&&!m[S.signature]?m[S.signature]=j:console.log("Item has identical key to another item. Skipping.",n(j).name.en)))}const B=Object.values(m);B.length<i&&l.error(`Could not generate sample. Got only ${B.length} items`),b(x.sortBy(B,j=>Number(j)));const R=ws(B.map(j=>s(j)),25,t);if(R.length<25){const j=x.keys(t).filter(L=>!R.includes(L)),w=x.sortBy(j,L=>t[L].priority).slice(0,25-R.length);console.log("Adding more attributes by priority",w),R.push(...w)}const D=R.reduce((j,S)=>(B.forEach(w=>{const L=s(w);if(L)switch(L.attributes[S]){case N.RELATED:j.relatedCount[S]=(j.relatedCount[S]||0)+1;break;case N.DETERMINISTIC:j.deterministicCount[S]=(j.deterministicCount[S]||0)+1;break;case N.UNCLEAR:j.unclearCount[S]=(j.unclearCount[S]||0)+1;break;case N.OPPOSITE:j.oppositeCount[S]=(j.oppositeCount[S]||0)+1;break}}),j),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});g(R.sort().map(j=>({...t[j],relatedCount:D.relatedCount[j],deterministicCount:D.deterministicCount[j],unclearCount:D.unclearCount[j],oppositeCount:D.oppositeCount[j]})))},C=m=>{T(F=>({...F,[m]:!F[m]}))};return e.jsxs("div",{className:"my-4",children:[e.jsx(V.Title,{level:3,children:"Simulator"}),e.jsx(V.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),e.jsxs(E,{gap:12,wrap:!0,children:[e.jsx(W,{label:"Grid Size",onChange:m=>o(m),options:[16,25],value:i}),e.jsx(we,{label:"Reliability Threshold",max:100,min:10,onChange:m=>d(m),step:5,value:c}),e.jsx(G,{label:"NSFW",onChange:a,value:h}),e.jsx(P,{onClick:v,type:"primary",children:"Get Sample Board"})]}),e.jsxs(E,{gap:12,wrap:!0,children:[e.jsx(le,{label:"Show Id",onChange:()=>C("id"),value:!!A.id}),e.jsx(le,{label:"Show Name (EN)",onChange:()=>C("nameEn"),value:!!A.nameEn}),e.jsx(le,{label:"Show Name (PT)",onChange:()=>C("namePt"),value:!!A.namePt}),e.jsx(le,{label:"Show Reliability",onChange:()=>C("reliability"),value:!!A.reliability})]}),e.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(i)}, 1fr)`},children:u.map(m=>{const F=n(m),B=s(m);return e.jsxs(k,{align:"center",className:de("simulator-grid__entry",p&&B.attributes[p]>0&&"simulator-grid__entry--highlighted"),direction:"vertical",children:[e.jsxs(k,{children:[e.jsxs(E,{vertical:!0,children:[A.id&&e.jsx(Y,{item:F}),A.reliability&&e.jsx("span",{children:e.jsx(rt,{formatter:R=>`${R}%`,placeholder:"Reliability",prefix:e.jsx(_t,{}),readOnly:!0,size:"small",style:{width:"8ch"},value:B.reliability,variant:"borderless"})}),A.id&&e.jsx(ne,{item:F})]}),e.jsx(H,{item:F,width:50})]}),A.nameEn&&e.jsx(z,{item:F,language:"en"}),A.namePt&&e.jsx(z,{item:F,language:"pt"})]},m)})}),e.jsx("div",{className:"simulator-grid my-4",children:f.map(m=>e.jsxs(wt,{className:de("simulator-grid__entry","simulator-grid__button",p===m.id&&"simulator-grid__entry--highlighted"),onClick:()=>y(m.id),children:[m.name.en," ",Ss[m.level],e.jsxs(E,{className:"my-1",gap:6,justify:"center",children:[e.jsxs("span",{children:[e.jsx(nt,{style:{color:m.deterministicCount?"dodgerblue":void 0}})," ",m.deterministicCount??0]}),e.jsxs("span",{children:[e.jsx(Tt,{style:{color:m.relatedCount?"green":void 0}})," ",m.relatedCount??0]}),e.jsxs("span",{children:[e.jsx(Ft,{style:{color:m.oppositeCount?"red":void 0}})," ",m.oppositeCount??0]}),e.jsxs("span",{children:[e.jsx(Ne,{style:{color:m.unclearCount?"gold":void 0}})," ",m.unclearCount??0]})]})]},m.id))}),e.jsx(Es,{})]})}function ws(t,r,s){const n={},l={};t.forEach(g=>{g&&Object.keys(g.attributes).forEach(p=>{g.attributes[p]>0&&(n[p]=(n[p]||0)+1),g.attributes[p]===N.DETERMINISTIC&&(l[p]=!0,n[p]=(n[p]||0)+2),g.attributes[p]===N.OPPOSITE&&(n[p]=(n[p]||0)+1)})});const i={1:0,2:0,3:0,4:0};function o(g){return g.filter(p=>(i[s[p].level]++,i[4]>1?(console.log("Discarding level 4 attribute",p),!1):!0))}const c=o(Object.keys(l)),d=o(x.keys(n).filter(g=>!c.includes(g)));if(console.log({levelCount:i}),r===c.length)return console.log("All keys are deterministic"),c;if(console.log(n),c.length===0)return[];const h=c.reduce((g,p)=>{const y=n[p];return g[y]||(g[y]=[]),g[y].push(p),g},{}),a=x.keys(h).sort((g,p)=>Number(p)-Number(g));console.log({sortedDeterministicTiedGroupsKeys:a});const u=d.reduce((g,p)=>{const y=n[p];return g[y]||(g[y]=[]),g[y].push(p),g},{});console.log(u);const b=x.keys(u).sort((g,p)=>Number(p)-Number(g)),f=[];for(const g of a){if(f.length===r)break;f.push(...x.sampleSize(h[g],r-f.length))}for(const g of b){if(f.length===r)break;f.push(...x.sampleSize(u[g],r-f.length))}return f}function Ps(){const{attributes:t}=U(),r=[{key:"1",label:"All Attributes",children:e.jsx(Z,{type:"all"})},{key:"2",label:"Default",children:e.jsx(Z,{type:"default"})},{key:"3",label:"Custom",children:e.jsx(Z,{type:"custom"})},{key:"4",label:"Limited",children:e.jsx(Z,{type:"limited"})},{key:"5",label:"Specific",children:e.jsx(Z,{type:"specific"})},{key:"6",label:"Opposite",children:e.jsx(Z,{type:"opposite"})}];return e.jsxs("div",{className:"my-4",children:[e.jsxs(E,{align:"center",justify:"space-between",children:[e.jsx(V.Title,{level:5,children:"Stats"}),e.jsx(Pe,{data:()=>Ls(t),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),e.jsx(Pt,{defaultActiveKey:"1",items:r})]})}const Rs=(t,r)=>{let s=0,n=0,l=0,i=0,o=0,c=0,d=0,h=0;r.forEach(({attributes:v})=>{if(v[t.id]){s++;const C=v[t.id];C===10?n++:C===5?l++:C===0||!C?i++:C===-1?o++:C===-3?c++:C===-10&&d++,C>0&&h++}});const a=r.length,u=s/a*100,b=n/a*100,f=l/a*100,g=i/a*100,p=o/a*100,y=c/a*100,A=d/a*100,T=h/a*100;return{completionPercentage:u.toFixed(1),tensPercentage:b.toFixed(1),fivesPercentage:f.toFixed(1),zerosPercentage:g.toFixed(1),negativeOnesPercentage:p.toFixed(1),negativeThreesPercentage:y.toFixed(1),negativeTensPercentage:A.toFixed(1),positivePercentage:T.toFixed(1)}};function Z({type:t}){const{availableItemIds:r,getItemAttributeValues:s,attributesList:n}=U(),l=Xe(),{is:i}=O(),o=I.useMemo(()=>{const a=new Array(65).fill(0).map((b,f)=>f),u=n.map(b=>b.spriteId);return a.filter(b=>!u.includes(`sign-${b}`))},[n]),c=I.useMemo(()=>t==="default"?n.filter(a=>a.default):t==="custom"?n.filter(a=>!a.default):t==="limited"?n.filter(a=>a.limited):t==="specific"?n.filter(a=>a.specific):t==="opposite"?n.filter(a=>a.oppositeId):n,[n,t]),d=I.useMemo(()=>{const a=r.map(u=>s(u));return c.map(u=>({...u,...Rs(u,a)}))},[c,r,s]),h=[{title:"Attribute",dataIndex:"name",key:"name",render:(a,u)=>e.jsxs(E,{align:"center",gap:8,children:[i("showGlyphs")&&e.jsx(K,{signId:u.spriteId,width:30}),a.en,u.default&&e.jsx(ee,{className:"ml-1",children:"default"}),u.limited&&e.jsx(ee,{className:"ml-1",children:"limited"}),(u.specific||u.parentId)&&e.jsx(ee,{className:"ml-1",children:"specific"}),u.oppositeId&&e.jsx(ee,{className:"ml-1",children:e.jsx(et,{})}),e.jsx($e,{title:u.description.en})]}),sorter:(a,u)=>a.name.en.localeCompare(u.name.en)},{title:e.jsx(Rt,{}),dataIndex:"spriteId",key:"spriteId",render:a=>e.jsx(K,{padding:0,signId:a,width:18})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(a,u)=>a.priority-u.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.positivePercentage)-Number.parseFloat(u.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(a,u)=>u.limited?"-":`${a}%`,sorter:(a,u)=>Number.parseFloat(a.tensPercentage)-Number.parseFloat(u.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.fivesPercentage)-Number.parseFloat(u.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeOnesPercentage)-Number.parseFloat(u.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeThreesPercentage)-Number.parseFloat(u.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeTensPercentage)-Number.parseFloat(u.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:a=>e.jsx(Le,{percent:Number.parseFloat(a),size:"small"}),sorter:(a,u)=>Number.parseFloat(a.completionPercentage)-Number.parseFloat(u.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:a=>e.jsx(Lt,{count:4,disabled:!0,value:a}),sorter:(a,u)=>a.level-u.level},{title:"Actions",key:"actions",render:a=>e.jsx(k,{children:e.jsxs(k.Compact,{children:[e.jsx(P,{onClick:()=>l(`/items/attribution?display=grouping&attribute=${a.id}&page=1`),shape:"round",size:"small",children:"Grouping"}),e.jsx(P,{onClick:()=>l(`/items/attribution?display=sampler&attribute=${a.id}&size=6`),shape:"round",size:"small",children:"Sample"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(V.Paragraph,{children:["Total: ",d.length]}),e.jsx(De,{columns:h,dataSource:d,pagination:!1,rowKey:"id",size:"small"}),e.jsx(E,{gap:8,wrap:"wrap",children:o.map(a=>e.jsxs("div",{children:["#",a,e.jsx(K,{signId:`sign-${a}`},a)]},a))})]})}function Ls(t){const r=x.cloneDeep(t);return xe(Re(r),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Ds(){const{queryParams:t}=O(),r=t.get("display")??"classifier";return r==="classifier"?e.jsxs(e.Fragment,{children:[e.jsxs(E,{align:"center",className:"my-4",gap:8,wrap:!0,children:[e.jsx(hs,{}),e.jsx(xs,{}),e.jsx(bs,{}),e.jsx(ot,{path:"/tdr/itemsAttributeValues"})]}),e.jsx(gs,{}),e.jsx(E,{className:"my-4",justify:"flex-end",children:e.jsx(ze,{})})]}):r==="sampler"?e.jsx(Ts,{}):r==="grouping"?e.jsx(As,{}):r==="comparator"?e.jsx(Is,{}):r==="simulator"?e.jsx(Ns,{}):r==="stats"?e.jsx(Ps,{}):e.jsx(se,{className:"my-10",description:"Unknown display has been selected"})}function Os(){const{isLoading:t,error:r,hasResponseData:s}=U();return e.jsx(tt,{subtitle:"Attribution",title:"Items",children:e.jsxs(je,{hasSider:!0,children:[e.jsx(ct,{children:e.jsx(cs,{})}),e.jsx(je.Content,{className:"content",children:e.jsx(st,{error:r,hasResponseData:s,isLoading:t,children:e.jsx(Ds,{})})})]})})}function wr(){return e.jsx(ss,{children:e.jsx(Os,{})})}export{wr as default};
