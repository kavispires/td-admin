import{r as j,a as te,_ as se,Y as qe,a1 as he,a0 as Ke,j as e,T as M,D as G,B as P,aq as Qe,G as Se,an as ue,ar as He,as as Ye,ao as fe,at as Je,au as Ze,av as We,P as Xe,L as je}from"./index-B3JH01iB.js";import{D as et}from"./DataLoadingWrapper-dh3jacIT.js";import{c as q,a as ee,b as Ne,d as ce,T as tt}from"./FilterEntries-u2pKqJxX.js";import{S as st}from"./SiderContent-y1ziTlGK.js";import{D as we}from"./DownloadButton-DJaKu1gp.js";import{S as rt}from"./SaveButton-yEblVGPH.js";import{l as x,c as de,E as ae,P as nt}from"./useBaseUrl-CZWZgKRs.js";import{A as V,d as N,e as it,f as Q}from"./constants-CzmVoJc0.js";import{e as at,g as ot,a as xe,d as Pe,w as lt,m as ct}from"./index-D-qWoO__.js";import{u as ut}from"./useGetFirestoreDoc-DtxW3_7b.js";import{u as ie}from"./useTDResource-b3rDQSkC.js";import{u as dt}from"./useUpdateFirestoreDoc-Bh11gTIF.js";import{u as D}from"./useQueryParams-BHv40m-x.js";import{T as ne}from"./index-QBggA2J0.js";import{F as S}from"./index-BCvCL0ga.js";import{F as mt}from"./FirestoreConsoleLink-C9VHUt98.js";import{R as pt}from"./VerticalAlignTopOutlined-DObUa9JM.js";import{I as J,a as Z,b as $,c as oe}from"./ItemBuildingBlocks-D5M_7PUR.js";import{a as Re}from"./index-Dt5YmjhO.js";import{R as Ie}from"./index-DZHJosB8.js";import{I as ve}from"./Item-DsGe7FNE.js";import{P as Le}from"./progress-DwFhCbdw.js";import{R as ye,u as gt}from"./useToggle-DGrC0bxE.js";import{C as Y}from"./index-C67ry3Wy.js";import{A as ht}from"./index-DLNyhCVg.js";import{S as F}from"./index-Dszr5pPb.js";import{I as ft}from"./ItemsTypeahead-C56GRNry.js";import{R as xt,a as bt,P as jt}from"./Pagination-azJyVn8J.js";import{S as X}from"./index-Ulf3nzcb.js";import{R as It,F as Oe,a as vt}from"./Table-DC7vW2Ha.js";import{D as yt}from"./index-Ddj0VRSE.js";import{S as At}from"./index-CaSPROP-.js";import{P as Ct}from"./index-a4KRvsSI.js";import{M as Tt}from"./index-DwCN1xmH.js";import{T as Et}from"./TransparentButton-CJptdkCp.js";import{T as St}from"./index-Cst7AYXC.js";import{R as Nt}from"./SkinOutlined-Dnvs89gD.js";import{R as wt}from"./index-DcaEoYm-.js";import"./index-DGt5aRqD.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-C6W0l_YX.js";import"./useMutation-CY39LX1i.js";import"./gapSize-U1swVQyS.js";import"./LanguageFlag-CBU9M51y.js";import"./useCopyToClipboardFunction-DvRK2P3Q.js";import"./index-DecZ6U45.js";import"./Input-DYhQBLMT.js";import"./FireFilled-D0Yiv99U.js";import"./IdcardOutlined-CghYbHQl.js";import"./throttleByAnimationFrame-BXEpjMlr.js";import"./useDebounce-fv0TqeIb.js";import"./index-BhulK3H1.js";import"./index-CVDTN0au.js";import"./scrollTo-BUBUSE1i.js";import"./PlusOutlined-C-HTnxQk.js";var Pt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"},Rt=function(i,t){return j.createElement(te,se({},i,{ref:t,icon:Pt}))},Lt=j.forwardRef(Rt),Ot={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},Dt=function(i,t){return j.createElement(te,se({},i,{ref:t,icon:Ot}))},Ut=j.forwardRef(Dt),Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},kt=function(i,t){return j.createElement(te,se({},i,{ref:t,icon:Mt}))},Vt=j.forwardRef(kt),Ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},zt=function(i,t){return j.createElement(te,se({},i,{ref:t,icon:Ft}))},Bt=j.forwardRef(zt),$t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},_t=function(i,t){return j.createElement(te,se({},i,{ref:t,icon:$t}))},Gt=j.forwardRef(_t),qt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},Kt=function(i,t){return j.createElement(te,se({},i,{ref:t,icon:qt}))},Qt=j.forwardRef(Kt),Ht=function(s,i){return qe?window.matchMedia(s).matches:!1},Yt=function(s,i){var t=j.useState(Ht(s)),r=t[0],l=t[1];return j.useEffect(function(){var n=!0,o=window.matchMedia(s),c=function(){n&&l(!!o.matches)};return o.addEventListener("change",c),l(o.matches),function(){n=!1,o.removeEventListener("change",c)}},[s]),r};const De={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};x.keyBy(De,"prefix");const Jt=["*","^","+","~","!"],K={ATTRIBUTE_VALUE_DICT:De,ATTRIBUTE_VALUE_PRIORITY:Jt},me=(s={})=>x.cloneDeep(x.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},s)),pe=(s={})=>x.cloneDeep(x.merge({id:"",attributes:{}},s)),Ue=(s,i,t)=>{const r=x.orderBy(Object.values(i),["priority","id"],["asc","asc"]).map(a=>a.id);function l(a,u){return x.orderBy(a,b=>r.indexOf(b),["asc"]).map(b=>`${u}${b}`)}const n=[],o=[],c=[],m=[],g=[];return Object.entries(s.attributes).forEach(([a,u])=>{if(i[a])switch(u){case N.OPPOSITE:n.push(a);break;case N.DETERMINISTIC:o.push(a);break;case N.RELATED:c.push(a);break;case N.UNRELATED:m.push(a);break;case N.UNCLEAR:g.push(a);break;default:g.push(a);break}}),[...l(n,V.OPPOSITE),...l(o,V.DETERMINISTIC),...l(c,V.RELATED),...l(m,V.UNRELATED),...l(g,V.UNCLEAR)]},Me=x.memoize(s=>{if(s.length===3)return{key:s,className:"",text:""};const i=s[0];return{key:s.slice(1,4),className:{[V.DETERMINISTIC]:"deterministic",[V.UNRELATED]:"unrelated",[V.UNCLEAR]:"unclear",[V.OPPOSITE]:"opposite"}[i],text:{[V.DETERMINISTIC]:"very",[V.UNRELATED]:"not",[V.UNCLEAR]:"maybe",[V.OPPOSITE]:"very not"}[i]}}),ke=(s,i,t)=>s.filter(r=>!(!i&&r.includes(V.UNCLEAR)||!t&&r.includes(V.UNRELATED)));function ge(s,i,t){const r=[];for(const[o,c]of Object.entries(s.attributes)){const m=i[o];if(m){const g=Object.values(K.ATTRIBUTE_VALUE_DICT).find(a=>a.value===c);g&&r.push({prefix:g.prefix,id:m.id,priority:m.priority})}}const l=x.sortBy(r,[o=>K.ATTRIBUTE_VALUE_PRIORITY.indexOf(o.prefix),o=>o.prefix===K.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:o.priority,["asc","asc"]]),n=t!=null&&t.length?l.slice(0,t==null?void 0:t.length):l;return t!=null&&t.onlyRelevant?n.filter(o=>[K.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,K.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(o.prefix)).map(o=>`${o.prefix}${o.id}`).join(""):n.map(o=>`${o.prefix}${o.id}`).join((t==null?void 0:t.delimiter)??"")}const Zt=x.keyBy(K.ATTRIBUTE_VALUE_DICT,"prefix");function Wt(s){return(s.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((t,r)=>{const l=r[0],n=r.slice(1),o=Zt[l].value;return t[n]=o,t},{})}function Ve(s){return Object.values(s.attributes).reduce((i,t)=>{let r=i;return t<=0?(t===K.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(r+=t/2),r):r+t},0)}function Fe(s,i){const t=Object.values(s.attributes).filter(r=>r===K.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((i-t)/i*100)}const re={};function Xt(){const{notification:s,message:i}=he.useApp(),t=Ke(),r=ie("items"),l=ie("items-attributes"),n=ie("items-attribute-values"),o=ut("tdr","itemsAttributeValues",{select:I=>ts({itemAttributesValues:I,itemAttributes:l.data??{}})}),[c,m]=j.useState({}),g=dt("tdr","itemsAttributeValues",{onSuccess:()=>{s.success({message:"itemsAttributeValues updated"}),t.refetchQueries({queryKey:["firestore","tdr","itemsAttributeValues"]}),m({})},onError:I=>{s.error({message:"itemsAttributeValues update failed",description:I.message})}}),a=j.useMemo(()=>({...n.data??{},...o.data??{}}),[n.data,o.data]),u=!x.isEmpty(c),b=(I,y)=>{m(d=>({...d,[I]:{...y,updatedAt:Date.now()}}))},f=I=>{m(y=>({...y,...x.mapKeys(I.map(d=>({...d,updatedAt:Date.now()})),"id")}))},h=o.data,p=()=>{g.mutate(es({...h,...c},l.data))};return{availableItemIds:j.useMemo(()=>{const I=r.data??{};return x.orderBy(Object.keys(I).filter(y=>{var d;return(((d=I[y])==null?void 0:d.decks)??[]).includes("alien")}),y=>Number(y),"asc")},[r.data]),getItem:I=>{var y;return(y=r.data)!=null&&y[I]?r.data[I]:(I&&i.info(`Item ${I} not found in TDR. Creating a new item...`),me({id:I}))},getItemAttributeValues:I=>{const y=(a==null?void 0:a[I])??{},d=c[I]??{};return x.isEmpty(y)&&x.isEmpty(d)?(re[I]=pe({id:I}),re[I]):x.merge((re==null?void 0:re[I])??{},y,d)},attributes:l.data??{},isLoading:r.isLoading||l.isLoading||n.isLoading||o.isLoading,error:r.error||l.error||n.error||o.error,firestoreData:h,hasFirestoreData:!x.isEmpty(o.data),isSaving:g.isPending,save:p,addAttributesToUpdate:b,addMultipleAttributesToUpdate:f,attributesToUpdate:c,isDirty:u}}const es=(s,i)=>ot(s,r=>({id:r.id,tempSignature:ge(r,i),updatedAt:r.updatedAt})),ts=s=>{const{itemAttributesValues:i,itemAttributes:t}=s,r=Object.keys(t).length;return at(i,n=>{const o=Wt(n.tempSignature),c=Object.keys(o).length===r,m={id:n.id,updatedAt:n.updatedAt,attributes:o};return c?{...m,complete:c,reliability:Fe(m,r),score:Ve(m)}:m})},ze=j.createContext({getItem:()=>me(),getItemAttributeValues:()=>pe(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:me(),itemAttributeValues:pe(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{},hasFirestoreData:!1}),ss=({children:s})=>{const{getItem:i,getItemAttributeValues:t,availableItemIds:r,isLoading:l,error:n,isSaving:o,save:c,addAttributesToUpdate:m,isDirty:g,attributes:a,addMultipleAttributesToUpdate:u,attributesToUpdate:b,hasFirestoreData:f}=Xt(),{message:h}=he.useApp(),p=j.useMemo(()=>x.orderBy(Object.values(a),"name.en","asc"),[a]),{queryParams:A}=D(),C=A.get("sortBy"),T=j.useMemo(()=>C==="id"?x.orderBy(r,v=>Number(v),"asc"):C==="updatedAt"?x.orderBy(r,v=>t(v).updatedAt,"desc"):C==="fewestAttributesLeft"?x.orderBy(r,v=>{const E=p.length-Object.keys(t(v).attributes).length;return E===0?Number.POSITIVE_INFINITY:E},"asc"):r,[r,C]),[I,y]=j.useState(x.random(0,T.length-1)),d=i(T[I]),k=t(d.id),z=(v,E)=>{if(v==="next"){y(w=>(w+1)%T.length);return}if(v==="previous"){y(w=>(w-1+T.length)%T.length);return}if(v==="random"){y(x.random(0,T.length-1));return}if(v==="first"){y(0);return}if(v==="last"){y(T.length-1);return}if(v==="next10"){y(w=>(w+10)%T.length);return}if(v==="previous10"){y(w=>(w-10+T.length)%T.length);return}if(v==="incomplete"){y(w=>{let L=w+1;for(;L<T.length;){const B=t(T[L]);if(Object.keys(B.attributes).length!==p.length)return L;if(L===T.length-1)return h.info("No more incomplete items found."),w;L++}return w});return}if(v==="goTo"&&E!==void 0){const w=T.indexOf(E);if(w!==-1){y(w);return}h.error(`Item ${E} is not available for attribution.`)}},R=(v,E)=>{m(d.id,{...k,attributes:{...k.attributes,[v]:E}})},O=()=>xe(r.reduce((v,E)=>{const w=t(E);return x.isEmpty(w.attributes)||(Object.keys(w.attributes).length===p.length?w.complete=!0:delete w.complete,v[w.id]=w),v},{}));return e.jsx(ze.Provider,{value:{getItem:i,getItemAttributeValues:t,availableItemIds:r,isLoading:l,error:n,hasResponseData:r.length>0&&!x.isEmpty(a),isDirty:g,itemAttributeValues:k,jumpToItem:z,activeItem:d,onAttributeChange:R,isSaving:o,save:c,attributes:a,attributesList:p,addAttributesToUpdate:m,addMultipleAttributesToUpdate:u,prepareItemsAttributesFileForDownload:O,attributesToUpdate:b,hasFirestoreData:f},children:s})},U=()=>j.useContext(ze);function _({label:s,children:i}){return e.jsxs(M.Text,{children:[s," ",e.jsx(ne,{children:i})]})}function rs(){const{getItemAttributeValues:s,availableItemIds:i,attributesList:t}=U(),{total:r,complete:l,completionPercentage:n,hasDataCount:o,initiatedPercentage:c,progress:m,progressTotal:g,currentProgress:a}=j.useMemo(()=>{const u=i.length;let b=0,f=0,h=0;i.map(C=>s(C)).forEach(({attributes:C})=>{x.isEmpty(C)||(b+=1),Object.values(C).length===t.length&&(f+=1),h+=Object.values(C).length});const A=Object.values(t).length*i.length;return{total:u,complete:f,completionPercentage:u>0?(f/u*100).toFixed(1):0,hasDataCount:b,initiatedPercentage:u>0?Math.floor(b/u*100):0,progress:(h/A*100).toFixed(1),currentProgress:h,progressTotal:A}},[t,i,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{vertical:!0,children:[e.jsx(M.Text,{className:"mb-2",strong:!0,children:"Items Stats"}),e.jsx(_,{label:"Total",children:r}),e.jsxs(_,{label:"Complete",children:[l," (",n,"%)"]}),e.jsxs(_,{label:"Initiated",children:[o," (",c,"%)"]}),e.jsx(M.Text,{className:"mt-4 mb-2",strong:!0,children:"Attributes Stats"}),e.jsx(_,{label:"Total",children:g}),e.jsx(_,{label:"Set",children:a}),e.jsxs(_,{label:"Progress",children:[m,"%"]})]}),e.jsx(G,{})]})}function ns(){const{jumpToItem:s}=U(),{addParam:i,is:t}=D();return e.jsxs(e.Fragment,{children:[e.jsx(P,{block:!0,onClick:()=>s("random"),type:"primary",children:"Random Item"}),e.jsx(q,{className:"mt-4",label:"Unset Only",onChange:r=>i("scope",r?"unset":""),value:t("scope","unset")})]})}function is(){const{queryParams:s,addParam:i}=D(),{attributesList:t}=U(),r=j.useMemo(()=>[{label:"Random Attribute",value:"random"},...t.map(({id:l,name:n})=>({label:n.en,value:l}))],[t]);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{label:"Sampler Attribute",onChange:l=>i("attribute",l),options:r,value:s.get("attribute")||"random"}),e.jsx(Ne,{label:"Sample Size",max:21,min:3,onChange:l=>i("size",String(l)),step:3,value:Number(s.get("size")||9)})]})}function as(){const{queryParams:s,addParam:i}=D(),{attributesList:t}=U(),r=j.useMemo(()=>t.map(({id:l,name:n,...o})=>({label:`${n.en}${o.default?"*":""}`,value:l})),[t]);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{label:"Attribute",onChange:l=>i("attribute",l),options:r,value:s.get("attribute")||"ali"}),e.jsx(ee,{label:"Scope",onChange:l=>i("scope",l),options:[{value:"unset",label:"Unset"},...it],value:s.get("scope")||"unset"}),e.jsx(ee,{label:"Results per page",onChange:l=>i("pageSize",l),options:[12,24,48,96],value:s.get("pageSize")||12})]})}function os(){const{addParam:s,is:i}=D();return e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"full-width m-0",label:"Only Complete",onChange:t=>s("showComplete",t?"true":""),value:i("showComplete")}),e.jsx(q,{className:"full-width m-0",label:"Show Unrelated",onChange:t=>s("showUnrelated",t?"true":""),value:i("showUnrelated")}),e.jsx(q,{className:"full-width m-0",label:"Show Unclear",onChange:t=>s("showUnclear",t?"true":""),value:i("showUnclear")})]})}function ls(){const{addParam:s,is:i}=D();return e.jsx(q,{className:"full-width m-0",label:"Show Glyphs",onChange:t=>s("showGlyphs",t?"true":""),value:i("showGlyphs")})}function cs(){const{isDirty:s,save:i,prepareItemsAttributesFileForDownload:t,attributes:r,isSaving:l,attributesToUpdate:n,hasFirestoreData:o}=U(),{queryParams:c,addParam:m}=D(),g=c.get("display")??"classifier";return e.jsxs(st,{children:[e.jsxs(S,{gap:12,vertical:!0,children:[e.jsx(rt,{dirt:JSON.stringify(n),isDirty:s,isSaving:l,onSave:i}),e.jsx(we,{block:!0,data:()=>us(t(),r),disabled:s,fileName:"items-attribute-values.json",hasNewData:o})]}),e.jsx(G,{}),e.jsx(rs,{}),e.jsx(ee,{label:"Display",onChange:a=>m("display",a),options:["classifier","sampler","grouping","comparator","simulator","stats"],value:g}),e.jsx(G,{}),g==="classifier"&&e.jsx(ns,{}),g==="sampler"&&e.jsx(is,{}),g==="grouping"&&e.jsx(as,{}),g==="comparator"&&e.jsx(os,{}),g==="stats"&&e.jsx(ls,{})]})}function us(s,i){const t=Object.keys(i).length;Object.keys(s).forEach(l=>{const n=s[l],o=Object.keys(n.attributes);o.forEach(m=>{i[m]||delete n.attributes[m]}),o.length===t?(n.complete=!0,n.score=Ve(n),n.reliability=Fe(n,t),n.signature=ge(n,i,{onlyRelevant:!0})):(n.complete=void 0,n.score=void 0,n.reliability=void 0,n.signature=void 0)});const r={};return Object.values(s).forEach(l=>{r[l.id]={id:l.id,updatedAt:l.updatedAt,signature:ge(l,i,{delimiter:":"})},l.complete&&(r[l.id].complete=l.complete)}),console.log(r),xe(Pe(s))}function Be(s){const[i,t]=j.useState(!1),r=()=>{t(window.scrollY>300)},l=()=>{window.scrollTo({top:0,behavior:"smooth"})};return Qe(()=>(window.addEventListener("scroll",r),()=>{window.removeEventListener("scroll",r)})),e.jsx(P,{className:`go-to-top-button ${i?"visible":""}`,icon:e.jsx(pt,{}),onClick:l,...s,children:"Go to Top"})}function $e({title:s,icon:i}){return e.jsx(Se,{title:s,children:i??e.jsx(Re,{})})}const Ae=[{label:"Opposite",value:N.OPPOSITE},{label:"Unrelated",value:N.UNRELATED},{label:"Unclear",value:N.UNCLEAR},{label:"Related",value:N.RELATED},{label:"Deterministic",value:N.DETERMINISTIC}],Ce=[{label:"Opposite",value:N.OPPOSITE},{label:"Unrelated",value:N.UNRELATED},{label:"Unclear",value:N.UNCLEAR},{label:"Related",value:N.RELATED},{label:"Deterministic",value:N.DETERMINISTIC,disabled:!0}];function le({attribute:s,value:i,onChange:t,onlyButtons:r,size:l}){return s?r?e.jsx(Ie.Group,{buttonStyle:"solid",onChange:({target:{value:n}})=>t(s.id,n),options:s.limited?Ce:Ae,optionType:"button",size:l,value:i}):e.jsxs("div",{className:"attribute-button-container__row",children:[e.jsxs("span",{className:"attribute-button-container__label",children:[x.truncate(s.name.en,{length:12})," ",e.jsx($e,{title:s.description.en})]}),e.jsx(Ie.Group,{buttonStyle:"solid",onChange:({target:{value:n}})=>t(s.id,n),options:s.limited?Ce:Ae,optionType:"button",size:l,value:i}),e.jsx("span",{children:e.jsx(ue,{style:{color:i&&i>7?"green":"transparent"}})})]},s.id):null}function ds({itemAttributeValues:s,attributes:i}){const{is:t,addParam:r}=D(),l=t("showUnclear"),n=t("showUnrelated"),o=j.useMemo(()=>ke(Ue(s,i),l,n),[s,i,l,n]),c=t("signs")?_e:ms;return e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(q,{className:"full-width m-0",label:"Show Unrelated",onChange:m=>r("showUnrelated",m?"true":""),value:t("showUnrelated")}),e.jsx(q,{className:"full-width m-0",label:"Show Unclear",onChange:m=>r("showUnclear",m?"true":""),value:t("showUnclear")}),e.jsx(q,{className:"full-width m-0",label:"Alien Signs",onChange:m=>r("signs",m?"true":""),value:t("signs")}),e.jsx(S,{className:"item-attribute-value-statement",gap:6,wrap:"wrap",children:o.map((m,g,a)=>e.jsx(c,{attributes:i,firstElement:g===0,keyVariant:m,lastElement:g===a.length-1},m))})]})}function _e({keyVariant:s,attributes:i,withText:t}){const{key:r,className:l,text:n}=Me(s);return e.jsxs(S,{align:"center",vertical:!0,children:[e.jsx(Q,{className:de("item-attribute-alien-sign",`item-attribute-alien-sign--${l}`),id:i[r].spriteId,width:50}),t&&e.jsxs(S,{align:"center",justify:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},wrap:"wrap",children:[n," ",i[r].name.en.toLowerCase()]})]})}function ms({keyVariant:s,attributes:i,firstElement:t,lastElement:r}){const{key:l,text:n}=Me(s),o=t?"It's ":"",c=r?".":", ";return e.jsxs(e.Fragment,{children:[o,n," ",i[l].name.en.toLowerCase(),c]})}function ps({attributesList:s,itemAttributeValues:i}){const{completion:t,isDeterministic:r,value:l,isOpposing:n,relevancy:o}=j.useMemo(()=>{const c=s.length,m=Object.keys(i.attributes).length,g=Math.floor(m/c*100);let a=!1,u=!1,b=0;const f=Object.values(i.attributes).reduce((p,A)=>A<=0?(A===N.UNCLEAR&&(b+=1),A===N.OPPOSITE&&(u=!0,p+=A/2),p):(A===N.DETERMINISTIC&&(a=!0),p+A),0),h=Math.floor((m-b)/c*100);return{completion:g,isDeterministic:a,value:f,isOpposing:u,relevancy:h}},[s,i.attributes]);return e.jsxs("div",{children:[e.jsx(M.Text,{strong:!0,children:"Completion"}),e.jsx(Le,{percent:t,size:"small"}),e.jsx(M.Text,{strong:!0,children:"Stats"}),e.jsxs(S,{vertical:!0,children:[e.jsx(_,{label:"Deterministic",children:r?e.jsx(ue,{style:{color:"green"}}):e.jsx(ye,{style:{color:"red"}})}),e.jsx(_,{label:"Opposing",children:n?e.jsx(ue,{style:{color:"CornflowerBlue"}}):e.jsx(ye,{style:{color:"grey"}})}),e.jsx(_,{label:"Value",children:l}),e.jsx(Se,{title:"The percentage of conclusive attributes (not unclear)",children:e.jsxs(_,{label:"Reliability",children:[o,"%"]})})]})]})}function gs(){const{activeItem:s,attributesList:i,itemAttributeValues:t,onAttributeChange:r,jumpToItem:l,attributes:n}=U(),{queryParams:o,removeParam:c,is:m}=D(),g=o.get("itemId"),a=o.get("filters");j.useEffect(()=>{g&&(c("itemId"),l("goTo",g))},[g]);const u=m("scope","unset"),b=j.useMemo(()=>{const f=u?i.filter(h=>!t.attributes[h.id]):i;if(a){const h=a.split(",").reduce((p,A)=>(p[A]=!0,p),{});return f.filter(p=>h[p.id])}return f},[u,s.id,a]);return s?e.jsx(Y,{children:e.jsxs("div",{className:"item-attribution-card",children:[e.jsx(ht,{className:"item-attribution-card__item",offsetTop:120,children:e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(J,{item:s,width:150}),e.jsx(Z,{item:s}),e.jsx($,{item:s,language:"en"}),e.jsx($,{item:s,language:"pt"}),e.jsx(G,{className:"my-2"}),e.jsx(ps,{attributesList:i,itemAttributeValues:t}),e.jsx(G,{className:"my-2"}),e.jsx(M.Text,{type:"secondary",children:e.jsx(ds,{attributes:n,itemAttributeValues:t})})]})}),e.jsx(F,{className:"my-4 attribute-button-container",direction:"vertical",size:"small",wrap:!0,children:b.map(f=>e.jsx(le,{attribute:f,onChange:r,value:t.attributes[f.id]},f.id))})]},`${s.id}`)}):e.jsx(Y,{children:e.jsxs(M.Text,{type:"secondary",children:["No item selected."," ",e.jsx(P,{onClick:()=>l("random"),size:"small",type:"primary",children:"Random Item"})]})})}function hs(){const{jumpToItem:s}=U();return e.jsxs(F.Compact,{children:[e.jsx(P,{icon:e.jsx(Qt,{}),onClick:()=>s("first"),children:"First"}),e.jsx(P,{icon:e.jsx(xt,{}),onClick:()=>s("previous10"),children:"Previous 10"}),e.jsx(P,{icon:e.jsx(He,{}),onClick:()=>s("previous"),children:"Previous"}),e.jsxs(P,{onClick:()=>s("next"),children:["Next ",e.jsx(Ye,{})]}),e.jsxs(P,{onClick:()=>s("next10"),children:["Next 10 ",e.jsx(bt,{})]}),e.jsxs(P,{onClick:()=>s("last"),children:["Last ",e.jsx(Gt,{})]}),e.jsx(fe,{content:e.jsx(fs,{}),title:"Go to item",children:e.jsx(P,{children:"Go To"})}),e.jsx(P,{onClick:()=>s("incomplete"),children:"Next Incomplete"})]})}function fs(){const{jumpToItem:s}=U();return e.jsx(ft,{isPending:!1,onFinish:i=>s("goTo",i)})}function xs(){const{addParam:s,queryParams:i}=D(),{attributesList:t}=U(),r=j.useMemo(()=>t.map(c=>({label:c.name.en,value:c.id})),[t]),l=c=>{s("filters",c.join(","))},n=i.get("filters"),o=e.jsx(X,{allowClear:!0,mode:"multiple",onChange:c=>l(c),options:r,style:{width:300},value:n==null?void 0:n.split(",")});return e.jsx(fe,{content:o,title:"Filter Attributes",children:e.jsx(P,{children:n?e.jsx(It,{style:{color:"gold"}}):e.jsx(Vt,{})})})}function bs(){const{addParam:s,queryParams:i}=D(),t=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],r=i.get("sortBy"),l=e.jsx(X,{allowClear:!0,onChange:n=>s("sortBy",n),options:t,style:{width:120},value:r});return e.jsx(fe,{content:l,title:"Sort By",children:e.jsx(P,{children:"Sort"})})}function js(){const{attributes:s,getItemAttributeValues:i,availableItemIds:t,getItem:r,isLoading:l}=U(),{is:n}=D(),o=n("showComplete"),c=n("showUnclear"),m=n("showUnrelated"),{itemMessages:g,itemMessagesDict:a,grouping:u}=j.useMemo(()=>{if(l)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const b=x.orderBy(t.map(p=>{const A=i(p),C=Ue(A,s);return{item:r(p),itemAttributesValues:A,message:ke(C,c,m),fullMessage:C}}).filter(({itemAttributesValues:p})=>o?p.complete:!0),["message"],["asc"]),f=b.reduce((p,{message:A,item:{id:C}})=>{const T=A.join(" ");return p[T]===void 0&&(p[T]=[]),p[T].push(C),p},{}),h=Object.values(f).filter(p=>p.length>1);return h.length>0&&console.log("More than one",h),{itemMessages:b,itemMessagesDict:x.keyBy(b,"item.id"),grouping:f}},[s,t,i,r,l,o,c,m]);return{itemMessages:g,itemMessagesDict:a,grouping:u}}function be(){const{queryParams:s,removeParam:i}=D(),t=s.get("drawer"),[r,l]=j.useState(!1),{activeItem:n,attributesList:o,itemAttributeValues:c,onAttributeChange:m,jumpToItem:g}=U(),a=()=>{i("drawer")};j.useEffect(()=>{t&&g("goTo",t)},[t]);const u=j.useMemo(()=>r?o.filter(b=>!c.attributes[b.id]):o,[r,n.id]);return e.jsxs(yt,{onClose:a,open:!!t,title:`Edit: ${n.name.en}`,width:"640px",children:[e.jsxs(S,{gap:6,children:[e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(J,{item:n,width:50}),e.jsx(Z,{item:n})]}),e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx($,{item:n,language:"en"}),e.jsx($,{item:n,language:"pt"})]}),e.jsx(S,{gap:6,vertical:!0,children:e.jsx(At,{checked:r,checkedChildren:"Unset",onChange:l,unCheckedChildren:"All"})})]}),e.jsx(G,{className:"my-1"}),e.jsx(F,{className:"my-4 attribute-button-container",direction:"vertical",size:"small",wrap:!0,children:u.map(b=>e.jsx(le,{attribute:b,onChange:m,size:"small",value:c.attributes[b.id]},b.id))})]})}function Is(){const{attributes:s}=U(),{itemMessages:i,grouping:t}=js(),{addParam:r}=D(),l=[{title:"Item Id",dataIndex:"item",key:"id",render:n=>e.jsxs("div",{children:[e.jsx(Z,{item:n}),e.jsxs(F.Compact,{children:[e.jsx(oe,{item:n}),e.jsx(P,{onClick:()=>r("drawer",n.id),shape:"round",size:"small",children:"Drawer"})]})]}),sorter:(n,o)=>Number(n.item.id)-Number(o.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:n=>e.jsx(J,{item:n,width:75})},{title:"Name",dataIndex:"item",key:"name",render:n=>e.jsxs(e.Fragment,{children:[e.jsx($,{item:n,language:"en"}),e.jsx($,{item:n,language:"pt"})]}),sorter:(n,o)=>n.item.name.en.localeCompare(o.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(n,{item:o})=>e.jsx(S,{gap:6,children:n.map((c,m,g)=>e.jsx(_e,{attributes:s,firstElement:m===0,keyVariant:c,lastElement:m===g.length-1,withText:!0},`${c}-${o.id}`))}),sorter:(n,o)=>n.message.join(" ").localeCompare(o.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:n=>n.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:n=>{const o=t[n.join(" ")]??[];return e.jsx(e.Fragment,{children:o.length>1?o.length:"0"})},sorter:(n,o)=>{const c=t[n.message.join(" ")]??[];return(t[o.message.join(" ")]??[]).length-c.length}}];return e.jsxs("div",{className:"my-4",children:[e.jsx(M.Title,{level:5,children:"Item Comparator"}),e.jsx(Oe,{columns:l,dataSource:i,pagination:{showQuickJumper:!0}}),e.jsx(be,{})]})}function vs(){const{attributesList:s,addAttributesToUpdate:i,getItemAttributeValues:t,availableItemIds:r,addMultipleAttributesToUpdate:l}=U(),{queryParams:n,addParam:o}=D(),c=n.get("attribute")??"ali",m=n.get("scope")??"unset",g=n.get("page")??"1",a=n.get("pageSize")??"12",[u,b]=j.useState("ali"),[f,h]=j.useState("unset"),[p,A]=j.useState(null),[C,T]=j.useState("desc"),I=j.useMemo(()=>{const R=r.map(L=>t(L)),O=m==="unset"?void 0:N[m.toUpperCase()],v=R.filter(L=>{var B;return((B=L.attributes)==null?void 0:B[c])===O}).map(L=>L.id),[E,w]=(p??"::").split("::");return x.orderBy(v,[L=>{var B,H;return E==="attribute"?(H=(B=t(L))==null?void 0:B.attributes)==null?void 0:H[w]:!0},L=>E==="prop"?Number(L):!0,L=>{var B;return(B=t(L))==null?void 0:B.updatedAt},L=>Number(L)],[C,"asc","desc","asc"])},[c,m,p,C]),y=j.useMemo(()=>{if(u!==c||f!==m)return b(c),h(m),o("page","1"),I.slice(0,Number(a));const R=(Number(g)-1)*Number(a),O=R+Number(a);return I.slice(R,O)},[g,a,I]),d=s.find(R=>R.id===c),k=(R,O,v)=>{const E=t(R);i(R,{...E,attributes:{...E.attributes,[O]:v}})},z=()=>{l(y.map(R=>{const O=t(R);return O.attributes[c]||(O.attributes[c]=N.UNRELATED),O}))};return{group:I,stats:{total:r.length,group:I.length,percent:Math.round(I.length/r.length*100)},pageIds:y,attribute:d,updateAttributeValue:k,updatePageItemsAsUnrelated:z,sorting:{sortBy:p,setSortBy:A,sortOrder:C,setSortOrder:T},pagination:{total:I.length,current:Number(g),pageSize:Number(a),onChange:R=>o("page",String(R)),onShowSizeChange:(R,O)=>o("pageSize",String(O)),pageSizeOptions:[12,24,48,96]}}}const ys=(s,i)=>i==="unset"||!i?`${100-s.percent}% done, ${s.group} left`:`${s.percent}%  - ${s.group} items`;function As(){const{getItem:s,getItemAttributeValues:i,attributesList:t}=U(),{attribute:r,pageIds:l,updateAttributeValue:n,updatePageItemsAsUnrelated:o,pagination:c,stats:m,sorting:g}=vs(),{queryParams:a,addParam:u}=D(),b=Yt("(max-width: 1024px)");if(x.isEmpty(r))return e.jsx(Y,{className:"my-4",children:e.jsx(M.Text,{type:"secondary",children:"No group attribute has been selected."})});const f=e.jsx(S,{justify:"center",children:e.jsx(jt,{current:c.current,onChange:c.onChange,onShowSizeChange:c.onShowSizeChange,pageSize:c.pageSize,pageSizeOptions:c.pageSizeOptions,total:c.total},"pagination")}),h=e.jsxs(S,{align:"center",children:[e.jsx(M.Text,{className:"mr-2",children:"Sort by"}),e.jsxs(X,{onChange:C=>g.setSortBy(C),style:{width:120},value:g.sortBy,children:[e.jsx(X.Option,{value:null,children:"Last Updated"}),e.jsx(X.Option,{value:"prop::id",children:"Id"}),t.map(C=>e.jsx(X.Option,{value:`attribute::${C.id}`,children:C.name.en},C.id))]})]}),A=(a.get("scope")==="unset"||!a.get("scope"))&&e.jsx(Ct,{onConfirm:o,title:`Are you sure everything is unrelated to ${r.name.en}?`,children:e.jsx(P,{className:"mx-2",danger:!0,disabled:l.length===0,type:"primary",children:"Unrelate Unset Items on Page"})},"unrelate-button");return e.jsxs(Y,{actions:[e.jsxs(S,{justify:"space-between",children:[A,e.jsx(Cs,{},"navigation-buttons")]},"options"),f].filter(Boolean),className:"my-4",extra:e.jsxs(S,{align:"center",className:"mx-2",justify:"space-around",children:[h,f]}),title:e.jsxs(M.Text,{children:[r==null?void 0:r.name.en," (",ys(m,a.get("scope")),") -"," ",r.description.en]}),children:[l.length===0&&e.jsx(ae,{description:"No items found in this scope for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),l.map(C=>{const T=i(C),I=s(C);return e.jsx(Y.Grid,{style:{width:b?"50%":"25%"},children:e.jsxs(S,{gap:6,children:[e.jsxs(S,{gap:6,vertical:!0,children:[e.jsx(J,{item:I,width:75}),e.jsx(Z,{item:I}),e.jsxs(F.Compact,{children:[e.jsx(oe,{item:I}),e.jsx(P,{onClick:()=>u("drawer",I.id),shape:"round",size:"small",children:"Drawer"})]}),e.jsx($,{item:I,language:"en"}),e.jsx($,{item:I,language:"pt"})]}),e.jsx(le,{attribute:r,onChange:(y,d)=>n(I.id,y,d),onlyButtons:!0,value:T.attributes[r.id]})]})},`${C}-${T.updatedAt}`)}),e.jsx(be,{})]})}function Cs(){var o,c;const{queryParams:s,addParam:i}=D(),{attributesList:t}=U(),r=s.get("attribute"),l=()=>{const m=t.findIndex(a=>a.id===r),g=t[m-1];g&&i("attribute",g.id)},n=()=>{const m=t.findIndex(a=>a.id===r),g=t[m+1];g&&i("attribute",g.id)};return e.jsxs(S,{className:"mx-8",gap:6,justify:"space-between",children:[e.jsx(P,{disabled:r===((o=t[0])==null?void 0:o.id),onClick:l,children:"Previous Attribute"},"previous"),e.jsx(Be,{},"go-to-top"),e.jsx(P,{disabled:r===((c=t[t.length-1])==null?void 0:c.id),onClick:n,children:"Next Attribute"},"next")]})}function Ge(){const{attributesList:s,availableItemIds:i,addAttributesToUpdate:t,getItemAttributeValues:r}=U(),{queryParams:l}=D(),[n,o]=j.useState([]),[c,m]=j.useState(),g=()=>{var T;const f=l.get("attribute")??((T=x.sample(s))==null?void 0:T.id)??"ali",h=s.find(I=>I.id===f)??x.sample(s),p=Number(l.get("size"))||9,A=[],C=x.shuffle(i);for(let I=0;I<C.length&&A.length!==p;I++){const y=C[I];r(y).attributes[f]||A.push(y)}return{selectedAttribute:h,selected:A}},a=()=>{let f=g(),h=0;for(;f.selected.length===0&&h<30;)f=g(),h++;m(f.selectedAttribute),o(f.selected)},u=j.useMemo(()=>c?i.filter(f=>!r(f).attributes[c==null?void 0:c.id]).length:0,[c,i]);return{sampleIds:n,attribute:c,itemsLeftForAttribute:u,onGetSample:a,updateAttributeValue:(f,h,p)=>{const A=r(f);t(f,{...A,attributes:{...A.attributes,[h]:p}})}}}function Ts(){const{getItem:s,getItemAttributeValues:i}=U(),{sampleIds:t,attribute:r,onGetSample:l,updateAttributeValue:n,itemsLeftForAttribute:o}=Ge(),{addParam:c}=D();if(x.isEmpty(t)&&x.isEmpty(r))return e.jsxs(Y,{className:"my-4",children:[e.jsxs(M.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",e.jsx(P,{onClick:l,size:"small",type:"primary",children:"Get Sample"})]}),e.jsx(G,{}),e.jsx(Te,{})]});const m=t.map(u=>({itemAttributes:i(u),item:s(u)})),g=m.filter(({itemAttributes:u})=>(r==null?void 0:r.id)&&!u.attributes[r.id]),a=()=>{g.forEach(({item:u})=>{r!=null&&r.id&&n(u.id,r.id,-3)})};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsxs(Y,{actions:[e.jsx(P,{danger:!0,disabled:g.length===0,onClick:a,children:"Mark rest as unrelated"},"1"),e.jsx(P,{ghost:!0,onClick:l,type:"primary",children:"Get New Sample"},"2")],className:"my-4",extra:e.jsx(P,{onClick:l,size:"small",type:"primary",children:"Get New Sample"}),title:e.jsxs(M.Text,{children:[r==null?void 0:r.name.en," - ",r==null?void 0:r.description.en," (",o," items left)"]}),children:[e.jsxs(S,{gap:6,vertical:!0,children:[m.length===0&&e.jsx(ae,{description:"No unset items found for this attribute.",image:ae.PRESENTED_IMAGE_SIMPLE}),m.map(({item:u,itemAttributes:b})=>e.jsxs(j.Fragment,{children:[e.jsxs(S,{gap:6,children:[e.jsx(J,{item:u,width:75}),e.jsxs(S,{gap:6,vertical:!0,children:[e.jsxs(S,{gap:6,children:[e.jsx(Z,{item:u}),e.jsxs(F.Compact,{children:[e.jsx(oe,{item:u}),e.jsx(P,{onClick:()=>c("drawer",u.id),shape:"round",size:"small",children:"Drawer"})]})]}),e.jsx($,{item:u,language:"en"}),e.jsx($,{item:u,language:"pt"})]}),!!r&&e.jsx(le,{attribute:r,onChange:(f,h)=>n(u.id,f,h),value:b.attributes[r.id]})]}),e.jsx(G,{className:"my-1"})]},`${u.id}-${b.updatedAt}`))]}),e.jsx(be,{})]})]})}function Te(){const[s,i]=gt(!1),{addParam:t,removeParam:r}=D(),{sampleIds:l,attribute:n,onGetSample:o,updateAttributeValue:c}=Ge(),{getItem:m,getItemAttributeValues:g}=U(),a=()=>{t("size","1"),i(!0),o()},u=()=>{r("size"),i(!1)},b=l[0],f=m(b),h=g(b);return e.jsxs(S,{className:"mt-4",children:[e.jsx(P,{onClick:a,type:"primary",children:"Single Sampler"}),e.jsxs(Tt,{cancelButtonProps:{style:{display:"none"}},maskClosable:!1,onCancel:u,onOk:u,open:s,title:e.jsxs(M,{children:["Single Sampler: ",e.jsx("strong",{children:n==null?void 0:n.name.en})]}),width:"100vw",children:[b&&f&&h&&n&&e.jsxs(S,{className:"my-10",gap:6,wrap:"wrap",children:[e.jsx(J,{item:f,width:150}),e.jsxs(S,{gap:6,vertical:!0,children:[e.jsxs(S,{gap:6,children:[e.jsx(Z,{item:f}),e.jsx(oe,{item:f})]}),e.jsx($,{item:f,language:"en"}),e.jsx($,{item:f,language:"pt"})]}),!!n&&e.jsx(le,{attribute:n,onChange:async(p,A)=>{c(f.id,p,A),await lt(500),o()},size:"large",value:h.attributes[n.id]})]},b),e.jsx(P,{onClick:o,children:"Another Sample"})]})]})}function Es(){const s=ie("items-attributes"),i=ie("items-attribute-values"),[t,r]=j.useState(null),l=()=>{r(Ee(s.data,i.data))},n=()=>{const o={};let c=0;for(;c<300||x.keys(o).length===15;){const m=Ee(s.data,i.data);if(m.valid&&!o[m.setId]&&(o[m.setId]=m),x.keys(o).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(o).map((m,g)=>({...m,number:m.number-g})))};return e.jsxs("div",{className:"my-4",children:[e.jsx(M.Title,{level:3,children:"Daily Simulator"}),e.jsx(M.Paragraph,{children:"Generates a daily game for Alien Communication"}),e.jsxs(F,{children:[e.jsx(P,{onClick:l,type:"primary",children:"Generate"}),e.jsx(P,{onClick:n,children:"Generate List"})]}),e.jsx("div",{children:!!t&&e.jsxs(F,{direction:"vertical",children:[e.jsx(M.Title,{level:5,children:t==null?void 0:t.setId}),!(t!=null&&t.valid)&&e.jsx(Je,{message:"Invalid game",type:"error"}),e.jsx(F,{direction:"vertical",children:t==null?void 0:t.attributes.map(o=>e.jsxs(S,{gap:8,children:[e.jsx(Q,{id:o.spriteId,width:50}),o.itemsIds.map(c=>e.jsx(ve,{id:c||"0",width:50},c))]},o.id))}),e.jsx(G,{className:"my-1"}),e.jsx(F,{direction:"horizontal",children:t==null?void 0:t.requests.map(o=>e.jsxs(S,{vertical:!0,children:[e.jsx(Q,{id:o.spritesIds[2],width:50}),e.jsx(Q,{id:o.spritesIds[1],width:50}),e.jsx(Q,{id:o.spritesIds[0],width:50})]},o.itemId))}),e.jsx(G,{className:"my-1"}),e.jsx(F,{direction:"horizontal",children:t==null?void 0:t.itemsIds.map(o=>e.jsx(ve,{id:o||"0",width:50},o))})]},t==null?void 0:t.setId)})]})}const Ee=(s,i)=>{const t=x.values(s).filter(d=>!d.limited||d.id==="sol"),r=x.shuffle(x.values(i).filter(d=>d.complete)),l=x.shuffle(ct(38,0)),n=x.sampleSize(t,3).map(d=>({...d,spriteId:`${l.pop()}`})),o=[],c=[],m=[],g=[],a=[],u=[],b=[],f=[];r.forEach(d=>{const k=[N.DETERMINISTIC,N.RELATED],z=d.attributes[n[0].id]===N.DETERMINISTIC,R=k.includes(d.attributes[n[0].id]),O=d.attributes[n[0].id]===N.UNRELATED,v=d.attributes[n[1].id]===N.DETERMINISTIC,E=k.includes(d.attributes[n[1].id]),w=d.attributes[n[1].id]===N.UNRELATED,L=d.attributes[n[2].id]===N.DETERMINISTIC,B=k.includes(d.attributes[n[2].id]),H=d.attributes[n[2].id]===N.UNRELATED;if(O&&w&&H)return f.push(d.id);z&&w&&H&&o.push(d.id),O&&v&&H&&c.push(d.id),O&&w&&L&&m.push(d.id),R&&E&&H&&g.push(d.id),R&&w&&B&&a.push(d.id),O&&E&&B&&u.push(d.id),R&&E&&B&&b.push(d.id)});const h=n.map(d=>({id:d.id,name:d.name.pt,description:d.description.pt,spriteId:d.spriteId,itemsIds:[]}));h[0].itemsIds=x.sampleSize(o,o.length>3?3:Math.max(o.length-1,1)),h[1].itemsIds=x.sampleSize(c,c.length>3?3:Math.max(o.length-1,1)),h[2].itemsIds=x.sampleSize(m,m.length>3?3:Math.max(o.length-1,1));const p=[];h.forEach(d=>{p.push(...d.itemsIds)});const A=[];g.length>0&&A.push({spritesIds:[n[0].spriteId,n[1].spriteId],itemId:x.sample(g)??""}),a.length>0&&A.push({spritesIds:[n[0].spriteId,n[2].spriteId],itemId:x.sample(a)??""}),u.length>0&&A.push({spritesIds:[n[1].spriteId,n[2].spriteId],itemId:x.sample(u)??""}),b.length>0&&A.push({spritesIds:n.map(d=>d.spriteId),itemId:x.sample(b)??""});const C=[];o.length>0&&C.push({spritesIds:[n[0].spriteId],itemId:o.filter(d=>!p.includes(d))[0]}),c.length>0&&C.push({spritesIds:[n[1].spriteId],itemId:c.filter(d=>!p.includes(d))[0]}),m.length>0&&C.push({spritesIds:[n[2].spriteId],itemId:m.filter(d=>!p.includes(d))[0]}),console.log({attributeA:o,attributeB:c,attributeC:m,attributeAB:g,attributeAC:a,attributeBC:u,attributeABC:b}),console.log("COMPLEX REQUEST SIZE",A.length),console.log("SIMPLE REQUEST SIZE",C.length);let T=x.sampleSize(A,4);console.log("REQUEST SIZE",T.length),T.length<3&&T.push(...x.sampleSize(C,4-T.length)),T.length<4&&console.warn("Not enough requests"),T=x.shuffle(T);const I=T.map(d=>d.itemId),y={id:"2024-00-00",setId:h.map(d=>d.id).sort().join("-"),number:0,type:"comunicacao-alienigena",attributes:h,requests:T,solution:I.join("-"),itemsIds:x.shuffle([...I,f[0],f[1],f[2],f[3]]).filter(Boolean),valid:!1};return y.valid=[y.attributes.length===3,y.requests.length===4,y.itemsIds.length>5,y.attributes.every(d=>d.itemsIds.length>0),y.requests.every(d=>d.itemId)].every(Boolean),console.log(y),y},Ss=["","I","II","III","IV","V"];function Ns(){const{attributes:s,availableItemIds:i,getItemAttributeValues:t,getItem:r}=U(),{message:l}=he.useApp(),[n,o]=j.useState(25),[c,m]=j.useState(80),[g,a]=j.useState(!1),[u,b]=j.useState([]),[f,h]=j.useState([]),[p,A]=j.useState(null),[C,T]=j.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),I=()=>{const d={},k=x.shuffle(i);for(;Object.values(d).length<n;){const v=k.pop();if(!v)break;const E=t(v);E&&(!E.complete||!E.reliability||E.reliability<c||!g&&r(v).nsfw||(E.signature&&!d[E.signature]?d[E.signature]=v:console.log("Item has identical key to another item. Skipping.",r(v).name.en)))}const z=Object.values(d);z.length<n&&l.error(`Could not generate sample. Got only ${z.length} items`),b(x.sortBy(z,v=>Number(v)));const R=ws(z.map(v=>t(v)),25,s);if(R.length<25){const v=x.keys(s).filter(L=>!R.includes(L)),w=x.sortBy(v,L=>s[L].priority).slice(0,25-R.length);console.log("Adding more attributes by priority",w),R.push(...w)}const O=R.reduce((v,E)=>(z.forEach(w=>{const L=t(w);if(L)switch(L.attributes[E]){case N.RELATED:v.relatedCount[E]=(v.relatedCount[E]||0)+1;break;case N.DETERMINISTIC:v.deterministicCount[E]=(v.deterministicCount[E]||0)+1;break;case N.UNCLEAR:v.unclearCount[E]=(v.unclearCount[E]||0)+1;break;case N.OPPOSITE:v.oppositeCount[E]=(v.oppositeCount[E]||0)+1;break}}),v),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});h(R.sort().map(v=>({...s[v],relatedCount:O.relatedCount[v],deterministicCount:O.deterministicCount[v],unclearCount:O.unclearCount[v],oppositeCount:O.oppositeCount[v]})))},y=d=>{T(k=>({...k,[d]:!k[d]}))};return e.jsxs("div",{className:"my-4",children:[e.jsx(M.Title,{level:3,children:"Simulator"}),e.jsx(M.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),e.jsxs(S,{gap:12,wrap:!0,children:[e.jsx(ee,{label:"Grid Size",onChange:d=>o(d),options:[16,25],value:n}),e.jsx(Ne,{label:"Reliability Threshold",max:100,min:10,onChange:d=>m(d),step:5,value:c}),e.jsx(q,{label:"NSFW",onChange:a,value:g}),e.jsx(P,{onClick:I,type:"primary",children:"Get Sample Board"})]}),e.jsxs(S,{gap:12,wrap:!0,children:[e.jsx(ce,{label:"Show Id",onChange:()=>y("id"),value:!!C.id}),e.jsx(ce,{label:"Show Name (EN)",onChange:()=>y("nameEn"),value:!!C.nameEn}),e.jsx(ce,{label:"Show Name (PT)",onChange:()=>y("namePt"),value:!!C.namePt}),e.jsx(ce,{label:"Show Reliability",onChange:()=>y("reliability"),value:!!C.reliability})]}),e.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(n)}, 1fr)`},children:u.map(d=>{const k=r(d),z=t(d);return e.jsxs(F,{align:"center",className:de("simulator-grid__entry",p&&z.attributes[p]>0&&"simulator-grid__entry--highlighted"),direction:"vertical",children:[e.jsxs(F,{children:[e.jsxs(S,{vertical:!0,children:[C.id&&e.jsx(Z,{item:k}),C.reliability&&e.jsx("span",{children:e.jsx(tt,{formatter:R=>`${R}%`,placeholder:"Reliability",prefix:e.jsx(Bt,{}),readOnly:!0,size:"small",style:{width:"8ch"},value:z.reliability,variant:"borderless"})}),C.id&&e.jsx(oe,{item:k})]}),e.jsx(J,{item:k,width:50})]}),C.nameEn&&e.jsx($,{item:k,language:"en"}),C.namePt&&e.jsx($,{item:k,language:"pt"})]},d)})}),e.jsx("div",{className:"simulator-grid my-4",children:f.map(d=>e.jsxs(Et,{className:de("simulator-grid__entry","simulator-grid__button",p===d.id&&"simulator-grid__entry--highlighted"),onClick:()=>A(d.id),children:[d.name.en," ",Ss[d.level],e.jsxs(S,{className:"my-1",gap:6,justify:"center",children:[e.jsxs("span",{children:[e.jsx(Lt,{style:{color:d.deterministicCount?"dodgerblue":void 0}})," ",d.deterministicCount??0]}),e.jsxs("span",{children:[e.jsx(vt,{style:{color:d.relatedCount?"green":void 0}})," ",d.relatedCount??0]}),e.jsxs("span",{children:[e.jsx(Ut,{style:{color:d.oppositeCount?"red":void 0}})," ",d.oppositeCount??0]}),e.jsxs("span",{children:[e.jsx(Re,{style:{color:d.unclearCount?"gold":void 0}})," ",d.unclearCount??0]})]})]},d.id))}),e.jsx(Es,{})]})}function ws(s,i,t){const r={},l={};s.forEach(h=>{h&&Object.keys(h.attributes).forEach(p=>{h.attributes[p]>0&&(r[p]=(r[p]||0)+1),h.attributes[p]===N.DETERMINISTIC&&(l[p]=!0,r[p]=(r[p]||0)+2),h.attributes[p]===N.OPPOSITE&&(r[p]=(r[p]||0)+1)})});const n={1:0,2:0,3:0,4:0};function o(h){return h.filter(p=>(n[t[p].level]++,n[4]>1?(console.log("Discarding level 4 attribute",p),!1):!0))}const c=o(Object.keys(l)),m=o(x.keys(r).filter(h=>!c.includes(h)));if(console.log({levelCount:n}),i===c.length)return console.log("All keys are deterministic"),c;if(console.log(r),c.length===0)return[];const g=c.reduce((h,p)=>{const A=r[p];return h[A]||(h[A]=[]),h[A].push(p),h},{}),a=x.keys(g).sort((h,p)=>Number(p)-Number(h));console.log({sortedDeterministicTiedGroupsKeys:a});const u=m.reduce((h,p)=>{const A=r[p];return h[A]||(h[A]=[]),h[A].push(p),h},{});console.log(u);const b=x.keys(u).sort((h,p)=>Number(p)-Number(h)),f=[];for(const h of a){if(f.length===i)break;f.push(...x.sampleSize(g[h],i-f.length))}for(const h of b){if(f.length===i)break;f.push(...x.sampleSize(u[h],i-f.length))}return f}function Ps(){const{attributes:s}=U(),i=[{key:"1",label:"All Attributes",children:e.jsx(W,{type:"all"})},{key:"2",label:"Default",children:e.jsx(W,{type:"default"})},{key:"3",label:"Custom",children:e.jsx(W,{type:"custom"})},{key:"4",label:"Limited",children:e.jsx(W,{type:"limited"})},{key:"5",label:"Specific",children:e.jsx(W,{type:"specific"})},{key:"6",label:"Opposite",children:e.jsx(W,{type:"opposite"})}];return e.jsxs("div",{className:"my-4",children:[e.jsxs(S,{align:"center",justify:"space-between",children:[e.jsx(M.Title,{level:5,children:"Stats"}),e.jsx(we,{data:()=>Ls(s),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),e.jsx(St,{defaultActiveKey:"1",items:i})]})}const Rs=(s,i)=>{let t=0,r=0,l=0,n=0,o=0,c=0,m=0,g=0;i.forEach(({attributes:I})=>{if(I[s.id]){t++;const y=I[s.id];y===10?r++:y===5?l++:y===0||!y?n++:y===-1?o++:y===-3?c++:y===-10&&m++,y>0&&g++}});const a=i.length,u=t/a*100,b=r/a*100,f=l/a*100,h=n/a*100,p=o/a*100,A=c/a*100,C=m/a*100,T=g/a*100;return{completionPercentage:u.toFixed(1),tensPercentage:b.toFixed(1),fivesPercentage:f.toFixed(1),zerosPercentage:h.toFixed(1),negativeOnesPercentage:p.toFixed(1),negativeThreesPercentage:A.toFixed(1),negativeTensPercentage:C.toFixed(1),positivePercentage:T.toFixed(1)}};function W({type:s}){const{availableItemIds:i,getItemAttributeValues:t,attributesList:r}=U(),l=Ze(),{is:n}=D(),o=j.useMemo(()=>{const a=new Array(65).fill(0).map((b,f)=>f),u=r.map(b=>b.spriteId);return a.filter(b=>!u.includes(`sign-${b}`))},[r]),c=j.useMemo(()=>s==="default"?r.filter(a=>a.default):s==="custom"?r.filter(a=>!a.default):s==="limited"?r.filter(a=>a.limited):s==="specific"?r.filter(a=>a.specific):s==="opposite"?r.filter(a=>a.oppositeId):r,[r,s]),m=j.useMemo(()=>{const a=i.map(u=>t(u));return c.map(u=>({...u,...Rs(u,a)}))},[c,i,t]),g=[{title:"Attribute",dataIndex:"name",key:"name",render:(a,u)=>e.jsxs(S,{align:"center",gap:8,children:[n("showGlyphs")&&e.jsx(Q,{id:u.spriteId,width:30}),a.en,u.default&&e.jsx(ne,{className:"ml-1",children:"default"}),u.limited&&e.jsx(ne,{className:"ml-1",children:"limited"}),(u.specific||u.parentId)&&e.jsx(ne,{className:"ml-1",children:"specific"}),u.oppositeId&&e.jsx(ne,{className:"ml-1",children:e.jsx(We,{})}),e.jsx($e,{title:u.description.en})]}),sorter:(a,u)=>a.name.en.localeCompare(u.name.en)},{title:e.jsx(Nt,{}),dataIndex:"spriteId",key:"spriteId",render:a=>e.jsx(Q,{id:a,padding:0,width:18})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(a,u)=>a.priority-u.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.positivePercentage)-Number.parseFloat(u.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(a,u)=>u.limited?"-":`${a}%`,sorter:(a,u)=>Number.parseFloat(a.tensPercentage)-Number.parseFloat(u.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.fivesPercentage)-Number.parseFloat(u.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeOnesPercentage)-Number.parseFloat(u.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeThreesPercentage)-Number.parseFloat(u.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeTensPercentage)-Number.parseFloat(u.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:a=>e.jsx(Le,{percent:Number.parseFloat(a),size:"small"}),sorter:(a,u)=>Number.parseFloat(a.completionPercentage)-Number.parseFloat(u.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:a=>e.jsx(wt,{count:4,disabled:!0,value:a}),sorter:(a,u)=>a.level-u.level},{title:"Actions",key:"actions",render:a=>e.jsx(F,{children:e.jsxs(F.Compact,{children:[e.jsx(P,{onClick:()=>l(`/items/attribution?display=grouping&attribute=${a.id}&page=1`),shape:"round",size:"small",children:"Grouping"}),e.jsx(P,{onClick:()=>l(`/items/attribution?display=sampler&attribute=${a.id}&size=6`),shape:"round",size:"small",children:"Sample"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(M.Paragraph,{children:["Total: ",m.length]}),e.jsx(Oe,{columns:g,dataSource:m,pagination:!1,rowKey:"id",size:"small"}),e.jsx(S,{gap:8,wrap:"wrap",children:o.map(a=>e.jsxs("div",{children:["#",a,e.jsx(Q,{id:`sign-${a}`},a)]},a))})]})}function Ls(s){const i=x.cloneDeep(s);return xe(Pe(i),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Os(){const{queryParams:s}=D(),i=s.get("display")??"classifier";return i==="classifier"?e.jsxs(e.Fragment,{children:[e.jsxs(S,{align:"center",className:"my-4",gap:8,wrap:!0,children:[e.jsx(hs,{}),e.jsx(xs,{}),e.jsx(bs,{}),e.jsx(mt,{path:"/tdr/itemsAttributeValues"})]}),e.jsx(gs,{}),e.jsx(S,{className:"my-4",justify:"flex-end",children:e.jsx(Be,{})})]}):i==="sampler"?e.jsx(Ts,{}):i==="grouping"?e.jsx(As,{}):i==="comparator"?e.jsx(Is,{}):i==="simulator"?e.jsx(Ns,{}):i==="stats"?e.jsx(Ps,{}):e.jsx(ae,{className:"my-10",description:"Unknown display has been selected"})}function Ds(){const{isLoading:s,error:i,hasResponseData:t}=U();return e.jsx(Xe,{subtitle:"Attribution",title:"Items",children:e.jsxs(je,{hasSider:!0,children:[e.jsx(nt,{children:e.jsx(cs,{})}),e.jsx(je.Content,{className:"content",children:e.jsx(et,{error:i,hasResponseData:t,isLoading:s,children:e.jsx(Os,{})})})]})})}function Mr(){return e.jsx(ss,{children:e.jsx(Ds,{})})}export{Mr as default};
