import{j as T}from"./index-D33WsCK5.js";import{I as $}from"./ImageCard-L0J1y19O.js";import{u as z}from"./useQueryParams-Do2Pakyn.js";import{l as L}from"./useBaseUrl-BgzYt73r.js";import{u as P}from"./useResourceFirestoreData-BKii2upp.js";import{u as A}from"./useTDResource-CzTlhf0K.js";function H({cardId:s,variant:r,...t}){const{queryParams:n}=z(),o=r??n.get("variant")??"gb";return T.jsx($,{cardId:q(s,o),...t})}const q=(()=>{const s=new Map;return(r,t)=>{if(!t)return r;const n=`${r}|${t??""}`;if(s.has(n))return s.get(n);const o=r.split("-"),c=`${o[0]}-${t}-${o[o.length-1]}`;return s.set(n,c),c}})(),J=(s,r,t,n)=>{const{reliabilityThreshold:o=4,projectionThreshold:c=55}={},f=`us-gb-${s.split("-")[1].padStart(3,"0")}`,e=L.isEmpty(t[s])?[]:t[s],i=e.some(a=>a===32||a===-32);let h=0,m=0,u=0,g=0,l=0;e.forEach(a=>{a===32?h+=35:a===-32?m+=35:a===4?h+=4:a===-4?m+=4:a>0?u+=a:a<0&&(g+=Math.abs(a)),l+=Math.abs(a)});const E=u+g,y=Math.max(l,o),p=l===0?0:Math.round((h+u)/y*100),d=l===0?0:Math.round((m+g)/y*100),M=h+u,S=m+g,C=l===0?100:Math.round((y-M-S)/y*100),x=i||l>=o,D=i||E>o/1.5||l>=4,j=D&&l>o&&Math.abs(p-d)>=40,O=j&&Math.abs(p-d)>40?p>d?"ğŸ‘":"ğŸ‘":null,R=Math.abs(p-d)<50?null:p>=c?"ğŸ‘":d>=c?"ğŸ‘":null;return{suspectCardId:s,imageId:f,questionId:r,enoughData:D,reliable:j,total:l,yesCount:M,yesPercentage:p,noCount:S,noPercentage:d,blankPercentage:C,complete:x,values:e,resolution:O,projection:R}};function B(s){const r=s.map(e=>e===0?-1:e),t=s.filter(e=>e===-32||e===32||e===4||e===-4),n=r.filter(e=>e===-1||e===1),o=r.filter(e=>![-32,32,4,-4,-1,1].includes(e)).flatMap(e=>Array.from({length:Math.abs(e)},()=>e>0?1:-1)),c=[...n,...o].sort((e,i)=>e-i),b={"-1":0,1:0};c.forEach(e=>{(e===-1||e===1)&&(b[e]+=1)});const f=8;for(const[e,i]of Object.entries(b)){const h=Math.floor(i/f),m=i%f;for(let u=0;u<h;u++)t.push(e==="-1"?-f:f);if(m>0){const u=Array.from({length:m},()=>e==="-1"?-1:1);t.push(...u)}}return t.sort((e,i)=>e-i)}const G=s=>s.reduce((r,t)=>{const n=Math.abs(t);return n?r+n:r},0);function K(){const s=A("suspects"),r=A("testimony-questions-pt"),t=P({tdrResourceName:"testimony-answers",firestoreDataCollectionName:"testimonies",serialize:!0,deserializer:w});return{...t,isLoading:t.isLoading||r.isLoading||s.isLoading,isSuccess:t.isSuccess&&r.isSuccess&&s.isSuccess,error:t.error||r.error||s.error,questions:r.data,suspects:s.data,hasNewData:t.hasFirestoreData}}function w(s){const r={};return Object.entries(s).forEach(([t,n])=>{r[t]={},Object.entries(n).forEach(([o,c])=>{r[t][o]=JSON.parse(c)})}),r}export{H as S,J as a,G as c,q as g,B as n,w as t,K as u};
