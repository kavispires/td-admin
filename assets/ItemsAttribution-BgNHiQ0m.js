import{r as p,X as Ct,ac as St,Y as ge,a0 as ze,Z as At,$ as Et,a1 as Tt,ad as Oe,c as xe,y as De,g as wt,m as Pt,e as Nt,d as $t,K as Ot,a6 as Rt,C as kt,x as Lt,ae as Dt,F as Ut,a9 as Ae,af as Mt,a as re,_ as se,ag as Ft,O as Ue,N as Vt,j as t,T as D,D as K,B as R,J as Bt,ah as _t,ai as zt,aa as Me,aj as Gt,ak as Wt,al as Qt,P as Kt,L as Ge}from"./index-CAyy70PP.js";import{D as Xt}from"./DataLoadingWrapper-lmwgzr0i.js";import{c as q,a as ue,b as st,d as Se,T as qt}from"./FilterEntries-B-1YJVNh.js";import{S as Ht}from"./SiderContent-NLEQZ-SU.js";import{D as nt}from"./DownloadButton-2f00IWg7.js";import{S as Yt}from"./SaveButton-BkjPx5E-.js";import{l as C}from"./lodash-8FP2h5ZQ.js";import{A as B,d as $,e as Zt,f as Z}from"./constants-DNdDW6pc.js";import{e as Jt,g as er,a as Fe,d as it,w as tr,m as rr}from"./index-CZjMbIoE.js";import{u as sr}from"./useGetFirebaseDoc-BtHdX4BN.js";import{u as be}from"./useTDResource-BkvdRrVC.js";import{u as nr}from"./useUpdateFirebaseDoc-D3n9jzbw.js";import{T as he}from"./index-CQkjZXVU.js";import{F as P}from"./index-BJQMhufP.js";import{R as ir}from"./VerticalAlignTopOutlined-Cr3cGFiI.js";import{I as ne,a as ie,b as _,c as je}from"./ItemBuildingBlocks-CGRt9mpE.js";import{a as at}from"./index-CE7IqR3m.js";import{R as We}from"./index-DD-bWrN2.js";import{c as Re,E as ve,P as ar}from"./useBaseUrl-lFXL7kyH.js";import{I as Qe}from"./Item-CZU8t2FH.js";import{C as te,T as or}from"./index-Dm8QeM7L.js";import{A as lr}from"./index-_H_KGd9a.js";import{S as W}from"./index-C5k-kD2i.js";import{u as Ve}from"./useQueryParams-DN9U5x2u.js";import{I as cr}from"./ItemsTypeahead-CYOwW5Ff.js";import{R as ur,a as dr,P as mr}from"./Pagination-BnVksPUs.js";import{S as ce}from"./index-DCGzcwaQ.js";import{R as pr,F as ot,a as gr}from"./Table-kARKeFdm.js";import{D as hr}from"./index-CTPt24eP.js";import{S as fr}from"./index-DeBDsz_3.js";import{i as br}from"./util-CeAI_f06.js";import{P as xr}from"./index-Bn9tRISQ.js";import{u as vr}from"./useToggle-CUMwK56g.js";import{M as jr}from"./index-WqRAHGsx.js";import{T as yr}from"./TransparentButton-B2I4I-iC.js";import{R as Ir}from"./SkinOutlined-DwVDs8aD.js";import{R as Cr}from"./index-BImkfaSp.js";import"./index-BuNL6KCt.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-z_U6d9kM.js";import"./useMutation-BJJQ7kLD.js";import"./gapSize-U1swVQyS.js";import"./LanguageFlag-B0hqmPRk.js";import"./useCopyToClipboardFunction-DQIOu4Cb.js";import"./index-BQdr3QAv.js";import"./Input-RVJoe4Vj.js";import"./FireFilled-C1iPDb_C.js";import"./IdcardOutlined-AOMCyHZp.js";import"./PlusOutlined-CAgoJ3j0.js";import"./throttleByAnimationFrame-wRH6HCZ_.js";import"./useDebounce-CdP44Te8.js";import"./index-rNdYCc1G.js";import"./scrollTo-BSEopERE.js";import"./extendsObject-keMuGWqj.js";var Sr={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},Ar=function(){var r=p.useRef([]),s=p.useRef(null);return p.useEffect(function(){var n=Date.now(),a=!1;r.current.forEach(function(i){if(i){a=!0;var o=i.style;o.transitionDuration=".3s, .3s, .3s, .06s",s.current&&n-s.current<100&&(o.transitionDuration="0s, 0s")}}),a&&(s.current=Date.now())}),r.current},Ke=0,Er=St();function Tr(){var e;return Er?(e=Ke,Ke+=1):e="TEST_OR_SSR",e}const wr=function(e){var r=p.useState(),s=Ct(r,2),n=s[0],a=s[1];return p.useEffect(function(){a("rc_progress_".concat(Tr()))},[]),e||n};var Xe=function(r){var s=r.bg,n=r.children;return p.createElement("div",{style:{width:"100%",height:"100%",background:s}},n)};function qe(e,r){return Object.keys(e).map(function(s){var n=parseFloat(s),a="".concat(Math.floor(n*r),"%");return"".concat(e[s]," ").concat(a)})}var Pr=p.forwardRef(function(e,r){var s=e.prefixCls,n=e.color,a=e.gradientId,i=e.radius,o=e.style,c=e.ptg,u=e.strokeLinecap,h=e.strokeWidth,l=e.size,d=e.gapDegree,x=n&&ge(n)==="object",v=x?"#FFF":void 0,g=l/2,f=p.createElement("circle",{className:"".concat(s,"-circle-path"),r:i,cx:g,cy:g,stroke:v,strokeLinecap:u,strokeWidth:h,opacity:c===0?0:1,style:o,ref:r});if(!x)return f;var I="".concat(a,"-conic"),b=d?"".concat(180+d/2,"deg"):"0deg",T=qe(n,(360-d)/360),j=qe(n,1),S="conic-gradient(from ".concat(b,", ").concat(T.join(", "),")"),m="linear-gradient(to ".concat(d?"bottom":"top",", ").concat(j.join(", "),")");return p.createElement(p.Fragment,null,p.createElement("mask",{id:I},f),p.createElement("foreignObject",{x:0,y:0,width:l,height:l,mask:"url(#".concat(I,")")},p.createElement(Xe,{bg:m},p.createElement(Xe,{bg:S}))))}),fe=100,$e=function(r,s,n,a,i,o,c,u,h,l){var d=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,x=n/100*360*((360-o)/360),v=o===0?0:{bottom:0,top:180,left:90,right:-90}[c],g=(100-a)/100*s;h==="round"&&a!==100&&(g+=l/2,g>=s&&(g=s-.01));var f=fe/2;return{stroke:typeof u=="string"?u:void 0,strokeDasharray:"".concat(s,"px ").concat(r),strokeDashoffset:g+d,transform:"rotate(".concat(i+x+v,"deg)"),transformOrigin:"".concat(f,"px ").concat(f,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Nr=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function He(e){var r=e??[];return Array.isArray(r)?r:[r]}var $r=function(r){var s=ze(ze({},Sr),r),n=s.id,a=s.prefixCls,i=s.steps,o=s.strokeWidth,c=s.trailWidth,u=s.gapDegree,h=u===void 0?0:u,l=s.gapPosition,d=s.trailColor,x=s.strokeLinecap,v=s.style,g=s.className,f=s.strokeColor,I=s.percent,b=At(s,Nr),T=fe/2,j=wr(n),S="".concat(j,"-gradient"),m=T-o/2,N=Math.PI*2*m,k=h>0?90+h/2:-90,w=N*((360-h)/360),A=ge(i)==="object"?i:{count:i,gap:2},y=A.count,E=A.gap,L=He(I),O=He(f),M=O.find(function(G){return G&&ge(G)==="object"}),V=M&&ge(M)==="object",H=V?"butt":x,de=$e(N,w,0,100,k,h,l,d,H,o),Ie=Ar(),X=function(){var ae=0;return L.map(function(ee,oe){var Pe=O[oe]||O[O.length-1],me=$e(N,w,ae,ee,k,h,l,Pe,H,o);return ae+=ee,p.createElement(Pr,{key:oe,color:Pe,ptg:ee,radius:m,prefixCls:a,gradientId:S,style:me,strokeLinecap:H,strokeWidth:o,gapDegree:h,ref:function(Ne){Ie[oe]=Ne},size:fe})}).reverse()},z=function(){var ae=Math.round(y*(L[0]/100)),ee=100/y,oe=0;return new Array(y).fill(null).map(function(Pe,me){var Ce=me<=ae-1?O[0]:d,Ne=Ce&&ge(Ce)==="object"?"url(#".concat(S,")"):void 0,_e=$e(N,w,oe,ee,k,h,l,Ce,"butt",o,E);return oe+=(w-_e.strokeDashoffset+E)*100/w,p.createElement("circle",{key:me,className:"".concat(a,"-circle-path"),r:m,cx:T,cy:T,stroke:Ne,strokeWidth:o,opacity:1,style:_e,ref:function(It){Ie[me]=It}})})};return p.createElement("svg",Et({className:Tt("".concat(a,"-circle"),g),viewBox:"0 0 ".concat(fe," ").concat(fe),style:v,id:n,role:"presentation"},b),!y&&p.createElement("circle",{className:"".concat(a,"-circle-trail"),r:m,cx:T,cy:T,stroke:d,strokeLinecap:H,strokeWidth:c||o,style:de}),y?z():X())};function J(e){return!e||e<0?0:e>100?100:e}function Ee(e){let{success:r,successPercent:s}=e,n=s;return r&&"progress"in r&&(n=r.progress),r&&"percent"in r&&(n=r.percent),n}const Or=e=>{let{percent:r,success:s,successPercent:n}=e;const a=J(Ee({success:s,successPercent:n}));return[a,J(J(r)-a)]},Rr=e=>{let{success:r={},strokeColor:s}=e;const{strokeColor:n}=r;return[n||Oe.green,s||null]},we=(e,r,s)=>{var n,a,i,o;let c=-1,u=-1;if(r==="step"){const h=s.steps,l=s.strokeWidth;typeof e=="string"||typeof e>"u"?(c=e==="small"?2:14,u=l??8):typeof e=="number"?[c,u]=[e,e]:[c=14,u=8]=Array.isArray(e)?e:[e.width,e.height],c*=h}else if(r==="line"){const h=s==null?void 0:s.strokeWidth;typeof e=="string"||typeof e>"u"?u=h||(e==="small"?6:8):typeof e=="number"?[c,u]=[e,e]:[c=-1,u=8]=Array.isArray(e)?e:[e.width,e.height]}else(r==="circle"||r==="dashboard")&&(typeof e=="string"||typeof e>"u"?[c,u]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[c,u]=[e,e]:Array.isArray(e)&&(c=(a=(n=e[0])!==null&&n!==void 0?n:e[1])!==null&&a!==void 0?a:120,u=(o=(i=e[0])!==null&&i!==void 0?i:e[1])!==null&&o!==void 0?o:120));return[c,u]},kr=3,Lr=e=>kr/e*100,Dr=e=>{const{prefixCls:r,trailColor:s=null,strokeLinecap:n="round",gapPosition:a,gapDegree:i,width:o=120,type:c,children:u,success:h,size:l=o,steps:d}=e,[x,v]=we(l,"circle");let{strokeWidth:g}=e;g===void 0&&(g=Math.max(Lr(x),6));const f={width:x,height:v,fontSize:x*.15+6},I=p.useMemo(()=>{if(i||i===0)return i;if(c==="dashboard")return 75},[i,c]),b=Or(e),T=a||c==="dashboard"&&"bottom"||void 0,j=Object.prototype.toString.call(e.strokeColor)==="[object Object]",S=Rr({success:h,strokeColor:e.strokeColor}),m=xe(`${r}-inner`,{[`${r}-circle-gradient`]:j}),N=p.createElement($r,{steps:d,percent:d?b[1]:b,strokeWidth:g,trailWidth:g,strokeColor:d?S[1]:S,strokeLinecap:n,trailColor:s,prefixCls:r,gapDegree:I,gapPosition:T}),k=x<=20,w=p.createElement("div",{className:m,style:f},N,!k&&u);return k?p.createElement(De,{title:u},w):w},Te="--progress-line-stroke-color",lt="--progress-percent",Ye=e=>{const r=e?"100%":"-100%";return new Ot(`antProgress${e?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${r}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${r}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Ur=e=>{const{componentCls:r,iconCls:s}=e;return{[r]:Object.assign(Object.assign({},Nt(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize},[`${r}-outer`]:{display:"inline-flex",alignItems:"center",width:"100%"},[`${r}-inner`]:{position:"relative",display:"inline-block",width:"100%",flex:1,overflow:"hidden",verticalAlign:"middle",backgroundColor:e.remainingColor,borderRadius:e.lineBorderRadius},[`${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.defaultColor}},[`${r}-success-bg, ${r}-bg`]:{position:"relative",background:e.defaultColor,borderRadius:e.lineBorderRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${r}-layout-bottom`]:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",[`${r}-text`]:{width:"max-content",marginInlineStart:0,marginTop:e.marginXXS}},[`${r}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${Te})`]},height:"100%",width:`calc(1 / var(${lt}) * 100%)`,display:"block"},[`&${r}-bg-inner`]:{minWidth:"max-content","&::after":{content:"none"},[`${r}-text-inner`]:{color:e.colorWhite,[`&${r}-text-bright`]:{color:"rgba(0, 0, 0, 0.45)"}}}},[`${r}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${r}-text`]:{display:"inline-block",marginInlineStart:e.marginXS,color:e.colorText,lineHeight:1,width:"2em",whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[s]:{fontSize:e.fontSize},[`&${r}-text-outer`]:{width:"max-content"},[`&${r}-text-outer${r}-text-start`]:{width:"max-content",marginInlineStart:0,marginInlineEnd:e.marginXS}},[`${r}-text-inner`]:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",marginInlineStart:0,padding:`0 ${$t(e.paddingXXS)}`,[`&${r}-text-start`]:{justifyContent:"start"},[`&${r}-text-end`]:{justifyContent:"end"}},[`&${r}-status-active`]:{[`${r}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.lineBorderRadius,opacity:0,animationName:Ye(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${r}-rtl${r}-status-active`]:{[`${r}-bg::before`]:{animationName:Ye(!0)}},[`&${r}-status-exception`]:{[`${r}-bg`]:{backgroundColor:e.colorError},[`${r}-text`]:{color:e.colorError}},[`&${r}-status-exception ${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.colorError}},[`&${r}-status-success`]:{[`${r}-bg`]:{backgroundColor:e.colorSuccess},[`${r}-text`]:{color:e.colorSuccess}},[`&${r}-status-success ${r}-inner:not(${r}-circle-gradient)`]:{[`${r}-circle-path`]:{stroke:e.colorSuccess}}})}},Mr=e=>{const{componentCls:r,iconCls:s}=e;return{[r]:{[`${r}-circle-trail`]:{stroke:e.remainingColor},[`&${r}-circle ${r}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${r}-circle ${r}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[s]:{fontSize:e.circleIconFontSize}},[`${r}-circle&-status-exception`]:{[`${r}-text`]:{color:e.colorError}},[`${r}-circle&-status-success`]:{[`${r}-text`]:{color:e.colorSuccess}}},[`${r}-inline-circle`]:{lineHeight:1,[`${r}-inner`]:{verticalAlign:"bottom"}}}},Fr=e=>{const{componentCls:r}=e;return{[r]:{[`${r}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},Vr=e=>{const{componentCls:r,iconCls:s}=e;return{[r]:{[`${r}-small&-line, ${r}-small&-line ${r}-text ${s}`]:{fontSize:e.fontSizeSM}}}},Br=e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}),_r=wt("Progress",e=>{const r=e.calc(e.marginXXS).div(2).equal(),s=Pt(e,{progressStepMarginInlineEnd:r,progressStepMinWidth:r,progressActiveMotionDuration:"2.4s"});return[Ur(s),Mr(s),Fr(s),Vr(s)]},Br);var zr=function(e,r){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)r.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]]);return s};const Gr=e=>{let r=[];return Object.keys(e).forEach(s=>{const n=parseFloat(s.replace(/%/g,""));Number.isNaN(n)||r.push({key:n,value:e[s]})}),r=r.sort((s,n)=>s.key-n.key),r.map(s=>{let{key:n,value:a}=s;return`${a} ${n}%`}).join(", ")},Wr=(e,r)=>{const{from:s=Oe.blue,to:n=Oe.blue,direction:a=r==="rtl"?"to left":"to right"}=e,i=zr(e,["from","to","direction"]);if(Object.keys(i).length!==0){const c=Gr(i),u=`linear-gradient(${a}, ${c})`;return{background:u,[Te]:u}}const o=`linear-gradient(${a}, ${s}, ${n})`;return{background:o,[Te]:o}},Qr=e=>{const{prefixCls:r,direction:s,percent:n,size:a,strokeWidth:i,strokeColor:o,strokeLinecap:c="round",children:u,trailColor:h=null,percentPosition:l,success:d}=e,{align:x,type:v}=l,g=o&&typeof o!="string"?Wr(o,s):{[Te]:o,background:o},f=c==="square"||c==="butt"?0:void 0,I=a??[-1,i||(a==="small"?6:8)],[b,T]=we(I,"line",{strokeWidth:i}),j={backgroundColor:h||void 0,borderRadius:f},S=Object.assign(Object.assign({width:`${J(n)}%`,height:T,borderRadius:f},g),{[lt]:J(n)/100}),m=Ee(e),N={width:`${J(m)}%`,height:T,borderRadius:f,backgroundColor:d==null?void 0:d.strokeColor},k={width:b<0?"100%":b},w=p.createElement("div",{className:`${r}-inner`,style:j},p.createElement("div",{className:xe(`${r}-bg`,`${r}-bg-${v}`),style:S},v==="inner"&&u),m!==void 0&&p.createElement("div",{className:`${r}-success-bg`,style:N})),A=v==="outer"&&x==="start",y=v==="outer"&&x==="end";return v==="outer"&&x==="center"?p.createElement("div",{className:`${r}-layout-bottom`},w,u):p.createElement("div",{className:`${r}-outer`,style:k},A&&u,w,y&&u)},Kr=e=>{const{size:r,steps:s,rounding:n=Math.round,percent:a=0,strokeWidth:i=8,strokeColor:o,trailColor:c=null,prefixCls:u,children:h}=e,l=n(s*(a/100)),x=r??[r==="small"?2:14,i],[v,g]=we(x,"step",{steps:s,strokeWidth:i}),f=v/s,I=Array.from({length:s});for(let b=0;b<s;b++){const T=Array.isArray(o)?o[b]:o;I[b]=p.createElement("div",{key:b,className:xe(`${u}-steps-item`,{[`${u}-steps-item-active`]:b<=l-1}),style:{backgroundColor:b<=l-1?T:c,width:f,height:g}})}return p.createElement("div",{className:`${u}-steps-outer`},I,h)};var Xr=function(e,r){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)r.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]]);return s};const qr=["normal","exception","active","success"],ct=p.forwardRef((e,r)=>{const{prefixCls:s,className:n,rootClassName:a,steps:i,strokeColor:o,percent:c=0,size:u="default",showInfo:h=!0,type:l="line",status:d,format:x,style:v,percentPosition:g={}}=e,f=Xr(e,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style","percentPosition"]),{align:I="end",type:b="outer"}=g,T=Array.isArray(o)?o[0]:o,j=typeof o=="string"||Array.isArray(o)?o:void 0,S=p.useMemo(()=>{if(T){const X=typeof T=="string"?T:Object.values(T)[0];return new Rt(X).isLight()}return!1},[o]),m=p.useMemo(()=>{var X,z;const G=Ee(e);return parseInt(G!==void 0?(X=G??0)===null||X===void 0?void 0:X.toString():(z=c??0)===null||z===void 0?void 0:z.toString(),10)},[c,e.success,e.successPercent]),N=p.useMemo(()=>!qr.includes(d)&&m>=100?"success":d||"normal",[d,m]),{getPrefixCls:k,direction:w,progress:A}=p.useContext(kt),y=k("progress",s),[E,L,O]=_r(y),M=l==="line",V=M&&!i,H=p.useMemo(()=>{if(!h)return null;const X=Ee(e);let z;const G=x||(ee=>`${ee}%`),ae=M&&S&&b==="inner";return b==="inner"||x||N!=="exception"&&N!=="success"?z=G(J(c),J(X)):N==="exception"?z=M?p.createElement(Dt,null):p.createElement(Ut,null):N==="success"&&(z=M?p.createElement(Ae,null):p.createElement(Mt,null)),p.createElement("span",{className:xe(`${y}-text`,{[`${y}-text-bright`]:ae,[`${y}-text-${I}`]:V,[`${y}-text-${b}`]:V}),title:typeof z=="string"?z:void 0},z)},[h,c,m,N,l,y,x]);let de;l==="line"?de=i?p.createElement(Kr,Object.assign({},e,{strokeColor:j,prefixCls:y,steps:typeof i=="object"?i.count:i}),H):p.createElement(Qr,Object.assign({},e,{strokeColor:T,prefixCls:y,direction:w,percentPosition:{align:I,type:b}}),H):(l==="circle"||l==="dashboard")&&(de=p.createElement(Dr,Object.assign({},e,{strokeColor:T,prefixCls:y,progressStatus:N}),H));const Ie=xe(y,`${y}-status-${N}`,{[`${y}-${l==="dashboard"&&"circle"||l}`]:l!=="line",[`${y}-inline-circle`]:l==="circle"&&we(u,"circle")[0]<=20,[`${y}-line`]:V,[`${y}-line-align-${I}`]:V,[`${y}-line-position-${b}`]:V,[`${y}-steps`]:i,[`${y}-show-info`]:h,[`${y}-${u}`]:typeof u=="string",[`${y}-rtl`]:w==="rtl"},A==null?void 0:A.className,n,a,L,O);return E(p.createElement("div",Object.assign({ref:r,style:Object.assign(Object.assign({},A==null?void 0:A.style),v),className:Ie,role:"progressbar","aria-valuenow":m,"aria-valuemin":0,"aria-valuemax":100},Lt(f,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),de))});var Hr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M433.1 657.7a31.8 31.8 0 0051.7 0l210.6-292c3.8-5.3 0-12.7-6.5-12.7H642c-10.2 0-19.9 4.9-25.9 13.3L459 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H315c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"check-square",theme:"outlined"},Yr=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:Hr}))},Zr=p.forwardRef(Yr),Jr={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},es=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:Jr}))},Ze=p.forwardRef(es),ts={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"},rs=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:ts}))},ss=p.forwardRef(rs),ns={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},is=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:ns}))},as=p.forwardRef(is),os={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},ls=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:os}))},cs=p.forwardRef(ls),us={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"},ds=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:us}))},ms=p.forwardRef(ds),ps={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"},gs=function(r,s){return p.createElement(re,se({},r,{ref:s,icon:ps}))},hs=p.forwardRef(gs),fs=function(e,r){return br?window.matchMedia(e).matches:!1},bs=function(e,r){var s=p.useState(fs(e)),n=s[0],a=s[1];return p.useEffect(function(){var i=!0,o=window.matchMedia(e),c=function(){i&&a(!!o.matches)};return o.addEventListener("change",c),a(o.matches),function(){i=!1,o.removeEventListener("change",c)}},[e]),n};const ut={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};C.keyBy(ut,"prefix");const xs=["*","^","+","~","!"],Y={ATTRIBUTE_VALUE_DICT:ut,ATTRIBUTE_VALUE_PRIORITY:xs},ke=(e={})=>C.cloneDeep(C.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},e)),Le=(e={})=>C.cloneDeep(C.merge({id:"",attributes:{}},e)),dt=(e,r,s)=>{const n=C.orderBy(Object.values(r),["priority","id"],["asc","asc"]).map(l=>l.id);function a(l,d){return C.orderBy(l,x=>n.indexOf(x),["asc"]).map(x=>`${d}${x}`)}const i=[],o=[],c=[],u=[],h=[];return Object.entries(e.attributes).forEach(([l,d])=>{if(r[l])switch(d){case $.OPPOSITE:i.push(l);break;case $.DETERMINISTIC:o.push(l);break;case $.RELATED:c.push(l);break;case $.UNRELATED:u.push(l);break;case $.UNCLEAR:h.push(l);break;default:h.push(l);break}}),[...a(i,B.OPPOSITE),...a(o,B.DETERMINISTIC),...a(c,B.RELATED),...a(u,B.UNRELATED),...a(h,B.UNCLEAR)]},mt=C.memoize(e=>{if(e.length===3)return{key:e,className:"",text:""};const r=e[0];return{key:e.slice(1,4),className:{[B.DETERMINISTIC]:"deterministic",[B.UNRELATED]:"unrelated",[B.UNCLEAR]:"unclear",[B.OPPOSITE]:"opposite"}[r],text:{[B.DETERMINISTIC]:"very",[B.UNRELATED]:"not",[B.UNCLEAR]:"maybe",[B.OPPOSITE]:"very not"}[r]}}),pt=(e,r,s)=>e.filter(n=>!(!r&&n.includes(B.UNCLEAR)||!s&&n.includes(B.UNRELATED)));function gt(e,r,s){const n=[];for(const[o,c]of Object.entries(e.attributes)){const u=r[o];if(u){const h=Object.values(Y.ATTRIBUTE_VALUE_DICT).find(l=>l.value===c);h&&n.push({prefix:h.prefix,id:u.id,priority:u.priority})}}const a=C.sortBy(n,[o=>Y.ATTRIBUTE_VALUE_PRIORITY.indexOf(o.prefix),o=>o.prefix===Y.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:o.priority,["asc","asc"]]),i=s!=null&&s.length?a.slice(0,s==null?void 0:s.length):a;return s!=null&&s.onlyRelevant?i.filter(o=>[Y.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,Y.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(o.prefix)).map(o=>`${o.prefix}${o.id}`).join(""):i.map(o=>`${o.prefix}${o.id}`).join("")}const vs=C.keyBy(Y.ATTRIBUTE_VALUE_DICT,"prefix");function js(e){return(e.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((s,n)=>{const a=n[0],i=n.slice(1),o=vs[a].value;return s[i]=o,s},{})}function ht(e){return Object.values(e.attributes).reduce((r,s)=>s<=0?(s===Y.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(r+=s/2),r):r+s,0)}function ft(e,r){const s=Object.values(e.attributes).filter(n=>n===Y.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((r-s)/r*100)}function F(){const[e,r]=Ft(),s=(a,i)=>{e.set(a,`${i}`),r(e)},n=a=>{e.delete(a),r(e)};return{view:e.get("view")??"classifier",setView:a=>r({view:a}),addQueryParam:s,removeQueryParam:n,searchParams:e}}const pe={};function ys(){const{notification:e,message:r}=Ue.useApp(),s=Vt(),n=be("items"),a=be("items-attributes"),i=be("items-attribute-values"),o=sr("tdr","itemsAttributeValues",{select:j=>Cs({itemAttributesValues:j,itemAttributes:a.data??{}})}),[c,u]=p.useState({}),h=nr("tdr","itemsAttributeValues",{onSuccess:()=>{e.success({message:"itemsAttributeValues updated"}),s.refetchQueries({queryKey:["firebase","tdr","itemsAttributeValues"]}),u({})},onError:j=>{e.error({message:"itemsAttributeValues update failed",description:j.message})}}),l=p.useMemo(()=>({...i.data??{},...o.data??{}}),[i.data,o.data]),d=!C.isEmpty(c),x=(j,S)=>{u(m=>({...m,[j]:{...S,updatedAt:Date.now()}}))},v=j=>{u(S=>({...S,...C.mapKeys(j.map(m=>({...m,updatedAt:Date.now()})),"id")}))},g=o.data,f=()=>{h.mutate(Is({...g,...c},a.data))};return{availableItemIds:p.useMemo(()=>{const j=n.data??{};return C.orderBy(Object.keys(j).filter(S=>{var m;return(((m=j[S])==null?void 0:m.decks)??[]).includes("alien")}),S=>Number(S),"asc")},[n.data]),getItem:j=>{var S;return(S=n.data)!=null&&S[j]?n.data[j]:(j&&r.info(`Item ${j} not found in TDR. Creating a new item...`),ke({id:j}))},getItemAttributeValues:j=>{const S=(l==null?void 0:l[j])??{},m=c[j]??{};return C.isEmpty(S)&&C.isEmpty(m)?(pe[j]=Le({id:j}),pe[j]):C.merge((pe==null?void 0:pe[j])??{},S,m)},attributes:a.data??{},isLoading:n.isLoading||a.isLoading||i.isLoading||o.isLoading,error:n.error||a.error||i.error||o.error,firebaseData:g,isSaving:h.isPending,save:f,addAttributesToUpdate:x,addMultipleAttributesToUpdate:v,attributesToUpdate:c,isDirty:d}}const Is=(e,r)=>er(e,n=>({id:n.id,tempSignature:gt(n,r),updatedAt:n.updatedAt})),Cs=e=>{const{itemAttributesValues:r,itemAttributes:s}=e,n=Object.keys(s).length;return Jt(r,i=>{const o=js(i.tempSignature),c=Object.keys(o).length===n,u={id:i.id,updatedAt:i.updatedAt,attributes:o};return c?{...u,complete:c,reliability:ft(u,n),score:ht(u)}:u})},bt=p.createContext({getItem:()=>ke(),getItemAttributeValues:()=>Le(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:ke(),itemAttributeValues:Le(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{}}),Ss=({children:e})=>{const{getItem:r,getItemAttributeValues:s,availableItemIds:n,isLoading:a,error:i,isSaving:o,save:c,addAttributesToUpdate:u,isDirty:h,attributes:l,addMultipleAttributesToUpdate:d,attributesToUpdate:x}=ys(),{message:v}=Ue.useApp(),g=p.useMemo(()=>C.orderBy(Object.values(l),"name.en","asc"),[l]),{searchParams:f}=F(),I=f.get("sortBy"),b=p.useMemo(()=>I==="id"?C.orderBy(n,A=>Number(A),"asc"):I==="updatedAt"?C.orderBy(n,A=>s(A).updatedAt,"desc"):I==="fewestAttributesLeft"?C.orderBy(n,A=>{const y=g.length-Object.keys(s(A).attributes).length;return y===0?Number.POSITIVE_INFINITY:y},"asc"):n,[n,I]),[T,j]=p.useState(C.random(0,b.length-1)),S=r(b[T]),m=s(S.id),N=(A,y)=>{if(A==="next"){j(E=>(E+1)%b.length);return}if(A==="previous"){j(E=>(E-1+b.length)%b.length);return}if(A==="random"){j(C.random(0,b.length-1));return}if(A==="first"){j(0);return}if(A==="last"){j(b.length-1);return}if(A==="next10"){j(E=>(E+10)%b.length);return}if(A==="previous10"){j(E=>(E-10+b.length)%b.length);return}if(A==="incomplete"){j(E=>{let L=E+1;for(;L<b.length;){const O=s(b[L]);if(Object.keys(O.attributes).length!==g.length)return L;if(L===b.length-1)return v.info("No more incomplete items found."),E;L++}return E});return}if(A==="goTo"&&y!==void 0){const E=b.indexOf(y);if(E!==-1){j(E);return}v.error(`Item ${y} is not available for attribution.`)}},k=(A,y)=>{u(S.id,{...m,attributes:{...m.attributes,[A]:y}})},w=()=>Fe(n.reduce((A,y)=>{const E=s(y);return C.isEmpty(E.attributes)||(Object.keys(E.attributes).length===g.length?E.complete=!0:delete E.complete,A[E.id]=E),A},{}));return t.jsx(bt.Provider,{value:{getItem:r,getItemAttributeValues:s,availableItemIds:n,isLoading:a,error:i,hasResponseData:n.length>0&&!C.isEmpty(l),isDirty:h,itemAttributeValues:m,jumpToItem:N,activeItem:S,onAttributeChange:k,isSaving:o,save:c,attributes:l,attributesList:g,addAttributesToUpdate:u,addMultipleAttributesToUpdate:d,prepareItemsAttributesFileForDownload:w,attributesToUpdate:x},children:e})},U=()=>p.useContext(bt);function Q({label:e,children:r}){return t.jsxs(D.Text,{children:[e," ",t.jsx(he,{children:r})]})}function As(){const{getItemAttributeValues:e,availableItemIds:r,attributesList:s}=U(),{total:n,complete:a,completionPercentage:i,hasDataCount:o,initiatedPercentage:c,progress:u,progressTotal:h,currentProgress:l}=p.useMemo(()=>{const d=r.length;let x=0,v=0,g=0;r.map(b=>e(b)).forEach(({attributes:b})=>{C.isEmpty(b)||(x+=1),Object.values(b).length===s.length&&(v+=1),g+=Object.values(b).length});const I=Object.values(s).length*r.length;return{total:d,complete:v,completionPercentage:d>0?(v/d*100).toFixed(1):0,hasDataCount:x,initiatedPercentage:d>0?Math.floor(x/d*100):0,progress:(g/I*100).toFixed(1),currentProgress:g,progressTotal:I}},[s,r,e]);return t.jsxs(t.Fragment,{children:[t.jsxs(P,{vertical:!0,children:[t.jsx(D.Text,{strong:!0,className:"mb-2",children:"Items Stats"}),t.jsx(Q,{label:"Total",children:n}),t.jsxs(Q,{label:"Complete",children:[a," (",i,"%)"]}),t.jsxs(Q,{label:"Initiated",children:[o," (",c,"%)"]}),t.jsx(D.Text,{strong:!0,className:"mt-4 mb-2",children:"Attributes Stats"}),t.jsx(Q,{label:"Total",children:h}),t.jsx(Q,{label:"Set",children:l}),t.jsxs(Q,{label:"Progress",children:[u,"%"]})]}),t.jsx(K,{})]})}function Es(){const{jumpToItem:e}=U(),{searchParams:r,addQueryParam:s}=F();return t.jsxs(t.Fragment,{children:[t.jsx(R,{block:!0,onClick:()=>e("random"),type:"primary",children:"Random Item"}),t.jsx(q,{label:"Unset Only",value:r.get("scope")==="unset",onChange:n=>s("scope",n?"unset":""),className:"mt-4"})]})}function Ts(){const{searchParams:e,addQueryParam:r}=F(),{attributesList:s}=U(),n=p.useMemo(()=>[{label:"Random Attribute",value:"random"},...s.map(({id:a,name:i})=>({label:i.en,value:a}))],[s]);return t.jsxs(t.Fragment,{children:[t.jsx(ue,{label:"Sampler Attribute",value:e.get("attribute")||"random",onChange:a=>r("attribute",a),options:n}),t.jsx(st,{label:"Sample Size",value:Number(e.get("size")||9),onChange:a=>r("size",String(a)),min:3,max:21,step:3})]})}function ws(){const{searchParams:e,addQueryParam:r}=F(),{attributesList:s}=U(),n=p.useMemo(()=>s.map(({id:a,name:i,...o})=>({label:`${i.en}${o.default?"*":""}`,value:a})),[s]);return t.jsxs(t.Fragment,{children:[t.jsx(ue,{label:"Attribute",value:e.get("attribute")||"ali",onChange:a=>r("attribute",a),options:n}),t.jsx(ue,{label:"Scope",value:e.get("scope")||"unset",onChange:a=>r("scope",a),options:[{value:"unset",label:"Unset"},...Zt]}),t.jsx(ue,{label:"Results per page",value:e.get("pageSize")||12,onChange:a=>r("pageSize",a),options:[12,24,48,96]})]})}function Ps(){const{searchParams:e,addQueryParam:r}=F();return t.jsxs(t.Fragment,{children:[t.jsx(q,{label:"Only Complete",value:e.get("showComplete")==="true",onChange:s=>r("showComplete",s?"true":""),className:"full-width m-0"}),t.jsx(q,{label:"Show Unrelated",value:e.get("showUnrelated")==="true",onChange:s=>r("showUnrelated",s?"true":""),className:"full-width m-0"}),t.jsx(q,{label:"Show Unclear",value:e.get("showUnclear")==="true",onChange:s=>r("showUnclear",s?"true":""),className:"full-width m-0"})]})}function Ns(){const{searchParams:e,addQueryParam:r}=F();return t.jsx(t.Fragment,{children:t.jsx(q,{label:"Show Glyphs",value:e.get("showGlyphs")==="true",onChange:s=>r("showGlyphs",s?"true":""),className:"full-width m-0"})})}function $s(){const{isDirty:e,save:r,prepareItemsAttributesFileForDownload:s,attributes:n,isSaving:a,attributesToUpdate:i}=U(),{view:o,setView:c}=F();return t.jsxs(Ht,{children:[t.jsxs(P,{vertical:!0,gap:12,children:[t.jsx(Yt,{isDirty:e,onSave:r,isSaving:a,dirt:JSON.stringify(i)}),t.jsx(nt,{data:()=>Os(s(),n),fileName:"items-attribute-values.json",disabled:e,block:!0})]}),t.jsx(K,{}),t.jsx(As,{}),t.jsx(ue,{label:"View",value:o,onChange:c,options:["classifier","sampler","grouping","comparator","simulator","stats"]}),t.jsx(K,{}),o==="classifier"&&t.jsx(Es,{}),o==="sampler"&&t.jsx(Ts,{}),o==="grouping"&&t.jsx(ws,{}),o==="comparator"&&t.jsx(Ps,{}),o==="stats"&&t.jsx(Ns,{})]})}function Os(e,r){const s=Object.keys(r).length;return Object.keys(e).forEach(n=>{const a=e[n],i=Object.keys(a.attributes);i.forEach(c=>{r[c]||delete a.attributes[c]}),i.length===s?(a.complete=!0,a.score=ht(a),a.reliability=ft(a,s),a.signature=gt(a,r,{onlyRelevant:!0})):(a.complete=void 0,a.score=void 0,a.reliability=void 0,a.signature=void 0)}),Fe(it(e))}function xt(e){const[r,s]=p.useState(!1),n=()=>{s(window.scrollY>300)},a=()=>{window.scrollTo({top:0,behavior:"smooth"})};return Bt(()=>(window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n)})),t.jsx(R,{className:`go-to-top-button ${r?"visible":""}`,onClick:a,icon:t.jsx(ir,{}),...e,children:"Go to Top"})}function vt({title:e,icon:r}){return t.jsx(De,{title:e,children:r??t.jsx(at,{})})}const Je=[{label:"Opposite",value:$.OPPOSITE},{label:"Unrelated",value:$.UNRELATED},{label:"Unclear",value:$.UNCLEAR},{label:"Related",value:$.RELATED},{label:"Deterministic",value:$.DETERMINISTIC}],et=[{label:"Opposite",value:$.OPPOSITE},{label:"Unrelated",value:$.UNRELATED},{label:"Unclear",value:$.UNCLEAR},{label:"Related",value:$.RELATED},{label:"Deterministic",value:$.DETERMINISTIC,disabled:!0}];function ye({attribute:e,value:r,onChange:s,onlyButtons:n,size:a}){return e?n?t.jsx(We.Group,{options:e.limited?et:Je,onChange:({target:{value:i}})=>s(e.id,i),value:r,optionType:"button",buttonStyle:"solid",size:a}):t.jsxs("div",{className:"attribute-button-container__row",children:[t.jsxs("span",{className:"attribute-button-container__label",children:[C.truncate(e.name.en,{length:12})," ",t.jsx(vt,{title:e.description.en})]}),t.jsx(We.Group,{options:e.limited?et:Je,onChange:({target:{value:i}})=>s(e.id,i),value:r,optionType:"button",buttonStyle:"solid",size:a}),t.jsx("span",{children:t.jsx(Ae,{style:{color:r&&r>7?"green":"transparent"}})})]},e.id):t.jsx(t.Fragment,{})}function Rs({itemAttributeValues:e,attributes:r}){const{searchParams:s,addQueryParam:n}=F(),a=s.get("showUnclear")==="true",i=s.get("showUnrelated")==="true",o=p.useMemo(()=>pt(dt(e,r),a,i),[e,r,a,i]),c=s.get("signs")==="true"?jt:ks;return t.jsxs(P,{gap:6,vertical:!0,children:[t.jsx(q,{label:"Show Unrelated",value:s.get("showUnrelated")==="true",onChange:u=>n("showUnrelated",u?"true":""),className:"full-width m-0"}),t.jsx(q,{label:"Show Unclear",value:s.get("showUnclear")==="true",onChange:u=>n("showUnclear",u?"true":""),className:"full-width m-0"}),t.jsx(q,{label:"Alien Sings",value:s.get("signs")==="true",onChange:u=>n("signs",u?"true":""),className:"full-width m-0"}),t.jsx(P,{gap:6,wrap:"wrap",className:"item-attribute-value-statement",children:o.map((u,h,l)=>t.jsx(c,{keyVariant:u,attributes:r,firstElement:h===0,lastElement:h===l.length-1},u))})]})}function jt({keyVariant:e,attributes:r,withText:s}){const{key:n,className:a,text:i}=mt(e);return t.jsxs(P,{vertical:!0,align:"center",children:[t.jsx(Z,{width:50,id:r[n].spriteId,className:Re("item-attribute-alien-sign",`item-attribute-alien-sign--${a}`)}),s&&t.jsxs(P,{wrap:"wrap",justify:"center",align:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},children:[i," ",r[n].name.en.toLowerCase()]})]})}function ks({keyVariant:e,attributes:r,firstElement:s,lastElement:n}){const{key:a,text:i}=mt(e),o=s?"It's ":"",c=n?".":", ";return t.jsxs(t.Fragment,{children:[o,i," ",r[a].name.en.toLowerCase(),c]})}function Ls({attributesList:e,itemAttributeValues:r}){const{completion:s,isDeterministic:n,value:a,isOpposing:i,relevancy:o}=p.useMemo(()=>{const c=e.length,u=Object.keys(r.attributes).length,h=Math.floor(u/c*100);let l=!1,d=!1,x=0;const v=Object.values(r.attributes).reduce((f,I)=>I<=0?(I===$.UNCLEAR&&(x+=1),I===$.OPPOSITE&&(d=!0,f+=I/2),f):(I===$.DETERMINISTIC&&(l=!0),f+I),0),g=Math.floor((u-x)/c*100);return{completion:h,isDeterministic:l,value:v,isOpposing:d,relevancy:g}},[e,r.attributes]);return t.jsxs("div",{children:[t.jsx(D.Text,{strong:!0,children:"Completion"}),t.jsx(ct,{percent:s,size:"small"}),t.jsx(D.Text,{strong:!0,children:"Stats"}),t.jsxs(P,{vertical:!0,children:[t.jsx(Q,{label:"Deterministic",children:n?t.jsx(Ae,{style:{color:"green"}}):t.jsx(Ze,{style:{color:"red"}})}),t.jsx(Q,{label:"Opposing",children:i?t.jsx(Ae,{style:{color:"CornflowerBlue"}}):t.jsx(Ze,{style:{color:"grey"}})}),t.jsx(Q,{label:"Value",children:a}),t.jsx(De,{title:"The percentage of conclusive attributes (not unclear)",children:t.jsxs(Q,{label:"Reliability",children:[o,"%"]})})]})]})}function Ds(){const{activeItem:e,attributesList:r,itemAttributeValues:s,onAttributeChange:n,jumpToItem:a,attributes:i}=U(),{searchParams:o,removeQueryParam:c}=F(),u=o.get("itemId"),h=o.get("filters");p.useEffect(()=>{u&&(c("itemId"),a("goTo",u))},[u,a,c]);const l=o.get("scope")==="unset",d=p.useMemo(()=>{const x=l?r.filter(v=>!s.attributes[v.id]):r;if(h){const v=h.split(",").reduce((g,f)=>(g[f]=!0,g),{});return x.filter(g=>v[g.id])}return x},[l,e.id,h]);return e?t.jsx(te,{children:t.jsxs("div",{className:"item-attribution-card",children:[t.jsx(lr,{offsetTop:120,className:"item-attribution-card__item",children:t.jsxs(P,{vertical:!0,gap:6,children:[t.jsx(ne,{item:e,width:150}),t.jsx(ie,{item:e}),t.jsx(_,{item:e,language:"en"}),t.jsx(_,{item:e,language:"pt"}),t.jsx(K,{className:"my-2"}),t.jsx(Ls,{attributesList:r,itemAttributeValues:s}),t.jsx(K,{className:"my-2"}),t.jsx(D.Text,{type:"secondary",children:t.jsx(Rs,{itemAttributeValues:s,attributes:i})})]})}),t.jsx(W,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:d.map(x=>t.jsx(ye,{attribute:x,value:s.attributes[x.id],onChange:n},x.id))})]},`${e.id}`)}):t.jsx(te,{children:t.jsxs(D.Text,{type:"secondary",children:["No item selected."," ",t.jsx(R,{size:"small",type:"primary",onClick:()=>a("random"),children:"Random Item"})]})})}function Us(){const{jumpToItem:e}=U();return t.jsxs(W.Compact,{children:[t.jsx(R,{onClick:()=>e("first"),icon:t.jsx(hs,{}),children:"First"}),t.jsx(R,{onClick:()=>e("previous10"),icon:t.jsx(ur,{}),children:"Previous 10"}),t.jsx(R,{onClick:()=>e("previous"),icon:t.jsx(_t,{}),children:"Previous"}),t.jsxs(R,{onClick:()=>e("next"),children:["Next ",t.jsx(zt,{})]}),t.jsxs(R,{onClick:()=>e("next10"),children:["Next 10 ",t.jsx(dr,{})]}),t.jsxs(R,{onClick:()=>e("last"),children:["Last ",t.jsx(ms,{})]}),t.jsx(Me,{content:t.jsx(Ms,{}),title:"Go to item",children:t.jsx(R,{children:"Go To"})}),t.jsx(R,{onClick:()=>e("incomplete"),children:"Next Incomplete"})]})}function Ms(){const{jumpToItem:e}=U();return t.jsx(cr,{isPending:!1,onFinish:r=>e("goTo",r)})}function Fs(){const{addParam:e,queryParams:r}=Ve(),{attributesList:s}=U(),n=p.useMemo(()=>s.map(c=>({label:c.name.en,value:c.id})),[s]),a=c=>{e("filters",c.join(","))},i=r.get("filters"),o=t.jsx(ce,{mode:"multiple",style:{width:300},options:n,value:i==null?void 0:i.split(","),onChange:c=>a(c),allowClear:!0});return t.jsx(Me,{content:o,title:"Filter Attributes",children:t.jsx(R,{children:i?t.jsx(pr,{style:{color:"gold"}}):t.jsx(as,{})})})}function Vs(){const{addParam:e,queryParams:r}=Ve(),s=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],n=r.get("sortBy"),a=t.jsx(ce,{style:{width:120},options:s,value:n,onChange:i=>e("sortBy",i),allowClear:!0});return t.jsx(Me,{content:a,title:"Sort By",children:t.jsx(R,{children:"Sort"})})}function Bs(){const{attributes:e,getItemAttributeValues:r,availableItemIds:s,getItem:n,isLoading:a}=U(),{searchParams:i}=F(),o=i.get("showComplete")==="true",c=i.get("showUnclear")==="true",u=i.get("showUnrelated")==="true",{itemMessages:h,itemMessagesDict:l,grouping:d}=p.useMemo(()=>{if(a)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const x=C.orderBy(s.map(f=>{const I=r(f),b=dt(I,e);return{item:n(f),itemAttributesValues:I,message:pt(b,c,u),fullMessage:b}}).filter(({itemAttributesValues:f})=>o?f.complete:!0),["message"],["asc"]),v=x.reduce((f,{message:I,item:{id:b}})=>{const T=I.join(" ");return f[T]===void 0&&(f[T]=[]),f[T].push(b),f},{}),g=Object.values(v).filter(f=>f.length>1);return g.length>0&&console.log("More than one",g),{itemMessages:x,itemMessagesDict:C.keyBy(x,"item.id"),grouping:v}},[e,s,r,n,a,o,c,u]);return{itemMessages:h,itemMessagesDict:l,grouping:d}}function Be(){const{searchParams:e,removeQueryParam:r}=F(),s=e.get("drawer"),[n,a]=p.useState(!1),{activeItem:i,attributesList:o,itemAttributeValues:c,onAttributeChange:u,jumpToItem:h}=U(),l=()=>{r("drawer")};p.useEffect(()=>{s&&h("goTo",s)},[s,h,r]);const d=p.useMemo(()=>n?o.filter(x=>!c.attributes[x.id]):o,[n,i.id]);return t.jsxs(hr,{open:!!s,title:`Edit: ${i.name.en}`,onClose:l,width:"640px",children:[t.jsxs(P,{gap:6,children:[t.jsxs(P,{vertical:!0,gap:6,children:[t.jsx(ne,{item:i,width:50}),t.jsx(ie,{item:i})]}),t.jsxs(P,{vertical:!0,gap:6,children:[t.jsx(_,{item:i,language:"en"}),t.jsx(_,{item:i,language:"pt"})]}),t.jsx(P,{vertical:!0,gap:6,children:t.jsx(fr,{checked:n,onChange:a,checkedChildren:"Unset",unCheckedChildren:"All"})})]}),t.jsx(K,{className:"my-1"}),t.jsx(W,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:d.map(x=>t.jsx(ye,{size:"small",attribute:x,value:c.attributes[x.id],onChange:u},x.id))})]})}function _s(){const{attributes:e}=U(),{itemMessages:r,grouping:s}=Bs(),{addQueryParam:n}=F(),a=[{title:"Item Id",dataIndex:"item",key:"id",render:i=>t.jsxs("div",{children:[t.jsx(ie,{item:i}),t.jsxs(R.Group,{children:[t.jsx(je,{item:i}),t.jsx(R,{size:"small",shape:"round",onClick:()=>n("drawer",i.id),children:"Drawer"})]})]}),sorter:(i,o)=>Number(i.item.id)-Number(o.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:i=>t.jsx(ne,{item:i,width:75})},{title:"Name",dataIndex:"item",key:"name",render:i=>t.jsxs(t.Fragment,{children:[t.jsx(_,{item:i,language:"en"}),t.jsx(_,{item:i,language:"pt"})]}),sorter:(i,o)=>i.item.name.en.localeCompare(o.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(i,{item:o})=>t.jsx(P,{gap:6,children:i.map((c,u,h)=>t.jsx(jt,{keyVariant:c,attributes:e,firstElement:u===0,lastElement:u===h.length-1,withText:!0},`${c}-${o.id}`))}),sorter:(i,o)=>i.message.join(" ").localeCompare(o.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:i=>i.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:i=>{const o=s[i.join(" ")]??[];return t.jsx(t.Fragment,{children:o.length>1?o.length:"0"})},sorter:(i,o)=>{const c=s[i.message.join(" ")]??[];return(s[o.message.join(" ")]??[]).length-c.length}}];return t.jsxs("div",{className:"my-4",children:[t.jsx(D.Title,{level:5,children:"Item Comparator"}),t.jsx(ot,{dataSource:r,columns:a,pagination:{showQuickJumper:!0}}),t.jsx(Be,{})]})}function zs(){const{attributesList:e,addAttributesToUpdate:r,getItemAttributeValues:s,availableItemIds:n,addMultipleAttributesToUpdate:a}=U(),{searchParams:i,addQueryParam:o}=F(),c=i.get("attribute")??"ali",u=i.get("scope")??"unset",h=i.get("page")??"1",l=i.get("pageSize")??"12",[d,x]=p.useState("ali"),[v,g]=p.useState("unset"),[f,I]=p.useState(null),[b,T]=p.useState("desc"),j=p.useMemo(()=>{const w=n.map(O=>s(O)),A=u==="unset"?void 0:$[u.toUpperCase()],y=w.filter(O=>{var M;return((M=O.attributes)==null?void 0:M[c])===A}).map(O=>O.id),[E,L]=(f??"::").split("::");return C.orderBy(y,[O=>{var M,V;return E==="attribute"?(V=(M=s(O))==null?void 0:M.attributes)==null?void 0:V[L]:!0},O=>E==="prop"?Number(O):!0,O=>{var M;return(M=s(O))==null?void 0:M.updatedAt},O=>Number(O)],[b,"asc","desc","asc"])},[c,u,f,b]),S=p.useMemo(()=>{if(d!==c||v!==u)return x(c),g(u),o("page","1"),j.slice(0,Number(l));const w=(Number(h)-1)*Number(l),A=w+Number(l);return j.slice(w,A)},[h,l,j]),m=e.find(w=>w.id===c),N=(w,A,y)=>{const E=s(w);r(w,{...E,attributes:{...E.attributes,[A]:y}})},k=()=>{a(S.map(w=>{const A=s(w);return A.attributes[c]||(A.attributes[c]=$.UNRELATED),A}))};return{group:j,stats:{total:n.length,group:j.length,percent:Math.round(j.length/n.length*100)},pageIds:S,attribute:m,updateAttributeValue:N,updatePageItemsAsUnrelated:k,sorting:{sortBy:f,setSortBy:I,sortOrder:b,setSortOrder:T},pagination:{total:j.length,current:Number(h),pageSize:Number(l),onChange:w=>o("page",String(w)),onShowSizeChange:(w,A)=>o("pageSize",String(A)),pageSizeOptions:[12,24,48,96]}}}const Gs=(e,r)=>r==="unset"||!r?`${100-e.percent}% done, ${e.group} left`:`${e.percent}%  - ${e.group} items`;function Ws(){const{getItem:e,getItemAttributeValues:r,attributesList:s}=U(),{attribute:n,pageIds:a,updateAttributeValue:i,updatePageItemsAsUnrelated:o,pagination:c,stats:u,sorting:h}=zs(),{searchParams:l,addQueryParam:d}=F(),x=bs("(max-width: 1024px)");if(C.isEmpty(n))return t.jsx(te,{className:"my-4",children:t.jsx(D.Text,{type:"secondary",children:"No group attribute has been selected."})});const v=t.jsx(mr,{onChange:c.onChange,current:c.current,total:c.total,pageSizeOptions:c.pageSizeOptions,pageSize:c.pageSize,onShowSizeChange:c.onShowSizeChange},"pagination"),g=t.jsxs(P,{align:"center",children:[t.jsx(D.Text,{className:"mr-2",children:"Sort by"}),t.jsxs(ce,{style:{width:120},value:h.sortBy,onChange:b=>h.setSortBy(b),children:[t.jsx(ce.Option,{value:null,children:"Last Updated"}),t.jsx(ce.Option,{value:"prop::id",children:"Id"}),s.map(b=>t.jsx(ce.Option,{value:`attribute::${b.id}`,children:b.name.en},b.id))]})]}),I=(l.get("scope")==="unset"||!l.get("scope"))&&t.jsx(xr,{title:`Are you sure everything is unrelated to ${n.name.en}?`,onConfirm:o,children:t.jsx(R,{type:"primary",danger:!0,disabled:a.length===0,children:"Unrelate Unset Items on Page"})},"unrelate-button");return t.jsxs(te,{className:"my-4",title:t.jsxs(D.Text,{children:[n==null?void 0:n.name.en," (",Gs(u,l.get("scope")),") -"," ",n.description.en]}),extra:t.jsxs(P,{align:"center",children:[g,v]}),actions:[I,t.jsx(xt,{},"go-to-top"),v].filter(Boolean),children:[a.length===0&&t.jsx(ve,{description:"No items found in this scope for this attribute.",image:ve.PRESENTED_IMAGE_SIMPLE}),a.map(b=>{const T=r(b),j=e(b);return t.jsx(te.Grid,{style:{width:x?"50%":"25%"},children:t.jsxs(P,{gap:6,children:[t.jsxs(P,{vertical:!0,gap:6,children:[t.jsx(ne,{item:j,width:75}),t.jsx(ie,{item:j}),t.jsxs(R.Group,{children:[t.jsx(je,{item:j}),t.jsx(R,{size:"small",shape:"round",onClick:()=>d("drawer",j.id),children:"Drawer"})]}),t.jsx(_,{item:j,language:"en"}),t.jsx(_,{item:j,language:"pt"})]}),t.jsx(ye,{attribute:n,value:T.attributes[n.id],onlyButtons:!0,onChange:(S,m)=>i(j.id,S,m)})]})},`${b}-${T.updatedAt}`)}),t.jsx(Be,{})]})}function yt(){const{attributesList:e,availableItemIds:r,addAttributesToUpdate:s,getItemAttributeValues:n}=U(),{searchParams:a}=F(),[i,o]=p.useState([]),[c,u]=p.useState(),h=()=>{var T;const v=a.get("attribute")??((T=C.sample(e))==null?void 0:T.id)??"ali",g=e.find(j=>j.id===v)??C.sample(e),f=Number(a.get("size"))||9,I=[],b=C.shuffle(r);for(let j=0;j<b.length&&I.length!==f;j++){const S=b[j];n(S).attributes[v]||I.push(S)}return{selectedAttribute:g,selected:I}},l=()=>{let v=h(),g=0;for(;v.selected.length===0&&g<30;)v=h(),g++;u(v.selectedAttribute),o(v.selected)},d=p.useMemo(()=>c?r.filter(v=>!n(v).attributes[c==null?void 0:c.id]).length:0,[c,r]);return{sampleIds:i,attribute:c,itemsLeftForAttribute:d,onGetSample:l,updateAttributeValue:(v,g,f)=>{const I=n(v);s(v,{...I,attributes:{...I.attributes,[g]:f}})}}}function Qs(){const{getItem:e,getItemAttributeValues:r}=U(),{sampleIds:s,attribute:n,onGetSample:a,updateAttributeValue:i,itemsLeftForAttribute:o}=yt(),{addQueryParam:c}=F();if(C.isEmpty(s)&&C.isEmpty(n))return t.jsxs(te,{className:"my-4",children:[t.jsxs(D.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",t.jsx(R,{size:"small",type:"primary",onClick:a,children:"Get Sample"})]}),t.jsx(K,{}),t.jsx(tt,{})]});const u=s.map(d=>({itemAttributes:r(d),item:e(d)})),h=u.filter(({itemAttributes:d})=>(n==null?void 0:n.id)&&!d.attributes[n.id]),l=()=>{h.forEach(({item:d})=>{n!=null&&n.id&&i(d.id,n.id,-3)})};return t.jsxs(t.Fragment,{children:[t.jsx(tt,{}),t.jsxs(te,{className:"my-4",title:t.jsxs(D.Text,{children:[n==null?void 0:n.name.en," - ",n==null?void 0:n.description.en," (",o," items left)"]}),actions:[t.jsx(R,{onClick:l,danger:!0,disabled:h.length===0,children:"Mark rest as unrelated"},"1"),t.jsx(R,{type:"primary",ghost:!0,onClick:a,children:"Get New Sample"},"2")],extra:t.jsx(R,{type:"primary",size:"small",onClick:a,children:"Get New Sample"}),children:[t.jsxs(P,{vertical:!0,gap:6,children:[u.length===0&&t.jsx(ve,{description:"No unset items found for this attribute.",image:ve.PRESENTED_IMAGE_SIMPLE}),u.map(({item:d,itemAttributes:x})=>t.jsxs(p.Fragment,{children:[t.jsxs(P,{gap:6,children:[t.jsx(ne,{item:d,width:75}),t.jsxs(P,{vertical:!0,gap:6,children:[t.jsxs(P,{gap:6,children:[t.jsx(ie,{item:d}),t.jsxs(R.Group,{children:[t.jsx(je,{item:d}),t.jsx(R,{size:"small",shape:"round",onClick:()=>c("drawer",d.id),children:"Drawer"})]})]}),t.jsx(_,{item:d,language:"en"}),t.jsx(_,{item:d,language:"pt"})]}),!!n&&t.jsx(ye,{attribute:n,value:x.attributes[n.id],onChange:(v,g)=>i(d.id,v,g)})]}),t.jsx(K,{className:"my-1"})]},`${d.id}-${x.updatedAt}`))]}),t.jsx(Be,{})]})]})}function tt(){const[e,r]=vr(!1),{addQueryParam:s,removeQueryParam:n}=F(),{sampleIds:a,attribute:i,onGetSample:o,updateAttributeValue:c}=yt(),{getItem:u,getItemAttributeValues:h}=U(),l=()=>{s("size","1"),r(!0),o()},d=()=>{n("size"),r(!1)},x=a[0],v=u(x),g=h(x);return t.jsxs(P,{className:"mt-4",children:[t.jsx(R,{type:"primary",onClick:l,children:"Single Sampler"}),t.jsxs(jr,{title:t.jsxs(D,{children:["Single Sampler: ",t.jsx("strong",{children:i==null?void 0:i.name.en})]}),open:e,width:"100vw",maskClosable:!1,onOk:d,onClose:d,onCancel:d,cancelButtonProps:{style:{display:"none"}},children:[x&&v&&g&&i&&t.jsxs(P,{gap:6,className:"my-10",wrap:"wrap",children:[t.jsx(ne,{item:v,width:150}),t.jsxs(P,{vertical:!0,gap:6,children:[t.jsxs(P,{gap:6,children:[t.jsx(ie,{item:v}),t.jsx(je,{item:v})]}),t.jsx(_,{item:v,language:"en"}),t.jsx(_,{item:v,language:"pt"})]}),!!i&&t.jsx(ye,{size:"large",attribute:i,value:g.attributes[i.id],onChange:async(f,I)=>{c(v.id,f,I),await tr(500),o()}})]},x),t.jsx(R,{onClick:o,children:"Another Sample"})]})]})}function Ks(){const e=be("items-attributes"),r=be("items-attribute-values"),[s,n]=p.useState(null),a=()=>{n(rt(e.data,r.data))},i=()=>{const o={};let c=0;for(;c<300||C.keys(o).length===15;){const u=rt(e.data,r.data);if(u.valid&&!o[u.setId]&&(o[u.setId]=u),C.keys(o).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(o).map((u,h)=>({...u,number:u.number-h})))};return t.jsxs("div",{className:"my-4",children:[t.jsx(D.Title,{level:3,children:"Daily Simulator"}),t.jsx(D.Paragraph,{children:"Generates a daily game for Alien Communication"}),t.jsxs(W,{children:[t.jsx(R,{type:"primary",onClick:a,children:"Generate"}),t.jsx(R,{onClick:i,children:"Generate List"})]}),t.jsx("div",{children:!!s&&t.jsxs(W,{direction:"vertical",children:[t.jsx(D.Title,{level:5,children:s==null?void 0:s.setId}),!(s!=null&&s.valid)&&t.jsx(Gt,{type:"error",message:"Invalid game"}),t.jsx(W,{direction:"vertical",children:s==null?void 0:s.attributes.map(o=>t.jsxs(P,{gap:8,children:[t.jsx(Z,{id:o.spriteId,width:50}),o.itemsIds.map(c=>t.jsx(Qe,{id:c||"0",width:50},c))]},o.id))}),t.jsx(K,{className:"my-1"}),t.jsx(W,{direction:"horizontal",children:s==null?void 0:s.requests.map(o=>t.jsxs(P,{vertical:!0,children:[t.jsx(Z,{id:o.spritesIds[2],width:50}),t.jsx(Z,{id:o.spritesIds[1],width:50}),t.jsx(Z,{id:o.spritesIds[0],width:50})]},o.itemId))}),t.jsx(K,{className:"my-1"}),t.jsx(W,{direction:"horizontal",children:s==null?void 0:s.itemsIds.map(o=>t.jsx(Qe,{id:o||"0",width:50},o))})]},s==null?void 0:s.setId)})]})}const rt=(e,r)=>{const s=C.values(e).filter(m=>!m.limited||m.id==="sol"),n=C.shuffle(C.values(r).filter(m=>m.complete)),a=C.shuffle(rr(38,0)),i=C.sampleSize(s,3).map(m=>({...m,spriteId:`${a.pop()}`})),o=[],c=[],u=[],h=[],l=[],d=[],x=[],v=[];n.forEach(m=>{const N=[$.DETERMINISTIC,$.RELATED],k=m.attributes[i[0].id]===$.DETERMINISTIC,w=N.includes(m.attributes[i[0].id]),A=m.attributes[i[0].id]===$.UNRELATED,y=m.attributes[i[1].id]===$.DETERMINISTIC,E=N.includes(m.attributes[i[1].id]),L=m.attributes[i[1].id]===$.UNRELATED,O=m.attributes[i[2].id]===$.DETERMINISTIC,M=N.includes(m.attributes[i[2].id]),V=m.attributes[i[2].id]===$.UNRELATED;if(A&&L&&V)return v.push(m.id);k&&L&&V&&o.push(m.id),A&&y&&V&&c.push(m.id),A&&L&&O&&u.push(m.id),w&&E&&V&&h.push(m.id),w&&L&&M&&l.push(m.id),A&&E&&M&&d.push(m.id),w&&E&&M&&x.push(m.id)});const g=i.map(m=>({id:m.id,name:m.name.pt,description:m.description.pt,spriteId:m.spriteId,itemsIds:[]}));g[0].itemsIds=C.sampleSize(o,o.length>3?3:Math.max(o.length-1,1)),g[1].itemsIds=C.sampleSize(c,c.length>3?3:Math.max(o.length-1,1)),g[2].itemsIds=C.sampleSize(u,u.length>3?3:Math.max(o.length-1,1));const f=[];g.forEach(m=>{f.push(...m.itemsIds)});const I=[];h.length>0&&I.push({spritesIds:[i[0].spriteId,i[1].spriteId],itemId:C.sample(h)??""}),l.length>0&&I.push({spritesIds:[i[0].spriteId,i[2].spriteId],itemId:C.sample(l)??""}),d.length>0&&I.push({spritesIds:[i[1].spriteId,i[2].spriteId],itemId:C.sample(d)??""}),x.length>0&&I.push({spritesIds:i.map(m=>m.spriteId),itemId:C.sample(x)??""});const b=[];o.length>0&&b.push({spritesIds:[i[0].spriteId],itemId:o.filter(m=>!f.includes(m))[0]}),c.length>0&&b.push({spritesIds:[i[1].spriteId],itemId:c.filter(m=>!f.includes(m))[0]}),u.length>0&&b.push({spritesIds:[i[2].spriteId],itemId:u.filter(m=>!f.includes(m))[0]}),console.log({attributeA:o,attributeB:c,attributeC:u,attributeAB:h,attributeAC:l,attributeBC:d,attributeABC:x}),console.log("COMPLEX REQUEST SIZE",I.length),console.log("SIMPLE REQUEST SIZE",b.length);let T=C.sampleSize(I,4);console.log("REQUEST SIZE",T.length),T.length<3&&T.push(...C.sampleSize(b,4-T.length)),T.length<4&&console.warn("Not enough requests"),T=C.shuffle(T);const j=T.map(m=>m.itemId),S={id:"2024-00-00",setId:g.map(m=>m.id).sort().join("-"),number:0,type:"comunicação-alienígena",attributes:g,requests:T,solution:j.join("-"),itemsIds:C.shuffle([...j,v[0],v[1],v[2],v[3]]).filter(Boolean),valid:!1};return S.valid=[S.attributes.length===3,S.requests.length===4,S.itemsIds.length>5,S.attributes.every(m=>m.itemsIds.length>0),S.requests.every(m=>m.itemId)].every(Boolean),console.log(S),S},Xs=["","I","II","III","IV","V"];function qs(){const{attributes:e,availableItemIds:r,getItemAttributeValues:s,getItem:n}=U(),{message:a}=Ue.useApp(),[i,o]=p.useState(25),[c,u]=p.useState(80),[h,l]=p.useState(!1),[d,x]=p.useState([]),[v,g]=p.useState([]),[f,I]=p.useState(null),[b,T]=p.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),j=()=>{const m={},N=C.shuffle(r);for(;Object.values(m).length<i;){const y=N.pop();if(!y)break;const E=s(y);E&&(!E.complete||!E.reliability||E.reliability<c||!h&&n(y).nsfw||(E.signature&&!m[E.signature]?m[E.signature]=y:console.log("Item has identical key to another item. Skipping.",n(y).name.en)))}const k=Object.values(m);k.length<i&&a.error(`Could not generate sample. Got only ${k.length} items`),x(C.sortBy(k,y=>Number(y)));const w=Hs(k.map(y=>s(y)),25,e);if(w.length<25){const y=C.keys(e).filter(O=>!w.includes(O)),L=C.sortBy(y,O=>e[O].priority).slice(0,25-w.length);console.log("Adding more attributes by priority",L),w.push(...L)}const A=w.reduce((y,E)=>(k.forEach(L=>{const O=s(L);if(O)switch(O.attributes[E]){case $.RELATED:y.relatedCount[E]=(y.relatedCount[E]||0)+1;break;case $.DETERMINISTIC:y.deterministicCount[E]=(y.deterministicCount[E]||0)+1;break;case $.UNCLEAR:y.unclearCount[E]=(y.unclearCount[E]||0)+1;break;case $.OPPOSITE:y.oppositeCount[E]=(y.oppositeCount[E]||0)+1;break}}),y),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});g(w.sort().map(y=>({...e[y],relatedCount:A.relatedCount[y],deterministicCount:A.deterministicCount[y],unclearCount:A.unclearCount[y],oppositeCount:A.oppositeCount[y]})))},S=m=>{T(N=>({...N,[m]:!N[m]}))};return t.jsxs("div",{className:"my-4",children:[t.jsx(D.Title,{level:3,children:"Simulator"}),t.jsx(D.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),t.jsxs(P,{wrap:!0,gap:12,children:[t.jsx(ue,{label:"Grid Size",value:i,onChange:m=>o(m),options:[16,25]}),t.jsx(st,{label:"Reliability Threshold",value:c,onChange:m=>u(m),step:5,min:10,max:100}),t.jsx(q,{label:"NSFW",value:h,onChange:l}),t.jsx(R,{onClick:j,type:"primary",children:"Get Sample Board"})]}),t.jsxs(P,{wrap:!0,gap:12,children:[t.jsx(Se,{label:"Show Id",value:!!b.id,onChange:()=>S("id")}),t.jsx(Se,{label:"Show Name (EN)",value:!!b.nameEn,onChange:()=>S("nameEn")}),t.jsx(Se,{label:"Show Name (PT)",value:!!b.namePt,onChange:()=>S("namePt")}),t.jsx(Se,{label:"Show Reliability",value:!!b.reliability,onChange:()=>S("reliability")})]}),t.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(i)}, 1fr)`},children:d.map(m=>{const N=n(m),k=s(m);return t.jsxs(W,{direction:"vertical",className:Re("simulator-grid__entry",f&&k.attributes[f]>0&&"simulator-grid__entry--highlighted"),align:"center",children:[t.jsxs(W,{children:[t.jsxs(P,{vertical:!0,children:[b.id&&t.jsx(ie,{item:N}),b.reliability&&t.jsx("span",{children:t.jsx(qt,{prefix:t.jsx(cs,{}),placeholder:"Reliability",variant:"borderless",size:"small",value:k.reliability,readOnly:!0,style:{width:"8ch"},formatter:w=>`${w}%`})}),b.id&&t.jsx(je,{item:N})]}),t.jsx(ne,{item:N,width:50})]}),b.nameEn&&t.jsx(_,{item:N,language:"en"}),b.namePt&&t.jsx(_,{item:N,language:"pt"})]},m)})}),t.jsx("div",{className:"simulator-grid my-4",children:v.map(m=>t.jsxs(yr,{className:Re("simulator-grid__entry","simulator-grid__button",f===m.id&&"simulator-grid__entry--highlighted"),onClick:()=>I(m.id),children:[m.name.en," ",Xs[m.level],t.jsxs(P,{gap:6,justify:"center",className:"my-1",children:[t.jsxs("span",{children:[t.jsx(Zr,{style:{color:m.deterministicCount?"dodgerblue":void 0}})," ",m.deterministicCount??0]}),t.jsxs("span",{children:[t.jsx(gr,{style:{color:m.relatedCount?"green":void 0}})," ",m.relatedCount??0]}),t.jsxs("span",{children:[t.jsx(ss,{style:{color:m.oppositeCount?"red":void 0}})," ",m.oppositeCount??0]}),t.jsxs("span",{children:[t.jsx(at,{style:{color:m.unclearCount?"gold":void 0}})," ",m.unclearCount??0]})]})]},m.id))}),t.jsx(Ks,{})]})}function Hs(e,r,s){const n={},a={};e.forEach(g=>{g&&Object.keys(g.attributes).forEach(f=>{g.attributes[f]>0&&(n[f]=(n[f]||0)+1),g.attributes[f]===$.DETERMINISTIC&&(a[f]=!0,n[f]=(n[f]||0)+2),g.attributes[f]===$.OPPOSITE&&(n[f]=(n[f]||0)+1)})});const i={1:0,2:0,3:0,4:0};function o(g){return g.filter(f=>(i[s[f].level]++,i[4]>1?(console.log("Discarding level 4 attribute",f),!1):!0))}const c=o(Object.keys(a)),u=o(C.keys(n).filter(g=>!c.includes(g)));if(console.log({levelCount:i}),r===c.length)return console.log("All keys are deterministic"),c;if(console.log(n),c.length===0)return[];const h=c.reduce((g,f)=>{const I=n[f];return g[I]||(g[I]=[]),g[I].push(f),g},{}),l=C.keys(h).sort((g,f)=>Number(f)-Number(g));console.log({sortedDeterministicTiedGroupsKeys:l});const d=u.reduce((g,f)=>{const I=n[f];return g[I]||(g[I]=[]),g[I].push(f),g},{});console.log(d);const x=C.keys(d).sort((g,f)=>Number(f)-Number(g)),v=[];for(const g of l){if(v.length===r)break;v.push(...C.sampleSize(h[g],r-v.length))}for(const g of x){if(v.length===r)break;v.push(...C.sampleSize(d[g],r-v.length))}return v}function Ys(){const{attributes:e}=U(),r=[{key:"1",label:"All Attributes",children:t.jsx(le,{type:"all"})},{key:"2",label:"Default",children:t.jsx(le,{type:"default"})},{key:"3",label:"Custom",children:t.jsx(le,{type:"custom"})},{key:"4",label:"Limited",children:t.jsx(le,{type:"limited"})},{key:"5",label:"Specific",children:t.jsx(le,{type:"specific"})},{key:"6",label:"Opposite",children:t.jsx(le,{type:"opposite"})}];return t.jsxs("div",{className:"my-4",children:[t.jsxs(P,{justify:"space-between",align:"center",children:[t.jsx(D.Title,{level:5,children:"Stats"}),t.jsx(nt,{data:()=>Js(e),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),t.jsx(or,{defaultActiveKey:"1",items:r})]})}const Zs=(e,r)=>{let s=0,n=0,a=0,i=0,o=0,c=0,u=0,h=0;r.forEach(({attributes:j})=>{if(j[e.id]){s++;const S=j[e.id];S===10?n++:S===5?a++:S===0||!S?i++:S===-1?o++:S===-3?c++:S===-10&&u++,S>0&&h++}});const l=r.length,d=s/l*100,x=n/l*100,v=a/l*100,g=i/l*100,f=o/l*100,I=c/l*100,b=u/l*100,T=h/l*100;return{completionPercentage:d.toFixed(1),tensPercentage:x.toFixed(1),fivesPercentage:v.toFixed(1),zerosPercentage:g.toFixed(1),negativeOnesPercentage:f.toFixed(1),negativeThreesPercentage:I.toFixed(1),negativeTensPercentage:b.toFixed(1),positivePercentage:T.toFixed(1)}};function le({type:e}){const{availableItemIds:r,getItemAttributeValues:s,attributesList:n}=U(),a=Wt(),{is:i}=Ve(),o=p.useMemo(()=>{const l=new Array(65).fill(0).map((x,v)=>v),d=n.map(x=>x.spriteId);return l.filter(x=>!d.includes(`sign-${x}`))},[n]),c=p.useMemo(()=>e==="default"?n.filter(l=>l.default):e==="custom"?n.filter(l=>!l.default):e==="limited"?n.filter(l=>l.limited):e==="specific"?n.filter(l=>l.specific):e==="opposite"?n.filter(l=>l.oppositeId):n,[n,e]),u=p.useMemo(()=>{const l=r.map(d=>s(d));return c.map(d=>({...d,...Zs(d,l)}))},[c,r,s]),h=[{title:"Attribute",dataIndex:"name",key:"name",render:(l,d)=>t.jsxs(P,{align:"center",gap:8,children:[i("showGlyphs")&&t.jsx(Z,{id:d.spriteId,width:30}),l.en,d.default&&t.jsx(he,{className:"ml-1",children:"default"}),d.limited&&t.jsx(he,{className:"ml-1",children:"limited"}),(d.specific||d.parentId)&&t.jsx(he,{className:"ml-1",children:"specific"}),d.oppositeId&&t.jsx(he,{className:"ml-1",children:t.jsx(Qt,{})}),t.jsx(vt,{title:d.description.en})]}),sorter:(l,d)=>l.name.en.localeCompare(d.name.en)},{title:t.jsx(Ir,{}),dataIndex:"spriteId",key:"spriteId",render:l=>t.jsx(Z,{id:l,width:18,padding:0})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(l,d)=>l.priority-d.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.positivePercentage)-Number.parseFloat(d.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(l,d)=>d.limited?"-":`${l}%`,sorter:(l,d)=>Number.parseFloat(l.tensPercentage)-Number.parseFloat(d.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.fivesPercentage)-Number.parseFloat(d.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.negativeOnesPercentage)-Number.parseFloat(d.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.negativeThreesPercentage)-Number.parseFloat(d.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:l=>`${l}%`,sorter:(l,d)=>Number.parseFloat(l.negativeTensPercentage)-Number.parseFloat(d.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:l=>t.jsx(ct,{percent:Number.parseFloat(l),size:"small"}),sorter:(l,d)=>Number.parseFloat(l.completionPercentage)-Number.parseFloat(d.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:l=>t.jsx(Cr,{count:4,value:l,disabled:!0}),sorter:(l,d)=>l.level-d.level},{title:"Actions",key:"actions",render:l=>t.jsx(W,{children:t.jsxs(R.Group,{children:[t.jsx(R,{size:"small",shape:"round",onClick:()=>a(`/items/attribution?view=grouping&attribute=${l.id}&page=1`),children:"Grouping"}),t.jsx(R,{size:"small",shape:"round",onClick:()=>a(`/items/attribution?view=sampler&attribute=${l.id}&size=6`),children:"Sample"})]})})}];return t.jsxs(t.Fragment,{children:[t.jsxs(D.Paragraph,{children:["Total: ",u.length]}),t.jsx(ot,{columns:h,dataSource:u,pagination:!1,rowKey:"id",size:"small"}),t.jsx(P,{wrap:"wrap",gap:8,children:o.map(l=>t.jsxs("div",{children:["#",l,t.jsx(Z,{id:`sign-${l}`},l)]},l))})]})}function Js(e){const r=C.cloneDeep(e);return Fe(it(r),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function en(){const{view:e}=F();return e==="classifier"?t.jsxs(t.Fragment,{children:[t.jsxs(P,{className:"my-4",gap:8,children:[t.jsx(Us,{}),t.jsx(Fs,{}),t.jsx(Vs,{})]}),t.jsx(Ds,{}),t.jsx(P,{justify:"flex-end",className:"my-4",children:t.jsx(xt,{})})]}):e==="sampler"?t.jsx(Qs,{}):e==="grouping"?t.jsx(Ws,{}):e==="comparator"?t.jsx(_s,{}):e==="simulator"?t.jsx(qs,{}):e==="stats"?t.jsx(Ys,{}):t.jsx(ve,{className:"my-10",description:"Unknown view has been selected"})}function tn(){const{isLoading:e,error:r,hasResponseData:s}=U();return t.jsx(Kt,{title:"Items",subtitle:"Attribution",children:t.jsxs(Ge,{hasSider:!0,children:[t.jsx(ar,{children:t.jsx($s,{})}),t.jsx(Ge.Content,{className:"content",children:t.jsx(Xt,{isLoading:e,error:r,hasResponseData:s,children:t.jsx(en,{})})})]})})}function ni(){return t.jsx(Ss,{children:t.jsx(tn,{})})}export{ni as default};
