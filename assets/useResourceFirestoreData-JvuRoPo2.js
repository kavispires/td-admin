import{i as Q,u as $,r as g}from"./index-Bl1jfJHn.js";import{l as u}from"./useBaseUrl-Dk0cVXCz.js";import{j as h,k as x}from"./index-C8-I1wI_.js";import{u as L}from"./useGetFirestoreDoc-CLYR9ssq.js";import{u as M}from"./useTDResource-DMA8QwN5.js";import{u as P}from"./useUpdateFirestoreDoc-SeBKhASe.js";function l({tdrResourceName:o,firestoreDataCollectionName:e,serialize:n,deserializer:a}){const{notification:d}=Q.useApp(),m=$(),t=M(o,{select:a||void 0}),s=L("tdr",e,{select:n?h:void 0}),[r,p]=g.useState({}),i=P("tdr",e,{onSuccess:()=>{d.success({title:`${e} updated`}),m.refetchQueries({queryKey:["firestore","tdr",e]}),p({})},onError:c=>{d.error({title:`${e} update failed`,description:c.message})}}),y=g.useMemo(()=>!t.isSuccess||!s.isSuccess||i.isPending?{}:(console.log(`%cMerging ${o}+${e} data...`,"color: #f0f"),u.cloneDeep({...t.data??{},...s.data??{},...r})),[o,e,t.data,s.data,t.isSuccess,s.isSuccess,i.isPending,r]),S=!u.isEmpty(r),E=(c,v)=>{p(D=>({...D,[c]:v}))},f=s.data,F=()=>{i.mutate(n?x(r):r)};return{data:y,isLoading:t.isLoading||s.isLoading,isSuccess:t.isSuccess&&s.isSuccess,error:t.error||s.error,firestoreData:f,hasFirestoreData:!u.isEmpty(f),isSaving:i.isPending,save:F,addEntryToUpdate:E,entriesToUpdate:r,isDirty:S}}export{l as u};
