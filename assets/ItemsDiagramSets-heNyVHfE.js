import{m as A,n as be,o as J,p as V,q as je,K as pe,t as B,v as Re,w as De,x as Ce,y as Fe,z as _e,E as Ve,G as ze,H as Be,r as g,J as Le,M as ie,N as Ke,O as We,Q as F,S as Ge,U as He,V as Ue,W as qe,X as Je,Y as Qe,Z as Xe,$ as fe,a0 as Ye,a1 as xe,j as t,F as X,D as L,T as I,c as O,a2 as Ze,b as Z,B as Q,a3 as ce,i as et,a4 as tt,P as at,L as ge}from"./index-CJP1NcLY.js";import{D as Ie}from"./DataLoadingWrapper-DG7QZDr8.js";import{F as nt}from"./FilterEntries-0lyMFttp.js";import{S as st}from"./SiderContent-Bm9ZHBWB.js";import{D as lt}from"./DownloadButton-CcWgRP_u.js";import{a as it}from"./FirestoreConsoleLink-C5jD8xRh.js";import{S as rt}from"./SaveButton-DJ3uvymx.js";import{u as ue}from"./useQueryParams-BFtarVaT.js";import{u as re}from"./useTDResource-BAk1Iz0J.js";import{l as Y,c as le,P as ot}from"./useBaseUrl-7hhyaw6U.js";import{a as dt,w as oe}from"./index-BGplYY1j.js";import{v as K,s as ee,a as te,b as Se,S as $e,c as ve}from"./daily-teoria-de-conjuntos-DzzqPGmt.js";import{R as ct}from"./ClusterOutlined-BR62UKqZ.js";import{R as ut}from"./TableOutlined-B3FjYn-O.js";import{R as mt}from"./RobotOutlined-CBEUKBu6.js";import{I as we}from"./Item-BmBIjVkR.js";import{R as H}from"./index-BawPSGCN.js";import{A as ht}from"./index-DKQcwuD3.js";import{S as de}from"./index-BNGPopnc.js";import{T as U}from"./TransparentButton-DhuVniSO.js";import{S as D}from"./index-XI8Y8BcL.js";import{R as Ne}from"./index-BokhNBZs.js";import{u as Te}from"./useTablePagination-C5o5ED--.js";import{T as _}from"./index-tfExDKbJ.js";import{F as Ae}from"./Table-BUUixokD.js";import{u as pt}from"./useResourceFirestoreData-s8VEI4RV.js";import"./index-BtkknYjo.js";import"./index-ByZ5NuP2.js";import"./useMutation-D3ZmfJLK.js";import"./index-CqVlIwge.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-9t_KF9k8.js";import"./constants-Cc6Kx7Tc.js";import"./useParsedHistory-ClXvkHJQ.js";import"./throttleByAnimationFrame-BwJVNFl1.js";import"./index--R1wWL3p.js";import"./scrollTo-CuTGOS2w.js";import"./Pagination-cpBm3MlS.js";import"./useGetFirestoreDoc-C_u6buBo.js";import"./useUpdateFirestoreDoc-Dr4NdarP.js";var Pe=A.forwardRef(function(e,a){var o=e.prefixCls,i=e.forceRender,s=e.className,c=e.style,p=e.children,d=e.isActive,h=e.role,u=e.classNames,y=e.styles,n=A.useState(d||i),m=be(n,2),r=m[0],l=m[1];return A.useEffect(function(){(i||d)&&l(!0)},[i,d]),r?A.createElement("div",{ref:a,className:J("".concat(o,"-content"),V(V({},"".concat(o,"-content-active"),d),"".concat(o,"-content-inactive"),!d),s),style:c,role:h},A.createElement("div",{className:J("".concat(o,"-content-box"),u?.body),style:y?.body},p)):null});Pe.displayName="PanelContent";var ft=["showArrow","headerClass","isActive","onItemClick","forceRender","className","classNames","styles","prefixCls","collapsible","accordion","panelKey","extra","header","expandIcon","openMotion","destroyInactivePanel","children"],ke=A.forwardRef(function(e,a){var o=e.showArrow,i=o===void 0?!0:o,s=e.headerClass,c=e.isActive,p=e.onItemClick,d=e.forceRender,h=e.className,u=e.classNames,y=u===void 0?{}:u,n=e.styles,m=n===void 0?{}:n,r=e.prefixCls,l=e.collapsible,x=e.accordion,j=e.panelKey,C=e.extra,S=e.header,$=e.expandIcon,b=e.openMotion,P=e.destroyInactivePanel,w=e.children,k=je(e,ft),N=l==="disabled",f=C!=null&&typeof C!="boolean",v=V(V(V({onClick:function(){p?.(j)},onKeyDown:function(R){(R.key==="Enter"||R.keyCode===pe.ENTER||R.which===pe.ENTER)&&p?.(j)},role:x?"tab":"button"},"aria-expanded",c),"aria-disabled",N),"tabIndex",N?-1:0),T=typeof $=="function"?$(e):A.createElement("i",{className:"arrow"}),W=T&&A.createElement("div",B({className:"".concat(r,"-expand-icon")},["header","icon"].includes(l)?v:{}),T),ne=J("".concat(r,"-item"),V(V({},"".concat(r,"-item-active"),c),"".concat(r,"-item-disabled"),N),h),se=J(s,"".concat(r,"-header"),V({},"".concat(r,"-collapsible-").concat(l),!!l),y.header),E=Re({className:se,style:m.header},["header","icon"].includes(l)?{}:v);return A.createElement("div",B({},k,{ref:a,className:ne}),A.createElement("div",E,i&&W,A.createElement("span",B({className:"".concat(r,"-header-text")},l==="header"?v:{}),S),f&&A.createElement("div",{className:"".concat(r,"-extra")},C)),A.createElement(De,B({visible:c,leavedClassName:"".concat(r,"-content-hidden")},b,{forceRender:d,removeOnLeave:P}),function(M,R){var G=M.className,z=M.style;return A.createElement(Pe,{ref:R,prefixCls:r,className:G,classNames:y,style:z,styles:m,isActive:c,forceRender:d,role:x?"tabpanel":void 0},w)}))}),xt=["children","label","key","collapsible","onItemClick","destroyInactivePanel"],gt=function(a,o){var i=o.prefixCls,s=o.accordion,c=o.collapsible,p=o.destroyInactivePanel,d=o.onItemClick,h=o.activeKey,u=o.openMotion,y=o.expandIcon;return a.map(function(n,m){var r=n.children,l=n.label,x=n.key,j=n.collapsible,C=n.onItemClick,S=n.destroyInactivePanel,$=je(n,xt),b=String(x??m),P=j??c,w=S??p,k=function(v){P!=="disabled"&&(d(v),C?.(v))},N=!1;return s?N=h[0]===b:N=h.indexOf(b)>-1,A.createElement(ke,B({},$,{prefixCls:i,key:b,panelKey:b,isActive:N,accordion:s,openMotion:u,expandIcon:y,header:l,collapsible:P,onItemClick:k,destroyInactivePanel:w}),r)})},vt=function(a,o,i){if(!a)return null;var s=i.prefixCls,c=i.accordion,p=i.collapsible,d=i.destroyInactivePanel,h=i.onItemClick,u=i.activeKey,y=i.openMotion,n=i.expandIcon,m=a.key||String(o),r=a.props,l=r.header,x=r.headerClass,j=r.destroyInactivePanel,C=r.collapsible,S=r.onItemClick,$=!1;c?$=u[0]===m:$=u.indexOf(m)>-1;var b=C??p,P=function(N){b!=="disabled"&&(h(N),S?.(N))},w={key:m,panelKey:m,header:l,headerClass:x,isActive:$,prefixCls:s,destroyInactivePanel:j??d,openMotion:y,accordion:c,children:a.props.children,onItemClick:P,expandIcon:n,collapsible:b};return typeof a.type=="string"?a:(Object.keys(w).forEach(function(k){typeof w[k]>"u"&&delete w[k]}),A.cloneElement(a,w))};function yt(e,a,o){return Array.isArray(e)?gt(e,o):Ce(a).map(function(i,s){return vt(i,s,o)})}function bt(e){var a=e;if(!Array.isArray(a)){var o=ze(a);a=o==="number"||o==="string"?[a]:[]}return a.map(function(i){return String(i)})}var jt=A.forwardRef(function(e,a){var o=e.prefixCls,i=o===void 0?"rc-collapse":o,s=e.destroyInactivePanel,c=s===void 0?!1:s,p=e.style,d=e.accordion,h=e.className,u=e.children,y=e.collapsible,n=e.openMotion,m=e.expandIcon,r=e.activeKey,l=e.defaultActiveKey,x=e.onChange,j=e.items,C=J(i,h),S=Fe([],{value:r,onChange:function(f){return x?.(f)},defaultValue:l,postState:bt}),$=be(S,2),b=$[0],P=$[1],w=function(f){return P(function(){if(d)return b[0]===f?[]:[f];var v=b.indexOf(f),T=v>-1;return T?b.filter(function(W){return W!==f}):[].concat(Be(b),[f])})};_e(!u,"[rc-collapse] `children` will be removed in next major version. Please use `items` instead.");var k=yt(j,u,{prefixCls:i,accordion:d,openMotion:n,expandIcon:m,collapsible:y,destroyInactivePanel:c,onItemClick:w,activeKey:b});return A.createElement("div",B({ref:a,className:C,style:p,role:d?"tablist":void 0},Ve(e,{aria:!0,data:!0})),k)});const me=Object.assign(jt,{Panel:ke});me.Panel;const Ct=g.forwardRef((e,a)=>{const{getPrefixCls:o}=g.useContext(Le),{prefixCls:i,className:s,showArrow:c=!0}=e,p=o("collapse",i),d=ie({[`${p}-no-arrow`]:!c},s);return g.createElement(me.Panel,Object.assign({ref:a},e,{prefixCls:p,className:d}))}),It=e=>{const{componentCls:a,contentBg:o,padding:i,headerBg:s,headerPadding:c,collapseHeaderPaddingSM:p,collapseHeaderPaddingLG:d,collapsePanelBorderRadius:h,lineWidth:u,lineType:y,colorBorder:n,colorText:m,colorTextHeading:r,colorTextDisabled:l,fontSizeLG:x,lineHeight:j,lineHeightLG:C,marginSM:S,paddingSM:$,paddingLG:b,paddingXS:P,motionDurationSlow:w,fontSizeIcon:k,contentPadding:N,fontHeight:f,fontHeightLG:v}=e,T=`${F(u)} ${y} ${n}`;return{[a]:Object.assign(Object.assign({},He(e)),{backgroundColor:s,border:T,borderRadius:h,"&-rtl":{direction:"rtl"},[`& > ${a}-item`]:{borderBottom:T,"&:first-child":{[`
            &,
            & > ${a}-header`]:{borderRadius:`${F(h)} ${F(h)} 0 0`}},"&:last-child":{[`
            &,
            & > ${a}-header`]:{borderRadius:`0 0 ${F(h)} ${F(h)}`}},[`> ${a}-header`]:Object.assign(Object.assign({position:"relative",display:"flex",flexWrap:"nowrap",alignItems:"flex-start",padding:c,color:r,lineHeight:j,cursor:"pointer",transition:`all ${w}, visibility 0s`},Ue(e)),{[`> ${a}-header-text`]:{flex:"auto"},[`${a}-expand-icon`]:{height:f,display:"flex",alignItems:"center",paddingInlineEnd:S},[`${a}-arrow`]:Object.assign(Object.assign({},qe()),{fontSize:k,transition:`transform ${w}`,svg:{transition:`transform ${w}`}}),[`${a}-header-text`]:{marginInlineEnd:"auto"}}),[`${a}-collapsible-header`]:{cursor:"default",[`${a}-header-text`]:{flex:"none",cursor:"pointer"},[`${a}-expand-icon`]:{cursor:"pointer"}},[`${a}-collapsible-icon`]:{cursor:"unset",[`${a}-expand-icon`]:{cursor:"pointer"}}},[`${a}-content`]:{color:m,backgroundColor:o,borderTop:T,[`& > ${a}-content-box`]:{padding:N},"&-hidden":{display:"none"}},"&-small":{[`> ${a}-item`]:{[`> ${a}-header`]:{padding:p,paddingInlineStart:P,[`> ${a}-expand-icon`]:{marginInlineStart:e.calc($).sub(P).equal()}},[`> ${a}-content > ${a}-content-box`]:{padding:$}}},"&-large":{[`> ${a}-item`]:{fontSize:x,lineHeight:C,[`> ${a}-header`]:{padding:d,paddingInlineStart:i,[`> ${a}-expand-icon`]:{height:v,marginInlineStart:e.calc(b).sub(i).equal()}},[`> ${a}-content > ${a}-content-box`]:{padding:b}}},[`${a}-item:last-child`]:{borderBottom:0,[`> ${a}-content`]:{borderRadius:`0 0 ${F(h)} ${F(h)}`}},[`& ${a}-item-disabled > ${a}-header`]:{"\n          &,\n          & > .arrow\n        ":{color:l,cursor:"not-allowed"}},[`&${a}-icon-position-end`]:{[`& > ${a}-item`]:{[`> ${a}-header`]:{[`${a}-expand-icon`]:{order:1,paddingInlineEnd:0,paddingInlineStart:S}}}}})}},St=e=>{const{componentCls:a}=e,o=`> ${a}-item > ${a}-header ${a}-arrow`;return{[`${a}-rtl`]:{[o]:{transform:"rotate(180deg)"}}}},$t=e=>{const{componentCls:a,headerBg:o,borderlessContentPadding:i,borderlessContentBg:s,colorBorder:c}=e;return{[`${a}-borderless`]:{backgroundColor:o,border:0,[`> ${a}-item`]:{borderBottom:`1px solid ${c}`},[`
        > ${a}-item:last-child,
        > ${a}-item:last-child ${a}-header
      `]:{borderRadius:0},[`> ${a}-item:last-child`]:{borderBottom:0},[`> ${a}-item > ${a}-content`]:{backgroundColor:s,borderTop:0},[`> ${a}-item > ${a}-content > ${a}-content-box`]:{padding:i}}}},wt=e=>{const{componentCls:a,paddingSM:o}=e;return{[`${a}-ghost`]:{backgroundColor:"transparent",border:0,[`> ${a}-item`]:{borderBottom:0,[`> ${a}-content`]:{backgroundColor:"transparent",border:0,[`> ${a}-content-box`]:{paddingBlock:o}}}}}},Nt=e=>({headerPadding:`${e.paddingSM}px ${e.padding}px`,headerBg:e.colorFillAlter,contentPadding:`${e.padding}px 16px`,contentBg:e.colorBgContainer,borderlessContentPadding:`${e.paddingXXS}px 16px ${e.padding}px`,borderlessContentBg:"transparent"}),Tt=Ke("Collapse",e=>{const a=We(e,{collapseHeaderPaddingSM:`${F(e.paddingXS)} ${F(e.paddingSM)}`,collapseHeaderPaddingLG:`${F(e.padding)} ${F(e.paddingLG)}`,collapsePanelBorderRadius:e.borderRadiusLG});return[It(a),$t(a),wt(a),St(a),Ge(a)]},Nt),At=g.forwardRef((e,a)=>{const{getPrefixCls:o,direction:i,expandIcon:s,className:c,style:p}=Je("collapse"),{prefixCls:d,className:h,rootClassName:u,style:y,bordered:n=!0,ghost:m,size:r,expandIconPosition:l="start",children:x,destroyInactivePanel:j,destroyOnHidden:C,expandIcon:S}=e,$=Qe(E=>{var M;return(M=r??E)!==null&&M!==void 0?M:"middle"}),b=o("collapse",d),P=o(),[w,k,N]=Tt(b),f=g.useMemo(()=>l==="left"?"start":l==="right"?"end":l,[l]),v=S??s,T=g.useCallback((E={})=>{const M=typeof v=="function"?v(E):g.createElement(Xe,{rotate:E.isActive?i==="rtl"?-90:90:void 0,"aria-label":E.isActive?"expanded":"collapsed"});return fe(M,()=>{var R;return{className:ie((R=M.props)===null||R===void 0?void 0:R.className,`${b}-arrow`)}})},[v,b,i]),W=ie(`${b}-icon-position-${f}`,{[`${b}-borderless`]:!n,[`${b}-rtl`]:i==="rtl",[`${b}-ghost`]:!!m,[`${b}-${$}`]:$!=="middle"},c,h,u,k,N),ne=g.useMemo(()=>Object.assign(Object.assign({},Ye(P)),{motionAppear:!1,leavedClassName:`${b}-content-hidden`}),[P,b]),se=g.useMemo(()=>x?Ce(x).map((E,M)=>{var R,G;const z=E.props;if(z?.disabled){const Ee=(R=E.key)!==null&&R!==void 0?R:String(M),Me=Object.assign(Object.assign({},xe(E.props,["disabled"])),{key:Ee,collapsible:(G=z.collapsible)!==null&&G!==void 0?G:"disabled"});return fe(E,Me)}return E}):null,[x]);return w(g.createElement(me,Object.assign({ref:a,openMotion:ne},xe(e,["rootClassName"]),{expandIcon:T,prefixCls:b,className:W,style:Object.assign(Object.assign({},p),y),destroyInactivePanel:C??j}),se))}),Pt=Object.assign(At,{Panel:Ct});function kt({data:e,save:a,isDirty:o,isSaving:i,entriesToUpdate:s,hasFirestoreData:c}){const{addParams:p,queryParams:d}=ue(),h=re("daily-diagram-rules");return t.jsxs(st,{children:[t.jsxs(X,{gap:12,vertical:!0,children:[t.jsx(rt,{dirt:JSON.stringify(s),isDirty:o,isSaving:i,onSave:a}),t.jsx(lt,{block:!0,data:()=>Ot(e,h.data??{}),disabled:o,fileName:"daily-diagram-items.json",hasNewData:c})]}),t.jsx(L,{}),t.jsx(nt,{label:"Display",onChange:u=>p({display:u,page:1},{page:1}),options:[{title:"By Rule",icon:t.jsx(ct,{}),value:"rule"},{title:"By Thing",icon:t.jsx(ut,{}),value:"thing"},{title:"Simulator",icon:t.jsx(mt,{}),value:"simulator"}],value:d.get("display")??"rule"}),t.jsx(L,{}),t.jsx(I.Paragraph,{className:"my-6",type:"secondary",children:"v2.1.0"}),t.jsx(it,{disabled:o,docId:"diagramItems",path:"tdr",queryKey:["tdr","diagramItems"]})]})}function Ot(e,a){console.log("Preparing file for download...");const o=Y.cloneDeep(e),i=Date.now();return Object.values(o).forEach(s=>{const c=Object.values(a).filter(u=>u.updatedAt>s.updatedAt),p=c.map(()=>!1),d=c.filter(u=>u.method==="auto");d.length>0&&(console.log(`Performing ${d.length} auto updates for ${s.name}`),s.rules=s.rules.filter(u=>!d.map(y=>y.id).includes(u)),d.forEach(u=>{K[u.id](s.name)&&s.rules.push(u.id);const n=c.findIndex(m=>m.id===u.id);n!==-1&&(p[n]=!0)}));const h=c.filter(u=>u.method==="dependency");if(h.length>0){console.log(`Performing ${h.length} dependency updates for ${s.name}`),s.rules=s.rules.filter(m=>!h.map(r=>r.id).includes(m));const u=s.rules.includes("ddr-51-pt"),y=s.syllables??"",n=s.stressedSyllable;h.forEach(m=>{if(ee[m.id]&&y){ee[m.id](s.name,y,u)&&s.rules.push(m.id);const l=c.findIndex(x=>x.id===m.id);l!==-1&&(p[l]=!0)}if(te[m.id]&&y&&n!==void 0){te[m.id](s.name,y,n)&&s.rules.push(m.id);const l=c.findIndex(x=>x.id===m.id);l!==-1&&(p[l]=!0)}})}p.every(Boolean)&&(console.log(`All auto and dependency rules updated for ${s.name}`),s.updatedAt=i)}),dt(o)}function he({isModalOpen:e,onSaveThing:a,onCancel:o,thing:i,rules:s,width:c,itemAliases:p,subtitle:d,okButtonText:h,onGiveAnotherThing:u}){const y=g.useMemo(()=>Y.orderBy(Object.values(s),[f=>{const v=["manual","dependency","auto"].indexOf(f.method);return v===-1?Number.POSITIVE_INFINITY:v},f=>{const v=["grammar","comparison","order","count","contains","ends"].indexOf(f.type);return v===-1?Number.POSITIVE_INFINITY:v},f=>f.title.slice(0,7),f=>Number(f.id.split("-")[1])]),[s]),[n]=O.useForm(),m=O.useWatch([],n),r=!m||Object.values(m??{}).some(f=>f===void 0),l=O.useWatch("name",n);g.useEffect(()=>{if(!l||i.name&&i.syllables&&l===i.name)return;const f={syllables:Se(l),stressedSyllable:i.stressedSyllable??l.includes(" ")?-1:0};Object.keys(s).forEach(v=>{K[v]?f[v]=K[v](l):f[v]=i.rules.length>0?i.rules.includes(v):void 0}),n.setFieldsValue(f)},[l]);const x=O.useWatch("syllables",n),j=n.getFieldValue("ddr-51-pt");g.useEffect(()=>{j&&(n.setFieldsValue({stressedSyllable:void 0}),n.setFieldsValue({"ddr-43-pt":!1}),n.setFieldsValue({"ddr-44-pt":!1}),n.setFieldsValue({"ddr-45-pt":!1}),n.setFieldsValue({"ddr-46-pt":!1})),j===void 0&&n.setFieldsValue({"ddr-51-pt":!1})},[j]),g.useEffect(()=>{if(x){const f=Object.keys(s).reduce((v,T)=>(ee[T]&&(v[T]=ee[T](l,x,j)),v),{});n.setFieldsValue({...f,stressedSyllable:x===i.syllables?i.stressedSyllable:i.stressedSyllable??l.includes(" ")?-1:void 0})}},[l,x,j]);const C=O.useWatch("stressedSyllable",n);g.useEffect(()=>{if(!j&&C!==void 0){const f=Object.keys(s).reduce((v,T)=>(te[T]&&(v[T]=te[T](l,x,C)),v),{});n.setFieldsValue({...f})}},[C]);const S=n.getFieldValue("ddr-1-pt"),$=n.getFieldValue("ddr-2-pt"),b=n.getFieldValue("ddr-50-pt");g.useEffect(()=>{S===!0&&(n.setFieldsValue({"ddr-2-pt":!1}),n.setFieldsValue({"ddr-50-pt":!1}))},[S]),g.useEffect(()=>{$===!0&&(n.setFieldsValue({"ddr-1-pt":!1}),n.setFieldsValue({"ddr-50-pt":!1}))},[$]),g.useEffect(()=>{b===!0&&(n.setFieldsValue({"ddr-1-pt":!1}),n.setFieldsValue({"ddr-2-pt":!1}))},[b]);const P=n.getFieldValue("ddr-3-pt");g.useEffect(()=>{P===!0&&n.setFieldsValue({"ddr-4-pt":!1})},[P]);const w=n.getFieldValue("ddr-4-pt");g.useEffect(()=>{w===!0&&n.setFieldsValue({"ddr-3-pt":!1})},[w]),g.useEffect(()=>{l?.includes("-")&&n.setFieldsValue({"ddr-5-pt":!0})},[l]);const k=f=>{const v=Mt(f);a(v)},N=g.useMemo(()=>(x??"").split($e),[x]);return t.jsx(Ze,{maskClosable:!1,okButtonProps:{disabled:r,htmlType:"submit",size:"large"},okText:h??"Add Item",onCancel:o,onOk:n.submit,open:e,title:t.jsxs(t.Fragment,{children:["Edit ",i.name," ",d&&t.jsx("small",{children:d})]}),width:c,children:t.jsxs(O,{autoComplete:"off",form:n,initialValues:Et(i,s),labelWrap:!0,layout:"vertical",name:`new-item-${i.itemId}`,onFinish:k,size:"small",children:[t.jsxs("div",{className:"diagram-container",children:[t.jsx("div",{children:t.jsx(we,{itemId:i.itemId,width:50})}),t.jsx(O.Item,{label:"Name",name:"name",children:t.jsx(Z,{})}),t.jsx(O.Item,{label:"Item",name:"itemId",children:t.jsx(Z,{readOnly:!0})}),t.jsx(O.Item,{label:"Syllables",name:"syllables",children:t.jsx(Z,{})}),t.jsx(O.Item,{label:"Stressed Syllable",name:"stressedSyllable",children:t.jsx(H.Group,{buttonStyle:"solid",optionType:"button",children:N.map((f,v)=>t.jsx(H,{value:N.length-v-1,children:f},v))})}),t.jsx(O.Item,{label:"Updated At",name:"updatedAt",children:t.jsx(Z,{readOnly:!0,value:new Date(i.updatedAt).toLocaleString()})}),(p||u)&&t.jsxs("div",{children:[u&&t.jsx(Q,{className:"mt-2",onClick:u,size:"small",type:"dashed",children:"Give me another thing"}),p&&t.jsxs("span",{children:["Options: ",p?.join(", ")]})]}),t.jsx("div",{children:t.jsx(ht,{offsetTop:50,children:t.jsx(X,{align:"center",justify:"center",children:t.jsx(Q,{disabled:r,htmlType:"submit",size:"large",type:"primary",children:h??"Add Item"})})})})]}),t.jsx("div",{className:"diagram-container",children:y.map(f=>f.method==="auto"&&K[f.id]?t.jsx(O.Item,{className:le(i.updatedAt<f.updatedAt&&"diagram-container__outdated-rule"),label:f.title,name:f.id,valuePropName:"checked",children:t.jsx(de,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},f.id):f.method==="dependency"?t.jsx(O.Item,{className:le(i.updatedAt<f.updatedAt&&"diagram-container__outdated-rule"),label:f.title,name:f.id,valuePropName:"checked",children:t.jsx(de,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},f.id):t.jsx(O.Item,{className:le(i.updatedAt<f.updatedAt&&"diagram-container__outdated-rule"),label:f.title,name:f.id,children:t.jsxs(H.Group,{buttonStyle:"solid",optionType:"button",children:[t.jsx(H,{value:!0,children:"✅"}),t.jsx(H,{value:!1,children:"❌"})]})},f.id))})]})})}const Et=(e,a)=>{let o=!1;return{name:e.name,itemId:e.itemId,syllables:e.syllables??Se(e.name),stressedSyllable:e.stressedSyllable??0,...Object.keys(a).reduce((i,s)=>{if(e.updatedAt<a[s].updatedAt)if(K[s]){const c=K[s](e.name);c&&e.rules.includes(s)&&(o=!0),i[s]=c}else i[s]=void 0;else i[s]=e.rules.includes(s);return i},{}),updatedAt:o?Date.now():e.updatedAt}},Mt=e=>{const{itemId:a,name:o,syllables:i,stressedSyllable:s,...c}=e;return{itemId:a,name:o,updatedAt:Date.now(),syllables:i,stressedSyllable:s,rules:Object.keys(c).filter(p=>c[p]===!0)}};function q({itemId:e,name:a,width:o=50}){return t.jsxs(X,{align:"center",vertical:!0,children:[t.jsx(we,{itemId:e,width:o}),t.jsx(I.Text,{code:!0,children:a},e)]})}function ae({thing:e,width:a=50,onActivateThing:o}){return t.jsx(U,{onClick:()=>o(e),children:t.jsx(q,{itemId:e.itemId,name:e.name,width:a})})}function Rt({game:e}){const[a]=g.useState([{id:e.rule1.thing.id,name:e.rule1.thing.name,rule:1}]),[o]=g.useState([{id:e.rule2.thing.id,name:e.rule2.thing.name,rule:2}]),[i]=g.useState([{id:e.intersectingThing.id,name:e.intersectingThing.name,rule:0}]),[s]=g.useState(e.things.slice(0,4)),[c,p]=g.useState(e.things[0]);return t.jsxs(D,{align:"center",direction:"vertical",children:[t.jsx(I.Title,{level:4,children:"Game Sample"}),t.jsxs(I.Title,{level:5,children:['"',e.title,'"']}),t.jsx(Ne,{count:e.level,disabled:!0,value:e.level}),t.jsx(I.Paragraph,{style:{maxWidth:"500px"},children:"O círculo amarelo tem uma regra gramatical secreta e o circulo vermelho tem outra regra gramatical secreta. O quadrado do meio representa a interseção entre a regra amarela e a regra vermelha."}),t.jsx(D,{children:t.jsx(Dt,{intersectionChildren:t.jsx(U,{style:{width:"100%",height:"100%"},children:i.map((d,h,u)=>t.jsx(q,{itemId:d.id,name:d.name,width:h===u.length-1?80:60},d.id))}),leftCircleChildren:t.jsx(U,{style:{width:"100%",height:"100%"},children:a.map((d,h,u)=>t.jsx(q,{itemId:d.id,name:d.name,width:h===u.length-1?80:60},d.id))}),rightCircleChildren:t.jsx(U,{style:{width:"100%",height:"100%"},children:o.map((d,h,u)=>t.jsx(q,{itemId:d.id,name:d.name,width:h===u.length-1?80:60},d.id))}),width:600})}),t.jsx(I.Text,{children:"Coloque os objetos nos círculos corretos:"}),t.jsx(D,{className:"space--center",children:s.map(d=>t.jsx(U,{onClick:()=>p(d),style:d.id===c?.id?{outline:"3px solid hotPink"}:{},children:t.jsx(q,{itemId:d.id,name:d.name},d.id)},d.id))}),t.jsx(Pt,{items:[{key:"1",label:"Resposta",children:t.jsxs(D,{direction:"vertical",children:[t.jsx(I.Text,{strong:!0,children:"Regra Amarela"}),t.jsx("ul",{children:t.jsx("li",{children:t.jsx(I.Text,{children:e.rule1.text})})}),t.jsx(I.Text,{strong:!0,children:"Regra Vermelha"}),t.jsx("ul",{children:t.jsx("li",{children:t.jsx(I.Text,{children:e.rule2.text})})})]})}]}),t.jsx("div",{style:{height:"200px"}})]})}function Dt({leftCircleChildren:e,rightCircleChildren:a,intersectionChildren:o,...i}){return t.jsxs("svg",{viewBox:"0 0 760 500",xmlns:"http://www.w3.org/2000/svg",...i,children:[t.jsx("path",{d:"M252.78 3.5c-136.42 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.59-247-247-247zm.99 483.07C123.39 486.57 17.7 380.88 17.7 250.5S123.39 14.43 253.77 14.43 489.84 120.12 489.84 250.5 384.15 486.57 253.77 486.57z",fill:"#fbb03b",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),t.jsx("path",{d:"M508.22 3.5c-136.41 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.58-247-247-247zm.99 483.07c-130.38 0-236.07-105.69-236.07-236.07S378.84 14.43 509.22 14.43 745.29 120.12 745.29 250.5 639.6 486.57 509.22 486.57z",fill:"#f15a24",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),t.jsx("path",{d:"M487.34 250.5c0-62.39-24.29-121.04-68.41-165.16a235.9 235.9 0 00-37.43-30.47 235.35 235.35 0 00-37.43 30.47c-44.12 44.11-68.41 102.77-68.41 165.16s24.29 121.04 68.41 165.16a235.9 235.9 0 0037.43 30.47 235.35 235.35 0 0037.43-30.47c44.12-44.11 68.41-102.77 68.41-165.16z",fill:"#535353"}),t.jsx("path",{d:"M258.72 250.5c0-66.64 25.95-129.3 73.08-176.42a253.125 253.125 0 0134.1-28.57c-33.98-18.65-72.29-28.57-112.13-28.57-62.39 0-121.04 24.29-165.16 68.41C44.5 129.46 20.2 188.11 20.2 250.5s24.29 121.04 68.41 165.16c44.11 44.12 102.77 68.41 165.16 68.41 39.84 0 78.15-9.92 112.13-28.57a252.507 252.507 0 01-34.1-28.57c-47.12-47.12-73.08-109.78-73.08-176.42zM674.37 85.34C630.25 41.22 571.6 16.93 509.21 16.93c-40.27 0-78.98 10.14-113.24 29.18 11.74 8.26 22.86 17.6 33.22 27.96 47.12 47.12 73.08 109.78 73.08 176.42s-25.95 129.3-73.08 176.42a252.312 252.312 0 01-33.22 27.96c34.25 19.04 72.96 29.18 113.24 29.18 62.39 0 121.04-24.29 165.16-68.41 44.12-44.11 68.41-102.77 68.41-165.16s-24.29-121.04-68.41-165.16z",fill:"#535353"}),t.jsx("foreignObject",{height:"450",width:"250",x:"30",y:"25",children:t.jsx("div",{className:"venn-diagram__circle-content-left",children:e})}),t.jsx("foreignObject",{height:"450",width:"250",x:"480",y:"25",children:t.jsx("div",{className:"venn-diagram__circle-content-right",children:a})}),t.jsx("foreignObject",{height:"370",width:"182",x:"290",y:"65",children:t.jsx("div",{className:"venn-diagram__circle-content-intersection",children:o})})]})}function Ft({things:e,rules:a}){const[o]=ce(),[i,s]=g.useState(null),c=()=>{s(Object.values(ve(1,{latestDate:"2023/01/01",latestNumber:0,used:[]},a,e))[0])},p=()=>{let d=null;try{d=ve(25,{latestDate:"2023/01/01",latestNumber:0,used:[]},a,e),console.log(d)}catch(h){console.error(h)}};return t.jsxs(D,{direction:"vertical",ref:o,children:[t.jsx(I.Title,{level:5,children:"Game Simulator"}),t.jsx(Q,{onClick:c,size:"large",children:"Simulate"}),t.jsx(Q,{onClick:p,size:"large",children:"Generate Demos (log)"}),i&&t.jsx(Rt,{game:i},JSON.stringify(i))]})}function _t({children:e,things:a,rules:o,addEntryToUpdate:i}){const s=g.useMemo(()=>Object.values(a).filter(h=>{if(!h.syllables)return!0;if(h.syllables.split($e).join("")!==h.name.replace(/\s/g,""))return console.log("❗️ Name and syllables do not match",h.name,h.syllables),!0;const u=Object.values(o).filter(n=>n.updatedAt>h.updatedAt);return u.filter(n=>n.method==="manual").length>0&&console.log("❗️ Thing has auto updates that will be performed automatically upon downloading the JSON"),u.some(n=>n.method==="manual")}),[a,o]),[c,p]=g.useState(null);g.useEffect(()=>{const h=async u=>{console.log("Found things that need to update..."),p(null),await oe(250),s.length>0&&p(s[0])};console.count("Checking for things that need to update..."),s.length>0&&h(s[0])},[s]);const d=h=>{i(h.itemId,h)};return t.jsxs(t.Fragment,{children:[c&&t.jsx(he,{isModalOpen:c!==null,okButtonText:"Update",onCancel:()=>p(null),onSaveThing:d,rules:o,subtitle:`(${s.length} left to update)`,thing:c,width:"90vw"}),e]})}function Oe({addEntryToUpdate:e,availableThings:a,rules:o,width:i}){const{notification:s}=et.useApp(),[c,p]=g.useState(null),[d,h]=g.useState({}),u=()=>{const r=Y.sample(a.filter(l=>!d[l.id]));r?(h(l=>({...l,[r.id]:!0})),p({itemId:r.id,name:Vt(r),updatedAt:Date.now(),syllables:"",stressedSyllable:0,rules:[]})):p(null)},y=g.useMemo(()=>{if(!c)return[];const r=a.find(l=>l.id===c.itemId);return[r?.name.pt,...r?.aliasesPt??[]].filter(Boolean)},[c,a]),n=async r=>{c&&((!r.name||!r.itemId)&&s.error({message:"Name and Item ID are required"}),e(r.itemId,r),console.log("COMPLETED SAVE"),p(null),await oe(250),u())},m=async()=>{p(null),await oe(100),u()};return t.jsxs(t.Fragment,{children:[t.jsx(Q,{onClick:u,size:"large",children:"Classify New Item"}),!!c&&t.jsx(he,{isModalOpen:c!==null,itemAliases:y,onCancel:()=>p(null),onGiveAnotherThing:m,onSaveThing:n,rules:o,thing:c,width:i*.9})]})}const Vt=e=>e.name.pt.split(" ").length===1?e.name.pt:e.aliasesPt?e.aliasesPt.find(a=>a.split(" ").length===1)??e.name.pt:e.name.pt;function zt({things:e,addEntryToUpdate:a,availableThings:o,rules:i,setActiveThing:s}){const[c,{width:p}]=ce(),d=g.useMemo(()=>Object.values(e),[e]),h=Te({total:d.length,showQuickJumper:!0}),u=[{title:"ItemId",dataIndex:"itemId",key:"itemId",sorter:(n,m)=>Number(n.itemId)-Number(m.itemId),render:n=>t.jsx(_,{children:n})},{title:"Name",dataIndex:"name",key:"name",sorter:(n,m)=>n.name.localeCompare(m.name),render:n=>t.jsx(I.Text,{children:n})},{title:"Sprite",dataIndex:"itemId",key:"sprite",render:n=>t.jsx(ae,{onActivateThing:s,thing:e[n]},`i-${n}`)},{title:"Rules",dataIndex:"rules",key:"rules",render:(n,m)=>t.jsx(D,{wrap:!0,children:n.map(r=>t.jsx(tt,{title:i[r].title,children:t.jsx(_,{color:i[r].updatedAt>m.updatedAt?"red":void 0,children:r})},r))})},{title:"Count",dataIndex:"rules",key:"count",sorter:(n,m)=>n.rules.length-m.rules.length,render:n=>n.length}],y=g.useMemo(()=>{const n={};return Object.values(e).forEach(m=>{n[m.name]||(n[m.name]=[]),n[m.name].push(m.itemId)}),Object.values(n).filter(m=>m.length>1)},[e]);return t.jsxs(D,{direction:"vertical",ref:c,children:[t.jsxs(I.Title,{level:5,children:["Rules By Items ",t.jsx(L,{type:"vertical"})," Added: ",t.jsx(_,{children:Object.keys(e).length})," Available to add ",t.jsx(_,{children:o.length})]}),t.jsx(Oe,{addEntryToUpdate:a,availableThings:o,rules:i,width:p}),t.jsx(L,{}),t.jsx(Ae,{columns:u,dataSource:d,pagination:h,rowKey:"itemId"}),t.jsx(L,{}),t.jsx(I.Title,{level:5,children:"Duplicated Things"}),t.jsxs(D,{wrap:!0,children:[y.length===0&&t.jsx(I.Text,{children:"No duplicated things"}),y.map(n=>t.jsxs(X,{align:"center",children:[t.jsx(_,{color:"red",children:n.length}),n.map(m=>t.jsx(ae,{onActivateThing:s,thing:e[m]},`i-${m}`))]},n[0]))]})]})}function Bt({things:e,addEntryToUpdate:a,availableThings:o,rules:i,thingsByRules:s,setActiveThing:c,containerWidth:p}){const{is:d,addParam:h}=ue(),u=g.useMemo(()=>Object.values(i).map(r=>({...r,thingsCount:s[r.id].length})),[i,s]),y=Te({total:u.length,showQuickJumper:!0}),n=g.useMemo(()=>{const r=Object.values(s).map(l=>l.length);return{maxThings:Math.max(...r),minThings:Math.min(...r),averageThings:Math.round(Object.values(s).reduce((l,x)=>l+x.length,0)/Object.keys(s).length)}},[s]),m=[{title:"Id",dataIndex:"id",key:"id",sorter:(r,l)=>Number(r.id.split("-")[1])-Number(l.id.split("-")[1]),render:r=>t.jsx(I.Text,{children:r})},{title:"Rule",dataIndex:"title",key:"title",sorter:(r,l)=>r.title.localeCompare(l.title),render:r=>t.jsx(I.Text,{children:r})},{title:"Type",dataIndex:"type",key:"type",sorter:(r,l)=>r.type.localeCompare(l.type)},{title:"Method",dataIndex:"method",key:"method",sorter:(r,l)=>r.method.localeCompare(l.method)},{title:"Things",dataIndex:"thingsCount",key:"thingsCount",render:(r,l)=>t.jsxs(D,{size:"small",children:[t.jsx(_,{children:r}),d("showThings")?t.jsxs(D,{size:"small",wrap:!0,children:[s[l.id].slice(0,20).map(x=>t.jsx(ae,{onActivateThing:c,thing:e[x]},`${l.id}-${x}`)),s[l.id].length>20&&t.jsxs(I.Text,{children:["+",r-20," more"]})]}):t.jsxs(D,{size:"small",wrap:!0,children:[s[l.id].slice(0,5).map(x=>t.jsx(ae,{onActivateThing:c,thing:e[x]},`${l.id}-${x}`)),s[l.id].length>5&&t.jsxs(I.Text,{children:["+",r-5," more"]})]})]}),sorter:(r,l)=>r.thingsCount-l.thingsCount},{title:"Level",dataIndex:"level",key:"level",sorter:(r,l)=>r.level-l.level,render:r=>t.jsx(Ne,{count:3,disabled:!0,value:r})}];return t.jsxs(D,{direction:"vertical",children:[t.jsxs(I.Title,{level:4,children:["Things By Rule (Added: ",Object.keys(e).length," | ",o.length,")"," "]}),t.jsxs(D,{split:t.jsx(L,{type:"vertical"}),wrap:!0,children:[t.jsx(Oe,{addEntryToUpdate:a,availableThings:o,rules:i,width:p}),t.jsxs(I.Text,{strong:!0,children:["Average Things: ",t.jsx(_,{children:n.averageThings})]}),t.jsxs(I.Text,{strong:!0,children:["Max Things: ",t.jsx(_,{children:n.maxThings})]}),t.jsxs(I.Text,{strong:!0,children:["Min Things: ",t.jsx(_,{children:n.minThings})]}),t.jsx(de,{checked:d("showThings"),checkedChildren:"Hide things",onChange:r=>h("showThings",r),unCheckedChildren:"Show things"})]}),t.jsx(Ae,{columns:m,dataSource:u,pagination:y})]})}const ye=e=>{const a=e.filter(o=>o.split(" ").length===1);return a.length>0?a[0]:""};function Lt({data:e,addEntryToUpdate:a}){const[o,{width:i}]=ce(),s=re("items"),c=re("daily-diagram-rules"),p=g.useMemo(()=>Object.values(s.data??{}).filter(l=>{if(e&&e[l.id]!==void 0||l.nsfw)return!1;const x=l.name.pt.split(" ").length===1;return!!(l.decks?.includes("thing")||l.decks?.includes("alien")&&x||l.decks?.includes("manufactured")&&x||l.decks?.includes("alien")&&l.aliasesPt&&ye(l.aliasesPt)||l.decks?.includes("manufactured")&&l.aliasesPt&&ye(l.aliasesPt)||l.decks?.includes("meta")&&x)}),[e,s.data]),d=g.useMemo(()=>c.data??{},[c.data]),h=g.useMemo(()=>{const l=Object.values(d).reduce((x,j)=>(x[j.id]=[],x),{});return Y.orderBy(Object.values(e),["updatedAt"],["desc"]).forEach(x=>{x.rules.forEach(j=>{l[j].push(x.itemId)})}),l},[e,d]),{is:u,queryParams:y}=ue(),[n,m]=g.useState(null);if(s.isLoading||c.isLoading)return t.jsx(I.Text,{children:"Loading..."});const r=l=>{a(l.itemId,l)};return t.jsx(Ie,{hasResponseData:s.hasResponseData||c.hasResponseData,isLoading:s.isLoading||c.isLoading,children:t.jsx("div",{ref:o,children:t.jsxs(_t,{addEntryToUpdate:a,rules:d,things:e,children:[n&&t.jsx(he,{isModalOpen:n!==null,okButtonText:"Update",onCancel:()=>m(null),onSaveThing:l=>{r(l),m(null)},rules:d,thing:n,width:i}),(u("display","rule")||!y.has("display"))&&t.jsx(Bt,{addEntryToUpdate:a,availableThings:p,containerWidth:i,rules:d,setActiveThing:m,things:e,thingsByRules:h}),u("display","thing")&&t.jsx(zt,{addEntryToUpdate:a,availableThings:p,rules:d,setActiveThing:m,things:e,thingsByRules:h}),u("display","simulator")&&t.jsx(Ft,{addEntryToUpdate:a,availableThings:p,rules:d,things:e})]})})})}function Aa(){const e=pt({tdrResourceName:"daily-diagram-items",firestoreDataCollectionName:"diagramItems",serialize:!0});return t.jsx(at,{subtitle:"Diagram Sets",title:"Items",children:t.jsxs(ge,{hasSider:!0,children:[t.jsx(ot,{children:t.jsx(kt,{...e})}),t.jsx(ge.Content,{className:"content",children:t.jsx(Ie,{error:e.error,hasResponseData:!Y.isEmpty(e.data),isLoading:e.isLoading||e.isSaving,children:t.jsx(X,{gap:24,vertical:!0,children:t.jsx(Lt,{...e})})})})]})})}export{Aa as ItemsDiagramSets,Aa as default};
