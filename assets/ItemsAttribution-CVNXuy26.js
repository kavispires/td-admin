import{r as I,d as re,b6 as Ye,i as je,u as Je,j as e,T as V,F as E,D as _,B as P,c as We,b4 as Ze,o as Re,b7 as Oe,q as ce,m as ue,S as B,b8 as Xe,a$ as et,h as Ie,M as tt,A as st,b9 as rt,a7 as nt,P as it,L as Ae}from"./index-DTFVBFfK.js";import{D as at}from"./DataLoadingWrapper-AfAD5Or6.js";import{b as G,a as Z,c as Le,d as oe,T as ot}from"./FilterEntries-DnRExwmR.js";import{S as lt}from"./SiderContent-DMHsDpiE.js";import{D as De,R as ct}from"./DownloadButton-B5N81On_.js";import{a as ut,F as dt}from"./FirestoreConsoleLink-DQ3J25sf.js";import{S as mt}from"./SaveButton-aj_MRLuF.js";import{l as b,E as se,P as pt}from"./useBaseUrl-BXKykm9Q.js";import{e as M,b as w,f as gt,A as K}from"./constants-CuiKou0X.js";import{j as ht,k as ft,a as ve,i as Ue,w as bt,m as xt}from"./index-5_NcC2_B.js";import{u as jt}from"./useGetFirestoreDoc-pvlqtSeW.js";import{u as te}from"./useTDResource-CtzTqqUd.js";import{u as It}from"./useUpdateFirestoreDoc-DNoK3eu1.js";import{u as D}from"./useQueryParams-CSQSAZkt.js";import{T as ee}from"./index-CsIkBZYQ.js";import{R as vt}from"./VerticalAlignTopOutlined-nXKpcRag.js";import{a as H,I as Y,b as z,d as ne}from"./ItemBuildingBlocks-_a4pefGi.js";import{R as Te}from"./index-CqcX2UdF.js";import{I as Ce}from"./Item-C5hJ6z_V.js";import{P as Ve}from"./progress-Do6G1Mzz.js";import{R as Ee,u as yt}from"./useToggle-C2fSdbhS.js";import{C as Q}from"./index-DCOBqw0O.js";import{A as At}from"./index-D3m_3fu_.js";import{I as Tt}from"./ItemsTypeahead-Dj3uY_EG.js";import{R as Ct,a as Et,P as St}from"./Pagination-C72zuBhS.js";import{S as W}from"./index-DXm6RdKT.js";import{a as wt,F as Fe,R as Nt}from"./Table-BAIh0dVT.js";import{D as Pt}from"./index-DmoaC4Kr.js";import{S as Rt}from"./index-D1CfkU0f.js";import{P as Ot}from"./index-BEQxMZx0.js";import{T as Lt}from"./TransparentButton-DkSRW2ZK.js";import{T as Dt}from"./index-DlBUBJ-r.js";import{R as Ut}from"./SkinOutlined-DWYuCzMa.js";import{R as Vt}from"./index-DFXT9W8t.js";import"./index-Bnlp8zWQ.js";import"./PlusOutlined-Dg4BBZsT.js";import"./index-Ph3MC-q4.js";import"./index-U31pN1fu.js";import"./Dropdown-Cp-10CYh.js";import"./useMutation-BedPW6bx.js";import"./moment-B-YVwB4U.js";import"./SaveOutlined-aR-FBBRB.js";import"./LanguageFlag-Bzz53N4L.js";import"./useCopyToClipboardFunction-BCuwNE63.js";import"./IdcardOutlined-D6zUzIKn.js";import"./throttleByAnimationFrame-CrXO4eCR.js";import"./useDebounce-CMEBYqbK.js";import"./index-G7h3ViSM.js";import"./scrollTo-CsjTXzNU.js";var Ft={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"};function de(){return de=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},de.apply(this,arguments)}const Mt=(t,s)=>I.createElement(re,de({},t,{ref:s,icon:Ft})),Bt=I.forwardRef(Mt);var kt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};function me(){return me=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},me.apply(this,arguments)}const zt=(t,s)=>I.createElement(re,me({},t,{ref:s,icon:kt})),$t=I.forwardRef(zt);var _t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"};function pe(){return pe=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},pe.apply(this,arguments)}const Gt=(t,s)=>I.createElement(re,pe({},t,{ref:s,icon:_t})),qt=I.forwardRef(Gt);var Kt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512 265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512 267.1 157.9A7.95 7.95 0 00254 164z"}}]},name:"vertical-left",theme:"outlined"};function ge(){return ge=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ge.apply(this,arguments)}const Qt=(t,s)=>I.createElement(re,ge({},t,{ref:s,icon:Kt})),Ht=I.forwardRef(Qt);var Yt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"};function he(){return he=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},he.apply(this,arguments)}const Jt=(t,s)=>I.createElement(re,he({},t,{ref:s,icon:Yt})),Wt=I.forwardRef(Jt);var Zt=function(t,s){return Ye?window.matchMedia(t).matches:!1},Xt=function(t,s){var n=I.useState(Zt(t)),r=n[0],l=n[1];return I.useEffect(function(){var i=!0,o=window.matchMedia(t),c=function(){i&&l(!!o.matches)};return o.addEventListener("change",c),l(o.matches),function(){i=!1,o.removeEventListener("change",c)}},[t]),r};const Me={OPPOSITE:{value:-10,prefix:"^",name:"OPPOSITE",label:{en:"Opposite",pt:"Oposto"},prefixLabel:{en:"really not ",pt:"muito não "}},UNRELATED:{value:-3,prefix:"!",name:"UNRELATED",label:{en:"Unrelated",pt:"Desconexo"},prefixLabel:{en:"not ",pt:"não "}},UNCLEAR:{value:-1,prefix:"~",name:"UNCLEAR",label:{en:"Unclear",pt:"Incerto"},prefixLabel:{en:"sorta ",pt:"meio "}},RELATED:{value:5,prefix:"+",name:"RELATED",label:{en:"Related",pt:"Relacionado"},prefixLabel:{en:"",pt:""}},DETERMINISTIC:{value:10,prefix:"*",name:"DETERMINISTIC",label:{en:"Deterministic",pt:"Determinístico"},prefixLabel:{en:"very ",pt:"muito "}}};b.keyBy(Me,"prefix");const es=["*","^","+","~","!"],q={ATTRIBUTE_VALUE_DICT:Me,ATTRIBUTE_VALUE_PRIORITY:es},fe=(t={})=>b.cloneDeep(b.merge({id:"",name:{en:"",pt:""},groups:[],attributes:{}},t)),be=(t={})=>b.cloneDeep(b.merge({id:"",attributes:{}},t)),Be=(t,s,n)=>{const r=b.orderBy(Object.values(s),["priority","id"],["asc","asc"]).map(a=>a.id);function l(a,u){return b.orderBy(a,x=>r.indexOf(x),["asc"]).map(x=>`${u}${x}`)}const i=[],o=[],c=[],d=[],h=[];return Object.entries(t.attributes).forEach(([a,u])=>{if(s[a])switch(u){case w.OPPOSITE:i.push(a);break;case w.DETERMINISTIC:o.push(a);break;case w.RELATED:c.push(a);break;case w.UNRELATED:d.push(a);break;case w.UNCLEAR:h.push(a);break;default:h.push(a);break}}),[...l(i,M.OPPOSITE),...l(o,M.DETERMINISTIC),...l(c,M.RELATED),...l(d,M.UNRELATED),...l(h,M.UNCLEAR)]},ke=b.memoize(t=>{if(t.length===3)return{key:t,className:"",text:""};const s=t[0];return{key:t.slice(1,4),className:{[M.DETERMINISTIC]:"deterministic",[M.UNRELATED]:"unrelated",[M.UNCLEAR]:"unclear",[M.OPPOSITE]:"opposite"}[s],text:{[M.DETERMINISTIC]:"very",[M.UNRELATED]:"not",[M.UNCLEAR]:"maybe",[M.OPPOSITE]:"very not"}[s]}}),ze=(t,s,n)=>t.filter(r=>!(!s&&r.includes(M.UNCLEAR)||!n&&r.includes(M.UNRELATED)));function xe(t,s,n){const r=[];for(const[o,c]of Object.entries(t.attributes)){const d=s[o];if(d){const h=Object.values(q.ATTRIBUTE_VALUE_DICT).find(a=>a.value===c);h&&r.push({prefix:h.prefix,id:d.id,priority:d.priority})}}const l=b.sortBy(r,[o=>q.ATTRIBUTE_VALUE_PRIORITY.indexOf(o.prefix),o=>o.prefix===q.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix?-1:o.priority,["asc","asc"]]),i=n?.length?l.slice(0,n?.length):l;return n?.onlyRelevant?i.filter(o=>[q.ATTRIBUTE_VALUE_DICT.UNCLEAR.prefix,q.ATTRIBUTE_VALUE_DICT.UNRELATED.prefix].includes(o.prefix)).map(o=>`${o.prefix}${o.id}`).join(""):i.map(o=>`${o.prefix}${o.id}`).join(n?.delimiter??"")}const ts=b.keyBy(q.ATTRIBUTE_VALUE_DICT,"prefix");function ss(t){return(t.match(/[\^*+~!][a-zA-Z0-9]+/g)??[]).reduce((n,r)=>{const l=r[0],i=r.slice(1),o=ts[l].value;return n[i]=o,n},{})}function $e(t){return Object.values(t.attributes).reduce((s,n)=>{let r=s;return n<=0?(n===q.ATTRIBUTE_VALUE_DICT.OPPOSITE.value&&(r+=n/2),r):r+n},0)}function _e(t,s){const n=Object.values(t.attributes).filter(r=>r===q.ATTRIBUTE_VALUE_DICT.UNCLEAR.value).length;return Math.floor((s-n)/s*100)}const le={};function rs(){const{notification:t,message:s}=je.useApp(),n=Je(),r=te("items"),l=te("items-attributes"),i=te("items-attribute-values"),o=jt("tdr","itemsAttributeValues",{select:v=>is({itemAttributesValues:v,itemAttributes:l.data??{}})}),[c,d]=I.useState({}),h=It("tdr","itemsAttributeValues",{onSuccess:()=>{t.success({title:"itemsAttributeValues updated"}),n.refetchQueries({queryKey:["firestore","tdr","itemsAttributeValues"]}),d({})},onError:v=>{t.error({title:"itemsAttributeValues update failed",description:v.message})}}),a=I.useMemo(()=>({...i.data??{},...o.data??{}}),[i.data,o.data]),u=!b.isEmpty(c),x=(v,T)=>{d(m=>({...m,[v]:{...T,updatedAt:Date.now()}}))},f=v=>{d(T=>({...T,...b.mapKeys(v.map(m=>({...m,updatedAt:Date.now()})),"id")}))},g=o.data,p=()=>{h.mutate(ns({...g,...c},l.data))};return{availableItemIds:I.useMemo(()=>{const v=r.data??{};return b.orderBy(Object.keys(v).filter(T=>(v[T]?.decks??[]).includes("alien")),T=>Number(T),"asc")},[r.data]),getItem:v=>r.data?.[v]?r.data[v]:(v&&s.info(`Item ${v} not found in TDR. Creating a new item...`),fe({id:v})),getItemAttributeValues:v=>{const T=a?.[v]??{},m=c[v]??{};return b.isEmpty(T)&&b.isEmpty(m)?(le[v]=be({id:v}),le[v]):b.merge(le?.[v]??{},T,m)},attributes:l.data??{},isLoading:r.isLoading||l.isLoading||i.isLoading||o.isLoading,error:r.error||l.error||i.error||o.error,firestoreData:g,hasFirestoreData:!b.isEmpty(o.data),isSaving:h.isPending,save:p,addAttributesToUpdate:x,addMultipleAttributesToUpdate:f,attributesToUpdate:c,isDirty:u}}const ns=(t,s)=>ft(t,r=>({id:r.id,tempSignature:xe(r,s),updatedAt:r.updatedAt})),is=t=>{const{itemAttributesValues:s,itemAttributes:n}=t,r=Object.keys(n).length;return ht(s,i=>{const o=ss(i.tempSignature),c=Object.keys(o).length===r,d={id:i.id,updatedAt:i.updatedAt,attributes:o};return c?{...d,complete:c,reliability:_e(d,r),score:$e(d)}:d})},Ge=I.createContext({getItem:()=>fe(),getItemAttributeValues:()=>be(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:fe(),itemAttributeValues:be(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{},attributesToUpdate:{},hasFirestoreData:!1}),as=({children:t})=>{const{getItem:s,getItemAttributeValues:n,availableItemIds:r,isLoading:l,error:i,isSaving:o,save:c,addAttributesToUpdate:d,isDirty:h,attributes:a,addMultipleAttributesToUpdate:u,attributesToUpdate:x,hasFirestoreData:f}=rs(),{message:g}=je.useApp(),p=I.useMemo(()=>b.orderBy(Object.values(a),"name.en","asc"),[a]),{queryParams:y}=D(),A=y.get("sortBy"),C=I.useMemo(()=>A==="id"?b.orderBy(r,j=>Number(j),"asc"):A==="updatedAt"?b.orderBy(r,j=>n(j).updatedAt,"desc"):A==="fewestAttributesLeft"?b.orderBy(r,j=>{const S=p.length-Object.keys(n(j).attributes).length;return S===0?Number.POSITIVE_INFINITY:S},"asc"):r,[r,A]),[v,T]=I.useState(b.random(0,C.length-1)),m=s(C[v]),F=n(m.id),k=(j,S)=>{if(j==="next"){T(N=>(N+1)%C.length);return}if(j==="previous"){T(N=>(N-1+C.length)%C.length);return}if(j==="random"){T(b.random(0,C.length-1));return}if(j==="first"){T(0);return}if(j==="last"){T(C.length-1);return}if(j==="next10"){T(N=>(N+10)%C.length);return}if(j==="previous10"){T(N=>(N-10+C.length)%C.length);return}if(j==="incomplete"){T(N=>{let O=N+1;for(;O<C.length;){const X=n(C[O]);if(Object.keys(X.attributes).length!==p.length)return O;if(O===C.length-1)return g.info("No more incomplete items found."),N;O++}return N});return}if(j==="goTo"&&S!==void 0){const N=C.indexOf(S);if(N!==-1){T(N);return}g.error(`Item ${S} is not available for attribution.`)}},R=(j,S)=>{d(m.id,{...F,attributes:{...F.attributes,[j]:S}})},L=()=>ve(r.reduce((j,S)=>{const N=n(S);return b.isEmpty(N.attributes)||(Object.keys(N.attributes).length===p.length?N.complete=!0:delete N.complete,j[N.id]=N),j},{}));return e.jsx(Ge.Provider,{value:{getItem:s,getItemAttributeValues:n,availableItemIds:r,isLoading:l,error:i,hasResponseData:r.length>0&&!b.isEmpty(a),isDirty:h,itemAttributeValues:F,jumpToItem:k,activeItem:m,onAttributeChange:R,isSaving:o,save:c,attributes:a,attributesList:p,addAttributesToUpdate:d,addMultipleAttributesToUpdate:u,prepareItemsAttributesFileForDownload:L,attributesToUpdate:x,hasFirestoreData:f},children:t})},U=()=>I.useContext(Ge);function $({label:t,children:s}){return e.jsxs(V.Text,{children:[t," ",e.jsx(ee,{children:s})]})}function os(){const{getItemAttributeValues:t,availableItemIds:s,attributesList:n}=U(),{total:r,complete:l,completionPercentage:i,hasDataCount:o,initiatedPercentage:c,progress:d,progressTotal:h,currentProgress:a}=I.useMemo(()=>{const u=s.length;let x=0,f=0,g=0;s.map(A=>t(A)).forEach(({attributes:A})=>{b.isEmpty(A)||(x+=1),Object.values(A).length===n.length&&(f+=1),g+=Object.values(A).length});const y=Object.values(n).length*s.length;return{total:u,complete:f,completionPercentage:u>0?(f/u*100).toFixed(1):0,hasDataCount:x,initiatedPercentage:u>0?Math.floor(x/u*100):0,progress:(g/y*100).toFixed(1),currentProgress:g,progressTotal:y}},[n,s,t]);return e.jsxs(e.Fragment,{children:[e.jsxs(E,{vertical:!0,children:[e.jsx(V.Text,{className:"mb-2",strong:!0,children:"Items Stats"}),e.jsx($,{label:"Total",children:r}),e.jsxs($,{label:"Complete",children:[l," (",i,"%)"]}),e.jsxs($,{label:"Initiated",children:[o," (",c,"%)"]}),e.jsx(V.Text,{className:"mt-4 mb-2",strong:!0,children:"Attributes Stats"}),e.jsx($,{label:"Total",children:h}),e.jsx($,{label:"Set",children:a}),e.jsxs($,{label:"Progress",children:[d,"%"]})]}),e.jsx(_,{})]})}function ls(){const{jumpToItem:t}=U(),{addParam:s,is:n}=D();return e.jsxs(e.Fragment,{children:[e.jsx(P,{block:!0,onClick:()=>t("random"),type:"primary",children:"Random Item"}),e.jsx(G,{className:"mt-4",label:"Unset Only",onChange:r=>s("scope",r?"unset":""),value:n("scope","unset")})]})}function cs(){const{queryParams:t,addParam:s}=D(),{attributesList:n}=U(),r=I.useMemo(()=>[{label:"Random Attribute",value:"random"},...n.map(({id:l,name:i})=>({label:i.en,value:l}))],[n]);return e.jsxs(e.Fragment,{children:[e.jsx(Z,{label:"Sampler Attribute",onChange:l=>s("attribute",l),options:r,value:t.get("attribute")||"random"}),e.jsx(Le,{label:"Sample Size",max:21,min:3,onChange:l=>s("size",String(l)),step:3,value:Number(t.get("size")||9)})]})}function us(){const{queryParams:t,addParam:s}=D(),{attributesList:n}=U(),r=I.useMemo(()=>n.map(({id:l,name:i,...o})=>({label:`${i.en}${o.default?"*":""}`,value:l})),[n]);return e.jsxs(e.Fragment,{children:[e.jsx(Z,{label:"Attribute",onChange:l=>s("attribute",l),options:r,value:t.get("attribute")||"ali"}),e.jsx(Z,{label:"Scope",onChange:l=>s("scope",l),options:[{value:"unset",label:"Unset"},...gt],value:t.get("scope")||"unset"}),e.jsx(Z,{label:"Results per page",onChange:l=>s("pageSize",l),options:[12,24,48,96],value:t.get("pageSize")||12})]})}function ds(){const{addParam:t,is:s}=D();return e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"full-width m-0",label:"Only Complete",onChange:n=>t("showComplete",n?"true":""),value:s("showComplete")}),e.jsx(G,{className:"full-width m-0",label:"Show Unrelated",onChange:n=>t("showUnrelated",n?"true":""),value:s("showUnrelated")}),e.jsx(G,{className:"full-width m-0",label:"Show Unclear",onChange:n=>t("showUnclear",n?"true":""),value:s("showUnclear")})]})}function ms(){const{addParam:t,is:s}=D();return e.jsx(G,{className:"full-width m-0",label:"Show Glyphs",onChange:n=>t("showGlyphs",n?"true":""),value:s("showGlyphs")})}function ps(){const{isDirty:t,save:s,prepareItemsAttributesFileForDownload:n,attributes:r,isSaving:l,attributesToUpdate:i,hasFirestoreData:o}=U(),{queryParams:c,addParam:d}=D(),h=c.get("display")??"classifier";return e.jsxs(lt,{children:[e.jsxs(E,{gap:12,vertical:!0,children:[e.jsx(mt,{dirt:JSON.stringify(i),isDirty:t,isSaving:l,onSave:s}),e.jsx(De,{block:!0,data:()=>gs(n(),r),disabled:t,fileName:"items-attribute-values.json",hasNewData:o}),e.jsx(E,{justify:"center",children:e.jsx(ut,{docId:"itemsAttributeValues",path:"tdr",queryKey:["tdr","itemsAttributeValues"]})})]}),e.jsx(_,{}),e.jsx(os,{}),e.jsx(We,{layout:"vertical",children:e.jsx(Z,{label:"Display",onChange:a=>d("display",a),options:["classifier","sampler","grouping","comparator","simulator","stats"],value:h})}),e.jsx(_,{}),h==="classifier"&&e.jsx(ls,{}),h==="sampler"&&e.jsx(cs,{}),h==="grouping"&&e.jsx(us,{}),h==="comparator"&&e.jsx(ds,{}),h==="stats"&&e.jsx(ms,{})]})}function gs(t,s){const n=Object.keys(s).length;Object.keys(t).forEach(l=>{const i=t[l],o=Object.keys(i.attributes);o.forEach(d=>{s[d]||delete i.attributes[d]}),o.length===n?(i.complete=!0,i.score=$e(i),i.reliability=_e(i,n),i.signature=xe(i,s,{onlyRelevant:!0})):(i.complete=void 0,i.score=void 0,i.reliability=void 0,i.signature=void 0)});const r={};return Object.values(t).forEach(l=>{r[l.id]={id:l.id,updatedAt:l.updatedAt,signature:xe(l,s,{delimiter:":"})},l.complete&&(r[l.id].complete=l.complete)}),console.log(r),ve(Ue(t))}function qe(t){const[s,n]=I.useState(!1),r=()=>{n(window.scrollY>300)},l=()=>{window.scrollTo({top:0,behavior:"smooth"})};return Ze(()=>(window.addEventListener("scroll",r),()=>{window.removeEventListener("scroll",r)})),e.jsx(P,{className:`go-to-top-button ${s?"visible":""}`,icon:e.jsx(vt,{}),onClick:l,...t,children:"Go to Top"})}function Ke({title:t,icon:s}){return e.jsx(Re,{title:t,children:s??e.jsx(Oe,{})})}const Se=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC}],we=[{label:"Opposite",value:w.OPPOSITE},{label:"Unrelated",value:w.UNRELATED},{label:"Unclear",value:w.UNCLEAR},{label:"Related",value:w.RELATED},{label:"Deterministic",value:w.DETERMINISTIC,disabled:!0}];function ie({attribute:t,value:s,onChange:n,onlyButtons:r,size:l}){return t?r?e.jsx(Te.Group,{buttonStyle:"solid",onChange:({target:{value:i}})=>n(t.id,i),options:t.limited?we:Se,optionType:"button",size:l,value:s}):e.jsxs("div",{className:"attribute-button-container__row",children:[e.jsxs("span",{className:"attribute-button-container__label",children:[b.truncate(t.name.en,{length:12})," ",e.jsx(Ke,{title:t.description.en})]}),e.jsx(Te.Group,{buttonStyle:"solid",onChange:({target:{value:i}})=>n(t.id,i),options:t.limited?we:Se,optionType:"button",size:l,value:s}),e.jsx("span",{children:e.jsx(ce,{style:{color:s&&s>7?"green":"transparent"}})})]},t.id):null}function hs({itemAttributeValues:t,attributes:s}){const{is:n,addParam:r}=D(),l=n("showUnclear"),i=n("showUnrelated"),o=I.useMemo(()=>ze(Be(t,s),l,i),[t,s,l,i]),c=n("signs")?Qe:fs;return e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(G,{className:"full-width m-0",label:"Show Unrelated",onChange:d=>r("showUnrelated",d?"true":""),value:n("showUnrelated")}),e.jsx(G,{className:"full-width m-0",label:"Show Unclear",onChange:d=>r("showUnclear",d?"true":""),value:n("showUnclear")}),e.jsx(G,{className:"full-width m-0",label:"Alien Signs",onChange:d=>r("signs",d?"true":""),value:n("signs")}),e.jsx(E,{className:"item-attribute-value-statement",gap:6,wrap:"wrap",children:o.map((d,h,a)=>e.jsx(c,{attributes:s,firstElement:h===0,keyVariant:d,lastElement:h===a.length-1},d))})]})}function Qe({keyVariant:t,attributes:s,withText:n}){const{key:r,className:l,text:i}=ke(t);return e.jsxs(E,{align:"center",vertical:!0,children:[e.jsx(K,{className:ue("item-attribute-alien-sign",`item-attribute-alien-sign--${l}`),signId:s[r].spriteId,width:50}),n&&e.jsxs(E,{align:"center",justify:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},wrap:"wrap",children:[i," ",s[r].name.en.toLowerCase()]})]})}function fs({keyVariant:t,attributes:s,firstElement:n,lastElement:r}){const{key:l,text:i}=ke(t),o=n?"It's ":"",c=r?".":", ";return e.jsxs(e.Fragment,{children:[o,i," ",s[l].name.en.toLowerCase(),c]})}function bs({attributesList:t,itemAttributeValues:s}){const{completion:n,isDeterministic:r,value:l,isOpposing:i,relevancy:o}=I.useMemo(()=>{const c=t.length,d=Object.keys(s.attributes).length,h=Math.floor(d/c*100);let a=!1,u=!1,x=0;const f=Object.values(s.attributes).reduce((p,y)=>y<=0?(y===w.UNCLEAR&&(x+=1),y===w.OPPOSITE&&(u=!0,p+=y/2),p):(y===w.DETERMINISTIC&&(a=!0),p+y),0),g=Math.floor((d-x)/c*100);return{completion:h,isDeterministic:a,value:f,isOpposing:u,relevancy:g}},[t,s.attributes]);return e.jsxs("div",{children:[e.jsx(V.Text,{strong:!0,children:"Completion"}),e.jsx(Ve,{percent:n,size:"small"}),e.jsx(V.Text,{strong:!0,children:"Stats"}),e.jsxs(E,{vertical:!0,children:[e.jsx($,{label:"Deterministic",children:r?e.jsx(ce,{style:{color:"green"}}):e.jsx(Ee,{style:{color:"red"}})}),e.jsx($,{label:"Opposing",children:i?e.jsx(ce,{style:{color:"CornflowerBlue"}}):e.jsx(Ee,{style:{color:"grey"}})}),e.jsx($,{label:"Value",children:l}),e.jsx(Re,{title:"The percentage of conclusive attributes (not unclear)",children:e.jsxs($,{label:"Reliability",children:[o,"%"]})})]})]})}function xs(){const{activeItem:t,attributesList:s,itemAttributeValues:n,onAttributeChange:r,jumpToItem:l,attributes:i}=U(),{queryParams:o,removeParam:c,is:d}=D(),h=o.get("itemId"),a=o.get("filters");I.useEffect(()=>{h&&(c("itemId"),l("goTo",h))},[h]);const u=d("scope","unset"),x=I.useMemo(()=>{const f=u?s.filter(g=>!n.attributes[g.id]):s;if(a){const g=a.split(",").reduce((p,y)=>(p[y]=!0,p),{});return f.filter(p=>g[p.id])}return f},[u,t.id,a]);return t?e.jsx(Q,{children:e.jsxs("div",{className:"item-attribution-card",children:[e.jsx(At,{className:"item-attribution-card__item",offsetTop:120,children:e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(H,{item:t,width:150}),e.jsx(Y,{item:t}),e.jsx(z,{item:t,language:"en"}),e.jsx(z,{item:t,language:"pt"}),e.jsx(_,{className:"my-2"}),e.jsx(bs,{attributesList:s,itemAttributeValues:n}),e.jsx(_,{className:"my-2"}),e.jsx(V.Text,{type:"secondary",children:e.jsx(hs,{attributes:i,itemAttributeValues:n})})]})}),e.jsx(B,{className:"my-4 attribute-button-container",orientation:"vertical",size:"small",wrap:!0,children:x.map(f=>e.jsx(ie,{attribute:f,onChange:r,value:n.attributes[f.id]},f.id))})]},`${t.id}`)}):e.jsx(Q,{children:e.jsxs(V.Text,{type:"secondary",children:["No item selected."," ",e.jsx(P,{onClick:()=>l("random"),size:"small",type:"primary",children:"Random Item"})]})})}function js(){const{jumpToItem:t}=U();return e.jsxs(B.Compact,{children:[e.jsx(P,{icon:e.jsx(Wt,{}),onClick:()=>t("first"),children:"First"}),e.jsx(P,{icon:e.jsx(Ct,{}),onClick:()=>t("previous10"),children:"Previous 10"}),e.jsx(P,{icon:e.jsx(Xe,{}),onClick:()=>t("previous"),children:"Previous"}),e.jsxs(P,{onClick:()=>t("next"),children:["Next ",e.jsx(et,{})]}),e.jsxs(P,{onClick:()=>t("next10"),children:["Next 10 ",e.jsx(Et,{})]}),e.jsxs(P,{onClick:()=>t("last"),children:["Last ",e.jsx(Ht,{})]}),e.jsx(Ie,{content:e.jsx(Is,{}),title:"Go to item",children:e.jsx(P,{children:"Go To"})}),e.jsx(P,{onClick:()=>t("incomplete"),children:"Next Incomplete"})]})}function Is(){const{jumpToItem:t}=U();return e.jsx(Tt,{isPending:!1,onFinish:s=>t("goTo",s)})}function vs(){const{addParam:t,queryParams:s}=D(),{attributesList:n}=U(),r=I.useMemo(()=>n.map(c=>({label:c.name.en,value:c.id})),[n]),l=c=>{t("filters",c.join(","))},i=s.get("filters"),o=e.jsx(W,{allowClear:!0,mode:"multiple",onChange:c=>l(c),options:r,style:{width:300},value:i?.split(",")});return e.jsx(Ie,{content:o,title:"Filter Attributes",children:e.jsx(P,{children:i?e.jsx(wt,{style:{color:"gold"}}):e.jsx($t,{})})})}function ys(){const{addParam:t,queryParams:s}=D(),n=[{label:"Id",value:"id"},{label:"Updated At",value:"updatedAt"},{label:"Fewest Attributes Left",value:"fewestAttributesLeft"}],r=s.get("sortBy"),l=e.jsx(W,{allowClear:!0,onChange:i=>t("sortBy",i),options:n,style:{width:120},value:r});return e.jsx(Ie,{content:l,title:"Sort By",children:e.jsx(P,{children:"Sort"})})}function As(){const{attributes:t,getItemAttributeValues:s,availableItemIds:n,getItem:r,isLoading:l}=U(),{is:i}=D(),o=i("showComplete"),c=i("showUnclear"),d=i("showUnrelated"),{itemMessages:h,itemMessagesDict:a,grouping:u}=I.useMemo(()=>{if(l)return{itemMessages:[],itemMessagesDict:{},grouping:{}};const x=b.orderBy(n.map(p=>{const y=s(p),A=Be(y,t);return{item:r(p),itemAttributesValues:y,message:ze(A,c,d),fullMessage:A}}).filter(({itemAttributesValues:p})=>o?p.complete:!0),["message"],["asc"]),f=x.reduce((p,{message:y,item:{id:A}})=>{const C=y.join(" ");return p[C]===void 0&&(p[C]=[]),p[C].push(A),p},{}),g=Object.values(f).filter(p=>p.length>1);return g.length>0&&console.log("More than one",g),{itemMessages:x,itemMessagesDict:b.keyBy(x,"item.id"),grouping:f}},[t,n,s,r,l,o,c,d]);return{itemMessages:h,itemMessagesDict:a,grouping:u}}function ye(){const{queryParams:t,removeParam:s}=D(),n=t.get("drawer"),[r,l]=I.useState(!1),{activeItem:i,attributesList:o,itemAttributeValues:c,onAttributeChange:d,jumpToItem:h}=U(),a=()=>{s("drawer")};I.useEffect(()=>{n&&h("goTo",n)},[n]);const u=I.useMemo(()=>r?o.filter(x=>!c.attributes[x.id]):o,[r,i.id]);return e.jsxs(Pt,{onClose:a,open:!!n,title:`Edit: ${i.name.en}`,width:"640px",children:[e.jsxs(E,{gap:6,children:[e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(H,{item:i,width:50}),e.jsx(Y,{item:i})]}),e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(z,{item:i,language:"en"}),e.jsx(z,{item:i,language:"pt"})]}),e.jsx(E,{gap:6,vertical:!0,children:e.jsx(Rt,{checked:r,checkedChildren:"Unset",onChange:l,unCheckedChildren:"All"})})]}),e.jsx(_,{className:"my-1"}),e.jsx(B,{className:"my-4 attribute-button-container",orientation:"vertical",size:"small",wrap:!0,children:u.map(x=>e.jsx(ie,{attribute:x,onChange:d,size:"small",value:c.attributes[x.id]},x.id))})]})}function Ts(){const{attributes:t}=U(),{itemMessages:s,grouping:n}=As(),{addParam:r}=D(),l=[{title:"Item Id",dataIndex:"item",key:"id",render:i=>e.jsxs("div",{children:[e.jsx(Y,{item:i}),e.jsxs(B.Compact,{children:[e.jsx(ne,{item:i}),e.jsx(P,{onClick:()=>r("drawer",i.id),shape:"round",size:"small",children:"Drawer"})]})]}),sorter:(i,o)=>Number(i.item.id)-Number(o.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:i=>e.jsx(H,{item:i,width:75})},{title:"Name",dataIndex:"item",key:"name",render:i=>e.jsxs(e.Fragment,{children:[e.jsx(z,{item:i,language:"en"}),e.jsx(z,{item:i,language:"pt"})]}),sorter:(i,o)=>i.item.name.en.localeCompare(o.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(i,{item:o})=>e.jsx(E,{gap:6,children:i.map((c,d,h)=>e.jsx(Qe,{attributes:t,firstElement:d===0,keyVariant:c,lastElement:d===h.length-1,withText:!0},`${c}-${o.id}`))}),sorter:(i,o)=>i.message.join(" ").localeCompare(o.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:i=>i.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:i=>{const o=n[i.join(" ")]??[];return e.jsx(e.Fragment,{children:o.length>1?o.length:"0"})},sorter:(i,o)=>{const c=n[i.message.join(" ")]??[];return(n[o.message.join(" ")]??[]).length-c.length}}];return e.jsxs("div",{className:"my-4",children:[e.jsx(V.Title,{level:5,children:"Item Comparator"}),e.jsx(Fe,{columns:l,dataSource:s,pagination:{showQuickJumper:!0}}),e.jsx(ye,{})]})}function Cs(){const{attributesList:t,addAttributesToUpdate:s,getItemAttributeValues:n,availableItemIds:r,addMultipleAttributesToUpdate:l}=U(),{queryParams:i,addParam:o}=D(),c=i.get("attribute")??"ali",d=i.get("scope")??"unset",h=i.get("page")??"1",a=i.get("pageSize")??"12",[u,x]=I.useState("ali"),[f,g]=I.useState("unset"),[p,y]=I.useState(null),[A,C]=I.useState("desc"),v=I.useMemo(()=>{const R=r.map(O=>n(O)),L=d==="unset"?void 0:w[d.toUpperCase()],j=R.filter(O=>O.attributes?.[c]===L).map(O=>O.id),[S,N]=(p??"::").split("::");return b.orderBy(j,[O=>S==="attribute"?n(O)?.attributes?.[N]:!0,O=>S==="prop"?Number(O):!0,O=>n(O)?.updatedAt,O=>Number(O)],[A,"asc","desc","asc"])},[c,d,p,A]),T=I.useMemo(()=>{if(u!==c||f!==d)return x(c),g(d),o("page","1"),v.slice(0,Number(a));const R=(Number(h)-1)*Number(a),L=R+Number(a);return v.slice(R,L)},[h,a,v]),m=t.find(R=>R.id===c),F=(R,L,j)=>{const S=n(R);s(R,{...S,attributes:{...S.attributes,[L]:j}})},k=()=>{l(T.map(R=>{const L=n(R);return L.attributes[c]||(L.attributes[c]=w.UNRELATED),L}))};return{group:v,stats:{total:r.length,group:v.length,percent:Math.round(v.length/r.length*100)},pageIds:T,attribute:m,updateAttributeValue:F,updatePageItemsAsUnrelated:k,sorting:{sortBy:p,setSortBy:y,sortOrder:A,setSortOrder:C},pagination:{total:v.length,current:Number(h),pageSize:Number(a),onChange:R=>o("page",String(R)),onShowSizeChange:(R,L)=>o("pageSize",String(L)),pageSizeOptions:[12,24,48,96]}}}const Es=(t,s)=>s==="unset"||!s?`${100-t.percent}% done, ${t.group} left`:`${t.percent}%  - ${t.group} items`;function Ss(){const{getItem:t,getItemAttributeValues:s,attributesList:n}=U(),{attribute:r,pageIds:l,updateAttributeValue:i,updatePageItemsAsUnrelated:o,pagination:c,stats:d,sorting:h}=Cs(),{queryParams:a,addParam:u}=D(),x=Xt("(max-width: 1024px)");if(b.isEmpty(r))return e.jsx(Q,{className:"my-4",children:e.jsx(V.Text,{type:"secondary",children:"No group attribute has been selected."})});const f=e.jsx(E,{justify:"center",children:e.jsx(St,{current:c.current,onChange:c.onChange,onShowSizeChange:c.onShowSizeChange,pageSize:c.pageSize,pageSizeOptions:c.pageSizeOptions,total:c.total},"pagination")}),g=e.jsxs(E,{align:"center",children:[e.jsx(V.Text,{className:"mr-2",children:"Sort by"}),e.jsxs(W,{onChange:A=>h.setSortBy(A),style:{width:120},value:h.sortBy,children:[e.jsx(W.Option,{value:null,children:"Last Updated"}),e.jsx(W.Option,{value:"prop::id",children:"Id"}),n.map(A=>e.jsx(W.Option,{value:`attribute::${A.id}`,children:A.name.en},A.id))]})]}),y=(a.get("scope")==="unset"||!a.get("scope"))&&e.jsx(Ot,{onConfirm:o,title:`Are you sure everything is unrelated to ${r.name.en}?`,children:e.jsx(P,{className:"mx-2",danger:!0,disabled:l.length===0,type:"primary",children:"Unrelate Unset Items on Page"})},"unrelate-button");return e.jsxs(Q,{actions:[e.jsxs(E,{justify:"space-between",children:[y,e.jsx(ws,{},"navigation-buttons")]},"options"),f].filter(Boolean),className:"my-4",extra:e.jsxs(E,{align:"center",className:"mx-2",justify:"space-around",children:[g,f]}),title:e.jsxs(V.Text,{children:[r?.name.en," (",Es(d,a.get("scope")),") -"," ",r.description.en]}),children:[l.length===0&&e.jsx(se,{description:"No items found in this scope for this attribute.",image:se.PRESENTED_IMAGE_SIMPLE}),l.map(A=>{const C=s(A),v=t(A);return e.jsx(Q.Grid,{style:{width:x?"50%":"25%"},children:e.jsxs(E,{gap:6,children:[e.jsxs(E,{gap:6,vertical:!0,children:[e.jsx(H,{item:v,width:75}),e.jsx(Y,{item:v}),e.jsxs(B.Compact,{children:[e.jsx(ne,{item:v}),e.jsx(P,{onClick:()=>u("drawer",v.id),shape:"round",size:"small",children:"Drawer"})]}),e.jsx(z,{item:v,language:"en"}),e.jsx(z,{item:v,language:"pt"})]}),e.jsx(ie,{attribute:r,onChange:(T,m)=>i(v.id,T,m),onlyButtons:!0,value:C.attributes[r.id]})]})},`${A}-${C.updatedAt}`)}),e.jsx(ye,{})]})}function ws(){const{queryParams:t,addParam:s}=D(),{attributesList:n}=U(),r=t.get("attribute"),l=()=>{const o=n.findIndex(d=>d.id===r),c=n[o-1];c&&s("attribute",c.id)},i=()=>{const o=n.findIndex(d=>d.id===r),c=n[o+1];c&&s("attribute",c.id)};return e.jsxs(E,{className:"mx-8",gap:6,justify:"space-between",children:[e.jsx(P,{disabled:r===n[0]?.id,onClick:l,children:"Previous Attribute"},"previous"),e.jsx(qe,{},"go-to-top"),e.jsx(P,{disabled:r===n[n.length-1]?.id,onClick:i,children:"Next Attribute"},"next")]})}function He(){const{attributesList:t,availableItemIds:s,addAttributesToUpdate:n,getItemAttributeValues:r}=U(),{queryParams:l}=D(),[i,o]=I.useState([]),[c,d]=I.useState(),h=()=>{const f=l.get("attribute")??b.sample(t)?.id??"ali",g=t.find(C=>C.id===f)??b.sample(t),p=Number(l.get("size"))||9,y=[],A=b.shuffle(s);for(let C=0;C<A.length&&y.length!==p;C++){const v=A[C];r(v).attributes[f]||y.push(v)}return{selectedAttribute:g,selected:y}},a=()=>{let f=h(),g=0;for(;f.selected.length===0&&g<30;)f=h(),g++;d(f.selectedAttribute),o(f.selected)},u=I.useMemo(()=>c?s.filter(f=>!r(f).attributes[c?.id]).length:0,[c,s]);return{sampleIds:i,attribute:c,itemsLeftForAttribute:u,onGetSample:a,updateAttributeValue:(f,g,p)=>{const y=r(f);n(f,{...y,attributes:{...y.attributes,[g]:p}})}}}function Ns(){const{getItem:t,getItemAttributeValues:s}=U(),{sampleIds:n,attribute:r,onGetSample:l,updateAttributeValue:i,itemsLeftForAttribute:o}=He(),{addParam:c}=D();if(b.isEmpty(n)&&b.isEmpty(r))return e.jsxs(Q,{className:"my-4",children:[e.jsxs(V.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",e.jsx(P,{onClick:l,size:"small",type:"primary",children:"Get Sample"})]}),e.jsx(_,{}),e.jsx(Ne,{})]});const d=n.map(u=>({itemAttributes:s(u),item:t(u)})),h=d.filter(({itemAttributes:u})=>r?.id&&!u.attributes[r.id]),a=()=>{h.forEach(({item:u})=>{r?.id&&i(u.id,r.id,-3)})};return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{}),e.jsxs(Q,{actions:[e.jsx(P,{danger:!0,disabled:h.length===0,onClick:a,children:"Mark rest as unrelated"},"1"),e.jsx(P,{ghost:!0,onClick:l,type:"primary",children:"Get New Sample"},"2")],className:"my-4",extra:e.jsx(P,{onClick:l,size:"small",type:"primary",children:"Get New Sample"}),title:e.jsxs(V.Text,{children:[r?.name.en," - ",r?.description.en," (",o," items left)"]}),children:[e.jsxs(E,{gap:6,vertical:!0,children:[d.length===0&&e.jsx(se,{description:"No unset items found for this attribute.",image:se.PRESENTED_IMAGE_SIMPLE}),d.map(({item:u,itemAttributes:x})=>e.jsxs(I.Fragment,{children:[e.jsxs(E,{gap:6,children:[e.jsx(H,{item:u,width:75}),e.jsxs(E,{gap:6,vertical:!0,children:[e.jsxs(E,{gap:6,children:[e.jsx(Y,{item:u}),e.jsxs(B.Compact,{children:[e.jsx(ne,{item:u}),e.jsx(P,{onClick:()=>c("drawer",u.id),shape:"round",size:"small",children:"Drawer"})]})]}),e.jsx(z,{item:u,language:"en"}),e.jsx(z,{item:u,language:"pt"})]}),!!r&&e.jsx(ie,{attribute:r,onChange:(f,g)=>i(u.id,f,g),value:x.attributes[r.id]})]}),e.jsx(_,{className:"my-1"})]},`${u.id}-${x.updatedAt}`))]}),e.jsx(ye,{})]})]})}function Ne(){const[t,s]=yt(!1),{addParam:n,removeParam:r}=D(),{sampleIds:l,attribute:i,onGetSample:o,updateAttributeValue:c}=He(),{getItem:d,getItemAttributeValues:h}=U(),a=()=>{n("size","1"),s(!0),o()},u=()=>{r("size"),s(!1)},x=l[0],f=d(x),g=h(x);return e.jsxs(E,{className:"mt-4",children:[e.jsx(P,{onClick:a,type:"primary",children:"Single Sampler"}),e.jsxs(tt,{cancelButtonProps:{style:{display:"none"}},maskClosable:!1,onCancel:u,onOk:u,open:t,title:e.jsxs(V,{children:["Single Sampler: ",e.jsx("strong",{children:i?.name.en})]}),width:"100vw",children:[x&&f&&g&&i&&e.jsxs(E,{className:"my-10",gap:6,wrap:"wrap",children:[e.jsx(H,{item:f,width:150}),e.jsxs(E,{gap:6,vertical:!0,children:[e.jsxs(E,{gap:6,children:[e.jsx(Y,{item:f}),e.jsx(ne,{item:f})]}),e.jsx(z,{item:f,language:"en"}),e.jsx(z,{item:f,language:"pt"})]}),!!i&&e.jsx(ie,{attribute:i,onChange:async(p,y)=>{c(f.id,p,y),await bt(500),o()},size:"large",value:g.attributes[i.id]})]},x),e.jsx(P,{onClick:o,children:"Another Sample"})]})]})}function Ps(){const t=te("items-attributes"),s=te("items-attribute-values"),[n,r]=I.useState(null),l=()=>{r(Pe(t.data,s.data))},i=()=>{const o={};let c=0;for(;c<300||b.keys(o).length===15;){const d=Pe(t.data,s.data);if(d.valid&&!o[d.setId]&&(o[d.setId]=d),b.keys(o).length>=15)break;c+=1}console.log("TRIES",c),console.log(Object.values(o).map((d,h)=>({...d,number:d.number-h})))};return e.jsxs("div",{className:"my-4",children:[e.jsx(V.Title,{level:3,children:"Daily Simulator"}),e.jsx(V.Paragraph,{children:"Generates a daily game for Alien Communication"}),e.jsxs(B,{children:[e.jsx(P,{onClick:l,type:"primary",children:"Generate"}),e.jsx(P,{onClick:i,children:"Generate List"})]}),e.jsx("div",{children:!!n&&e.jsxs(B,{orientation:"vertical",children:[e.jsx(V.Title,{level:5,children:n?.setId}),!n?.valid&&e.jsx(st,{message:"Invalid game",type:"error"}),e.jsx(B,{orientation:"vertical",children:n?.attributes.map(o=>e.jsxs(E,{gap:8,children:[e.jsx(K,{signId:o.spriteId,width:50}),o.itemsIds.map(c=>e.jsx(Ce,{itemId:c||"0",width:50},c))]},o.id))}),e.jsx(_,{className:"my-1"}),e.jsx(B,{orientation:"horizontal",children:n?.requests.map(o=>e.jsxs(E,{vertical:!0,children:[e.jsx(K,{signId:o.spritesIds[2],width:50}),e.jsx(K,{signId:o.spritesIds[1],width:50}),e.jsx(K,{signId:o.spritesIds[0],width:50})]},o.itemId))}),e.jsx(_,{className:"my-1"}),e.jsx(B,{orientation:"horizontal",children:n?.itemsIds.map(o=>e.jsx(Ce,{itemId:o||"0",width:50},o))})]},n?.setId)})]})}const Pe=(t,s)=>{const n=b.values(t).filter(m=>!m.limited||m.id==="sol"),r=b.shuffle(b.values(s).filter(m=>m.complete)),l=b.shuffle(xt(38,0)),i=b.sampleSize(n,3).map(m=>({...m,spriteId:`${l.pop()}`})),o=[],c=[],d=[],h=[],a=[],u=[],x=[],f=[];r.forEach(m=>{const F=[w.DETERMINISTIC,w.RELATED],k=m.attributes[i[0].id]===w.DETERMINISTIC,R=F.includes(m.attributes[i[0].id]),L=m.attributes[i[0].id]===w.UNRELATED,j=m.attributes[i[1].id]===w.DETERMINISTIC,S=F.includes(m.attributes[i[1].id]),N=m.attributes[i[1].id]===w.UNRELATED,O=m.attributes[i[2].id]===w.DETERMINISTIC,X=F.includes(m.attributes[i[2].id]),ae=m.attributes[i[2].id]===w.UNRELATED;if(L&&N&&ae){f.push(m.id);return}k&&N&&ae&&o.push(m.id),L&&j&&ae&&c.push(m.id),L&&N&&O&&d.push(m.id),R&&S&&ae&&h.push(m.id),R&&N&&X&&a.push(m.id),L&&S&&X&&u.push(m.id),R&&S&&X&&x.push(m.id)});const g=i.map(m=>({id:m.id,name:m.name.pt,description:m.description.pt,spriteId:m.spriteId,itemsIds:[]}));g[0].itemsIds=b.sampleSize(o,o.length>3?3:Math.max(o.length-1,1)),g[1].itemsIds=b.sampleSize(c,c.length>3?3:Math.max(o.length-1,1)),g[2].itemsIds=b.sampleSize(d,d.length>3?3:Math.max(o.length-1,1));const p=[];g.forEach(m=>{p.push(...m.itemsIds)});const y=[];h.length>0&&y.push({spritesIds:[i[0].spriteId,i[1].spriteId],itemId:b.sample(h)??""}),a.length>0&&y.push({spritesIds:[i[0].spriteId,i[2].spriteId],itemId:b.sample(a)??""}),u.length>0&&y.push({spritesIds:[i[1].spriteId,i[2].spriteId],itemId:b.sample(u)??""}),x.length>0&&y.push({spritesIds:i.map(m=>m.spriteId),itemId:b.sample(x)??""});const A=[];o.length>0&&A.push({spritesIds:[i[0].spriteId],itemId:o.filter(m=>!p.includes(m))[0]}),c.length>0&&A.push({spritesIds:[i[1].spriteId],itemId:c.filter(m=>!p.includes(m))[0]}),d.length>0&&A.push({spritesIds:[i[2].spriteId],itemId:d.filter(m=>!p.includes(m))[0]}),console.log({attributeA:o,attributeB:c,attributeC:d,attributeAB:h,attributeAC:a,attributeBC:u,attributeABC:x}),console.log("COMPLEX REQUEST SIZE",y.length),console.log("SIMPLE REQUEST SIZE",A.length);let C=b.sampleSize(y,4);console.log("REQUEST SIZE",C.length),C.length<3&&C.push(...b.sampleSize(A,4-C.length)),C.length<4&&console.warn("Not enough requests"),C=b.shuffle(C);const v=C.map(m=>m.itemId),T={id:"2024-00-00",setId:g.map(m=>m.id).sort().join("-"),number:0,type:"comunicacao-alienigena",attributes:g,requests:C,solution:v.join("-"),itemsIds:b.shuffle([...v,f[0],f[1],f[2],f[3]]).filter(Boolean),valid:!1};return T.valid=[T.attributes.length===3,T.requests.length===4,T.itemsIds.length>5,T.attributes.every(m=>m.itemsIds.length>0),T.requests.every(m=>m.itemId)].every(Boolean),console.log(T),T},Rs=["","I","II","III","IV","V"];function Os(){const{attributes:t,availableItemIds:s,getItemAttributeValues:n,getItem:r}=U(),{message:l}=je.useApp(),[i,o]=I.useState(25),[c,d]=I.useState(80),[h,a]=I.useState(!1),[u,x]=I.useState([]),[f,g]=I.useState([]),[p,y]=I.useState(null),[A,C]=I.useState({id:!0,nameEn:!0,namePt:!0,reliability:!0}),v=()=>{const m={},F=b.shuffle(s);for(;Object.values(m).length<i;){const j=F.pop();if(!j)break;const S=n(j);S&&(!S.complete||!S.reliability||S.reliability<c||!h&&r(j).nsfw||(S.signature&&!m[S.signature]?m[S.signature]=j:console.log("Item has identical key to another item. Skipping.",r(j).name.en)))}const k=Object.values(m);k.length<i&&l.error(`Could not generate sample. Got only ${k.length} items`),x(b.sortBy(k,j=>Number(j)));const R=Ls(k.map(j=>n(j)),25,t);if(R.length<25){const j=b.keys(t).filter(O=>!R.includes(O)),N=b.sortBy(j,O=>t[O].priority).slice(0,25-R.length);console.log("Adding more attributes by priority",N),R.push(...N)}const L=R.reduce((j,S)=>(k.forEach(N=>{const O=n(N);if(O)switch(O.attributes[S]){case w.RELATED:j.relatedCount[S]=(j.relatedCount[S]||0)+1;break;case w.DETERMINISTIC:j.deterministicCount[S]=(j.deterministicCount[S]||0)+1;break;case w.UNCLEAR:j.unclearCount[S]=(j.unclearCount[S]||0)+1;break;case w.OPPOSITE:j.oppositeCount[S]=(j.oppositeCount[S]||0)+1;break}}),j),{relatedCount:{},deterministicCount:{},unclearCount:{},oppositeCount:{}});g(R.sort().map(j=>({...t[j],relatedCount:L.relatedCount[j],deterministicCount:L.deterministicCount[j],unclearCount:L.unclearCount[j],oppositeCount:L.oppositeCount[j]})))},T=m=>{C(F=>({...F,[m]:!F[m]}))};return e.jsxs("div",{className:"my-4",children:[e.jsx(V.Title,{level:3,children:"Simulator"}),e.jsx(V.Paragraph,{children:"Generates a board with items different enough to get Deterministic values in all selected attributes."}),e.jsxs(E,{gap:12,wrap:!0,children:[e.jsx(Z,{label:"Grid Size",onChange:m=>o(m),options:[16,25],value:i}),e.jsx(Le,{label:"Reliability Threshold",max:100,min:10,onChange:m=>d(m),step:5,value:c}),e.jsx(G,{label:"NSFW",onChange:a,value:h}),e.jsx(P,{onClick:v,type:"primary",children:"Get Sample Board"})]}),e.jsxs(E,{gap:12,wrap:!0,children:[e.jsx(oe,{label:"Show Id",onChange:()=>T("id"),value:!!A.id}),e.jsx(oe,{label:"Show Name (EN)",onChange:()=>T("nameEn"),value:!!A.nameEn}),e.jsx(oe,{label:"Show Name (PT)",onChange:()=>T("namePt"),value:!!A.namePt}),e.jsx(oe,{label:"Show Reliability",onChange:()=>T("reliability"),value:!!A.reliability})]}),e.jsx("div",{className:"simulator-grid",style:{gridTemplateColumns:`repeat(${Math.sqrt(i)}, 1fr)`},children:u.map(m=>{const F=r(m),k=n(m);return e.jsxs(B,{align:"center",className:ue("simulator-grid__entry",p&&k.attributes[p]>0&&"simulator-grid__entry--highlighted"),orientation:"vertical",children:[e.jsxs(B,{children:[e.jsxs(E,{vertical:!0,children:[A.id&&e.jsx(Y,{item:F}),A.reliability&&e.jsx("span",{children:e.jsx(ot,{formatter:R=>`${R}%`,placeholder:"Reliability",prefix:e.jsx(qt,{}),readOnly:!0,size:"small",style:{width:"8ch"},value:k.reliability,variant:"borderless"})}),A.id&&e.jsx(ne,{item:F})]}),e.jsx(H,{item:F,width:50})]}),A.nameEn&&e.jsx(z,{item:F,language:"en"}),A.namePt&&e.jsx(z,{item:F,language:"pt"})]},m)})}),e.jsx("div",{className:"simulator-grid my-4",children:f.map(m=>e.jsxs(Lt,{className:ue("simulator-grid__entry","simulator-grid__button",p===m.id&&"simulator-grid__entry--highlighted"),onClick:()=>y(m.id),children:[m.name.en," ",Rs[m.level],e.jsxs(E,{className:"my-1",gap:6,justify:"center",children:[e.jsxs("span",{children:[e.jsx(ct,{style:{color:m.deterministicCount?"dodgerblue":void 0}})," ",m.deterministicCount??0]}),e.jsxs("span",{children:[e.jsx(Nt,{style:{color:m.relatedCount?"green":void 0}})," ",m.relatedCount??0]}),e.jsxs("span",{children:[e.jsx(Bt,{style:{color:m.oppositeCount?"red":void 0}})," ",m.oppositeCount??0]}),e.jsxs("span",{children:[e.jsx(Oe,{style:{color:m.unclearCount?"gold":void 0}})," ",m.unclearCount??0]})]})]},m.id))}),e.jsx(Ps,{})]})}function Ls(t,s,n){const r={},l={};t.forEach(g=>{g&&Object.keys(g.attributes).forEach(p=>{g.attributes[p]>0&&(r[p]=(r[p]||0)+1),g.attributes[p]===w.DETERMINISTIC&&(l[p]=!0,r[p]=(r[p]||0)+2),g.attributes[p]===w.OPPOSITE&&(r[p]=(r[p]||0)+1)})});const i={1:0,2:0,3:0,4:0};function o(g){return g.filter(p=>(i[n[p].level]++,i[4]>1?(console.log("Discarding level 4 attribute",p),!1):!0))}const c=o(Object.keys(l)),d=o(b.keys(r).filter(g=>!c.includes(g)));if(console.log({levelCount:i}),s===c.length)return console.log("All keys are deterministic"),c;if(console.log(r),c.length===0)return[];const h=c.reduce((g,p)=>{const y=r[p];return g[y]||(g[y]=[]),g[y].push(p),g},{}),a=b.keys(h).sort((g,p)=>Number(p)-Number(g));console.log({sortedDeterministicTiedGroupsKeys:a});const u=d.reduce((g,p)=>{const y=r[p];return g[y]||(g[y]=[]),g[y].push(p),g},{});console.log(u);const x=b.keys(u).sort((g,p)=>Number(p)-Number(g)),f=[];for(const g of a){if(f.length===s)break;f.push(...b.sampleSize(h[g],s-f.length))}for(const g of x){if(f.length===s)break;f.push(...b.sampleSize(u[g],s-f.length))}return f}function Ds(){const{attributes:t}=U(),s=[{key:"1",label:"All Attributes",children:e.jsx(J,{type:"all"})},{key:"2",label:"Default",children:e.jsx(J,{type:"default"})},{key:"3",label:"Custom",children:e.jsx(J,{type:"custom"})},{key:"4",label:"Limited",children:e.jsx(J,{type:"limited"})},{key:"5",label:"Specific",children:e.jsx(J,{type:"specific"})},{key:"6",label:"Opposite",children:e.jsx(J,{type:"opposite"})}];return e.jsxs("div",{className:"my-4",children:[e.jsxs(E,{align:"center",justify:"space-between",children:[e.jsx(V.Title,{level:5,children:"Stats"}),e.jsx(De,{data:()=>Vs(t),fileName:"items-attributes.json",children:"Download Attribute Json"})]}),e.jsx(Dt,{defaultActiveKey:"1",items:s})]})}const Us=(t,s)=>{let n=0,r=0,l=0,i=0,o=0,c=0,d=0,h=0;s.forEach(({attributes:v})=>{if(v[t.id]){n++;const T=v[t.id];T===10?r++:T===5?l++:T===0||!T?i++:T===-1?o++:T===-3?c++:T===-10&&d++,T>0&&h++}});const a=s.length,u=n/a*100,x=r/a*100,f=l/a*100,g=i/a*100,p=o/a*100,y=c/a*100,A=d/a*100,C=h/a*100;return{completionPercentage:u.toFixed(1),tensPercentage:x.toFixed(1),fivesPercentage:f.toFixed(1),zerosPercentage:g.toFixed(1),negativeOnesPercentage:p.toFixed(1),negativeThreesPercentage:y.toFixed(1),negativeTensPercentage:A.toFixed(1),positivePercentage:C.toFixed(1)}};function J({type:t}){const{availableItemIds:s,getItemAttributeValues:n,attributesList:r}=U(),l=rt(),{is:i}=D(),o=I.useMemo(()=>{const a=new Array(65).fill(0).map((x,f)=>f),u=r.map(x=>x.spriteId);return a.filter(x=>!u.includes(`sign-${x}`))},[r]),c=I.useMemo(()=>t==="default"?r.filter(a=>a.default):t==="custom"?r.filter(a=>!a.default):t==="limited"?r.filter(a=>a.limited):t==="specific"?r.filter(a=>a.specific):t==="opposite"?r.filter(a=>a.oppositeId):r,[r,t]),d=I.useMemo(()=>{const a=s.map(u=>n(u));return c.map(u=>({...u,...Us(u,a)}))},[c,s,n]),h=[{title:"Attribute",dataIndex:"name",key:"name",render:(a,u)=>e.jsxs(E,{align:"center",gap:8,children:[i("showGlyphs")&&e.jsx(K,{signId:u.spriteId,width:30}),a.en,u.default&&e.jsx(ee,{className:"ml-1",children:"default"}),u.limited&&e.jsx(ee,{className:"ml-1",children:"limited"}),(u.specific||u.parentId)&&e.jsx(ee,{className:"ml-1",children:"specific"}),u.oppositeId&&e.jsx(ee,{className:"ml-1",children:e.jsx(nt,{})}),e.jsx(Ke,{title:u.description.en})]}),sorter:(a,u)=>a.name.en.localeCompare(u.name.en)},{title:e.jsx(Ut,{}),dataIndex:"spriteId",key:"spriteId",render:a=>e.jsx(K,{padding:0,signId:a,width:18})},{title:"Priority",dataIndex:"priority",key:"priority",sorter:(a,u)=>a.priority-u.priority},{title:"Positive",dataIndex:"positivePercentage",key:"positivePercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.positivePercentage)-Number.parseFloat(u.positivePercentage)},{title:"10",dataIndex:"tensPercentage",key:"tensPercentage",render:(a,u)=>u.limited?"-":`${a}%`,sorter:(a,u)=>Number.parseFloat(a.tensPercentage)-Number.parseFloat(u.tensPercentage)},{title:"5",dataIndex:"fivesPercentage",key:"fivesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.fivesPercentage)-Number.parseFloat(u.fivesPercentage)},{title:"-1",dataIndex:"negativeOnesPercentage",key:"negativeOnesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeOnesPercentage)-Number.parseFloat(u.negativeOnesPercentage)},{title:"-3",dataIndex:"negativeThreesPercentage",key:"negativeThreesPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeThreesPercentage)-Number.parseFloat(u.negativeThreesPercentage)},{title:"-10",dataIndex:"negativeTensPercentage",key:"negativeTensPercentage",render:a=>`${a}%`,sorter:(a,u)=>Number.parseFloat(a.negativeTensPercentage)-Number.parseFloat(u.negativeTensPercentage)},{title:"Completion",dataIndex:"completionPercentage",key:"completionPercentage",render:a=>e.jsx(Ve,{percent:Number.parseFloat(a),size:"small"}),sorter:(a,u)=>Number.parseFloat(a.completionPercentage)-Number.parseFloat(u.completionPercentage)},{title:"Level",dataIndex:"level",key:"level",render:a=>e.jsx(Vt,{count:4,disabled:!0,value:a}),sorter:(a,u)=>a.level-u.level},{title:"Actions",key:"actions",render:a=>e.jsx(B,{children:e.jsxs(B.Compact,{children:[e.jsx(P,{onClick:()=>l(`/items/attribution?display=grouping&attribute=${a.id}&page=1`),shape:"round",size:"small",children:"Grouping"}),e.jsx(P,{onClick:()=>l(`/items/attribution?display=sampler&attribute=${a.id}&size=6`),shape:"round",size:"small",children:"Sample"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(V.Paragraph,{children:["Total: ",d.length]}),e.jsx(Fe,{columns:h,dataSource:d,pagination:!1,rowKey:"id",size:"small"}),e.jsx(E,{gap:8,wrap:"wrap",children:o.map(a=>e.jsxs("div",{children:["#",a,e.jsx(K,{signId:`sign-${a}`},a)]},a))})]})}function Vs(t){const s=b.cloneDeep(t);return ve(Ue(s),["description","priority","level","spriteId","oppositeId","relatedId","default","limited","specific","keywords"])}function Fs(){const{queryParams:t}=D(),s=t.get("display")??"classifier";return s==="classifier"?e.jsxs(e.Fragment,{children:[e.jsxs(E,{align:"center",className:"my-4",gap:8,wrap:!0,children:[e.jsx(js,{}),e.jsx(vs,{}),e.jsx(ys,{}),e.jsx(dt,{path:"/tdr/itemsAttributeValues"})]}),e.jsx(xs,{}),e.jsx(E,{className:"my-4",justify:"flex-end",children:e.jsx(qe,{})})]}):s==="sampler"?e.jsx(Ns,{}):s==="grouping"?e.jsx(Ss,{}):s==="comparator"?e.jsx(Ts,{}):s==="simulator"?e.jsx(Os,{}):s==="stats"?e.jsx(Ds,{}):e.jsx(se,{className:"my-10",description:"Unknown display has been selected"})}function Ms(){const{isLoading:t,error:s,hasResponseData:n}=U();return e.jsx(it,{subtitle:"Attribution",title:"Items",children:e.jsxs(Ae,{hasSider:!0,children:[e.jsx(pt,{children:e.jsx(ps,{})}),e.jsx(Ae.Content,{className:"content",children:e.jsx(at,{error:s,hasResponseData:n,isLoading:t,children:e.jsx(Fs,{})})})]})})}function Dr(){return e.jsx(as,{children:e.jsx(Ms,{})})}export{Dr as default};
