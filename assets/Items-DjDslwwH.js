import{r as f,a as M,_ as F,j as e,a9 as G,T as N,ab as K,B as b,D as R,ac as U,P as X,L as V}from"./index-CWquaFps.js";import{D as Y}from"./DataLoadingWrapper-yvQZSH9H.js";import{u as Z,P as ee}from"./useGridPagination-Bwt4C8OB.js";import{u as I}from"./useQueryParams-B12ULDgv.js";import{u as se}from"./useResourceFirebaseData-6N0thK3z.js";import{l as x}from"./lodash-DN__MM7W.js";import{L as S}from"./LanguageFlag-mAKqHiOH.js";import{I as ne}from"./Item-DlQY3ZuO.js";import{u as $}from"./useCopyToClipboardFunction-CeZAy4Jp.js";import{C as ae}from"./index-BuKJSaVc.js";import{S as P}from"./index-DmiZ8iOI.js";import{I as _}from"./index-Dhbmiuik.js";import{S as D}from"./index-DGHTv9Rc.js";import{F as C}from"./index-Cs2-JnCz.js";import{F as J}from"./index-nb3C9kpP.js";import{S as te}from"./index-4zT9NDAS.js";import{R as ie}from"./FireFilled-HrdA3up2.js";import{R as oe}from"./SaveOutlined-CEzCu1xq.js";import{u as le}from"./useToggle-B994fxhp.js";import{c as T,a as re,T as ce}from"./FilterEntries-CuxGpui_.js";import{S as de}from"./SiderContent-kkNUB5zW.js";import{D as A}from"./DownloadButton-CPT6_l49.js";import{S as me}from"./SaveButton-BTWVJYzt.js";import{a as W,d as pe,r as ue}from"./index-BiZagVnt.js";import{M as he}from"./index-BuJqcVSf.js";import{D as fe}from"./index-Drst0hJx.js";import{I as ge}from"./ItemsTypeahead-3LOKY3H4.js";import{R as xe}from"./EnvironmentOutlined-HhQScN-r.js";import{P as je}from"./useBaseUrl-BEB53hOu.js";import"./Pagination-CBhSKMmC.js";import"./useGetFirebaseDoc-WnsJfxXy.js";import"./useTDResource-Ch2HxjPP.js";import"./useUpdateFirebaseDoc-BMAGqJRk.js";import"./useMutation-VOp9NxuL.js";import"./PlusOutlined-CGch_Slg.js";import"./gapSize-U1swVQyS.js";import"./Input-VPsu6Iqt.js";import"./index-Uq0a3ZLy.js";import"./moment-C5S46NFB.js";import"./constants-BL_kRTFX.js";import"./useDebounce-CJ3DzJ_v.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"},ye=function(t,a){return f.createElement(M,F({},t,{ref:a,icon:ve}))},be=f.forwardRef(ye),ke={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482.88 128c-84.35 0-156.58 52.8-185.68 126.98-60.89 8.13-115.3 43.63-146.6 97.84-42.16 73-32.55 161.88 17.14 224.16-23.38 56.75-19.85 121.6 11.42 175.78 42.18 73.02 124.1 109.15 202.94 97.23C419.58 898.63 477.51 928 540.12 928c84.35 0 156.58-52.8 185.68-126.98 60.89-8.13 115.3-43.62 146.6-97.84 42.16-73 32.55-161.88-17.14-224.16 23.38-56.75 19.85-121.6-11.42-175.78-42.18-73.02-124.1-109.15-202.94-97.23C603.42 157.38 545.49 128 482.88 128m0 61.54c35.6 0 68.97 13.99 94.22 37.74-1.93 1.03-3.92 1.84-5.83 2.94l-136.68 78.91a46.11 46.11 0 00-23.09 39.78l-.84 183.6-65.72-38.34V327.4c0-76 61.9-137.86 137.94-137.86m197.7 75.9c44.19 3.14 86.16 27.44 109.92 68.57 17.8 30.8 22.38 66.7 14.43 100.42-1.88-1.17-3.6-2.49-5.53-3.6l-136.73-78.91a46.23 46.23 0 00-46-.06l-159.47 91.1.36-76.02 144.5-83.41a137.19 137.19 0 0178.53-18.09m-396.92 55.4c-.07 2.2-.3 4.35-.3 6.56v157.75a46.19 46.19 0 0022.91 39.9l158.68 92.5-66.02 37.67-144.55-83.35c-65.86-38-88.47-122.53-50.45-188.34 17.78-30.78 46.55-52.69 79.73-62.68m340.4 79.93l144.54 83.35c65.86 38 88.47 122.53 50.45 188.34-17.78 30.78-46.55 52.69-79.73 62.68.07-2.19.3-4.34.3-6.55V570.85a46.19 46.19 0 00-22.9-39.9l-158.69-92.5zM511.8 464.84l54.54 31.79-.3 63.22-54.84 31.31-54.54-31.85.3-63.16zm100.54 58.65l65.72 38.35V728.6c0 76-61.9 137.86-137.94 137.86-35.6 0-68.97-13.99-94.22-37.74 1.93-1.03 3.92-1.84 5.83-2.94l136.68-78.9a46.11 46.11 0 0023.09-39.8zm-46.54 89.55l-.36 76.02-144.5 83.41c-65.85 38-150.42 15.34-188.44-50.48-17.8-30.8-22.38-66.7-14.43-100.42 1.88 1.17 3.6 2.5 5.53 3.6l136.74 78.91a46.23 46.23 0 0046 .06z"}}]},name:"open-a-i",theme:"outlined"},we=function(t,a){return f.createElement(M,F({},t,{ref:a,icon:ke}))},Ie=f.forwardRef(we),Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},Se=function(t,a){return f.createElement(M,F({},t,{ref:a,icon:Ce}))},Ne=f.forwardRef(Se);const H=f.createContext({items:{},isLoading:!0,error:null,hasResponseData:!1,decksDict:{},decks:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1"}),Oe=({children:s})=>{const{queryParams:t}=I(),{data:a,isLoading:n,error:o,isSaving:u,save:c,addEntryToUpdate:m,entriesToUpdate:r,isDirty:v}=se({tdrResourceName:"items",firebaseDataCollectionName:"items"}),{decksDict:i,decks:h}=f.useMemo(()=>{console.log("Recomputing item decks typeahead...");const y={},p={},j={},w=[];Object.values(a).forEach(g=>{var L;const q=`${g.name.en} (${g.id})`,Q=`${g.name.pt} (${g.id})`;p[g.name.en]?w.push([`${g.name.en} (${p[g.name.en]})`,q]):p[g.name.en]=g.id,j[g.name.pt]?w.push([`${g.name.pt} (${j[g.name.pt]})`,Q]):j[g.name.pt]=g.id,(L=g==null?void 0:g.decks)==null||L.forEach(B=>{y[B]=B})});const O=x.orderBy(Object.keys(y)).map(g=>({value:g}));return w.length>0&&console.warn("Possible duplicated items",w),{decksDict:y,decks:O}},[a,u,n]),l=t.get("deck")??"all",d=f.useMemo(()=>{const y=x.orderBy(Object.values(a),[p=>Number(p.id)],"asc");switch(l){case"all":return y;case"!all":return y.filter(p=>{var j;return!((j=p==null?void 0:p.decks)!=null&&j.length)||!0});case"nsfw":return y.filter(p=>p.nsfw);case"!nsfw":return y.filter(p=>!p.nsfw);default:return l.startsWith("!")?y.filter(p=>{var j;return!((j=p==null?void 0:p.decks)!=null&&j.includes(l.slice(1)))}):y.filter(p=>{var j;return(j=p==null?void 0:p.decks)==null?void 0:j.includes(l)})}},[a,l]),E=f.useMemo(()=>{var w;const y=x.orderBy(Object.keys(r),[O=>Number(O)],"asc"),p=(w=d[d.length-1])==null?void 0:w.id,j=x.orderBy([...y,p],[O=>Number(O)],"desc")[0];return String(Number(j)+1)},[d,r]);return e.jsx(H.Provider,{value:{items:a,listing:d,isLoading:n,error:o,decksDict:i,decks:h,hasResponseData:d.length>0,isDirty:v,addItemToUpdate:m,isSaving:u,save:c,itemsToUpdate:r,newId:E},children:s})},k=()=>f.useContext(H);function Te(s,t=!1){const{addItemToUpdate:a,itemsToUpdate:n}=k(),[o,u]=f.useState(t),[c,m]=f.useState(x.cloneDeep(s)),r=n[s.id]??s,v=d=>{const E={...x.cloneDeep(c),...d};Object.keys(d).includes("nsfw")&&d.nsfw===!1&&(E.nsfw=void 0),m(E)},i=async()=>{a(c.id,c)},h=()=>{m(x.cloneDeep(s)),u(!1)},l=JSON.stringify(r)!==JSON.stringify(c);return{isEditing:o,toggleEditMode:()=>u(d=>!d),editableItem:c,onEdit:v,isDirty:l,onModify:i,onReset:h}}function z({item:s,editMode:t=!1,simplified:a}){const{decks:n}=k(),{isEditing:o,toggleEditMode:u,onEdit:c,isDirty:m,onModify:r,onReset:v,editableItem:i}=Te(s,t),h=$(),{is:l}=I();return e.jsxs(ae,{title:e.jsx(N.Text,{onClick:()=>h(s.id),children:s.id}),extra:e.jsx(ze,{item:s}),style:{maxWidth:250},size:a?"small":"default",actions:a?void 0:m?[e.jsx(Ne,{onClick:v},"reset"),e.jsx(oe,{onClick:r},"save")]:[e.jsx(G,{onClick:u},"edit")],children:[e.jsx(ne,{id:s.id,width:a?75:125,title:`${s.name.en} | ${s.name.pt}`}),e.jsxs(P,{size:"small",direction:"vertical",className:"my-4",children:[e.jsx(_,{prefix:e.jsx(S,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:o?"outlined":"borderless",size:"small",defaultValue:s.name.en,readOnly:!o,onChange:d=>c({name:{...i.name,en:d.target.value}})},`en-${s.name.en}`),e.jsx(_,{prefix:e.jsx(S,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:o?"outlined":"borderless",size:"small",defaultValue:s.name.pt,readOnly:!o,onChange:d=>c({name:{...i.name,pt:d.target.value}})},`pt-${s.name.pt}`),!a&&e.jsxs(e.Fragment,{children:[!l("simplified")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(D,{mode:"multiple",style:{width:"100%"},placeholder:"Select a deck",defaultValue:s.decks,disabled:!o,options:n,variant:o?"outlined":"borderless",size:"small",onChange:d=>c({decks:d.sort()})},String(s.decks))}),e.jsxs(C,{gap:6,children:[e.jsx(S,{language:"en",width:"1em"}),e.jsx(D,{mode:"tags",style:{width:"100%"},placeholder:"Other names EN",defaultValue:s.aliasesEn,options:[],size:"small",onChange:d=>c({aliasesEn:d.sort()})})]}),e.jsxs(C,{gap:6,children:[e.jsx(S,{language:"pt",width:"1em"}),e.jsx(D,{mode:"tags",style:{width:"100%"},placeholder:"Other names PT",defaultValue:s.aliasesPt,options:[],size:"small",onChange:d=>c({aliasesPt:d.sort()})})]})]}),l("showVerifyThing")&&e.jsx("div",{children:e.jsx(Pe,{item:s})}),(o||s.nsfw)&&e.jsx("div",{children:e.jsx(J.Item,{label:"nsfw",valuePropName:"checked",children:e.jsx(te,{checked:s.nsfw,onChange:d=>c({nsfw:d}),size:"small",checkedChildren:e.jsx(ie,{style:{color:"hotpink"}}),disabled:!o})})})]})]})]})}const Re=x.memoize(s=>{var c,m;const t=!!((c=s.decks)!=null&&c.includes("thing")),a=!!((m=s.decks)!=null&&m.includes("manufactured")),n=s.name.en.split(" ").length===1,o=s.name.pt.split(" ").length===1,u={en:t||n&&a,pt:t||o&&a};return!u.pt&&!u.en?"":e.jsxs(e.Fragment,{children:[u.en&&e.jsx(S,{language:"en",width:"1em"}),u.pt&&e.jsx(S,{language:"pt",width:"1em"})]})}),Pe=({item:s})=>{const t=Re(s);return t?e.jsxs(C,{gap:6,children:["Thing: ",t]}):e.jsx(e.Fragment,{})},Ee=s=>({id:s.id,type:"item",header:{title:{en:"Item",pt:"Item"},iconId:"2077"},metadata:{level:"basic",keyword:x.snakeCase(s.name.en).toUpperCase()},content:{itemId:s.id,caption:s.name}});function ze({item:s}){const[t,a]=le(!1),n=$();return e.jsx(K,{content:e.jsxs(P,{direction:"vertical",children:[e.jsx(b,{size:"small",onClick:()=>n(JSON.stringify(s,null,2)),children:"Complete Item"}),e.jsx(b,{size:"small",onClick:()=>n(s.name.en),children:"EN Name"}),e.jsx(b,{size:"small",onClick:()=>n(s.name.pt),children:"PT Name"}),e.jsx(b,{size:"small",onClick:()=>n(JSON.stringify(Ee(s),null,2)),children:"Escape Room Item"})]}),title:"Copy",trigger:"click",open:t,onOpenChange:a,children:e.jsx(b,{type:"text",icon:e.jsx(be,{})})})}function De(){const{queryParams:s}=I(),t=s.get("deck")??"all",{listing:a}=k(),{page:n,pagination:o}=Z({data:a,resetter:t}),{is:u}=I(),c=u("simplified");return e.jsxs(e.Fragment,{children:[e.jsxs(N.Title,{level:2,children:["Listing - ",x.capitalize(t)," items (",a.length,")"]}),e.jsx(ee,{pagination:o,className:"full-width",children:e.jsx(C,{gap:16,wrap:"wrap",children:n.map(m=>e.jsx(z,{item:m,simplified:c},m.id))})})]})}const Me={id:"",name:{en:"",pt:""},groups:[]};function Fe({isModalOpen:s,handleOk:t,handleCancel:a,newId:n}){const[o]=f.useState(x.cloneDeep({...Me,id:n}));return e.jsx(he,{title:"Add new item",open:s,onOk:t,onCancel:a,children:e.jsx(z,{item:o,editMode:!0})})}function $e(){const[s,t]=f.useState(!1),{newId:a}=k(),n=()=>{t(!0)},o=()=>{t(!1)},u=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(b,{block:!0,onClick:n,children:"Add New Item"}),s&&e.jsx(Fe,{isModalOpen:s,handleOk:o,handleCancel:u,newId:a},a)]})}function Le(){const{isDirty:s,save:t,items:a,decks:n,itemsToUpdate:o,isSaving:u}=k(),{queryParams:c,is:m,addParam:r}=I(),v=f.useMemo(()=>{const i=x.orderBy(n.map(({value:l})=>({label:x.capitalize(l),value:l})),"label"),h=i.map(({label:l,value:d})=>({label:`NOT ${l}`,value:`!${d}`}));return[...i,...h]},[n]);return e.jsxs(de,{children:[e.jsxs(C,{vertical:!0,gap:6,children:[e.jsx(me,{isDirty:s,dirt:JSON.stringify(o),onSave:t,isSaving:u}),e.jsx(A,{data:()=>Be(a),fileName:"items.json",disabled:s,block:!0})]}),e.jsx(R,{className:"my-4"}),e.jsx(N.Text,{type:"secondary",children:"Tools"}),e.jsx(T,{label:"Show Search",value:!m("hideSearch"),onChange:i=>r("hideSearch",i?"":"true",""),className:"full-width m-0"}),e.jsx(T,{label:"Show Randomizer",value:m("showRandomizer"),onChange:i=>r("showRandomizer",i?"true":"",""),className:"full-width m-0"}),e.jsx(N.Text,{type:"secondary",children:"Display"}),e.jsx(T,{label:"Simplified UI",value:m("simplified"),onChange:i=>r("simplified",i?"true":""),className:"full-width m-0"}),e.jsx(T,{label:"Thing Verifier",value:m("showVerifyThing"),onChange:i=>r("showVerifyThing",i?"true":""),className:"full-width m-0",disabled:m("simplified")}),e.jsx(T,{label:"Other Names",value:m("showOtherNames"),onChange:i=>r("showOtherNames",i?"true":""),className:"full-width m-0",disabled:!0}),e.jsx(R,{className:"my-4"}),e.jsx(re,{label:"Deck",value:c.get("deck")??"all",onChange:i=>r("deck",i,"all"),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...v,{label:"No decks",value:"!all"}]}),e.jsx(R,{className:"my-4"}),e.jsx($e,{}),e.jsx(R,{className:"my-4"}),e.jsx(A,{data:()=>Ue(a),fileName:"items-gpt.json",disabled:s,block:!0,icon:e.jsx(Ie,{}),children:"Open AI JSON"})]})}function Be(s){console.log("Preparing file for download...");const t=x.cloneDeep(s);return Object.values(t).reduce((a,n)=>(n.aliasesEn=Object.values(n.aliasesEn??{}).sort(),n.aliasesEn.length===0&&(n.aliasesEn=void 0),n.aliasesPt=Object.values(n.aliasesPt??{}).sort(),n.aliasesPt.length===0&&(n.aliasesPt=void 0),n.decks=Object.values((n==null?void 0:n.decks)??{}).sort(),n.decks.length===0&&(n.decks=void 0),a[n.id]=n,a),{}),W(pe(t))}function Ue(s){return W(Object.values(x.cloneDeep(s)).reduce((t,a)=>{const n={id:a.id,names:{"en-US":a.name.en,"pt-BR":a.name.pt},aliases:{"en-US":a.aliasesEn,"pt-BR":a.aliasesPt}};return t[n.id]=n,t},{}))}function Ve(){const{listing:s}=k(),[t,a]=f.useState([]),n=$(),[o,u]=f.useState(5),c=()=>{a(x.sampleSize(s,o))},m=[{label:"Copy IDs",key:"copy_ids"},{label:"Copy Names EN",key:"copy_names_en"},{label:"Copy Names PT",key:"copy_names_pt"}],r=({key:i})=>{if(i==="copy_ids"){const h=t.map(l=>l.id);n(JSON.stringify(h));return}if(i==="copy_names_en"){const h=t.map(l=>l.name.en).join(", ");n(h);return}if(i==="copy_names_pt"){const h=t.map(l=>l.name.pt).join(", ");n(h);return}},v=()=>{const i=x.chunk(x.sampleSize(s,o*15),o).map(h=>h.filter(l=>!l.nsfw)).map(h=>h.map(l=>l.name.en).join(", ")).map((h,l)=>`${l+1}) ${h}`).join(`
`);n(i)};return e.jsxs("div",{children:[e.jsxs(N.Title,{level:2,children:["Randomized Sample"," ",e.jsx(b,{size:"small",icon:e.jsx(U,{}),onClick:v,children:"MJ"})]}),e.jsxs(C,{gap:12,children:[e.jsx(J.Item,{label:"Quantity"}),e.jsx("div",{children:e.jsx(ce,{min:3,max:15,value:o,onChange:i=>u(Number(i)),style:{minWidth:"100px"}})}),e.jsx(b,{onClick:c,type:"primary",children:"Get Sample"}),e.jsx(fe.Button,{menu:{items:m,onClick:r},disabled:t.length===0,onClick:()=>n(JSON.stringify(t,null,2)),icon:e.jsx(U,{}),children:"Copy"})]}),e.jsx(P,{wrap:!0,className:"my-4",children:t.map(i=>e.jsx(z,{item:i,simplified:!0},i.id))})]})}function _e(){const{items:s,isLoading:t,isSaving:a}=k(),[n,o]=f.useState(null),{queryParams:u,addParam:c}=I(),m=r=>{const v=Number(u.get("pageSize")??64),i=Number(r),h=Math.floor(i/v)+1;c("page",h.toString())};return e.jsxs(f.Fragment,{children:[e.jsx(N.Title,{level:2,children:"Search for an item"}),e.jsx("div",{children:e.jsx(ge,{items:s,isPending:t||a,onFinish:r=>o([s[r]]),onFinishMultiple:r=>o(ue(r).map(v=>s[v]))})}),e.jsx(C,{className:"my-4",gap:8,children:n==null?void 0:n.map(r=>e.jsxs(P,{direction:"vertical",className:"my-4",children:[e.jsx(z,{item:r}),e.jsx(b,{onClick:()=>m(r.id),block:!0,icon:e.jsx(xe,{}),children:"Find in listing"})]},r.id))})]},`item-search-${t}`)}function Ae(){const{isLoading:s,error:t,hasResponseData:a}=k(),{is:n}=I();return e.jsx(X,{title:"Items",subtitle:"Listing",children:e.jsxs(V,{hasSider:!0,children:[e.jsx(je,{children:e.jsx(Le,{})}),e.jsx(V.Content,{className:"content",children:e.jsxs(Y,{isLoading:s,error:t,hasResponseData:a,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{size:"large",align:"start",children:[!n("hideSearch")&&e.jsx(_e,{}),n("showRandomizer")&&e.jsx(Ve,{})]}),e.jsx(R,{})]}),e.jsx(De,{})]})})]})})}function Ps(){return e.jsx(Oe,{children:e.jsx(Ae,{})})}export{Ps as default};
