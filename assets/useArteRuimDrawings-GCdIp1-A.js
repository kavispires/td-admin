var U=r=>{throw TypeError(r)};var P=(r,s,e)=>s.has(r)||U("Cannot "+e);var u=(r,s,e)=>(P(r,s,"read from private field"),e?e.call(r):s.get(r)),v=(r,s,e)=>s.has(r)?U("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,e),b=(r,s,e,t)=>(P(r,s,"write to private field"),t?t.call(r,e):s.set(r,e),e),O=(r,s,e)=>(P(r,s,"access private method"),e);import{aM as G,aN as q,aO as X,O as J,r as A,j as $,Q as Y,aP as Z}from"./index-DR-bKtYd.js";import{Q as W,b as ss,d as es,e as ts,f as rs,g as is,n as ns,s as _,h as K,w as os,i as as,a as us}from"./useBaseUrl-KlB5gb15.js";import{g as z}from"./useGetFirebaseDoc-B24d1TAL.js";import{u as cs}from"./useTDResource-JIAXcSBb.js";import{l as ds}from"./lodash-7X0uo9vL.js";import{g as fs}from"./constants-Bukqt1PU.js";function H(r,s){return r.filter(e=>!s.includes(e))}function hs(r,s,e){const t=r.slice(0);return t[s]=e,t}var x,y,S,L,w,E,D,M,k,p,N,F,j,T,B,V,ls=(V=class extends G{constructor(s,e,t){super();v(this,p);v(this,x);v(this,y);v(this,S);v(this,L);v(this,w);v(this,E);v(this,D);v(this,M);v(this,k,[]);b(this,x,s),b(this,L,t),b(this,S,[]),b(this,w,[]),b(this,y,[]),this.setQueries(e)}onSubscribe(){this.listeners.size===1&&u(this,w).forEach(s=>{s.subscribe(e=>{O(this,p,T).call(this,s,e)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,u(this,w).forEach(s=>{s.destroy()})}setQueries(s,e,t){b(this,S,s),b(this,L,e),q.batch(()=>{const i=u(this,w),n=O(this,p,j).call(this,u(this,S));b(this,k,n),n.forEach(c=>c.observer.setOptions(c.defaultedQueryOptions,t));const o=n.map(c=>c.observer),d=o.map(c=>c.getCurrentResult()),a=o.some((c,f)=>c!==i[f]);i.length===o.length&&!a||(b(this,w,o),b(this,y,d),this.hasListeners()&&(H(i,o).forEach(c=>{c.destroy()}),H(o,i).forEach(c=>{c.subscribe(f=>{O(this,p,T).call(this,c,f)})}),O(this,p,B).call(this)))})}getCurrentResult(){return u(this,y)}getQueries(){return u(this,w).map(s=>s.getCurrentQuery())}getObservers(){return u(this,w)}getOptimisticResult(s,e){const t=O(this,p,j).call(this,s),i=t.map(n=>n.observer.getOptimisticResult(n.defaultedQueryOptions));return[i,n=>O(this,p,F).call(this,n??i,e),()=>O(this,p,N).call(this,i,t)]}},x=new WeakMap,y=new WeakMap,S=new WeakMap,L=new WeakMap,w=new WeakMap,E=new WeakMap,D=new WeakMap,M=new WeakMap,k=new WeakMap,p=new WeakSet,N=function(s,e){return e.map((t,i)=>{const n=s[i];return t.defaultedQueryOptions.notifyOnChangeProps?n:t.observer.trackResult(n,o=>{e.forEach(d=>{d.observer.trackProp(o)})})})},F=function(s,e){return e?((!u(this,E)||u(this,y)!==u(this,M)||e!==u(this,D))&&(b(this,D,e),b(this,M,u(this,y)),b(this,E,X(u(this,E),e(s)))),u(this,E)):s},j=function(s){const e=new Map(u(this,w).map(i=>[i.options.queryHash,i])),t=[];return s.forEach(i=>{const n=u(this,x).defaultQueryOptions(i),o=e.get(n.queryHash);o?t.push({defaultedQueryOptions:n,observer:o}):t.push({defaultedQueryOptions:n,observer:new W(u(this,x),n)})}),t},T=function(s,e){const t=u(this,w).indexOf(s);t!==-1&&(b(this,y,hs(u(this,y),t,e)),O(this,p,B).call(this))},B=function(){var s;if(this.hasListeners()){const e=u(this,E),t=O(this,p,N).call(this,u(this,y),u(this,k)),i=O(this,p,F).call(this,t,(s=u(this,L))==null?void 0:s.combine);e!==i&&q.batch(()=>{this.listeners.forEach(n=>{n(u(this,y))})})}},V);function ps({queries:r,...s},e){const t=J(),i=ss(),n=es(),o=A.useMemo(()=>r.map(m=>{const R=t.defaultQueryOptions(m);return R._optimisticResults=i?"isRestoring":"optimistic",R}),[r,t,i]);o.forEach(m=>{ts(m),rs(m,n)}),is(n);const[d]=A.useState(()=>new ls(t,o,s)),[a,c,f]=d.getOptimisticResult(o,s.combine),h=!i&&s.subscribed!==!1;A.useSyncExternalStore(A.useCallback(m=>h?d.subscribe(q.batchCalls(m)):ns,[d,h]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),A.useEffect(()=>{d.setQueries(o,s,{listeners:!1})},[o,s,d]);const g=a.some((m,R)=>_(o[R],m))?a.flatMap((m,R)=>{const l=o[R];if(l){const I=new W(t,l);if(_(l,m))return K(l,I,n);os(m,i)&&K(l,I,n)}return[]}):[];if(g.length>0)throw Promise.all(g);const C=a.find((m,R)=>{const l=o[R];return l&&as({result:m,errorResetBoundary:n,throwOnError:l.throwOnError,query:t.getQueryCache().get(l.queryHash),suspense:l.suspense})});if(C!=null&&C.error)throw C.error;return c(f())}const ms=r=>r.map(e=>{let t="";for(let i=0,n=1;n<e.length;i+=2,n+=2)e[i+2]&&e[n+2]&&(t+=`M${e[i]},${e[n]} L${e[i+2]},${e[n+2]}`);return t}),Qs=({drawing:r="",className:s="",width:e=250,height:t,strokeWidth:i="medium",viewBox:n="0 0 500 500"})=>{const o=JSON.parse(r),d=ms(o),a={small:3,medium:5,large:7}[i]??5;return $.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:n,overflow:"hidden",className:s,style:{width:`${e}px`,height:`${t||e}px`},children:[$.jsx("defs",{}),d.map((c,f)=>$.jsx("path",{d:c,fill:"none",stroke:"#000",strokeWidth:a,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10"},`${r}-${f}`))]})};function gs(r,s){var c;const e={pt:"drawingsPT",en:"drawingsEN"},{notification:t}=Y.useApp(),i=us({queryKey:["data","suffixCounts"],queryFn:z("data","suffixCounts"),enabled:r});A.useEffect(()=>{i.isSuccess&&Z("Loaded data/suffixCounts")},[i.isSuccess]),A.useEffect(()=>{i.isError&&t.error({message:"Error loading data/suffixCounts",placement:"bottomLeft"})},[i.isError]);const n=e[s??"pt"],o=((c=i.data)==null?void 0:c[n])??0,d=`drawings${s==="pt"?"PT":"EN"}`,a=A.useMemo(()=>new Array(o).fill(0).map((f,h)=>({queryKey:["data",`${d}${h+1}`],queryFn:z("data",`${d}${h+1}`),enabled:r&&!!o,onSuccess:()=>{t.info({message:`Data Drawings ${d}${h+1} loaded`,placement:"bottomLeft"})}})),[o,d,r]);return ps({queries:a})}function bs(r){const e=r.split(/::|:;|;;/)[1],t=Number(e);return Number.isNaN(t)&&console.log("ðŸ”† Invalid createdAt",r,t),Number.isNaN(t)?16191612e5:t}function Cs(r,s){const e=gs(r,s),t=cs(`arte-ruim-drawings-${s}`,r),i=e.some(a=>a.isLoading),n=e.every(a=>a.isSuccess),o=A.useMemo(()=>{if(!n)return{};if(!t.isSuccess)return{};const a=t.data??{};return(e??[]).forEach(c=>{const f=c.data??{};Object.entries(f).forEach(([h,Q])=>{const g=Q.cardId??Q.id;if(g!=null&&g.includes("--"))return;if(Q.drawing.trim().length<10){console.log("ðŸ”† Empty drawing",g);return}const C=bs(h),m=Q.playerId??"unknown",l={id:[g,m,C].join(fs),drawing:Q.drawing,artistId:m,createdAt:C};a[g]===void 0?a[g]={id:g,text:Q.text,drawings:[l],updatedAt:l.createdAt}:a[g].drawings.some(I=>I.id===l.id)||(a[g].drawings.push(l),l.createdAt>a[g].updatedAt&&(a[g].updatedAt=l.createdAt))})}),a},[e,n,t.data,t.isSuccess]),d=A.useMemo(()=>Object.values(o).reduce((a,c)=>(c.drawings.forEach(f=>{const h=f.artistId;a[h]===void 0?a[h]={artistId:h,drawingsCount:1,firstDrawingAt:f.createdAt,lastDrawingAt:f.createdAt}:(a[h].drawingsCount+=1,f.createdAt<a[h].firstDrawingAt&&(a[h].firstDrawingAt=f.createdAt),f.createdAt>a[h].lastDrawingAt&&(a[h].lastDrawingAt=f.createdAt))}),a),{}),[o]);return{isLoading:i||t.isLoading,error:t.error,hasResponseData:!ds.isEmpty(o),drawings:o,drawingsPerArtist:Object.values(d)}}const xs={"3PkJr":"Flaviane","3c4lY":"Kavis",BPTEL:"Maris","0vuXf":"Marcio",Bm6dr:"Livia",QrfLz:"Stephanie",AlRvI:"Unknown",pK3OY:"Unknown",VF9iG:"Zenaide",WWUvD:"Fernanda",aec7L:"Anonymous",Xsimf:"Carol",fV5ns:"Diego",qQo9N:"Laura",yVAl7:"Rodrigo",O2IQm:"Drica","24qec":"Mariana"};export{xs as A,Qs as C,Cs as u};
