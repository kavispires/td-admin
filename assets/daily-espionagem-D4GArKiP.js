import{u as W,D as z,a as Q,c as X,A as P}from"./useParsedHistory-CluoXTiW.js";import{t as Y,a as J}from"./useTestimoniesResource-C_hjCnez.js";import{u as C}from"./useTDResource-BNwWI9qG.js";import{l as h}from"./useBaseUrl-wPMIYEDH.js";import{q as K,S as V,r as R}from"./index-BeJKp5Hd.js";const U="td-admin-debug-daily",Z=()=>{const t={"aqui-o":!1,"arte-ruim":!1,artista:!1,"comunicacao-alienigena":!1,"controle-de-estoque":!1,espionagem:!1,filmaco:!1,organiku:!1,palavreado:!1,"portais-magicos":!1,quartetos:!1,"ta-na-cara":!1,"teoria-de-conjuntos":!1};try{const e=localStorage.getItem(U);return e?JSON.parse(e):t}catch{return t}},g=new V(Z());g.subscribe(()=>{try{const t={"aqui-o":g.state["aqui-o"],"arte-ruim":g.state["arte-ruim"],artista:g.state.artista,"comunicacao-alienigena":g.state["comunicacao-alienigena"],"controle-de-estoque":g.state["controle-de-estoque"],espionagem:g.state.espionagem,filmaco:g.state.filmaco,organiku:g.state.organiku,palavreado:g.state.palavreado,"portais-magicos":g.state["portais-magicos"],quartetos:g.state.quartetos,"ta-na-cara":g.state["ta-na-cara"],"teoria-de-conjuntos":g.state["teoria-de-conjuntos"]};localStorage.setItem(U,JSON.stringify(t))}catch{}});const xe=(t,e)=>{g.setState(a=>({...a,[t]:!a[t]}))},Ee=()=>K(g,()=>g.state),p=(...t)=>{g.state.espionagem&&console.log(...t)},ee=t=>{g.state.espionagem&&console.count(t)},te=(...t)=>{g.state.espionagem&&console.error(...t)},se={male:"Ã© homem",female:"Ã© mulher",caucasian:"Ã© branco(a)",black:"Ã© negro(a)",asian:"Ã© asiÃ¡tico(a)",latino:"Ã© latino(a)",thin:"Ã© magrelo(a)",fat:"Ã© gordo(a)",large:"Ã© gordo(a)",tall:"Ã© alto(a)",short:"Ã© baixinho(a)",young:"Ã© jovem",adult:"Ã© adulto(a)",senior:"Ã© da terceira idade",average:"tem corpo normal",medium:"Ã© de altura mÃ©dia",mixed:"Ã© mestiÃ§o(a)",hat:"estÃ¡ usando um chapÃ©u",tie:"estÃ¡ usando uma gravata",glasses:"estÃ¡ usando Ã³culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",scarf:"estÃ¡ usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"Ã© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"Ã© sarado(a)",blackHair:"tem cabelo preto",hoodie:"estÃ¡ usando um moletom",earrings:"estÃ¡ usando brincos",lipstick:"estÃ¡ usando batom",necklace:"estÃ¡ usando um colar",mediumHair:"tem cabelo mÃ©dio","middle-eastern":"Ã© do Oriente MÃ©dio",headscarf:"estÃ¡ usando um lenÃ§o na cabeÃ§a",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"Ã© indiano(a)","native-american":"Ã© nativo-americano(a)",noAccessories:"estÃ¡ sem nenhum acessÃ³rio",avoidingCamera:"estÃ¡ evitando olhar para a cÃ¢mera",wearingStripes:"tem listras na roupa",blackClothes:"estÃ¡ vestindo roupas pretas",blueClothes:"estÃ¡ vestindo roupas azuis",greenClothes:"estÃ¡ vestindo roupas verdes",redClothes:"estÃ¡ vestindo roupas vermelhas",yellowClothes:"estÃ¡ vestindo roupas amarelas",purpleClothes:"estÃ¡ vestindo roupas roxas",orangeClothes:"estÃ¡ vestindo roupas laranjas",brownClothes:"estÃ¡ vestindo roupas marrons",whiteShirt:"estÃ¡ usando camisa branca",pinkClothes:"estÃ¡ vestindo roupas rosas",patternedShirt:"estÃ¡ usando roupa estampada",buttonShirt:"estÃ¡ usando camisa com botÃµes",bow:"estÃ¡ usando um laÃ§o",hairyChest:"estÃ¡ mostrando o peito peludo",wearingFlowers:"estÃ¡ usando flores",showTeeth:"estÃ¡ mostrando os dentes",hairTie:"estÃ¡ usando um xuxinha ou fita no cabelo","non-binary":"Ã© nÃ£o-binÃ¡rio(a)"},j=12,we=(t,e,a,o)=>{const[s]=W(z.ESPIONAGEM,o),i=C("suspects",{enabled:t}),n=C(`testimony-questions-${e}`,{enabled:t}),c=C("testimony-answers",{select:Y,enabled:t}),u=C("crime-reasons",{enabled:t}),m=R.useMemo(()=>re(c.data),[c.dataUpdatedAt]),r=R.useMemo(()=>ce(i.data),[i.data]);return{entries:R.useMemo(()=>!t||!s||!i.isSuccess||!n.isSuccess||!c.isSuccess||!u.isSuccess?{}:ae(a,s,i.data,n.data,m,r,u.data),[t,s,i,n,c,a,m,r,u]),isLoading:i.isLoading||n.isLoading||c.isLoading}},ae=(t,e,a,o,s,i,n)=>{ee("Creating Espionagem...");let c=e.latestDate;const u=[],m={};for(let r=0;r<t;r++){const f=Q(c);X(f),c=f;let S=null,l=0;for(;S===null&&l<P;)try{l++;const d=oe(a,o,s,i,u,n);me(d.statements)&&(S=d)}catch{}if(!S)throw new Error(`Failed to generate valid game for ${f} after ${l} attempts`);p(`Generated valid game for ${f} after ${l} attempts`),u.push(S.culpritId),m[f]={id:f,type:"espionagem",number:e.latestNumber+r+1,...S}}return m};function oe(t,e,a,o,s,i){const n=[],c={};p("SuspectTestimonyAnswers",a);const{selectedTestimonyId1:u,selectedTestimonyId2:m,culpritId:r,possibleSuspects:f,impossibleSuspects:S}=le(a,s);if(f.length<2)throw new Error("Not enough possible suspects");let l=[...f];if(f.length<j-1){const v=h.sampleSize(Object.keys(t).filter(k=>!S.includes(k)&&!f.includes(k)),j-f.length-1);l.push(...v)}const d={};Object.keys(o).forEach(v=>{if(o[v][r]===void 0){const k=Object.keys(o[v]).filter(F=>l.includes(F));if(k.length>0){const F={};k.forEach(L=>{l.includes(L)&&(F[L]=!0)}),d[v]=F}}});const b=e[u],E=G(r,l,b,a[u]);n.push(E),O(c,E.excludes);const x=e[m],w=G(r,l,x,a[m]);n.push(w),O(c,w.excludes);const y=H(r,l,d,[],"best");if(y.excludes.length===j-2)throw new Error("Best feature statement excludes too many suspects");n.push(y),O(c,y.excludes);const $=H(r,l,d,[y],"best");n.push($);const D=H(r,l,d,[y,$],"worst");n.push(D),O(c,D.excludes);const q=H(r,l,d,[y,$,D],"worst");if(n.push(q),n.length<6)throw new Error("Not enough statements generated");l=h.shuffle([...l,r]);const N=A(r,l,n,"columns");n.push(N),O(c,N.excludes);const T=A(r,l,n,"rows");n.push(T);const I=[E,D,w,y,N,q],M=[$,T],_=fe(t[r],i),B=ne([...I,...M]);return{isNsfw:b.nsfw||x.nsfw||!1,culpritId:r,statements:I,additionalStatements:M,suspects:ie(l,t,B),reason:_.title,setId:`${r}::${_.id}::${I[0].key}`,level:pe(I)}}const ne=t=>{const e={};t.forEach(o=>{if(o.key.includes(".feature.")){const s=o.key.split("not.feature.")[1];e[s]=!0}});const a={hairColor:["brownHair","blondeHair","greyHair","redHair","blackHair","coloredHair"],hairLength:["shortHair","mediumHair","longHair","bald"],facialHair:["beard","mustache","goatee"]};for(const[,o]of Object.entries(a))o.some(s=>e[s])&&o.forEach(s=>{e[s]=!0});return e},ie=(t,e,a)=>t.map(o=>{const s=e[o],i={"18-21":"young","21-30":"adult","30-40":"adult","40-50":"adult","50-60":"senior","60-70":"senior","70-80":"senior","80-90":"senior"}[s.age]||s.age,n=[s.gender,i,s.ethnicity,s.height,s.build],c=s.features.filter(u=>a[u]);return{id:s.id,name:s.name,gender:s.gender,features:[...n,...c]}}),re=t=>{const e={};p("âš™ï¸ Calculating suspect answers...");for(const a of Object.keys(t)){const o=t[a];for(const s of Object.keys(o)){const{resolution:i,projection:n}=J(s,a,o);if(!(!i&&!n)){if(e[a]===void 0&&(e[a]={}),i){e[a][s]=i==="ðŸ‘";continue}n&&(e[a][s]=n==="ðŸ‘")}}}return Object.keys(e).forEach(a=>{h.isEmpty(e[a])&&delete e[a]}),Object.keys(e).forEach(a=>{Object.keys(e[a]).length<3&&(p("â‰ï¸ Removing testimonies with less than 3 answers"),delete e[a])}),Object.keys(e).forEach(a=>{h.uniq(Object.values(e[a])).length===1&&(p("â‰ï¸ Removing testimonies with the same answer"),delete e[a])}),e},ce=t=>{const e={};for(const o of Object.keys(t)){const{gender:s,ethnicity:i,age:n,build:c,height:u,features:m}=t[o];if(!c){p("â‰ï¸ Ignoring suspect with missing build",o);continue}if(!u){p("â‰ï¸ Ignoring suspect with missing height",o);continue}if(!m||m.length===0){p("â‰ï¸ Ignoring suspect with missing features",o);continue}e[s]===void 0&&(e[s]={}),e[s][o]=!0,e[i]===void 0&&(e[i]={}),e[i][o]=!0,e[n]===void 0&&(e[n]={}),e[n][o]=!0,e[c]===void 0&&(e[c]={}),e[c][o]=!0,e[u]===void 0&&(e[u]={}),e[u][o]=!0,m.forEach(r=>{e[r]===void 0&&(e[r]={}),e[r][o]=!0})}return e.young=h.cloneDeep(e["18-21"]),e.adult=h.cloneDeep({...e["21-30"],...e["30-40"],...e["40-50"]}),e.senior=h.cloneDeep({...e["50-60"],...e["60-70"],...e["70-80"],...e["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(o=>{delete e[o]}),e},le=(t,e)=>{let a=0,o,s,i=[];for(;a<P&&!s&&i.length===0;){if(a++,o=h.sample(Object.keys(t)),!o)throw new Error("Failed to find a testimony");const r=Object.keys(t[o]);if(s=h.sample(Object.keys(t).filter(f=>f!==o&&!h.isEmpty(h.difference(r,Object.keys(t[f]))))),s){i=h.intersection(Object.keys(t[o]),Object.keys(t[s]));break}}if(!o||!s||i.length<3)throw new Error("Failed to find two related testimonies");const n=h.sample(i.filter(r=>!e.includes(r)));if(!n)throw new Error("Failed to determine a culprit from common suspects");p("<===============>"),p(`âš™ï¸ Selected testimonies 1: ${o}`),p(t[o]),p(`âš™ï¸ Selected testimonies 2: ${s}`),p(t[s]),p(`âš™ï¸ Culprit ID: ${n}`),p(`Testimony 1 answers: ${t[o][n]}`),p(`Testimony 2 answers: ${t[s][n]}`);const c=`${t[o][n]}-${t[s][n]}`,u=h.sampleSize(i.filter(r=>r!==n&&`${t[o][r]}-${t[s][r]}`!==c),j-1),m=h.difference(i,u);return p(`âš™ï¸ Possible suspects: ${u.join(", ")}`),p(`âš™ï¸ Impossible suspects: ${m.join(", ")}`),p(`âš™ï¸ Attempts made: ${a}`),p(">===============<"),{selectedTestimonyId1:o,selectedTestimonyId2:s,culpritId:n,possibleSuspects:u,impossibleSuspects:m}},O=(t,e)=>{e.forEach(a=>{t[a]===void 0&&(t[a]=0),t[a]++})},G=(t,e,a,o)=>{const s=o[t],i=e.filter(u=>o[u]!==void 0&&o[u]!==s),n=a.answer.charAt(0).toLowerCase()+a.answer.slice(1),c={key:`testimony.${a.id}`,text:`O(a) suspeito(a) ${s?"":"nÃ£o "}${n}`,excludes:i,type:"testimony"};return c.text.includes("nÃ£o jÃ¡")&&(c.text=c.text.replace("nÃ£o jÃ¡","nunca")),c},ue={column1:{indexes:[0,4,8],text:"na primeira coluna"},column2:{indexes:[1,5,9],text:"na segunda coluna"},column3:{indexes:[2,6,10],text:"na terceira coluna"},column4:{indexes:[3,7,11],text:"na quarta coluna"},corners:{indexes:[0,3,8,11],text:"nos cantos"}},de={row1:{indexes:[0,1,2,3],text:"na primeira linha"},row2:{indexes:[4,5,6,7],text:"na segunda linha"},row3:{indexes:[8,9,10,11],text:"na terceira linha"}},A=(t,e,a,o)=>{const s=e.indexOf(t),i=a.slice(0,3),n=o==="rows"?de:ue,c={};for(const l of Object.keys(n)){const{indexes:d}=n[l];d.includes(s)||(c[l]=d.reduce((b,E)=>{const x=e[E],w=i.filter(y=>y.excludes.includes(x)).length;return w>0?b+w:b},0))}const u=Object.entries(c).reduce((l,[d,b])=>(l[b]||(l[b]=[]),l[b].push(d),l),{}),m=Math.min(...Object.keys(c).map(l=>c[l])),r=u[m.toString()],f=h.sample(r)||Object.keys(c)[0],S=n[f].indexes.map(l=>e[l]);return{key:`not.grid.${f}`,text:`O(a) suspeito(a) nÃ£o estÃ¡ ${n[f].text}`,excludes:S,type:"grid"}},H=(t,e,a,o=[],s="best")=>{const i=h.difference(e,[t]),n=o.filter(d=>d.key.startsWith("not.feature.")).map(d=>d.key.replace("not.feature.","")),c=new Set(o.flatMap(d=>d.excludes)),u=Object.keys(a).filter(d=>Object.keys(a[d]).length<=6&&!n.includes(d)).sort((d,b)=>Object.keys(a[b]).length-Object.keys(a[d]).length);let m,r=[],f=0;const S=500;for(;f<S;){f++;const d=s==="best"?u[0]:h.sample(u.slice(2,5))??u[2];if(!d)break;const b=i.filter(x=>a[d][x]);if(b.some(x=>!c.has(x))||f===S){m=d,r=b;break}u.splice(u.indexOf(d),1)}if(!m)throw Error(`No suitable feature found for ${s} selection after ${S} attempts`);p(`Selected feature after ${f} attempts: ${m}`);const l=se[m];return l||te(`Feature ${m} not found in translations`),{key:`not.feature.${m}`,text:`O(a) suspeito(a) nÃ£o ${l||m}`,excludes:r,type:"feature"}},me=t=>{const e=t.slice(0,3);return e.reduce((s,i)=>s+i.excludes.length,0)<10?!1:new Set(e.flatMap(s=>s.excludes)).size===j-1},fe=(t,e)=>{const a=[];Object.values(e).forEach(s=>{s.feature==="general"&&a.push(s),t.features?.includes(s.feature)&&a.push(s)});const o=h.sample(a);return o||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},pe=t=>{const e=t.slice(0,3),a=[],o={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};e.forEach(i=>{const n=i.excludes.length;o[n]!==void 0&&a.push(o[n])});const s=Math.round(a.reduce((i,n)=>i+n,0)/a.length);return Math.min(Math.max(s,1),3)};export{Ee as a,g as d,xe as t,we as u};
