import{r as x,d as L,b2 as Ce,j as e,F as C,T,B as k,m as he,A as se,h as Oe,o as A,S as M,D as Q,b as _,b3 as me,R as ke,M as pe,b4 as Te,P as Ie,L as re}from"./index-DTFVBFfK.js";import{D as Ne}from"./DataLoadingWrapper-AfAD5Or6.js";import{l as I,P as Re}from"./useBaseUrl-BXKykm9Q.js";import{u as P}from"./useQueryParams-CSQSAZkt.js";import{R as Pe}from"./main-GEKNY4EL.js";import{u as Me}from"./daily-espionagem-DsfhO5Vf.js";import{g as De}from"./useParsedHistory-Dsi0oIDT.js";import{S as V,a as fe,c as je,n as W,u as Ee}from"./useTestimoniesResource-BJcPiQ5O.js";import{u as Ae}from"./useTDResource-CtzTqqUd.js";import{T as ge,F as Fe}from"./FilterEntries-DnRExwmR.js";import{B as U,D as J}from"./DownloadButton-B5N81On_.js";import{S as D}from"./index-D1CfkU0f.js";import{u as xe}from"./useTableExpandableRows-BFx1erwa.js";import{u as be}from"./useTablePagination-DAt6aSDN.js";import{P as ie}from"./progress-Do6G1Mzz.js";import{F as te}from"./Table-BAIh0dVT.js";import{u as Be}from"./useCardWidth-BprnJrMO.js";import{C as ye}from"./index-Ph3MC-q4.js";import{P as oe}from"./index-BEQxMZx0.js";import{F as $,R as ze}from"./index-CLmQsl2J.js";import{R as $e}from"./CloudSyncOutlined-Ie7X0WqE.js";import{S as H}from"./SiderContent-DMHsDpiE.js";import{F as Le,a as Ve}from"./FirestoreConsoleLink-DQ3J25sf.js";import{S as qe}from"./SaveButton-aj_MRLuF.js";import{S as He}from"./SuspectsStyleVariantSelector-Cm1M8eg8.js";import{g as Ue}from"./useGetFirestoreDoc-pvlqtSeW.js";import{j as Qe,a as We,i as _e}from"./index-5_NcC2_B.js";import{u as we}from"./useWindowSize-DLt-5Z64.js";import{S as Je}from"./index-Bnlp8zWQ.js";import{R as Ye}from"./TableOutlined-BpKsmObb.js";import{R as Ge}from"./RobotOutlined-DrwKRpP9.js";import"./moment-B-YVwB4U.js";import"./VirtualizationWrapper-C_fz5Ljo.js";import"./ImageCard-5WK1c0hB.js";import"./useResourceFirestoreData-4EapG7Wd.js";import"./useUpdateFirestoreDoc-DNoK3eu1.js";import"./useMutation-BedPW6bx.js";import"./index-DXm6RdKT.js";import"./PlusOutlined-Dg4BBZsT.js";import"./index-U31pN1fu.js";import"./Dropdown-Cp-10CYh.js";import"./index-CqcX2UdF.js";import"./scrollTo-CsjTXzNU.js";import"./Pagination-C72zuBhS.js";import"./VerticalAlignTopOutlined-nXKpcRag.js";import"./throttleByAnimationFrame-CrXO4eCR.js";import"./FileTextOutlined-BdyZSEVj.js";import"./SaveOutlined-aR-FBBRB.js";import"./constants-CuiKou0X.js";import"./Item-C5hJ6z_V.js";var Ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zM464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z"}}]},name:"appstore",theme:"filled"};function Y(){return Y=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Y.apply(this,arguments)}const Xe=(t,s)=>x.createElement(L,Y({},t,{ref:s,icon:Ke})),Ze=x.forwardRef(Xe);var et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm330-170c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1z"}}]},name:"audio",theme:"filled"};function G(){return G=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},G.apply(this,arguments)}const tt=(t,s)=>x.createElement(L,G({},t,{ref:s,icon:et})),nt=x.forwardRef(tt);var st={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M594.3 601.5a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1 8 8 0 008 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"}}]},name:"contacts",theme:"outlined"};function K(){return K=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},K.apply(this,arguments)}const rt=(t,s)=>x.createElement(L,K({},t,{ref:s,icon:st})),it=x.forwardRef(rt);var ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M870 126H663.8c-17.4 0-32.9 11.9-37 29.3C614.3 208.1 567 246 512 246s-102.3-37.9-114.8-90.7a37.93 37.93 0 00-37-29.3H154a44 44 0 00-44 44v252a44 44 0 0044 44h75v388a44 44 0 0044 44h478a44 44 0 0044-44V466h75a44 44 0 0044-44V170a44 44 0 00-44-44z"}}]},name:"skin",theme:"filled"};function X(){return X=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},X.apply(this,arguments)}const at=(t,s)=>x.createElement(L,X({},t,{ref:s,icon:ot})),ct=x.forwardRef(at);var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.6 630.2 359 721.8 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.8 758.4 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM248 439.6c-37.1-11.9-64-46.7-64-87.6V232h64v207.6zM840 352c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"filled"};function Z(){return Z=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Z.apply(this,arguments)}const ut=(t,s)=>x.createElement(L,Z({},t,{ref:s,icon:lt})),ae=x.forwardRef(ut);function dt(t,s){return typeof t=="function"?t.length?t(s):t():t}function ve(t,s,i){if(s===void 0&&(s=10),s<1)throw new Error("Capacity has to be greater than 1, got '"+s+"'");var r=Ce(),p=x.useState(t),j=p[0],m=p[1],d=x.useRef([]),o=x.useRef(0);r&&(d.current.length?(d.current[d.current.length-1]!==t&&d.current.push(t),d.current.length>s&&(d.current=d.current.slice(d.current.length-s))):d.current.push(t),o.current=d.current.length&&d.current.length-1);var h=x.useCallback(function(a){m(function(f){return a=dt(a,f),a!==f&&(o.current<d.current.length-1&&(d.current=d.current.slice(0,o.current+1)),o.current=d.current.push(a)-1,d.current.length>s&&(d.current=d.current.slice(d.current.length-s))),a})},[j,s]),u=x.useMemo(function(){return{history:d.current,position:o.current,capacity:s,back:function(a){a===void 0&&(a=1),o.current&&m(function(){return o.current-=Math.min(a,o.current),d.current[o.current]})},forward:function(a){a===void 0&&(a=1),o.current!==d.current.length-1&&m(function(){return o.current=Math.min(o.current+a,d.current.length-1),d.current[o.current]})},go:function(a){a!==o.current&&m(function(){return o.current=a<0?Math.max(d.current.length+a,0):Math.min(d.current.length-1,a),d.current[o.current]})}}},[j]);return[j,h,u]}function ht(){const[t,s]=x.useState({batchSize:1,history:{}}),i=x.useRef(1),{entries:r}=Me(!0,"pt",t.batchSize,t.history),p=Ae("suspects",{enabled:!I.isEmpty(r)});return console.log(pt(r,p.data??{})),e.jsxs(C,{className:"p-4",gap:12,vertical:!0,children:[e.jsxs(C,{align:"center",justify:"space-between",children:[e.jsx(T.Title,{className:"my-0",level:4,children:"Espionagem Simulator"}),e.jsxs(C,{gap:6,children:[e.jsx(ge,{defaultValue:1,max:100,min:1,onChange:j=>{i.current=j??1}}),e.jsx(k,{onClick:()=>s({batchSize:i.current,history:{}}),type:"primary",children:"Re-run Simulation"})]})]}),e.jsx(mt,{entries:r})]})}function mt({entries:t}){const[s,i]=x.useState(!1),r=De(),p=t[r],j=x.useMemo(()=>p?p.statements.reduce((m,d)=>{const{excludes:o}=d;return o.forEach(h=>{m[h]?m[h]++:m[h]=1}),m},{}):{},[p]);return e.jsxs("div",{className:"full-width grid",style:{gridTemplateColumns:"2fr 3fr"},children:[e.jsx(Pe,{collapsed:3,src:t??{},theme:"twilight"}),e.jsx("div",{children:p&&e.jsxs(C,{className:"p-4",gap:18,children:[e.jsx("div",{children:e.jsx("div",{style:{width:"420px",display:"grid",gap:"6px",gridTemplateColumns:"repeat(4, 1fr)"},children:p.suspects.map(m=>e.jsxs(U.Ribbon,{color:"cyan",text:s?j[m.id]:null,children:[e.jsx(V,{cardId:m.id,cardWidth:96,className:he(s&&m.id===p.culpritId&&"red-border")},m.id),e.jsxs(C,{align:"center",gap:6,children:[e.jsx(D,{checkedChildren:"ðŸš«",size:"small"})," ",m.id]})]},m.id))})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(D,{checked:s,checkedChildren:"Show Culprit",onChange:i,unCheckedChildren:"Hide Culprit"})}),p.statements.map(m=>e.jsx(T.Paragraph,{children:e.jsx(U,{color:"cyan",count:m.excludes.length,children:e.jsx(se,{banner:!0,icon:ce(m.type),message:m.text,type:"info"},m.key)})},m.key)),p.additionalStatements.map(m=>e.jsx(T.Paragraph,{children:e.jsx(U,{color:"cyan",count:m.excludes.length,children:e.jsx(se,{banner:!0,icon:ce(m.type),message:m.text,type:"warning"},m.key)})},m.key))]})]})})]})}const ce=t=>{switch(t){case"testimony":return e.jsx(nt,{});case"feature":return e.jsx(ct,{});case"grid":return e.jsx(Ze,{});default:return"â“"}},pt=(t,s)=>{const i=Object.values(t).reduce((r,p)=>(p.suspects.forEach(j=>{r[j.id]=(r[j.id]||0)+1,j.id===p.culpritId&&(r[`${j.id}_culprit`]=(r[`${j.id}_culprit`]||0)+1)}),r),{});return Object.values(s).forEach(r=>{i[r.id]||(i[r.id]=0),i[`${r.id}_culprit`]||(i[`${r.id}_culprit`]=0)}),i};function Se({suspect:t,values:s,resolution:i,projection:r,yesPercentage:p,noPercentage:j,complete:m,enoughData:d,testimonyId:o,addEntryToUpdate:h,answers:u,barWidth:a,showName:f}){const g=(n,l)=>{const b={...u};b[n]=[...b[n]||[],l],h(o,b)},c=(n,l)=>{const b={...u},v=b[n]?.indexOf(l);v!==-1&&v!==void 0&&(b[n]=[...b[n].slice(0,v),...b[n].slice(v+1)]),h(o,b)};return e.jsxs(Oe,{content:e.jsxs(C,{align:"center",vertical:!0,children:[e.jsx(T.Text,{type:"secondary",children:s.join(", ")}),e.jsxs(M.Compact,{children:[e.jsx(k,{icon:"+",onClick:()=>g(t.id,1)}),e.jsx(k,{block:!0,icon:"ðŸ‘",onClick:()=>g(t.id,4),children:"Fit"}),e.jsx(k,{icon:"âŒ",onClick:()=>c(t.id,4)}),e.jsx(k,{block:!0,icon:"ðŸ‘Ž",onClick:()=>g(t.id,-4),children:"Unfit"}),e.jsx(k,{icon:"âŒ",onClick:()=>c(t.id,-4)})]}),e.jsx(Q,{className:"my-1"}),e.jsxs(M.Compact,{children:[e.jsx(k,{icon:"-",onClick:()=>g(t.id,-1)}),e.jsx(k,{block:!0,icon:"â¬†ï¸",onClick:()=>g(t.id,32),children:"Sure"}),e.jsx(k,{icon:"âœ–ï¸",onClick:()=>c(t.id,32)}),e.jsx(k,{block:!0,icon:"â¬‡ï¸",onClick:()=>g(t.id,-32),children:"Sure"}),e.jsx(k,{icon:"âœ–ï¸",onClick:()=>c(t.id,-32)})]})]}),title:`Add strong fit/unfit answer to ${t.name.pt}`,trigger:"click",children:[f&&e.jsxs("div",{children:[e.jsx(A,{title:t.id,children:t.name.pt})," ",m&&e.jsx(A,{title:"Complete: It has 5 or more answers",children:e.jsx(ae,{style:{color:"gold"}})}),!!i&&i]}),e.jsxs(C,{align:"flex-start",gap:12,children:[e.jsx(A,{title:`Values: ${s.join(", ")} : ${i||(r?`${r}*`:"")}`,children:d?e.jsx(ie,{percent:j+p,showInfo:!1,size:[a,20],strokeColor:"#cf2323",success:{percent:p}}):e.jsx(ie,{percent:j+p,showInfo:!1,size:[a,10],strokeColor:"#cf2323",success:{percent:p}})}),!f&&m&&e.jsx(A,{title:"Complete: It has 5 or more answers",children:e.jsx(ae,{style:{color:"gold"}})})]})]})}function ft({suspect:t,answersPerQuestion:s={},questions:i,addEntryToUpdate:r,allAnswers:p}){const{queryParams:j}=P({sortSuspectsBy:"answers"}),m=j.get("sortSuspectsBy")??"answers",[d,o]=x.useState(""),[h,u]=x.useState(!1),a=x.useMemo(()=>{const n=Object.values(i).map(l=>{const b=s[l.id]??{},{enoughData:v,reliable:S,yesPercentage:O,noPercentage:w,blankPercentage:y,values:R,total:B,resolution:z,projection:q,complete:E}=fe(t.id,l.id,{[t.id]:b});return{id:l.id,question:l,enoughData:v,reliable:S,yesPercentage:O,noPercentage:w,blankPercentage:y,values:R,total:B,resolution:z,projection:q,complete:E}});return m==="answers"?I.orderBy(n,["reliable","enoughData","yesPercentage",l=>l.values.length],["desc","desc","desc","desc"]):I.orderBy(n,l=>Number(l.id.split("-")[1]),["asc"])},[s,i,t.id,m]),f=x.useMemo(()=>jt(t,a),[t,a]),g=[{key:"id",title:"Id",dataIndex:"id",width:"7%"},{key:"question",title:"Question",dataIndex:"question",render:n=>n.question},{key:"answer",title:"Answer",dataIndex:"id",width:"170px",sorter:(n,l)=>n.total-l.total,render:n=>{const l=a.find(b=>b.id===n);return l?e.jsx(C,{gap:8,wrap:"nowrap",children:e.jsx(Se,{addEntryToUpdate:r,answers:p[l.question.id]||{},barWidth:120,complete:l.complete,enoughData:l.enoughData,noPercentage:l.noPercentage,projection:l.projection,resolution:l.resolution,suspect:t,testimonyId:l.question.id,values:l.values,yesPercentage:l.yesPercentage})}):""}},{key:"actions",title:"Actions",dataIndex:"id",width:"auto",render:n=>{const l=a.find(b=>b.id===n);return l?e.jsx(gt,{addEntryToUpdate:r,answers:p[l.question.id]||{},suspect:t,testimonyId:l.question.id}):""}}],c=x.useMemo(()=>{let n=a;return d.trim()&&(n=n.filter(l=>l.question.question.toLowerCase().includes(d.toLowerCase())||l.id.toLowerCase().includes(d.toLowerCase()))),h&&(n=n.filter(l=>l.values.reduce((v,S)=>v+Math.abs(S===0?-1:S),0)<=2)),n},[a,d,h]);return e.jsxs(M,{size:"large",wrap:!0,children:[e.jsxs(C,{className:"full-width",gap:16,vertical:!0,children:[e.jsxs(C,{gap:6,children:[e.jsx(_,{allowClear:!0,onChange:n=>o(n.target.value),placeholder:"Search questions...",prefix:e.jsx(me,{}),style:{marginBottom:16,width:320},value:d}),e.jsxs(C,{align:"center",gap:8,children:[e.jsx(D,{checked:h,onChange:u}),e.jsx(T.Text,{children:"Show only missing questions"})]})]}),e.jsx(te,{bordered:!0,className:"full-width",columns:g,dataSource:c,rowKey:"id",tableLayout:"fixed"})]}),e.jsxs(C,{gap:8,vertical:!0,children:[e.jsx(T.Title,{level:5,children:"Suspect Description"}),e.jsx(_.TextArea,{className:"full-width",readOnly:!0,rows:7,value:f})]})]})}const jt=(t,s)=>{const i=s.filter(r=>r.resolution||r.projection).map(r=>{const{question:p,resolution:j,projection:m}=r,d=j||m;return`${t.gender==="male"?"ele":"ela"} ${d==="ðŸ‘"?"":"nÃ£o "}${p.answer.toLocaleLowerCase()}`});return`${t.name.pt}: ${i.join(", ")}`};function gt({suspect:t,testimonyId:s,addEntryToUpdate:i,answers:r}){const p=(d,o)=>{const h={...r};h[d]=[...h[d]||[],o],i(s,h)},j=(d,o)=>{const h={...r},u=h[d]?.indexOf(o);u!==-1&&u!==void 0&&(h[d]=[...h[d].slice(0,u),...h[d].slice(u+1)]),i(s,h)},m=x.useMemo(()=>Object.values(r[t.id]||{}).reduce((d,o)=>d+Math.abs(o===0?-1:o),0),[r,t.id]);return e.jsxs(C,{align:"center",gap:6,wrap:"nowrap",children:[e.jsx(U,{color:m>20?"gold":"grey",count:m,showZero:!0,style:{minWidth:32}}),e.jsxs(M.Compact,{children:[e.jsx(k,{block:!0,icon:"ðŸ‘",onClick:()=>p(t.id,4),children:"FIT"}),e.jsx(k,{icon:"âŒ",onClick:()=>j(t.id,4)}),e.jsx(k,{block:!0,icon:"ðŸ‘Ž",onClick:()=>p(t.id,-4),children:"UNFIT"}),e.jsx(k,{icon:"âŒ",onClick:()=>j(t.id,-4)}),e.jsx(k,{block:!0,icon:"â¬†ï¸",onClick:()=>p(t.id,32),children:"Sure"}),e.jsx(k,{icon:"âœ–ï¸",onClick:()=>j(t.id,32)}),e.jsx(k,{block:!0,icon:"â¬‡ï¸",onClick:()=>p(t.id,-32),children:"Sure"}),e.jsx(k,{icon:"âœ–ï¸",onClick:()=>j(t.id,-32)})]})]})}function xt({isLoading:t,isSuccess:s,questions:i,data:r,suspects:p,addEntryToUpdate:j}){const{queryParams:m,addParam:d}=P(),o=Object.values(i).map(({id:c,question:n})=>({id:c,question:n})),h=x.useMemo(()=>Object.keys(r).reduce((c,n)=>{const l=r[n]??{};return Object.keys(l).forEach(b=>{c[b]||(c[b]={}),c[b][n]=l[b]}),c},{}),[r]),u=x.useMemo(()=>I.orderBy(Object.values(p).map(c=>({...c,answers:h[c.id]})),c=>Number(c.id.split("-")[1]),"asc"),[p,h]),a=be({total:u.length,showQuickJumper:!0}),f=[{title:"Id",dataIndex:"id",key:"id",sorter:(c,n)=>Number(c.id.split("-")[1])-Number(n.id.split("-")[1])},{title:"Picture",dataIndex:"id",render:c=>e.jsx(V,{cardId:c,cardWidth:48})},{title:"Name",dataIndex:"name",key:"name",sorter:(c,n)=>c.name.pt.localeCompare(n.name.pt),render:c=>e.jsxs(C,{vertical:!0,children:[e.jsx(T.Text,{children:c.pt}),e.jsx(T.Text,{type:"secondary",children:c.en})]})},{title:"Questions Answered",dataIndex:"answers",key:"answers",sorter:(c,n)=>Object.keys(c.answers??{}).length-Object.keys(n.answers??{}).length,render:c=>c?Object.values(c).length:""}],g=xe({maxExpandedRows:1,expandedRowRender:c=>e.jsx(ft,{addEntryToUpdate:j,allAnswers:r,answersPerQuestion:c.answers,questions:i,suspect:c}),rowExpandable:()=>s});return e.jsxs(C,{className:"full-width py-4",gap:12,vertical:!0,children:[e.jsxs(C,{align:"center",justify:"space-between",children:[e.jsx(T.Title,{className:"my-0",level:4,children:"Testimonies by Suspect"}),e.jsx(J,{data:o,fileName:"newQuestions.json"}),e.jsx(D,{checked:m.get("sortSuspectsBy")==="answers",checkedChildren:"Sort by Answers",onChange:c=>d("sortSuspectsBy",c?"answers":"id"),unCheckedChildren:"Sort by Id"})]}),e.jsx(te,{bordered:!0,className:"full-width",columns:f,dataSource:u,expandable:g,loading:t,pagination:a,rowKey:"id"})]})}function bt({answers:t,suspects:s,addEntryToUpdate:i,testimonyId:r,question:p}){const[j,m]=Be(12),{queryParams:d,is:o}=P({sortSuspectsBy:"answers"}),h=o("enableBatch"),u=d.get("sortSuspectsBy")??"answers",a=x.useMemo(()=>{const c=Object.keys(s).map(n=>fe(n,r,t));return u==="answers"?I.orderBy(c,["reliable","enoughData",n=>n.values.length,"yesPercentage","noPercentage",n=>Number(n.suspectCardId.split("-")[1])],["desc","desc","desc","desc","desc","asc"]):I.orderBy(c,n=>Number(n.suspectCardId.split("-")[1]),["asc"])},[t,s,r,u]),[f,g]=x.useState([]);return e.jsx(M,{orientation:"vertical",children:e.jsx(yt,{addEntryToUpdate:i,answers:t,list:a,question:p,selection:f,setSelection:g,suspects:s,testimonyId:r,children:e.jsx(M,{ref:m,size:"large",wrap:!0,children:a.map(c=>e.jsxs(C,{className:he({"selection-outline":h&&f.includes(c.suspectCardId)}),gap:6,vertical:!0,children:[e.jsx(V,{cardId:c.imageId,cardWidth:j,className:c.values.length>1||c.enoughData?void 0:"grayscale"}),e.jsxs(C,{gap:4,children:[h&&e.jsx(ye,{checked:f.includes(c.suspectCardId),disabled:c.complete,onChange:n=>{const l=n.target.checked;g(b=>l?[...b,c.suspectCardId]:b.filter(v=>v!==c.suspectCardId))}}),e.jsx(Se,{addEntryToUpdate:i,answers:t,barWidth:j,complete:c.complete,enoughData:c.enoughData,noPercentage:c.noPercentage,projection:c.projection,resolution:c.resolution,showName:!0,suspect:s[c.suspectCardId],testimonyId:r,values:c.values,yesPercentage:c.yesPercentage})]})]},c.suspectCardId))})})})}function yt({question:t,testimonyId:s,selection:i,setSelection:r,suspects:p,addEntryToUpdate:j,list:m,answers:d,children:o}){const[h,u]=x.useState([]),{addParam:a,removeParam:f,is:g}=P({sortSuspectsBy:"answers"}),c=g("enableBatch"),n=S=>{u(O=>O.includes(S)?O.filter(w=>w!==S):[...O,S])},l=x.useMemo(()=>I.keyBy(m,"suspectCardId"),[m]);x.useEffect(()=>{if(h.length===0&&i.length>0){r([]);return}if(!h.length)return;const S=i.length>0?i:Object.values(l).filter(w=>!w.complete&&!w.values.includes(4)&&!w.values.includes(-4)).map(w=>w.suspectCardId);if(h.includes("empty")){const w=Object.values(l).filter(y=>y.values.length===0).map(y=>y.suspectCardId);r(w);return}if(h.includes("incompletePos")){const w=Object.values(l).filter(y=>!y.complete&&y.yesCount<4&&y.yesCount>0&&y.noCount===0).map(y=>y.suspectCardId);r(w);return}if(h.includes("incompleteNeg")){const w=Object.values(l).filter(y=>!y.complete&&y.noCount<4&&y.noCount>0&&y.yesCount===0).map(y=>y.suspectCardId);r(w);return}const O=S.filter(w=>{const y=p[w],R=[y.gender,y.ethnicity,y.build,y.height];return y.age==="18-21"&&R.push("young"),(y.age==="21-30"||y.age==="30-40")&&R.push("adult"),y.age==="40-50"&&R.push("parent"),(y.age==="50-60"||y.age==="60-70"||y.age==="70-80"||y.age==="80-90")&&R.push("senior"),h.every(B=>R.includes(B))});r(O)},[h]);const b=S=>{const O=I.cloneDeep(d);i.forEach(w=>{O[w]=[...O[w]||[],S]}),j(s,O),u([])},v=e.jsxs(e.Fragment,{children:[e.jsxs(T.Text,{className:"nowrap mr-2",children:["Selected ",i.length.toString().padStart(3,"0")]}),e.jsx(C,{align:"center",className:"boxed",gap:6,justify:"center",wrap:!0,children:e.jsx(N,{activeFilters:h,end:!0,filter:"empty",updateActiveFilter:n})}),e.jsxs(C,{align:"center",className:"boxed",gap:6,justify:"center",wrap:!0,children:[e.jsx(N,{activeFilters:h,end:!0,filter:"incompletePos",label:"Incomplete+",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,end:!0,filter:"incompleteNeg",label:"Incomplete-",updateActiveFilter:n})]}),e.jsxs(C,{align:"center",className:"boxed",gap:6,justify:"center",wrap:!0,children:[e.jsx(N,{activeFilters:h,filter:"male",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"female",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"young",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"adult",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"parent",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"senior",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"thin",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"muscular",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"large",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"asian",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"black",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,filter:"caucasian",updateActiveFilter:n}),e.jsx(N,{activeFilters:h,end:!0,filter:"latino",updateActiveFilter:n})]}),e.jsxs(C,{align:"center",gap:6,children:[e.jsx(k,{danger:!0,onClick:()=>u([]),size:"small",children:"Clear"}),e.jsx(oe,{onConfirm:()=>b(4),title:"Apply +4 to selected suspects?",children:e.jsx(k,{className:"ml-10",disabled:i.length===0,size:"small",type:"primary",children:"Apply +4"})}),e.jsx(Q,{orientation:"vertical"}),e.jsx(oe,{onConfirm:()=>b(-4),title:"Apply -4 to selected suspects?",children:e.jsx(k,{disabled:i.length===0,size:"small",type:"primary",children:"Apply -4"})})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs(C,{align:"center",className:"mb-4",gap:6,justify:"space-between",children:[e.jsxs(C,{gap:3,children:[e.jsx(T.Text,{className:"nowrap",style:{minWidth:"5ch"},children:"Batch"}),e.jsx(D,{checkedChildren:"On",onChange:S=>{S?a("enableBatch",!0):f("enableBatch")},unCheckedChildren:"Off",value:c})]}),c&&v]}),o,c&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsx(C,{align:"center",className:"mb-4",gap:6,justify:"space-between",children:v})]}),i.length>0&&e.jsxs($.Group,{shape:"square",style:{insetInlineEnd:94},children:[e.jsx($,{badge:{count:i.length,color:"green",size:"small"},icon:"ðŸ‘",onClick:()=>b(4),tooltip:{title:t,placement:"left"}}),e.jsx($,{badge:{count:i.length,color:"red",size:"small"},icon:"ðŸ‘Ž",onClick:()=>b(-4),tooltip:{title:t,placement:"left"}}),e.jsx($,{icon:e.jsx(ze,{}),onClick:()=>u([]),tooltip:{title:"Clear selection",placement:"left"}}),e.jsx($.BackTop,{visibilityHeight:0})]})]})}function N({filter:t,activeFilters:s,updateActiveFilter:i,end:r,label:p}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[e.jsx(ye,{checked:s.includes(t),onClick:()=>i(t)})," ",p??I.capitalize(t)]}),!r&&e.jsx(Q,{orientation:"vertical"})]})}function wt({data:t,questions:s,suspects:i,isLoading:r,isSuccess:p,addEntryToUpdate:j}){const{queryParams:m,addParam:d}=P(),[o,h]=x.useState(""),u=x.useMemo(()=>I.orderBy(Object.values(s).map(n=>({...n,answersCount:Object.values(t[n.id]??{}).length})),n=>Number(n.id.split("-")[1]),"asc"),[s]),a=x.useMemo(()=>o.trim()?u.filter(n=>n.question.toLowerCase().includes(o.toLowerCase())||n.id.toLowerCase().includes(o.toLowerCase())):u,[u,o]),f=be({total:a.length,showQuickJumper:!0}),g=[{title:"Id",dataIndex:"id",key:"id",sorter:(n,l)=>Number(n.id.split("-")[1])-Number(l.id.split("-")[1])},{title:"Question",dataIndex:"question",key:"question",sorter:(n,l)=>n.question.localeCompare(l.question)},{title:"NSFW",dataIndex:"nsfw",key:"nsfw",render:n=>n?e.jsx(ke,{style:{color:"hotPink"}}):"",sorter:(n,l)=>Number(n.nsfw)-Number(l.nsfw)},{title:"Level",dataIndex:"level",key:"level",sorter:(n,l)=>(n?.level??0)-(l?.level??0)},{title:"Answers",dataIndex:"answersCount",key:"answersCount",sorter:(n,l)=>n.answersCount-l.answersCount},{title:"Info",dataIndex:"alignment",key:"alignment",render:(n,l)=>{const b=l.mbti?l.mbti.related.join(", "):"N/A",v=l.zodiac?l.zodiac.related.join(", "):"N/A",S=l.alignment?l.alignment.related.join(", "):"N/A";return e.jsxs(T.Paragraph,{style:{fontSize:"0.85em",marginBottom:0},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"MBTI:"})," ",b]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Zodiac:"})," ",v]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Alignment:"})," ",S]})]})}}],c=xe({maxExpandedRows:1,expandedRowRender:n=>e.jsx(bt,{addEntryToUpdate:j,answers:t[n.id]??{},question:n.question,suspects:i,testimonyId:n.id},n.id),rowExpandable:()=>p});return e.jsxs(C,{className:"full-width py-4",gap:12,vertical:!0,children:[e.jsxs(C,{align:"center",justify:"space-between",children:[e.jsx(T.Title,{className:"my-0",level:4,children:"Suspects by Testimony"}),e.jsx(D,{checked:m.get("sortSuspectsBy")==="answers",checkedChildren:"Sort by Answers",onChange:n=>d("sortSuspectsBy",n?"answers":"id"),unCheckedChildren:"Sort by Id"})]}),e.jsxs(C,{gap:6,children:[e.jsx(_,{allowClear:!0,onChange:n=>h(n.target.value),placeholder:"Search questions by text or ID...",prefix:e.jsx(me,{}),style:{width:320},value:o}),e.jsx(A,{title:"Set random question",children:e.jsx(k,{icon:e.jsx($e,{}),onClick:()=>h(I.sample(Object.keys(s))??"")})})]}),e.jsx(te,{bordered:!0,className:"full-width",columns:g,dataSource:a,expandable:c,loading:r,pagination:f,rowKey:"id"})]})}function vt(t){const{queryParams:s,is:i}=P();return e.jsxs(e.Fragment,{children:[(i("display","questions")||!s.get("display"))&&e.jsx(wt,{...t}),i("display","suspects")&&e.jsx(xt,{...t}),i("display","simulator")&&e.jsx(ht,{})]})}const St="Left",Ct="Right",Ot="Up",kt="Down",F={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},ee={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},le="mousemove",ue="mouseup",Tt="touchend",It="touchmove",Nt="touchstart";function Rt(t,s,i,r){return t>s?i>0?Ct:St:r>0?kt:Ot}function de(t,s){if(s===0)return t;const i=Math.PI/180*s,r=t[0]*Math.cos(i)+t[1]*Math.sin(i),p=t[1]*Math.cos(i)-t[0]*Math.sin(i);return[r,p]}function Pt(t,s){const i=u=>{const a="touches"in u;a&&u.touches.length>1||t((f,g)=>{g.trackMouse&&!a&&(document.addEventListener(le,r),document.addEventListener(ue,m));const{clientX:c,clientY:n}=a?u.touches[0]:u,l=de([c,n],g.rotationAngle);return g.onTouchStartOrOnMouseDown&&g.onTouchStartOrOnMouseDown({event:u}),Object.assign(Object.assign(Object.assign({},f),ee),{initial:l.slice(),xy:l,start:u.timeStamp||0})})},r=u=>{t((a,f)=>{const g="touches"in u;if(g&&u.touches.length>1)return a;if(u.timeStamp-a.start>f.swipeDuration)return a.swiping?Object.assign(Object.assign({},a),{swiping:!1}):a;const{clientX:c,clientY:n}=g?u.touches[0]:u,[l,b]=de([c,n],f.rotationAngle),v=l-a.xy[0],S=b-a.xy[1],O=Math.abs(v),w=Math.abs(S),y=(u.timeStamp||0)-a.start,R=Math.sqrt(O*O+w*w)/(y||1),B=[v/(y||1),S/(y||1)],z=Rt(O,w,v,S),q=typeof f.delta=="number"?f.delta:f.delta[z.toLowerCase()]||F.delta;if(O<q&&w<q&&!a.swiping)return a;const E={absX:O,absY:w,deltaX:v,deltaY:S,dir:z,event:u,first:a.first,initial:a.initial,velocity:R,vxvy:B};E.first&&f.onSwipeStart&&f.onSwipeStart(E),f.onSwiping&&f.onSwiping(E);let ne=!1;return(f.onSwiping||f.onSwiped||f[`onSwiped${z}`])&&(ne=!0),ne&&f.preventScrollOnSwipe&&f.trackTouch&&u.cancelable&&u.preventDefault(),Object.assign(Object.assign({},a),{first:!1,eventData:E,swiping:!0})})},p=u=>{t((a,f)=>{let g;if(a.swiping&&a.eventData){if(u.timeStamp-a.start<f.swipeDuration){g=Object.assign(Object.assign({},a.eventData),{event:u}),f.onSwiped&&f.onSwiped(g);const c=f[`onSwiped${g.dir}`];c&&c(g)}}else f.onTap&&f.onTap({event:u});return f.onTouchEndOrOnMouseUp&&f.onTouchEndOrOnMouseUp({event:u}),Object.assign(Object.assign(Object.assign({},a),ee),{eventData:g})})},j=()=>{document.removeEventListener(le,r),document.removeEventListener(ue,m)},m=u=>{j(),p(u)},d=(u,a)=>{let f=()=>{};if(u&&u.addEventListener){const g=Object.assign(Object.assign({},F.touchEventOptions),a.touchEventOptions),c=[[Nt,i,g],[It,r,Object.assign(Object.assign({},g),a.preventScrollOnSwipe?{passive:!1}:{})],[Tt,p,g]];c.forEach(([n,l,b])=>u.addEventListener(n,l,b)),f=()=>c.forEach(([n,l])=>u.removeEventListener(n,l))}return f},h={ref:u=>{u!==null&&t((a,f)=>{if(a.el===u)return a;const g={};return a.el&&a.el!==u&&a.cleanUpTouch&&(a.cleanUpTouch(),g.cleanUpTouch=void 0),f.trackTouch&&u&&(g.cleanUpTouch=d(u,f)),Object.assign(Object.assign(Object.assign({},a),{el:u}),g)})}};return s.trackMouse&&(h.onMouseDown=i),[h,d]}function Mt(t,s,i,r){return!s.trackTouch||!t.el?(t.cleanUpTouch&&t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:void 0})):t.cleanUpTouch?s.preventScrollOnSwipe!==i.preventScrollOnSwipe||s.touchEventOptions.passive!==i.touchEventOptions.passive?(t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:r(t.el,s)})):t:Object.assign(Object.assign({},t),{cleanUpTouch:r(t.el,s)})}function Dt(t){const{trackMouse:s}=t,i=x.useRef(Object.assign({},ee)),r=x.useRef(Object.assign({},F)),p=x.useRef(Object.assign({},r.current));p.current=Object.assign({},r.current),r.current=Object.assign(Object.assign({},F),t);let j;for(j in F)r.current[j]===void 0&&(r.current[j]=F[j]);const[m,d]=x.useMemo(()=>Pt(o=>i.current=o(i.current,r.current),{trackMouse:s}),[s]);return i.current=Mt(i.current,r.current,p.current,d),m}function Et(t){const{addParam:s}=P();return e.jsxs(C,{gap:8,vertical:!0,children:[e.jsx(k,{block:!0,onClick:()=>s("testify","single"),children:"Testify Drawer"}),e.jsx(k,{block:!0,onClick:()=>s("testify","group"),children:"Testify Group"}),e.jsx(At,{...t}),e.jsx(Ft,{...t})]})}function At({suspects:t,questions:s,answers:i,addEntryToUpdate:r}){const{width:p,height:j}=we(),{is:m,removeParam:d}=P(),[o,h]=ve(),u=Dt({onSwipedLeft:()=>alert("Swiped Left"),onSwipedRight:()=>alert("Swiped Right"),onSwipedUp:()=>alert("Swiped Up"),preventScrollOnSwipe:!0,trackTouch:!0,trackMouse:!0}),a=()=>{h({suspectId:I.sample(Object.keys(t))||null,testimonyId:I.sample(Object.keys(s))||null})},f=()=>{a()},g=()=>{if(o?.suspectId&&o?.testimonyId){const l=I.cloneDeep(i[o?.testimonyId??""]??{});l[o.suspectId]=[...l[o.suspectId]||[],1],r(o.testimonyId??"",l),a()}},c=()=>{if(o?.suspectId&&o?.testimonyId){const l=I.cloneDeep(i[o?.testimonyId??""]??{});l[o.suspectId]=[...l[o.suspectId]||[],-1],r(o.testimonyId??"",l),a()}},n=!!o?.suspectId&&!!o?.testimonyId;return e.jsx(pe,{footer:null,maskClosable:!1,onCancel:()=>d("testify"),open:m("testify","single"),title:e.jsx(T,{children:"Does this person do this??"}),width:p-64,children:e.jsxs("div",{...u,children:[n&&e.jsxs(C,{align:"center",className:"mb-8",gap:8,justify:"center",vertical:!0,children:[e.jsx(V,{cardId:o.suspectId??"",cardWidth:Math.max(j/4,128)}),e.jsx(T.Title,{className:"text-center",level:5,children:s[o.testimonyId??""]?.question})]}),e.jsxs(M.Compact,{block:!0,className:"mb-8",size:"large",children:[e.jsx(k,{block:!0,disabled:!n,icon:"ðŸ‘Ž",onClick:c,style:{height:64},children:"No"}),e.jsx(k,{block:!0,onClick:f,style:{height:64},children:"Skip"}),e.jsx(k,{block:!0,disabled:!n,icon:"ðŸ‘",iconPlacement:"end",onClick:g,style:{height:64},children:"Yes"})]})]})})}function Ft({suspects:t,questions:s,answers:i,addEntryToUpdate:r}){const{width:p,height:j}=we(),{is:m,removeParam:d}=P(),[o,h]=ve(),[u,a]=x.useState(6),[f,g]=x.useState(!0),c=()=>{const v=(f?I.sample(Object.keys(s)):o?.testimonyId)??null,S=I.sampleSize(Object.keys(t).filter(O=>{const w=i[v??""]?.[O]||[];return je(w)<4}),u).reduce((O,w)=>(O[w]=null,O),{});h({suspectsIds:S,testimonyId:v})};Te(()=>c());const n=()=>{const v=Object.entries(o?.suspectsIds??{}).reduce((S,[O,w])=>(w!==null&&(S[O]=[w]),S),{});if(o?.testimonyId&&Object.keys(v).length>0){const S=I.cloneDeep(i[o.testimonyId]??{});Object.entries(v).forEach(([O,w])=>{S[O]=[...S[O]||[],...w]}),r(o.testimonyId,S)}else console.log("No testimonyId or no judged suspects found, likely skipped");c()},l=!!o?.suspectsIds&&!!o?.testimonyId,b=v=>{h(S=>{if(!S)return S;const O=Object.entries(S.suspectsIds).reduce((w,[y,R])=>(w[y]=R===null?v:R,w),{});return{...S,suspectsIds:O}})};return e.jsx(pe,{footer:null,maskClosable:!1,onCancel:()=>d("testify"),open:m("testify","group"),title:e.jsx(T,{children:"Do these people do this??"}),width:p-64,children:e.jsxs("div",{children:[l&&e.jsxs(C,{align:"center",className:"mb-8",gap:8,justify:"center",vertical:!0,children:[e.jsxs(C,{align:"center",gap:6,justify:"center",children:[e.jsx(T.Text,{children:"Number of Suspects:"}),e.jsx(ge,{onChange:v=>a(v??6),size:"small",value:u}),e.jsx(T.Text,{children:"Random Questions:"}),e.jsx(D,{checked:f,onChange:g,size:"small"})]}),e.jsxs(T.Title,{className:"text-center",level:4,children:[o.testimonyId," - ",s[o.testimonyId??""]?.question]}),e.jsx(C,{gap:8,justify:"center",wrap:"wrap",children:Object.keys(o.suspectsIds).map(v=>e.jsxs(C,{align:"center",justify:"center",vertical:!0,children:[e.jsx(T.Text,{className:"text-center",children:t[v]?.name?.pt||"Unknown"}),e.jsx(V,{cardId:v,cardWidth:Math.min(Math.max(j/3,128),128)},v),e.jsx(Je,{onChange:S=>h(O=>O&&{...O,suspectsIds:{...O.suspectsIds,[v]:S}}),options:[{value:-4,icon:"ðŸ‘Ž"},{value:null,icon:"â™¾"},{value:4,icon:"ðŸ‘"}],shape:"round",size:"large",value:o.suspectsIds[v]})]},v))})]}),e.jsxs(C,{align:"center",className:"mt-8",justify:"space-between",children:[e.jsx("span",{}),e.jsxs(C,{gap:8,children:[e.jsx(k,{onClick:()=>b(-4),children:"Set all â™¾ to ðŸ‘Ž"}),e.jsx(k,{onClick:()=>b(4),children:"Set all â™¾ to ðŸ‘"})]}),e.jsx(k,{onClick:n,size:"large",children:"Next Set"})]})]})})}function Bt({suspects:t,questions:s,data:i,hasNewData:r,isDirty:p,save:j,isSaving:m,entriesToUpdate:d,addEntryToUpdate:o}){const{queryParams:h,addParams:u}=P(),a=x.useMemo(()=>{let g=0;const c={};return Object.values(i).forEach(n=>{Object.keys(n).forEach(l=>{if(n[l]){c[l]||(c[l]=0);const b=je(n[l]);b>=5&&(c[l]+=1),b>=3&&(g+=1)}})}),{absoluteTotal:g,queriedTestimoniesCount:Object.keys(i).length,suspectsCount:Object.keys(c).length,reliableSuspectsCount:Object.values(c).filter(n=>n>=30).length}},[i]),f=a.queriedTestimoniesCount*a.suspectsCount;return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs(C,{gap:12,vertical:!0,children:[e.jsx(qe,{dirt:JSON.stringify(d),isDirty:p,isSaving:m,onSave:j}),e.jsx(J,{block:!0,data:async()=>await zt(i),disabled:p,fileName:"testimony-answers.json",hasNewData:r}),e.jsx(Le,{label:"FS Data",path:"data/testimonies"}),e.jsx(Ve,{docId:"testimonies",label:"FS TDR",path:"tdr",queryKey:["tdr","testimonies"]})]})}),e.jsxs(H,{children:[e.jsx(Fe,{label:"Display",onChange:g=>u({display:g,page:1},{page:1}),options:[{title:"Questions",icon:e.jsx(Ye,{}),value:"questions"},{title:"Suspects",icon:e.jsx(it,{}),value:"suspects"},{title:"Simulator",icon:e.jsx(Ge,{}),value:"simulator"}],value:h.get("display")??"questions"}),e.jsx(He,{})]}),e.jsx(H,{children:e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Legend"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Reliability: At least 5 votes"}),e.jsx("li",{children:"Large Bars: There's enough data (at least 3)"}),e.jsx("li",{children:"Small blue bar: in progress negative"})]})]})}),e.jsxs(H,{children:[e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Counts"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Testimonies: ",a.queriedTestimoniesCount]}),e.jsxs("li",{children:["Suspects: ",a.suspectsCount]}),e.jsx("li",{children:e.jsxs(A,{title:"A reliable suspect is one that has at least 5 complete testimonies.",children:["Reliable suspects: ",a.reliableSuspectsCount]})}),e.jsxs("li",{children:["Complete: ",a.absoluteTotal]}),e.jsxs("li",{children:["Total: ",f]}),e.jsxs("li",{children:["Percentage: ",(a.absoluteTotal/f*100).toFixed(1),"%"]})]})]}),e.jsx(Et,{addEntryToUpdate:o,answers:i,questions:s,suspects:t}),e.jsx(J,{block:!0,data:s,fileName:"testimony-questions-pt.json",hasNewData:r,children:"Questions (PT)"})]})]})}async function zt(t){console.log("Preparing file for download...");const s=await Ue("data","testimonies")(),i=Object.values(s).map(j=>Qe(JSON.parse(j)));console.log("Parsed data from Firestore:",i);const r=I.cloneDeep(t),p={};return Object.keys(r).forEach(j=>{const m=r[j];p[j]={};const d=i.reduce((o,h)=>(h[j]&&Object.keys(h[j]).forEach(u=>{o[u]||(o[u]=[]),o[u]=o[u].concat(h[j][u])}),o),{});Object.keys(m).forEach(o=>{if(o.length<6){const a=`us-${Number(o.split("-")[1]).toString().padStart(3,"0")}`,f=d[o]||[],g=d[a]||[],c=m[a]||[],n=W([...m[o],...c,...f,...g]);delete m[o],p[j][a]=JSON.stringify(n)}else{const u=d[o]||[];u.length>0&&console.log({testimonyId:j,suspectId:o,prev:m[o],firestoreValues:u,result:W([...m[o],...u])});const a=W([...m[o],...u]);p[j][o]=JSON.stringify(a)}})}),We(_e(p))}function Fn(){const t=Ee();return e.jsx(Ie,{subtitle:"Suspect Testimony Rates",title:"Testimonies",children:e.jsxs(re,{hasSider:!0,children:[e.jsx(Re,{children:e.jsx(Bt,{...t})}),e.jsx(re.Content,{className:"content",children:e.jsx(Ne,{error:t.error,hasResponseData:!I.isEmpty(t.data),isLoading:t.isLoading,children:e.jsx(vt,{...t})})})]})})}export{Fn as TestimoniesPage,Fn as default};
