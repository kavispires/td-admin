import{r as h,a as L,j as e,T as O,ad as Y,B as w,D as R,P as Z,L as _}from"./index-u4YAhSlc.js";import{D as ee}from"./DataLoadingWrapper-BUCmFWbr.js";import{u as se,P as ne}from"./useGridPagination-Br40uXp0.js";import{u as C}from"./useQueryParams-8Hkoerz0.js";import{u as ae}from"./useResourceFirebaseData-BcfLnhSx.js";import{l as x}from"./lodash-Bjm1XJDL.js";import{L as N}from"./LanguageFlag-CJESuHl5.js";import{I as te}from"./Item-BHVEwEQI.js";import{u as B}from"./useCopyToClipboardFunction-mhj4OBRg.js";import{C as ie}from"./index-OxOn2HN8.js";import{S as D}from"./index-C9yLMmqD.js";import{I as A}from"./index-BGA14dYj.js";import{S as z}from"./index-Dd1MHlhm.js";import{F as S}from"./index-D5nCWXq2.js";import{F as H}from"./index-B0-83e21.js";import{S as oe}from"./index-BwtT8WFB.js";import{R as le}from"./FireFilled-B53wB-3o.js";import{R as re}from"./SaveOutlined-B_lCFZc8.js";import{R as ce}from"./EditOutlined-BRPBnMz3.js";import{u as de}from"./useToggle-Cufe7IRb.js";import{c as T,a as me,T as pe}from"./FilterEntries-BObpX3MB.js";import{S as ue}from"./SiderContent-BNI2VU4b.js";import{D as J}from"./DownloadButton-BKa_baBe.js";import{S as he}from"./SaveButton-Dxjp2S87.js";import{a as q,d as fe,r as ge}from"./index-DnPJC4UB.js";import{M as je}from"./index-XbhTv0Qd.js";import{R as W}from"./CopyOutlined-DuHBYeIP.js";import{D as xe}from"./index-BcohwPMp.js";import{I as ve}from"./ItemsTypeahead-Ftu9E2_0.js";import{R as be}from"./EnvironmentOutlined-CwtLXQYZ.js";import{P as ye}from"./useBaseUrl-DE7ZKGHU.js";import"./Pagination-DxYj2wG_.js";import"./useGetFirebaseDoc-BX-J2aCq.js";import"./useTDResource-CUCNzABN.js";import"./useUpdateFirebaseDoc-BxjhbbYY.js";import"./useMutation-BRByM6VL.js";import"./index-CoCNh4Yw.js";import"./PlusOutlined-ByZyTB3m.js";import"./gapSize-U1swVQyS.js";import"./Input-CNJfsg7T.js";import"./index-CQ4JTQ54.js";import"./moment-C5S46NFB.js";import"./constants-fHp6VAf7.js";import"./useDebounce-Cmnf63RE.js";var we={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"},ke={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482.88 128c-84.35 0-156.58 52.8-185.68 126.98-60.89 8.13-115.3 43.63-146.6 97.84-42.16 73-32.55 161.88 17.14 224.16-23.38 56.75-19.85 121.6 11.42 175.78 42.18 73.02 124.1 109.15 202.94 97.23C419.58 898.63 477.51 928 540.12 928c84.35 0 156.58-52.8 185.68-126.98 60.89-8.13 115.3-43.62 146.6-97.84 42.16-73 32.55-161.88-17.14-224.16 23.38-56.75 19.85-121.6-11.42-175.78-42.18-73.02-124.1-109.15-202.94-97.23C603.42 157.38 545.49 128 482.88 128m0 61.54c35.6 0 68.97 13.99 94.22 37.74-1.93 1.03-3.92 1.84-5.83 2.94l-136.68 78.91a46.11 46.11 0 00-23.09 39.78l-.84 183.6-65.72-38.34V327.4c0-76 61.9-137.86 137.94-137.86m197.7 75.9c44.19 3.14 86.16 27.44 109.92 68.57 17.8 30.8 22.38 66.7 14.43 100.42-1.88-1.17-3.6-2.49-5.53-3.6l-136.73-78.91a46.23 46.23 0 00-46-.06l-159.47 91.1.36-76.02 144.5-83.41a137.19 137.19 0 0178.53-18.09m-396.92 55.4c-.07 2.2-.3 4.35-.3 6.56v157.75a46.19 46.19 0 0022.91 39.9l158.68 92.5-66.02 37.67-144.55-83.35c-65.86-38-88.47-122.53-50.45-188.34 17.78-30.78 46.55-52.69 79.73-62.68m340.4 79.93l144.54 83.35c65.86 38 88.47 122.53 50.45 188.34-17.78 30.78-46.55 52.69-79.73 62.68.07-2.19.3-4.34.3-6.55V570.85a46.19 46.19 0 00-22.9-39.9l-158.69-92.5zM511.8 464.84l54.54 31.79-.3 63.22-54.84 31.31-54.54-31.85.3-63.16zm100.54 58.65l65.72 38.35V728.6c0 76-61.9 137.86-137.94 137.86-35.6 0-68.97-13.99-94.22-37.74 1.93-1.03 3.92-1.84 5.83-2.94l136.68-78.9a46.11 46.11 0 0023.09-39.8zm-46.54 89.55l-.36 76.02-144.5 83.41c-65.85 38-150.42 15.34-188.44-50.48-17.8-30.8-22.38-66.7-14.43-100.42 1.88 1.17 3.6 2.5 5.53 3.6l136.74 78.91a46.23 46.23 0 0046 .06z"}}]},name:"open-a-i",theme:"outlined"},Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"};function F(){return F=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},F.apply(this,arguments)}const Ce=(s,a)=>h.createElement(L,F({},s,{ref:a,icon:we})),Se=h.forwardRef(Ce);function $(){return $=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},$.apply(this,arguments)}const Ne=(s,a)=>h.createElement(L,$({},s,{ref:a,icon:ke})),Oe=h.forwardRef(Ne);function M(){return M=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},M.apply(this,arguments)}const Pe=(s,a)=>h.createElement(L,M({},s,{ref:a,icon:Ie})),Te=h.forwardRef(Pe),Q=h.createContext({items:{},isLoading:!0,error:null,hasResponseData:!1,decksDict:{},decks:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1",hasFirestoreData:!1}),Re=({children:s})=>{const{queryParams:a}=C(),{data:t,isLoading:n,error:o,isSaving:m,save:c,addEntryToUpdate:g,entriesToUpdate:r,isDirty:j,hasFirestoreData:p}=ae({tdrResourceName:"items",firebaseDataCollectionName:"items"}),{decksDict:i,decks:u}=h.useMemo(()=>{console.log("Recomputing item decks typeahead...");const b={},d={},v={},I=[];Object.values(t).forEach(f=>{var U;const K=`${f.name.en} (${f.id})`,X=`${f.name.pt} (${f.id})`;d[f.name.en]?I.push([`${f.name.en} (${d[f.name.en]})`,K]):d[f.name.en]=f.id,v[f.name.pt]?I.push([`${f.name.pt} (${v[f.name.pt]})`,X]):v[f.name.pt]=f.id,(U=f==null?void 0:f.decks)==null||U.forEach(V=>{b[V]=V})});const P=x.orderBy(Object.keys(b)).map(f=>({value:f}));return I.length>0&&console.warn("Possible duplicated items",I),{decksDict:b,decks:P}},[t,m,n]),l=a.get("deck")??"all",y=h.useMemo(()=>{const b=x.orderBy(Object.values(t),[d=>Number(d.id)],"asc");switch(l){case"all":return b;case"!all":return b.filter(d=>{var v;return!((v=d==null?void 0:d.decks)!=null&&v.length)||!0});case"nsfw":return b.filter(d=>d.nsfw);case"!nsfw":return b.filter(d=>!d.nsfw);default:return l.startsWith("!")?b.filter(d=>{var v;return!((v=d==null?void 0:d.decks)!=null&&v.includes(l.slice(1)))}):b.filter(d=>{var v;return(v=d==null?void 0:d.decks)==null?void 0:v.includes(l)})}},[t,l]),G=h.useMemo(()=>{var I;const b=x.orderBy(Object.keys(r),[P=>Number(P)],"asc"),d=(I=y[y.length-1])==null?void 0:I.id,v=x.orderBy([...b,d],[P=>Number(P)],"desc")[0];return String(Number(v)+1)},[y,r]);return e.jsx(Q.Provider,{value:{items:t,listing:y,isLoading:n,error:o,decksDict:i,decks:u,hasResponseData:y.length>0,isDirty:j,addItemToUpdate:g,isSaving:m,save:c,itemsToUpdate:r,newId:G,hasFirestoreData:p},children:s})},k=()=>h.useContext(Q);function De(s,a=!1){const{addItemToUpdate:t,itemsToUpdate:n}=k(),[o,m]=h.useState(a),[c,g]=h.useState(x.cloneDeep(s)),r=n[s.id]??s,j=l=>{const y={...x.cloneDeep(c),...l};Object.keys(l).includes("nsfw")&&l.nsfw===!1&&(y.nsfw=void 0),g(y)},p=async()=>{t(c.id,c)},i=()=>{g(x.cloneDeep(s)),m(!1)},u=JSON.stringify(r)!==JSON.stringify(c);return{isEditing:o,toggleEditMode:()=>m(l=>!l),editableItem:c,onEdit:j,isDirty:u,onModify:p,onReset:i}}function E({item:s,editMode:a=!1,simplified:t}){const{decks:n}=k(),{isEditing:o,toggleEditMode:m,onEdit:c,isDirty:g,onModify:r,onReset:j,editableItem:p}=De(s,a),i=B(),{is:u}=C();return e.jsxs(ie,{title:e.jsx(O.Text,{onClick:()=>i(s.id),children:s.id}),extra:e.jsx($e,{item:s}),style:{maxWidth:250},size:t?"small":"default",actions:t?void 0:g?[e.jsx(Te,{onClick:j},"reset"),e.jsx(re,{onClick:r},"save")]:[e.jsx(ce,{onClick:m},"edit")],children:[e.jsx(te,{id:s.id,width:t?75:125,title:`${s.name.en} | ${s.name.pt}`}),e.jsxs(D,{size:"small",direction:"vertical",className:"my-4",children:[e.jsx(A,{prefix:e.jsx(N,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:o?"outlined":"borderless",size:"small",defaultValue:s.name.en,readOnly:!o,onChange:l=>c({name:{...p.name,en:l.target.value}})},`en-${s.name.en}`),e.jsx(A,{prefix:e.jsx(N,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:o?"outlined":"borderless",size:"small",defaultValue:s.name.pt,readOnly:!o,onChange:l=>c({name:{...p.name,pt:l.target.value}})},`pt-${s.name.pt}`),!t&&e.jsxs(e.Fragment,{children:[!u("simplified")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(z,{mode:"multiple",style:{width:"100%"},placeholder:"Select a deck",defaultValue:s.decks,disabled:!o,options:n,variant:o?"outlined":"borderless",size:"small",onChange:l=>c({decks:l.sort()})},String(s.decks))}),e.jsxs(S,{gap:6,children:[e.jsx(N,{language:"en",width:"1em"}),e.jsx(z,{mode:"tags",style:{width:"100%"},placeholder:"Other names EN",defaultValue:s.aliasesEn,options:[],size:"small",onChange:l=>c({aliasesEn:l.sort()})})]}),e.jsxs(S,{gap:6,children:[e.jsx(N,{language:"pt",width:"1em"}),e.jsx(z,{mode:"tags",style:{width:"100%"},placeholder:"Other names PT",defaultValue:s.aliasesPt,options:[],size:"small",onChange:l=>c({aliasesPt:l.sort()})})]})]}),u("showVerifyThing")&&e.jsx("div",{children:e.jsx(ze,{item:s})}),(o||s.nsfw)&&e.jsx("div",{children:e.jsx(H.Item,{label:"nsfw",valuePropName:"checked",children:e.jsx(oe,{checked:s.nsfw,onChange:l=>c({nsfw:l}),size:"small",checkedChildren:e.jsx(le,{style:{color:"hotpink"}}),disabled:!o})})})]})]})]})}const Ee=x.memoize(s=>{var c,g;const a=!!((c=s.decks)!=null&&c.includes("thing")),t=!!((g=s.decks)!=null&&g.includes("manufactured")),n=s.name.en.split(" ").length===1,o=s.name.pt.split(" ").length===1,m={en:a||n&&t,pt:a||o&&t};return!m.pt&&!m.en?"":e.jsxs(e.Fragment,{children:[m.en&&e.jsx(N,{language:"en",width:"1em"}),m.pt&&e.jsx(N,{language:"pt",width:"1em"})]})}),ze=({item:s})=>{const a=Ee(s);return a?e.jsxs(S,{gap:6,children:["Thing: ",a]}):e.jsx(e.Fragment,{})},Fe=s=>({id:s.id,type:"item",header:{title:{en:"Item",pt:"Item"},iconId:"2077"},metadata:{level:"basic",keyword:x.snakeCase(s.name.en).toUpperCase()},content:{itemId:s.id,caption:s.name}});function $e({item:s}){const[a,t]=de(!1),n=B();return e.jsx(Y,{content:e.jsxs(D,{direction:"vertical",children:[e.jsx(w,{size:"small",onClick:()=>n(JSON.stringify(s,null,2)),children:"Complete Item"}),e.jsx(w,{size:"small",onClick:()=>n(s.name.en),children:"EN Name"}),e.jsx(w,{size:"small",onClick:()=>n(s.name.pt),children:"PT Name"}),e.jsx(w,{size:"small",onClick:()=>n(JSON.stringify(Fe(s),null,2)),children:"Escape Room Item"})]}),title:"Copy",trigger:"click",open:a,onOpenChange:t,children:e.jsx(w,{type:"text",icon:e.jsx(Se,{})})})}function Me(){const{queryParams:s}=C(),a=s.get("deck")??"all",{listing:t}=k(),{page:n,pagination:o}=se({data:t,resetter:a}),{is:m}=C(),c=m("simplified");return e.jsxs(e.Fragment,{children:[e.jsxs(O.Title,{level:2,children:["Listing - ",x.capitalize(a)," items (",t.length,")"]}),e.jsx(ne,{pagination:o,className:"full-width",children:e.jsx(S,{gap:16,wrap:"wrap",children:n.map(g=>e.jsx(E,{item:g,simplified:c},g.id))})})]})}const Le={id:"",name:{en:"",pt:""},groups:[]};function Be({isModalOpen:s,handleOk:a,handleCancel:t,newId:n}){const[o]=h.useState(x.cloneDeep({...Le,id:n}));return e.jsx(je,{title:"Add new item",open:s,onOk:a,onCancel:t,children:e.jsx(E,{item:o,editMode:!0})})}function Ue(){const[s,a]=h.useState(!1),{newId:t}=k(),n=()=>{a(!0)},o=()=>{a(!1)},m=()=>{a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(w,{block:!0,onClick:n,children:"Add New Item"}),s&&e.jsx(Be,{isModalOpen:s,handleOk:o,handleCancel:m,newId:t},t)]})}function Ve(){const{isDirty:s,save:a,items:t,decks:n,itemsToUpdate:o,isSaving:m,hasFirestoreData:c}=k(),{queryParams:g,is:r,addParam:j}=C(),p=h.useMemo(()=>{const i=x.orderBy(n.map(({value:l})=>({label:x.capitalize(l),value:l})),"label"),u=i.map(({label:l,value:y})=>({label:`NOT ${l}`,value:`!${y}`}));return[...i,...u]},[n]);return e.jsxs(ue,{children:[e.jsxs(S,{vertical:!0,gap:6,children:[e.jsx(he,{isDirty:s,dirt:JSON.stringify(o),onSave:a,isSaving:m}),e.jsx(J,{data:()=>_e(t),fileName:"items.json",disabled:s,hasNewData:c,block:!0})]}),e.jsx(R,{className:"my-4"}),e.jsx(O.Text,{type:"secondary",children:"Tools"}),e.jsx(T,{label:"Show Search",value:!r("hideSearch"),onChange:i=>j("hideSearch",i?"":"true",""),className:"full-width m-0"}),e.jsx(T,{label:"Show Randomizer",value:r("showRandomizer"),onChange:i=>j("showRandomizer",i?"true":"",""),className:"full-width m-0"}),e.jsx(O.Text,{type:"secondary",children:"Display"}),e.jsx(T,{label:"Simplified UI",value:r("simplified"),onChange:i=>j("simplified",i?"true":""),className:"full-width m-0"}),e.jsx(T,{label:"Thing Verifier",value:r("showVerifyThing"),onChange:i=>j("showVerifyThing",i?"true":""),className:"full-width m-0",disabled:r("simplified")}),e.jsx(T,{label:"Other Names",value:r("showOtherNames"),onChange:i=>j("showOtherNames",i?"true":""),className:"full-width m-0",disabled:!0}),e.jsx(R,{className:"my-4"}),e.jsx(me,{label:"Deck",value:g.get("deck")??"all",onChange:i=>j("deck",i,"all"),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...p,{label:"No decks",value:"!all"}]}),e.jsx(R,{className:"my-4"}),e.jsx(Ue,{}),e.jsx(R,{className:"my-4"}),e.jsx(J,{data:()=>Ae(t),fileName:"items-gpt.json",disabled:s,block:!0,icon:e.jsx(Oe,{}),children:"Open AI JSON"})]})}function _e(s){console.log("Preparing file for download...");const a=x.cloneDeep(s);return Object.values(a).reduce((t,n)=>(n.aliasesEn=Object.values(n.aliasesEn??{}).sort(),n.aliasesEn.length===0&&(n.aliasesEn=void 0),n.aliasesPt=Object.values(n.aliasesPt??{}).sort(),n.aliasesPt.length===0&&(n.aliasesPt=void 0),n.decks=Object.values((n==null?void 0:n.decks)??{}).sort(),n.decks.length===0&&(n.decks=void 0),t[n.id]=n,t),{}),q(fe(a))}function Ae(s){return q(Object.values(x.cloneDeep(s)).reduce((a,t)=>{const n={id:t.id,names:{"en-US":t.name.en,"pt-BR":t.name.pt},aliases:{"en-US":t.aliasesEn,"pt-BR":t.aliasesPt}};return a[n.id]=n,a},{}))}function Je(){const{listing:s}=k(),[a,t]=h.useState([]),n=B(),[o,m]=h.useState(5),c=()=>{t(x.sampleSize(s,o))},g=[{label:"Copy IDs",key:"copy_ids"},{label:"Copy Names EN",key:"copy_names_en"},{label:"Copy Names PT",key:"copy_names_pt"}],r=({key:p})=>{if(p==="copy_ids"){const i=a.map(u=>u.id);n(JSON.stringify(i));return}if(p==="copy_names_en"){const i=a.map(u=>u.name.en).join(", ");n(i);return}if(p==="copy_names_pt"){const i=a.map(u=>u.name.pt).join(", ");n(i);return}},j=()=>{const p=x.chunk(x.sampleSize(s,o*15),o).map(i=>i.filter(u=>!u.nsfw)).map(i=>i.map(u=>u.name.en).join(", ")).map((i,u)=>`${u+1}) ${i}`).join(`
`);n(p)};return e.jsxs("div",{children:[e.jsxs(O.Title,{level:2,children:["Randomized Sample"," ",e.jsx(w,{size:"small",icon:e.jsx(W,{}),onClick:j,children:"MJ"})]}),e.jsxs(S,{gap:12,children:[e.jsx(H.Item,{label:"Quantity"}),e.jsx("div",{children:e.jsx(pe,{min:3,max:15,value:o,onChange:p=>m(Number(p)),style:{minWidth:"100px"}})}),e.jsx(w,{onClick:c,type:"primary",children:"Get Sample"}),e.jsx(xe.Button,{menu:{items:g,onClick:r},disabled:a.length===0,onClick:()=>n(JSON.stringify(a,null,2)),icon:e.jsx(W,{}),children:"Copy"})]}),e.jsx(D,{wrap:!0,className:"my-4",children:a.map(p=>e.jsx(E,{item:p,simplified:!0},p.id))})]})}function We(){const{items:s,isLoading:a,isSaving:t}=k(),[n,o]=h.useState(null),{queryParams:m,addParam:c}=C(),g=r=>{const j=Number(m.get("pageSize")??64),p=Number(r),i=Math.floor(p/j)+1;c("page",i.toString())};return e.jsxs(h.Fragment,{children:[e.jsx(O.Title,{level:2,children:"Search for an item"}),e.jsx("div",{children:e.jsx(ve,{items:s,isPending:a||t,onFinish:r=>o([s[r]]),onFinishMultiple:r=>o(ge(r).map(j=>s[j]))})}),e.jsx(S,{className:"my-4",gap:8,children:n==null?void 0:n.map(r=>e.jsxs(D,{direction:"vertical",className:"my-4",children:[e.jsx(E,{item:r}),e.jsx(w,{onClick:()=>g(r.id),block:!0,icon:e.jsx(be,{}),children:"Find in listing"})]},r.id))})]},`item-search-${a}`)}function He(){const{isLoading:s,error:a,hasResponseData:t}=k(),{is:n}=C();return e.jsx(Z,{title:"Items",subtitle:"Listing",children:e.jsxs(_,{hasSider:!0,children:[e.jsx(ye,{children:e.jsx(Ve,{})}),e.jsx(_.Content,{className:"content",children:e.jsxs(ee,{isLoading:s,error:a,hasResponseData:t,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{size:"large",align:"start",children:[!n("hideSearch")&&e.jsx(We,{}),n("showRandomizer")&&e.jsx(Je,{})]}),e.jsx(R,{})]}),e.jsx(Me,{})]})})]})})}function Ms(){return e.jsx(Re,{children:e.jsx(He,{})})}export{Ms as default};
