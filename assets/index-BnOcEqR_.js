import{g as oe,R as o,C as re,c as N,as as I}from"./index-YrxXJCRo.js";import{t as _}from"./throttleByAnimationFrame-CW_StkON.js";const ie=t=>{const{componentCls:a}=t;return{[a]:{position:"fixed",zIndex:t.zIndexPopup}}},se=t=>({zIndexPopup:t.zIndexBase+10}),ae=oe("Affix",ie,se);function S(t){return t!==window?t.getBoundingClientRect():{top:0,bottom:window.innerHeight}}function z(t,a,r){if(r!==void 0&&Math.round(a.top)>Math.round(t.top)-r)return r+a.top}function F(t,a,r){if(r!==void 0&&Math.round(a.bottom)<Math.round(t.bottom)+r){const s=window.innerHeight-a.bottom;return r+s}}var ce=function(t,a){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&a.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(t);c<s.length;c++)a.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(t,s[c])&&(r[s[c]]=t[s[c]]);return r};const L=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"];function le(){return typeof window<"u"?window:null}const B=0,j=1,he=o.forwardRef((t,a)=>{var r;const{style:s,offsetTop:c,offsetBottom:m,prefixCls:M,className:U,rootClassName:H,children:V,target:d,onChange:w,onTestUpdatePosition:fe}=t,G=ce(t,["style","offsetTop","offsetBottom","prefixCls","className","rootClassName","children","target","onChange","onTestUpdatePosition"]),{getPrefixCls:X,getTargetContainer:k}=o.useContext(re),T=X("affix",M),[D,q]=o.useState(!1),[f,J]=o.useState(),[K,Q]=o.useState(),R=o.useRef(B),E=o.useRef(null),u=o.useRef(null),h=o.useRef(null),C=o.useRef(null),x=o.useRef(null),l=(r=d??k)!==null&&r!==void 0?r:le,A=m===void 0&&c===void 0?0:c,W=()=>{if(R.current!==j||!C.current||!h.current||!l)return;const i=l();if(i){const n={status:B},e=S(h.current);if(e.top===0&&e.left===0&&e.width===0&&e.height===0)return;const v=S(i),g=z(e,v,A),O=F(e,v,m);g!==void 0?(n.affixStyle={position:"fixed",top:g,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}):O!==void 0&&(n.affixStyle={position:"fixed",bottom:O,width:e.width,height:e.height},n.placeholderStyle={width:e.width,height:e.height}),n.lastAffix=!!n.affixStyle,D!==n.lastAffix&&(w==null||w(n.lastAffix)),R.current=n.status,J(n.affixStyle),Q(n.placeholderStyle),q(n.lastAffix)}},b=()=>{R.current=j,W()},p=_(()=>{b()}),y=_(()=>{if(l&&f){const i=l();if(i&&h.current){const n=S(i),e=S(h.current),v=z(e,n,A),g=F(e,n,m);if(v!==void 0&&f.top===v||g!==void 0&&f.bottom===g)return}}b()}),P=()=>{const i=l==null?void 0:l();i&&(L.forEach(n=>{var e;u.current&&((e=E.current)===null||e===void 0||e.removeEventListener(n,u.current)),i==null||i.addEventListener(n,y)}),E.current=i,u.current=y)},Y=()=>{x.current&&(clearTimeout(x.current),x.current=null);const i=l==null?void 0:l();L.forEach(n=>{var e;i==null||i.removeEventListener(n,y),u.current&&((e=E.current)===null||e===void 0||e.removeEventListener(n,u.current))}),p.cancel(),y.cancel()};o.useImperativeHandle(a,()=>({updatePosition:p})),o.useEffect(()=>(x.current=setTimeout(P),()=>Y()),[]),o.useEffect(()=>{P()},[d,f]),o.useEffect(()=>{p()},[d,c,m]);const[Z,$,ee]=ae(T),te=N(H,$,T,ee),ne=N({[te]:f});return Z(o.createElement(I,{onResize:p},o.createElement("div",Object.assign({style:s,className:U,ref:h},G),f&&o.createElement("div",{style:K,"aria-hidden":"true"}),o.createElement("div",{className:ne,ref:C,style:f},o.createElement(I,{onResize:p},V)))))});export{he as A};
