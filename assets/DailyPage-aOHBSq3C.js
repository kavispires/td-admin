import{r as g,a as H,_ as B,j as r,T as F,B as V,a2 as re,a4 as ae,aM as Ee,ao as w,aj as we,D as Oe,aN as Ne,aO as Te,a1 as Le,a0 as Me,a3 as ce,P as Re,L as de}from"./index-BvgJVW7d.js";import{u as me}from"./useQueryParams-C0m2l_EQ.js";import{R as pe,c as ke}from"./useTestimoniesResource-BBOiX261.js";import{a as Ge,C as Ue,u as fe}from"./useArteRuimDrawings-kTJp3pMC.js";import{u as he}from"./useMutation-CU6V_BvD.js";import{g as Ye,u as _e}from"./useGetFirestoreDoc-D4mW-Dvh.js";import{h as Y}from"./moment-C5S46NFB.js";import{a as ie,m as Qe,r as ge,j as Pe}from"./index-BOEwK3Jx.js";import{F as D}from"./index-DTdaIeah.js";import{S as Q}from"./index-Cbfw24BI.js";import{I as le}from"./index-M0CbH9Pw.js";import{T as qe,a as se,F as Ve}from"./FilterEntries-DAehkN6x.js";import{T as $}from"./index-CmCCTxGn.js";import{S as Fe}from"./index-VhfxMJYB.js";import{F as xe}from"./FirestoreConsoleLink-CavUHU2w.js";import{C as $e}from"./CopyToClipboardButton-yP8YRRFa.js";import{I as ne}from"./ImageCard-DSPg33KU.js";import{f as He,W as Be,d as P,g as Z}from"./constants-D9Dpf4ur.js";import{I as q}from"./Item-CClapcG9.js";import{l as p,P as We}from"./useBaseUrl-D1KQyl61.js";import{g as ze,u as G,D as y,a as _,c as X,b as Ke,L as je}from"./constants-DkI4H2ZF.js";import{R as Je,a as Ze}from"./DoubleRightOutlined-CXLG8eDk.js";import{F as Ie}from"./Table-CDT_TX_Z.js";import{D as Xe}from"./DataLoadingWrapper-DbxLta2F.js";import{u as E}from"./useTDResource-BN7Ah5z6.js";import{u as oe}from"./useLoadWordLibrary-CAxQp_Cd.js";import{g as ye}from"./utils-BxSvbnVR.js";import{u as et}from"./daily-teoria-de-conjuntos-DbOJcMF0.js";import{u as ve}from"./useDailyHistoryQuery-DGYcPLky.js";import{R as tt}from"./SaveOutlined-Bh36DPhn.js";import{S as st}from"./SiderContent-46R1r0GQ.js";import"./useResourceFirestoreData-_KlcHWEV.js";import"./useUpdateFirestoreDoc-CJzmwTHX.js";import"./gapSize-U1swVQyS.js";import"./Input-DDQRQFh-.js";import"./index-5gGgnGWi.js";import"./index-B25zXE0m.js";import"./index-X4WmpXU9.js";import"./useCopyToClipboardFunction-DX5TC-IC.js";import"./CopyOutlined-DtTAbV7x.js";import"./Pagination-zda6Desw.js";import"./index-D3tyqM8J.js";import"./index-CF-_ss-M.js";import"./scrollTo-D1OyGVJw.js";import"./extendsObject-keMuGWqj.js";var nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"},rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}},{tag:"path",attrs:{d:"M376.9 656.4c1.8-33.5 15.7-64.7 39.5-88.6 25.4-25.5 60-39.8 96-39.8 36.2 0 70.3 14.1 96 39.8 1.4 1.4 2.7 2.8 4.1 4.3l-25 19.6a8 8 0 003 14.1l98.2 24c5 1.2 9.9-2.6 9.9-7.7l.5-101.3c0-6.7-7.6-10.5-12.9-6.3L663 532.7c-36.6-42-90.4-68.6-150.5-68.6-107.4 0-195 85.1-199.4 191.7-.2 4.5 3.4 8.3 8 8.3H369c4.2-.1 7.7-3.4 7.9-7.7zM703 664h-47.9c-4.2 0-7.7 3.3-8 7.6-1.8 33.5-15.7 64.7-39.5 88.6-25.4 25.5-60 39.8-96 39.8-36.2 0-70.3-14.1-96-39.8-1.4-1.4-2.7-2.8-4.1-4.3l25-19.6a8 8 0 00-3-14.1l-98.2-24c-5-1.2-9.9 2.6-9.9 7.7l-.4 101.4c0 6.7 7.6 10.5 12.9 6.3l23.2-18.2c36.6 42 90.4 68.6 150.5 68.6 107.4 0 195-85.1 199.4-191.7.2-4.5-3.4-8.3-8-8.3z"}}]},name:"cloud-sync",theme:"outlined"},at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M396 512a112 112 0 10224 0 112 112 0 10-224 0zm546.2-25.8C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM508 688c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z"}}]},name:"eye",theme:"filled"},lt=function(a,n){return g.createElement(H,B({},a,{ref:n,icon:nt}))},ct=g.forwardRef(lt),dt=function(a,n){return g.createElement(H,B({},a,{ref:n,icon:rt}))},ut=g.forwardRef(dt),mt=function(a,n){return g.createElement(H,B({},a,{ref:n,icon:at}))},pt=g.forwardRef(mt),ft=function(a,n){return g.createElement(H,B({},a,{ref:n,icon:it}))},ht=g.forwardRef(ft),gt=function(a,n){return g.createElement(H,B({},a,{ref:n,icon:ot}))},xt=g.forwardRef(gt);function jt(){const[t,a]=g.useState(""),[n,o]=g.useState(7),[e,s]=g.useState(!1),[i,l]=g.useState(!1),[c,d]=g.useState(""),{isLoading:m,isError:u,data:x}=It(t,n,i),f=v=>{s(!1),l(!1),a(v.trim())},I=v=>{l(!1),o(v)},C=()=>{const v=Y(t,"YYYY-MM-DD",!0).isValid();s(v),l(v)},S=g.useMemo(()=>{if(!x||Object.keys(x).length===0)return{};if(!c)return x;const v=c;if(!Object.values(x).every(j=>j==null?void 0:j[v]))return x;const O={};return Object.values(x).forEach(j=>{const h=j==null?void 0:j[v],U=h==null?void 0:h.number;O[U]&&console.error(`Duplicate entry for game ${v} with number ${U}`),O[U]=ie(h,["number","language","text"])}),O},[x,c]);return r.jsxs("div",{children:[r.jsx(F.Title,{level:2,children:"Data Archive"}),r.jsxs(D,{justify:"space-between",align:"center",className:"mb-6",children:[r.jsxs(D,{gap:12,align:"center",children:[r.jsxs(Q.Compact,{children:[r.jsx(le,{placeholder:"YYYY-MM-DD",value:t,onChange:v=>f(v.target.value)}),r.jsx(qe,{min:1,max:100,value:n,onChange:v=>I(v??1)}),r.jsx(V,{type:"primary",onClick:C,disabled:!t||!Y(t,"YYYY-MM-DD",!0).isValid(),children:"Load"})]}),t&&r.jsxs("span",{children:[r.jsx($,{children:t}),n>1&&r.jsxs(r.Fragment,{children:["to"," ",r.jsx($,{children:Y(t).add(n-1,"days").format("YYYY-MM-DD")})]})]}),r.jsx("span",{children:r.jsx($,{color:m?"blue":u?"red":e?"green":"gray",children:m?"Loading...":u?"Error":e?"Valid":"Ready"})})]}),r.jsxs(D,{gap:12,align:"center",children:[r.jsx(yt,{}),r.jsx(Fe,{style:{width:200},placeholder:"Filter by game",allowClear:!0,onChange:v=>d(v),options:[{value:"",label:"All games"},{value:"aqui-o",label:"Aqui Ó"},{value:"arte-ruim",label:"Arte Ruim"},{value:"artista",label:"Artista"},{value:"comunicacao-alienigena",label:"Comunicação Alienígena"},{value:"controle-de-estoque",label:"Controle de Estoque"},{value:"filmaco",label:"Filmaço"},{value:"palavreado",label:"Palavreado"},{value:"portais-magicos",label:"Portais Mágicos"},{value:"quartetos",label:"Quartetos"},{value:"ta-na-cara",label:"Tá na Cara"},{value:"teoria-de-conjuntos",label:"Teoria de Conjuntos"}]})]})]}),r.jsx(pe,{src:S,theme:"twilight",collapsed:1})]})}const It=(t,a,n)=>{const o=g.useMemo(()=>{if(!n||!Y(t,"YYYY-MM-DD",!0).isValid())return[];const c=[],d=Y(t);for(let m=0;m<a;m++){const u=d.clone().add(m,"days").format("YYYY-MM-DD");c.push({queryKey:["firebase","diario",u],queryFn:Ye("diario",u),enabled:!0})}return c},[t,a,n]),e=Ge({queries:o}),s=e.some(c=>c.isLoading),i=e.some(c=>c.isError),l=g.useMemo(()=>s||i?{}:e.reduce((c,d,m)=>{if(d.data&&Object.keys(d.data).length>0){const u=Y(t).add(m,"days").format("YYYY-MM-DD");c[u]=d.data}return c},{}),[e,t,s,i]);return{isLoading:s,isError:i,data:l,results:e}};function yt(){const t=he({mutationFn:async()=>{const a="2024-01-01",n="2024-04-30";try{const o=Y(a),e=Y(n);for(let s=0;s<=e.diff(o,"days");s++){const i=o.clone().add(s,"days").format("YYYY-MM-DD"),l=re(ae,"diario",i);await Ee(l)}}catch(o){throw new Error(o)}},onError:a=>{console.error("Error deleting documents:",a)},onSuccess:()=>{console.log(" Documents deleted successfully")}});return r.jsx(V,{danger:!0,onClick:()=>t.mutate(),loading:t.isPending,disabled:!0,children:"Delete secured documents"})}function L({children:t}){return r.jsx(Q,{direction:"vertical",style:{maxWidth:120},children:t})}function M({children:t}){return r.jsxs($,{color:"cyan",children:["#",t]})}function A({label:t,children:a}){return r.jsxs(F.Text,{children:[r.jsxs("strong",{children:[t,":"]})," ",a]})}function R({children:t}){return r.jsx(we,{trigger:"click",content:t,title:"Sneak Peek",children:r.jsx(V,{icon:r.jsx(xt,{})})})}const De=[{title:"Id",dataIndex:"id",key:"id",fixed:"left"},{title:"Arte Ruim",dataIndex:"arte-ruim",key:"arte-ruim",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,cardId:n,text:o,drawings:e}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"CardId",children:n}),r.jsx(A,{label:"Drawings",children:e.length}),r.jsx(R,{children:r.jsxs(D,{gap:6,vertical:!0,children:[r.jsxs("div",{children:['"',o.split("").map((s,i)=>i<2||s===" "?s:"⏹").join(""),'"']}),r.jsx(Q,{wrap:!0,children:e.map(s=>r.jsx(Ue,{drawing:s,width:75,height:75,className:"canvas"},s))})]})})]})}},{title:"Aqui O",dataIndex:"aqui-o",key:"aqui-o",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,setId:n,title:o,itemsIds:e}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"SetId",children:n}),r.jsx(A,{label:"Title",children:o.pt}),r.jsx(A,{label:"Items",children:e.length}),r.jsx(R,{children:r.jsx(D,{gap:6,wrap:!0,style:{maxWidth:500},children:e.map(s=>r.jsx(q,{id:s,width:48},s))})})]})}},{title:"Alienígena",dataIndex:"comunicacao-alienigena",key:"comunicacao-alienigena",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,itemsIds:n,attributes:o}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"Items",children:n.length}),r.jsx(R,{children:r.jsxs(D,{gap:6,style:{maxWidth:"300px"},vertical:!0,children:[r.jsx(Q,{wrap:!0,children:o.map(e=>r.jsx(He,{id:`sign-${e.spriteId}`,width:48},e.spriteId))}),r.jsx(Q,{wrap:!0,children:n.map(e=>r.jsx(q,{id:e,width:48},e))})]})})]})}},{title:"Conjuntos",dataIndex:"teoria-de-conjuntos",key:"teoria-de-conjuntos",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,rule1:n,intersectingThing:o,rule2:e,title:s,things:i}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"Title",children:s}),r.jsx(R,{children:r.jsxs(D,{vertical:!0,gap:6,children:[r.jsxs(D,{gap:6,children:[r.jsx(q,{id:n.thing.id,width:48}),r.jsx(q,{id:o.id,width:48}),r.jsx(q,{id:e.thing.id,width:48})]}),r.jsx(D,{gap:6,children:i.map(l=>r.jsx(q,{id:l.id,width:35},l.id))})]})})]})}},{title:"Estoque",dataIndex:"controle-de-estoque",key:"controle-de-estoque",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,title:n,goods:o}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"Title",children:n}),r.jsx(A,{label:"Goods",children:o.length}),r.jsx(R,{children:r.jsx(D,{gap:6,wrap:!0,style:{maxWidth:245},children:o.map(e=>r.jsx(Be,{id:e,width:48},e))})})]})}},{title:"Filmaço",dataIndex:"filmaco",key:"filmaco",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,setId:n,title:o,year:e}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"SetId",children:n}),r.jsx(R,{children:r.jsxs(D,{gap:6,vertical:!0,children:[r.jsxs("span",{children:["Year: ",e]}),r.jsxs("span",{children:["Title:"," ",o.split("").map((s,i)=>i<1||s===" "?s:"⏹").join("")]})]})})]})}},{title:"Organiku",dataIndex:"organiku",key:"organiku",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,setId:n,title:o,grid:e,defaultRevealedIndexes:s}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"SetId",children:n}),r.jsx(A,{label:"Title",children:o}),r.jsx(R,{children:r.jsx("div",{className:"grid",style:{gridTemplateColumns:"repeat(5, 1fr)",gap:"8px"},children:(e??[]).map((i,l)=>r.jsx("div",{className:"grid-item",children:r.jsx(q,{id:s.includes(l)&&i||"0",width:48,className:s.includes(l)?"red-border":""})},`${i}-${l}`))})})]})}},{title:"Palavreado",dataIndex:"palavreado",key:"palavreado",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,letters:n,keyword:o,words:e}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"Letters",children:n.length}),r.jsx(A,{label:"Keyword",children:o}),r.jsx(R,{children:r.jsx(Q,{direction:"vertical",children:e.map((s,i)=>r.jsx("span",{children:s.split("").map((l,c)=>c===i||l===" "?l:"⏹").join("")},`${a}-${s}`))})})]})}},{title:"Portais",dataIndex:"portais-magicos",key:"portais-magicos",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,setId:n,corridors:o}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"SetId",children:p.truncate(n,{length:9})}),r.jsx(R,{children:r.jsx(D,{gap:6,vertical:!0,children:o.map(e=>r.jsxs(D,{gap:6,vertical:!0,children:[r.jsxs("span",{children:["Passcode: ",e.passcode]}),r.jsx(D,{children:e.imagesIds.map(s=>r.jsx(ne,{id:s,width:48},s))})]},e.passcode))})})]})}},{title:"Quartetos",dataIndex:"quartetos",key:"quartetos",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,setId:n,sets:o}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"SetId",children:p.truncate(n,{length:9})}),r.jsx(R,{children:r.jsx(D,{gap:6,children:o.map(e=>r.jsx(D,{gap:6,vertical:!0,children:e.itemsIds.map(s=>r.jsx(q,{id:s,width:48},s))},e.id))})})]})}},{title:"Picaço",dataIndex:"artista",key:"artista",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,cards:n}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"Cards",children:n.length}),r.jsx(R,{children:r.jsx(D,{gap:6,vertical:!0,style:{maxHeight:500,overflowY:"auto"},children:n.map((o,e)=>r.jsx("span",{children:o.text},`${o.id}-${e}`))})})]})}},{title:"Tá Na Cara",dataIndex:"ta-na-cara",key:"ta-na-cara",render:t=>{if(!t)return r.jsx(w,{message:"No entry",type:"error"});const{number:a,suspectsIds:n,testimonies:o}=t;return r.jsxs(L,{children:[r.jsx(M,{children:a}),r.jsx(A,{label:"Suspects",children:n==null?void 0:n.length}),r.jsx(A,{label:"Questions",children:o.length}),r.jsx(R,{children:r.jsxs(D,{vertical:!0,children:[r.jsx(Q,{direction:"vertical",style:{maxHeight:100,overflowY:"auto"},children:o.map(e=>{var s;return r.jsxs(D,{vertical:!0,children:[r.jsx("span",{children:e.question}),r.jsx(D,{children:(s=e.suspectsIds)==null?void 0:s.map(i=>r.jsx(ne,{id:i,width:48},i))})]},e.testimonyId)})}),r.jsx(Q,{wrap:!0,style:{maxHeight:200,maxWidth:"500px",overflowY:"auto"},children:n==null?void 0:n.map(e=>r.jsx(ne,{id:e,width:48},e))})]})})]})}}];function vt(){const[t,a]=g.useState(""),[n,o]=g.useState(!1),{isLoading:e,data:s}=_e("diario",t,{enabled:!!t&&n}),i=g.useMemo(()=>s?[ie(s,["number"])]:[],[s]),l=u=>{o(!1),a(u.trim())},c=()=>{o(Y(t,"YYYY-MM-DD",!0).isValid())},d=()=>{const u=Y(t).subtract(1,"days").format("YYYY-MM-DD");a(u)},m=()=>{const u=Y(t).add(1,"days").format("YYYY-MM-DD");a(u)};return g.useEffect(()=>{!e&&s&&console.log(ie(s))},[s]),r.jsxs("div",{children:[r.jsx(F.Title,{level:2,children:"Data Verification"}),r.jsx(D,{justify:"space-between",align:"center",className:"mb-6",children:r.jsxs(D,{gap:12,align:"center",children:[r.jsxs(Q.Compact,{children:[r.jsx(le,{placeholder:"YYYY-MM-DD",onChange:u=>l(u.target.value)}),r.jsx(V,{type:"primary",onClick:c,children:"Load"})]}),t&&r.jsxs(D,{gap:6,align:"center",children:[r.jsx(V,{icon:r.jsx(Je,{}),onClick:d}),r.jsx("span",{children:r.jsx($,{children:t})}),r.jsx(V,{icon:r.jsx(Ze,{}),onClick:m,disabled:t===ze()})]}),r.jsx("span",{children:r.jsx($,{color:e?"blue":n?"green":"red",children:e?"Loading...":n?"Valid":"Invalid"})}),r.jsx(xe,{path:`/diario/${t}`,disabled:!s})]})}),r.jsx(Ie,{loading:e,columns:De,dataSource:i,scroll:{x:"max-content"}}),r.jsx(Oe,{}),r.jsxs(D,{justify:"space-between",align:"center",className:"mb-4",wrap:!0,children:[r.jsx($e,{content:JSON.stringify(i[0],null,2),shape:"default",className:"mb-4",disabled:!s,children:"Copy to Clipboard"}),r.jsx(Dt,{data:s})]}),r.jsx(pe,{src:i[0]??{},theme:"twilight"})]})}const ue=(t,a)=>{if(!t||!a||a.length<2)return[];const n=[],o=a.toLowerCase(),e=(s,i=[])=>{s&&typeof s=="object"&&Object.entries(s).forEach(([l,c])=>{l.toLowerCase().includes(o)&&n.push([...i,l].join(".")),typeof c=="string"&&c.toLowerCase().includes(o)&&n.push([...i,l].join(".")),typeof c=="object"&&c!==null&&e(c,[...i,l])})};return e(t),n};function Dt({data:t}){const[a,n]=g.useState([]),o=i=>{if(s(i),i.trim().length>1){const l=ue(t,i.trim());n(l)}else n([])},[e,s]=g.useState("");return g.useEffect(()=>{if(t&&e.trim().length>1){const i=ue(t,e.trim());n(i)}else n([])},[t]),r.jsxs(D,{vertical:!0,gap:8,children:[r.jsx(le.Search,{placeholder:"Search in data...",allowClear:!0,onChange:i=>o(i.target.value),onSearch:o,style:{width:250}}),a.length>0&&r.jsxs("div",{children:[r.jsxs(F.Text,{children:["Found ",a.length," matches:"]}),r.jsx("ul",{style:{maxHeight:"200px",overflow:"auto",margin:"4px 0"},children:a.map((i,l)=>r.jsx("li",{children:r.jsx(F.Text,{code:!0,copyable:!0,children:i})},l))})]})]})}const J=new Te({}),W=(t,a)=>{J.setState(n=>({...n,[t]:a}))},bt=()=>{J.setState(()=>({}))},At=()=>Ne(J,()=>J.state),St=(t,a,n,o)=>{const[e]=G(y.AQUI_O,o),s=E("items",t),i=E("daily-disc-sets",t);return{entries:g.useMemo(()=>!t||!i.isSuccess||!e||!s.isSuccess?{}:Ct(n,e,i.data,s.data),[t,i.dataUpdatedAt,s.dataUpdatedAt,e,n]),isLoading:s.isLoading||i.isLoading}},Ct=(t,a,n,o)=>{console.count("Creating Aqui Ó...");const e=p.shuffle(Object.values(n).filter(d=>d.itemsIds.filter(Boolean).length>=20)),s=e.filter(d=>!a.used.includes(d.id));s.length<t&&(console.log("🔆 Not enough aqui-o sets left, shuffling..."),W("aqui-o","Not enough aqui-o sets left"),s.push(...p.shuffle(e)));const i=Object.values(o).filter(d=>d!=null&&d.nsfw?!1:p.intersection(d.decks??[],["alien","dream","thing"]).length>0);let l=a.latestDate;const c={};for(let d=0;d<t;d++){const m=s[d];m||console.error("No aqui-o sets left");const u=_(l),x=X(u);l=u,x?c[u]={id:u,type:"aqui-o",number:a.latestNumber+d+1,setId:"special",title:{pt:"Especial Fim de Semana",en:"Weekend Special"},itemsIds:["0",...p.sampleSize(i,45).map(f=>f.id)]}:c[u]={id:u,type:"aqui-o",number:a.latestNumber+d+1,setId:m.id,title:m.title,itemsIds:["0",...p.sampleSize(m.itemsIds,20)]}}return c},Et=(t,a,n,o)=>{const[e]=G(y.ARTE_RUIM,o),s=fe(t,a);return{entries:g.useMemo(()=>!t||s.isLoading||!e?[]:wt(n,e,s,a),[t,s.dataUpdatedAt,a,e,n]),isLoading:s.isLoading}},wt=(t,a,n,o)=>{console.count("Creating Arte Ruim...");const e=Object.values(n.drawings).filter(c=>!(a.used.includes(c.id)||c.drawings.length<3)).map(c=>({id:c.id,type:"arte-ruim",language:o??"pt",cardId:c.id,text:c.text,drawings:c.drawings.map(d=>d.drawing),number:0,dataIds:c.drawings.map(d=>d.id)})),s=p.sampleSize(p.shuffle(e),t);let i=a.latestDate;return s.map((c,d)=>{const m=_(i);return i=m,{...c,id:m,number:a.latestNumber+d+1}})},Ot=(t,a,n,o,e)=>{const[s]=G(y.ARTISTA,o),[i]=G(y.ARTE_RUIM,o),l=E(`arte-ruim-cards-${a}`,t),c=fe(t,a);return{entries:g.useMemo(()=>{if(!t||!l.isSuccess||!c.hasResponseData||!s)return{};const m=e.map(u=>u.cardId);return Nt(n,s,i,l.data,m,c.drawings)},[t,l.dataUpdatedAt,i,s,n,e,c.dataUpdatedAt,c.hasResponseData]),isLoading:l.isLoading||c.isLoading}},Nt=(t,a,n,o,e,s)=>{console.count("Creating Artista...");let i=a.latestDate;const l={};for(let c=0;c<t;c++){const d=_(i),m=Object.keys(o??{}).filter(x=>{var f,I;return!n.used.includes(x)&&!e.includes(x)&&((I=(f=s==null?void 0:s[x])==null?void 0:f.drawings)==null?void 0:I.length)<3}),u=p.sampleSize(m,20).map(x=>o[x]);i=d,l[d]={id:d,type:"artista",number:a.latestNumber+c+1,cards:u}}return l},Tt=(t,a,n,o)=>{const[e]=G(y.COMUNICACAO_ALIENIGENA,o),s=E("items",t),i=E("items-attributes",t),l=E("items-attribute-values",t);return{entries:g.useMemo(()=>!t||!e||!i.isSuccess||!l.isSuccess||!s.isSuccess?{}:Lt(n,e,i.data,l.data,s.data),[t,n,e,e,i.dataUpdatedAt,l.dataUpdatedAt,s.dataUpdatedAt]),isLoading:s.isLoading||i.isLoading||l.isLoading}},Lt=(t,a,n,o,e)=>{console.count("Creating Comunicacao Alienigena...");let s=a.latestDate;const i=p.values(n),l=p.values(o).filter(u=>{var x;return u.complete&&((x=e==null?void 0:e[u.id])==null?void 0:x.nsfw)!==!0}),c={};let d=0;for(;p.keys(c).length<t+5&&d<500;){const u=Mt(i,l);if(u.valid&&!c[u.setId]&&!a.used.includes(u.setId)&&(c[u.setId]=u),p.keys(c).length>=t)break;d+=1}console.log(`🔆 Generating this batch took ${d} tries`),d>=100&&W("comunicacao-alienigena","Not enough valid comunicacao alienigena games (over 100 attempts)");const m={};return Object.values(c).forEach((u,x)=>{const f=_(s);s=f;let I=p.shuffle(u.itemsIds);X(f)?I=p.shuffle([...I,...p.sampleSize(u.additionalItems,3)].filter(Boolean)):Ke(f)||(I=p.shuffle([...I,...p.sampleSize(u.additionalItems,1)].filter(Boolean))),m[f]={id:f,number:a.latestNumber+x+1,type:"comunicacao-alienigena",setId:u.setId,attributes:u.attributes,requests:u.requests,solution:u.solution,itemsIds:I}}),m},Mt=(t,a)=>{const n=p.shuffle(a),o=p.shuffle(Qe(50,0)),e=p.sampleSize(t,3).map(h=>({...h,spriteId:`${o.pop()}`})),s=[],i=[],l=[],c=[],d=[],m=[],u=[],x=[];n.forEach(h=>{const U=[P.DETERMINISTIC,P.RELATED],b=h.attributes[e[0].id]===P.DETERMINISTIC,N=U.includes(h.attributes[e[0].id]),T=h.attributes[e[0].id]===P.UNRELATED,Se=h.attributes[e[1].id]===P.DETERMINISTIC,ee=U.includes(h.attributes[e[1].id]),z=h.attributes[e[1].id]===P.UNRELATED,Ce=h.attributes[e[2].id]===P.DETERMINISTIC,te=U.includes(h.attributes[e[2].id]),K=h.attributes[e[2].id]===P.UNRELATED;if(T&&z&&K)return x.push(h.id);b&&z&&K&&s.push(h.id),T&&Se&&K&&i.push(h.id),T&&z&&Ce&&l.push(h.id),N&&ee&&K&&c.push(h.id),N&&z&&te&&d.push(h.id),T&&ee&&te&&m.push(h.id),N&&ee&&te&&u.push(h.id)});const f=e.map(h=>({id:h.id,name:h.name.pt,description:h.description.pt,spriteId:h.spriteId,itemsIds:[]}));f[0].itemsIds=p.sampleSize(s,s.length>3?3:Math.max(s.length-1,1)),f[1].itemsIds=p.sampleSize(i,i.length>3?3:Math.max(s.length-1,1)),f[2].itemsIds=p.sampleSize(l,l.length>3?3:Math.max(s.length-1,1));const I=[];f.forEach(h=>{I.push(...h.itemsIds)});const C=[];c.length>0&&C.push({spritesIds:[e[0].spriteId,e[1].spriteId],itemId:p.sample(c)??""}),d.length>0&&C.push({spritesIds:[e[0].spriteId,e[2].spriteId],itemId:p.sample(d)??""}),m.length>0&&C.push({spritesIds:[e[1].spriteId,e[2].spriteId],itemId:p.sample(m)??""}),u.length>0&&C.push({spritesIds:e.map(h=>h.spriteId),itemId:p.sample(u)??""});const S=[];s.length>0&&S.push({spritesIds:[e[0].spriteId],itemId:s.filter(h=>!I.includes(h))[0]}),i.length>0&&S.push({spritesIds:[e[1].spriteId],itemId:i.filter(h=>!I.includes(h))[0]}),l.length>0&&S.push({spritesIds:[e[2].spriteId],itemId:l.filter(h=>!I.includes(h))[0]});let v=p.sampleSize(C,4);v.length<3&&v.push(...p.sampleSize(S,4-v.length)),v.length<4&&console.log("🔆 Not enough requests for an alien communication, marking it as invalid"),v=p.shuffle(v);const O=v.map(h=>h.itemId),j={setId:f.map(h=>h.id).sort().join("-"),attributes:f,requests:v,solution:O.join("-"),itemsIds:O,additionalItems:x.filter(Boolean),valid:!1};return j.valid=[j.attributes.length===3,j.requests.length===4,j.itemsIds.length===4,j.attributes.every(h=>h.itemsIds.length>0),j.requests.every(h=>h.itemId)].every(Boolean),j},Rt=(t,a,n,o)=>{const[e]=G(y.CONTROLE_DE_ESTOQUE,o);return{entries:g.useMemo(()=>!t||!e?{}:kt(n,e),[t,n,e]),isLoading:!1}},kt=(t,a)=>{console.count("Creating Controle de Estoque...");let n=a.latestDate;const o={};for(let e=0;e<t;e++){const s=_(n);n=s,o[s]=Qt(s,a.latestNumber+e+1)}return o},Gt=256,Ut=16,Yt=4,_t=1,Qt=(t,a)=>{const[n,o,e]=t.split("-").map(Number),i=new Date(n,o-1,e).getDay(),l=["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"][i],c={id:t,number:a,type:"controle-de-estoque",language:"pt",title:l,goods:[],orders:[]},d=p.sampleSize(Array(Gt).fill("").map((u,x)=>`good-${x+1}`),Ut+_t),m=d.pop();if(c.goods=d,c.orders=p.sampleSize(c.goods,Yt),!m)throw new Error("No out of stock good");return c.orders.push(m),c.orders=p.shuffle(c.orders),c},Pt=(t,a,n,o)=>{const[e]=G(y.FILMACO,o),s=E("daily-movie-sets",t);return{entries:g.useMemo(()=>!t||!s.isSuccess||!e?{}:(Object.values(s.data).filter(c=>c.itemsIds.length>0&&!e.used.includes(c.id)).length<=n&&W("filmaco","Not enough unused films"),qt(n,e,s.data)),[t,s.dataUpdatedAt,e,n]),isLoading:s.isLoading}},qt=(t,a,n)=>{console.count("Creating Filmaço...");const o=p.shuffle(Object.values(n).filter(c=>c.itemsIds.filter(Boolean).length>0)),e=p.shuffle(o.filter(c=>!a.used.includes(c.id)));e.length<t&&e.push(...p.shuffle(o));const s=p.shuffle(Object.values(n).filter(c=>c.itemsIds.length>0&&a.used.includes(c.id)));let i=a.latestDate;const l={};for(let c=0;c<t;c++){const d=_(i),m=X(d),u=m?Vt(s):e[c];if(!u){W("filmaco","No filmaço sets left");break}i=d,l[d]={id:d,type:"filmaco",number:a.latestNumber+c+1,setId:u.id,title:u.title,itemsIds:u.itemsIds,year:u.year},m&&(l[d].isDoubleFeature=!0)}return l},Vt=t=>{var o;let a=[];for(;a.length<2&&t.length>0;){const e=t.pop();e&&p.intersection(e.itemsIds,((o=a==null?void 0:a[0])==null?void 0:o.itemsIds)||[]).length===0&&a.push(e)}return a=p.orderBy(a,e=>e.year,"asc"),{id:`df-${a.map(e=>e.id).join("-")}`,title:`${a.map(e=>e.title).join(" × ")}`,itemsIds:p.shuffle(ge(a.flatMap(e=>e.itemsIds))),year:a.map(e=>e.year).join(" × ")}},Ft=(t,a,n,o)=>{const[e]=G(y.ORGANIKU,o),s=E("items-groups",t);return{entries:g.useMemo(()=>!t||s.isLoading||!e?{}:$t(n,e,a,s.data),[t,a,e,n,s.dataUpdatedAt]),isLoading:s.isLoading}},$t=(t,a,n,o)=>{console.count("Creating Organiku...");const e=p.shuffle(Object.values(o).filter(l=>l.itemsIds.length>5&&a.used.includes(l.id)===!1));e.length<t&&W("organiku","Not enough organiku groups left");let s=a.latestDate;const i={};for(let l=0;l<t;l++){const c=_(s);s=c;const d=e[l],m=p.sampleSize(d.itemsIds,5),u=Bt(m),x=Ht(u,m,1);i[c]={id:c,number:a.latestNumber+l+1,setId:d.id,type:"organiku",title:p.capitalize(d.name[n]),grid:u,defaultRevealedIndexes:x,itemsIds:m}}return i};function Ht(t,a,n){const o=new Set,e={};t.forEach((s,i)=>{e[s]||(e[s]=[]),e[s].push(i)});for(const s of a){const i=e[s]??[],c=i.length%2===0?2:1,d=p.shuffle(i);for(let m=0;m<c&&m<d.length;m++)o.add(d[m])}for(let s=0;s<n;s++){const i=a[s%a.length],l=(e[i]??[]).filter(d=>!o.has(d)),c=p.shuffle(l);for(let d=0;d<2&&d<c.length;d++)o.add(c[d])}return Array.from(o)}function Bt(t){const a=t.length,n=[];n.push(p.shuffle(t));function o(s,i){for(let l=0;l<a;l++)for(let c=0;c<i;c++)if(n[c][l]===s[l])return!1;return!0}function e(s){if(s===a)return!0;const i=be(t);for(;i.length>0;){const l=i.splice(Math.floor(Math.random()*i.length),1)[0];if(o(l,s)){if(n.push(l),e(s+1))return!0;n.pop()}}return!1}return e(1),n.flat()}function be(t){if(t.length<=1)return[t.slice()];const a=[];for(let n=0;n<t.length;n++){const o=[...t.slice(0,n),...t.slice(n+1)];for(const e of be(o))a.push([t[n],...e])}return a}const Wt=(t,a,n,o)=>{const[e]=G(y.PALAVREADO,o),s=oe(4,a,t),i=oe(5,a,t);return{entries:g.useMemo(()=>!t||!s.data||!s.data.length||!i.data||!i.data.length||!e?{}:zt(n,e,s.data,i.data),[t,s.dataUpdatedAt,i.dataUpdatedAt,e,n]),isLoading:s.isLoading||i.isLoading}},zt=(t,a,n,o)=>{console.count("Creating Palavreado...");let e=a.latestDate;const s=[],i={};for(let l=0;l<t;l++){const c=_(e),d=X(c),m=d?5:4;e=c,i[c]={id:c,type:"palavreado",number:a.latestNumber+l+1,...Kt(d?o:n,[...Object.values(i).map(u=>u.keyword),...a.used],s,m)}}return i},Kt=(t,a,n,o=4,e)=>{let s=p.shuffle(p.difference(t,n,a));const i=e||(s.pop()??""),l=[];for(let c=0;c<o;c++){const d=Jt(t,i,l,c);l.push(d)}return n.push(i,...l),{keyword:i,words:l,letters:Zt(l,i.length)}},Jt=(t,a,n,o)=>{const e=p.uniq([...p.flatMap(n.map(l=>l.split(""))),...a.split("")]),s=p.shuffle(t.filter(l=>l[o]===a[o]&&!n.includes(l)));return p.sortBy(s,l=>p.intersection(l.split(""),e).length)[0]},Zt=(t,a)=>{const n=p.flatMap(t.map(i=>i.split(""))),o=a===4?[0,5,10,15]:[0,6,12,18,24],e=p.shuffle(n.filter((i,l)=>!o.includes(l))),s=[];for(let i=0;i<n.length;i++)o.includes(i)?s.push(n[i]):s.push(e.shift()??"");return s},Xt=(t,a,n,o)=>{const[e]=G(y.PORTAIS_MAGICOS,o),s=E("daily-passcode-sets",t),i=oe(3,a,t);return{entries:g.useMemo(()=>{if(!t||!s.isSuccess||!i.isSuccess||!e)return{};const c=i.data.reduce((d,m)=>(m.split("").forEach(u=>{d[u]||(d[u]=[]),d[u].push(m)}),d),{" ":["  "],"-":[" - "]});return es(n,e,s.data,c)},[t,n,s.dataUpdatedAt,i.isSuccess,i.dataUpdatedAt,e]),isLoading:s.isLoading||i.isLoading}},es=(t,a,n,o)=>{console.count("Creating Portais Mágicos...");let e=a.latestDate;const s=a.used,i={};let l=p.shuffle(Object.values(n).filter(d=>d.imageCardsIds.length>0));const c={};for(let d=0;d<t;d++){const m=_(e),u=[];let x=[...l];const f=[];for(;f.length<3;){const I=x.pop();if(!I)throw new Error("Not enough sets available");const C=p.sample(I.passcode.filter(j=>j.length<=12&&!s.includes(j)))||"";if(!C)continue;const S=f.length+1;u.push(I.id),i[I.id]=!0;const v=C.split("").map(j=>p.sample(o[j])||` ${j} `),O=p.sampleSize(I.imageCardsIds,S);f.push({passcode:C,imagesIds:O,words:v}),x=x.filter(j=>!i[j.id]&&j.imageCardsIds.length>S)}e=m,c[m]={id:m,type:"portais-magicos",setId:u.join(Z),number:a.latestNumber+d+1,corridors:f.reverse()},l=l.filter(I=>!i[I.id])}return c},ts=(t,a,n,o)=>{const[e]=G(y.QUARTETOS,o),s=E("daily-quartet-sets",t),i=E("items-groups",t);return{entries:g.useMemo(()=>!t||s.isLoading||i.isLoading||!e?{}:ss(n,e,a,s.data,i.data),[t,a,e,n,s.dataUpdatedAt,i.dataUpdatedAt]),isLoading:s.isLoading||i.isLoading}},ss=(t,a,n,o,e)=>{console.count("Creating Quartetos...");let s=Object.values(o).filter(c=>c.itemsIds.length>=4&&!a.used.includes(c.id)&&!c.flagged),i=a.latestDate;const l={};return Array.from({length:t}).forEach((c,d)=>{const m=[],u={};let x=p.cloneDeep(s),f=0;for(;m.length<3&&f<500;){const b=p.sample(x);if(!b)throw Error("No potential set found for Quartetos game");x=x.filter(T=>T.id!==b.id);const N=p.orderBy(p.sampleSize(b.itemsIds,4),T=>Number(T));if(N.some(T=>u[T])){f++;continue}b.itemsIds.forEach(T=>{u[T]=!0}),m.push({id:b.id,title:b.title,itemsIds:N,level:b.level??1}),f=0}const I=m.map(b=>b.id);s=s.filter(b=>!I.includes(b.id));const C=Object.values(e).filter(b=>b.itemsIds.some(N=>!u[N])&&b.itemsIds.length>=4&&b.nsfw!==!0),S=p.sample(C);if(!S)throw Error("No eligible group found for Quartetos game");m.push({id:S.id,title:p.capitalize(S.name[n]),itemsIds:p.sampleSize(S.itemsIds,4),level:1});const v=Math.ceil(m.reduce((b,N)=>b+N.level,0)/m.length),O=p.orderBy(m,["level"],["desc"]).map((b,N)=>(b.level=N,b)),j=m.map(b=>b.id).join(Z),h=p.shuffle(m.flatMap(b=>b.itemsIds)),U=_(i);i=U,l[U]={id:U,number:a.latestNumber+d+1,setId:j,type:"quartetos",grid:h,difficulty:v,sets:O}}),l},ns=(t,a,n,o)=>{const[e]=G(y.TA_NA_CARA,o),s=E("suspects",t),i=E(`testimony-questions-${a}`,t),l=E("testimony-answers",t);return{entries:g.useMemo(()=>{if(!t||!s.isSuccess||!i.isSuccess||!e||!l.isSuccess)return{};const d=cs(i.data,l.data,s.data),m=Object.keys(s.data).map(u=>ye(u,"gb"));return as(n,e,m,i.data,d)},[t,s.dataUpdatedAt,i.dataUpdatedAt,l.dataUpdatedAt,e,n]),isLoading:s.isLoading||i.isLoading}},rs=15,Ae=7,as=(t,a,n,o,e)=>{console.count("Creating Tá Na Cara...");let s=0,i=a.latestDate;const l={};for(let c=0;c<t;c++){const d=_(i);i=d;const m=[];for(let f=0;f<rs;f++){s>=e.length&&(s=0);const I=e[s];m.push(is(I,o[I.testimonyId])),s+=1}const u=Pe(m.flatMap(f=>f.suspectsIds||[])),x=p.shuffle(n.filter(f=>!u[f])).slice(0,Ae);l[d]={id:d,type:"ta-na-cara",number:a.latestNumber+c+1,suspectsIds:x,testimonies:m}}return l},is=(t,a)=>{const n=[...p.shuffle(t.counts[3]),...p.shuffle(t.counts[2]),...t.counts[1],...t.counts[0],...t.counts[5]].slice(0,Ae).map(o=>ye(o,"gb"));return{testimonyId:a.id,question:a.question,nsfw:!!a.nsfw,suspectsIds:n}},os=t=>t.reduce((a,n)=>{const o=n.split(Z),e=o[0],s=Number(o[1]);if(e.startsWith("us")){const i=e.split("-"),l=`${i[0]}-${i[2]}`;return l.includes("undefined")||(a[l]=s||0),a}return a[e]=s||0,a},{}),ls=(t,a)=>{const n=os(t);return a.forEach(o=>{var e;o.testimonies.forEach(s=>{n[s.testimonyId]===void 0&&(n[s.testimonyId]=0),n[s.testimonyId]+=1}),(e=o.suspectsIds)==null||e.forEach(s=>{const i=s.split("-"),l=`${i[0]}-${i[2]}`;n[l]===void 0&&(n[l]=0),n[l]+=1})}),Object.entries(n).map(([o,e])=>`${o}${Z}${e}`)},cs=(t,a,n)=>{const o={};return Object.keys(t).forEach(s=>{o[s]===void 0&&(o[s]={0:[],1:[],2:[],3:[],4:[],5:[]});const i=a[s]||{};Object.keys(n).forEach(l=>{const c=i[l]||[],d=ke(c);d>=5?o[s][5].push(l):o[s][d].push(l)})}),p.orderBy(Object.keys(o).map(s=>({testimonyId:s,counts:o[s]})),[s=>s.counts[3].length,s=>s.counts[2].length,s=>s.counts[1].length,s=>s.counts[0].length],["desc"])};function ds(t,a,n){const o=je.DAILY[a??"pt"],e=ve(o,{enabled:t});g.useEffect(()=>{bt()},[n,a]);const s=t&&e.isSuccess,i=St(s,a,n,e.data??{}),l=Et(s,a,n,e.data??{}),c=Tt(s,a,n,e.data??{}),d=Rt(s,a,n,e.data??{}),m=Pt(s,a,n,e.data??{}),u=Wt(s,a,n,e.data??{}),x=ts(s,a,n,e.data??{}),f=et(s,a,n,e.data??{}),I=Xt(s,a,n,e.data??{}),C=Ft(s,a,n,e.data??{}),S=Ot(s,a,n,e.data??{},l.entries),v=ns(s,a,n,e.data??{}),O=g.useMemo(()=>l.entries.length===0?[]:(console.count("Bundling entries..."),l.entries.map(j=>({id:j.id,"arte-ruim":j,"aqui-o":i.entries[j.id],"comunicacao-alienigena":c.entries[j.id],"controle-de-estoque":d.entries[j.id],filmaco:m.entries[j.id],organiku:C.entries[j.id],palavreado:u.entries[j.id],"portais-magicos":I.entries[j.id],quartetos:x.entries[j.id],"teoria-de-conjuntos":f.entries[j.id],artista:S.entries[j.id],"ta-na-cara":v.entries[j.id]}))),[l.entries,i.entries,c.entries,d.entries,m.entries,C.entries,u.entries,I.entries,x.entries,f.entries,S.entries,v.entries]);return{isLoading:e.isLoading||i.isLoading||l.isLoading||c.isLoading||d.isLoading||m.isLoading||u.isLoading||I.isLoading||x.isLoading||f.isLoading||S.isLoading||v.isLoading,entries:O}}function us(t){const{notification:a}=Le.useApp(),n=Me(),o=je.DAILY[t??"pt"],[e,s]=g.useState(!1),i=ve(o,{enabled:!!o}),l=he({mutationFn:async c=>{const d=c.map(f=>{const I=re(ae,`${o}/${f.id}`);return ce(I,f)}),m=re(ae,`${o}/history`),u=i.data;if(!u)throw new Error("No previous history");const x={...u,[y.AQUI_O]:k(y.AQUI_O,u,c,f=>f.setId),[y.ARTE_RUIM]:k(y.ARTE_RUIM,u,c,f=>f.cardId),[y.ARTISTA]:k(y.ARTISTA,u,c,null),[y.COMUNICACAO_ALIENIGENA]:k(y.COMUNICACAO_ALIENIGENA,u,c,f=>f.setId),[y.CONTROLE_DE_ESTOQUE]:k(y.CONTROLE_DE_ESTOQUE,u,c,null),[y.FILMACO]:k(y.FILMACO,u,c,f=>f.setId),[y.PALAVREADO]:k(y.PALAVREADO,u,c,f=>f.keyword),[y.PORTAIS_MAGICOS]:k(y.PORTAIS_MAGICOS,u,c,f=>f.corridors.map(I=>I.passcode)),[y.TA_NA_CARA]:k(y.TA_NA_CARA,u,c,null,ls),[y.QUARTETOS]:k(y.QUARTETOS,u,c,f=>f.sets.map(I=>I.id)),[y.TEORIA_DE_CONJUNTOS]:k(y.TEORIA_DE_CONJUNTOS,u,c,f=>[f.intersectingThing.id,f.setId]),[y.ORGANIKU]:k(y.ORGANIKU,u,c,f=>f.setId)};return ce(m,x),Promise.all(d)},onSuccess:()=>{a.info({message:"Data saved",placement:"bottomLeft"}),n.invalidateQueries({queryKey:[o,"history"]}),s(!1)},onError:()=>{a.error({message:"Error saving data",placement:"bottomLeft"})}});return{isDirty:e,setIsDirty:s,save:l.mutateAsync,isPending:l.isPending}}const k=(t,a,n,o,e)=>{var i;const s=JSON.parse(((i=a[t])==null?void 0:i.used)??"[]");return e?{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][t].number,used:JSON.stringify(e(s,n.map(l=>l[t])))}:o===null?{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][t].number,used:"[]"}:{latestDate:n[n.length-1].id,latestNumber:n[n.length-1][t].number,used:JSON.stringify(ge([...s,...n.map(l=>l[t]).map(o)]).flat())}},ms="pt";function ps(){const[t,a]=g.useState(""),[n,o]=g.useState(3),[e,s]=g.useState(7),[i,l]=g.useState(Date.now());return r.jsxs("div",{children:[r.jsx(F.Title,{level:2,children:"Data Population"}),r.jsxs(D,{gap:12,children:[r.jsx(se,{label:"Language",value:t,onChange:a,options:[ms],placeholder:"Select a language"}),r.jsx(se,{label:"Minimum Drawings",value:n,onChange:o,options:[2,3,4],placeholder:"Select a number"}),r.jsx(se,{label:"Batch Size",value:e,onChange:s,options:[3,7,14,21,28],placeholder:"Select a number"}),r.jsx(V,{onClick:()=>{l(Date.now())},icon:r.jsx(ut,{})}),r.jsx(xe,{path:"diario/history",className:"ml-2"})]}),r.jsx(fs,{language:t,batchSize:e},i)]})}function fs({language:t,batchSize:a}){const n=t,o=ds(!!n,n,a),e=At();g.useEffect(()=>{p.isEmpty(e)||console.log(e)},[e]);const{save:s,isPending:i}=us(n??"pt");return r.jsxs(Xe,{isLoading:o.isLoading,error:null,hasResponseData:!o.isLoading,children:[r.jsxs(D,{justify:"space-between",align:"center",children:[r.jsxs(F.Title,{level:4,children:["Total: ",o.entries.length]}),r.jsx(V,{onClick:()=>s(o.entries),loading:i,disabled:(o.entries??[]).length===0,type:"primary",size:"large",icon:r.jsx(tt,{}),children:"Save"})]}),Object.values(e).map(l=>r.jsx(w,{message:l,type:"warning",showIcon:!0,banner:!0},l)),r.jsx(Ie,{columns:De,dataSource:o.entries??[],scroll:{x:"max-content"}})]})}function hs(){const{queryParams:t}=me();return t.get("display")==="archive"?r.jsx(jt,{}):t.get("display")==="check"?r.jsx(vt,{}):r.jsx(ps,{})}function gs(){const{queryParams:t,addParams:a}=me();return r.jsx(r.Fragment,{children:r.jsx(st,{children:r.jsx(Ve,{label:"Display",value:t.get("display")??"population",onChange:n=>a({display:n}),options:[{title:"Population",icon:r.jsx(pt,{}),value:"population"},{title:"Check",icon:r.jsx(ct,{}),value:"check"},{title:"Archive",icon:r.jsx(ht,{}),value:"archive"}]})})})}function cn(){return r.jsx(Re,{title:"Daily Setup",children:r.jsxs(de,{hasSider:!0,children:[r.jsx(We,{children:r.jsx(gs,{})}),r.jsx(de.Content,{className:"content",children:r.jsx(hs,{})})]})})}export{cn as default};
