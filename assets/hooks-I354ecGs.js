import{u as K,l as x}from"./useBaseUrl-BXKykm9Q.js";import{r as t,u as P,i as Q,e as F,s as j,f as U,bY as L}from"./index-DTFVBFfK.js";import{u as _}from"./useMutation-BedPW6bx.js";import{u as M}from"./useQueryParams-CSQSAZkt.js";import{r as B}from"./index-5_NcC2_B.js";const T=12,G=252,y=()=>x.padStart(String(x.random(1,G)),2,"0"),b=()=>x.random(1,T),Y=()=>`td-d${b()}-${y()}`;function X(c,A){const[S,g]=t.useState(b()),[i,k]=t.useState(y()),[D,n]=t.useState(b()),[h,a]=t.useState(y()),r=`td-d${S}-${i}`,o=`td-d${D}-${h}`,[R,u]=t.useState(0),{queryParams:d}=M(),E=Number(d.get("cycle")??3),l=c?.[r]??[],f=c?.[o]??[],N=()=>{u(0),g(b()),k(y()),n(b()),a(y())},m=()=>{u(0),l.push(o),c[r]=B(l),f.push(r),c[o]=B(f),A(!0),g(D),k(h),n(b()),a(y())},I=()=>{R>=E?(u(0),N()):(u(q=>q+1),n(b()),a(y()))};return t.useEffect(()=>{r===o&&a(y())},[r,o]),{cardAId:r,cardA:l,cardBId:o,cardB:f,relate:m,unrelate:I,areRelated:l.includes(o),onRandomCards:N}}function Z(){const[c,A]=t.useState(!1),S=["data/imageCardsRelationships"],g=P(),{notification:i}=Q.useApp(),[k,D]=t.useState({total:0,overdone:0,complete:0,single:0}),{data:n={},isLoading:h,isSuccess:a,isError:r,error:o,isFetched:R,isRefetching:u,refetch:d}=K({queryKey:S,queryFn:async()=>{const m=F(U,"data/imageCardsRelationships");return(await L(m)).data()??{}}}),{isPending:E,isError:l,isSuccess:f,mutate:N}=_({mutationKey:S,mutationFn:async()=>{const m=F(U,"data/imageCardsRelationships");return await j(m,n),n},onSuccess:()=>{i.success({title:"Saved",placement:"bottomLeft"}),g.refetchQueries({queryKey:S}),A(!1)}});return t.useEffect(()=>{if(!u&&R){const m=Object.keys(n).length;let I=0,q=0,e=0;Object.values(n).forEach(s=>{s.length>8&&(I+=1),s.length===1&&(e+=1),s.length>2&&(q+=1)}),D({total:m,overdone:I,complete:q,single:e})}},[R,u]),{data:n,isLoading:h,isSuccess:a,isError:r,error:o,hasData:a&&Object.keys(n).length>0,refetch:d,isSaving:E,isMutationError:l,isSaved:f,save:N,setDirty:A,isDirty:c,stats:k}}function ee(c,A,S,g){const[i,k]=t.useState([]),[D,n]=t.useState([]),[h,a]=t.useState([]),[r,o]=t.useState(0),[R,u]=t.useState(!0),[d,E]=t.useState([]),l=e=>{n((e??i).map(s=>c?.[s]??[]))},f=()=>{const e=[...d];let s=0;const p=h.length<2e3?h:[];let v=0;for(;v<400&&e.length<S;){const C=Y(),$=c[C]??[],O=g>0?$.length<g:!0,w=R?p.includes(C):!1;!e.includes(C)&&!w&&O&&(e.push(C),s+=1),v+=1}k(e),a(C=>[...C,...e]),l(e),o(C=>C+s)};return t.useEffect(()=>{i.length===0&&f()},[i]),{cardIds:i,cards:D,selection:d,onSelect:e=>{E(s=>{const p=[...s],v=p.indexOf(e);return v>-1?p.splice(v,1):p.push(e),p})},relate:()=>{d.forEach(e=>{const s=c[e]??[];s.push(...d.filter(p=>p!==e)),c[e]=B(s)}),A(!0),E([]),l(),a([]),o(0)},nextSet:f,deselectAll:()=>{E([])},cycles:r,filters:{useCycles:R,toggleUseCycles:()=>{u(e=>!e)}}}}export{Z as a,ee as b,X as u};
