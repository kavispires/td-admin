import{j as e,F as O,D as A,T as g,r as j,c as v,M as me,b as M,B as R,m as L,S,n as U,i as he,o as pe,P as xe,L as ee}from"./index-DTFVBFfK.js";import{D as ae}from"./DataLoadingWrapper-AfAD5Or6.js";import{F as fe}from"./FilterEntries-DnRExwmR.js";import{S as je}from"./SiderContent-DMHsDpiE.js";import{D as ge}from"./DownloadButton-B5N81On_.js";import{a as ye}from"./FirestoreConsoleLink-DQ3J25sf.js";import{S as be}from"./SaveButton-aj_MRLuF.js";import{u as G}from"./useQueryParams-CSQSAZkt.js";import{u as _}from"./useTDResource-CtzTqqUd.js";import{l as V,P as ve}from"./useBaseUrl-BXKykm9Q.js";import{a as Te,w as $}from"./index-5_NcC2_B.js";import{v as C,s as P,a as E,b as le,S as ne,c as te}from"./daily-teoria-de-conjuntos-Cm8Ze6Qb.js";import{R as Se}from"./ClusterOutlined-CAnE1zvN.js";import{R as Ie}from"./TableOutlined-BpKsmObb.js";import{R as we}from"./RobotOutlined-DrwKRpP9.js";import{I as ie}from"./Item-C5hJ6z_V.js";import{R as F}from"./index-CqcX2UdF.js";import{T as I}from"./index-CsIkBZYQ.js";import{A as ke}from"./index-D3m_3fu_.js";import{S as B}from"./index-D1CfkU0f.js";import{T as N}from"./TransparentButton-DkSRW2ZK.js";import{R as re}from"./index-DFXT9W8t.js";import{C as Ae}from"./Collapse-DCLeuUIJ.js";import{u as de}from"./useTablePagination-DAt6aSDN.js";import{F as oe}from"./Table-BAIh0dVT.js";import{u as Ce}from"./useResourceFirestoreData-4EapG7Wd.js";import"./index-Bnlp8zWQ.js";import"./index-DXm6RdKT.js";import"./PlusOutlined-Dg4BBZsT.js";import"./index-Ph3MC-q4.js";import"./index-U31pN1fu.js";import"./Dropdown-Cp-10CYh.js";import"./useMutation-BedPW6bx.js";import"./index-BEQxMZx0.js";import"./moment-B-YVwB4U.js";import"./SaveOutlined-aR-FBBRB.js";import"./constants-CuiKou0X.js";import"./useParsedHistory-Dsi0oIDT.js";import"./warnings-C0iEM2DA.js";import"./throttleByAnimationFrame-CrXO4eCR.js";import"./scrollTo-CsjTXzNU.js";import"./Pagination-C72zuBhS.js";import"./useGetFirestoreDoc-pvlqtSeW.js";import"./useUpdateFirestoreDoc-DNoK3eu1.js";function Oe({data:t,save:o,isDirty:h,isSaving:n,entriesToUpdate:s,hasFirestoreData:x}){const{addParams:f,queryParams:i}=G(),p=_("daily-diagram-rules");return e.jsxs(je,{children:[e.jsxs(O,{gap:12,vertical:!0,children:[e.jsx(be,{dirt:JSON.stringify(s),isDirty:h,isSaving:n,onSave:o}),e.jsx(ge,{block:!0,data:()=>Fe(t,p.data??{}),disabled:h,fileName:"daily-diagram-items.json",hasNewData:x})]}),e.jsx(A,{}),e.jsx(fe,{label:"Display",onChange:u=>f({display:u,page:1},{page:1}),options:[{title:"By Rule",icon:e.jsx(Se,{}),value:"rule"},{title:"By Thing",icon:e.jsx(Ie,{}),value:"thing"},{title:"Simulator",icon:e.jsx(we,{}),value:"simulator"}],value:i.get("display")??"rule"}),e.jsx(A,{}),e.jsx(g.Paragraph,{className:"my-6",type:"secondary",children:"v2.1.0"}),e.jsx(ye,{disabled:h,docId:"diagramItems",path:"tdr",queryKey:["tdr","diagramItems"]})]})}function Fe(t,o){console.log("Preparing file for download...");const h=V.cloneDeep(t),n=Date.now();return Object.values(h).forEach(s=>{const x=Object.values(o).filter(u=>u.updatedAt>s.updatedAt),f=x.map(()=>!1),i=x.filter(u=>u.method==="auto");i.length>0&&(console.log(`Performing ${i.length} auto updates for ${s.name}`),s.rules=s.rules.filter(u=>!i.map(y=>y.id).includes(u)),i.forEach(u=>{C[u.id](s.name)&&s.rules.push(u.id);const r=x.findIndex(a=>a.id===u.id);r!==-1&&(f[r]=!0)}));const p=x.filter(u=>u.method==="dependency");if(p.length>0){console.log(`Performing ${p.length} dependency updates for ${s.name}`),s.rules=s.rules.filter(a=>!p.map(d=>d.id).includes(a));const u=s.rules.includes("ddr-51-pt"),y=s.syllables??"",r=s.stressedSyllable;p.forEach(a=>{if(P[a.id]&&y){P[a.id](s.name,y,u)&&s.rules.push(a.id);const l=x.findIndex(m=>m.id===a.id);l!==-1&&(f[l]=!0)}if(E[a.id]&&y&&r!==void 0){E[a.id](s.name,y,r)&&s.rules.push(a.id);const l=x.findIndex(m=>m.id===a.id);l!==-1&&(f[l]=!0)}})}f.every(Boolean)&&(console.log(`All auto and dependency rules updated for ${s.name}`),s.updatedAt=n)}),Te(h)}function q({isModalOpen:t,onSaveThing:o,onCancel:h,thing:n,rules:s,width:x,itemAliases:f,subtitle:i,okButtonText:p,onGiveAnotherThing:u,allThings:y}){const r=j.useMemo(()=>V.orderBy(Object.values(s),[c=>{const b=["manual","dependency","auto"].indexOf(c.method);return b===-1?Number.POSITIVE_INFINITY:b},c=>{const b=["grammar","comparison","order","count","contains","ends"].indexOf(c.type);return b===-1?Number.POSITIVE_INFINITY:b},c=>c.title.slice(0,7),c=>Number(c.id.split("-")[1])]),[s]),[a]=v.useForm(),d=v.useWatch([],a),l=!d||Object.values(d??{}).some(c=>c===void 0),m=v.useWatch("name",a);j.useEffect(()=>{if(!m||n.name&&n.syllables&&m===n.name)return;const c={syllables:le(m),stressedSyllable:n.stressedSyllable??m.includes(" ")?-1:0};Object.keys(s).forEach(b=>{C[b]?c[b]=C[b](m):c[b]=n.rules.length>0?n.rules.includes(b):void 0}),a.setFieldsValue(c)},[m]);const T=v.useWatch("syllables",a),k=a.getFieldValue("ddr-51-pt");j.useEffect(()=>{k&&(a.setFieldsValue({stressedSyllable:void 0}),a.setFieldsValue({"ddr-43-pt":!1}),a.setFieldsValue({"ddr-44-pt":!1}),a.setFieldsValue({"ddr-45-pt":!1}),a.setFieldsValue({"ddr-46-pt":!1})),k===void 0&&a.setFieldsValue({"ddr-51-pt":!1})},[k]),j.useEffect(()=>{if(T){const c=Object.keys(s).reduce((b,w)=>(P[w]&&(b[w]=P[w](m,T,k)),b),{});a.setFieldsValue({...c,stressedSyllable:T===n.syllables?n.stressedSyllable:n.stressedSyllable??m.includes(" ")?-1:void 0})}},[m,T,k]);const z=v.useWatch("stressedSyllable",a);j.useEffect(()=>{if(!k&&z!==void 0){const c=Object.keys(s).reduce((b,w)=>(E[w]&&(b[w]=E[w](m,T,z)),b),{});a.setFieldsValue({...c})}},[z]);const J=a.getFieldValue("ddr-1-pt"),Q=a.getFieldValue("ddr-2-pt"),H=a.getFieldValue("ddr-50-pt");j.useEffect(()=>{J===!0&&(a.setFieldsValue({"ddr-2-pt":!1}),a.setFieldsValue({"ddr-50-pt":!1}))},[J]),j.useEffect(()=>{Q===!0&&(a.setFieldsValue({"ddr-1-pt":!1}),a.setFieldsValue({"ddr-50-pt":!1}))},[Q]),j.useEffect(()=>{H===!0&&(a.setFieldsValue({"ddr-1-pt":!1}),a.setFieldsValue({"ddr-2-pt":!1}))},[H]);const K=a.getFieldValue("ddr-3-pt");j.useEffect(()=>{K===!0&&a.setFieldsValue({"ddr-4-pt":!1})},[K]);const Y=a.getFieldValue("ddr-4-pt");j.useEffect(()=>{Y===!0&&a.setFieldsValue({"ddr-3-pt":!1})},[Y]),j.useEffect(()=>{m?.includes("-")&&a.setFieldsValue({"ddr-5-pt":!0})},[m]);const ue=c=>{const b=De(c);o(b)},X=j.useMemo(()=>(T??"").split(ne),[T]),Z=j.useMemo(()=>Object.values(y).filter(c=>c.name===n.name&&c.itemId!==n.itemId),[n,y]);return e.jsx(me,{maskClosable:!1,okButtonProps:{disabled:l,htmlType:"submit",size:"large"},okText:p??"Add Item",onCancel:h,onOk:a.submit,open:t,title:e.jsxs(e.Fragment,{children:["Edit ",n.name," ",i&&e.jsx("small",{children:i})]}),width:x,children:e.jsxs(v,{autoComplete:"off",form:a,initialValues:Ne(n,s),labelWrap:!0,layout:"vertical",name:`new-item-${n.itemId}`,onFinish:ue,size:"small",children:[e.jsxs("div",{className:"diagram-container",children:[e.jsxs("div",{children:[e.jsxs(O,{gap:6,children:[e.jsx(ie,{itemId:n.itemId,width:50}),e.jsx(v.Item,{label:"Id",name:"itemId",children:e.jsx(M,{readOnly:!0})})]}),e.jsx(v.Item,{label:"Updated At",name:"updatedAt",children:e.jsx(M,{readOnly:!0})})]}),e.jsx(v.Item,{label:"Name",name:"name",children:e.jsx(M,{})}),e.jsx(v.Item,{label:"Syllables",name:"syllables",children:e.jsx(M,{})}),e.jsx(v.Item,{label:"Stressed Syllable",name:"stressedSyllable",children:e.jsx(F.Group,{buttonStyle:"solid",optionType:"button",children:X.map((c,b)=>e.jsx(F,{value:X.length-b-1,children:c},b))})}),e.jsxs("div",{children:[f&&e.jsxs(e.Fragment,{children:[e.jsx(g.Text,{children:"Options:"})," ",e.jsx(g.Text,{type:"secondary",children:f?.join(", ")})]}),Z.length>0&&e.jsxs("div",{children:[e.jsx(g.Text,{type:"danger",children:"⚠️ Warning: There are other items with the same name:"}),e.jsx("div",{children:Z.map(c=>e.jsx(I,{children:c.itemId},c.itemId))})]})]}),(f||u)&&e.jsx("div",{children:u&&e.jsx(R,{className:"mt-2",onClick:u,size:"large",type:"dashed",children:"Give me another thing"})}),e.jsx("div",{children:e.jsx(ke,{offsetTop:50,children:e.jsx(O,{align:"center",justify:"center",children:e.jsx(R,{disabled:l,htmlType:"submit",size:"large",type:"primary",children:p??"Add Item"})})})})]}),e.jsx("div",{className:"diagram-container",children:r.map(c=>c.method==="auto"&&C[c.id]?e.jsx(v.Item,{className:L(n.updatedAt<c.updatedAt&&"diagram-container__outdated-rule"),label:c.title,name:c.id,valuePropName:"checked",children:e.jsx(B,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},c.id):c.method==="dependency"?e.jsx(v.Item,{className:L(n.updatedAt<c.updatedAt&&"diagram-container__outdated-rule"),label:c.title,name:c.id,valuePropName:"checked",children:e.jsx(B,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},c.id):e.jsx(v.Item,{className:L(n.updatedAt<c.updatedAt&&"diagram-container__outdated-rule"),label:c.title,name:c.id,children:e.jsxs(F.Group,{buttonStyle:"solid",optionType:"button",children:[e.jsx(F,{value:!0,children:"✅"}),e.jsx(F,{value:!1,children:"❌"})]})},c.id))})]})})}const Ne=(t,o)=>{let h=!1;return{name:t.name,itemId:t.itemId,syllables:t.syllables??le(t.name),stressedSyllable:t.stressedSyllable??0,...Object.keys(o).reduce((n,s)=>{if(t.updatedAt<o[s].updatedAt)if(C[s]){const x=C[s](t.name);x&&t.rules.includes(s)&&(h=!0),n[s]=x}else n[s]=void 0;else n[s]=t.rules.includes(s);return n},{}),updatedAt:h?Date.now():t.updatedAt}},De=t=>{const{itemId:o,name:h,syllables:n,stressedSyllable:s,...x}=t;return{itemId:o,name:h,updatedAt:Date.now(),syllables:n,stressedSyllable:s,rules:Object.keys(x).filter(f=>x[f]===!0)}};function D({itemId:t,name:o,width:h=50}){return e.jsxs(O,{align:"center",vertical:!0,children:[e.jsx(ie,{itemId:t,width:h}),e.jsx(g.Text,{code:!0,children:o},t)]})}function W({thing:t,width:o=50,onActivateThing:h}){return e.jsx(N,{onClick:()=>h(t),children:e.jsx(D,{itemId:t.itemId,name:t.name,width:o})})}function Re({game:t}){const[o]=j.useState([{id:t.rule1.thing.id,name:t.rule1.thing.name,rule:1}]),[h]=j.useState([{id:t.rule2.thing.id,name:t.rule2.thing.name,rule:2}]),[n]=j.useState([{id:t.intersectingThing.id,name:t.intersectingThing.name,rule:0}]),[s]=j.useState(t.things.slice(0,4)),[x,f]=j.useState(t.things[0]);return e.jsxs(S,{align:"center",orientation:"vertical",children:[e.jsx(g.Title,{level:4,children:"Game Sample"}),e.jsxs(g.Title,{level:5,children:['"',t.title,'"']}),e.jsx(re,{count:t.level,disabled:!0,value:t.level}),e.jsx(g.Paragraph,{style:{maxWidth:"500px"},children:"O círculo amarelo tem uma regra gramatical secreta e o circulo vermelho tem outra regra gramatical secreta. O quadrado do meio representa a interseção entre a regra amarela e a regra vermelha."}),e.jsx(S,{children:e.jsx(Ve,{intersectionChildren:e.jsx(N,{style:{width:"100%",height:"100%"},children:n.map((i,p,u)=>e.jsx(D,{itemId:i.id,name:i.name,width:p===u.length-1?80:60},i.id))}),leftCircleChildren:e.jsx(N,{style:{width:"100%",height:"100%"},children:o.map((i,p,u)=>e.jsx(D,{itemId:i.id,name:i.name,width:p===u.length-1?80:60},i.id))}),rightCircleChildren:e.jsx(N,{style:{width:"100%",height:"100%"},children:h.map((i,p,u)=>e.jsx(D,{itemId:i.id,name:i.name,width:p===u.length-1?80:60},i.id))}),width:600})}),e.jsx(g.Text,{children:"Coloque os objetos nos círculos corretos:"}),e.jsx(S,{className:"space--center",children:s.map(i=>e.jsx(N,{onClick:()=>f(i),style:i.id===x?.id?{outline:"3px solid hotPink"}:{},children:e.jsx(D,{itemId:i.id,name:i.name},i.id)},i.id))}),e.jsx(Ae,{items:[{key:"1",label:"Resposta",children:e.jsxs(S,{orientation:"vertical",children:[e.jsx(g.Text,{strong:!0,children:"Regra Amarela"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx(g.Text,{children:t.rule1.text})})}),e.jsx(g.Text,{strong:!0,children:"Regra Vermelha"}),e.jsx("ul",{children:e.jsx("li",{children:e.jsx(g.Text,{children:t.rule2.text})})})]})}]}),e.jsx("div",{style:{height:"200px"}})]})}function Ve({leftCircleChildren:t,rightCircleChildren:o,intersectionChildren:h,...n}){return e.jsxs("svg",{viewBox:"0 0 760 500",xmlns:"http://www.w3.org/2000/svg",...n,children:[e.jsx("path",{d:"M252.78 3.5c-136.42 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.59-247-247-247zm.99 483.07C123.39 486.57 17.7 380.88 17.7 250.5S123.39 14.43 253.77 14.43 489.84 120.12 489.84 250.5 384.15 486.57 253.77 486.57z",fill:"#fbb03b",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),e.jsx("path",{d:"M508.22 3.5c-136.41 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.58-247-247-247zm.99 483.07c-130.38 0-236.07-105.69-236.07-236.07S378.84 14.43 509.22 14.43 745.29 120.12 745.29 250.5 639.6 486.57 509.22 486.57z",fill:"#f15a24",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),e.jsx("path",{d:"M487.34 250.5c0-62.39-24.29-121.04-68.41-165.16a235.9 235.9 0 00-37.43-30.47 235.35 235.35 0 00-37.43 30.47c-44.12 44.11-68.41 102.77-68.41 165.16s24.29 121.04 68.41 165.16a235.9 235.9 0 0037.43 30.47 235.35 235.35 0 0037.43-30.47c44.12-44.11 68.41-102.77 68.41-165.16z",fill:"#535353"}),e.jsx("path",{d:"M258.72 250.5c0-66.64 25.95-129.3 73.08-176.42a253.125 253.125 0 0134.1-28.57c-33.98-18.65-72.29-28.57-112.13-28.57-62.39 0-121.04 24.29-165.16 68.41C44.5 129.46 20.2 188.11 20.2 250.5s24.29 121.04 68.41 165.16c44.11 44.12 102.77 68.41 165.16 68.41 39.84 0 78.15-9.92 112.13-28.57a252.507 252.507 0 01-34.1-28.57c-47.12-47.12-73.08-109.78-73.08-176.42zM674.37 85.34C630.25 41.22 571.6 16.93 509.21 16.93c-40.27 0-78.98 10.14-113.24 29.18 11.74 8.26 22.86 17.6 33.22 27.96 47.12 47.12 73.08 109.78 73.08 176.42s-25.95 129.3-73.08 176.42a252.312 252.312 0 01-33.22 27.96c34.25 19.04 72.96 29.18 113.24 29.18 62.39 0 121.04-24.29 165.16-68.41 44.12-44.11 68.41-102.77 68.41-165.16s-24.29-121.04-68.41-165.16z",fill:"#535353"}),e.jsx("foreignObject",{height:"450",width:"250",x:"30",y:"25",children:e.jsx("div",{className:"venn-diagram__circle-content-left",children:t})}),e.jsx("foreignObject",{height:"450",width:"250",x:"480",y:"25",children:e.jsx("div",{className:"venn-diagram__circle-content-right",children:o})}),e.jsx("foreignObject",{height:"370",width:"182",x:"290",y:"65",children:e.jsx("div",{className:"venn-diagram__circle-content-intersection",children:h})})]})}function Me({things:t,rules:o}){const[h]=U(),[n,s]=j.useState(null),x=()=>{s(Object.values(te(1,{latestDate:"2023/01/01",latestNumber:0,used:[]},o,t))[0])},f=()=>{let i=null;try{i=te(25,{latestDate:"2023/01/01",latestNumber:0,used:[]},o,t),console.log(i)}catch(p){console.error(p)}};return e.jsxs(S,{orientation:"vertical",ref:h,children:[e.jsx(g.Title,{level:5,children:"Game Simulator"}),e.jsx(R,{onClick:x,size:"large",children:"Simulate"}),e.jsx(R,{onClick:f,size:"large",children:"Generate Demos (log)"}),n&&e.jsx(Re,{game:n},JSON.stringify(n))]})}function Pe({children:t,things:o,rules:h,addEntryToUpdate:n}){const s=j.useMemo(()=>Object.values(o).filter(p=>{if(!p.syllables)return!0;if(p.syllables.split(ne).join("")!==p.name.replace(/\s/g,""))return console.log("❗️ Name and syllables do not match",p.name,p.syllables),!0;const u=Object.values(h).filter(r=>r.updatedAt>p.updatedAt);return u.filter(r=>r.method==="manual").length>0&&console.log("❗️ Thing has auto updates that will be performed automatically upon downloading the JSON"),u.some(r=>r.method==="manual")}),[o,h]),[x,f]=j.useState(null);j.useEffect(()=>{const p=async u=>{console.log("Found things that need to update..."),f(null),await $(250),s.length>0&&f(s[0])};console.count("Checking for things that need to update..."),s.length>0&&p(s[0])},[s]);const i=p=>{n(p.itemId,p)};return e.jsxs(e.Fragment,{children:[x&&e.jsx(q,{allThings:o,isModalOpen:x!==null,okButtonText:"Update",onCancel:()=>f(null),onSaveThing:i,rules:h,subtitle:`(${s.length} left to update)`,thing:x,width:"90vw"}),t]})}function ce({addEntryToUpdate:t,availableThings:o,rules:h,width:n,allThings:s}){const{notification:x}=he.useApp(),[f,i]=j.useState(null),[p,u]=j.useState({}),y=()=>{const l=V.sample(o.filter(m=>!p[m.id]));l?(u(m=>({...m,[l.id]:!0})),i({itemId:l.id,name:Ee(l),updatedAt:Date.now(),syllables:"",stressedSyllable:0,rules:[]})):i(null)},r=j.useMemo(()=>{if(!f)return[];const l=o.find(m=>m.id===f.itemId);return[l?.name.pt,...l?.aliasesPt??[]].filter(Boolean)},[f,o]),a=async l=>{f&&((!l.name||!l.itemId)&&x.error({title:"Name and Item ID are required"}),t(l.itemId,l),console.log("COMPLETED SAVE"),i(null),await $(250),y())},d=async()=>{i(null),await $(100),y()};return e.jsxs(e.Fragment,{children:[e.jsx(R,{onClick:y,size:"large",children:"Classify New Item"}),!!f&&e.jsx(q,{allThings:s,isModalOpen:f!==null,itemAliases:r,onCancel:()=>i(null),onGiveAnotherThing:d,onSaveThing:a,rules:h,thing:f,width:n*.9})]})}const Ee=t=>t.name.pt.split(" ").length===1?t.name.pt:t.aliasesPt?t.aliasesPt.find(o=>o.split(" ").length===1)??t.name.pt:t.name.pt;function We({things:t,addEntryToUpdate:o,availableThings:h,rules:n,setActiveThing:s}){const[x,{width:f}]=U(),i=j.useMemo(()=>Object.values(t),[t]),p=de({total:i.length,showQuickJumper:!0}),u=[{title:"ItemId",dataIndex:"itemId",key:"itemId",sorter:(r,a)=>Number(r.itemId)-Number(a.itemId),render:r=>e.jsx(I,{children:r})},{title:"Name",dataIndex:"name",key:"name",sorter:(r,a)=>r.name.localeCompare(a.name),render:r=>e.jsx(g.Text,{children:r})},{title:"Sprite",dataIndex:"itemId",key:"sprite",render:r=>e.jsx(W,{onActivateThing:s,thing:t[r]},`i-${r}`)},{title:"Rules",dataIndex:"rules",key:"rules",render:(r,a)=>e.jsx(S,{wrap:!0,children:r.map(d=>e.jsx(pe,{title:n[d].title,children:e.jsx(I,{color:n[d].updatedAt>a.updatedAt?"red":void 0,children:d})},d))})},{title:"Count",dataIndex:"rules",key:"count",sorter:(r,a)=>r.rules.length-a.rules.length,render:r=>r.length}],y=j.useMemo(()=>{const r={};return Object.values(t).forEach(a=>{r[a.name]||(r[a.name]=[]),r[a.name].push(a.itemId)}),Object.values(r).filter(a=>a.length>1)},[t]);return e.jsxs(S,{orientation:"vertical",ref:x,children:[e.jsxs(g.Title,{level:5,children:["Rules By Items ",e.jsx(A,{orientation:"vertical"})," Added: ",e.jsx(I,{children:Object.keys(t).length})," ","Available to add ",e.jsx(I,{children:h.length})]}),e.jsx(ce,{addEntryToUpdate:o,allThings:t,availableThings:h,rules:n,width:f}),e.jsx(A,{}),e.jsx(oe,{columns:u,dataSource:i,pagination:p,rowKey:"itemId"}),e.jsx(A,{}),e.jsx(g.Title,{level:5,children:"Duplicated Things"}),e.jsxs(S,{wrap:!0,children:[y.length===0&&e.jsx(g.Text,{children:"No duplicated things"}),y.map(r=>e.jsxs(O,{align:"center",children:[e.jsx(I,{color:"red",children:r.length}),r.map(a=>e.jsx(W,{onActivateThing:s,thing:t[a]},`i-${a}`))]},r[0]))]})]})}function ze({things:t,addEntryToUpdate:o,availableThings:h,rules:n,thingsByRules:s,setActiveThing:x,containerWidth:f}){const{is:i,addParam:p}=G(),u=j.useMemo(()=>Object.values(n).map(d=>({...d,thingsCount:s[d.id].length})),[n,s]),y=de({total:u.length,showQuickJumper:!0}),r=j.useMemo(()=>{const d=Object.values(s).map(l=>l.length);return{maxThings:Math.max(...d),minThings:Math.min(...d),averageThings:Math.round(Object.values(s).reduce((l,m)=>l+m.length,0)/Object.keys(s).length)}},[s]),a=[{title:"Id",dataIndex:"id",key:"id",sorter:(d,l)=>Number(d.id.split("-")[1])-Number(l.id.split("-")[1]),render:d=>e.jsx(g.Text,{children:d})},{title:"Rule",dataIndex:"title",key:"title",sorter:(d,l)=>d.title.localeCompare(l.title),render:d=>e.jsx(g.Text,{children:d})},{title:"Type",dataIndex:"type",key:"type",sorter:(d,l)=>d.type.localeCompare(l.type)},{title:"Method",dataIndex:"method",key:"method",sorter:(d,l)=>d.method.localeCompare(l.method)},{title:"Things",dataIndex:"thingsCount",key:"thingsCount",render:(d,l)=>e.jsxs(S,{size:"small",children:[e.jsx(I,{children:d}),i("showThings")?e.jsxs(S,{size:"small",wrap:!0,children:[s[l.id].slice(0,20).map(m=>e.jsx(W,{onActivateThing:x,thing:t[m]},`${l.id}-${m}`)),s[l.id].length>20&&e.jsxs(g.Text,{children:["+",d-20," more"]})]}):e.jsxs(S,{size:"small",wrap:!0,children:[s[l.id].slice(0,5).map(m=>e.jsx(W,{onActivateThing:x,thing:t[m]},`${l.id}-${m}`)),s[l.id].length>5&&e.jsxs(g.Text,{children:["+",d-5," more"]})]})]}),sorter:(d,l)=>d.thingsCount-l.thingsCount},{title:"Level",dataIndex:"level",key:"level",sorter:(d,l)=>d.level-l.level,render:d=>e.jsx(re,{count:3,disabled:!0,value:d})}];return e.jsxs(S,{orientation:"vertical",children:[e.jsxs(g.Title,{level:4,children:["Things By Rule (Added: ",Object.keys(t).length," | ",h.length,")"," "]}),e.jsxs(S,{separator:e.jsx(A,{orientation:"vertical"}),wrap:!0,children:[e.jsx(ce,{addEntryToUpdate:o,allThings:t,availableThings:h,rules:n,width:f}),e.jsxs(g.Text,{strong:!0,children:["Average Things: ",e.jsx(I,{children:r.averageThings})]}),e.jsxs(g.Text,{strong:!0,children:["Max Things: ",e.jsx(I,{children:r.maxThings})]}),e.jsxs(g.Text,{strong:!0,children:["Min Things: ",e.jsx(I,{children:r.minThings})]}),e.jsx(B,{checked:i("showThings"),checkedChildren:"Hide things",onChange:d=>p("showThings",d),unCheckedChildren:"Show things"})]}),e.jsx(oe,{columns:a,dataSource:u,pagination:y})]})}const se=t=>{const o=t.filter(h=>h.split(" ").length===1);return o.length>0?o[0]:""};function Le({data:t,addEntryToUpdate:o}){const[h,{width:n}]=U(),s=_("items"),x=_("daily-diagram-rules"),f=j.useMemo(()=>Object.values(s.data??{}).filter(l=>{if(t&&t[l.id]!==void 0||l.nsfw)return!1;const m=l.name.pt.split(" ").length===1;return!!(l.decks?.includes("thing")||l.decks?.includes("alien")&&m||l.decks?.includes("manufactured")&&m||l.decks?.includes("alien")&&l.aliasesPt&&se(l.aliasesPt)||l.decks?.includes("manufactured")&&l.aliasesPt&&se(l.aliasesPt)||l.decks?.includes("meta")&&m)}),[t,s.data]),i=j.useMemo(()=>x.data??{},[x.data]),p=j.useMemo(()=>{const l=Object.values(i).reduce((m,T)=>(m[T.id]=[],m),{});return V.orderBy(Object.values(t),["updatedAt"],["desc"]).forEach(m=>{m.rules.forEach(T=>{l[T].push(m.itemId)})}),l},[t,i]),{is:u,queryParams:y}=G(),[r,a]=j.useState(null);if(s.isLoading||x.isLoading)return e.jsx(g.Text,{children:"Loading..."});const d=l=>{o(l.itemId,l)};return e.jsx(ae,{hasResponseData:s.hasResponseData||x.hasResponseData,isLoading:s.isLoading||x.isLoading,children:e.jsx("div",{ref:h,children:e.jsxs(Pe,{addEntryToUpdate:o,rules:i,things:t,children:[r&&e.jsx(q,{allThings:t,isModalOpen:r!==null,okButtonText:"Update",onCancel:()=>a(null),onSaveThing:l=>{d(l),a(null)},rules:i,thing:r,width:n}),(u("display","rule")||!y.has("display"))&&e.jsx(ze,{addEntryToUpdate:o,availableThings:f,containerWidth:n,rules:i,setActiveThing:a,things:t,thingsByRules:p}),u("display","thing")&&e.jsx(We,{addEntryToUpdate:o,availableThings:f,rules:i,setActiveThing:a,things:t,thingsByRules:p}),u("display","simulator")&&e.jsx(Me,{addEntryToUpdate:o,availableThings:f,rules:i,things:t})]})})})}function Nt(){const t=Ce({tdrResourceName:"daily-diagram-items",firestoreDataCollectionName:"diagramItems",serialize:!0});return e.jsx(xe,{subtitle:"Diagram Sets",title:"Items",children:e.jsxs(ee,{hasSider:!0,children:[e.jsx(ve,{children:e.jsx(Oe,{...t})}),e.jsx(ee.Content,{className:"content",children:e.jsx(ae,{error:t.error,hasResponseData:!V.isEmpty(t.data),isLoading:t.isLoading||t.isSaving,children:e.jsx(O,{gap:24,vertical:!0,children:e.jsx(Le,{...t})})})})]})})}export{Nt as ItemsDiagramSets,Nt as default};
