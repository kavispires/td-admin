import{j as e,T as h,an as L,B as Q,r as p,D as b,P as E,L as P}from"./index-IdPNWoIA.js";import{D as A}from"./DataLoadingWrapper-Ch7gITbQ.js";import{T as $}from"./Typeahead-Z2ehvLC8.js";import{R as D,I}from"./Item-DFZhjtxG.js";import{u as z}from"./useCopyToClipboardFunction-DWJ7c-lt.js";import{u as M}from"./useTableExpandableRows-BM5cnxLl.js";import{u as G}from"./useTablePagination-Bx88m9C-.js";import{u as v}from"./useTDResource-CfJUpd5i.js";import{l as y,P as J}from"./useBaseUrl-DjlPP39F.js";import{r as S,b as W,h as _,w as U,a as Y}from"./index-Bp_ut9CP.js";import{I as F}from"./InspirationSample-DMitUZfl.js";import{I as K}from"./ItemsTypeahead-BW46LPu9.js";import{F as N}from"./Table-BGFXocYS.js";import{F as d}from"./index-ZnkpdGSt.js";import{S as X}from"./index-gsdKC-Cu.js";import{R as H}from"./index-0_yaByn5.js";import{S as V}from"./index-CMeCFo_f.js";import{S as w}from"./index-CHVKldSs.js";import{P as Z}from"./index-C2abbVwP.js";import{R as q}from"./DeleteFilled-CSeaId5j.js";import{u as R}from"./useQueryParams-DGhPKHGQ.js";import{c as ee,F as te,T as k}from"./FilterEntries-CyKTUyXf.js";import{S as se}from"./SiderContent-Dmz6UsoL.js";import{D as re,B as ie}from"./DownloadButton-4fgxXpYm.js";import{S as ae}from"./SaveButton-BCIdkMt5.js";import{M as ne}from"./index-CY1knO-G.js";import{C as oe}from"./index-Dxa4tw87.js";import{R as le}from"./TableOutlined-CZ4hOfoz.js";import{R as ce}from"./FrownOutlined-zD1HiW4s.js";import{R as de}from"./RobotOutlined-DqzYa12Z.js";import{T as ue}from"./TransparentButton-ClGftIFB.js";import{u as me,P as pe}from"./useGridPagination-CSNoFZ8H.js";import{a as B}from"./ItemBuildingBlocks-CnpGtRG0.js";import{D as he}from"./index-CaeUuaNW.js";import{R as xe}from"./main-CRm5XwKC.js";import{u as je}from"./daily-quartetos-DM5o4Kyh.js";import{g as fe}from"./useParsedHistory-C9Kv-I9L.js";import{u as ge}from"./useResourceFirestoreData-qCAexMbx.js";import"./useDebounce-CwLspj-3.js";import"./index-Ck_AH3l7.js";import"./index-BdT5DDDg.js";import"./Input-DErVaEmv.js";import"./constants-B6u4zE9X.js";import"./SyncOutlined-Bwt5MAJw.js";import"./PlusOutlined-9DCgaAy3.js";import"./index-fvaD2JJj.js";import"./index-mJOv3lac.js";import"./index-Bq046HYO.js";import"./scrollTo-HDAe66fN.js";import"./Pagination-BZ0Q2Ye7.js";import"./gapSize-U1swVQyS.js";import"./index-B2c0zKQZ.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-BeXDflC8.js";import"./index-CyPnQVqW.js";import"./LanguageFlag-DBky0axk.js";import"./FireFilled-DkC8lz7U.js";import"./IdcardOutlined-CDa9hYLM.js";import"./useGetFirestoreDoc-CTs4B5gQ.js";import"./useUpdateFirestoreDoc-3YFipcOY.js";import"./useMutation-C19tV37G.js";const ye=y.orderBy(["general","visual","word","thematic","attribute"]).map(t=>({label:t,value:t}));function O({rows:t,addEntryToUpdate:s}){const r=z(),a=v("items"),o=G({total:t.length,showQuickJumper:!0}),l=[{title:"ID",dataIndex:"id",render(i,n){return e.jsxs(d,{align:"center",gap:3,children:[n.itemsIds.length>=4&&!n.level&&e.jsx(D,{style:{color:"red"}}),e.jsx(h.Text,{copyable:!0,children:i})]})}},{title:"Title",dataIndex:"title",render:(i,n)=>e.jsx(Ce,{addEntryToUpdate:s,property:"title",quartet:n,value:i}),sorter:(i,n)=>i.title.localeCompare(n.title)},N.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(i,n)=>e.jsx(we,{addEntryToUpdate:s,copyToClipboard:r,itemsIds:i,quartet:n}),sorter:(i,n)=>i.itemsIds.length-n.itemsIds.length},{title:"Count",dataIndex:"itemsIds",render:i=>S(i).filter(Boolean).length,sorter:(i,n)=>i.itemsIds.length-n.itemsIds.length},{title:"Type",dataIndex:"type",render:(i,n)=>e.jsx(X,{defaultValue:i,onChange:x=>s(n.id,{...n,type:x}),options:ye,size:"small",style:{width:100}}),sorter:(i,n)=>(i.type??"_").localeCompare(n.type??"_")},{title:"Level",dataIndex:"level",render:(i,n)=>e.jsx(H,{count:4,onChange:x=>s(n.id,{...n,level:x}),value:i}),sorter:(i,n)=>i.level-n.level},{title:"Perfect Quartet",dataIndex:"itemsIds",render:i=>S(i).filter(Boolean).length===4&&e.jsx(L,{style:{color:"dodgerblue"}})},{title:"Flagged",dataIndex:"flagged",render:(i,n)=>e.jsx(V,{checked:i,checkedChildren:e.jsx(D,{style:{color:"red"}}),onChange:x=>{if(x)s(n.id,{...n,flagged:x});else{const f=y.cloneDeep(n);delete f.flagged,s(n.id,f)}}}),sorter:(i,n)=>(i.flagged?1:0)-(n.flagged?1:0)}],c=M({maxExpandedRows:1,expandedRowRender:i=>e.jsx(Ie,{addEntryToUpdate:s,quartet:i}),rowExpandable:()=>a.isSuccess});return e.jsx(N,{columns:l,dataSource:t,expandable:c,pagination:o,rowClassName:i=>i.itemsIds.length>=4&&!i.level?"table-row-error":"",rowKey:"id"})}function Ie({quartet:t,addEntryToUpdate:s}){const r=a=>{s(t.id,{...t,itemsIds:[...t.itemsIds,a]})};return e.jsxs("div",{children:[e.jsx(K,{onFinish:r}),e.jsx(F,{excludeList:t.itemsIds,initialQuantity:0,onSelect:r})]})}function ve({quartet:t,addEntryToUpdate:s,itemId:r}){const a=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(o=>o!==r)})};return e.jsx(Z,{cancelText:"No",okText:"Yes",onConfirm:a,title:"Are you sure you want to remove this item?",children:e.jsx(Q,{icon:e.jsx(q,{}),size:"small",type:"text"})})}function we({quartet:t,itemsIds:s,copyToClipboard:r,addEntryToUpdate:a}){return e.jsx(d,{gap:6,wrap:"wrap",children:s.map(o=>e.jsxs(d,{gap:2,vertical:!0,children:[o?e.jsx(I,{id:String(o),width:60}):'"ERROR"',e.jsxs(d,{justify:"center",children:[e.jsx(h.Text,{onClick:()=>r(o),children:o}),e.jsx(ve,{addEntryToUpdate:a,itemId:o,quartet:t})]})]},`${t.title}-${o}`))},`items-${t.title}`)}function Ce({value:t,quartet:s,addEntryToUpdate:r,property:a}){const o=l=>typeof t=="number"?l!==String(t)?r(s.id,{...s,[a]:Number(l)}):null:l!==t?r(s.id,{...s,[a]:l.trim()}):null;return e.jsx(w,{children:e.jsx(h.Text,{editable:{onChange:o},children:String(t)})})}function T({data:t,addEntryToUpdate:s}){const[r,a]=p.useState(null),o=p.useMemo(()=>r?t[r]:null,[r,t]);return e.jsxs(w,{direction:"vertical",children:[e.jsx(h.Title,{level:5,children:"Search Quartet"}),e.jsx($,{data:t,onFinish:l=>a(l),parser:be,placeholder:"Search quartet by title..."}),!!o&&e.jsx(O,{addEntryToUpdate:s,rows:[o]})]})}const be=t=>Object.values(t??{}).reduce((s,r)=>(s[`${r.title} (${r.id})`]=r.id,s),{});function Se({data:t,addEntryToUpdate:s}){const{is:r}=R(),a=r("emptyOnly"),o=p.useMemo(()=>a?y.orderBy(Object.values(t).filter(c=>c.itemsIds.length<4),["id"],["asc"]):y.orderBy(Object.values(t),["id"],["asc"]),[t,a]),l=o.filter(c=>c.itemsIds.length===4).length;return e.jsxs(w,{direction:"vertical",children:[e.jsxs(h.Title,{level:5,children:["Total Quartets: ",o.length," | Complete Quartets: ",l]}),e.jsx(O,{addEntryToUpdate:s,rows:o})]})}function Te({data:t,addEntryToUpdate:s}){const[r,a]=p.useState(!1),o=p.useMemo(()=>W(Object.keys(t)),[t]),l=()=>y.cloneDeep({id:o,title:"",itemsIds:[],level:0}),[c,i]=p.useState(l()),n=(j,m)=>{i({...m})},x=j=>{i(m=>({...m,itemsIds:S([...m.itemsIds,j])}))},f=async()=>{s(c.id,y.cloneDeep(c)),a(!1),await U(250),i(l())},u=p.useMemo(()=>c.title.length<3?[]:y.orderBy(Object.values(t),j=>_.compareTwoStrings(j.title.toLocaleLowerCase(),c.title.toLocaleLowerCase()),"desc").slice(0,5).filter(j=>j.id!==c.id),[c.title,c.id,t]);return e.jsxs(e.Fragment,{children:[e.jsx(Q,{block:!0,onClick:()=>a(!0),type:"dashed",children:"Add New Set"}),e.jsx(ne,{maskClosable:!1,okButtonProps:{disabled:!c.title,onClick:f},onCancel:()=>a(!1),open:r,title:"Add Quartet",width:"80vw",children:!!c&&e.jsxs(e.Fragment,{children:[e.jsx(O,{addEntryToUpdate:n,expandedRowKeys:[c.id],rows:[c]}),u.length>0&&e.jsx(oe,{size:"small",children:e.jsx(d,{gap:4,vertical:!0,children:u.map(j=>e.jsx("div",{children:j.title},j.id))})}),e.jsx(F,{excludeList:c.itemsIds,onSelect:x})]})})]})}function Qe({data:t,save:s,isDirty:r,isSaving:a,entriesToUpdate:o,addEntryToUpdate:l,hasFirestoreData:c}){const{is:i,addParam:n,queryParams:x,addParams:f}=R();return Oe(),e.jsxs(se,{children:[e.jsxs(d,{gap:12,vertical:!0,children:[e.jsx(ae,{dirt:JSON.stringify(o),isDirty:r,isSaving:a,onSave:s}),e.jsx(re,{block:!0,data:()=>Re(t),disabled:r,fileName:"daily-quartet-sets.json",hasNewData:c})]}),e.jsx(b,{}),e.jsx(ee,{label:"Pending Only",onChange:u=>n("emptyOnly",u,!1),value:i("emptyOnly")}),e.jsx(Te,{addEntryToUpdate:l,data:t}),e.jsx(b,{}),e.jsx(te,{label:"Display",onChange:u=>f({display:u,page:1},{page:1,display:"table"}),options:[{title:"Table",icon:e.jsx(le,{}),value:"table"},{title:"Orphans",icon:e.jsx(ce,{}),value:"orphans"},{title:"Simulator",icon:e.jsx(de,{}),value:"simulator"}],value:x.get("display")??"table"})]})}function Re(t){return Y(t)}function Oe(){const t=v("items");p.useEffect(()=>{if(!t.dataUpdatedAt)return;const s={twoChars:{},threeChars:{},fourChars:{}};Object.values(t.data??{}).forEach(r=>{var i;const a=r.name.pt||((i=r.aliasesPt)==null?void 0:i.find(n=>n.split(" ").length===1));if(!a||a.length<3)return;const o=a.slice(-2).trim();if(o.length<2)return;s.twoChars[o]||(s.twoChars[o]=[]),s.twoChars[o].push(r);const l=a.slice(-3).trim();if(l.length<3)return;s.threeChars[l]||(s.threeChars[l]=[]),s.threeChars[l].push(r);const c=a.slice(-4).trim();c.length<4||(s.fourChars[c]||(s.fourChars[c]=[]),s.fourChars[c].push(r))}),Object.keys(s).forEach(r=>{Object.keys(s[r]).forEach(a=>{s[r][a].length<4&&delete s[r][a]})}),console.log("Grouped Items by Name Ending:",s)},[t.dataUpdatedAt])}function Pe({data:t,...s}){const r=v("items"),[a,o]=p.useState(null),[l,c]=p.useState(1),{unusedItems:i,usedItems:n}=p.useMemo(()=>{const u=Object.values(t).reduce((m,g)=>(g.itemsIds.forEach(C=>{m[C]||(m[C]=[]),m[C].push(g.id)}),m),{}),j=Object.keys(r.data||{}).reduce((m,g)=>u[g]?(u[g].length>=l&&(m[g]=u[g].length),m):(m[g]=0,m),{});return{usedItems:u,unusedItems:Object.keys(j).map(m=>({id:m,count:j[m]}))}},[t,r.data,l]),{page:x,pagination:f}=me({data:i,defaultPageSize:64});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(h.Title,{className:"my-0",level:4,children:"Quartetos Orphans Items"}),e.jsx(h.Text,{type:"secondary",children:"These items are not used in any quartet. You can add them to a quartet by clicking on them."})]}),e.jsxs(d,{align:"center",gap:8,children:[e.jsxs("span",{children:[i.length," Orphans | ",Object.keys(n).length," Used"]}),e.jsx(k,{min:0,onChange:u=>c(u??1),size:"small",style:{width:120},suffix:"min uses",value:l})]}),e.jsx(pe,{className:"full-width",pagination:f,children:e.jsx(d,{gap:16,wrap:"wrap",children:x.map(u=>e.jsx(ue,{onClick:()=>o(u.id),children:e.jsxs(d,{style:{maxWidth:84},vertical:!0,children:[e.jsx(I,{id:u.id,width:64}),e.jsx(d,{align:"center",children:e.jsx(ie,{count:u.count,dot:!0,offset:[-8,0],children:e.jsx(B,{item:r.data[u.id]})})})]},u.id)},u.id))})}),e.jsx(De,{data:t,itemId:a,onClose:()=>o(null),...s})]})}function De({itemId:t,onClose:s,...r}){const a=v("items"),o=p.useMemo(()=>Object.values(r.data).filter(l=>l.itemsIds.includes(t??"")),[t,r.data]);return t===null?null:e.jsx(he,{onClose:s,open:!!t,placement:"bottom",title:"Item Details",children:e.jsxs(d,{gap:16,children:[e.jsxs(d,{gap:16,vertical:!0,children:[e.jsx(I,{id:t,width:64}),e.jsx(B,{item:a.data[t]})]}),e.jsxs(d,{vertical:!0,children:[e.jsxs(h.Text,{strong:!0,children:["Used in ",o.length," quartets:"]}),o.map(l=>e.jsxs(d,{vertical:!0,children:[e.jsx(h.Text,{children:l.title}),e.jsxs(h.Text,{type:"secondary",children:["(",l.id,")"]}),e.jsx(d,{gap:8,wrap:"wrap",children:l.itemsIds.map(c=>e.jsx(I,{id:c,width:32},c))}),e.jsx(b,{})]},l.id))]}),e.jsx(T,{...r})]})})}function Ne(){const[t,s]=p.useState({batchSize:1,history:{}}),r=p.useRef(1),{entries:a}=je(!0,"pt",t.batchSize,t.history);return e.jsxs(d,{className:"p-4",gap:12,vertical:!0,children:[e.jsxs(d,{align:"center",justify:"space-between",children:[e.jsx(h.Title,{className:"my-0",level:4,children:"Quartetos Simulator"}),e.jsxs(d,{gap:6,children:[e.jsx(k,{defaultValue:1,max:100,min:1,onChange:o=>{r.current=o??1}}),e.jsx(Q,{onClick:()=>s({batchSize:r.current,history:{}}),type:"primary",children:"Re-run Simulation"})]})]}),e.jsx(Fe,{entries:a})]})}function Fe({entries:t}){const s=fe(),r=t[s];return e.jsxs("div",{className:"full-width grid",style:{gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(xe,{collapsed:3,src:t??{},theme:"twilight"}),e.jsx("div",{children:r&&e.jsx(d,{vertical:!0,children:r.sets.map(a=>e.jsx(ke,{quartet:a},a.id))})})]})}function ke({quartet:t}){return e.jsxs(w,{direction:"vertical",children:[e.jsxs(h.Text,{strong:!0,children:[t.title," [",t.level,"]"]}),e.jsx(d,{gap:8,children:t.itemsIds.map(s=>e.jsxs(d,{vertical:!0,children:[e.jsx(I,{id:s,width:60}),e.jsx(h.Text,{type:"secondary",children:s})]},s))})]})}function Gt(){const{queryParams:t}=R(),s=t.get("display"),r=ge({tdrResourceName:"daily-quartet-sets",firestoreDataCollectionName:"quartetSets"});return e.jsx(E,{subtitle:"Quartet Sets",title:"Items",children:e.jsxs(P,{hasSider:!0,children:[e.jsx(J,{children:e.jsx(Qe,{...r})}),e.jsx(P.Content,{className:"content",children:e.jsxs(A,{error:r.error,hasResponseData:!y.isEmpty(r.data),isLoading:r.isLoading,children:[s==="simulator"&&e.jsx(Ne,{}),s==="orphans"&&e.jsxs(d,{gap:24,vertical:!0,children:[e.jsx(T,{...r}),e.jsx(Pe,{...r})]}),!s&&e.jsxs(d,{gap:24,vertical:!0,children:[e.jsx(T,{...r}),e.jsx(Se,{...r})]})]})})]})})}export{Gt as ItemsQuartets,Gt as default};
