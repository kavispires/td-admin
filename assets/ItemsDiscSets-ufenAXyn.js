import{r as p,a as $,_ as q,j as e,B as v,T as j,D as Q,P as W,L as N}from"./index-DsV55vb0.js";import{D as J}from"./DataLoadingWrapper-DRIKXOAh.js";import{F as _}from"./FilterEntries-mw82ljdp.js";import{S as K}from"./SiderContent-DJlYgVXp.js";import{D as G}from"./DownloadButton-CSQMkNUE.js";import{S as H}from"./SaveButton-CHO0AJlF.js";import{u as P}from"./useQueryParams-35HGH-39.js";import{l as x,P as X}from"./useBaseUrl-DHVr4qF3.js";import{h as Y,i as b,r as w,a as V}from"./index-DwSDsoxO.js";import{L as R}from"./LanguageFlag-QXcEmUEA.js";import{F as C}from"./index-B1ugW9XK.js";import{M as Z}from"./index-CL8_3uEH.js";import{I as O}from"./index-DH7x8X0p.js";import{F as S}from"./index-BhQiV4UT.js";import{R as U}from"./TableOutlined-Ckul1GBf.js";import{T as ee}from"./Typeahead-kFz2vZC3.js";import{u as te}from"./useCopyToClipboardFunction-6k-5oTSa.js";import{u as E}from"./useTDResource-ytlw1Wdo.js";import{u as se}from"./useTableExpandableRows-1vyA5Htw.js";import{u as re}from"./useTablePagination-CuriBiFH.js";import{S as D}from"./index-BYr7G0av.js";import{I as A}from"./Item-BU57AiPz.js";import{C as ie}from"./CopyIdsButton-Dh6qgVLM.js";import{P as ne}from"./index-Dia_90Zf.js";import{R as oe}from"./DeleteFilled-CTeCmQpW.js";import{I as ae}from"./InspirationSample-Dl5OHR1B.js";import{I as le}from"./ItemsTypeahead-DfQt1Reb.js";import{F as B}from"./Table-Cd714oU7.js";import{T as ce}from"./TransparentButton-sGwLIwZp.js";import{u as me,P as de}from"./useGridPagination-U0kFODxb.js";import{S as pe}from"./index-C2BSwcK5.js";import{D as ue}from"./index-pC40YKPu.js";import{S as he}from"./index-CxHMk4ck.js";import{T as xe}from"./index-CePeb8uu.js";import{u as fe}from"./useResourceFirestoreData-CsNRjuqg.js";import"./index-BY_VO0Jc.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-Cmwn8Rxi.js";import"./constants-BzeosQnZ.js";import"./Input-ot97OnIB.js";import"./gapSize-U1swVQyS.js";import"./useDebounce-CnH_CZ5R.js";import"./index-DxNbiSOl.js";import"./SyncOutlined-hLBaA_MP.js";import"./PlusOutlined-Cj1_fXCE.js";import"./PlusOutlined-ByZyTB3m.js";import"./index-Br-kN19V.js";import"./index-BLeO27EC.js";import"./scrollTo-CMtt_I9a.js";import"./Pagination-RedeP2v2.js";import"./extendsObject-keMuGWqj.js";import"./useGetFirestoreDoc-CPaLzGa-.js";import"./useUpdateFirestoreDoc-CV6isKZQ.js";import"./useMutation-DczzbJSq.js";var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM512 533c-85.5 0-155.6 67.3-160 151.6a8 8 0 008 8.4h48.1c4.2 0 7.8-3.2 8.1-7.4C420 636.1 461.5 597 512 597s92.1 39.1 95.8 88.6c.3 4.2 3.9 7.4 8.1 7.4H664a8 8 0 008-8.4C667.6 600.3 597.5 533 512 533z"}}]},name:"frown",theme:"outlined"},ge=function(s,i){return p.createElement($,q({},s,{ref:i,icon:je}))},Se=p.forwardRef(ge);function ye({addEntryToUpdate:t,ids:s}){const[i,n]=p.useState(!1),[r]=C.useForm(),c=o=>{const h=x.camelCase(o.name);t(x.camelCase(h),{id:h,title:{pt:o.nome,en:o.name},itemsIds:[]})},l=C.useWatch("name",r),a=p.useMemo(()=>{const o={};if(l&&l.length>2){const h=x.camelCase(l);if(h)try{Y.findBestMatch(h,s).ratings.forEach(g=>{g.rating>.4&&(o[g.target]=g.rating)})}catch(f){console.error(f)}}return Object.keys(o)},[l,s]);return e.jsxs(e.Fragment,{children:[e.jsx(v,{type:"dashed",block:!0,onClick:()=>n(!0),children:"Add New Set"}),e.jsxs(Z,{title:"Add New Set",open:i,onOk:r.submit,onCancel:()=>n(!1),maskClosable:!1,okText:"Add",okButtonProps:{htmlType:"submit"},children:[e.jsxs(C,{form:r,onFinish:c,children:[e.jsx(C.Item,{name:"nome",label:"Nome",rules:[{required:!0}],children:e.jsx(O,{prefix:e.jsx(R,{language:"pt",width:"1em"}),placeholder:"Name in pt",size:"small"})}),e.jsx(C.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(O,{prefix:e.jsx(R,{language:"en",width:"1em"}),placeholder:"Name in en",size:"small"})})]}),e.jsx(j.Text,{children:"Similar:"}),e.jsx("ul",{children:a.map(o=>e.jsx("li",{children:o},o))})]})]})}function Ie({data:t,save:s,isDirty:i,isSaving:n,entriesToUpdate:r,addEntryToUpdate:c,hasFirestoreData:l}){const{queryParams:a,addParams:o}=P();return e.jsxs(K,{children:[e.jsxs(S,{vertical:!0,gap:12,children:[e.jsx(H,{isDirty:i,onSave:s,isSaving:n,dirt:JSON.stringify(M(r))}),e.jsx(G,{data:()=>Ce(t),fileName:"daily-disc-sets.json",disabled:i,hasNewData:l,block:!0})]}),e.jsx(Q,{}),e.jsx(_,{label:"Display",value:a.get("display")??"sets",onChange:h=>o({display:h,page:1},{page:1,display:"table"}),options:[{title:"Sets",icon:e.jsx(U,{}),value:"sets"},{title:"Orphan Items",icon:e.jsx(Se,{}),value:"orphans"}]}),e.jsx(ye,{addEntryToUpdate:c,ids:Object.keys(t)})]})}function M(t){return x.omitBy(x.cloneDeep(t),s=>x.isEmpty(s.itemsIds))}function Ce(t){return Object.keys(t).forEach(s=>{t[s].itemsIds=b(w(t[s].itemsIds))}),V(M(t))}function be({value:t,disc:s,addEntryToUpdate:i}){const n=(r,c)=>{i(s.id,{...s,title:{...s.title,[c]:r}})};return e.jsxs(D,{direction:"vertical",size:"small",children:[e.jsx(j.Text,{editable:{onChange:r=>n(r,"pt")},children:String(t.pt)}),e.jsx(j.Text,{editable:{onChange:r=>n(r,"en")},children:String(t.en)})]})}function we({disc:t,addEntryToUpdate:s,itemId:i}){const n=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(r=>r!==i)})};return e.jsx(ne,{title:"Are you sure you want to remove this item?",onConfirm:n,okText:"Yes",cancelText:"No",children:e.jsx(v,{icon:e.jsx(oe,{}),size:"small",type:"text"})})}function ve({disc:t,itemsIds:s,copyToClipboard:i,addEntryToUpdate:n}){return e.jsxs(S,{gap:6,wrap:"wrap",children:[s.map((r,c)=>e.jsxs(S,{gap:2,vertical:!0,children:[e.jsx(A,{id:r,width:60}),e.jsxs(S,{justify:"center",children:[e.jsx(j.Text,{onClick:()=>i(r),children:r}),e.jsx(we,{disc:t,addEntryToUpdate:n,itemId:r})]})]},`${t.title}-${r}-${c}`)),e.jsx(ie,{ids:s})]},`items-${t.title}`)}function De({onUpdateBatch:t}){const[s,i]=p.useState(""),n=()=>{try{const c=s.replace(/^\[|\]$/g,"").split(/\s*,\s*/).map(l=>l.replace(/^"|"$/g,"")).filter(Boolean);t(c),i("")}catch(r){console.error(r)}};return e.jsxs(j.Paragraph,{children:["Paste IDs",e.jsx(O.TextArea,{value:s,onChange:r=>i(r.target.value)}),e.jsx(v,{size:"small",onClick:n,children:"Add"})]})}function Te({disc:t,addEntryToUpdate:s}){const i=r=>{s(t.id,{...t,itemsIds:w(b([...t.itemsIds,r]))})},n=r=>{s(t.id,{...t,itemsIds:w(b([...t.itemsIds,...r]))})};return e.jsxs(S,{gap:16,children:[e.jsxs("div",{children:[e.jsx(j.Paragraph,{children:"Add Item"}),e.jsx(le,{onFinish:i})]}),e.jsx(ae,{onSelect:i,excludeList:t.itemsIds}),e.jsx(De,{onUpdateBatch:n})]})}function z({rows:t,addEntryToUpdate:s}){const i=E("items"),n=te(),r=re({total:t.length,showQuickJumper:!0}),c=[{title:"Id",dataIndex:"id",key:"id",sorter:(a,o)=>a.title.en.localeCompare(o.title.en)},{title:"Title",dataIndex:"title",key:"title",sorter:(a,o)=>a.title.en.localeCompare(o.title.en),render:(a,o)=>e.jsx(be,{value:a,disc:o,addEntryToUpdate:s})},B.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(a,o)=>e.jsx(ve,{disc:o,itemsIds:b(a),copyToClipboard:n,addEntryToUpdate:s})},{title:"Count",dataIndex:"itemsIds",key:"count",render:a=>w(a).filter(Boolean).length}],l=se({maxExpandedRows:1,expandedRowRender:a=>e.jsx(Te,{disc:a,addEntryToUpdate:s}),rowExpandable:()=>i.isSuccess});return e.jsx(B,{columns:c,dataSource:t,pagination:r,rowKey:"id",expandable:l})}function ke({data:t,addEntryToUpdate:s}){const[i,n]=p.useState(null),r=p.useMemo(()=>i?t[i]:null,[i,t]);return e.jsxs(D,{direction:"vertical",children:[e.jsx(j.Title,{level:5,children:"Search Disc Set"}),e.jsx(ee,{data:t,onFinish:c=>n(c),placeholder:"Search disc set by title...",parser:Fe,style:{width:"100%",minWidth:450}}),!!r&&e.jsx(z,{rows:[r],addEntryToUpdate:s})]})}const Fe=t=>Object.values(t??{}).reduce((s,i)=>(s[`${i.title.en}`]=i.id,s[`${i.title.pt}`]=i.id,s),{});function Oe(t){return x.orderBy(t,[s=>s.title.en]).map(s=>({...s,itemsIds:x.orderBy(s.itemsIds,i=>Number(i))}))}function Pe({data:t,addEntryToUpdate:s}){const i=p.useMemo(()=>Oe(Object.values(t)),[t]),n=p.useMemo(()=>i.filter(r=>r.itemsIds.length>=20).length,[i]);return e.jsxs(D,{direction:"vertical",children:[e.jsx(ke,{data:t,addEntryToUpdate:s}),e.jsxs(j.Title,{level:5,children:["Total Disc Sets: ",i.length," | Complete Disc Sets: ",n]}),e.jsx(z,{rows:i,addEntryToUpdate:s})]})}function Ae({data:t,addEntryToUpdate:s}){const{is:i,addParam:n}=P(),r=E("items"),[c,l]=p.useMemo(()=>{if(r.data){const u=Object.values(t).reduce((d,y)=>(y.itemsIds.forEach(F=>{d[F]||(d[F]=[]),d[F].push(y.id)}),d),{});Object.keys(r.data).reduce((d,y)=>(d[y]===void 0&&(d[y]=[]),d[y].push(y),d),{});const k=["black","blue","brown","green","orange","pink","purple","red","white","yellow"],L=Object.keys(r.data).filter(d=>u[d]===void 0||u[d].length===1&&k.includes(u[d][0])).map(d=>r.data[d]);return[u,L]}return[{},[]]},[t,r.data]),a=i("onlyOrphans"),{page:o,pagination:h}=me({data:a?l:Object.values(r.data),defaultPageSize:64,resetter:a?"orphans":"all"}),[f,g]=p.useState(null),[m,I]=p.useState(null),T=p.useMemo(()=>Object.values(t).sort((u,k)=>u.title.pt.localeCompare(k.title.pt)),[t]);return e.jsxs(e.Fragment,{children:[e.jsxs(j.Title,{level:4,children:["Orphan Items (",l.length,")"]}),e.jsx(D,{className:"mb-4",children:e.jsx(pe,{checkedChildren:"Only Orphans",unCheckedChildren:"All Items",onChange:u=>n("onlyOrphans",u,!1)})}),e.jsx(ue,{title:"Add Item to Set",open:!!f,onClose:()=>g(null),children:!!f&&e.jsx(Ne,{activeItem:f,activeItemSets:(c==null?void 0:c[f])??[],latestSetId:m,setLatestSetId:I,sortedSets:T,data:t,addEntryToUpdate:s})}),e.jsx(de,{pagination:h,className:"full-width",children:e.jsx(S,{gap:16,wrap:"wrap",children:o.map(u=>e.jsx(ce,{onClick:()=>g(u.id),children:e.jsx(A,{id:u.id})},u.id))})})]})}function Ne({activeItem:t,activeItemSets:s,setLatestSetId:i,sortedSets:n,data:r,addEntryToUpdate:c}){const[l,a]=p.useState(s);if(!t)return null;const o=m=>{a(m)},h=m=>{a(I=>I.includes(m)?I.filter(T=>T!==m):[...I,m])},f=()=>{l.forEach(m=>{c(m,{...r[m],itemsIds:[...r[m].itemsIds,t]})}),i(l[l.length-1])},g=n.map(m=>({value:m.id,label:m.title.pt}));return e.jsxs(S,{vertical:!0,gap:16,children:[e.jsx(A,{id:t}),e.jsx(v,{type:"primary",onClick:f,disabled:x.isEqual(s,l),children:"Save to Sets"}),e.jsx(he,{onChange:o,mode:"tags",value:l,options:g}),e.jsx(S,{wrap:"wrap",gap:8,children:n.map(m=>e.jsx(xe,{onClick:()=>h(m.id),color:l.includes(m.id)?"gold":void 0,children:m.title.pt},m.id))})]})}function Re({data:t,addEntryToUpdate:s}){const{is:i,queryParams:n}=P();return e.jsxs(e.Fragment,{children:[(i("display","sets")||!n.has("display"))&&e.jsx(Pe,{data:t,addEntryToUpdate:s}),(i("display","orphans")||!n.has("display"))&&e.jsx(Ae,{data:t,addEntryToUpdate:s})]})}function Bt(){const t=fe({tdrResourceName:"daily-disc-sets",firestoreDataCollectionName:"discSets",serialize:!0});return e.jsx(W,{title:"Items",subtitle:"Disc Sets",children:e.jsxs(N,{hasSider:!0,children:[e.jsx(X,{children:e.jsx(Ie,{...t})}),e.jsx(N.Content,{className:"content",children:e.jsx(J,{isLoading:t.isLoading||t.isSaving,error:t.error,hasResponseData:!x.isEmpty(t.data),children:e.jsx(Re,{...t})})})]})})}export{Bt as ItemsDiscSets,Bt as default};
