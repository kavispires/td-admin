import{r as w,a as _,_ as Y,j as e,T,B as I,aj as je,ae as be,y as F,D as le,ai as ye,P as we,L as ee}from"./index-BFDRWtHv.js";import{D as ve}from"./DataLoadingWrapper-QQAlVTEl.js";import{l as v,c as ue,P as Se}from"./useBaseUrl-ByeKCJr_.js";import{u as D}from"./useQueryParams-BzyCUS2v.js";import{R as ke,c as Oe,u as Ce}from"./useTestimoniesResource-5bbEwcv_.js";import{u as Ee,D as Te,a as Ie,g as Me}from"./constants-EUpKdjiV.js";import{u as H}from"./useTDResource-9MAM5PRn.js";import{I as z}from"./ImageCard-CK3PBH92.js";import{g as G}from"./utils-W0m0iwL6.js";import{F as k}from"./index-BW_WXugc.js";import{T as De,S as Ne,F as Re}from"./FilterEntries-Bb8tr1UA.js";import{B as te,D as Pe}from"./DownloadButton-DFL9asHu.js";import{S as B}from"./index-BkBOubIy.js";import{u as de}from"./useTableExpandableRows-gQNnTT8j.js";import{u as he}from"./useTablePagination-CBqnrzq5.js";import{P as se}from"./progress-BMUIr-LY.js";import{S as $}from"./index-BozTJ2QA.js";import{F as X}from"./Table-CQKXSbgW.js";import{I as Ae}from"./index-CVpJTsmp.js";import{u as Fe}from"./useCardWidth-H2OUvNTX.js";import{C as me}from"./index-8MB3GqgU.js";import{P as ne}from"./index-CfWHlIXi.js";import{R as Be}from"./FireFilled-C25tH6Gt.js";import{S as q}from"./SiderContent-DC5vRzOx.js";import{F as re}from"./FirestoreConsoleLink-BOUHUI6f.js";import{S as $e}from"./SaveButton-CFMegeSt.js";import{g as ze}from"./useGetFirestoreDoc-CwYmDqGR.js";import{e as Le,a as He,d as qe}from"./index-IZYxY2DZ.js";import{u as fe}from"./useWindowSize-CtYZypV4.js";import{M as pe}from"./index-RW7SJZDE.js";import{R as Ue}from"./TableOutlined-BAT2vWpD.js";import"./useResourceFirestoreData-CNKffEHM.js";import"./useUpdateFirestoreDoc-Du252Wxc.js";import"./useMutation-B5wm9cAG.js";import"./moment-C5S46NFB.js";import"./gapSize-U1swVQyS.js";import"./index-BWULmf55.js";import"./index-PrF_5kCp.js";import"./index-CZTDQ8Fo.js";import"./index-CydRzHA3.js";import"./scrollTo-B7eD9dGJ.js";import"./Pagination-DwWXHqwF.js";import"./extendsObject-keMuGWqj.js";import"./Input-BRqpx4DJ.js";import"./SaveOutlined-YGZUPp9b.js";import"./constants-B6pq8fjY.js";import"./Item-4aagvKpa.js";var Ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M594.3 601.5a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1 8 8 0 008 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"}}]},name:"contacts",theme:"outlined"},Ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 328a60 60 0 10120 0 60 60 0 10-120 0zM852 64H172c-17.7 0-32 14.3-32 32v660c0 17.7 14.3 32 32 32h680c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-32 660H204V128h616v596zM604 328a60 60 0 10120 0 60 60 0 10-120 0zm250.2 556H169.8c-16.5 0-29.8 14.3-29.8 32v36c0 4.4 3.3 8 7.4 8h729.1c4.1 0 7.4-3.6 7.4-8v-36c.1-17.7-13.2-32-29.7-32zM664 508H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"robot",theme:"outlined"},Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.6 630.2 359 721.8 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.8 758.4 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM248 439.6c-37.1-11.9-64-46.7-64-87.6V232h64v207.6zM840 352c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"filled"};function We(){var s=w.useRef(!0);return s.current?(s.current=!1,!0):s.current}function _e(s,t){return typeof s=="function"?s.length?s(t):s():s}function ge(s,t,c){if(t===void 0&&(t=10),t<1)throw new Error("Capacity has to be greater than 1, got '"+t+"'");var l=We(),u=w.useState(s),m=u[0],d=u[1],o=w.useRef([]),n=w.useRef(0);l&&(o.current.length?(o.current[o.current.length-1]!==s&&o.current.push(s),o.current.length>t&&(o.current=o.current.slice(o.current.length-t))):o.current.push(s),n.current=o.current.length&&o.current.length-1);var p=w.useCallback(function(r){d(function(a){return r=_e(r,a),r!==a&&(n.current<o.current.length-1&&(o.current=o.current.slice(0,n.current+1)),n.current=o.current.push(r)-1,o.current.length>t&&(o.current=o.current.slice(o.current.length-t))),r})},[m,t]),h=w.useMemo(function(){return{history:o.current,position:n.current,capacity:t,back:function(r){r===void 0&&(r=1),n.current&&d(function(){return n.current-=Math.min(r,n.current),o.current[n.current]})},forward:function(r){r===void 0&&(r=1),n.current!==o.current.length-1&&d(function(){return n.current=Math.min(n.current+r,o.current.length-1),o.current[n.current]})},go:function(r){r!==n.current&&d(function(){return n.current=r<0?Math.max(o.current.length+r,0):Math.min(o.current.length-1,r),o.current[n.current]})}}},[m]);return[m,p,h]}var Ye=function(t,c){return w.createElement(_,Y({},t,{ref:c,icon:Ge}))},Xe=w.forwardRef(Ye),Je=function(t,c){return w.createElement(_,Y({},t,{ref:c,icon:Ve}))},Ke=w.forwardRef(Je),Ze=function(t,c){return w.createElement(_,Y({},t,{ref:c,icon:Qe}))},oe=w.forwardRef(Ze);const J=(s,t,c)=>{const{reliabilityThreshold:l=4,projectionThreshold:u=55}={},d=`us-gb-${s.split("-")[1]}`,o=v.isEmpty(t[s])?[]:t[s];let n=0,p=0;o.forEach(E=>{E===3&&(n+=3),E===-3&&(p+=3),E===4&&(n+=4),E===-4&&(p+=4)});const h=o.filter(E=>![-4,-3,3,4].includes(E)),r=h.length+n+p,a=Math.max(r,5),f=o.filter(E=>E===1).length+n,y=Math.round(f/a*100),x=o.filter(E=>E===0).length+p,g=Math.round(x/a*100),b=Math.round((a-f-x)/a*100),S=h.length+n+p>=5,O=r>3,C=r>l,N=C&&Math.abs(y-g)>30?y>g?"üëç":"üëé":null,R=!O||Math.abs(y-g)<20?null:y>=u?"üëç":g>=u?"üëé":null;return{suspectCardId:s,imageId:d,enoughData:O,reliable:C,total:a,yesCount:f,yesPercentage:y,noCount:x,noPercentage:g,blankPercentage:b,complete:S,values:o,resolution:N,projection:R}};function et(s){const t=s.filter(u=>![0,1].includes(u)),c=s.filter(u=>[0,1].includes(u)),l={0:0,1:0};return c.forEach(u=>{if(l[u]===void 0)throw Error(`what is this value? ${u}`);l[u]+=1}),Object.entries(l).forEach(([u,m])=>{if(m>0){const d=Math.floor(m/4),o=m%4;for(let n=0;n<d;n++)t.push(u==="0"?-4:4);if(o>0){const n=Array.from({length:o},()=>u==="0"?0:1);t.push(...n)}}}),t.sort((u,m)=>u-m)}const tt={male:"√© homem",female:"√© mulher",black:"√© negro(a)",white:"√© branco(a)",asian:"√© asi√°tico(a)",latino:"√© latino(a)",thin:"√© magrelo(a)",fat:"√© gordo(a)",large:"√© gordo(a)",tall:"√© alto(a)",short:"√© baixinho(a)",young:"√© jovem",adult:"√© adulto(a)",senior:"√© idoso(a)",average:"√© m√©dio(a)",medium:"√© m√©dio(a)",mixed:"√© mesti√ßo(a)",hat:"est√° usando um chap√©u",tie:"est√° usando uma gravata",glasses:"est√° usando √≥culos",brownHair:"tem cabelo castanho",shortHair:"tem cabelo curto",beard:"tem barba",caucasian:"√© caucasiano(a)",scarf:"est√° usando um cachecol",blondeHair:"tem cabelo loiro",longHair:"tem cabelo longo",greyHair:"tem cabelo grisalho",bald:"√© careca",mustache:"tem bigode",goatee:"tem cavanhaque",muscular:"√© sarado(a)",blackHair:"tem cabelo preto",hoodie:"est√° usando um moletom",earrings:"est√° usando brincos",lipstick:"est√° usando batom",necklace:"est√° usando um colar",mediumHair:"tem cabelo m√©dio","middle-eastern":"√© do Oriente M√©dio",headscarf:"est√° usando um len√ßo na cabe√ßa",redHair:"tem cabelo ruivo",piercings:"tem piercings",coloredHair:"tem cabelo colorido",indian:"√© indiano(a)","native-american":"√© nativo-americano(a)",noAccessories:"n√£o est√° usando acess√≥rios"},Q=9,st=(s,t,c,l)=>{const[u]=Ee(Te.ESPIONAGEM,l),m=H("suspects",s),d=H(`testimony-questions-${t}`,s),o=H("testimony-answers",s),n=H("crime-reasons",s),p=w.useMemo(()=>ot(o.data),[o.dataUpdatedAt]),h=w.useMemo(()=>it(m.data),[m.data]);return{entries:w.useMemo(()=>!u||!m.isSuccess||!d.isSuccess||!o.isSuccess||!n.isSuccess?{}:nt(c,u,m.data,d.data,p,h,n.data),[s,u,m,d,o,c,p,h,n]),isLoading:m.isLoading||d.isLoading||o.isLoading}},nt=(s,t,c,l,u,m,d)=>{console.count("Creating Espionagem...");let o=t.latestDate;const n=[],p={};for(let h=0;h<s;h++){const r=Ie(o);o=r;let a=null,i=0;for(;!a&&i<100;){i++;const f=rt(c,l,u,m,n,d);if(lt(f.statements)){a=f,console.log(`Generated valid game for ${r} after ${i} attempts`);break}}if(!a)throw new Error(`Failed to generate valid game for ${r} after 100 attempts`);n.push(a.culpritId),p[r]={id:r,type:"espionagem",number:t.latestNumber+h+1,...a}}return p};function rt(s,t,c,l,u,m){let d=[];const o=[],n={},p=v.sample(Object.keys(c));if(!p)throw new Error("No selected testimony ID found");const h=Object.keys(c[p]).filter(C=>!u.includes(C)),r=h.length>0?h:Object.keys(c[p]),a=v.sample(r);if(!a)throw new Error("No selected culprit ID found");const i=v.sampleSize(Object.keys(c[p]).filter(C=>C!==a),Q-1);for(d.push(...i);d.length<8;){const C=v.sampleSize(Object.keys(s).filter(N=>!d.includes(N)&&N!==a),Q-d.length-1);d.push(...C)}const f={};Object.keys(l).forEach(C=>{if(l[C][a]===void 0){const N=Object.keys(l[C]).filter(R=>d.includes(R));if(N.length>0){const R={};N.forEach(E=>{d.includes(E)&&(R[E]=!0)}),f[C]=R}}});const y=t[p];o.push(ct(a,d,y,c[p])),A(n,o[0].excludes);const j=V(a,d,f);o.push(j),A(n,j.excludes),d=v.shuffle([...d,a]);const x=V(a,d,f,[j],"worst");o.push(x),A(n,x.excludes);const g=V(a,d,f,[j,x],"worst");o.push(g),A(n,g.excludes);const b=at(a,d,o);o.push(b),A(n,b.excludes);const S=[o[0],o[1],o[2],o[4],o[3]],O=ut(s[a],m);return{isNsfw:y.nsfw??!1,culpritId:a,statements:S,suspects:d.map(C=>s[C]),reason:O.title,setId:`${a}::${O.id}::${S[0].key}`,level:dt(S)}}const ot=s=>{const t={};console.log("‚öôÔ∏è Calculating suspect answers...");for(const c of Object.keys(s)){const l=s[c];for(const u of Object.keys(l)){const{resolution:m,projection:d}=J(u,l);if(!m&&!d){console.log("‚ÅâÔ∏è Ignoring testimony with no resolution or projection");continue}if(t[c]===void 0&&(t[c]={}),m){t[c][u]=m==="üëç";continue}if(d){t[c][u]=d==="üëç";continue}console.log("‚ÅâÔ∏è Ignoring testimony with not enough values")}}return Object.keys(t).forEach(c=>{v.isEmpty(t[c])&&delete t[c]}),Object.keys(t).forEach(c=>{Object.keys(t[c]).length<3&&(console.log("‚ÅâÔ∏è Removing testimonies with less than 3 answers"),delete t[c])}),Object.keys(t).forEach(c=>{v.uniq(Object.values(t[c])).length===1&&(console.log("‚ÅâÔ∏è Removing testimonies with the same answer"),delete t[c])}),t},it=s=>{const t={};for(const l of Object.keys(s)){const{gender:u,ethnicity:m,age:d,build:o,height:n,features:p}=s[l];if(!o){console.log("‚ÅâÔ∏è Ignoring suspect with missing build",l);continue}if(!n){console.log("‚ÅâÔ∏è Ignoring suspect with missing height",l);continue}if(!p||p.length===0){console.log("‚ÅâÔ∏è Ignoring suspect with missing features",l);continue}t[u]===void 0&&(t[u]={}),t[u][l]=!0,t[m]===void 0&&(t[m]={}),t[m][l]=!0,t[d]===void 0&&(t[d]={}),t[d][l]=!0,t[o]===void 0&&(t[o]={}),t[o][l]=!0,t[n]===void 0&&(t[n]={}),t[n][l]=!0,p.forEach(h=>{t[h]===void 0&&(t[h]={}),t[h][l]=!0})}return t.young=v.cloneDeep(t["18-21"]),t.adult=v.cloneDeep({...t["21-30"],...t["30-40"],...t["40-50"]}),t.senior=v.cloneDeep({...t["50-60"],...t["60-70"],...t["70-80"],...t["80-90"]}),["18-21","21-30","30-40","40-50","50-60","60-70","70-80","80-90","average","medium","mixed","adult","tall"].forEach(l=>{delete t[l]}),t},A=(s,t)=>{t.forEach(c=>{s[c]===void 0&&(s[c]=0),s[c]++})},ct=(s,t,c,l)=>{const u=l[s],m=t.filter(n=>l[n]!==void 0&&l[n]!==u),d=c.answer.charAt(0).toLowerCase()+c.answer.slice(1),o={key:`testimony.${c.id}`,text:`O(a) suspeito(a) ${u?"":"n√£o "}${d}`,excludes:m};return o.text.includes("n√£o j√°")&&(o.text=o.text.replace("n√£o j√°","nunca")),o},U={row1:{indexes:[0,1,2],text:"na primeira linha"},row2:{indexes:[3,4,5],text:"na segunda linha"},row3:{indexes:[6,7,8],text:"na terceira linha"},column1:{indexes:[0,3,6],text:"na primeira coluna"},column2:{indexes:[1,4,7],text:"na segunda coluna"},column3:{indexes:[2,5,8],text:"na terceira coluna"},corners:{indexes:[0,2,6,8],text:"nos cantos"}},at=(s,t,c)=>{const l=t.indexOf(s),u=c.slice(0,3),m={};for(const r of Object.keys(U)){const{indexes:a}=U[r];a.includes(l)||(m[r]=a.reduce((i,f)=>{const y=t[f],j=u.filter(x=>x.excludes.includes(y)).length;return j>0?i+j:i},0))}const d=Object.entries(m).reduce((r,[a,i])=>(r[i]||(r[i]=[]),r[i].push(a),r),{}),o=Math.min(...Object.keys(m).map(r=>m[r])),n=d[o.toString()],p=v.sample(n)||Object.keys(m)[0],h=U[p].indexes.map(r=>t[r]);return{key:`not.grid.${p}`,text:`O(a) suspeito(a) n√£o est√° ${U[p].text}`,excludes:h}},V=(s,t,c,l=[],u="best")=>{const m=v.difference(t,[s]),d=l.filter(f=>f.key.startsWith("not.feature.")).map(f=>f.key.replace("not.feature.","")),o=new Set(l.flatMap(f=>f.excludes)),n=Object.keys(c).filter(f=>Object.keys(c[f]).length<=6&&!d.includes(f)).sort((f,y)=>Object.keys(c[y]).length-Object.keys(c[f]).length);let p,h=[],r=0;const a=500;for(;r<a;){r++;const f=u==="best"?n[0]:v.sample(n.slice(2,5))??n[2];if(!f)break;const y=m.filter(x=>c[f][x]);if(y.some(x=>!o.has(x))||r===a){p=f,h=y;break}n.splice(n.indexOf(f),1)}if(!p)throw Error(`No suitable feature found for ${u} selection after ${a} attempts`);console.log(`Selected feature after ${r} attempts: ${p}`);const i=tt[p];return i||console.warn(`Feature ${p} not found in translations`),{key:`not.feature.${p}`,text:`O(a) suspeito(a) n√£o ${i||p}`,excludes:h}},lt=s=>{const t=s.slice(0,3);return t.reduce((u,m)=>u+m.excludes.length,0)<10?!1:new Set(t.flatMap(u=>u.excludes)).size===Q-1},ut=(s,t)=>{const c=[];Object.values(t).forEach(u=>{var m;u.feature==="general"&&c.push(u),(m=s.features)!=null&&m.includes(u.feature)&&c.push(u)});const l=v.sample(c);return l||{id:"unknown",title:{pt:"Motivo desconhecido",en:"Unknown reason"},feature:"general"}},dt=s=>{const t=s.slice(0,3),c=[],l={1:4,2:3,3:3,4:2,5:2,6:1,7:0,8:0};t.forEach(m=>{const d=m.excludes.length;l[d]!==void 0&&c.push(l[d])});const u=Math.round(c.reduce((m,d)=>m+d,0)/c.length);return Math.min(Math.max(u,1),3)};function ht(){const[s,t]=w.useState({batchSize:1,history:{}}),c=w.useRef(1),{entries:l}=st(!0,"pt",s.batchSize,s.history);return e.jsxs(k,{vertical:!0,gap:12,className:"p-4",children:[e.jsxs(k,{justify:"space-between",align:"center",children:[e.jsx(T.Title,{level:4,className:"my-0",children:"Espionagem Simulator"}),e.jsxs(k,{gap:6,children:[e.jsx(De,{min:1,max:7,defaultValue:1,onChange:u=>{c.current=u??1}}),e.jsx(I,{type:"primary",onClick:()=>t({batchSize:c.current,history:{}}),children:"Re-run Simulation"})]})]}),e.jsx(mt,{entries:l})]})}function mt({entries:s}){const[t,c]=w.useState(!1),l=Me(),u=s[l],m=w.useMemo(()=>u?u.statements.slice(0,3).reduce((d,o)=>{const{excludes:n}=o;return n.forEach(p=>{d[p]?d[p]++:d[p]=1}),d},{}):{},[u]);return e.jsxs("div",{className:"full-width grid grid-2",children:[e.jsx(ke,{src:s??{},theme:"twilight",collapsed:3}),u&&e.jsxs(k,{gap:18,className:"p-4",children:[e.jsx("div",{children:e.jsx("div",{style:{width:`${105*3}px`,display:"grid",gap:"6px",gridTemplateColumns:"repeat(3, 1fr)"},children:u.suspects.map(d=>e.jsxs(te.Ribbon,{text:t?m[d.id]:null,color:"cyan",children:[e.jsx(z,{id:G(d.id,"gb"),width:96,className:ue(t&&d.id===u.culpritId&&"red-border")},d.id),e.jsxs(k,{gap:6,align:"center",children:[e.jsx(B,{checkedChildren:"üö´",size:"small"})," ",d.id]})]},d.id))})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(B,{checkedChildren:"Show Culprit",unCheckedChildren:"Hide Culprit",checked:t,onChange:c})}),u.statements.map((d,o)=>e.jsx(T.Paragraph,{children:e.jsx(te,{count:d.excludes.length,color:"cyan",children:e.jsx(je,{message:d.text,banner:!0,type:o<3?"info":"error"},d.key)})},d.key))]})]})]})}function xe({suspect:s,values:t,resolution:c,projection:l,yesPercentage:u,noPercentage:m,complete:d,enoughData:o,testimonyId:n,addEntryToUpdate:p,answers:h,barWidth:r,showName:a}){const i=x=>{const g={...h};g[x]=[...g[x]||[],3],p(n,g)},f=x=>{const g={...h};g[x]=[...g[x]||[],-3],p(n,g)},y=x=>{var S;const g={...h},b=(S=g[x])==null?void 0:S.findIndex(O=>O===3);b!==-1&&b!==void 0&&(g[x]=[...g[x].slice(0,b),...g[x].slice(b+1)]),p(n,g)},j=x=>{var S;const g={...h},b=(S=g[x])==null?void 0:S.findIndex(O=>O===-3);b!==-1&&b!==void 0&&(g[x]=[...g[x].slice(0,b),...g[x].slice(b+1)]),p(n,g)};return e.jsxs(be,{trigger:"click",title:`Add strong fit/unfit answer to ${s.name.pt}`,content:e.jsxs(k,{vertical:!0,gap:4,children:[e.jsx(T.Text,{type:"secondary",children:t.join(", ")}),e.jsxs(I,{icon:"üëç",block:!0,onClick:()=>i(s.id),children:[" ","Add strong fit"]}),e.jsxs(I,{icon:"üëé",block:!0,onClick:()=>f(s.id),children:[" ","Add strong unfit"]}),e.jsxs($.Compact,{children:[e.jsx(I,{icon:"‚ùå",size:"small",block:!0,onClick:()=>y(s.id),children:"fit"}),e.jsx(I,{icon:"‚ùå",size:"small",block:!0,onClick:()=>j(s.id),children:"unfit"})]})]}),children:[a&&e.jsxs("div",{children:[e.jsx(F,{title:s.id,children:s.name.pt})," ",d&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(oe,{style:{color:"gold"}})})]}),e.jsxs(k,{align:"flex-start",gap:12,children:[e.jsx(F,{title:`Values: ${t.join(", ")} : ${c||(l?`${l}*`:"")}`,children:o?e.jsx(se,{percent:m+u,size:[r,20],status:"exception",success:{percent:u},showInfo:!1}):e.jsx(se,{percent:m+u,size:[r,10],status:"exception",success:{percent:u},showInfo:!1})}),!a&&d&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(oe,{style:{color:"gold"}})})]})]})}function ft({suspect:s,answersPerQuestion:t={},questions:c,addEntryToUpdate:l,allAnswers:u}){const{queryParams:m}=D({sortSuspectsBy:"answers"}),d=m.get("sortSuspectsBy")??"answers",o=w.useMemo(()=>{const h=Object.values(c).map(r=>{const a=t[r.id]??{},{enoughData:i,reliable:f,yesPercentage:y,noPercentage:j,blankPercentage:x,values:g,total:b,resolution:S,projection:O,complete:C}=J(s.id,{[s.id]:a});return{id:r.id,question:r,enoughData:i,reliable:f,yesPercentage:y,noPercentage:j,blankPercentage:x,values:g,total:b,resolution:S,projection:O,complete:C}});return d==="answers"?v.orderBy(h,["reliable","enoughData","yesPercentage",r=>r.values.length],["desc","desc","desc","desc"]):v.orderBy(h,r=>Number(r.id.split("-")[1]),["asc"])},[t,c,s.id,d]),n=w.useMemo(()=>pt(s,o),[s,o]),p=[{key:"id",title:"Id",dataIndex:"id"},{key:"question",title:"Question",dataIndex:"question",render:h=>h.question},{key:"answer",title:"Answer",dataIndex:"id",sorter:(h,r)=>h.total-r.total,render:h=>{const r=o.find(a=>a.id===h);return r?e.jsx(k,{gap:8,wrap:"nowrap",children:e.jsx(xe,{values:r.values,resolution:r.resolution,projection:r.projection,yesPercentage:r.yesPercentage,noPercentage:r.noPercentage,complete:r.complete,enoughData:r.enoughData,suspect:s,testimonyId:r.question.id,answers:u[r.question.id]||{},addEntryToUpdate:l,barWidth:120})}):""}}];return e.jsxs($,{wrap:!0,size:"large",children:[e.jsx(X,{rowKey:"id",columns:p,dataSource:o,bordered:!0}),e.jsxs(k,{gap:8,vertical:!0,children:[e.jsx(T.Title,{level:5,children:"Suspect Description"}),e.jsx(Ae.TextArea,{value:n,readOnly:!0,className:"full-width",rows:7})]})]})}const pt=(s,t)=>{const c=t.filter(l=>l.resolution||l.projection).map(l=>{const{question:u,resolution:m,projection:d}=l,o=m||d;return`${s.gender==="male"?"ele":"ela"} ${o==="üëç"?"":"n√£o "}${u.answer.toLocaleLowerCase()}`});return`${s.name.pt}: ${c.join(", ")}`};function gt({isLoading:s,isSuccess:t,questions:c,data:l,suspects:u,addEntryToUpdate:m}){const{queryParams:d,addParam:o}=D(),n=w.useMemo(()=>Object.keys(l).reduce((i,f)=>{const y=l[f]??{};return Object.keys(y).forEach(j=>{i[j]||(i[j]={}),i[j][f]=y[j]}),i},{}),[l]),p=w.useMemo(()=>v.orderBy(Object.values(u).map(i=>({...i,answers:n[i.id]})),i=>Number(i.id.split("-")[1]),"asc"),[u,n]),h=he({total:p.length,showQuickJumper:!0}),r=[{title:"Id",dataIndex:"id",key:"id",sorter:(i,f)=>Number(i.id.split("-")[1])-Number(f.id.split("-")[1])},{title:"Picture",dataIndex:"id",render:i=>e.jsx(z,{id:G(i,"gb"),width:48})},{title:"Name",dataIndex:"name",key:"name",sorter:(i,f)=>i.name.pt.localeCompare(f.name.pt),render:(i,f)=>e.jsxs(k,{vertical:!0,children:[e.jsx(T.Text,{children:i.pt}),e.jsx(T.Text,{type:"secondary",children:i.en}),e.jsx(T.Text,{type:"secondary",italic:!0,children:e.jsx("small",{children:f.note})})]})},{title:"Questions Answered",dataIndex:"answers",key:"answers",sorter:(i,f)=>Object.keys(i.answers??{}).length-Object.keys(f.answers??{}).length,render:i=>i?Object.values(i).length:""}],a=de({maxExpandedRows:1,expandedRowRender:i=>e.jsx(ft,{suspect:i,answersPerQuestion:n[i.id],questions:c,addEntryToUpdate:m,allAnswers:l}),rowExpandable:()=>t});return e.jsxs(k,{gap:12,className:"full-width py-4",vertical:!0,children:[e.jsxs(k,{justify:"space-between",align:"center",children:[e.jsx(T.Title,{level:4,className:"my-0",children:"Testimonies by Suspect"}),e.jsx(B,{checked:d.get("sortSuspectsBy")==="answers",onChange:i=>o("sortSuspectsBy",i?"answers":"id"),checkedChildren:"Sort by Answers",unCheckedChildren:"Sort by Id"})]}),e.jsx(X,{columns:r,dataSource:p,pagination:h,rowKey:"id",expandable:a,loading:s,bordered:!0,className:"full-width"})]})}function xt({answers:s,suspects:t,addEntryToUpdate:c,testimonyId:l}){const[u,m]=Fe(12),{queryParams:d,is:o}=D({sortSuspectsBy:"answers"}),n=o("enableBatch"),p=d.get("sortSuspectsBy")??"answers",h=w.useMemo(()=>{const i=Object.keys(t).map(f=>J(f,s));return p==="answers"?v.orderBy(i,["reliable","enoughData",f=>f.values.length,"yesPercentage","noPercentage",f=>Number(f.suspectCardId.split("-")[1])],["desc","desc","desc","desc","desc","asc"]):v.orderBy(i,f=>Number(f.suspectCardId.split("-")[1]),["asc"])},[s,t,p]),[r,a]=w.useState([]);return e.jsxs($,{direction:"vertical",children:[e.jsx(jt,{selection:r,setSelection:a,suspects:t,addEntryToUpdate:c,list:h,testimonyId:l,answers:s}),e.jsx($,{wrap:!0,ref:m,size:"large",children:h.map(i=>e.jsxs(k,{vertical:!0,gap:6,className:ue({"selection-outline":n&&r.includes(i.suspectCardId)}),children:[e.jsx(z,{id:i.imageId,width:u,className:i.values.length>1?void 0:"grayscale"}),e.jsxs(k,{gap:4,children:[n&&e.jsx(me,{disabled:i.complete,checked:r.includes(i.suspectCardId),onChange:f=>{const y=f.target.checked;a(j=>y?[...j,i.suspectCardId]:j.filter(x=>x!==i.suspectCardId))}}),e.jsx(xe,{values:i.values,resolution:i.resolution,projection:i.projection,yesPercentage:i.yesPercentage,noPercentage:i.noPercentage,complete:i.complete,enoughData:i.enoughData,suspect:t[i.suspectCardId],testimonyId:l,answers:s,addEntryToUpdate:c,barWidth:u,showName:!0})]})]},i.suspectCardId))})]})}function jt({testimonyId:s,selection:t,setSelection:c,suspects:l,addEntryToUpdate:u,list:m,answers:d}){const[o,n]=w.useState([]),{addParam:p,removeParam:h,is:r}=D({sortSuspectsBy:"answers"}),a=r("enableBatch"),i=j=>{n(x=>x.includes(j)?x.filter(g=>g!==j):[...x,j])},f=w.useMemo(()=>v.keyBy(m,"suspectCardId"),[m]);w.useEffect(()=>{if(o.length===0&&t.length>0){c([]);return}if(!o.length)return;const x=(t.length>0?t:Object.values(f).filter(g=>!g.complete&&!g.values.includes(3)&&!g.values.includes(-3)).map(g=>g.suspectCardId)).filter(g=>{const b=l[g],S=[b.gender,b.ethnicity,b.build,b.height];return b.age==="18-21"&&S.push("young"),(b.age==="21-30"||b.age==="30-40")&&S.push("adult"),b.age==="40-50"&&S.push("parent"),(b.age==="50-60"||b.age==="60-70"||b.age==="70-80"||b.age==="80-90")&&S.push("senior"),o.every(O=>S.includes(O))});c(x)},[o]);const y=j=>{const x=v.cloneDeep(d);t.forEach(g=>{x[g]=[...x[g]||[],j]}),u(s,x),n([])};return e.jsxs(k,{align:"center",gap:6,justify:"space-between",className:"mb-4",children:[e.jsxs(k,{gap:3,children:[e.jsx(T.Text,{className:"nowrap",style:{minWidth:"5ch"},children:"Batch"}),e.jsx(B,{value:a,checkedChildren:"On",unCheckedChildren:"Off",onChange:j=>{j?p("enableBatch",!0):h("enableBatch")}})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(T.Text,{className:"nowrap mr-2",children:["Selected ",t.length]}),e.jsxs(k,{gap:6,wrap:!0,align:"center",justify:"center",children:[e.jsx(M,{filter:"male",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"female",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"young",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"adult",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"parent",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"senior",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"thin",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"muscular",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"large",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"asian",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"black",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"caucasian",activeFilters:o,updateActiveFilter:i}),e.jsx(M,{filter:"latino",activeFilters:o,updateActiveFilter:i})]}),e.jsxs(k,{align:"center",gap:6,children:[e.jsx(I,{onClick:()=>n([]),danger:!0,size:"small",children:"Clear"}),e.jsx(ne,{title:"Apply +3 to selected suspects?",onConfirm:()=>y(3),children:e.jsx(I,{disabled:t.length===0,size:"small",type:"primary",className:"ml-10",children:"Apply +3"})}),e.jsx(le,{type:"vertical"}),e.jsx(ne,{title:"Apply -3 to selected suspects?",onConfirm:()=>y(-3),children:e.jsx(I,{disabled:t.length===0,size:"small",type:"primary",children:"Apply -3"})})]})]})]})}function M({filter:s,activeFilters:t,updateActiveFilter:c}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[e.jsx(me,{checked:t.includes(s),onClick:()=>c(s)})," ",v.capitalize(s)]}),e.jsx(le,{type:"vertical"})]})}function bt({data:s,questions:t,suspects:c,isLoading:l,isSuccess:u,addEntryToUpdate:m}){const{queryParams:d,addParam:o}=D(),n=w.useMemo(()=>v.orderBy(Object.values(t).map(a=>({...a,answersCount:Object.values(s[a.id]??{}).length})),a=>Number(a.id.split("-")[1]),"asc"),[t]),p=he({total:n.length,showQuickJumper:!0}),h=[{title:"Id",dataIndex:"id",key:"id",sorter:(a,i)=>Number(a.id.split("-")[1])-Number(i.id.split("-")[1])},{title:"Question",dataIndex:"question",key:"question",sorter:(a,i)=>a.question.localeCompare(i.question)},{title:"NSFW",dataIndex:"nsfw",key:"nsfw",render:a=>a?e.jsx(Be,{style:{color:"hotPink"}}):"",sorter:(a,i)=>Number(a.nsfw)-Number(i.nsfw)},{title:"Answers",dataIndex:"answersCount",key:"answersCount",sorter:(a,i)=>a.answersCount-i.answersCount}],r=de({maxExpandedRows:1,expandedRowRender:a=>e.jsx(xt,{testimonyId:a.id,answers:s[a.id]??{},suspects:c,addEntryToUpdate:m}),rowExpandable:()=>u});return e.jsxs(k,{gap:12,className:"full-width py-4",vertical:!0,children:[e.jsxs(k,{justify:"space-between",align:"center",children:[e.jsx(T.Title,{level:4,className:"my-0",children:"Suspects by Testimony"}),e.jsx(B,{checked:d.get("sortSuspectsBy")==="answers",onChange:a=>o("sortSuspectsBy",a?"answers":"id"),checkedChildren:"Sort by Answers",unCheckedChildren:"Sort by Id"})]}),e.jsx(X,{columns:h,dataSource:n,pagination:p,rowKey:"id",expandable:r,loading:l,bordered:!0,className:"full-width"})]})}function yt(s){const{queryParams:t,is:c}=D();return e.jsxs(e.Fragment,{children:[(c("display","questions")||!t.get("display"))&&e.jsx(bt,{...s}),c("display","suspects")&&e.jsx(gt,{...s}),c("display","simulator")&&e.jsx(ht,{})]})}const wt="Left",vt="Right",St="Up",kt="Down",P={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},W={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},ie="mousemove",ce="mouseup",Ot="touchend",Ct="touchmove",Et="touchstart";function Tt(s,t,c,l){return s>t?c>0?vt:wt:l>0?kt:St}function ae(s,t){if(t===0)return s;const c=Math.PI/180*t,l=s[0]*Math.cos(c)+s[1]*Math.sin(c),u=s[1]*Math.cos(c)-s[0]*Math.sin(c);return[l,u]}function It(s,t){const c=h=>{const r="touches"in h;r&&h.touches.length>1||s((a,i)=>{i.trackMouse&&!r&&(document.addEventListener(ie,l),document.addEventListener(ce,d));const{clientX:f,clientY:y}=r?h.touches[0]:h,j=ae([f,y],i.rotationAngle);return i.onTouchStartOrOnMouseDown&&i.onTouchStartOrOnMouseDown({event:h}),Object.assign(Object.assign(Object.assign({},a),W),{initial:j.slice(),xy:j,start:h.timeStamp||0})})},l=h=>{s((r,a)=>{const i="touches"in h;if(i&&h.touches.length>1)return r;if(h.timeStamp-r.start>a.swipeDuration)return r.swiping?Object.assign(Object.assign({},r),{swiping:!1}):r;const{clientX:f,clientY:y}=i?h.touches[0]:h,[j,x]=ae([f,y],a.rotationAngle),g=j-r.xy[0],b=x-r.xy[1],S=Math.abs(g),O=Math.abs(b),C=(h.timeStamp||0)-r.start,N=Math.sqrt(S*S+O*O)/(C||1),R=[g/(C||1),b/(C||1)],E=Tt(S,O,g,b),K=typeof a.delta=="number"?a.delta:a.delta[E.toLowerCase()]||P.delta;if(S<K&&O<K&&!r.swiping)return r;const L={absX:S,absY:O,deltaX:g,deltaY:b,dir:E,event:h,first:r.first,initial:r.initial,velocity:N,vxvy:R};L.first&&a.onSwipeStart&&a.onSwipeStart(L),a.onSwiping&&a.onSwiping(L);let Z=!1;return(a.onSwiping||a.onSwiped||a[`onSwiped${E}`])&&(Z=!0),Z&&a.preventScrollOnSwipe&&a.trackTouch&&h.cancelable&&h.preventDefault(),Object.assign(Object.assign({},r),{first:!1,eventData:L,swiping:!0})})},u=h=>{s((r,a)=>{let i;if(r.swiping&&r.eventData){if(h.timeStamp-r.start<a.swipeDuration){i=Object.assign(Object.assign({},r.eventData),{event:h}),a.onSwiped&&a.onSwiped(i);const f=a[`onSwiped${i.dir}`];f&&f(i)}}else a.onTap&&a.onTap({event:h});return a.onTouchEndOrOnMouseUp&&a.onTouchEndOrOnMouseUp({event:h}),Object.assign(Object.assign(Object.assign({},r),W),{eventData:i})})},m=()=>{document.removeEventListener(ie,l),document.removeEventListener(ce,d)},d=h=>{m(),u(h)},o=(h,r)=>{let a=()=>{};if(h&&h.addEventListener){const i=Object.assign(Object.assign({},P.touchEventOptions),r.touchEventOptions),f=[[Et,c,i],[Ct,l,Object.assign(Object.assign({},i),r.preventScrollOnSwipe?{passive:!1}:{})],[Ot,u,i]];f.forEach(([y,j,x])=>h.addEventListener(y,j,x)),a=()=>f.forEach(([y,j])=>h.removeEventListener(y,j))}return a},p={ref:h=>{h!==null&&s((r,a)=>{if(r.el===h)return r;const i={};return r.el&&r.el!==h&&r.cleanUpTouch&&(r.cleanUpTouch(),i.cleanUpTouch=void 0),a.trackTouch&&h&&(i.cleanUpTouch=o(h,a)),Object.assign(Object.assign(Object.assign({},r),{el:h}),i)})}};return t.trackMouse&&(p.onMouseDown=c),[p,o]}function Mt(s,t,c,l){return!t.trackTouch||!s.el?(s.cleanUpTouch&&s.cleanUpTouch(),Object.assign(Object.assign({},s),{cleanUpTouch:void 0})):s.cleanUpTouch?t.preventScrollOnSwipe!==c.preventScrollOnSwipe||t.touchEventOptions.passive!==c.touchEventOptions.passive?(s.cleanUpTouch(),Object.assign(Object.assign({},s),{cleanUpTouch:l(s.el,t)})):s:Object.assign(Object.assign({},s),{cleanUpTouch:l(s.el,t)})}function Dt(s){const{trackMouse:t}=s,c=w.useRef(Object.assign({},W)),l=w.useRef(Object.assign({},P)),u=w.useRef(Object.assign({},l.current));u.current=Object.assign({},l.current),l.current=Object.assign(Object.assign({},P),s);let m;for(m in P)l.current[m]===void 0&&(l.current[m]=P[m]);const[d,o]=w.useMemo(()=>It(n=>c.current=n(c.current,l.current),{trackMouse:t}),[t]);return c.current=Mt(c.current,l.current,u.current,o),d}function Nt(s){const{addParam:t}=D();return e.jsxs(k,{vertical:!0,gap:8,children:[e.jsx(I,{onClick:()=>t("testify","single"),block:!0,children:"Testify Drawer"}),e.jsx(I,{onClick:()=>t("testify","group"),block:!0,children:"Testify Group"}),e.jsx(Rt,{...s}),e.jsx(Pt,{...s})]})}function Rt({suspects:s,questions:t,answers:c,addEntryToUpdate:l}){var x;const{width:u,height:m}=fe(),{is:d,removeParam:o}=D(),[n,p,h]=ge(),r=Dt({onSwipedLeft:()=>alert("Swiped Left"),onSwipedRight:()=>alert("Swiped Right"),onSwipedUp:()=>alert("Swiped Up"),preventScrollOnSwipe:!0,trackTouch:!0,trackMouse:!0}),a=()=>{p({suspectId:v.sample(Object.keys(s))||null,testimonyId:v.sample(Object.keys(t))||null})},i=()=>{a()},f=()=>{if(n!=null&&n.suspectId&&(n!=null&&n.testimonyId)){const g=v.cloneDeep(c[(n==null?void 0:n.testimonyId)??""]??{});g[n.suspectId]=[...g[n.suspectId]||[],1],l(n.testimonyId??"",g),a()}},y=()=>{if(n!=null&&n.suspectId&&(n!=null&&n.testimonyId)){const g=v.cloneDeep(c[(n==null?void 0:n.testimonyId)??""]??{});g[n.suspectId]=[...g[n.suspectId]||[],0],l(n.testimonyId??"",g),a()}},j=!!(n!=null&&n.suspectId)&&!!(n!=null&&n.testimonyId);return e.jsx(pe,{title:e.jsx(T,{children:"Does this person do this??"}),open:d("testify","single"),onCancel:()=>o("testify"),maskClosable:!1,width:u-64,footer:null,children:e.jsxs("div",{...r,children:[j&&e.jsxs(k,{vertical:!0,gap:8,className:"mb-8",justify:"center",align:"center",children:[e.jsx(z,{id:G(n.suspectId??"","gb"),width:Math.max(m/4,128)}),e.jsx(T.Title,{level:5,className:"text-center",children:(x=t[n.testimonyId??""])==null?void 0:x.question})]}),e.jsxs($.Compact,{block:!0,size:"large",className:"mb-8",children:[e.jsx(I,{block:!0,icon:"üëé",disabled:!j,style:{height:64},onClick:y,children:"No"}),e.jsx(I,{block:!0,onClick:i,style:{height:64},children:"Skip"}),e.jsx(I,{block:!0,icon:"üëç",iconPosition:"end",disabled:!j,style:{height:64},onClick:f,children:"Yes"})]})]})})}function Pt({suspects:s,questions:t,answers:c,addEntryToUpdate:l}){var y;const{width:u,height:m}=fe(),{is:d,removeParam:o}=D(),[n,p,h]=ge(),r=()=>{var x;const j=(x=v.sampleSize(Object.keys(s),6))==null?void 0:x.reduce((g,b)=>(g[b]=null,g),{});p({suspectsIds:j,testimonyId:v.sample(Object.keys(t))||null})};ye(()=>r());const a=()=>{const j=Object.entries((n==null?void 0:n.suspectsIds)??{}).reduce((x,[g,b])=>(b!==null&&(x[g]=[b]),x),{});if(n!=null&&n.testimonyId&&Object.keys(j).length>0){const x=v.cloneDeep(c[n.testimonyId]??{});Object.entries(j).forEach(([g,b])=>{x[g]=[...x[g]||[],...b]}),l(n.testimonyId,x)}else console.log("No testimonyId or no judged suspects found, likely skipped");r()},i=!!(n!=null&&n.suspectsIds)&&!!(n!=null&&n.testimonyId),f=j=>{p(x=>{if(!x)return x;const g=Object.entries(x.suspectsIds).reduce((b,[S,O])=>(b[S]=O===null?j:O,b),{});return{...x,suspectsIds:g}})};return e.jsx(pe,{title:e.jsx(T,{children:"Do these people do this??"}),open:d("testify","group"),onCancel:()=>o("testify"),maskClosable:!1,width:u-64,footer:null,children:e.jsxs("div",{children:[i&&e.jsxs(k,{vertical:!0,gap:8,className:"mb-8",justify:"center",align:"center",children:[e.jsx(T.Title,{level:4,className:"text-center",children:(y=t[n.testimonyId??""])==null?void 0:y.question}),e.jsx(k,{wrap:"wrap",justify:"center",gap:8,children:Object.keys(n.suspectsIds).map(j=>{var x,g;return e.jsxs(k,{justify:"center",align:"center",vertical:!0,children:[e.jsx(T.Text,{className:"text-center",children:((g=(x=s[j])==null?void 0:x.name)==null?void 0:g.pt)||"Unknown"}),e.jsx(z,{id:G(j,"gb"),width:Math.min(Math.max(m/3,128),128)},j),e.jsx(Ne,{shape:"round",size:"large",value:n.suspectsIds[j],onChange:b=>p(S=>S&&{...S,suspectsIds:{...S.suspectsIds,[j]:b}}),options:[{value:0,icon:"üëé"},{value:null,icon:"‚ôæ"},{value:1,icon:"üëç"}]})]},j)})})]}),e.jsxs(k,{justify:"space-between",align:"center",className:"mt-8",children:[e.jsx("span",{}),e.jsxs(k,{gap:8,children:[e.jsx(I,{onClick:()=>f(0),children:"Set all ‚ôæ to üëé"}),e.jsx(I,{onClick:()=>f(1),children:"Set all ‚ôæ to üëç"})]}),e.jsx(I,{onClick:a,size:"large",children:"Next Set"})]})]})})}function At({suspects:s,questions:t,data:c,hasNewData:l,isDirty:u,save:m,isSaving:d,entriesToUpdate:o,addEntryToUpdate:n}){const{queryParams:p,addParams:h}=D(),r=w.useMemo(()=>{const a={};return Object.values(c).forEach(i=>{Object.keys(i).forEach(f=>{i[f]&&(a[f]||(a[f]=0),Oe(i[f])>=5&&(a[f]+=1))})}),{queriedTestimoniesCount:Object.keys(c).length,suspectsCount:Object.keys(a).length,reliableSuspectsCount:Object.values(a).filter(i=>i>=5).length}},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsxs(k,{vertical:!0,gap:12,children:[e.jsx($e,{isDirty:u,onSave:m,isSaving:d,dirt:JSON.stringify(o)}),e.jsx(Pe,{data:async()=>await Ft(c),fileName:"testimony-answers.json",disabled:u,hasNewData:l,block:!0}),e.jsx(re,{path:"data/testimonies",className:"text-center",label:"Firestore Data"}),e.jsx(re,{path:"tdr/testimonies",className:"text-center",label:"Firestore TDR"})]})}),e.jsx(q,{children:e.jsx(Re,{label:"Display",value:p.get("display")??"questions",onChange:a=>h({display:a,page:1},{page:1}),options:[{title:"Questions",icon:e.jsx(Ue,{}),value:"questions"},{title:"Suspects",icon:e.jsx(Xe,{}),value:"suspects"},{title:"Simulator",icon:e.jsx(Ke,{}),value:"simulator"}]})}),e.jsx(q,{children:e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Legend"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Reliability: At least 5 votes"}),e.jsx("li",{children:"Large Bars: There's enough data (at least 3)"}),e.jsx("li",{children:"Small blue bar: in progress negative"})]})]})}),e.jsxs(q,{children:[e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Counts"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Testimonies: ",r.queriedTestimoniesCount]}),e.jsxs("li",{children:["Suspects: ",r.suspectsCount]}),e.jsx("li",{children:e.jsxs(F,{title:"A reliable suspect is one that has at least 5 complete testimonies.",children:["Reliable suspects: ",r.reliableSuspectsCount]})})]})]}),e.jsx(Nt,{suspects:s,questions:t,answers:c,addEntryToUpdate:n})]})]})}async function Ft(s){console.log("Preparing file for download...x");const t=await ze("data","testimonies")(),c=Le(t);console.log("Parsed data from Firestore:",c);const l=v.cloneDeep(s);return Object.keys(l).forEach(u=>{const m=l[u],d=c[u]||{};Object.keys(m).forEach(o=>{const n=d[o]||[],p=et([...m[o],...n]);m[o]=p})}),He(qe(l))}function Ms(){const s=Ce();return e.jsx(we,{title:"Testimonies",subtitle:"Suspect Testimony Rates",children:e.jsxs(ee,{hasSider:!0,children:[e.jsx(Se,{children:e.jsx(At,{...s})}),e.jsx(ee.Content,{className:"content",children:e.jsx(ve,{isLoading:s.isLoading,error:s.error,hasResponseData:!v.isEmpty(s.data),children:e.jsx(yt,{...s})})})]})})}export{Ms as TestimoniesPage,Ms as default};
