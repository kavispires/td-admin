import{r as f,d as _,_ as $,j as e,h as J,F as h,b as M,T as N,B as I,A as B,D as U,P as A,L as O}from"./index-CsgmwHyW.js";import{u as T}from"./useQueryParams-BqsldgXn.js";import{a as W,l as u,c as D,P as H}from"./useBaseUrl-CRxBEO9b.js";import{D as S}from"./EditableFields-CY8XDpAJ.js";import{C as E}from"./CopyToClipboardButton-DgKDCWdb.js";import{u as L}from"./useCopyToClipboardFunction-BI92N6cF.js";import{u as P}from"./useTableExpandableRows-B3YPFxBs.js";import{u as F}from"./useTablePagination-Cajjnpvv.js";import{I as K}from"./Item-DDHbwSS1.js";import{T as V}from"./index-CaiKr38c.js";import{F as k}from"./Table-bIXy2Q9L.js";import{S as C}from"./index--7HWKyV7.js";import{T as q}from"./index-_vcJZCZs.js";import{F as G,b as X}from"./FilterEntries-DyHRftxR.js";import{S as Y}from"./SiderContent-BrRpWSWC.js";import{D as j}from"./DownloadButton-Du2HdLtU.js";import{S as g}from"./SaveButton-W04LH8yx.js";import{a as R}from"./index-9JNB4XNR.js";import{R as Z}from"./SkinOutlined-hoOXhKCJ.js";import{R as Q}from"./EnvironmentOutlined-Z5qdlgls.js";import{D as ee}from"./DataLoadingWrapper-BFWbexwr.js";import{u as v}from"./useResourceFirestoreData-B3Wpxo8v.js";import{u as ae}from"./useTDResource-CRrzaN5b.js";import"./LanguageFlag-DOI2l5ag.js";import"./index-Bj849glB.js";import"./IdcardOutlined-uVaAxxY-.js";import"./PlusOutlined-BBfpqrZ4.js";import"./index-BuWHstUX.js";import"./index-B7viPXJq.js";import"./index-BtL9kCd0.js";import"./index-DQaIwiz1.js";import"./scrollTo-BYD3n1q3.js";import"./Pagination-wqlIur5x.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-CVw_-fGV.js";import"./constants-B1x9IXBe.js";import"./useGetFirestoreDoc-zhQK89uj.js";import"./useUpdateFirestoreDoc-DRrAqKdh.js";import"./useMutation-By0ede59.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"},ie=function(i,s){return f.createElement(_,$({},i,{ref:s,icon:te}))},se=f.forwardRef(ie);function re({item:a,cardWidth:i,activeColor:s,isSelected:o=!1,className:n=""}){const{getUrl:c}=W("images"),d=`back/crime${u.capitalize(a.type)}`;return a.itemId?e.jsxs("div",{className:D("crime-item-card",`crime-item-card--${a.type}`,o&&"crime-item-card--selected",n),style:{width:i,backgroundImage:`url(${c(`${d}.jpg`)})`,...s&&o?{borderColor:s,backgroundColor:s}:{}},children:[e.jsx(J,{content:e.jsxs(e.Fragment,{children:[a.name.pt," | ",a.name.en]}),children:e.jsx("div",{className:"crime-item-card__name",style:{maxWidth:`${i}px`},children:e.jsx("span",{children:a.name.en})})}),e.jsx("div",{className:D("crime-item-card__item-container",`crime-item-card__item-container--${a.type}`),children:e.jsx(K,{className:"crime-item-card__item",itemId:a.itemId,width:i*.75})})]}):e.jsx(e.Fragment,{children:a.id})}function ne({rows:a,onUpdateCard:i,weapons:s,evidence:o,locations:n,victims:c,scenes:d}){const{queryParams:m,addParams:r}=T(),t=m.get("type"),l=[{key:"all",label:"All",children:e.jsx(y,{onUpdateCard:i,rows:a,scenes:d})},{key:"weapons",label:"Weapons",children:e.jsx(y,{onUpdateCard:i,rows:s,scenes:d})},{key:"evidence",label:"Evidence",children:e.jsx(y,{onUpdateCard:i,rows:o,scenes:d})},{key:"locations",label:"Locations",children:e.jsx(y,{onUpdateCard:i,rows:n,scenes:d})},{key:"victims",label:"Victims",children:e.jsx(y,{onUpdateCard:i,rows:c,scenes:d})}],p=x=>{r({type:x,page:"1"})};return e.jsx("div",{className:"my-4",children:e.jsx(V,{defaultActiveKey:t||"all",items:l,onChange:p})})}function y({rows:a,onUpdateCard:i,scenes:s}){const o=L(),n=F({total:a.length,showQuickJumper:!0}),c=(t,l,p)=>{const x=u.cloneDeep(p);x.name[l]=t,i(x)},d=[k.EXPAND_COLUMN,{title:"Id",dataIndex:"id",key:"id",render:t=>e.jsxs("span",{children:[t,e.jsx(E,{content:t})]}),sorter:(t,l)=>t.id.localeCompare(l.id)},{title:"Card",dataIndex:"itemId",key:"itemId",render:(t,l)=>e.jsxs(h,{align:"center",gap:8,children:[e.jsx(re,{cardWidth:70,item:l}),e.jsx("div",{children:e.jsx(M,{defaultValue:l.itemId,onBlur:p=>{if(console.log(p?.target?.value),console.log("onBlur"),p?.target?.value&&p?.target?.value!==l.itemId){const x=u.cloneDeep(l);x.itemId=p?.target?.value,i(x)}},size:"small"})})]})},{title:"Name",dataIndex:"name",key:"name",sorter:(t,l)=>t.name.en.localeCompare(l.name.en),render:(t,l)=>e.jsxs(C,{direction:"vertical",style:{minWidth:150},children:[e.jsx(S,{language:"en",onPressEnter:p=>c(p.target?.value||l.name.en,"en",l),value:t}),e.jsx(S,{language:"pt",onPressEnter:p=>c(p.target?.value||l.name.pt,"pt",l),value:t})]})},{title:"Type",dataIndex:"type",key:"type",render:t=>e.jsx("span",{children:t}),sorter:(t,l)=>t.type.localeCompare(l.type)}],m=P({maxExpandedRows:1,expandedRowRender:t=>e.jsx(oe,{card:t,scenes:s})}),r=()=>{if(n){const{current:t=1,pageSize:l=10}=n,p=a.slice((t-1)*l,t*l),x=[];p.forEach((w,z)=>{x.push(`${z+1}) ${w.name.en}}`)}),console.log(x),o(x.join(`
`))}};return e.jsxs("div",{className:"my-4",children:[e.jsxs(C,{className:"mb-4",children:[e.jsxs(N,{children:[a.length," cards total"]}),e.jsx(I,{onClick:r,children:"Copy Page Cards"})]}),e.jsx(k,{columns:d,dataSource:a,expandable:m,pagination:n,rowKey:"id"})]})}function oe({card:a,scenes:i}){return e.jsxs("div",{children:[e.jsx(N.Title,{level:5,children:"Scene Likelihood"}),e.jsx("div",{className:"likelihood",children:Object.values(i).map(s=>{const[o,n]=a.likelihood?.[s.id]??[],c=o!==void 0,d=s.values?.[o]?.en,m=n!==void 0,r=s.values?.[n]?.en;return e.jsxs("div",{className:"likelihood-entry",children:[e.jsx("div",{className:"bold",children:s.title.en}),e.jsx("div",{className:D("likely-result",{"likely-result--no-data":!c||!d}),children:d||"No most likely value"}),e.jsx("div",{className:D("likely-result--2",{"likely-result--no-data":!m||!r}),children:r||"No second most likely value"})]},s.id)})})]})}function le({sceneQuery:a,objects:i}){const s=L(),o=Object.values(a.data??[]),n=F({total:o.length,showQuickJumper:!0}),c=r=>{const t=[];t.push(`"${r.description.en}"`),r.values.forEach((l,p)=>{t.push(`${p}) ${l.en}`)}),s(t.join(`
`))},d=[{title:"Id",dataIndex:"id",key:"id",render:r=>e.jsxs("span",{children:[r,e.jsx(E,{content:r})]}),sorter:(r,t)=>r.id.localeCompare(t.id)},{title:"Title",dataIndex:"title",key:"title",render:(r,t)=>e.jsxs(C,{direction:"vertical",style:{minWidth:150},children:[e.jsx(S,{language:"en",readOnly:!0,value:t.title}),e.jsx(S,{language:"pt",readOnly:!0,value:t.title})]})},{title:"Type",dataIndex:"type",key:"type",render:r=>e.jsx("span",{children:r}),sorter:(r,t)=>r.type.localeCompare(t.type)},k.EXPAND_COLUMN,{title:"Options",dataIndex:"values",key:"tags",render:(r,t)=>e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>c(t),children:"Copy options"}),e.jsx("ul",{children:r.map(l=>e.jsx("li",{children:e.jsxs(N,{children:[l.en," / ",l.pt]})},l.en))})]})}],m=P({maxExpandedRows:1,expandedRowRender:r=>e.jsx(de,{objects:i,scene:r})});return e.jsxs("div",{className:"my-4",children:[e.jsx(N.Title,{className:"my-0",level:2,children:"Scenes"}),e.jsx(k,{columns:d,dataSource:o,expandable:m,pagination:n,rowKey:"id"})]})}function de({scene:a,objects:i}){const s=f.useMemo(()=>{let o=0;const n={};return i.forEach(d=>{if(d.likelihood?.[a.id]){const r=d.likelihood[a.id][0];n[r]=(n[r]||0)+1,o+=1}}),Object.entries(n).map(([d,m])=>({value:d,percentage:m/o*100}))},[i,a.id]);return e.jsxs("div",{children:[e.jsxs("h3",{children:[a.title.en," / ",a.title.pt]}),e.jsx("ul",{children:s.map(({value:o,percentage:n})=>e.jsxs("li",{children:[e.jsx(q,{children:a.values[Number(o)].en})," ",n.toFixed(2),"%"]},o))})]})}function ce({weaponsQuery:a,evidenceQuery:i,scenesQuery:s,locationsQuery:o,victimsQuery:n}){const{is:c,queryParams:d}=T(),m=f.useMemo(()=>[...Object.values(a.data),...Object.values(i.data),...Object.values(o.data),...Object.values(n.data)],[a.data,i.data,o.data,n.data]),r=t=>{if(t.type==="weapon")a.addEntryToUpdate(t.id,t);else if(t.type==="evidence")i.addEntryToUpdate(t.id,t);else throw new Error("Invalid card type")};return e.jsxs(e.Fragment,{children:[(c("display","cards")||!d.has("display"))&&e.jsx(ne,{evidence:Object.values(i.data),locations:Object.values(o.data),onUpdateCard:r,rows:m,scenes:s.data,victims:Object.values(n.data),weapons:Object.values(a.data)}),c("display","tags")&&e.jsx(B,{closable:!0,message:"Tags table is not implemented yet",showIcon:!0,type:"info"}),c("display","scenes")&&e.jsx(le,{objects:m,sceneQuery:s})]})}function me({weaponsQuery:a,evidenceQuery:i,scenesQuery:s,locationsQuery:o,victimsQuery:n}){const{queryParams:c,addParam:d,addParams:m,is:r}=T();return e.jsxs(Y,{children:[e.jsxs(h,{gap:12,vertical:!0,children:[e.jsxs(h,{gap:6,children:[e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Weapons"}),e.jsx(g,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(j,{block:!0,data:()=>b(a.data),disabled:a.isDirty,fileName:"crime-weapons.json",hasNewData:a.hasFirestoreData,children:"JSON"})]}),e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Evidence"}),e.jsx(g,{dirt:JSON.stringify(i.entriesToUpdate),isDirty:i.isDirty,isSaving:i.isSaving,onSave:i.save,size:"middle"}),e.jsx(j,{block:!0,data:()=>b(i.data),disabled:i.isDirty,fileName:"crime-evidence.json",hasNewData:i.hasFirestoreData,children:"JSON"})]})]}),e.jsxs(h,{gap:6,children:[e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Locations"}),e.jsx(g,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(j,{block:!0,data:()=>b(o.data),disabled:a.isDirty,fileName:"crime-locations.json",hasNewData:a.hasFirestoreData,children:"JSON"})]}),e.jsxs(h,{gap:6,vertical:!0,children:[e.jsx("span",{children:"Victims"}),e.jsx(g,{dirt:JSON.stringify(a.entriesToUpdate),isDirty:a.isDirty,isSaving:a.isSaving,onSave:a.save,size:"middle"}),e.jsx(j,{data:()=>b(n.data),disabled:a.isDirty,fileName:"crime-victims.json",hasNewData:a.hasFirestoreData,children:"JSON"})]})]}),e.jsx("span",{children:"Scenes"}),e.jsx(g,{dirt:JSON.stringify(s.entriesToUpdate),isDirty:s.isDirty,isSaving:s.isSaving,onSave:s.save}),e.jsx(j,{block:!0,data:()=>pe(s.data),disabled:s.isDirty,fileName:"crime-scenes.json",hasNewData:s.hasFirestoreData})]}),e.jsx(U,{}),e.jsx(G,{label:"Display",onChange:t=>m({display:t,page:1},{page:1}),options:[{title:"Cards",icon:e.jsx(Z,{}),value:"cards"},{title:"Tags",icon:e.jsx(se,{}),value:"tags"},{title:"Scenes",icon:e.jsx(Q,{}),value:"scenes"}],value:c.get("display")??"listing"}),r("display","item")&&e.jsx(X,{label:"No Groups Only",onChange:t=>d("emptyOnly",t,!1),value:r("emptyOnly")})]})}function b(a){console.log("Preparing file for download...");const i=u.cloneDeep(a);return Object.values(i).forEach(s=>{s.likelihood||(s.likelihood={})}),R(i)}function pe(a){console.log("Preparing scenes file for download...");const i=u.cloneDeep(a);return R(i)}function Ze(){const a=v({tdrResourceName:"crime-weapons",firestoreDataCollectionName:"crimeWeapons",serialize:!0}),i=v({tdrResourceName:"crime-evidence",firestoreDataCollectionName:"crimeEvidence",serialize:!0}),s=v({tdrResourceName:"crime-locations",firestoreDataCollectionName:"crimeLocations",serialize:!0}),o=v({tdrResourceName:"crime-victims",firestoreDataCollectionName:"crimeVictims",serialize:!0}),n=v({tdrResourceName:"crime-scenes",firestoreDataCollectionName:"crimeScenes",serialize:!0}),c=ae("items");return f.useEffect(()=>{const d=Object.values(n.data).map(m=>({id:m.id,title:m.title.en,description:m.description.en,values:m.values.map(r=>r.en)}));u.isEmpty(d)||console.log("Slim Scenes for GPT:",d)},[n.data]),e.jsx(A,{subtitle:"Categorizer",title:"Crimes Hediondos",children:e.jsxs(O,{hasSider:!0,children:[e.jsx(H,{children:e.jsx(me,{evidenceQuery:i,locationsQuery:s,scenesQuery:n,victimsQuery:o,weaponsQuery:a})}),e.jsx(O.Content,{className:"content",children:e.jsx(ee,{error:a.error||i.error||n.error||c.error||s.error||o.error,hasResponseData:!u.isEmpty(a.data)&&!u.isEmpty(i.data)&&!u.isEmpty(n.data)&&!u.isEmpty(s.data)&&!u.isEmpty(o.data)&&!u.isEmpty(c.data),isLoading:a.isLoading||i.isLoading||n.isLoading||s.isLoading||o.isLoading||c.isLoading,children:e.jsx(ce,{evidenceQuery:i,locationsQuery:s,scenesQuery:n,victimsQuery:o,weaponsQuery:a})})})]})})}export{Ze as default};
