import{r as p,j as t,T as j,B as S,D as N,P as F,L as v}from"./index-CTqAsA_o.js";import{D as L}from"./DataLoadingWrapper-Dk0jKqZ1.js";import{u as b}from"./useQueryParams-DqPkNU1y.js";import{l as u,P as O}from"./useBaseUrl-CfIxsWS4.js";import{I as E}from"./Item-CcptkV8V.js";import{u as w}from"./useCopyToClipboardFunction-DPTOY0LV.js";import{u as C}from"./useTDResource-DyzOjZyK.js";import{u as M}from"./useTableExpandableRows-DD_wfO95.js";import{u as k}from"./useTablePagination-Cqi3XmqR.js";import{r as R,a as A}from"./index-CYoT0uSg.js";import{I as B}from"./ItemsTypeahead-C3yAwN3-.js";import{u as H}from"./useDailyHistoryQuery-Ji22Ik-B.js";import{u as Q,L as $}from"./constants-DwHqX6no.js";import{F as f}from"./Table-BMQsW9r8.js";import{S as x}from"./index-J20xQDFc.js";import{F as h}from"./index-CqyweTda.js";import{P as Y}from"./index-B4tBgGMB.js";import{R as G}from"./DeleteFilled-9lqSzjCh.js";import{T as _}from"./Typeahead-d1wcwIWD.js";import{c as J}from"./FilterEntries-DKUgjbtn.js";import{S as K}from"./SiderContent-B0McUjmA.js";import{D as X}from"./DownloadButton-CL9t0Pp_.js";import{S as W}from"./SaveButton-UbZtJZGF.js";import{u as z}from"./useResourceFirestoreData-DCuPlNlD.js";import"./constants-COkG863P.js";import"./useDebounce-rFkX6Q5o.js";import"./index-BAMR3jpG.js";import"./index-CGHZ3ZJ-.js";import"./index-BSqbKlSi.js";import"./Input-BkRdKyg_.js";import"./useGetFirestoreDoc-CwTsKYwp.js";import"./moment-C5S46NFB.js";import"./index-ZuSYxOkb.js";import"./index-CBE_GNRC.js";import"./index-DEdHXK8i.js";import"./scrollTo-De5D9bdo.js";import"./Pagination-Cs6cIB1f.js";import"./extendsObject-keMuGWqj.js";import"./gapSize-U1swVQyS.js";import"./index-jT5de-T3.js";import"./index-BI9BNfae.js";import"./SaveOutlined-C-KNcU5w.js";import"./useUpdateFirestoreDoc-Cb71gbZb.js";import"./useMutation-BlHvKcpM.js";function q(){const e=$.DAILY.pt,s=H(e,{enabled:!0}),[r]=Q("filmaco",s.data);return p.useMemo(()=>u.mapValues(u.keyBy((r==null?void 0:r.used)??[]),()=>!0),[r])}function D({rows:e,addEntryToUpdate:s}){const r=w(),a=C("items"),o=q(),l=k({total:e.length,showQuickJumper:!0}),m=[{title:"Title",dataIndex:"title",render:(n,i)=>t.jsx(y,{property:"title",value:n,movie:i,addEntryToUpdate:s}),sorter:(n,i)=>n.title.localeCompare(i.title)},{title:"Year",dataIndex:"year",render:(n,i)=>t.jsx(y,{property:"year",value:n,movie:i,addEntryToUpdate:s}),sorter:(n,i)=>n.year-i.year},f.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(n,i)=>t.jsx(T,{movie:i,itemsIds:n,copyToClipboard:r,addEntryToUpdate:s}),sorter:(n,i)=>n.itemsIds.length-i.itemsIds.length},{title:"Count",dataIndex:"itemsIds",render:n=>R(n).filter(Boolean).length},{title:"Used",dataIndex:"id",render:n=>o[n]?"Yes":"No",sorter:(n,i)=>o[n.id]&&!o[i.id]?-1:!o[n.id]&&o[i.id]?1:i.itemsIds.length-n.itemsIds.length}],c=M({maxExpandedRows:1,expandedRowRender:n=>t.jsx(P,{movie:n,addEntryToUpdate:s}),rowExpandable:()=>a.isSuccess});return t.jsx(f,{columns:m,rowKey:"id",dataSource:e,expandable:c,pagination:l})}function P({movie:e,addEntryToUpdate:s}){const r=a=>{s(e.id,{...e,itemsIds:[...e.itemsIds,a]})};return t.jsx("div",{children:t.jsx(B,{onFinish:r})})}function Z({movie:e,addEntryToUpdate:s,itemId:r}){const a=()=>{s(e.id,{...e,itemsIds:e.itemsIds.filter(o=>o!==r)})};return t.jsx(Y,{title:"Are you sure you want to remove this item?",onConfirm:a,okText:"Yes",cancelText:"No",children:t.jsx(S,{icon:t.jsx(G,{}),size:"small",type:"text"})})}function T({movie:e,itemsIds:s,copyToClipboard:r,addEntryToUpdate:a}){return t.jsx(h,{gap:6,wrap:"wrap",children:s.map((o,l)=>t.jsxs(h,{gap:2,vertical:!0,children:[t.jsx(E,{id:o,width:60}),t.jsxs(h,{justify:"center",children:[t.jsx(j.Text,{onClick:()=>r(o),children:o}),t.jsx(Z,{movie:e,addEntryToUpdate:a,itemId:o})]})]},`${e.title}-${o}-${l}`))},`items-${e.title}`)}function y({value:e,movie:s,addEntryToUpdate:r,property:a}){const o=l=>typeof e=="number"?l!==String(e)?r(s.id,{...s,[a]:Number(l)}):null:l!==e?r(s.id,{...s,[a]:l.trim()}):null;return t.jsx(x,{children:t.jsx(j.Text,{editable:{onChange:o},children:String(e)})})}function U(e){return u.orderBy(e,[s=>s.title]).map(s=>({...s,itemsIds:u.orderBy(s.itemsIds,r=>Number(r))}))}function V({data:e,addEntryToUpdate:s}){const{is:r}=b(),a=r("emptyOnly"),o=p.useMemo(()=>{const m=e?U(Object.values(e)):[];return a?m.filter(c=>c.itemsIds.length===0):m},[a]),l=o.filter(m=>m.itemsIds.length>0).length;return t.jsxs(x,{direction:"vertical",children:[t.jsxs(j.Title,{level:5,children:["Total Movies: ",o.length," | Complete Movies: ",l]}),t.jsx(D,{rows:o,addEntryToUpdate:s})]})}function ee({data:e,addEntryToUpdate:s}){const[r,a]=p.useState(null),o=p.useMemo(()=>r?e[r]:null,[r,e]);return t.jsxs(x,{direction:"vertical",children:[t.jsx(j.Title,{level:5,children:"Search Movie"}),t.jsx(_,{data:e,onFinish:l=>a(l),placeholder:"Search movie by title...",parser:te,style:{width:"100%",minWidth:450}}),!!o&&t.jsx(D,{rows:[o],addEntryToUpdate:s})]})}const te=e=>Object.values(e??{}).reduce((s,r)=>(s[`${r.title} (${r.year})`]=r.id,s),{});function se({data:e,save:s,isDirty:r,isSaving:a,entriesToUpdate:o,hasFirestoreData:l}){const{is:m,addParam:c}=b();return t.jsxs(K,{children:[t.jsxs(h,{vertical:!0,gap:12,children:[t.jsx(W,{isDirty:r,onSave:s,isSaving:a,dirt:JSON.stringify(o)}),t.jsx(X,{data:()=>re(e),fileName:"daily-movie-sets.json",disabled:r,hasNewData:l,block:!0})]}),t.jsx(N,{}),t.jsx(J,{label:"Pending Only",value:m("emptyOnly"),onChange:n=>c("emptyOnly",n,!1)})]})}function re(e){return A(e)}const g=30;function ie({data:e,addEntryToUpdate:s}){const[r,a]=p.useState(null),o=C("items"),l=w(),m=()=>{var I;let i=u.sample(Object.keys(e??{})),d=0;for(;d<g&&(((I=e[String(i)])==null?void 0:I.itemsIds)??[]).length>0;)i=u.sample(Object.keys(e??{})),d++;if(d>=g)return console.warn("Could not find a sample with no itemsIds");a(i??null)},c=[{title:"Title",dataIndex:"title",render:(i,d)=>t.jsx(y,{property:"title",value:i,movie:d,addEntryToUpdate:s})},{title:"Year",dataIndex:"year",render:(i,d)=>t.jsx(y,{property:"year",value:i,movie:d,addEntryToUpdate:s})},f.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(i,d)=>t.jsx(T,{movie:d,itemsIds:i,copyToClipboard:l,addEntryToUpdate:s})},{title:"Count",dataIndex:"itemsIds",render:i=>R(i).filter(Boolean).length}],n=M({maxExpandedRows:1,expandedRowRender:i=>t.jsx(P,{movie:i,addEntryToUpdate:s}),rowExpandable:()=>o.isSuccess});return t.jsxs(x,{direction:"vertical",className:"my-4",children:[t.jsx(S,{onClick:m,children:"Get Random Movie"}),r&&t.jsx(f,{columns:c,rowKey:"id",dataSource:[e[r]],expandable:n,pagination:!1},String(r))]})}function ze(){const e=z({tdrResourceName:"daily-movie-sets",firestoreDataCollectionName:"movieSets"});return t.jsx(F,{title:"Items",subtitle:"Movie Sets",children:t.jsxs(v,{hasSider:!0,children:[t.jsx(O,{children:t.jsx(se,{...e})}),t.jsx(v.Content,{className:"content",children:t.jsx(L,{isLoading:e.isLoading,error:e.error,hasResponseData:!u.isEmpty(e.data),children:t.jsxs(x,{direction:"vertical",children:[t.jsx(ee,{...e}),t.jsx(ie,{...e}),t.jsx(V,{...e})]})})})]})})}export{ze as ItemsMovieSets,ze as default};
