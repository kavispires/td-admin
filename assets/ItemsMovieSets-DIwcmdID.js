import{j as e,D as S,r as I,T as g,B as b,P as F,L as v}from"./index-CiF5--2a.js";import{D as R}from"./DataLoadingWrapper-DcZ8aPWb.js";import{c as T}from"./FilterEntries-C4iDCHm7.js";import{S as L}from"./SiderContent-CroB5yCP.js";import{D as O}from"./DownloadButton-BlsojvSw.js";import{S as k}from"./SaveButton-s1jXsG7T.js";import{u as C}from"./useQueryParams-BPSENYYW.js";import{a as B,r as w}from"./index-B70_2-pz.js";import{F as f}from"./index-C2UcdlrS.js";import{u as D}from"./useCopyToClipboardFunction-CmOOqtYG.js";import{u as N}from"./useTDResource-BEVaMQKZ.js";import{l as c}from"./lodash-D0O7dYQ-.js";import{I as A}from"./Item-n7HVLcpj.js";import{u as E}from"./useTablePagination-CpF-MMCU.js";import{I as Q}from"./ItemsTypeahead-D-t1j6Wc.js";import{u as Y}from"./useDailyHistoryQuery-DAWdmMAI.js";import{u as G,L as $}from"./constants-CY8Bm70P.js";import{F as h}from"./Table-mDpHyuoe.js";import{S as j}from"./index-0mQ0wxZD.js";import{P as H}from"./index-bwOVXcX6.js";import{R as J}from"./DeleteFilled-BRL6vp_5.js";import{P as K}from"./useBaseUrl-CgXHlTLh.js";import{u as X}from"./useResourceFirebaseData-CQQ-E8Rm.js";import"./index-B1eqNN9Q.js";import"./index-BjA8dbFX.js";import"./index-DK7iRz0b.js";import"./index-BiZXzEtx.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-0vKyCLNP.js";import"./constants-B4FgzbO3.js";import"./gapSize-U1swVQyS.js";import"./useDebounce-CP0-fpHx.js";import"./index-Df8Fa_h3.js";import"./Input-C-KfAM2p.js";import"./useGetFirebaseDoc-DwdkTEca.js";import"./index-DoNNsqTe.js";import"./index-CpJD0T27.js";import"./scrollTo-BaPpjTa9.js";import"./Pagination-bheZeHQM.js";import"./extendsObject-keMuGWqj.js";import"./useUpdateFirebaseDoc-ThYrHW5R.js";import"./useMutation-B2Ymi21Q.js";function _({data:t,save:s,isDirty:i,isSaving:l,entriesToUpdate:o,hasFirestoreData:m}){const{is:u,addParam:p}=C();return e.jsxs(L,{children:[e.jsxs(f,{vertical:!0,gap:12,children:[e.jsx(k,{isDirty:i,onSave:s,isSaving:l,dirt:JSON.stringify(o)}),e.jsx(O,{data:()=>z(t),fileName:"daily-movie-sets.json",disabled:i,hasNewData:m,block:!0})]}),e.jsx(S,{}),e.jsx(T,{label:"Pending Only",value:u("emptyOnly"),onChange:n=>p("emptyOnly",n,!1)})]})}function z(t){return B(t)}function W(){const t=$.DAILY.pt,s=Y(t,{enabled:!0}),[i]=G("filmaco",s.data);return I.useMemo(()=>c.mapValues(c.keyBy((i==null?void 0:i.used)??[]),()=>!0),[i])}function q(t){return c.orderBy(t,[s=>s.title]).map(s=>({...s,itemsIds:c.orderBy(s.itemsIds,i=>Number(i))}))}function Z({data:t,addEntryToUpdate:s}){const i=D(),l=N("items"),o=W(),{is:m}=C(),u=m("emptyOnly"),p=I.useMemo(()=>{const r=t?q(Object.values(t)):[];return u?r.filter(a=>a.itemsIds.length===0):r},[t,u]),n=p.filter(r=>r.itemsIds.length>0).length,d=E({total:p.length,showQuickJumper:!0}),x=[{title:"Title",dataIndex:"title",render:(r,a)=>e.jsx(y,{property:"title",value:r,movie:a,addEntryToUpdate:s}),sorter:(r,a)=>r.title.localeCompare(a.title)},{title:"Year",dataIndex:"year",render:(r,a)=>e.jsx(y,{property:"year",value:r,movie:a,addEntryToUpdate:s}),sorter:(r,a)=>r.year-a.year},h.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(r,a)=>e.jsx(P,{movie:a,itemsIds:r,copyToClipboard:i,addEntryToUpdate:s}),sorter:(r,a)=>r.itemsIds.length-a.itemsIds.length},{title:"Count",dataIndex:"itemsIds",render:r=>w(r).filter(Boolean).length},{title:"Used",dataIndex:"id",render:r=>o[r]?"Yes":"No",sorter:(r,a)=>o[r.id]&&!o[a.id]?-1:!o[r.id]&&o[a.id]?1:a.itemsIds.length-r.itemsIds.length}];return e.jsxs(j,{direction:"vertical",children:[e.jsxs(g.Title,{level:5,children:["Total Movies: ",p.length," | Complete Movies: ",n]}),e.jsx(h,{columns:x,rowKey:"id",dataSource:p,expandable:{expandedRowRender:r=>e.jsx(M,{movie:r,addEntryToUpdate:s}),rowExpandable:()=>l.isSuccess},pagination:d})]})}function M({movie:t,addEntryToUpdate:s}){const i=l=>{s(t.id,{...t,itemsIds:[...t.itemsIds,l]})};return e.jsx("div",{children:e.jsx(Q,{onFinish:i})})}function U({movie:t,addEntryToUpdate:s,itemId:i}){const l=()=>{s(t.id,{...t,itemsIds:t.itemsIds.filter(o=>o!==i)})};return e.jsx(H,{title:"Are you sure you want to remove this item?",onConfirm:l,okText:"Yes",cancelText:"No",children:e.jsx(b,{icon:e.jsx(J,{}),size:"small",type:"text"})})}function P({movie:t,itemsIds:s,copyToClipboard:i,addEntryToUpdate:l}){return e.jsx(f,{gap:6,wrap:"wrap",children:s.map((o,m)=>e.jsxs(f,{gap:2,vertical:!0,children:[e.jsx(A,{id:o,width:60}),e.jsxs(f,{justify:"center",children:[e.jsx(g.Text,{onClick:()=>i(o),children:o}),e.jsx(U,{movie:t,addEntryToUpdate:l,itemId:o})]})]},`${t.title}-${o}-${m}`))},`items-${t.title}`)}function y({value:t,movie:s,addEntryToUpdate:i,property:l}){const o=m=>typeof t=="number"?m!==String(t)?i(s.id,{...s,[l]:Number(m)}):null:m!==t?i(s.id,{...s,[l]:m.trim()}):null;return e.jsx(j,{children:e.jsx(g.Text,{editable:{onChange:o},children:String(t)})})}function V({data:t,addEntryToUpdate:s}){const[i,l]=I.useState(null),o=N("items"),m=D(),u=()=>{var x;let n=c.sample(Object.keys(t??{})),d=0;for(;d<15&&(((x=t[String(n)])==null?void 0:x.itemsIds)??[]).length>0;)n=c.sample(Object.keys(t??{})),d++;if(d>=15)return console.warn("Could not find a sample with no itemsIds");l(n??null)},p=[{title:"Title",dataIndex:"title",render:(n,d)=>e.jsx(y,{property:"title",value:n,movie:d,addEntryToUpdate:s})},{title:"Year",dataIndex:"year",render:(n,d)=>e.jsx(y,{property:"year",value:n,movie:d,addEntryToUpdate:s})},h.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(n,d)=>e.jsx(P,{movie:d,itemsIds:n,copyToClipboard:m,addEntryToUpdate:s})},{title:"Count",dataIndex:"itemsIds",render:n=>w(n).filter(Boolean).length}];return e.jsxs(j,{direction:"vertical",className:"my-4",children:[e.jsx(b,{onClick:u,children:"Get Sample"}),i&&e.jsx(h,{columns:p,rowKey:"id",dataSource:[t[i]],expandable:{expandedRowRender:n=>e.jsx(M,{movie:n,addEntryToUpdate:s}),rowExpandable:()=>o.isSuccess},pagination:!1},String(i)),e.jsx(S,{})]})}function $e(){const t=X({tdrResourceName:"daily-movie-sets",firebaseDataCollectionName:"movieSets"});return e.jsx(F,{title:"Items",subtitle:"Movie Sets",children:e.jsxs(v,{hasSider:!0,children:[e.jsx(K,{children:e.jsx(_,{...t})}),e.jsx(v.Content,{className:"content",children:e.jsx(R,{isLoading:t.isLoading,error:t.error,hasResponseData:!c.isEmpty(t.data),children:e.jsxs(j,{direction:"vertical",children:[e.jsx(V,{...t}),e.jsx(Z,{...t})]})})})]})})}export{$e as ItemsMovieSets,$e as default};
