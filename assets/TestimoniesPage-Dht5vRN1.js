import{aA as be,r as g,d as $,_ as q,j as e,F as v,T,B as O,A as X,h as we,a4 as F,D as W,b as Y,aB as ce,R as ve,a2 as ae,aC as Se,P as Ce,L as Z}from"./index-UYa7gvm9.js";import{D as ke}from"./DataLoadingWrapper-yokEkxAd.js";import{l as I,P as Oe}from"./useBaseUrl-D2BMet3C.js";import{u as D}from"./useQueryParams-CPeAMa8r.js";import{R as Te}from"./main-CChOWCGm.js";import{c as le}from"./clsx-B-dksMZM.js";import{u as Ie,R as Re}from"./daily-espionagem-Aj1xLJWy.js";import{g as Ne}from"./useParsedHistory-OOnXgLxN.js";import{S as V}from"./SuspectImageCard-mDRi0PEa.js";import{u as _}from"./useTDResource-XnJG3xll.js";import{T as ue,F as De}from"./FilterEntries-D-JXTaVW.js";import{B as U,D as de}from"./DownloadButton-Dvyvtdhr.js";import{S as P}from"./index-B0_FSIQl.js";import{u as he}from"./useTableExpandableRows-D9SaOPpi.js";import{u as me}from"./useTablePagination-DlI61U-z.js";import{P as ee}from"./progress-LrY_zGFy.js";import{S as M}from"./index-Dms-J-ud.js";import{a as pe,c as fe,n as Pe}from"./utils-BWZOtpTJ.js";import{F as K}from"./Table-C4U9K3xJ.js";import{u as Me}from"./useCardWidth-D1h3RiH7.js";import{C as je}from"./index-DkFnb52_.js";import{P as te}from"./index-Cpwgx9YC.js";import{F as L,R as Ee}from"./ExpandOutlined-Bwh1pc0l.js";import{S as Q}from"./SiderContent-Y-PFCLec.js";import{F as Fe,a as Ae}from"./FirestoreConsoleLink-C7b_6J7S.js";import{S as Be}from"./SaveButton-DZSaG13l.js";import{S as ze}from"./SuspectsStyleVariantSelector-Bsz_vd7W.js";import{g as Le}from"./useGetFirestoreDoc-IeJ8HST5.js";import{j as $e,a as qe,i as Ve}from"./index-kClm2eDY.js";import{u as xe}from"./useWindowSize-D-XQLzyU.js";import{S as He}from"./index-CEhXfORy.js";import{R as Qe}from"./TableOutlined-s6zSO3y9.js";import{R as Ue}from"./RobotOutlined-DTp2-wMi.js";import{u as We}from"./useResourceFirestoreData-DMLUFMw0.js";import"./moment-BYTvHWBW.js";import"./ImageCard-DAKvgHxk.js";import"./index-BlGpxOEt.js";import"./index-DuGi4Wsy.js";import"./index-Bgx_-Mnu.js";import"./scrollTo-DN7aPsgL.js";import"./Pagination-CrRBUB2H.js";import"./VerticalAlignTopOutlined-ZLGSjS59.js";import"./throttleByAnimationFrame-BTrWr6Dt.js";import"./FileTextOutlined-D7-Dh9A0.js";import"./useMutation-BcVw4weU.js";import"./SaveOutlined-0-Zdi6vB.js";import"./constants-Dk6iEZEz.js";import"./Item-9HGj4Z30.js";import"./useUpdateFirestoreDoc-SR_azcYj.js";function Ye(t,r){return typeof t=="function"?t.length?t(r):t():t}function ge(t,r,n){if(r===void 0&&(r=10),r<1)throw new Error("Capacity has to be greater than 1, got '"+r+"'");var c=be(),p=g.useState(t),j=p[0],m=p[1],u=g.useRef([]),a=g.useRef(0);c&&(u.current.length?(u.current[u.current.length-1]!==t&&u.current.push(t),u.current.length>r&&(u.current=u.current.slice(u.current.length-r))):u.current.push(t),a.current=u.current.length&&u.current.length-1);var h=g.useCallback(function(i){m(function(f){return i=Ye(i,f),i!==f&&(a.current<u.current.length-1&&(u.current=u.current.slice(0,a.current+1)),a.current=u.current.push(i)-1,u.current.length>r&&(u.current=u.current.slice(u.current.length-r))),i})},[j,r]),d=g.useMemo(function(){return{history:u.current,position:a.current,capacity:r,back:function(i){i===void 0&&(i=1),a.current&&m(function(){return a.current-=Math.min(i,a.current),u.current[a.current]})},forward:function(i){i===void 0&&(i=1),a.current!==u.current.length-1&&m(function(){return a.current=Math.min(a.current+i,u.current.length-1),u.current[a.current]})},go:function(i){i!==a.current&&m(function(){return a.current=i<0?Math.max(u.current.length+i,0):Math.min(u.current.length-1,i),u.current[a.current]})}}},[j]);return[j,h,d]}var _e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zM464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z"}}]},name:"appstore",theme:"filled"},Ge=function(r,n){return g.createElement($,q({},r,{ref:n,icon:_e}))},Ke=g.forwardRef(Ge),Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm330-170c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1z"}}]},name:"audio",theme:"filled"},Xe=function(r,n){return g.createElement($,q({},r,{ref:n,icon:Je}))},Ze=g.forwardRef(Xe),et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M594.3 601.5a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1 8 8 0 008 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"}}]},name:"contacts",theme:"outlined"},tt=function(r,n){return g.createElement($,q({},r,{ref:n,icon:et}))},st=g.forwardRef(tt),nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M870 126H663.8c-17.4 0-32.9 11.9-37 29.3C614.3 208.1 567 246 512 246s-102.3-37.9-114.8-90.7a37.93 37.93 0 00-37-29.3H154a44 44 0 00-44 44v252a44 44 0 0044 44h75v388a44 44 0 0044 44h478a44 44 0 0044-44V466h75a44 44 0 0044-44V170a44 44 0 00-44-44z"}}]},name:"skin",theme:"filled"},rt=function(r,n){return g.createElement($,q({},r,{ref:n,icon:nt}))},it=g.forwardRef(rt),ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.6 630.2 359 721.8 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.8 758.4 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM248 439.6c-37.1-11.9-64-46.7-64-87.6V232h64v207.6zM840 352c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"filled"},ct=function(r,n){return g.createElement($,q({},r,{ref:n,icon:ot}))},se=g.forwardRef(ct);function at(){const[t,r]=g.useState({batchSize:1,history:{}}),n=g.useRef(1),{entries:c}=Ie(!0,"pt",t.batchSize,t.history),p=_("suspects",!I.isEmpty(c));return console.log(ut(c,p.data??{})),e.jsxs(v,{className:"p-4",gap:12,vertical:!0,children:[e.jsxs(v,{align:"center",justify:"space-between",children:[e.jsx(T.Title,{className:"my-0",level:4,children:"Espionagem Simulator"}),e.jsxs(v,{gap:6,children:[e.jsx(ue,{defaultValue:1,max:100,min:1,onChange:j=>{n.current=j??1}}),e.jsx(O,{onClick:()=>r({batchSize:n.current,history:{}}),type:"primary",children:"Re-run Simulation"})]})]}),e.jsx(lt,{entries:c})]})}function lt({entries:t}){const[r,n]=g.useState(!1),c=Ne(),p=t[c],j=g.useMemo(()=>p?p.statements.reduce((m,u)=>{const{excludes:a}=u;return a.forEach(h=>{m[h]?m[h]++:m[h]=1}),m},{}):{},[p]);return e.jsxs("div",{className:"full-width grid",style:{gridTemplateColumns:"2fr 3fr"},children:[e.jsx(Te,{collapsed:3,src:t??{},theme:"twilight"}),e.jsx("div",{children:p&&e.jsxs(v,{className:"p-4",gap:18,children:[e.jsx("div",{children:e.jsx("div",{style:{width:`${105*4}px`,display:"grid",gap:"6px",gridTemplateColumns:"repeat(4, 1fr)"},children:p.suspects.map(m=>e.jsxs(U.Ribbon,{color:"cyan",text:r?j[m.id]:null,children:[e.jsx(V,{cardId:m.id,cardWidth:96,className:le(r&&m.id===p.culpritId&&"red-border")},m.id),e.jsxs(v,{align:"center",gap:6,children:[e.jsx(P,{checkedChildren:"ðŸš«",size:"small"})," ",m.id]})]},m.id))})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(P,{checked:r,checkedChildren:"Show Culprit",onChange:n,unCheckedChildren:"Hide Culprit"})}),p.statements.map(m=>e.jsx(T.Paragraph,{children:e.jsx(U,{color:"cyan",count:m.excludes.length,children:e.jsx(X,{banner:!0,icon:ne(m.type),message:m.text,type:"info"},m.key)})},m.key)),p.additionalStatements.map(m=>e.jsx(T.Paragraph,{children:e.jsx(U,{color:"cyan",count:m.excludes.length,children:e.jsx(X,{banner:!0,icon:ne(m.type),message:m.text,type:"warning"},m.key)})},m.key))]})]})})]})}const ne=t=>{switch(t){case"testimony":return e.jsx(Ze,{});case"feature":return e.jsx(it,{});case"grid":return e.jsx(Ke,{});default:return"â“"}},ut=(t,r)=>{const n=Object.values(t).reduce((c,p)=>(p.suspects.forEach(j=>{c[j.id]=(c[j.id]||0)+1,j.id===p.culpritId&&(c[`${j.id}_culprit`]=(c[`${j.id}_culprit`]||0)+1)}),c),{});return Object.values(r).forEach(c=>{n[c.id]||(n[c.id]=0),n[`${c.id}_culprit`]||(n[`${c.id}_culprit`]=0)}),n};function ye({suspect:t,values:r,resolution:n,projection:c,yesPercentage:p,noPercentage:j,complete:m,enoughData:u,testimonyId:a,addEntryToUpdate:h,answers:d,barWidth:i,showName:f}){const x=(s,l)=>{const y={...d};y[s]=[...y[s]||[],l],h(a,y)},o=(s,l)=>{const y={...d},S=y[s]?.indexOf(l);S!==-1&&S!==void 0&&(y[s]=[...y[s].slice(0,S),...y[s].slice(S+1)]),h(a,y)};return e.jsxs(we,{content:e.jsxs(v,{align:"center",vertical:!0,children:[e.jsx(T.Text,{type:"secondary",children:r.join(", ")}),e.jsxs(M.Compact,{children:[e.jsx(O,{icon:"+",onClick:()=>x(t.id,1)}),e.jsx(O,{block:!0,icon:"ðŸ‘",onClick:()=>x(t.id,4),children:"Fit"}),e.jsx(O,{icon:"âŒ",onClick:()=>o(t.id,4)}),e.jsx(O,{block:!0,icon:"ðŸ‘Ž",onClick:()=>x(t.id,-4),children:"Unfit"}),e.jsx(O,{icon:"âŒ",onClick:()=>o(t.id,-4)})]}),e.jsx(W,{className:"my-1"}),e.jsxs(M.Compact,{children:[e.jsx(O,{icon:"-",onClick:()=>x(t.id,-1)}),e.jsx(O,{block:!0,icon:"â¬†ï¸",onClick:()=>x(t.id,32),children:"Sure"}),e.jsx(O,{icon:"âœ–ï¸",onClick:()=>o(t.id,32)}),e.jsx(O,{block:!0,icon:"â¬‡ï¸",onClick:()=>x(t.id,-32),children:"Sure"}),e.jsx(O,{icon:"âœ–ï¸",onClick:()=>o(t.id,-32)})]})]}),title:`Add strong fit/unfit answer to ${t.name.pt}`,trigger:"click",children:[f&&e.jsxs("div",{children:[e.jsx(F,{title:t.id,children:t.name.pt})," ",m&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(se,{style:{color:"gold"}})}),!!n&&n]}),e.jsxs(v,{align:"flex-start",gap:12,children:[e.jsx(F,{title:`Values: ${r.join(", ")} : ${n||(c?`${c}*`:"")}`,children:u?e.jsx(ee,{percent:j+p,showInfo:!1,size:[i,20],status:"exception",success:{percent:p}}):e.jsx(ee,{percent:j+p,showInfo:!1,size:[i,10],status:"exception",success:{percent:p}})}),!f&&m&&e.jsx(F,{title:"Complete: It has 5 or more answers",children:e.jsx(se,{style:{color:"gold"}})})]})]})}function dt({suspect:t,answersPerQuestion:r={},questions:n,addEntryToUpdate:c,allAnswers:p}){const{queryParams:j}=D({sortSuspectsBy:"answers"}),m=j.get("sortSuspectsBy")??"answers",[u,a]=g.useState(""),[h,d]=g.useState(!1),i=g.useMemo(()=>{const s=Object.values(n).map(l=>{const y=r[l.id]??{},{enoughData:S,reliable:C,yesPercentage:k,noPercentage:w,blankPercentage:b,values:N,total:B,resolution:z,projection:H,complete:E}=pe(t.id,l.id,{[t.id]:y});return{id:l.id,question:l,enoughData:S,reliable:C,yesPercentage:k,noPercentage:w,blankPercentage:b,values:N,total:B,resolution:z,projection:H,complete:E}});return m==="answers"?I.orderBy(s,["reliable","enoughData","yesPercentage",l=>l.values.length],["desc","desc","desc","desc"]):I.orderBy(s,l=>Number(l.id.split("-")[1]),["asc"])},[r,n,t.id,m]),f=g.useMemo(()=>ht(t,i),[t,i]),x=[{key:"id",title:"Id",dataIndex:"id",width:"7%"},{key:"question",title:"Question",dataIndex:"question",render:s=>s.question},{key:"answer",title:"Answer",dataIndex:"id",width:"170px",sorter:(s,l)=>s.total-l.total,render:s=>{const l=i.find(y=>y.id===s);return l?e.jsx(v,{gap:8,wrap:"nowrap",children:e.jsx(ye,{addEntryToUpdate:c,answers:p[l.question.id]||{},barWidth:120,complete:l.complete,enoughData:l.enoughData,noPercentage:l.noPercentage,projection:l.projection,resolution:l.resolution,suspect:t,testimonyId:l.question.id,values:l.values,yesPercentage:l.yesPercentage})}):""}},{key:"actions",title:"Actions",dataIndex:"id",width:"auto",render:s=>{const l=i.find(y=>y.id===s);return l?e.jsx(mt,{addEntryToUpdate:c,answers:p[l.question.id]||{},suspect:t,testimonyId:l.question.id}):""}}],o=g.useMemo(()=>{let s=i;return u.trim()&&(s=s.filter(l=>l.question.question.toLowerCase().includes(u.toLowerCase())||l.id.toLowerCase().includes(u.toLowerCase()))),h&&(s=s.filter(l=>l.values.reduce((S,C)=>S+Math.abs(C===0?-1:C),0)<=2)),s},[i,u,h]);return e.jsxs(M,{size:"large",wrap:!0,children:[e.jsxs(v,{className:"full-width",gap:16,vertical:!0,children:[e.jsxs(v,{gap:6,children:[e.jsx(Y,{allowClear:!0,onChange:s=>a(s.target.value),placeholder:"Search questions...",prefix:e.jsx(ce,{}),style:{marginBottom:16,width:320},value:u}),e.jsxs(v,{align:"center",gap:8,children:[e.jsx(P,{checked:h,onChange:d}),e.jsx(T.Text,{children:"Show only missing questions"})]})]}),e.jsx(K,{bordered:!0,className:"full-width",columns:x,dataSource:o,rowKey:"id",tableLayout:"fixed"})]}),e.jsxs(v,{gap:8,vertical:!0,children:[e.jsx(T.Title,{level:5,children:"Suspect Description"}),e.jsx(Y.TextArea,{className:"full-width",readOnly:!0,rows:7,value:f})]})]})}const ht=(t,r)=>{const n=r.filter(c=>c.resolution||c.projection).map(c=>{const{question:p,resolution:j,projection:m}=c,u=j||m;return`${t.gender==="male"?"ele":"ela"} ${u==="ðŸ‘"?"":"nÃ£o "}${p.answer.toLocaleLowerCase()}`});return`${t.name.pt}: ${n.join(", ")}`};function mt({suspect:t,testimonyId:r,addEntryToUpdate:n,answers:c}){const p=(u,a)=>{const h={...c};h[u]=[...h[u]||[],a],n(r,h)},j=(u,a)=>{const h={...c},d=h[u]?.indexOf(a);d!==-1&&d!==void 0&&(h[u]=[...h[u].slice(0,d),...h[u].slice(d+1)]),n(r,h)},m=g.useMemo(()=>Object.values(c[t.id]||{}).reduce((u,a)=>u+Math.abs(a===0?-1:a),0),[c,t.id]);return e.jsxs(v,{align:"center",gap:6,wrap:"nowrap",children:[e.jsx(U,{color:m>20?"gold":"grey",count:m,showZero:!0,style:{minWidth:32}}),e.jsxs(M.Compact,{children:[e.jsx(O,{block:!0,icon:"ðŸ‘",onClick:()=>p(t.id,4),children:"FIT"}),e.jsx(O,{icon:"âŒ",onClick:()=>j(t.id,4)}),e.jsx(O,{block:!0,icon:"ðŸ‘Ž",onClick:()=>p(t.id,-4),children:"UNFIT"}),e.jsx(O,{icon:"âŒ",onClick:()=>j(t.id,-4)}),e.jsx(O,{block:!0,icon:"â¬†ï¸",onClick:()=>p(t.id,32),children:"Sure"}),e.jsx(O,{icon:"âœ–ï¸",onClick:()=>j(t.id,32)}),e.jsx(O,{block:!0,icon:"â¬‡ï¸",onClick:()=>p(t.id,-32),children:"Sure"}),e.jsx(O,{icon:"âœ–ï¸",onClick:()=>j(t.id,-32)})]})]})}function pt({isLoading:t,isSuccess:r,questions:n,data:c,suspects:p,addEntryToUpdate:j}){const{queryParams:m,addParam:u}=D(),a=Object.values(n).map(({id:o,question:s})=>({id:o,question:s})),h=g.useMemo(()=>Object.keys(c).reduce((o,s)=>{const l=c[s]??{};return Object.keys(l).forEach(y=>{o[y]||(o[y]={}),o[y][s]=l[y]}),o},{}),[c]),d=g.useMemo(()=>I.orderBy(Object.values(p).map(o=>({...o,answers:h[o.id]})),o=>Number(o.id.split("-")[1]),"asc"),[p,h]),i=me({total:d.length,showQuickJumper:!0}),f=[{title:"Id",dataIndex:"id",key:"id",sorter:(o,s)=>Number(o.id.split("-")[1])-Number(s.id.split("-")[1])},{title:"Picture",dataIndex:"id",render:o=>e.jsx(V,{cardId:o,cardWidth:48})},{title:"Name",dataIndex:"name",key:"name",sorter:(o,s)=>o.name.pt.localeCompare(s.name.pt),render:(o,s)=>e.jsxs(v,{vertical:!0,children:[e.jsx(T.Text,{children:o.pt}),e.jsx(T.Text,{type:"secondary",children:o.en}),e.jsx(T.Text,{italic:!0,type:"secondary",children:e.jsx("small",{children:s.persona.en})})]})},{title:"Questions Answered",dataIndex:"answers",key:"answers",sorter:(o,s)=>Object.keys(o.answers??{}).length-Object.keys(s.answers??{}).length,render:o=>o?Object.values(o).length:""}],x=he({maxExpandedRows:1,expandedRowRender:o=>e.jsx(dt,{addEntryToUpdate:j,allAnswers:c,answersPerQuestion:o.answers,questions:n,suspect:o}),rowExpandable:()=>r});return e.jsxs(v,{className:"full-width py-4",gap:12,vertical:!0,children:[e.jsxs(v,{align:"center",justify:"space-between",children:[e.jsx(T.Title,{className:"my-0",level:4,children:"Testimonies by Suspect"}),e.jsx(de,{data:a,fileName:"newQuestions.json"}),e.jsx(P,{checked:m.get("sortSuspectsBy")==="answers",checkedChildren:"Sort by Answers",onChange:o=>u("sortSuspectsBy",o?"answers":"id"),unCheckedChildren:"Sort by Id"})]}),e.jsx(K,{bordered:!0,className:"full-width",columns:f,dataSource:d,expandable:x,loading:t,pagination:i,rowKey:"id"})]})}function ft({answers:t,suspects:r,addEntryToUpdate:n,testimonyId:c,question:p}){const[j,m]=Me(12),{queryParams:u,is:a}=D({sortSuspectsBy:"answers"}),h=a("enableBatch"),d=u.get("sortSuspectsBy")??"answers",i=g.useMemo(()=>{const o=Object.keys(r).map(s=>pe(s,c,t));return d==="answers"?I.orderBy(o,["reliable","enoughData",s=>s.values.length,"yesPercentage","noPercentage",s=>Number(s.suspectCardId.split("-")[1])],["desc","desc","desc","desc","desc","asc"]):I.orderBy(o,s=>Number(s.suspectCardId.split("-")[1]),["asc"])},[t,r,c,d]),[f,x]=g.useState([]);return e.jsx(M,{direction:"vertical",children:e.jsx(jt,{addEntryToUpdate:n,answers:t,list:i,question:p,selection:f,setSelection:x,suspects:r,testimonyId:c,children:e.jsx(M,{ref:m,size:"large",wrap:!0,children:i.map(o=>e.jsxs(v,{className:le({"selection-outline":h&&f.includes(o.suspectCardId)}),gap:6,vertical:!0,children:[e.jsx(V,{cardId:o.imageId,cardWidth:j,className:o.values.length>1||o.enoughData?void 0:"grayscale"}),e.jsxs(v,{gap:4,children:[h&&e.jsx(je,{checked:f.includes(o.suspectCardId),disabled:o.complete,onChange:s=>{const l=s.target.checked;x(y=>l?[...y,o.suspectCardId]:y.filter(S=>S!==o.suspectCardId))}}),e.jsx(ye,{addEntryToUpdate:n,answers:t,barWidth:j,complete:o.complete,enoughData:o.enoughData,noPercentage:o.noPercentage,projection:o.projection,resolution:o.resolution,showName:!0,suspect:r[o.suspectCardId],testimonyId:c,values:o.values,yesPercentage:o.yesPercentage})]})]},o.suspectCardId))})})})}function jt({question:t,testimonyId:r,selection:n,setSelection:c,suspects:p,addEntryToUpdate:j,list:m,answers:u,children:a}){const[h,d]=g.useState([]),{addParam:i,removeParam:f,is:x}=D({sortSuspectsBy:"answers"}),o=x("enableBatch"),s=C=>{d(k=>k.includes(C)?k.filter(w=>w!==C):[...k,C])},l=g.useMemo(()=>I.keyBy(m,"suspectCardId"),[m]);g.useEffect(()=>{if(h.length===0&&n.length>0){c([]);return}if(!h.length)return;const C=n.length>0?n:Object.values(l).filter(w=>!w.complete&&!w.values.includes(4)&&!w.values.includes(-4)).map(w=>w.suspectCardId);if(h.includes("empty")){const w=Object.values(l).filter(b=>b.values.length===0).map(b=>b.suspectCardId);c(w);return}if(h.includes("incompletePos")){const w=Object.values(l).filter(b=>!b.complete&&b.yesCount<4&&b.yesCount>0&&b.noCount===0).map(b=>b.suspectCardId);c(w);return}if(h.includes("incompleteNeg")){const w=Object.values(l).filter(b=>!b.complete&&b.noCount<4&&b.noCount>0&&b.yesCount===0).map(b=>b.suspectCardId);c(w);return}const k=C.filter(w=>{const b=p[w],N=[b.gender,b.ethnicity,b.build,b.height];return b.age==="18-21"&&N.push("young"),(b.age==="21-30"||b.age==="30-40")&&N.push("adult"),b.age==="40-50"&&N.push("parent"),(b.age==="50-60"||b.age==="60-70"||b.age==="70-80"||b.age==="80-90")&&N.push("senior"),h.every(B=>N.includes(B))});c(k)},[h]);const y=C=>{const k=I.cloneDeep(u);n.forEach(w=>{k[w]=[...k[w]||[],C]}),j(r,k),d([])},S=e.jsxs(e.Fragment,{children:[e.jsxs(T.Text,{className:"nowrap mr-2",children:["Selected ",n.length.toString().padStart(3,"0")]}),e.jsx(v,{align:"center",className:"boxed",gap:6,justify:"center",wrap:!0,children:e.jsx(R,{activeFilters:h,end:!0,filter:"empty",updateActiveFilter:s})}),e.jsxs(v,{align:"center",className:"boxed",gap:6,justify:"center",wrap:!0,children:[e.jsx(R,{activeFilters:h,end:!0,filter:"incompletePos",label:"Incomplete+",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,end:!0,filter:"incompleteNeg",label:"Incomplete-",updateActiveFilter:s})]}),e.jsxs(v,{align:"center",className:"boxed",gap:6,justify:"center",wrap:!0,children:[e.jsx(R,{activeFilters:h,filter:"male",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"female",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"young",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"adult",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"parent",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"senior",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"thin",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"muscular",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"large",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"asian",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"black",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,filter:"caucasian",updateActiveFilter:s}),e.jsx(R,{activeFilters:h,end:!0,filter:"latino",updateActiveFilter:s})]}),e.jsxs(v,{align:"center",gap:6,children:[e.jsx(O,{danger:!0,onClick:()=>d([]),size:"small",children:"Clear"}),e.jsx(te,{onConfirm:()=>y(4),title:"Apply +4 to selected suspects?",children:e.jsx(O,{className:"ml-10",disabled:n.length===0,size:"small",type:"primary",children:"Apply +4"})}),e.jsx(W,{type:"vertical"}),e.jsx(te,{onConfirm:()=>y(-4),title:"Apply -4 to selected suspects?",children:e.jsx(O,{disabled:n.length===0,size:"small",type:"primary",children:"Apply -4"})})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs(v,{align:"center",className:"mb-4",gap:6,justify:"space-between",children:[e.jsxs(v,{gap:3,children:[e.jsx(T.Text,{className:"nowrap",style:{minWidth:"5ch"},children:"Batch"}),e.jsx(P,{checkedChildren:"On",onChange:C=>{C?i("enableBatch",!0):f("enableBatch")},unCheckedChildren:"Off",value:o})]}),o&&S]}),a,o&&e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx(v,{align:"center",className:"mb-4",gap:6,justify:"space-between",children:S})]}),n.length>0&&e.jsxs(L.Group,{shape:"square",style:{insetInlineEnd:94},children:[e.jsx(L,{badge:{count:n.length,color:"green",size:"small"},icon:"ðŸ‘",onClick:()=>y(4),tooltip:{title:t,placement:"left"}}),e.jsx(L,{badge:{count:n.length,color:"red",size:"small"},icon:"ðŸ‘Ž",onClick:()=>y(-4),tooltip:{title:t,placement:"left"}}),e.jsx(L,{icon:e.jsx(Ee,{}),onClick:()=>d([]),tooltip:{title:"Clear selection",placement:"left"}}),e.jsx(L.BackTop,{visibilityHeight:0})]})]})}function R({filter:t,activeFilters:r,updateActiveFilter:n,end:c,label:p}){return e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[e.jsx(je,{checked:r.includes(t),onClick:()=>n(t)})," ",p??I.capitalize(t)]}),!c&&e.jsx(W,{type:"vertical"})]})}function xt({data:t,questions:r,suspects:n,isLoading:c,isSuccess:p,addEntryToUpdate:j}){const{queryParams:m,addParam:u}=D(),[a,h]=g.useState(""),d=g.useMemo(()=>I.orderBy(Object.values(r).map(s=>({...s,answersCount:Object.values(t[s.id]??{}).length})),s=>Number(s.id.split("-")[1]),"asc"),[r]),i=g.useMemo(()=>a.trim()?d.filter(s=>s.question.toLowerCase().includes(a.toLowerCase())||s.id.toLowerCase().includes(a.toLowerCase())):d,[d,a]),f=me({total:i.length,showQuickJumper:!0}),x=[{title:"Id",dataIndex:"id",key:"id",sorter:(s,l)=>Number(s.id.split("-")[1])-Number(l.id.split("-")[1])},{title:"Question",dataIndex:"question",key:"question",sorter:(s,l)=>s.question.localeCompare(l.question)},{title:"NSFW",dataIndex:"nsfw",key:"nsfw",render:s=>s?e.jsx(ve,{style:{color:"hotPink"}}):"",sorter:(s,l)=>Number(s.nsfw)-Number(l.nsfw)},{title:"Answers",dataIndex:"answersCount",key:"answersCount",sorter:(s,l)=>s.answersCount-l.answersCount}],o=he({maxExpandedRows:1,expandedRowRender:s=>e.jsx(ft,{addEntryToUpdate:j,answers:t[s.id]??{},question:s.question,suspects:n,testimonyId:s.id},s.id),rowExpandable:()=>p});return e.jsxs(v,{className:"full-width py-4",gap:12,vertical:!0,children:[e.jsxs(v,{align:"center",justify:"space-between",children:[e.jsx(T.Title,{className:"my-0",level:4,children:"Suspects by Testimony"}),e.jsx(P,{checked:m.get("sortSuspectsBy")==="answers",checkedChildren:"Sort by Answers",onChange:s=>u("sortSuspectsBy",s?"answers":"id"),unCheckedChildren:"Sort by Id"})]}),e.jsxs(v,{gap:6,children:[e.jsx(Y,{allowClear:!0,onChange:s=>h(s.target.value),placeholder:"Search questions by text or ID...",prefix:e.jsx(ce,{}),style:{width:320},value:a}),e.jsx(F,{title:"Set random question",children:e.jsx(O,{icon:e.jsx(Re,{}),onClick:()=>h(I.sample(Object.keys(r))??"")})})]}),e.jsx(K,{bordered:!0,className:"full-width",columns:x,dataSource:i,expandable:o,loading:c,pagination:f,rowKey:"id"})]})}function gt(t){const{queryParams:r,is:n}=D();return e.jsxs(e.Fragment,{children:[(n("display","questions")||!r.get("display"))&&e.jsx(xt,{...t}),n("display","suspects")&&e.jsx(pt,{...t}),n("display","simulator")&&e.jsx(at,{})]})}const yt="Left",bt="Right",wt="Up",vt="Down",A={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},G={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},re="mousemove",ie="mouseup",St="touchend",Ct="touchmove",kt="touchstart";function Ot(t,r,n,c){return t>r?n>0?bt:yt:c>0?vt:wt}function oe(t,r){if(r===0)return t;const n=Math.PI/180*r,c=t[0]*Math.cos(n)+t[1]*Math.sin(n),p=t[1]*Math.cos(n)-t[0]*Math.sin(n);return[c,p]}function Tt(t,r){const n=d=>{const i="touches"in d;i&&d.touches.length>1||t((f,x)=>{x.trackMouse&&!i&&(document.addEventListener(re,c),document.addEventListener(ie,m));const{clientX:o,clientY:s}=i?d.touches[0]:d,l=oe([o,s],x.rotationAngle);return x.onTouchStartOrOnMouseDown&&x.onTouchStartOrOnMouseDown({event:d}),Object.assign(Object.assign(Object.assign({},f),G),{initial:l.slice(),xy:l,start:d.timeStamp||0})})},c=d=>{t((i,f)=>{const x="touches"in d;if(x&&d.touches.length>1)return i;if(d.timeStamp-i.start>f.swipeDuration)return i.swiping?Object.assign(Object.assign({},i),{swiping:!1}):i;const{clientX:o,clientY:s}=x?d.touches[0]:d,[l,y]=oe([o,s],f.rotationAngle),S=l-i.xy[0],C=y-i.xy[1],k=Math.abs(S),w=Math.abs(C),b=(d.timeStamp||0)-i.start,N=Math.sqrt(k*k+w*w)/(b||1),B=[S/(b||1),C/(b||1)],z=Ot(k,w,S,C),H=typeof f.delta=="number"?f.delta:f.delta[z.toLowerCase()]||A.delta;if(k<H&&w<H&&!i.swiping)return i;const E={absX:k,absY:w,deltaX:S,deltaY:C,dir:z,event:d,first:i.first,initial:i.initial,velocity:N,vxvy:B};E.first&&f.onSwipeStart&&f.onSwipeStart(E),f.onSwiping&&f.onSwiping(E);let J=!1;return(f.onSwiping||f.onSwiped||f[`onSwiped${z}`])&&(J=!0),J&&f.preventScrollOnSwipe&&f.trackTouch&&d.cancelable&&d.preventDefault(),Object.assign(Object.assign({},i),{first:!1,eventData:E,swiping:!0})})},p=d=>{t((i,f)=>{let x;if(i.swiping&&i.eventData){if(d.timeStamp-i.start<f.swipeDuration){x=Object.assign(Object.assign({},i.eventData),{event:d}),f.onSwiped&&f.onSwiped(x);const o=f[`onSwiped${x.dir}`];o&&o(x)}}else f.onTap&&f.onTap({event:d});return f.onTouchEndOrOnMouseUp&&f.onTouchEndOrOnMouseUp({event:d}),Object.assign(Object.assign(Object.assign({},i),G),{eventData:x})})},j=()=>{document.removeEventListener(re,c),document.removeEventListener(ie,m)},m=d=>{j(),p(d)},u=(d,i)=>{let f=()=>{};if(d&&d.addEventListener){const x=Object.assign(Object.assign({},A.touchEventOptions),i.touchEventOptions),o=[[kt,n,x],[Ct,c,Object.assign(Object.assign({},x),i.preventScrollOnSwipe?{passive:!1}:{})],[St,p,x]];o.forEach(([s,l,y])=>d.addEventListener(s,l,y)),f=()=>o.forEach(([s,l])=>d.removeEventListener(s,l))}return f},h={ref:d=>{d!==null&&t((i,f)=>{if(i.el===d)return i;const x={};return i.el&&i.el!==d&&i.cleanUpTouch&&(i.cleanUpTouch(),x.cleanUpTouch=void 0),f.trackTouch&&d&&(x.cleanUpTouch=u(d,f)),Object.assign(Object.assign(Object.assign({},i),{el:d}),x)})}};return r.trackMouse&&(h.onMouseDown=n),[h,u]}function It(t,r,n,c){return!r.trackTouch||!t.el?(t.cleanUpTouch&&t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:void 0})):t.cleanUpTouch?r.preventScrollOnSwipe!==n.preventScrollOnSwipe||r.touchEventOptions.passive!==n.touchEventOptions.passive?(t.cleanUpTouch(),Object.assign(Object.assign({},t),{cleanUpTouch:c(t.el,r)})):t:Object.assign(Object.assign({},t),{cleanUpTouch:c(t.el,r)})}function Rt(t){const{trackMouse:r}=t,n=g.useRef(Object.assign({},G)),c=g.useRef(Object.assign({},A)),p=g.useRef(Object.assign({},c.current));p.current=Object.assign({},c.current),c.current=Object.assign(Object.assign({},A),t);let j;for(j in A)c.current[j]===void 0&&(c.current[j]=A[j]);const[m,u]=g.useMemo(()=>Tt(a=>n.current=a(n.current,c.current),{trackMouse:r}),[r]);return n.current=It(n.current,c.current,p.current,u),m}function Nt(t){const{addParam:r}=D();return e.jsxs(v,{gap:8,vertical:!0,children:[e.jsx(O,{block:!0,onClick:()=>r("testify","single"),children:"Testify Drawer"}),e.jsx(O,{block:!0,onClick:()=>r("testify","group"),children:"Testify Group"}),e.jsx(Dt,{...t}),e.jsx(Pt,{...t})]})}function Dt({suspects:t,questions:r,answers:n,addEntryToUpdate:c}){const{width:p,height:j}=xe(),{is:m,removeParam:u}=D(),[a,h]=ge(),d=Rt({onSwipedLeft:()=>alert("Swiped Left"),onSwipedRight:()=>alert("Swiped Right"),onSwipedUp:()=>alert("Swiped Up"),preventScrollOnSwipe:!0,trackTouch:!0,trackMouse:!0}),i=()=>{h({suspectId:I.sample(Object.keys(t))||null,testimonyId:I.sample(Object.keys(r))||null})},f=()=>{i()},x=()=>{if(a?.suspectId&&a?.testimonyId){const l=I.cloneDeep(n[a?.testimonyId??""]??{});l[a.suspectId]=[...l[a.suspectId]||[],1],c(a.testimonyId??"",l),i()}},o=()=>{if(a?.suspectId&&a?.testimonyId){const l=I.cloneDeep(n[a?.testimonyId??""]??{});l[a.suspectId]=[...l[a.suspectId]||[],-1],c(a.testimonyId??"",l),i()}},s=!!a?.suspectId&&!!a?.testimonyId;return e.jsx(ae,{footer:null,maskClosable:!1,onCancel:()=>u("testify"),open:m("testify","single"),title:e.jsx(T,{children:"Does this person do this??"}),width:p-64,children:e.jsxs("div",{...d,children:[s&&e.jsxs(v,{align:"center",className:"mb-8",gap:8,justify:"center",vertical:!0,children:[e.jsx(V,{cardId:a.suspectId??"",cardWidth:Math.max(j/4,128)}),e.jsx(T.Title,{className:"text-center",level:5,children:r[a.testimonyId??""]?.question})]}),e.jsxs(M.Compact,{block:!0,className:"mb-8",size:"large",children:[e.jsx(O,{block:!0,disabled:!s,icon:"ðŸ‘Ž",onClick:o,style:{height:64},children:"No"}),e.jsx(O,{block:!0,onClick:f,style:{height:64},children:"Skip"}),e.jsx(O,{block:!0,disabled:!s,icon:"ðŸ‘",iconPosition:"end",onClick:x,style:{height:64},children:"Yes"})]})]})})}function Pt({suspects:t,questions:r,answers:n,addEntryToUpdate:c}){const{width:p,height:j}=xe(),{is:m,removeParam:u}=D(),[a,h]=ge(),[d,i]=g.useState(6),[f,x]=g.useState(!0),o=()=>{const S=(f?I.sample(Object.keys(r)):a?.testimonyId)??null,C=I.sampleSize(Object.keys(t).filter(k=>{const w=n[S??""]?.[k]||[];return fe(w)<4}),d).reduce((k,w)=>(k[w]=null,k),{});h({suspectsIds:C,testimonyId:S})};Se(()=>o());const s=()=>{const S=Object.entries(a?.suspectsIds??{}).reduce((C,[k,w])=>(w!==null&&(C[k]=[w]),C),{});if(a?.testimonyId&&Object.keys(S).length>0){const C=I.cloneDeep(n[a.testimonyId]??{});Object.entries(S).forEach(([k,w])=>{C[k]=[...C[k]||[],...w]}),c(a.testimonyId,C)}else console.log("No testimonyId or no judged suspects found, likely skipped");o()},l=!!a?.suspectsIds&&!!a?.testimonyId,y=S=>{h(C=>{if(!C)return C;const k=Object.entries(C.suspectsIds).reduce((w,[b,N])=>(w[b]=N===null?S:N,w),{});return{...C,suspectsIds:k}})};return e.jsx(ae,{footer:null,maskClosable:!1,onCancel:()=>u("testify"),open:m("testify","group"),title:e.jsx(T,{children:"Do these people do this??"}),width:p-64,children:e.jsxs("div",{children:[l&&e.jsxs(v,{align:"center",className:"mb-8",gap:8,justify:"center",vertical:!0,children:[e.jsxs(v,{align:"center",gap:6,justify:"center",children:[e.jsx(T.Text,{children:"Number of Suspects:"}),e.jsx(ue,{onChange:S=>i(S??6),size:"small",value:d}),e.jsx(T.Text,{children:"Random Questions:"}),e.jsx(P,{checked:f,onChange:x,size:"small"})]}),e.jsxs(T.Title,{className:"text-center",level:4,children:[a.testimonyId," - ",r[a.testimonyId??""]?.question]}),e.jsx(v,{gap:8,justify:"center",wrap:"wrap",children:Object.keys(a.suspectsIds).map(S=>e.jsxs(v,{align:"center",justify:"center",vertical:!0,children:[e.jsx(T.Text,{className:"text-center",children:t[S]?.name?.pt||"Unknown"}),e.jsx(V,{cardId:S,cardWidth:Math.min(Math.max(j/3,128),128)},S),e.jsx(He,{onChange:C=>h(k=>k&&{...k,suspectsIds:{...k.suspectsIds,[S]:C}}),options:[{value:-4,icon:"ðŸ‘Ž"},{value:null,icon:"â™¾"},{value:4,icon:"ðŸ‘"}],shape:"round",size:"large",value:a.suspectsIds[S]})]},S))})]}),e.jsxs(v,{align:"center",className:"mt-8",justify:"space-between",children:[e.jsx("span",{}),e.jsxs(v,{gap:8,children:[e.jsx(O,{onClick:()=>y(-4),children:"Set all â™¾ to ðŸ‘Ž"}),e.jsx(O,{onClick:()=>y(4),children:"Set all â™¾ to ðŸ‘"})]}),e.jsx(O,{onClick:s,size:"large",children:"Next Set"})]})]})})}function Mt({suspects:t,questions:r,data:n,hasNewData:c,isDirty:p,save:j,isSaving:m,entriesToUpdate:u,addEntryToUpdate:a}){const{queryParams:h,addParams:d}=D(),i=g.useMemo(()=>{let x=0;const o={};return Object.values(n).forEach(s=>{Object.keys(s).forEach(l=>{if(s[l]){o[l]||(o[l]=0);const y=fe(s[l]);y>=5&&(o[l]+=1),y>=3&&(x+=1)}})}),{absoluteTotal:x,queriedTestimoniesCount:Object.keys(n).length,suspectsCount:Object.keys(o).length,reliableSuspectsCount:Object.values(o).filter(s=>s>=30).length}},[n]),f=i.queriedTestimoniesCount*i.suspectsCount;return e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs(v,{gap:12,vertical:!0,children:[e.jsx(Be,{dirt:JSON.stringify(u),isDirty:p,isSaving:m,onSave:j}),e.jsx(de,{block:!0,data:async()=>await Et(n),disabled:p,fileName:"testimony-answers.json",hasNewData:c}),e.jsx(Fe,{label:"FS Data",path:"data/testimonies"}),e.jsx(Ae,{docId:"testimonies",label:"FS TDR",path:"tdr",queryKey:["tdr","testimonies"]})]})}),e.jsxs(Q,{children:[e.jsx(De,{label:"Display",onChange:x=>d({display:x,page:1},{page:1}),options:[{title:"Questions",icon:e.jsx(Qe,{}),value:"questions"},{title:"Suspects",icon:e.jsx(st,{}),value:"suspects"},{title:"Simulator",icon:e.jsx(Ue,{}),value:"simulator"}],value:h.get("display")??"questions"}),e.jsx(ze,{})]}),e.jsx(Q,{children:e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Legend"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Reliability: At least 5 votes"}),e.jsx("li",{children:"Large Bars: There's enough data (at least 3)"}),e.jsx("li",{children:"Small blue bar: in progress negative"})]})]})}),e.jsxs(Q,{children:[e.jsxs("div",{style:{fontSize:"0.85em"},children:[e.jsx("strong",{children:"Counts"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Testimonies: ",i.queriedTestimoniesCount]}),e.jsxs("li",{children:["Suspects: ",i.suspectsCount]}),e.jsx("li",{children:e.jsxs(F,{title:"A reliable suspect is one that has at least 5 complete testimonies.",children:["Reliable suspects: ",i.reliableSuspectsCount]})}),e.jsxs("li",{children:["Complete: ",i.absoluteTotal]}),e.jsxs("li",{children:["Total: ",f]}),e.jsxs("li",{children:["Percentage: ",(i.absoluteTotal/f*100).toFixed(1),"%"]})]})]}),e.jsx(Nt,{addEntryToUpdate:a,answers:n,questions:r,suspects:t})]})]})}async function Et(t){console.log("Preparing file for download...x");const r=await Le("data","testimonies")(),n=$e(r);console.log("Parsed data from Firestore:",n);const c=I.cloneDeep(t);return Object.keys(c).forEach(p=>{const j=c[p],m=n[p]||{};Object.keys(j).forEach(u=>{const a=m[u]||[],h=Pe([...j[u],...a]);j[u]=h})}),qe(Ve(c))}function Ft(){const t=_("suspects"),r=_("testimony-questions-pt"),n=We({tdrResourceName:"testimony-answers",firestoreDataCollectionName:"testimonies",serialize:!0});return{...n,isLoading:n.isLoading||r.isLoading||t.isLoading,isSuccess:n.isSuccess&&r.isSuccess&&t.isSuccess,error:n.error||r.error||t.error,questions:r.data,suspects:t.data,hasNewData:n.hasFirestoreData}}function Ds(){const t=Ft();return e.jsx(Ce,{subtitle:"Suspect Testimony Rates",title:"Testimonies",children:e.jsxs(Z,{hasSider:!0,children:[e.jsx(Oe,{children:e.jsx(Mt,{...t})}),e.jsx(Z.Content,{className:"content",children:e.jsx(ke,{error:t.error,hasResponseData:!I.isEmpty(t.data),isLoading:t.isLoading,children:e.jsx(gt,{...t})})})]})})}export{Ds as TestimoniesPage,Ds as default};
