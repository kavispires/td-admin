import{f as P,ac as be,a9 as J,aa as V,a6 as je,ab as me,a7 as B,a8 as Ee,aw as De,ax as Ce,N as Fe,ai as _e,ay as Ve,ag as ze,af as Be,r as g,C as Le,h as se,k as Ke,m as Ge,n as F,az as We,o as He,aA as Ue,aB as qe,p as Je,q as Qe,as as Xe,i as he,aC as Ye,F as pe,j as t,D as L,T as S,B as Q,U as oe,a1 as Ze,G as et,P as tt,L as fe}from"./index-dxqRZG9X.js";import{D as Ie}from"./DataLoadingWrapper-CHkaPzzl.js";import{F as at}from"./FilterEntries-DDHedpCi.js";import{S as nt}from"./SiderContent-g6fyCteD.js";import{D as st}from"./DownloadButton-D7cMNwbq.js";import{S as lt}from"./SaveButton-wN5bIWmj.js";import{u as de}from"./useQueryParams--Xnh1v1a.js";import{u as le}from"./useTDResource-Bxk_GrJX.js";import{l as X,c as ne,P as rt}from"./useBaseUrl-BXHtA4Pi.js";import{a as it,w as re}from"./index-CIdX3id2.js";import{v as K,s as Se,a as xe,b as ge,S as $e,c as ve}from"./daily-teoria-de-conjuntos-BSTuLtzM.js";import{F as Y}from"./index-BggtpG-R.js";import{R as ot}from"./ClusterOutlined-WWkLegib.js";import{R as dt}from"./TableOutlined-B1zJntsQ.js";import{R as ct}from"./RobotOutlined-CTuG2Az6.js";import{I as Ne}from"./Item-D-HWwya5.js";import{F as O}from"./index-C4I3rKEO.js";import{M as ut}from"./index-Cqfe7jHO.js";import{I as Z}from"./index-DG9-Dq-U.js";import{R as H}from"./index-tMGK7Y07.js";import{A as mt}from"./index-C7kgxNA7.js";import{S as ie}from"./index-CzsF-3pk.js";import{T as U}from"./TransparentButton-Clvy830t.js";import{S as D}from"./index--q15TYvE.js";import{R as we}from"./index-Dqc3ZVtF.js";import{u as Te}from"./useTablePagination-6PZJK4qc.js";import{T as _}from"./index-MeGU1xWE.js";import{F as Ae}from"./Table-Dh4wzHOO.js";import{u as ht}from"./useResourceFirestoreData-pL1PX9Zq.js";import"./index-DOhECwtc.js";import"./index-BM-X4DgR.js";import"./moment-C5S46NFB.js";import"./SaveOutlined-DH5U4cHr.js";import"./constants-B8Jx-I5N.js";import"./useParsedHistory-DNFk7WvG.js";import"./gapSize-U1swVQyS.js";import"./Input-BdiSS1dO.js";import"./throttleByAnimationFrame-D7GC7Sz5.js";import"./index-q2VES2ua.js";import"./scrollTo-DBz7YC_A.js";import"./Pagination-CMgMjwwg.js";import"./useGetFirestoreDoc-Bd7iCQ4m.js";import"./useUpdateFirestoreDoc-Cq7_Knra.js";import"./useMutation-CF3vwMOA.js";var Pe=P.forwardRef(function(e,a){var i=e.prefixCls,s=e.forceRender,d=e.className,c=e.style,m=e.children,o=e.isActive,u=e.role,f=e.classNames,j=e.styles,n=P.useState(o||s),p=be(n,2),r=p[0],l=p[1];return P.useEffect(function(){(s||o)&&l(!0)},[s,o]),r?P.createElement("div",{ref:a,className:J("".concat(i,"-content"),V(V({},"".concat(i,"-content-active"),o),"".concat(i,"-content-inactive"),!o),d),style:c,role:u},P.createElement("div",{className:J("".concat(i,"-content-box"),f==null?void 0:f.body),style:j==null?void 0:j.body},m)):null});Pe.displayName="PanelContent";var pt=["showArrow","headerClass","isActive","onItemClick","forceRender","className","classNames","styles","prefixCls","collapsible","accordion","panelKey","extra","header","expandIcon","openMotion","destroyInactivePanel","children"],ke=P.forwardRef(function(e,a){var i=e.showArrow,s=i===void 0?!0:i,d=e.headerClass,c=e.isActive,m=e.onItemClick,o=e.forceRender,u=e.className,f=e.classNames,j=f===void 0?{}:f,n=e.styles,p=n===void 0?{}:n,r=e.prefixCls,l=e.collapsible,x=e.accordion,b=e.panelKey,C=e.extra,I=e.header,$=e.expandIcon,y=e.openMotion,w=e.destroyInactivePanel,N=e.children,k=je(e,pt),T=l==="disabled",h=C!=null&&typeof C!="boolean",v=V(V(V({onClick:function(){m==null||m(b)},onKeyDown:function(E){(E.key==="Enter"||E.keyCode===me.ENTER||E.which===me.ENTER)&&(m==null||m(b))},role:x?"tab":"button"},"aria-expanded",c),"aria-disabled",T),"tabIndex",T?-1:0),A=typeof $=="function"?$(e):P.createElement("i",{className:"arrow"}),G=A&&P.createElement("div",B({className:"".concat(r,"-expand-icon")},["header","icon"].includes(l)?v:{}),A),te=J("".concat(r,"-item"),V(V({},"".concat(r,"-item-active"),c),"".concat(r,"-item-disabled"),T),u),ae=J(d,"".concat(r,"-header"),V({},"".concat(r,"-collapsible-").concat(l),!!l),j.header),M=Ee({className:ae,style:p.header},["header","icon"].includes(l)?{}:v);return P.createElement("div",B({},k,{ref:a,className:te}),P.createElement("div",M,s&&G,P.createElement("span",B({className:"".concat(r,"-header-text")},l==="header"?v:{}),I),h&&P.createElement("div",{className:"".concat(r,"-extra")},C)),P.createElement(De,B({visible:c,leavedClassName:"".concat(r,"-content-hidden")},y,{forceRender:o,removeOnLeave:w}),function(R,E){var W=R.className,z=R.style;return P.createElement(Pe,{ref:E,prefixCls:r,className:W,classNames:j,style:z,styles:p,isActive:c,forceRender:o,role:x?"tabpanel":void 0},N)}))}),ft=["children","label","key","collapsible","onItemClick","destroyInactivePanel"],xt=function(a,i){var s=i.prefixCls,d=i.accordion,c=i.collapsible,m=i.destroyInactivePanel,o=i.onItemClick,u=i.activeKey,f=i.openMotion,j=i.expandIcon;return a.map(function(n,p){var r=n.children,l=n.label,x=n.key,b=n.collapsible,C=n.onItemClick,I=n.destroyInactivePanel,$=je(n,ft),y=String(x??p),w=b??c,N=I??m,k=function(v){w!=="disabled"&&(o(v),C==null||C(v))},T=!1;return d?T=u[0]===y:T=u.indexOf(y)>-1,P.createElement(ke,B({},$,{prefixCls:s,key:y,panelKey:y,isActive:T,accordion:d,openMotion:f,expandIcon:j,header:l,collapsible:w,onItemClick:k,destroyInactivePanel:N}),r)})},gt=function(a,i,s){if(!a)return null;var d=s.prefixCls,c=s.accordion,m=s.collapsible,o=s.destroyInactivePanel,u=s.onItemClick,f=s.activeKey,j=s.openMotion,n=s.expandIcon,p=a.key||String(i),r=a.props,l=r.header,x=r.headerClass,b=r.destroyInactivePanel,C=r.collapsible,I=r.onItemClick,$=!1;c?$=f[0]===p:$=f.indexOf(p)>-1;var y=C??m,w=function(T){y!=="disabled"&&(u(T),I==null||I(T))},N={key:p,panelKey:p,header:l,headerClass:x,isActive:$,prefixCls:d,destroyInactivePanel:b??o,openMotion:j,accordion:c,children:a.props.children,onItemClick:w,expandIcon:n,collapsible:y};return typeof a.type=="string"?a:(Object.keys(N).forEach(function(k){typeof N[k]>"u"&&delete N[k]}),P.cloneElement(a,N))};function vt(e,a,i){return Array.isArray(e)?xt(e,i):Ce(a).map(function(s,d){return gt(s,d,i)})}function yt(e){var a=e;if(!Array.isArray(a)){var i=ze(a);a=i==="number"||i==="string"?[a]:[]}return a.map(function(s){return String(s)})}var bt=P.forwardRef(function(e,a){var i=e.prefixCls,s=i===void 0?"rc-collapse":i,d=e.destroyInactivePanel,c=d===void 0?!1:d,m=e.style,o=e.accordion,u=e.className,f=e.children,j=e.collapsible,n=e.openMotion,p=e.expandIcon,r=e.activeKey,l=e.defaultActiveKey,x=e.onChange,b=e.items,C=J(s,u),I=Fe([],{value:r,onChange:function(h){return x==null?void 0:x(h)},defaultValue:l,postState:yt}),$=be(I,2),y=$[0],w=$[1],N=function(h){return w(function(){if(o)return y[0]===h?[]:[h];var v=y.indexOf(h),A=v>-1;return A?y.filter(function(G){return G!==h}):[].concat(Be(y),[h])})};_e(!f,"[rc-collapse] `children` will be removed in next major version. Please use `items` instead.");var k=vt(b,f,{prefixCls:s,accordion:o,openMotion:n,expandIcon:p,collapsible:j,destroyInactivePanel:c,onItemClick:N,activeKey:y});return P.createElement("div",B({ref:a,className:C,style:m,role:o?"tablist":void 0},Ve(e,{aria:!0,data:!0})),k)});const ce=Object.assign(bt,{Panel:ke});ce.Panel;const jt=g.forwardRef((e,a)=>{const{getPrefixCls:i}=g.useContext(Le),{prefixCls:s,className:d,showArrow:c=!0}=e,m=i("collapse",s),o=se({[`${m}-no-arrow`]:!c},d);return g.createElement(ce.Panel,Object.assign({ref:a},e,{prefixCls:m,className:o}))}),Ct=e=>{const{componentCls:a,contentBg:i,padding:s,headerBg:d,headerPadding:c,collapseHeaderPaddingSM:m,collapseHeaderPaddingLG:o,collapsePanelBorderRadius:u,lineWidth:f,lineType:j,colorBorder:n,colorText:p,colorTextHeading:r,colorTextDisabled:l,fontSizeLG:x,lineHeight:b,lineHeightLG:C,marginSM:I,paddingSM:$,paddingLG:y,paddingXS:w,motionDurationSlow:N,fontSizeIcon:k,contentPadding:T,fontHeight:h,fontHeightLG:v}=e,A=`${F(f)} ${j} ${n}`;return{[a]:Object.assign(Object.assign({},He(e)),{backgroundColor:d,border:A,borderRadius:u,"&-rtl":{direction:"rtl"},[`& > ${a}-item`]:{borderBottom:A,"&:first-child":{[`
            &,
            & > ${a}-header`]:{borderRadius:`${F(u)} ${F(u)} 0 0`}},"&:last-child":{[`
            &,
            & > ${a}-header`]:{borderRadius:`0 0 ${F(u)} ${F(u)}`}},[`> ${a}-header`]:Object.assign(Object.assign({position:"relative",display:"flex",flexWrap:"nowrap",alignItems:"flex-start",padding:c,color:r,lineHeight:b,cursor:"pointer",transition:`all ${N}, visibility 0s`},Ue(e)),{[`> ${a}-header-text`]:{flex:"auto"},[`${a}-expand-icon`]:{height:h,display:"flex",alignItems:"center",paddingInlineEnd:I},[`${a}-arrow`]:Object.assign(Object.assign({},qe()),{fontSize:k,transition:`transform ${N}`,svg:{transition:`transform ${N}`}}),[`${a}-header-text`]:{marginInlineEnd:"auto"}}),[`${a}-collapsible-header`]:{cursor:"default",[`${a}-header-text`]:{flex:"none",cursor:"pointer"}},[`${a}-collapsible-icon`]:{cursor:"unset",[`${a}-expand-icon`]:{cursor:"pointer"}}},[`${a}-content`]:{color:p,backgroundColor:i,borderTop:A,[`& > ${a}-content-box`]:{padding:T},"&-hidden":{display:"none"}},"&-small":{[`> ${a}-item`]:{[`> ${a}-header`]:{padding:m,paddingInlineStart:w,[`> ${a}-expand-icon`]:{marginInlineStart:e.calc($).sub(w).equal()}},[`> ${a}-content > ${a}-content-box`]:{padding:$}}},"&-large":{[`> ${a}-item`]:{fontSize:x,lineHeight:C,[`> ${a}-header`]:{padding:o,paddingInlineStart:s,[`> ${a}-expand-icon`]:{height:v,marginInlineStart:e.calc(y).sub(s).equal()}},[`> ${a}-content > ${a}-content-box`]:{padding:y}}},[`${a}-item:last-child`]:{borderBottom:0,[`> ${a}-content`]:{borderRadius:`0 0 ${F(u)} ${F(u)}`}},[`& ${a}-item-disabled > ${a}-header`]:{"\n          &,\n          & > .arrow\n        ":{color:l,cursor:"not-allowed"}},[`&${a}-icon-position-end`]:{[`& > ${a}-item`]:{[`> ${a}-header`]:{[`${a}-expand-icon`]:{order:1,paddingInlineEnd:0,paddingInlineStart:I}}}}})}},It=e=>{const{componentCls:a}=e,i=`> ${a}-item > ${a}-header ${a}-arrow`;return{[`${a}-rtl`]:{[i]:{transform:"rotate(180deg)"}}}},St=e=>{const{componentCls:a,headerBg:i,borderlessContentPadding:s,borderlessContentBg:d,colorBorder:c}=e;return{[`${a}-borderless`]:{backgroundColor:i,border:0,[`> ${a}-item`]:{borderBottom:`1px solid ${c}`},[`
        > ${a}-item:last-child,
        > ${a}-item:last-child ${a}-header
      `]:{borderRadius:0},[`> ${a}-item:last-child`]:{borderBottom:0},[`> ${a}-item > ${a}-content`]:{backgroundColor:d,borderTop:0},[`> ${a}-item > ${a}-content > ${a}-content-box`]:{padding:s}}}},$t=e=>{const{componentCls:a,paddingSM:i}=e;return{[`${a}-ghost`]:{backgroundColor:"transparent",border:0,[`> ${a}-item`]:{borderBottom:0,[`> ${a}-content`]:{backgroundColor:"transparent",border:0,[`> ${a}-content-box`]:{paddingBlock:i}}}}}},Nt=e=>({headerPadding:`${e.paddingSM}px ${e.padding}px`,headerBg:e.colorFillAlter,contentPadding:`${e.padding}px 16px`,contentBg:e.colorBgContainer,borderlessContentPadding:`${e.paddingXXS}px 16px ${e.padding}px`,borderlessContentBg:"transparent"}),wt=Ke("Collapse",e=>{const a=Ge(e,{collapseHeaderPaddingSM:`${F(e.paddingXS)} ${F(e.paddingSM)}`,collapseHeaderPaddingLG:`${F(e.padding)} ${F(e.paddingLG)}`,collapsePanelBorderRadius:e.borderRadiusLG});return[Ct(a),St(a),$t(a),It(a),We(a)]},Nt),Tt=g.forwardRef((e,a)=>{const{getPrefixCls:i,direction:s,expandIcon:d,className:c,style:m}=Je("collapse"),{prefixCls:o,className:u,rootClassName:f,style:j,bordered:n=!0,ghost:p,size:r,expandIconPosition:l="start",children:x,destroyInactivePanel:b,destroyOnHidden:C,expandIcon:I}=e,$=Qe(M=>{var R;return(R=r??M)!==null&&R!==void 0?R:"middle"}),y=i("collapse",o),w=i(),[N,k,T]=wt(y),h=g.useMemo(()=>l==="left"?"start":l==="right"?"end":l,[l]),v=I??d,A=g.useCallback((M={})=>{const R=typeof v=="function"?v(M):g.createElement(Xe,{rotate:M.isActive?s==="rtl"?-90:90:void 0,"aria-label":M.isActive?"expanded":"collapsed"});return he(R,()=>{var E;return{className:se((E=R.props)===null||E===void 0?void 0:E.className,`${y}-arrow`)}})},[v,y,s]),G=se(`${y}-icon-position-${h}`,{[`${y}-borderless`]:!n,[`${y}-rtl`]:s==="rtl",[`${y}-ghost`]:!!p,[`${y}-${$}`]:$!=="middle"},c,u,f,k,T),te=g.useMemo(()=>Object.assign(Object.assign({},Ye(w)),{motionAppear:!1,leavedClassName:`${y}-content-hidden`}),[w,y]),ae=g.useMemo(()=>x?Ce(x).map((M,R)=>{var E,W;const z=M.props;if(z!=null&&z.disabled){const Me=(E=M.key)!==null&&E!==void 0?E:String(R),Re=Object.assign(Object.assign({},pe(M.props,["disabled"])),{key:Me,collapsible:(W=z.collapsible)!==null&&W!==void 0?W:"disabled"});return he(M,Re)}return M}):null,[x]);return N(g.createElement(ce,Object.assign({ref:a,openMotion:te},pe(e,["rootClassName"]),{expandIcon:A,prefixCls:y,className:G,style:Object.assign(Object.assign({},m),j),destroyInactivePanel:C??b}),ae))}),At=Object.assign(Tt,{Panel:jt});function Pt({data:e,save:a,isDirty:i,isSaving:s,entriesToUpdate:d,hasFirestoreData:c}){const{addParams:m,queryParams:o}=de(),u=le("daily-diagram-rules");return t.jsxs(nt,{children:[t.jsxs(Y,{gap:12,vertical:!0,children:[t.jsx(lt,{dirt:JSON.stringify(d),isDirty:i,isSaving:s,onSave:a}),t.jsx(st,{block:!0,data:()=>kt(e,u.data??{}),disabled:i,fileName:"daily-diagram-items.json",hasNewData:c})]}),t.jsx(L,{}),t.jsx(at,{label:"Display",onChange:f=>m({display:f,page:1},{page:1}),options:[{title:"By Rule",icon:t.jsx(ot,{}),value:"rule"},{title:"By Thing",icon:t.jsx(dt,{}),value:"thing"},{title:"Simulator",icon:t.jsx(ct,{}),value:"simulator"}],value:o.get("display")??"rule"}),t.jsx(L,{}),t.jsx(S.Paragraph,{className:"my-6",type:"secondary",children:"v2.0.1"})]})}function kt(e,a){console.log("Preparing file for download...");const i=X.cloneDeep(e);return Object.values(i).forEach(s=>{const d=Object.values(a).filter(o=>o.updatedAt>s.updatedAt),c=d.filter(o=>o.method==="auto");c.length>0&&(console.log(`Performing ${c.length} auto updates for ${s.name}`),s.rules=s.rules.filter(o=>!c.map(u=>u.id).includes(o)),c.forEach(o=>{K[o.id](s.name)&&s.rules.push(o.id)})),d.some(o=>o.method!=="auto")||(console.log("Auto updating"),s.updatedAt=Date.now())}),it(i)}function ue({isModalOpen:e,onSaveThing:a,onCancel:i,thing:s,rules:d,width:c,itemAliases:m,subtitle:o,okButtonText:u,onGiveAnotherThing:f}){const j=g.useMemo(()=>X.orderBy(Object.values(d),[h=>{const v=["manual","dependency","auto"].indexOf(h.method);return v===-1?Number.POSITIVE_INFINITY:v},h=>{const v=["grammar","comparison","order","count","contains","ends"].indexOf(h.type);return v===-1?Number.POSITIVE_INFINITY:v},h=>h.title.slice(0,7),h=>Number(h.id.split("-")[1])]),[d]),[n]=O.useForm(),p=O.useWatch([],n),r=!p||Object.values(p??{}).some(h=>h===void 0),l=O.useWatch("name",n);g.useEffect(()=>{if(!l||s.name&&s.syllables&&l===s.name)return;const h={syllables:Se(l),stressedSyllable:s.stressedSyllable??l.includes(" ")?-1:0};Object.keys(d).forEach(v=>{K[v]?h[v]=K[v](l):h[v]=s.rules.length>0?s.rules.includes(v):void 0}),n.setFieldsValue(h)},[l]);const x=O.useWatch("syllables",n),b=n.getFieldValue("ddr-51-pt");g.useEffect(()=>{b&&(n.setFieldsValue({stressedSyllable:void 0}),n.setFieldsValue({"ddr-43-pt":!1}),n.setFieldsValue({"ddr-44-pt":!1}),n.setFieldsValue({"ddr-45-pt":!1}),n.setFieldsValue({"ddr-46-pt":!1})),b===void 0&&n.setFieldsValue({"ddr-51-pt":!1})},[b]),g.useEffect(()=>{if(x){const h=Object.keys(d).reduce((v,A)=>(xe[A]&&(v[A]=xe[A](l,x,b)),v),{});n.setFieldsValue({...h,stressedSyllable:x===s.syllables?s.stressedSyllable:s.stressedSyllable??l.includes(" ")?-1:void 0})}},[l,x,b]);const C=O.useWatch("stressedSyllable",n);g.useEffect(()=>{if(!b&&C!==void 0){const h=Object.keys(d).reduce((v,A)=>(ge[A]&&(v[A]=ge[A](l,x,C)),v),{});n.setFieldsValue({...h})}},[C]);const I=n.getFieldValue("ddr-1-pt"),$=n.getFieldValue("ddr-2-pt"),y=n.getFieldValue("ddr-50-pt");g.useEffect(()=>{I===!0&&(n.setFieldsValue({"ddr-2-pt":!1}),n.setFieldsValue({"ddr-50-pt":!1}))},[I]),g.useEffect(()=>{$===!0&&(n.setFieldsValue({"ddr-1-pt":!1}),n.setFieldsValue({"ddr-50-pt":!1}))},[$]),g.useEffect(()=>{y===!0&&(n.setFieldsValue({"ddr-1-pt":!1}),n.setFieldsValue({"ddr-2-pt":!1}))},[y]);const w=n.getFieldValue("ddr-3-pt");g.useEffect(()=>{w===!0&&n.setFieldsValue({"ddr-4-pt":!1})},[w]);const N=n.getFieldValue("ddr-4-pt");g.useEffect(()=>{N===!0&&n.setFieldsValue({"ddr-3-pt":!1})},[N]),g.useEffect(()=>{(l==null?void 0:l.includes("-"))&&n.setFieldsValue({"ddr-5-pt":!0})},[l]);const k=h=>{const v=Mt(h);a(v)},T=g.useMemo(()=>(x??"").split($e),[x]);return t.jsx(ut,{maskClosable:!1,okButtonProps:{disabled:r,htmlType:"submit",size:"large"},okText:u??"Add Item",onCancel:i,onOk:n.submit,open:e,title:t.jsxs(t.Fragment,{children:["Edit ",s.name," ",o&&t.jsx("small",{children:o})]}),width:c,children:t.jsxs(O,{autoComplete:"off",form:n,initialValues:Ot(s,d),labelWrap:!0,layout:"vertical",name:`new-item-${s.itemId}`,onFinish:k,size:"small",children:[t.jsxs("div",{className:"diagram-container",children:[t.jsx("div",{children:t.jsx(Ne,{id:s.itemId,width:50})}),t.jsx(O.Item,{label:"Name",name:"name",children:t.jsx(Z,{})}),t.jsx(O.Item,{label:"Item",name:"itemId",children:t.jsx(Z,{readOnly:!0})}),t.jsx(O.Item,{label:"Syllables",name:"syllables",children:t.jsx(Z,{})}),t.jsx(O.Item,{label:"Stressed Syllable",name:"stressedSyllable",children:t.jsx(H.Group,{buttonStyle:"solid",optionType:"button",children:T.map((h,v)=>t.jsx(H,{value:T.length-v-1,children:h},v))})}),t.jsx(O.Item,{label:"Updated At",name:"updatedAt",children:t.jsx(Z,{readOnly:!0,value:new Date(s.updatedAt).toLocaleString()})}),(m||f)&&t.jsxs("div",{children:[f&&t.jsx(Q,{className:"mt-2",onClick:f,size:"small",type:"dashed",children:"Give me another thing"}),m&&t.jsxs("span",{children:["Options: ",m==null?void 0:m.join(", ")]})]}),t.jsx("div",{children:t.jsx(mt,{offsetTop:50,children:t.jsx(Y,{align:"center",justify:"center",children:t.jsx(Q,{disabled:r,htmlType:"submit",size:"large",type:"primary",children:u??"Add Item"})})})})]}),t.jsx("div",{className:"diagram-container",children:j.map(h=>h.method==="auto"&&K[h.id]?t.jsx(O.Item,{className:ne(s.updatedAt<h.updatedAt&&"diagram-container__outdated-rule"),label:h.title,name:h.id,valuePropName:"checked",children:t.jsx(ie,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},h.id):h.method==="dependency"?t.jsx(O.Item,{className:ne(s.updatedAt<h.updatedAt&&"diagram-container__outdated-rule"),label:h.title,name:h.id,valuePropName:"checked",children:t.jsx(ie,{checkedChildren:"✅",disabled:!0,unCheckedChildren:"❌"})},h.id):t.jsx(O.Item,{className:ne(s.updatedAt<h.updatedAt&&"diagram-container__outdated-rule"),label:h.title,name:h.id,children:t.jsxs(H.Group,{buttonStyle:"solid",optionType:"button",children:[t.jsx(H,{value:!0,children:"✅"}),t.jsx(H,{value:!1,children:"❌"})]})},h.id))})]})})}const Ot=(e,a)=>{let i=!1;return{name:e.name,itemId:e.itemId,syllables:e.syllables??Se(e.name),stressedSyllable:e.stressedSyllable??0,...Object.keys(a).reduce((s,d)=>{if(e.updatedAt<a[d].updatedAt)if(K[d]){const c=K[d](e.name);c&&e.rules.includes(d)&&(i=!0),s[d]=c}else s[d]=void 0;else s[d]=e.rules.includes(d);return s},{}),updatedAt:i?Date.now():e.updatedAt}},Mt=e=>{const{itemId:a,name:i,syllables:s,stressedSyllable:d,...c}=e;return{itemId:a,name:i,updatedAt:Date.now(),syllables:s,stressedSyllable:d,rules:Object.keys(c).filter(m=>c[m]===!0)}};function q({itemId:e,name:a,width:i=50}){return t.jsxs(Y,{align:"center",vertical:!0,children:[t.jsx(Ne,{id:e,width:i}),t.jsx(S.Text,{code:!0,children:a},e)]})}function ee({thing:e,width:a=50,onActivateThing:i}){return t.jsx(U,{onClick:()=>i(e),children:t.jsx(q,{itemId:e.itemId,name:e.name,width:a})})}function Rt({game:e}){const[a]=g.useState([{id:e.rule1.thing.id,name:e.rule1.thing.name,rule:1}]),[i]=g.useState([{id:e.rule2.thing.id,name:e.rule2.thing.name,rule:2}]),[s]=g.useState([{id:e.intersectingThing.id,name:e.intersectingThing.name,rule:0}]),[d]=g.useState(e.things.slice(0,4)),[c,m]=g.useState(e.things[0]);return t.jsxs(D,{align:"center",direction:"vertical",children:[t.jsx(S.Title,{level:4,children:"Game Sample"}),t.jsxs(S.Title,{level:5,children:['"',e.title,'"']}),t.jsx(we,{count:e.level,disabled:!0,value:e.level}),t.jsx(S.Paragraph,{style:{maxWidth:"500px"},children:"O círculo amarelo tem uma regra gramatical secreta e o circulo vermelho tem outra regra gramatical secreta. O quadrado do meio representa a interseção entre a regra amarela e a regra vermelha."}),t.jsx(D,{children:t.jsx(Et,{intersectionChildren:t.jsx(U,{style:{width:"100%",height:"100%"},children:s.map((o,u,f)=>t.jsx(q,{itemId:o.id,name:o.name,width:u===f.length-1?80:60},o.id))}),leftCircleChildren:t.jsx(U,{style:{width:"100%",height:"100%"},children:a.map((o,u,f)=>t.jsx(q,{itemId:o.id,name:o.name,width:u===f.length-1?80:60},o.id))}),rightCircleChildren:t.jsx(U,{style:{width:"100%",height:"100%"},children:i.map((o,u,f)=>t.jsx(q,{itemId:o.id,name:o.name,width:u===f.length-1?80:60},o.id))}),width:600})}),t.jsx(S.Text,{children:"Coloque os objetos nos círculos corretos:"}),t.jsx(D,{className:"space--center",children:d.map(o=>t.jsx(U,{onClick:()=>m(o),style:o.id===(c==null?void 0:c.id)?{outline:"3px solid hotPink"}:{},children:t.jsx(q,{itemId:o.id,name:o.name},o.id)},o.id))}),t.jsx(At,{items:[{key:"1",label:"Resposta",children:t.jsxs(D,{direction:"vertical",children:[t.jsx(S.Text,{strong:!0,children:"Regra Amarela"}),t.jsx("ul",{children:t.jsx("li",{children:t.jsx(S.Text,{children:e.rule1.text})})}),t.jsx(S.Text,{strong:!0,children:"Regra Vermelha"}),t.jsx("ul",{children:t.jsx("li",{children:t.jsx(S.Text,{children:e.rule2.text})})})]})}]}),t.jsx("div",{style:{height:"200px"}})]})}function Et({leftCircleChildren:e,rightCircleChildren:a,intersectionChildren:i,...s}){return t.jsxs("svg",{viewBox:"0 0 760 500",xmlns:"http://www.w3.org/2000/svg",...s,children:[t.jsx("path",{d:"M252.78 3.5c-136.42 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.59-247-247-247zm.99 483.07C123.39 486.57 17.7 380.88 17.7 250.5S123.39 14.43 253.77 14.43 489.84 120.12 489.84 250.5 384.15 486.57 253.77 486.57z",fill:"#fbb03b",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),t.jsx("path",{d:"M508.22 3.5c-136.41 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.58-247-247-247zm.99 483.07c-130.38 0-236.07-105.69-236.07-236.07S378.84 14.43 509.22 14.43 745.29 120.12 745.29 250.5 639.6 486.57 509.22 486.57z",fill:"#f15a24",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5"}),t.jsx("path",{d:"M487.34 250.5c0-62.39-24.29-121.04-68.41-165.16a235.9 235.9 0 00-37.43-30.47 235.35 235.35 0 00-37.43 30.47c-44.12 44.11-68.41 102.77-68.41 165.16s24.29 121.04 68.41 165.16a235.9 235.9 0 0037.43 30.47 235.35 235.35 0 0037.43-30.47c44.12-44.11 68.41-102.77 68.41-165.16z",fill:"#535353"}),t.jsx("path",{d:"M258.72 250.5c0-66.64 25.95-129.3 73.08-176.42a253.125 253.125 0 0134.1-28.57c-33.98-18.65-72.29-28.57-112.13-28.57-62.39 0-121.04 24.29-165.16 68.41C44.5 129.46 20.2 188.11 20.2 250.5s24.29 121.04 68.41 165.16c44.11 44.12 102.77 68.41 165.16 68.41 39.84 0 78.15-9.92 112.13-28.57a252.507 252.507 0 01-34.1-28.57c-47.12-47.12-73.08-109.78-73.08-176.42zM674.37 85.34C630.25 41.22 571.6 16.93 509.21 16.93c-40.27 0-78.98 10.14-113.24 29.18 11.74 8.26 22.86 17.6 33.22 27.96 47.12 47.12 73.08 109.78 73.08 176.42s-25.95 129.3-73.08 176.42a252.312 252.312 0 01-33.22 27.96c34.25 19.04 72.96 29.18 113.24 29.18 62.39 0 121.04-24.29 165.16-68.41 44.12-44.11 68.41-102.77 68.41-165.16s-24.29-121.04-68.41-165.16z",fill:"#535353"}),t.jsx("foreignObject",{height:"450",width:"250",x:"30",y:"25",children:t.jsx("div",{className:"venn-diagram__circle-content-left",children:e})}),t.jsx("foreignObject",{height:"450",width:"250",x:"480",y:"25",children:t.jsx("div",{className:"venn-diagram__circle-content-right",children:a})}),t.jsx("foreignObject",{height:"370",width:"182",x:"290",y:"65",children:t.jsx("div",{className:"venn-diagram__circle-content-intersection",children:i})})]})}function Dt({things:e,rules:a}){const[i]=oe(),[s,d]=g.useState(null),c=()=>{d(Object.values(ve(1,{latestDate:"2023/01/01",latestNumber:0,used:[]},a,e))[0])},m=()=>{let o=null;try{o=ve(25,{latestDate:"2023/01/01",latestNumber:0,used:[]},a,e),console.log(o)}catch(u){console.error(u)}};return t.jsxs(D,{direction:"vertical",ref:i,children:[t.jsx(S.Title,{level:5,children:"Game Simulator"}),t.jsx(Q,{onClick:c,size:"large",children:"Simulate"}),t.jsx(Q,{onClick:m,size:"large",children:"Generate Demos (log)"}),s&&t.jsx(Rt,{game:s},JSON.stringify(s))]})}function Ft({children:e,things:a,rules:i,addEntryToUpdate:s}){const d=g.useMemo(()=>Object.values(a).filter(u=>{if(u.syllables&&u.syllables.split($e).join("")!==u.name.replace(/\s/g,""))return console.log("❗️ Name and syllables do not match",u.name,u.syllables),!0;const f=Object.values(i).filter(n=>n.updatedAt>u.updatedAt);return f.filter(n=>n.method==="auto").length>0&&console.log("❗️ Thing has auto updates that will be performed automatically upon downloading the JSON"),f.some(n=>n.method!=="auto")}),[a,i]),[c,m]=g.useState(null);g.useEffect(()=>{const u=async f=>{console.log("Found things that need to update..."),m(null),await re(250),d.length>0&&m(d[0])};console.count("Checking for things that need to update..."),d.length>0&&u(d[0])},[d]);const o=u=>{s(u.itemId,u)};return t.jsxs(t.Fragment,{children:[c&&t.jsx(ue,{isModalOpen:c!==null,okButtonText:"Update",onCancel:()=>m(null),onSaveThing:o,rules:i,subtitle:`(${d.length} left to update)`,thing:c,width:"90vw"}),e]})}function Oe({addEntryToUpdate:e,availableThings:a,rules:i,width:s}){const{notification:d}=Ze.useApp(),[c,m]=g.useState(null),[o,u]=g.useState({}),f=()=>{const r=X.sample(a.filter(l=>!o[l.id]));r?(u(l=>({...l,[r.id]:!0})),m({itemId:r.id,name:_t(r),updatedAt:Date.now(),syllables:"",stressedSyllable:0,rules:[]})):m(null)},j=g.useMemo(()=>{if(!c)return[];const r=a.find(l=>l.id===c.itemId);return[r==null?void 0:r.name.pt,...(r==null?void 0:r.aliasesPt)??[]].filter(Boolean)},[c,a]),n=async r=>{c&&((!r.name||!r.itemId)&&d.error({message:"Name and Item ID are required"}),e(r.itemId,r),console.log("COMPLETED SAVE"),m(null),await re(250),f())},p=async()=>{m(null),await re(100),f()};return t.jsxs(t.Fragment,{children:[t.jsx(Q,{onClick:f,size:"large",children:"Classify New Item"}),!!c&&t.jsx(ue,{isModalOpen:c!==null,itemAliases:j,onCancel:()=>m(null),onGiveAnotherThing:p,onSaveThing:n,rules:i,thing:c,width:s*.9})]})}const _t=e=>e.name.pt.split(" ").length===1?e.name.pt:e.aliasesPt?e.aliasesPt.find(a=>a.split(" ").length===1)??e.name.pt:e.name.pt;function Vt({things:e,addEntryToUpdate:a,availableThings:i,rules:s,setActiveThing:d}){const[c,{width:m}]=oe(),o=g.useMemo(()=>Object.values(e),[e]),u=Te({total:o.length,showQuickJumper:!0}),f=[{title:"ItemId",dataIndex:"itemId",key:"itemId",sorter:(n,p)=>Number(n.itemId)-Number(p.itemId),render:n=>t.jsx(_,{children:n})},{title:"Name",dataIndex:"name",key:"name",sorter:(n,p)=>n.name.localeCompare(p.name),render:n=>t.jsx(S.Text,{children:n})},{title:"Sprite",dataIndex:"itemId",key:"sprite",render:n=>t.jsx(ee,{onActivateThing:d,thing:e[n]},`i-${n}`)},{title:"Rules",dataIndex:"rules",key:"rules",render:(n,p)=>t.jsx(D,{wrap:!0,children:n.map(r=>t.jsx(et,{title:s[r].title,children:t.jsx(_,{color:s[r].updatedAt>p.updatedAt?"red":void 0,children:r})},r))})},{title:"Count",dataIndex:"rules",key:"count",sorter:(n,p)=>n.rules.length-p.rules.length,render:n=>n.length}],j=g.useMemo(()=>{const n={};return Object.values(e).forEach(p=>{n[p.name]||(n[p.name]=[]),n[p.name].push(p.itemId)}),Object.values(n).filter(p=>p.length>1)},[e]);return t.jsxs(D,{direction:"vertical",ref:c,children:[t.jsxs(S.Title,{level:5,children:["Rules By Items ",t.jsx(L,{type:"vertical"})," Added: ",t.jsx(_,{children:Object.keys(e).length})," Available to add ",t.jsx(_,{children:i.length})]}),t.jsx(Oe,{addEntryToUpdate:a,availableThings:i,rules:s,width:m}),t.jsx(L,{}),t.jsx(Ae,{columns:f,dataSource:o,pagination:u,rowKey:"itemId"}),t.jsx(L,{}),t.jsx(S.Title,{level:5,children:"Duplicated Things"}),t.jsxs(D,{wrap:!0,children:[j.length===0&&t.jsx(S.Text,{children:"No duplicated things"}),j.map(n=>t.jsxs(Y,{align:"center",children:[t.jsx(_,{color:"red",children:n.length}),n.map(p=>t.jsx(ee,{onActivateThing:d,thing:e[p]},`i-${p}`))]},n[0]))]})]})}function zt({things:e,addEntryToUpdate:a,availableThings:i,rules:s,thingsByRules:d,setActiveThing:c,containerWidth:m}){const{is:o,addParam:u}=de(),f=g.useMemo(()=>Object.values(s).map(r=>({...r,thingsCount:d[r.id].length})),[s,d]),j=Te({total:f.length,showQuickJumper:!0}),n=g.useMemo(()=>{const r=Object.values(d).map(l=>l.length);return{maxThings:Math.max(...r),minThings:Math.min(...r),averageThings:Math.round(Object.values(d).reduce((l,x)=>l+x.length,0)/Object.keys(d).length)}},[d]),p=[{title:"Id",dataIndex:"id",key:"id",sorter:(r,l)=>Number(r.id.split("-")[1])-Number(l.id.split("-")[1]),render:r=>t.jsx(S.Text,{children:r})},{title:"Rule",dataIndex:"title",key:"title",sorter:(r,l)=>r.title.localeCompare(l.title),render:r=>t.jsx(S.Text,{children:r})},{title:"Type",dataIndex:"type",key:"type",sorter:(r,l)=>r.type.localeCompare(l.type)},{title:"Method",dataIndex:"method",key:"method",sorter:(r,l)=>r.method.localeCompare(l.method)},{title:"Things",dataIndex:"thingsCount",key:"thingsCount",render:(r,l)=>t.jsxs(D,{size:"small",children:[t.jsx(_,{children:r}),o("showThings")?t.jsxs(D,{size:"small",wrap:!0,children:[d[l.id].slice(0,20).map(x=>t.jsx(ee,{onActivateThing:c,thing:e[x]},`${l.id}-${x}`)),d[l.id].length>20&&t.jsxs(S.Text,{children:["+",r-20," more"]})]}):t.jsxs(D,{size:"small",wrap:!0,children:[d[l.id].slice(0,5).map(x=>t.jsx(ee,{onActivateThing:c,thing:e[x]},`${l.id}-${x}`)),d[l.id].length>5&&t.jsxs(S.Text,{children:["+",r-5," more"]})]})]}),sorter:(r,l)=>r.thingsCount-l.thingsCount},{title:"Level",dataIndex:"level",key:"level",sorter:(r,l)=>r.level-l.level,render:r=>t.jsx(we,{count:3,disabled:!0,value:r})}];return t.jsxs(D,{direction:"vertical",children:[t.jsxs(S.Title,{level:4,children:["Things By Rule (Added: ",Object.keys(e).length," | ",i.length,")"," "]}),t.jsxs(D,{split:t.jsx(L,{type:"vertical"}),wrap:!0,children:[t.jsx(Oe,{addEntryToUpdate:a,availableThings:i,rules:s,width:m}),t.jsxs(S.Text,{strong:!0,children:["Average Things: ",t.jsx(_,{children:n.averageThings})]}),t.jsxs(S.Text,{strong:!0,children:["Max Things: ",t.jsx(_,{children:n.maxThings})]}),t.jsxs(S.Text,{strong:!0,children:["Min Things: ",t.jsx(_,{children:n.minThings})]}),t.jsx(ie,{checked:o("showThings"),checkedChildren:"Hide things",onChange:r=>u("showThings",r),unCheckedChildren:"Show things"})]}),t.jsx(Ae,{columns:p,dataSource:f,pagination:j})]})}const ye=e=>{const a=e.filter(i=>i.split(" ").length===1);return a.length>0?a[0]:""};function Bt({data:e,addEntryToUpdate:a}){const[i,{width:s}]=oe(),d=le("items"),c=le("daily-diagram-rules"),m=g.useMemo(()=>Object.values(d.data??{}).filter(l=>{var b,C,I,$,y,w;if(e&&e[l.id]!==void 0||l.nsfw)return!1;const x=l.name.pt.split(" ").length===1;return!!((b=l.decks)!=null&&b.includes("thing")||(C=l.decks)!=null&&C.includes("alien")&&x||(I=l.decks)!=null&&I.includes("manufactured")&&x||($=l.decks)!=null&&$.includes("alien")&&l.aliasesPt&&ye(l.aliasesPt)||(y=l.decks)!=null&&y.includes("manufactured")&&l.aliasesPt&&ye(l.aliasesPt)||(w=l.decks)!=null&&w.includes("meta")&&x)}),[e,d.data]),o=g.useMemo(()=>c.data??{},[c.data]),u=g.useMemo(()=>{const l=Object.values(o).reduce((x,b)=>(x[b.id]=[],x),{});return X.orderBy(Object.values(e),["updatedAt"],["desc"]).forEach(x=>{x.rules.forEach(b=>{l[b].push(x.itemId)})}),l},[e,o]),{is:f,queryParams:j}=de(),[n,p]=g.useState(null);if(d.isLoading||c.isLoading)return t.jsx(S.Text,{children:"Loading..."});const r=l=>{a(l.itemId,l)};return t.jsx(Ie,{hasResponseData:d.hasResponseData||c.hasResponseData,isLoading:d.isLoading||c.isLoading,children:t.jsx("div",{ref:i,children:t.jsxs(Ft,{addEntryToUpdate:a,rules:o,things:e,children:[n&&t.jsx(ue,{isModalOpen:n!==null,okButtonText:"Update",onCancel:()=>p(null),onSaveThing:l=>{r(l),p(null)},rules:o,thing:n,width:s}),(f("display","rule")||!j.has("display"))&&t.jsx(zt,{addEntryToUpdate:a,availableThings:m,containerWidth:s,rules:o,setActiveThing:p,things:e,thingsByRules:u}),f("display","thing")&&t.jsx(Vt,{addEntryToUpdate:a,availableThings:m,rules:o,setActiveThing:p,things:e,thingsByRules:u}),f("display","simulator")&&t.jsx(Dt,{addEntryToUpdate:a,availableThings:m,rules:o,things:e})]})})})}function Oa(){const e=ht({tdrResourceName:"daily-diagram-items",firestoreDataCollectionName:"diagramItems",serialize:!0});return t.jsx(tt,{subtitle:"Diagram Sets",title:"Items",children:t.jsxs(fe,{hasSider:!0,children:[t.jsx(rt,{children:t.jsx(Pt,{...e})}),t.jsx(fe.Content,{className:"content",children:t.jsx(Ie,{error:e.error,hasResponseData:!X.isEmpty(e.data),isLoading:e.isLoading||e.isSaving,children:t.jsx(Y,{gap:24,vertical:!0,children:t.jsx(Bt,{...e})})})})]})})}export{Oa as ItemsDiagramSets,Oa as default};
