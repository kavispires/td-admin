import{X as x,Y as A,Z as L,$ as D,u as I,r as y,a0 as k,j as v,i as M,p as $}from"./index-CTf-mCqX.js";import{Q,b as P,c as q,e as F,d as N,f as j,s as R,g as O,w as T,h as B,l as E,u as U}from"./useBaseUrl-D2YOm4WP.js";import{g as C}from"./useGetFirestoreDoc-CKXhz1bK.js";import{u as H}from"./useTDResource-B7EIjaJI.js";import{c as W}from"./constants-D2J5TbS7.js";function S(t,r){const e=new Set(r);return t.filter(s=>!e.has(s))}function _(t,r,e){const s=t.slice(0);return s[r]=e,s}var K=class extends x{#r;#s;#i;#n;#e;#t;#o;#a;#u;#c=[];constructor(t,r,e){super(),this.#r=t,this.#n=e,this.#i=[],this.#e=[],this.#s=[],this.setQueries(r)}onSubscribe(){this.listeners.size===1&&this.#e.forEach(t=>{t.subscribe(r=>{this.#f(t,r)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#e.forEach(t=>{t.destroy()})}setQueries(t,r){this.#i=t,this.#n=r,A.batch(()=>{const e=this.#e,s=this.#l(this.#i);s.forEach(a=>a.observer.setOptions(a.defaultedQueryOptions));const i=s.map(a=>a.observer),n=i.map(a=>a.getCurrentResult()),u=e.length!==i.length,d=i.some((a,c)=>a!==e[c]),o=u||d,g=o?!0:n.some((a,c)=>{const m=this.#s[c];return!m||!L(a,m)});!o&&!g||(o&&(this.#c=s,this.#e=i),this.#s=n,this.hasListeners()&&(o&&(S(e,i).forEach(a=>{a.destroy()}),S(i,e).forEach(a=>{a.subscribe(c=>{this.#f(a,c)})})),this.#p()))})}getCurrentResult(){return this.#s}getQueries(){return this.#e.map(t=>t.getCurrentQuery())}getObservers(){return this.#e}getOptimisticResult(t,r){const e=this.#l(t),s=e.map(n=>n.observer.getOptimisticResult(n.defaultedQueryOptions)),i=e.map(n=>n.defaultedQueryOptions.queryHash);return[s,n=>this.#h(n??s,r,i),()=>this.#d(s,e)]}#d(t,r){return r.map((e,s)=>{const i=t[s];return e.defaultedQueryOptions.notifyOnChangeProps?i:e.observer.trackResult(i,n=>{r.forEach(u=>{u.observer.trackProp(n)})})})}#h(t,r,e){if(r){const s=this.#u,i=e!==void 0&&s!==void 0&&(s.length!==e.length||e.some((n,u)=>n!==s[u]));return(!this.#t||this.#s!==this.#a||i||r!==this.#o)&&(this.#o=r,this.#a=this.#s,e!==void 0&&(this.#u=e),this.#t=D(this.#t,r(t))),this.#t}return t}#l(t){const r=new Map;this.#e.forEach(s=>{const i=s.options.queryHash;if(!i)return;const n=r.get(i);n?n.push(s):r.set(i,[s])});const e=[];return t.forEach(s=>{const i=this.#r.defaultQueryOptions(s),u=r.get(i.queryHash)?.shift()??new Q(this.#r,i);e.push({defaultedQueryOptions:i,observer:u})}),e}#f(t,r){const e=this.#e.indexOf(t);e!==-1&&(this.#s=_(this.#s,e,r),this.#p())}#p(){if(this.hasListeners()){const t=this.#t,r=this.#d(this.#s,this.#c),e=this.#h(r,this.#n?.combine);t!==e&&A.batch(()=>{this.listeners.forEach(s=>{s(this.#s)})})}}};function z({queries:t,...r},e){const s=I(),i=P(),n=q(),u=y.useMemo(()=>t.map(h=>{const p=s.defaultQueryOptions(h);return p._optimisticResults=i?"isRestoring":"optimistic",p}),[t,s,i]);u.forEach(h=>{F(h);const p=s.getQueryCache().get(h.queryHash);N(h,n,p)}),j(n);const[d]=y.useState(()=>new K(s,u,r)),[o,g,a]=d.getOptimisticResult(u,r.combine),c=!i&&r.subscribed!==!1;y.useSyncExternalStore(y.useCallback(h=>c?d.subscribe(A.batchCalls(h)):k,[d,c]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),y.useEffect(()=>{d.setQueries(u,r)},[u,r,d]);const f=o.some((h,p)=>R(u[p],h))?o.flatMap((h,p)=>{const l=u[p];if(l){const w=new Q(s,l);if(R(l,h))return O(l,w,n);T(h,i)&&O(l,w,n)}return[]}):[];if(f.length>0)throw Promise.all(f);const b=o.find((h,p)=>{const l=u[p];return l&&B({result:h,errorResetBoundary:n,throwOnError:l.throwOnError,query:s.getQueryCache().get(l.queryHash),suspense:l.suspense})});if(b?.error)throw b.error;return g(a())}const V=t=>t.map(e=>{let s="";for(let i=0,n=1;n<e.length;i+=2,n+=2)e[i+2]&&e[n+2]&&(s+=`M${e[i]},${e[n]} L${e[i+2]},${e[n+2]}`);return s}),ts=({drawing:t="",className:r="",width:e=250,height:s,strokeWidth:i="medium",viewBox:n="0 0 500 500"})=>{const u=JSON.parse(t),d=V(u),o={small:3,medium:5,large:7}[i]??5;return v.jsxs("svg",{className:r,overflow:"hidden",style:{width:`${e}px`,height:`${s||e}px`},viewBox:n,xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("defs",{}),d.map((g,a)=>v.jsx("path",{d:g,fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:o},`${t}-${a}`))]})};function X(t,r){const e={pt:"drawingsPT",en:"drawingsEN"},{notification:s}=M.useApp(),i=U({queryKey:["data","suffixCounts"],queryFn:C("data","suffixCounts"),enabled:t});y.useEffect(()=>{i.isSuccess&&$("Loaded data/suffixCounts")},[i.isSuccess]),y.useEffect(()=>{i.isError&&s.error({title:"Error loading data/suffixCounts",placement:"bottomLeft"})},[i.isError]);const n=e[r??"pt"],u=i.data?.[n]??0,d=`drawings${r==="pt"?"PT":"EN"}`,o=y.useMemo(()=>new Array(u).fill(0).map((g,a)=>({queryKey:["data",`${d}${a+1}`],queryFn:C("data",`${d}${a+1}`),enabled:t&&!!u,onSuccess:()=>{s.info({title:`Data Drawings ${d}${a+1} loaded`,placement:"bottomLeft"})}})),[u,d,t]);return z({queries:o})}function G(t){const e=t.split(/::|:;|;;/)[1],s=Number(e);return Number.isNaN(s)&&console.log("ðŸ”† Invalid createdAt",t,s),Number.isNaN(s)?16191612e5:s}function rs(t,r){const e=X(t,r),s=H(`arte-ruim-drawings-${r}`,{enabled:t}),i=e.some(o=>o.isLoading),n=e.every(o=>o.isSuccess),u=y.useMemo(()=>{if(!n)return{};if(!s.isSuccess)return{};const o=s.data??{};return(e??[]).forEach(g=>{const a=g.data??{};Object.entries(a).forEach(([c,m])=>{const f=m.cardId??m.id;if(f?.includes("--"))return;if(m.drawing.trim().length<10){console.log("ðŸ”† Empty drawing",f);return}const b=G(c),h=m.playerId??"unknown",l={id:[f,h,b].join(W),drawing:m.drawing,artistId:h,createdAt:b};o[f]===void 0?o[f]={id:f,text:m.text,drawings:[l],updatedAt:l.createdAt}:o[f].drawings.some(w=>w.id===l.id)||(o[f].drawings.push(l),l.createdAt>o[f].updatedAt&&(o[f].updatedAt=l.createdAt))})}),o},[e,n,s.data,s.isSuccess]),d=y.useMemo(()=>Object.values(u).reduce((o,g)=>(g.drawings.forEach(a=>{const c=a.artistId;o[c]===void 0?o[c]={artistId:c,drawingsCount:1,firstDrawingAt:a.createdAt,lastDrawingAt:a.createdAt}:(o[c].drawingsCount+=1,a.createdAt<o[c].firstDrawingAt&&(o[c].firstDrawingAt=a.createdAt),a.createdAt>o[c].lastDrawingAt&&(o[c].lastDrawingAt=a.createdAt))}),o),{}),[u]);return{isLoading:i||s.isLoading,error:s.error,hasResponseData:!E.isEmpty(u),hasFirestoreData:e.some(o=>!E.isEmpty(o.data)),drawings:u,drawingsPerArtist:Object.values(d),dataUpdatedAt:s.dataUpdatedAt}}const is={"3PkJr":"Flaviane","3c4lY":"Kavis",BPTEL:"Maris","0vuXf":"Marcio",Bm6dr:"Livia",QrfLz:"Stephanie",AlRvI:"Unknown",pK3OY:"Unknown",VF9iG:"Zenaide",WWUvD:"Fernanda",aec7L:"Anonymous",Xsimf:"Carol",fV5ns:"Diego",qQo9N:"Laura",yVAl7:"Rodrigo",O2IQm:"Drica","24qec":"Mariana","5J1Al":"Mateus"};export{is as A,ts as C,rs as a,z as u};
