import{af as x,ag as A,ah as L,ai as D,u as I,r as m,aj as k,j as v,i as M,a5 as $}from"./index-DiQmi0MW.js";import{Q,b as P,c as q,e as F,d as j,f as N,s as R,g as O,w as T,h as B,l as E,u as U}from"./useBaseUrl-D1bg9UhE.js";import{g as S}from"./useGetFirestoreDoc-ClJanLbV.js";import{u as W}from"./useTDResource-B7rQYhkN.js";import{c as _}from"./constants-BVB4j3au.js";function C(t,r){const e=new Set(r);return t.filter(s=>!e.has(s))}function K(t,r,e){const s=t.slice(0);return s[r]=e,s}var z=class extends x{#r;#s;#i;#n;#e;#t;#o;#a;#u=[];constructor(t,r,e){super(),this.#r=t,this.#n=e,this.#i=[],this.#e=[],this.#s=[],this.setQueries(r)}onSubscribe(){this.listeners.size===1&&this.#e.forEach(t=>{t.subscribe(r=>{this.#f(t,r)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#e.forEach(t=>{t.destroy()})}setQueries(t,r){this.#i=t,this.#n=r,A.batch(()=>{const e=this.#e,s=this.#h(this.#i);this.#u=s,s.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const i=s.map(o=>o.observer),a=i.map(o=>o.getCurrentResult()),u=e.length!==i.length,d=i.some((o,c)=>o!==e[c]),n=u||d,p=n?!0:a.some((o,c)=>{const g=this.#s[c];return!g||!L(o,g)});!n&&!p||(n&&(this.#e=i),this.#s=a,this.hasListeners()&&(n&&(C(e,i).forEach(o=>{o.destroy()}),C(i,e).forEach(o=>{o.subscribe(c=>{this.#f(o,c)})})),this.#l()))})}getCurrentResult(){return this.#s}getQueries(){return this.#e.map(t=>t.getCurrentQuery())}getObservers(){return this.#e}getOptimisticResult(t,r){const e=this.#h(t),s=e.map(i=>i.observer.getOptimisticResult(i.defaultedQueryOptions));return[s,i=>this.#d(i??s,r),()=>this.#c(s,e)]}#c(t,r){return r.map((e,s)=>{const i=t[s];return e.defaultedQueryOptions.notifyOnChangeProps?i:e.observer.trackResult(i,a=>{r.forEach(u=>{u.observer.trackProp(a)})})})}#d(t,r){return r?((!this.#t||this.#s!==this.#a||r!==this.#o)&&(this.#o=r,this.#a=this.#s,this.#t=D(this.#t,r(t))),this.#t):t}#h(t){const r=new Map;this.#e.forEach(s=>{const i=s.options.queryHash;if(!i)return;const a=r.get(i);a?a.push(s):r.set(i,[s])});const e=[];return t.forEach(s=>{const i=this.#r.defaultQueryOptions(s),u=r.get(i.queryHash)?.shift()??new Q(this.#r,i);e.push({defaultedQueryOptions:i,observer:u})}),e}#f(t,r){const e=this.#e.indexOf(t);e!==-1&&(this.#s=K(this.#s,e,r),this.#l())}#l(){if(this.hasListeners()){const t=this.#t,r=this.#c(this.#s,this.#u),e=this.#d(r,this.#n?.combine);t!==e&&A.batch(()=>{this.listeners.forEach(s=>{s(this.#s)})})}}};function H({queries:t,...r},e){const s=I(),i=P(),a=q(),u=m.useMemo(()=>t.map(f=>{const b=s.defaultQueryOptions(f);return b._optimisticResults=i?"isRestoring":"optimistic",b}),[t,s,i]);u.forEach(f=>{F(f),j(f,a)}),N(a);const[d]=m.useState(()=>new z(s,u,r)),[n,p,o]=d.getOptimisticResult(u,r.combine),c=!i&&r.subscribed!==!1;m.useSyncExternalStore(m.useCallback(f=>c?d.subscribe(A.batchCalls(f)):k,[d,c]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),m.useEffect(()=>{d.setQueries(u,r)},[u,r,d]);const l=n.some((f,b)=>R(u[b],f))?n.flatMap((f,b)=>{const h=u[b];if(h){const w=new Q(s,h);if(R(h,f))return O(h,w,a);T(f,i)&&O(h,w,a)}return[]}):[];if(l.length>0)throw Promise.all(l);const y=n.find((f,b)=>{const h=u[b];return h&&B({result:f,errorResetBoundary:a,throwOnError:h.throwOnError,query:s.getQueryCache().get(h.queryHash),suspense:h.suspense})});if(y?.error)throw y.error;return p(o())}const V=t=>t.map(e=>{let s="";for(let i=0,a=1;a<e.length;i+=2,a+=2)e[i+2]&&e[a+2]&&(s+=`M${e[i]},${e[a]} L${e[i+2]},${e[a+2]}`);return s}),ts=({drawing:t="",className:r="",width:e=250,height:s,strokeWidth:i="medium",viewBox:a="0 0 500 500"})=>{const u=JSON.parse(t),d=V(u),n={small:3,medium:5,large:7}[i]??5;return v.jsxs("svg",{className:r,overflow:"hidden",style:{width:`${e}px`,height:`${s||e}px`},viewBox:a,xmlns:"http://www.w3.org/2000/svg",children:[v.jsx("defs",{}),d.map((p,o)=>v.jsx("path",{d:p,fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:n},`${t}-${o}`))]})};function G(t,r){const e={pt:"drawingsPT",en:"drawingsEN"},{notification:s}=M.useApp(),i=U({queryKey:["data","suffixCounts"],queryFn:S("data","suffixCounts"),enabled:t});m.useEffect(()=>{i.isSuccess&&$("Loaded data/suffixCounts")},[i.isSuccess]),m.useEffect(()=>{i.isError&&s.error({message:"Error loading data/suffixCounts",placement:"bottomLeft"})},[i.isError]);const a=e[r??"pt"],u=i.data?.[a]??0,d=`drawings${r==="pt"?"PT":"EN"}`,n=m.useMemo(()=>new Array(u).fill(0).map((p,o)=>({queryKey:["data",`${d}${o+1}`],queryFn:S("data",`${d}${o+1}`),enabled:t&&!!u,onSuccess:()=>{s.info({message:`Data Drawings ${d}${o+1} loaded`,placement:"bottomLeft"})}})),[u,d,t]);return H({queries:n})}function J(t){const e=t.split(/::|:;|;;/)[1],s=Number(e);return Number.isNaN(s)&&console.log("ðŸ”† Invalid createdAt",t,s),Number.isNaN(s)?16191612e5:s}function rs(t,r){const e=G(t,r),s=W(`arte-ruim-drawings-${r}`,{enabled:t}),i=e.some(n=>n.isLoading),a=e.every(n=>n.isSuccess),u=m.useMemo(()=>{if(!a)return{};if(!s.isSuccess)return{};const n=s.data??{};return(e??[]).forEach(p=>{const o=p.data??{};Object.entries(o).forEach(([c,g])=>{const l=g.cardId??g.id;if(l?.includes("--"))return;if(g.drawing.trim().length<10){console.log("ðŸ”† Empty drawing",l);return}const y=J(c),f=g.playerId??"unknown",h={id:[l,f,y].join(_),drawing:g.drawing,artistId:f,createdAt:y};n[l]===void 0?n[l]={id:l,text:g.text,drawings:[h],updatedAt:h.createdAt}:n[l].drawings.some(w=>w.id===h.id)||(n[l].drawings.push(h),h.createdAt>n[l].updatedAt&&(n[l].updatedAt=h.createdAt))})}),n},[e,a,s.data,s.isSuccess]),d=m.useMemo(()=>Object.values(u).reduce((n,p)=>(p.drawings.forEach(o=>{const c=o.artistId;n[c]===void 0?n[c]={artistId:c,drawingsCount:1,firstDrawingAt:o.createdAt,lastDrawingAt:o.createdAt}:(n[c].drawingsCount+=1,o.createdAt<n[c].firstDrawingAt&&(n[c].firstDrawingAt=o.createdAt),o.createdAt>n[c].lastDrawingAt&&(n[c].lastDrawingAt=o.createdAt))}),n),{}),[u]);return{isLoading:i||s.isLoading,error:s.error,hasResponseData:!E.isEmpty(u),hasFirestoreData:e.some(n=>!E.isEmpty(n.data)),drawings:u,drawingsPerArtist:Object.values(d),dataUpdatedAt:s.dataUpdatedAt}}const is={"3PkJr":"Flaviane","3c4lY":"Kavis",BPTEL:"Maris","0vuXf":"Marcio",Bm6dr:"Livia",QrfLz:"Stephanie",AlRvI:"Unknown",pK3OY:"Unknown",VF9iG:"Zenaide",WWUvD:"Fernanda",aec7L:"Anonymous",Xsimf:"Carol",fV5ns:"Diego",qQo9N:"Laura",yVAl7:"Rodrigo",O2IQm:"Drica","24qec":"Mariana","5J1Al":"Mateus"};export{is as A,ts as C,rs as a,H as u};
