"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[1187],{8158:(e,t,s)=>{s.d(t,{CQ:()=>h,bN:()=>p,cw:()=>x,hW:()=>g,xL:()=>m});var i=s(1105),a=s(2556),n=s(1310),r=s(2997),l=s(8955),o=s(5458),d=s(1087),c=s(7134),u=s(184);function m(e){let{item:t,width:s,className:i}=e;return(0,u.jsx)(r.ck,{id:t.id,width:s,title:"".concat(t.name.en," | ").concat(t.name.pt),className:i})}function p(e){let{item:t}=e;const s=(0,c._)();return(0,u.jsx)("span",{children:(0,u.jsx)(i.Z,{prefix:t.nsfw?(0,u.jsx)(l.Z,{style:{color:"hotPink"}}):(0,u.jsx)(o.Z,{}),placeholder:"Id",variant:"borderless",size:"small",value:t.id,readOnly:!0,style:{width:"8ch"},onClick:()=>s(t.id)})})}function h(e){let{item:t,language:s}=e;return(0,u.jsx)(i.Z,{prefix:(0,u.jsx)(n.H,{language:s,width:"1em"}),placeholder:"Name in ".concat(s.toUpperCase()),variant:"borderless",size:"small",value:t.name[s],readOnly:!0})}function g(e){let{item:t}=e;return t.nsfw?(0,u.jsx)(l.Z,{style:{color:"hotpink"}}):(0,u.jsx)(u.Fragment,{})}function x(e){let{item:t}=e;const[,s]=(0,d.lr)();return(0,u.jsx)("span",{children:(0,u.jsx)(a.ZP,{size:"small",shape:"round",onClick:()=>{s({itemId:t.id,view:"classifier"})},children:"Go to"})})}},548:(e,t,s)=>{s.d(t,{P:()=>a});var i=s(4766);function a(e){var t,s;let{prefix:a="",defaultCurrent:n=1,defaultPageSize:r=10,pageSizeOptions:l=[10,20,50,100],total:o,showQuickJumper:d}=e;const{queryParams:c,addParam:u}=(0,i.K)();return{current:Number(null!==(t=c.get("".concat(a,"page")))&&void 0!==t?t:String(n)),pageSize:Number(null!==(s=c.get("".concat(a,"pageSize")))&&void 0!==s?s:String(r)),onChange:e=>{u("".concat(a,"page"),e.toString(),String(n))},onShowSizeChange:(e,t)=>{u("".concat(a,"pageSize"),t.toString(),String(r))},defaultCurrent:n,defaultPageSize:r,pageSizeOptions:l,total:o,hideOnSinglePage:!0,showQuickJumper:d}}},8440:(e,t,s)=>{s.r(t),s.d(t,{ItemsGroups:()=>K,default:()=>M});var i=s(3990),a=s(2128),n=s(4520),r=s(4031),l=s(122),o=s(1046),d=s(2556),c=s(3320),u=s(6106),m=s(914),p=s(2228),h=s(2997),g=s(7134),x=s(4290),j=s(4766),y=s(5529),v=s(763),I=s(2791),f=s(5850),S=s(731),Z=s(7765),k=s(8158),b=s(184);function w(e){let{item:t,itemGroups:s,groupsTypeahead:i,onUpdateItemGroups:a}=e;const n=(0,g._)();return(0,b.jsxs)(S.Z,{title:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Z.Text,{onClick:()=>n(t.id),children:t.id}),(0,b.jsx)(k.hW,{item:t})]}),style:{maxWidth:250},children:[(0,b.jsx)(k.xL,{item:t,width:75}),(0,b.jsxs)(o.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,b.jsx)(k.CQ,{item:t,language:"en"}),(0,b.jsx)(k.CQ,{item:t,language:"pt"}),(0,b.jsx)(Z.Z,{mode:"tags",style:{width:"100%"},placeholder:"Select a group",defaultValue:s,options:i,showSearch:!0,size:"small",onChange:e=>a(t.id,e)},String(s))]})]})}var C=s(548),G=s(6173),N=s(8178);function O(e){let{data:t,addEntryToUpdate:s}=e;const{is:i,queryParams:a}=(0,j.K)(),n=(0,y.N)("items"),r=(0,I.useMemo)((()=>Object.values(null!==t&&void 0!==t?t:[]).reduce(((e,t)=>(t.itemsIds||console.warn("Group without items",t),t.itemsIds.forEach((s=>{e[s]||(e[s]=[]),e[s].push(t.id)})),e)),{})),[t]),l=(0,I.useMemo)((()=>(0,v.orderBy)(Object.keys(t).map((e=>({label:e,value:e}))),"label")),[t]),o=(e,i)=>{var a;const n=null!==(a=r[e])&&void 0!==a?a:[],l=i.filter((e=>!n.includes(e))),o=n.filter((e=>!i.includes(e)));l.forEach((i=>{var a,n;s(i,{id:i,itemsIds:(0,f.R1)([...null!==(a=null===(n=t[i])||void 0===n?void 0:n.itemsIds)&&void 0!==a?a:[],e])})})),o.forEach((i=>{var a;s(i,{id:i,itemsIds:(0,f.R1)(null===(a=t[i])||void 0===a?void 0:a.itemsIds.filter((t=>t!==e)))})}))},d=(e,t)=>{s(e,{id:e,itemsIds:(0,f.R1)(t)})};return(0,b.jsxs)(b.Fragment,{children:[(i("display","group")||!a.has("display"))&&(0,b.jsx)(z,{data:t,items:n.data,grousByItem:r,groupsTypeahead:l,onUpdateItemGroups:o,onUpdateGroupItems:d}),i("display","item")&&(0,b.jsx)(U,{data:t,items:n.data,grousByItem:r,groupsTypeahead:l,onUpdateItemGroups:o,onUpdateGroupItems:d})]})}function z(e){let{data:t,items:s,grousByItem:i,groupsTypeahead:a,onUpdateItemGroups:u,onUpdateGroupItems:m}=e;const p=(0,g._)(),x=(0,y.N)("items"),[j,v]=(0,I.useState)(null),S=(0,C.P)({showQuickJumper:!0,total:Object.keys(t).length}),Z=[{title:"id",dataIndex:"id",key:"id",render:e=>(0,b.jsx)("span",{children:e})},{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(e,t)=>(0,b.jsx)(n.Z,{gap:6,wrap:"wrap",children:e.map((e=>(0,b.jsxs)(n.Z,{gap:2,vertical:!0,children:[(0,b.jsx)(G.F6,{onClick:()=>v(e),children:(0,b.jsx)(h.ck,{id:e,width:60})}),(0,b.jsx)(n.Z,{justify:"center",children:(0,b.jsx)(r.Z.Text,{onClick:()=>p(e),children:e})})]},"".concat(t.id,"-").concat(e))))},"items-".concat(t.id))},l.Z.EXPAND_COLUMN,{title:"Count",dataIndex:"itemsIds",key:"count",render:e=>(0,f.R1)(e).filter(Boolean).length},{title:"Actions",dataIndex:"itemsIds",key:"actions",render:e=>(0,b.jsx)(o.Z,{direction:"vertical",size:"small",children:(0,b.jsx)(d.ZP,{size:"small",onClick:()=>p(JSON.stringify(e)),children:"Copy Ids"})})}],k=j?s[j]:null;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Z,{columns:Z,dataSource:Object.values(t),className:"my-4",rowKey:"id",pagination:S,expandable:{expandedRowRender:e=>(0,b.jsx)(P,{group:e,onUpdateGroupItems:m}),rowExpandable:()=>x.isSuccess}}),(0,b.jsx)(c.Z,{title:"Edit Item Group",onClose:()=>v(null),open:!!k,children:k&&(0,b.jsx)(w,{item:k,itemGroups:i[k.id],groupsTypeahead:a,onUpdateItemGroups:u})})]})}function P(e){let{group:t,onUpdateGroupItems:s}=e;return(0,b.jsx)("div",{children:(0,b.jsx)(N.i,{onFinish:e=>{s(t.id,[...t.itemsIds,e])}})})}function U(e){let{items:t,grousByItem:s,groupsTypeahead:i,onUpdateItemGroups:a}=e;const{is:n}=(0,j.K)(),l=n("emptyOnly"),o=(0,I.useMemo)((()=>l?Object.values(t).filter((e=>!s[e.id])):Object.values(t)),[t,s,l]),{page:d,pagination:c}=(0,x.e)({data:o});return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(r.Z.Title,{level:2,children:["Groups by Items (",o.length,")"]}),(0,b.jsx)(p.N,{pagination:c,children:(0,b.jsx)(u.Z,{gutter:[16,16],className:"my-4",children:d.map((e=>(0,b.jsx)(m.Z,{xs:24,sm:24,md:12,lg:6,xl:4,children:(0,b.jsx)(w,{item:e,itemGroups:s[e.id],groupsTypeahead:i,onUpdateItemGroups:a})},e.id)))})})]})}var T=s(7128),E=s(7018),B=s(1958),R=s(3660),D=s(9197),F=s(7340);function L(e){var t;let{data:s,save:i,isDirty:a,isSaving:r,entriesToUpdate:l}=e;const{queryParams:o,addParam:d,addParams:c,is:u}=(0,j.K)();return(0,b.jsxs)(B.Pd,{children:[(0,b.jsxs)(n.Z,{vertical:!0,gap:12,children:[(0,b.jsx)(F.k,{isDirty:a,onSave:i,isSaving:r,dirt:JSON.stringify(Q(l))}),(0,b.jsx)(E.o,{data:()=>{return e=s,Object.keys(e).forEach((t=>{e[t].itemsIds=(0,f.E4)((0,f.R1)(e[t].itemsIds))})),(0,f.Tj)(Q(e));var e},fileName:"items-groups.json",disabled:a,block:!0})]}),(0,b.jsx)(T.Z,{}),(0,b.jsx)(G.H,{label:"Display",value:null!==(t=o.get("display"))&&void 0!==t?t:"group",onChange:e=>c({display:e,page:1},{page:1}),options:[{title:"By Groups",icon:(0,b.jsx)(R.Z,{}),value:"group"},{title:"By Items",icon:(0,b.jsx)(D.Z,{}),value:"item"}]}),u("display","item")&&(0,b.jsx)(G.Do,{label:"No Groups Only",value:u("emptyOnly"),onChange:e=>d("emptyOnly",e,!1)})]})}function Q(e){return(0,v.omitBy)((0,v.cloneDeep)(e),(e=>(0,v.isEmpty)(e.itemsIds)))}var _=s(4562),J=s(8938);function K(){const e=(0,J.i)({tdrResourceName:"items-groups",firebaseDataCollectionName:"itemsGroups",serialize:!0}),t=(0,y.N)("items");return(0,b.jsx)(B.Xg,{title:"Items",subtitle:"Groups Sets",children:(0,b.jsxs)(i.Z,{hasSider:!0,children:[(0,b.jsx)(_.p,{children:(0,b.jsx)(L,{...e})}),(0,b.jsx)(i.Z.Content,{className:"content",children:(0,b.jsx)(a.T,{isLoading:e.isLoading||t.isLoading,error:e.error||t.error,hasResponseData:!(0,v.isEmpty)(e.data)&&!(0,v.isEmpty)(t.data),children:(0,b.jsx)(O,{...e})})})]})})}const M=K}}]);
//# sourceMappingURL=ItemsGroups.d086246a.chunk.js.map