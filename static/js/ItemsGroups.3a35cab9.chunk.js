"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[1187],{8158:(e,s,t)=>{t.d(s,{CQ:()=>x,bN:()=>p,cw:()=>j,hW:()=>h,xL:()=>m});var i=t(2061),a=t(2252),n=t(1310),r=t(2997),d=t(8955),l=t(5458),o=t(1087),c=t(7134),u=t(184);function m(e){let{item:s,width:t,className:i}=e;return(0,u.jsx)(r.ck,{id:s.id,width:t,title:"".concat(s.name.en," | ").concat(s.name.pt),className:i})}function p(e){let{item:s}=e;const t=(0,c._)();return(0,u.jsx)("span",{children:(0,u.jsx)(i.Z,{prefix:s.nsfw?(0,u.jsx)(d.Z,{style:{color:"hotPink"}}):(0,u.jsx)(l.Z,{}),placeholder:"Id",variant:"borderless",size:"small",value:s.id,readOnly:!0,style:{width:"8ch"},onClick:()=>t(s.id)})})}function x(e){let{item:s,language:t}=e;return(0,u.jsx)(i.Z,{prefix:(0,u.jsx)(n.H,{language:t,width:"1em"}),placeholder:"Name in ".concat(t.toUpperCase()),variant:"borderless",size:"small",value:s.name[t],readOnly:!0})}function h(e){let{item:s}=e;return s.nsfw?(0,u.jsx)(d.Z,{style:{color:"hotpink"}}):(0,u.jsx)(u.Fragment,{})}function j(e){let{item:s}=e;const[,t]=(0,o.lr)();return(0,u.jsx)("span",{children:(0,u.jsx)(a.ZP,{size:"small",shape:"round",onClick:()=>{t({itemId:s.id,view:"classifier"})},children:"Go to"})})}},8440:(e,s,t)=>{t.r(s),t.d(s,{ItemsGroups:()=>Q,default:()=>A});var i=t(1790),a=t(2128),n=t(4520),r=t(945),d=t(4453),l=t(3320),o=t(6106),c=t(914),u=t(2228),m=t(2997),p=t(7134),x=t(4290),h=t(4766),j=t(5529),g=t(763),y=t(2791),I=t(5850),v=t(6473),f=t(1046),Z=t(5437),G=t(8158),b=t(184);function k(e){let{item:s,itemGroups:t,groupsTypeahead:i,onUpdateItemGroups:a}=e;const n=(0,p._)();return(0,b.jsxs)(v.Z,{title:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Z.Text,{onClick:()=>n(s.id),children:s.id}),(0,b.jsx)(G.hW,{item:s})]}),style:{maxWidth:250},children:[(0,b.jsx)(G.xL,{item:s,width:75}),(0,b.jsxs)(f.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,b.jsx)(G.CQ,{item:s,language:"en"}),(0,b.jsx)(G.CQ,{item:s,language:"pt"}),(0,b.jsx)(Z.Z,{mode:"tags",style:{width:"100%"},placeholder:"Select a group",defaultValue:t,options:i,showSearch:!0,size:"small",onChange:e=>a(s.id,e)},String(t))]})]})}var w=t(548),C=t(8357),N=t(8178),U=t(4850);function O(e){let{data:s,addEntryToUpdate:t}=e;const{is:i,queryParams:a}=(0,h.K)(),n=(0,j.N)("items"),r=(0,y.useMemo)((()=>Object.values(null!==s&&void 0!==s?s:[]).reduce(((e,s)=>(s.itemsIds||console.warn("Group without items",s),s.itemsIds.forEach((t=>{e[t]||(e[t]=[]),e[t].push(s.id)})),e)),{})),[s]),d=(0,y.useMemo)((()=>(0,g.orderBy)(Object.keys(s).map((e=>({label:e,value:e}))),"label")),[s]),l=(e,i)=>{var a;const n=null!==(a=r[e])&&void 0!==a?a:[],d=i.filter((e=>!n.includes(e))),l=n.filter((e=>!i.includes(e)));d.forEach((i=>{var a,n;t(i,{id:i,itemsIds:(0,I.R1)([...null!==(a=null===(n=s[i])||void 0===n?void 0:n.itemsIds)&&void 0!==a?a:[],e])})})),l.forEach((i=>{var a;t(i,{id:i,itemsIds:(0,I.R1)(null===(a=s[i])||void 0===a?void 0:a.itemsIds.filter((s=>s!==e)))})}))},o=(e,s)=>{t(e,{id:e,itemsIds:(0,I.R1)(s)})};return(0,b.jsxs)(b.Fragment,{children:[(i("display","group")||!a.has("display"))&&(0,b.jsx)(T,{data:s,items:n.data,grousByItem:r,groupsTypeahead:d,onUpdateItemGroups:l,onUpdateGroupItems:o}),i("display","item")&&(0,b.jsx)(S,{data:s,items:n.data,grousByItem:r,groupsTypeahead:d,onUpdateItemGroups:l,onUpdateGroupItems:o})]})}function T(e){let{data:s,items:t,grousByItem:i,groupsTypeahead:a,onUpdateItemGroups:o,onUpdateGroupItems:c}=e;const u=(0,p._)(),x=(0,j.N)("items"),[h,g]=(0,y.useState)(null),v=(0,w.P)({showQuickJumper:!0,total:Object.keys(s).length}),f=[{title:"id",dataIndex:"id",key:"id",render:e=>(0,b.jsx)("span",{children:e})},{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(e,s)=>(0,b.jsx)(n.Z,{gap:6,wrap:"wrap",children:e.map((e=>(0,b.jsxs)(n.Z,{gap:2,vertical:!0,children:[(0,b.jsx)(C.F6,{onClick:()=>g(e),children:(0,b.jsx)(m.ck,{id:e,width:60})}),(0,b.jsx)(n.Z,{justify:"center",children:(0,b.jsx)(r.Z.Text,{onClick:()=>u(e),children:e})})]},"".concat(s.id,"-").concat(e))))},"items-".concat(s.id))},d.Z.EXPAND_COLUMN,{title:"Count",dataIndex:"itemsIds",key:"count",render:e=>(0,I.R1)(e).filter(Boolean).length},{title:"Actions",dataIndex:"itemsIds",key:"actions",render:e=>(0,b.jsx)(U.A,{ids:e})}],Z=h?t[h]:null;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.Z,{columns:f,dataSource:Object.values(s),className:"my-4",rowKey:"id",pagination:v,expandable:{expandedRowRender:e=>(0,b.jsx)(E,{group:e,onUpdateGroupItems:c}),rowExpandable:()=>x.isSuccess}}),(0,b.jsx)(l.Z,{title:"Edit Item Group",onClose:()=>g(null),open:!!Z,children:Z&&(0,b.jsx)(k,{item:Z,itemGroups:i[Z.id],groupsTypeahead:a,onUpdateItemGroups:o})})]})}function E(e){let{group:s,onUpdateGroupItems:t}=e;return(0,b.jsx)("div",{children:(0,b.jsx)(N.i,{onFinish:e=>{t(s.id,[...s.itemsIds,e])}})})}function S(e){let{items:s,grousByItem:t,groupsTypeahead:i,onUpdateItemGroups:a}=e;const{is:n}=(0,h.K)(),d=n("emptyOnly"),l=(0,y.useMemo)((()=>d?Object.values(s).filter((e=>!t[e.id])):Object.values(s)),[s,t,d]),{page:m,pagination:p}=(0,x.e)({data:l});return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(r.Z.Title,{level:2,children:["Groups by Items (",l.length,")"]}),(0,b.jsx)(u.N,{pagination:p,children:(0,b.jsx)(o.Z,{gutter:[16,16],className:"my-4",children:m.map((e=>(0,b.jsx)(c.Z,{xs:24,sm:24,md:12,lg:6,xl:4,children:(0,b.jsx)(k,{item:e,itemGroups:t[e.id],groupsTypeahead:i,onUpdateItemGroups:a})},e.id)))})})]})}var B=t(7128),P=t(7018),R=t(7965),D=t(3660),F=t(9197),z=t(7340);function L(e){var s;let{data:t,save:i,isDirty:a,isSaving:r,entriesToUpdate:d}=e;const{queryParams:l,addParam:o,addParams:c,is:u}=(0,h.K)();return(0,b.jsxs)(R.Pd,{children:[(0,b.jsxs)(n.Z,{vertical:!0,gap:12,children:[(0,b.jsx)(z.k,{isDirty:a,onSave:i,isSaving:r,dirt:JSON.stringify(_(d))}),(0,b.jsx)(P.o,{data:()=>{return e=t,Object.keys(e).forEach((s=>{e[s].itemsIds=(0,I.E4)((0,I.R1)(e[s].itemsIds))})),(0,I.Tj)(_(e));var e},fileName:"items-groups.json",disabled:a,block:!0})]}),(0,b.jsx)(B.Z,{}),(0,b.jsx)(C.H,{label:"Display",value:null!==(s=l.get("display"))&&void 0!==s?s:"group",onChange:e=>c({display:e,page:1},{page:1}),options:[{title:"By Groups",icon:(0,b.jsx)(D.Z,{}),value:"group"},{title:"By Items",icon:(0,b.jsx)(F.Z,{}),value:"item"}]}),u("display","item")&&(0,b.jsx)(C.Do,{label:"No Groups Only",value:u("emptyOnly"),onChange:e=>o("emptyOnly",e,!1)})]})}function _(e){return(0,g.omitBy)((0,g.cloneDeep)(e),(e=>(0,g.isEmpty)(e.itemsIds)))}var K=t(4562),M=t(8938);function Q(){const e=(0,M.i)({tdrResourceName:"items-groups",firebaseDataCollectionName:"itemsGroups",serialize:!0}),s=(0,j.N)("items");return(0,b.jsx)(R.Xg,{title:"Items",subtitle:"Groups Sets",children:(0,b.jsxs)(i.Z,{hasSider:!0,children:[(0,b.jsx)(K.p,{children:(0,b.jsx)(L,{...e})}),(0,b.jsx)(i.Z.Content,{className:"content",children:(0,b.jsx)(a.T,{isLoading:e.isLoading||s.isLoading,error:e.error||s.error,hasResponseData:!(0,g.isEmpty)(e.data)&&!(0,g.isEmpty)(s.data),children:(0,b.jsx)(O,{...e})})})]})})}const A=Q}}]);
//# sourceMappingURL=ItemsGroups.3a35cab9.chunk.js.map