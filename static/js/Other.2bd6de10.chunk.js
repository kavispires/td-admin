"use strict";(self.webpackChunktdr=self.webpackChunktdr||[]).push([[407],{9961:(t,e,a)=>{a.d(e,{m:()=>i});var n=a(2556),o=a(3414),r=a(7134),s=a(184);function i(t){let{content:e,shape:a,icon:i,size:l,...u}=t;const d=(0,r._)();return(0,s.jsx)(n.ZP,{shape:null!==a&&void 0!==a?a:"circle",icon:null!==i&&void 0!==i?i:(0,s.jsx)(o.Z,{}),size:null!==l&&void 0!==l?l:"small",onClick:()=>d(e),...u})}},5555:(t,e,a)=>{a.d(e,{Ld:()=>w,l9:()=>A,ve:()=>L});var n=a(4747),o=a(2481),r=a(5860),s=a(3418),i=a(6807),l=a(8027);const u={SUFFIX_DATA:{pt:"drawingsPT",en:"drawingsEN"},DAILY:{pt:"diario",en:"daily"}};var d=a(2791),c=a(829);var m=a(763),f=a(2606);var v=a(5529),p=a(2426),y=a.n(p);function g(){return y()().format("YYYY-MM-DD")}function h(t){return y()(t,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD")}function b(t){const e=[],a={};let n=0;for(;e.length<4&&n<500;){var o;const r=null!==(o=(0,m.sample)(t))&&void 0!==o?o:"",s=r.split("");s.every((t=>!a[t]))?(e.push(r),s.forEach((t=>{a[t]=!0}))):n++}if(n>500||e.length<4)for(console.count("Could not find 4 words with unique letters");e.length<4;){var r;const a=null!==(r=(0,m.sample)(t))&&void 0!==r?r:"";e.includes(a)||e.push(a)}return e.length<4&&console.error("Could not find 4 words with unique letters",e),e}function D(t,e){const a=(0,d.useMemo)((()=>{var a;return null!==(a=null===e||void 0===e?void 0:e[t])&&void 0!==a?a:{latestDate:g(),latestNumber:0,used:"[]"}}),[e,t]);return[(0,d.useMemo)((()=>{var t,e,n;return{latestNumber:null!==(t=null===a||void 0===a?void 0:a.latestNumber)&&void 0!==t?t:0,latestDate:null!==(e=null===a||void 0===a?void 0:a.latestDate)&&void 0!==e?e:g(),used:JSON.parse(null!==(n=null===a||void 0===a?void 0:a.used)&&void 0!==n?n:"[]")}}),[a]),a]}function w(t,e,a,o){const{notification:r}=n.Z.useApp(),s=u.DAILY[null!==e&&void 0!==e?e:"pt"],p=(0,i.a)({queryKey:[s,"history"],queryFn:(0,l.A)(s,"history"),enabled:t,onSuccess:()=>{r.info({message:"Data Daily History loaded",placement:"bottomLeft"})},onError:()=>{r.error({message:"Error loading daily history",placement:"bottomLeft"})}}),y=function(t,e){var a,o;const{notification:r}=n.Z.useApp(),s=(0,i.a)({queryKey:["data","suffixCounts"],queryFn:(0,l.A)("data","suffixCounts"),enabled:t,onSuccess:()=>{r.info({message:"Data Suffix Counts loaded",placement:"bottomLeft"})},onError:()=>{r.error({message:"Error loading suffix counts",placement:"bottomLeft"})}}),m=u.SUFFIX_DATA[null!==e&&void 0!==e?e:"pt"],f=null!==(a=null===(o=s.data)||void 0===o?void 0:o[m])&&void 0!==a?a:0,v="drawings".concat("pt"===e?"PT":"EN"),p=(0,d.useMemo)((()=>new Array(f).fill(0).map(((e,a)=>({queryKey:["data","".concat(v).concat(a+1)],queryFn:(0,l.A)("data","".concat(v).concat(a+1)),enabled:t&&Boolean(f),onSuccess:()=>{r.info({message:"Data Drawings ".concat(v).concat(a+1," loaded"),placement:"bottomLeft"})}})))),[f]);return(0,c.h)({queries:p})}(t,null!==e&&void 0!==e?e:"pt"),g=y.some((t=>t.isLoading)),[w]=D("arte-ruim",p.data),q=(0,d.useMemo)((()=>{console.count("Creating Arte Ruim...");const t=(null!==y&&void 0!==y?y:[]).reduce(((t,a)=>{var n;const o=null!==(n=a.data)&&void 0!==n?n:{};return Object.entries(o).forEach((a=>{var n;let[o,r]=a;const s=null!==(n=r.cardId)&&void 0!==n?n:r.id;if(r.drawing.trim().length<10)return console.warn("Empty drawing",s),t;void 0===t[s]?t[s]={id:s,type:"arte-ruim",language:null!==e&&void 0!==e?e:"pt",cardId:s,text:r.text,drawings:[r.drawing],number:0,dataIds:[o]}:(t[s].drawings.push(r.drawing),t[s].dataIds.push(o))})),t}),{}),n=Object.values(t).filter((t=>{var e;return t.drawings.length>=a&&t.cardId&&!(null!==(e=t.cardId)&&void 0!==e&&e.includes("--"))})),r=Object.values(n).filter((t=>!w.used.includes(t.cardId))),s=(0,m.sampleSize)((0,m.shuffle)(r),o);let i=w.latestDate;return s.map(((t,e)=>{const a=h(i);return i=a,{...t,id:a,number:w.latestNumber+e+1}}))}),[y,e,w,o,a]),N=(0,v.N)("aqui-o-sets"),[A]=D("aqui-o",p.data),L=(0,d.useMemo)((()=>{console.count("Creating Aqui \xd3...");const t=(0,m.shuffle)(Object.values(N.data).filter((t=>t.itemsIds.filter(Boolean).length>=20)));let e=t.filter((t=>!A.used.includes(t.id)));e.length<o&&e.push(...(0,m.shuffle)(t));let a=A.latestDate;const n={};for(let r=0;r<o;r++){const t=e[r];if(!t)break;const o=h(a);a=o,n[o]={id:o,type:"aqui-o",number:A.latestNumber+r+1,setId:t.id,title:t.title,itemsIds:["0",...(0,m.sampleSize)(t.itemsIds,20)]}}return n}),[N,A,o]),x=function(t,e){var a;let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3?arguments[3]:void 0;const{getUrl:r}=(0,f.n)("tdr"),s=o?"words-".concat(t,"-letters-selected-").concat(e):"words-".concat(t,"-letters-").concat(e),l=(0,i.a)({queryKey:[s],queryFn:async()=>{const t=await fetch(r("".concat(s,".json")));return await t.json()},enabled:n&&!!t&&!!e}),u=!(0,m.isEmpty)(l.data);return{...l,data:null!==(a=l.data)&&void 0!==a?a:[],hasResponseData:u}}(4,e,!0,!0),[I]=D("palavreado",p.data),S=(0,d.useMemo)((()=>{console.count("Creating Palavreado...");let t=I.latestDate;const e={};for(let a=0;a<o;a++){const n=b(x.data),o=(0,m.shuffle)(n.join("").split("")),r=h(t);t=r,e[r]={id:r,type:"palavreado",number:I.latestNumber+a+1,words:n,letters:o}}return e}),[x,I,o]),j=(0,v.N)("arte-ruim-cards-".concat(e)),[E]=D("artista",p.data),Y=(0,d.useMemo)((()=>{console.count("Creating Artista...");let t=E.latestDate;const e={};for(let n=0;n<o;n++){var a;const o=h(t),r=Object.keys(null!==(a=j.data)&&void 0!==a?a:{}).filter((t=>!w.used.includes(t))),s=(0,m.sampleSize)(r,15).map((t=>j.data[t]));t=o,e[o]={id:o,type:"artista",number:E.latestNumber+n+1,cards:s}}return e}),[j,w,E,o]),Z=(0,d.useMemo)((()=>(console.count("Bundling entries..."),q.map((t=>({id:t.id,"arte-ruim":t,"aqui-o":L[t.id],palavreado:S[t.id],artista:Y[t.id]}))))),[q,L,S,Y]);return{isLoading:g||p.isLoading,entries:Z}}var q=a(5850),N=a(6403);function A(t){const{notification:e}=n.Z.useApp(),a=(0,N.NL)(),c=u.DAILY[null!==t&&void 0!==t?t:"pt"],[m,f]=(0,d.useState)(!1),v=(0,i.a)({queryKey:[c,"history"],queryFn:(0,l.A)(c,"history"),enabled:Boolean(c),onSuccess:()=>{e.info({message:"Data Daily History loaded",placement:"bottomLeft"})},onError:()=>{e.error({message:"Error loading daily history",placement:"bottomLeft"})}}),p=(0,s.D)((async t=>{var e;const a=t.map((t=>{const e=(0,o.JU)(r.RZ,"".concat(c,"/").concat(t.id));return(0,o.pl)(e,t)})),n=(0,o.JU)(r.RZ,"".concat(c,"/history")),s=v.data;if(!s)throw new Error("No previous history");const i={...s,"arte-ruim":{latestDate:t[t.length-1].id,latestNumber:t[t.length-1]["arte-ruim"].number,used:JSON.stringify((0,q.R1)([...JSON.parse(s["arte-ruim"].used),...t.map((t=>t["arte-ruim"].cardId))]))},"aqui-o":{latestDate:t[t.length-1].id,latestNumber:t[t.length-1]["aqui-o"].number,used:JSON.stringify((0,q.R1)([...JSON.parse(null!==(e=s["aqui-o"].used)&&void 0!==e?e:"[]"),...t.map((t=>t["aqui-o"].setId))]))},palavreado:{latestDate:t[t.length-1].id,latestNumber:t[t.length-1].palavreado.number,used:"[]"},artista:{latestDate:t[t.length-1].id,latestNumber:t[t.length-1].artista.number,used:"[]"}};return(0,o.pl)(n,i),Promise.all(a)}),{onSuccess:()=>{e.info({message:"Data saved",placement:"bottomLeft"}),a.invalidateQueries([c,"history"]),f(!1)},onError:()=>{e.error({message:"Error saving data",placement:"bottomLeft"})}});return{isDirty:m,setIsDirty:f,save:p.mutateAsync,isLoading:p.isLoading}}function L(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{notification:e}=n.Z.useApp(),a=u.DAILY.pt,d=(0,s.D)({mutationFn:async t=>{const e=(0,o.JU)(r.RZ,"".concat(a,"/history"));(0,o.pl)(e,t)},onSuccess:()=>{e.info({message:"New history data saved",placement:"bottomLeft"})}}),c=(0,i.a)({queryKey:[a,"history"],queryFn:(0,l.A)(a,"history"),enabled:t,onSuccess:t=>{e.info({message:"Data Daily History loaded",placement:"bottomLeft"})},onError:()=>{e.error({message:"Error loading daily history",placement:"bottomLeft"})}});return{mutation:d,historyQuery:c}}},8027:(t,e,a)=>{a.d(e,{A:()=>i,X:()=>l});var n=a(2481),o=a(5860),r=a(6807),s=a(5850);function i(t,e){return async()=>{var a;console.log("%cQuerying ".concat(t,"/").concat(e," from firebase: ").concat((0,s.xE)()),"color: #f0f");const r=(0,n.JU)(o.RZ,"".concat(t,"/").concat(e));return null!==(a=(await(0,n.QT)(r)).data())&&void 0!==a?a:{}}}function l(t,e,a){return(0,r.a)({queryKey:["firebase",t,e],queryFn:i(t,e),...a})}},5906:(t,e,a)=>{a.r(e),a.d(e,{default:()=>v});var n=a(8914),o=a(3990),r=a(7128),s=a(1692),i=a(2791),l=a(6509),u=(a(6591),a(2128),a(5850),a(9961));var d=a(3398),c=a(5555),m=a(184);const{Text:f}=n.Z;const v=function(){(0,l.Z)("Other");const{historyQuery:t,mutation:e}=(0,c.ve)();console.log(t.data);const a=(0,i.useMemo)((()=>JSON.stringify(t.data,null,4)),[t.data]);return(0,m.jsxs)(o.Z,{children:[(0,m.jsx)(d.h,{title:"Other"}),(0,m.jsx)(r.Z,{}),(0,m.jsx)(o.Z.Content,{className:"content",children:(0,m.jsxs)("div",{className:"a",children:[(0,m.jsx)("button",{onClick:()=>e.mutate(t.data),children:"save"}),(0,m.jsxs)(f,{children:["Output ",(0,m.jsx)(u.m,{content:a})]}),(0,m.jsx)(s.Z.TextArea,{name:"search-results",id:"",cols:"10",rows:"10",readOnly:!0,value:a})]})})]})}}}]);
//# sourceMappingURL=Other.2bd6de10.chunk.js.map