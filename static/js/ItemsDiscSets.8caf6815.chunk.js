"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[2695],{7018:(e,t,n)=>{n.d(t,{o:()=>r});var a=n(2556),i=n(5850),s=n(184);function r(e){let{data:t,fileName:n,loading:r,...o}=e;return(0,s.jsx)(a.ZP,{onClick:()=>(0,i.ZN)("function"===typeof t?t():t,n),loading:r,...o,children:"Download JSON"})}},7340:(e,t,n)=>{n.d(t,{k:()=>l});var a=n(2556),i=n(2426),s=n.n(i),r=n(2791),o=n(8211),d=n(4483),c=n(184);function l(e){let{isDirty:t,onSave:n,isSaving:i,dirt:l,interval:u=6e5,...p}=e;const[,m,v]=(0,o.Z)((()=>{t&&n()}),u);return(0,r.useEffect)((()=>{t?(console.log("Save Reset",s()(Date.now()).format("MM/DD/YYYY HH:mm:ss")),v()):m()}),[t,v,m,l]),(0,r.useEffect)((()=>{const e=e=>{if(t){const t="You have unsaved changes, are you sure you want to leave?";return e.returnValue=t,t}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[t]),(0,c.jsx)(a.ZP,{type:"primary",size:"large",icon:(0,c.jsx)(d.Z,{}),onClick:n,disabled:!t,loading:i,danger:!0,block:!0,...p,children:"Save"})}},8178:(e,t,n)=>{n.d(t,{i:()=>l});var a=n(5),i=n(1105),s=n(5529),r=n(763),o=n(2791),d=n(5675),c=n(184);function l(e){let{items:t,isPending:n,style:l,size:u,placeholder:p,allowClear:m,onFinish:v,...h}=e;const g=(0,s.N)("items",!Boolean(t)&&!n),{namesDict:f,options:x}=(0,o.useMemo)((()=>{var e;console.log("Recomputing item names typeahead...");const n=Object.values(null!==(e=null!==t&&void 0!==t?t:g.data)&&void 0!==e?e:{}).reduce(((e,t)=>{const n="".concat(t.name.en," (").concat(t.id,")"),a="".concat(t.name.pt," (").concat(t.id,")");return e[n]=t.id,e[a]=t.id,t.aliasesEn&&t.aliasesEn.forEach((n=>{e["".concat(n," (").concat(t.id,")*")]=t.id})),t.aliasesPt&&t.aliasesPt.forEach((n=>{e["".concat(n," (").concat(t.id,")*")]=t.id})),e}),{});return{namesDict:n,options:(0,r.orderBy)(Object.keys(n),[e=>e.toLowerCase()]).map((e=>({value:e})))}}),[t,n]),[j,S]=(0,o.useState)([]),[y,Z]=(0,o.useState)("");(0,d.Z)((()=>{y&&E(y)}),500,[y]);const E=e=>{if(!e)return void S([]);const t=e.trim().toUpperCase(),n=x.filter((e=>{var n;return String(null!==(n=null===e||void 0===e?void 0:e.value)&&void 0!==n?n:"").toUpperCase().includes(t)})),a=(0,r.orderBy)(n,[e=>{var n;const a=String(null!==(n=null===e||void 0===e?void 0:e.value)&&void 0!==n?n:"").toUpperCase();if(a===t)return 0;const i=a.match(/\((.*?)\)/);if(i&&i[1]===t)return 1;const s=a.indexOf(t);return 0===s?2:s>0?3:4}]);S(a)};return(0,c.jsx)(a.Z,{options:j,style:{width:250,...l},allowClear:null===m||void 0===m||m,placeholder:null!==p&&void 0!==p?p:"Search by name or id...",filterOption:(e,t)=>{var n;return-1!==String(null!==(n=null===t||void 0===t?void 0:t.value)&&void 0!==n?n:"").toUpperCase().indexOf(null===e||void 0===e?void 0:e.toUpperCase())},onSearch:Z,notFoundContent:y.length>0?"No items found":"Type to search...",onSelect:e=>{void 0!==f[e]&&v(f[e])},...h,children:(0,c.jsx)(i.Z,{onPressEnter:()=>{if(j.length>0){const e=j[0].value;void 0!==f[e]&&v(f[e])}}})})}},7134:(e,t,n)=>{n.d(t,{_:()=>o});var a=n(4747),i=n(763),s=n(2791),r=n(3250);function o(){const[e,t]=(0,r.Z)(),{message:n}=a.Z.useApp();return(0,s.useEffect)((()=>{e.value&&(e.value.length>20?n.info("Copied to clipboard: ".concat((0,i.truncate)(e.value,{length:30,omission:"..."}))):n.success("Copied"))}),[e,n]),t}},4766:(e,t,n)=>{n.d(t,{K:()=>s});var a=n(2791),i=n(1087);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[t,n]=(0,i.lr)(),s=(e,a,i)=>{void 0===a||""===a||a===i?t.delete(e):t.set(e,String(a)),n(t)},r=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.entries(e).forEach((e=>{let[n,i]=e;a[n]===i?t.delete(n):t.set(n,String(i))})),n(t)},o=e=>{t.delete(e),n(t)},d=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"true";return t.get(e)===String(n)};return(0,a.useEffect)((()=>{Object.entries(e).forEach((e=>{let[n,a]=e;t.has(n)||s(n,a)}))}),[]),{addParam:s,addParams:r,removeParam:o,queryParams:t,is:d}}},8938:(e,t,n)=>{n.d(t,{i:()=>u});var a=n(4747),i=n(763),s=n(2791),r=n(3713),o=n(8027),d=n(5529),c=n(2233),l=n(5850);function u(e){let{tdrResourceName:t,firebaseDataCollectionName:n,serialize:u}=e;const{notification:p}=a.Z.useApp(),m=(0,r.NL)(),v=(0,d.N)(t),h=(0,o.X)("tdr",n,{select:u?l.d_:void 0}),[g,f]=(0,s.useState)({}),x=(0,c.B)("tdr",n,{onSuccess:()=>{p.success({message:"".concat(n," updated")}),m.refetchQueries({queryKey:["firebase","tdr",n]}),f({})},onError:e=>{p.error({message:"".concat(n," update failed"),description:e.message})}}),j=(0,s.useMemo)((()=>{var e,a;return v.isSuccess&&h.isSuccess&&!x.isPending?(console.log("%cMerging ".concat(t,"+").concat(n," data..."),"color: #f0f"),(0,i.cloneDeep)({...null!==(e=v.data)&&void 0!==e?e:{},...null!==(a=h.data)&&void 0!==a?a:{},...g})):{}}),[t,n,v.data,h.data,v.isSuccess,h.isSuccess,x.isPending,g]),S=!(0,i.isEmpty)(g),y=h.data;return{data:j,isLoading:v.isLoading||h.isLoading,error:v.error||h.error,firebaseData:y,isSaving:x.isPending,save:()=>{x.mutate(u?(0,l.aS)(g):g)},addEntryToUpdate:(e,t)=>{f((n=>({...n,[e]:t})))},entriesToUpdate:g,isDirty:S}}},548:(e,t,n)=>{n.d(t,{P:()=>i});var a=n(4766);function i(e){var t,n;let{prefix:i="",defaultCurrent:s=1,defaultPageSize:r=10,pageSizeOptions:o=[10,20,50,100],total:d,showQuickJumper:c}=e;const{queryParams:l,addParam:u}=(0,a.K)();return{current:Number(null!==(t=l.get("".concat(i,"page")))&&void 0!==t?t:String(s)),pageSize:Number(null!==(n=l.get("".concat(i,"pageSize")))&&void 0!==n?n:String(r)),onChange:e=>{u("".concat(i,"page"),e.toString(),String(s))},onShowSizeChange:(e,t)=>{u("".concat(i,"pageSize"),t.toString(),String(r))},defaultCurrent:s,defaultPageSize:r,pageSizeOptions:o,total:d,hideOnSinglePage:!0,showQuickJumper:c}}},2233:(e,t,n)=>{n.d(t,{B:()=>o});var a=n(2481),i=n(2748),s=n(8556);function r(e,t,n){console.log("%cUpdating ".concat(e,"/").concat(t," from firebase"),"color: #f00");const s=(0,a.JU)(i.RZ,"".concat(e,"/").concat(t));return(0,a.r7)(s,n)}function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,s.D)({mutationFn:async n=>r(e,t,n),...n})}},1970:(e,t,n)=>{n.r(t),n.d(t,{ItemsDiscSets:()=>H,default:()=>J});var a=n(3990),i=n(2128),s=n(122),r=n(1046),o=n(1082),d=n(2556),c=n(4031),l=n(4520),u=n(2997),p=n(7134),m=n(548),v=n(5529),h=n(763),g=n(2791),f=n(5850),x=n(8862),j=n(8178),S=n(1105),y=n(7462),Z=n(7042),E=n(4186),b=function(e,t){return g.createElement(E.Z,(0,y.Z)({},e,{ref:t,icon:Z.Z}))};const C=g.forwardRef(b);var w=n(184);function P(e){let{disc:t,addEntryToUpdate:n}=e;const a=e=>{n(t.id,{...t,itemsIds:(0,f.R1)((0,f.E4)([...t.itemsIds,e]))})};return(0,w.jsxs)(l.Z,{gap:16,children:[(0,w.jsxs)("div",{children:[(0,w.jsx)(c.Z.Paragraph,{children:"Add Item"}),(0,w.jsx)(j.i,{onFinish:a})]}),(0,w.jsx)(k,{onUpdate:a}),(0,w.jsx)(I,{onUpdateBatch:e=>{n(t.id,{...t,itemsIds:(0,f.R1)((0,f.E4)([...t.itemsIds,...e]))})}})]})}function k(e){var t;let{onUpdate:n}=e;const a=(0,v.N)("items"),[i,s]=(0,g.useState)((0,h.sampleSize)(Object.keys(null!==(t=a.data)&&void 0!==t?t:{}),5));return(0,w.jsxs)("div",{children:[(0,w.jsxs)(c.Z.Paragraph,{children:["Random Sample"," ",(0,w.jsx)(d.ZP,{size:"small",onClick:()=>{var e;s((0,h.sampleSize)(Object.keys(null!==(e=a.data)&&void 0!==e?e:{}),20))},children:"Get"})]}),(0,w.jsx)(l.Z,{gap:16,wrap:"wrap",children:i.map(((e,t)=>(0,w.jsxs)(l.Z,{gap:2,vertical:!0,children:[(0,w.jsx)(u.ck,{id:e,width:60}),(0,w.jsxs)(l.Z,{justify:"center",gap:6,children:[(0,w.jsx)(c.Z.Text,{children:e}),(0,w.jsx)(d.ZP,{size:"small",shape:"circle",onClick:()=>n(e),children:(0,w.jsx)(C,{})})]})]},"sample-".concat(e,"-").concat(t))))})]})}function I(e){let{onUpdateBatch:t}=e;const[n,a]=(0,g.useState)("");return(0,w.jsxs)(c.Z.Paragraph,{children:["Paste IDs (from groups)",(0,w.jsx)(S.Z.TextArea,{value:n,onChange:e=>a(e.target.value)}),(0,w.jsx)(d.ZP,{size:"small",onClick:()=>{try{const e=n.replace(/^\[|\]$/g,"").split(/\s*,\s*/).map((e=>e.replace(/^"|"$/g,""))).filter(Boolean);t(e),a("")}catch(e){console.error(e)}},children:"Add"})]})}function T(e){let{data:t,addEntryToUpdate:n}=e;const a=(0,v.N)("items"),i=(0,g.useMemo)((()=>{return e=Object.values(t),(0,h.orderBy)(e,[e=>e.title.en]).map((e=>({...e,itemsIds:(0,h.orderBy)(e.itemsIds,(e=>Number(e)))})));var e}),[t]),o=(0,p._)(),d=(0,m.P)({total:i.length,showQuickJumper:!0}),c=[{title:"Title",dataIndex:"title",key:"title.pt",render:(e,t)=>(0,w.jsx)(z,{value:e,disc:t,addEntryToUpdate:n})},s.Z.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(e,t)=>(0,w.jsx)(N,{disc:t,itemsIds:(0,f.E4)(e),copyToClipboard:o,addEntryToUpdate:n})},{title:"Count",dataIndex:"itemsIds",key:"count",render:e=>(0,f.R1)(e).filter(Boolean).length}];return(0,w.jsx)(r.Z,{direction:"vertical",children:(0,w.jsx)(s.Z,{columns:c,dataSource:i,pagination:d,rowKey:"id",expandable:{expandedRowRender:e=>(0,w.jsx)(P,{disc:e,addEntryToUpdate:n}),rowExpandable:()=>a.isSuccess}})})}function U(e){let{disc:t,addEntryToUpdate:n,itemId:a}=e;return(0,w.jsx)(o.Z,{title:"Are you sure you want to remove this item?",onConfirm:()=>{n(t.id,{...t,itemsIds:t.itemsIds.filter((e=>e!==a))})},okText:"Yes",cancelText:"No",children:(0,w.jsx)(d.ZP,{icon:(0,w.jsx)(x.Z,{}),size:"small",type:"text"})})}function z(e){let{value:t,disc:n,addEntryToUpdate:a}=e;const i=(e,t)=>{a(n.id,{...n,title:{...n.title,[t]:e}})};return(0,w.jsxs)(r.Z,{direction:"vertical",size:"small",children:[(0,w.jsx)(c.Z.Text,{editable:{onChange:e=>i(e,"pt")},children:String(t.pt)}),(0,w.jsx)(c.Z.Text,{editable:{onChange:e=>i(e,"en")},children:String(t.en)})]})}function N(e){let{disc:t,itemsIds:n,copyToClipboard:a,addEntryToUpdate:i}=e;return(0,w.jsx)(l.Z,{gap:6,wrap:"wrap",children:n.map(((e,n)=>(0,w.jsxs)(l.Z,{gap:2,vertical:!0,children:[(0,w.jsx)(u.ck,{id:e,width:60}),(0,w.jsxs)(l.Z,{justify:"center",children:[(0,w.jsx)(c.Z.Text,{onClick:()=>a(e),children:e}),(0,w.jsx)(U,{disc:t,addEntryToUpdate:i,itemId:e})]})]},"".concat(t.title,"-").concat(e,"-").concat(n))))},"items-".concat(t.title))}var D=n(7128),O=n(7018),R=n(1958),B=n(7340);function q(e){let{data:t,save:n,isDirty:a,isSaving:i,entriesToUpdate:s,addEntryToUpdate:r}=e;return(0,w.jsxs)(R.Pd,{children:[(0,w.jsxs)(l.Z,{vertical:!0,gap:12,children:[(0,w.jsx)(B.k,{isDirty:a,onSave:n,isSaving:i,dirt:JSON.stringify(L(s))}),(0,w.jsx)(O.o,{data:()=>{return e=t,Object.keys(e).forEach((t=>{e[t].itemsIds=(0,f.E4)((0,f.R1)(e[t].itemsIds))})),(0,f.Tj)(L(e));var e},fileName:"daily-disc-sets.json",disabled:a,block:!0})]}),(0,w.jsx)(D.Z,{}),(0,w.jsx)(d.ZP,{type:"dashed",block:!0,onClick:()=>r("?",{id:"?",title:{pt:"",en:""},itemsIds:[]}),children:"Add New Set"})]})}function L(e){return(0,h.omitBy)((0,h.cloneDeep)(e),(e=>(0,h.isEmpty)(e.itemsIds)))}var M=n(4562),A=n(8938);function H(){const e=(0,A.i)({tdrResourceName:"daily-disc-sets",firebaseDataCollectionName:"discSets",serialize:!0});return(0,w.jsx)(R.Xg,{title:"Items",subtitle:"Disc Sets",children:(0,w.jsxs)(a.Z,{hasSider:!0,children:[(0,w.jsx)(M.p,{children:(0,w.jsx)(q,{...e})}),(0,w.jsx)(a.Z.Content,{className:"content",children:(0,w.jsx)(i.T,{isLoading:e.isLoading||e.isSaving,error:e.error,hasResponseData:!(0,h.isEmpty)(e.data),children:(0,w.jsx)(T,{...e})})})]})})}const J=H},7042:(e,t,n)=>{n.d(t,{Z:()=>a});const a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"}},8862:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(7462),i=n(2791);const s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 256H736v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zm-200 0H360v-72h304v72z"}}]},name:"delete",theme:"filled"};var r=n(4186),o=function(e,t){return i.createElement(r.Z,(0,a.Z)({},e,{ref:t,icon:s}))};const d=i.forwardRef(o)}}]);
//# sourceMappingURL=ItemsDiscSets.8caf6815.chunk.js.map