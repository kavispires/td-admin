"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[2695],{6095:(e,t,a)=>{a.d(t,{N:()=>o});var s=a(1413),i=a(4925),n=a(2658),d=a(1046),r=a(184);const l=["children","pagination"];function o(e){let{children:t,pagination:a}=e,o=(0,i.Z)(e,l);const c=(0,r.jsx)(n.Z,(0,s.Z)((0,s.Z)({showQuickJumper:!0},a),{},{className:"fixed-pagination"}));return(0,r.jsxs)(d.Z,(0,s.Z)((0,s.Z)({direction:"vertical"},o),{},{children:[c,t,c]}))}},4850:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(1046),i=a(9475),n=a(7134),d=a(184);function r(e){let{ids:t}=e;const a=(0,n._)();return(0,d.jsx)(s.Z,{direction:"vertical",size:"small",children:(0,d.jsx)(i.ZP,{size:"small",onClick:()=>a(JSON.stringify(t)),children:"Copy Ids"})})}},4290:(e,t,a)=>{a.d(t,{e:()=>d});var s=a(2791),i=a(4421),n=a(4766);function d(e){var t,a;let{prefix:d="",data:r,defaultCurrent:l=1,defaultPageSize:o=64,pageSizeOptions:c=[16,32,64,128],resetter:u}=e;const{queryParams:p,addParam:m}=(0,n.K)(),h=Number(null!==(t=p.get("".concat(d,"page")))&&void 0!==t?t:String(l)),x=Number(null!==(a=p.get("".concat(d,"pageSize")))&&void 0!==a?a:String(o)),g=(0,i.Z)(u),j=(0,s.useMemo)((()=>{const e=(h-1)*x,t=e+x;return r.slice(e,t)}),[h,x,r]),Z=e=>{m("".concat(d,"page"),e.toString(),String(l))};return u!==g&&Z(l),{page:j,pagination:{current:h,pageSize:x,onChange:Z,onShowSizeChange:(e,t)=>{m("".concat(d,"pageSize"),t.toString(),String(o))},defaultCurrent:l,defaultPageSize:o,pageSizeOptions:c,total:r.length,hideOnSinglePage:!0}}}},8938:(e,t,a)=>{a.d(t,{i:()=>p});var s=a(1413),i=a(4747),n=a(763),d=a(2791),r=a(3713),l=a(5850),o=a(8027),c=a(5529),u=a(2233);function p(e){let{tdrResourceName:t,firebaseDataCollectionName:a,serialize:p}=e;const{notification:m}=i.Z.useApp(),h=(0,r.NL)(),x=(0,c.N)(t),g=(0,o.X)("tdr",a,{select:p?l.d_:void 0}),[j,Z]=(0,d.useState)({}),f=(0,u.B)("tdr",a,{onSuccess:()=>{m.success({message:"".concat(a," updated")}),h.refetchQueries({queryKey:["firebase","tdr",a]}),Z({})},onError:e=>{m.error({message:"".concat(a," update failed"),description:e.message})}}),S=(0,d.useMemo)((()=>{var e,i;return x.isSuccess&&g.isSuccess&&!f.isPending?(console.log("%cMerging ".concat(t,"+").concat(a," data..."),"color: #f0f"),(0,n.cloneDeep)((0,s.Z)((0,s.Z)((0,s.Z)({},null!==(e=x.data)&&void 0!==e?e:{}),null!==(i=g.data)&&void 0!==i?i:{}),j))):{}}),[t,a,x.data,g.data,x.isSuccess,g.isSuccess,f.isPending,j]),y=!(0,n.isEmpty)(j),v=g.data;return{data:S,isLoading:x.isLoading||g.isLoading,error:x.error||g.error,firebaseData:v,isSaving:f.isPending,save:()=>{f.mutate(p?(0,l.aS)(j):j)},addEntryToUpdate:(e,t)=>{Z((a=>(0,s.Z)((0,s.Z)({},a),{},{[e]:t})))},entriesToUpdate:j,isDirty:y}}},4341:(e,t,a)=>{a.d(t,{M:()=>r});var s=a(1413),i=a(4925),n=a(2791);const d=["maxExpandedRows","rowExpandable","defaultExpandAllRows"];function r(e){let{maxExpandedRows:t,rowExpandable:a,defaultExpandAllRows:r}=e,l=(0,i.Z)(e,d);const[o,c]=(0,n.useState)([]);return(0,s.Z)({expandedRowKeys:o,rowExpandable:null!==a&&void 0!==a?a:()=>!0,defaultExpandAllRows:null!==r&&void 0!==r&&r,onExpand:(e,a)=>{const s=[...o];if(!e)return c(s.filter((e=>e!==a.id)));if(t){for(;s.length>=t;)s.shift();s.push(a.id),c(s)}}},l)}},548:(e,t,a)=>{a.d(t,{P:()=>i});var s=a(4766);function i(e){var t,a;let{prefix:i="",defaultCurrent:n=1,defaultPageSize:d=10,pageSizeOptions:r=[10,20,50,100],total:l,showQuickJumper:o}=e;const{queryParams:c,addParam:u}=(0,s.K)();return{current:Number(null!==(t=c.get("".concat(i,"page")))&&void 0!==t?t:String(n)),pageSize:Number(null!==(a=c.get("".concat(i,"pageSize")))&&void 0!==a?a:String(d)),onChange:e=>{u("".concat(i,"page"),e.toString(),String(n))},onShowSizeChange:(e,t)=>{u("".concat(i,"pageSize"),t.toString(),String(d))},defaultCurrent:n,defaultPageSize:d,pageSizeOptions:r,total:l,hideOnSinglePage:!0,showQuickJumper:o}}},949:(e,t,a)=>{a.r(t),a.d(t,{ItemsDiscSets:()=>de,default:()=>re});var s=a(1413),i=a(1790),n=a(2128),d=a(2997),r=a(4766),l=a(4850),o=a(8862),c=a(5625),u=a(1046),p=a(1082),m=a(9475),h=a(6178),x=a(4520),g=a(7134),j=a(5529),Z=a(4341),f=a(548),S=a(763),y=a(2791),v=a(5850),I=a(9286),b=a(8178),C=a(7515),E=a(184);function k(e){let{onUpdateBatch:t}=e;const[a,s]=(0,y.useState)("");return(0,E.jsxs)(h.Z.Paragraph,{children:["Paste IDs",(0,E.jsx)(C.Z.TextArea,{value:a,onChange:e=>s(e.target.value)}),(0,E.jsx)(m.ZP,{size:"small",onClick:()=>{try{const e=a.replace(/^\[|\]$/g,"").split(/\s*,\s*/).map((e=>e.replace(/^"|"$/g,""))).filter(Boolean);t(e),s("")}catch(e){console.error(e)}},children:"Add"})]})}function w(e){let{disc:t,addEntryToUpdate:a}=e;const i=e=>{a(t.id,(0,s.Z)((0,s.Z)({},t),{},{itemsIds:(0,v.R1)((0,v.E4)([...t.itemsIds,e]))}))};return(0,E.jsxs)(x.Z,{gap:16,children:[(0,E.jsxs)("div",{children:[(0,E.jsx)(h.Z.Paragraph,{children:"Add Item"}),(0,E.jsx)(b.i,{onFinish:i})]}),(0,E.jsx)(T,{onUpdate:i,disc:t}),(0,E.jsx)(k,{onUpdateBatch:e=>{a(t.id,(0,s.Z)((0,s.Z)({},t),{},{itemsIds:(0,v.R1)((0,v.E4)([...t.itemsIds,...e]))}))}})]})}function T(e){let{onUpdate:t,disc:a}=e;const s=(0,j.N)("items"),[i,n]=(0,y.useState)([...a.itemsIds]),r=e=>{var t;const a=(0,S.difference)(Object.keys(null!==(t=s.data)&&void 0!==t?t:{}),i);return(0,S.sampleSize)(a,e)},[l,o]=(0,y.useState)(r(5)),c=()=>{const e=r(30);o(e),n([...i,...e])};return(0,y.useEffect)((()=>{n([...a.itemsIds])}),[a.id]),(0,y.useEffect)((()=>{0===l.length&&(c(),n([...a.itemsIds]))}),[l]),(0,E.jsxs)("div",{children:[(0,E.jsxs)(h.Z.Paragraph,{children:["Random Sample"," ",(0,E.jsx)(m.ZP,{size:"small",onClick:c,children:"Get"})]}),(0,E.jsx)(x.Z,{gap:16,wrap:"wrap",children:l.map(((e,a)=>(0,E.jsxs)(x.Z,{gap:2,vertical:!0,children:[(0,E.jsx)(d.ck,{id:e,width:60}),(0,E.jsxs)(x.Z,{justify:"center",gap:6,children:[(0,E.jsx)(h.Z.Text,{children:e}),(0,E.jsx)(m.ZP,{size:"small",shape:"circle",onClick:()=>t(e),children:(0,E.jsx)(I.Z,{})})]})]},"sample-".concat(e,"-").concat(a))))})]})}function P(e){let{data:t,addEntryToUpdate:a}=e;const i=(0,j.N)("items"),n=(0,y.useMemo)((()=>{return e=Object.values(t),(0,S.orderBy)(e,[e=>e.title.en]).map((e=>(0,s.Z)((0,s.Z)({},e),{},{itemsIds:(0,S.orderBy)(e.itemsIds,(e=>Number(e)))})));var e}),[t]),d=(0,g._)(),r=(0,f.P)({total:n.length,showQuickJumper:!0}),l=[{title:"Id",dataIndex:"id",key:"id",sorter:(e,t)=>e.title.en.localeCompare(t.title.en)},{title:"Title",dataIndex:"title",key:"title",sorter:(e,t)=>e.title.en.localeCompare(t.title.en),render:(e,t)=>(0,E.jsx)(z,{value:e,disc:t,addEntryToUpdate:a})},c.Z.EXPAND_COLUMN,{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(e,t)=>(0,E.jsx)(O,{disc:t,itemsIds:(0,v.E4)(e),copyToClipboard:d,addEntryToUpdate:a})},{title:"Count",dataIndex:"itemsIds",key:"count",render:e=>(0,v.R1)(e).filter(Boolean).length}],o=(0,Z.M)({maxExpandedRows:1,expandedRowRender:e=>(0,E.jsx)(w,{disc:e,addEntryToUpdate:a}),rowExpandable:()=>i.isSuccess});return(0,E.jsx)(u.Z,{direction:"vertical",children:(0,E.jsx)(c.Z,{columns:l,dataSource:n,pagination:r,rowKey:"id",expandable:o})})}function N(e){let{disc:t,addEntryToUpdate:a,itemId:i}=e;return(0,E.jsx)(p.Z,{title:"Are you sure you want to remove this item?",onConfirm:()=>{a(t.id,(0,s.Z)((0,s.Z)({},t),{},{itemsIds:t.itemsIds.filter((e=>e!==i))}))},okText:"Yes",cancelText:"No",children:(0,E.jsx)(m.ZP,{icon:(0,E.jsx)(o.Z,{}),size:"small",type:"text"})})}function z(e){let{value:t,disc:a,addEntryToUpdate:i}=e;const n=(e,t)=>{i(a.id,(0,s.Z)((0,s.Z)({},a),{},{title:(0,s.Z)((0,s.Z)({},a.title),{},{[t]:e})}))};return(0,E.jsxs)(u.Z,{direction:"vertical",size:"small",children:[(0,E.jsx)(h.Z.Text,{editable:{onChange:e=>n(e,"pt")},children:String(t.pt)}),(0,E.jsx)(h.Z.Text,{editable:{onChange:e=>n(e,"en")},children:String(t.en)})]})}function O(e){let{disc:t,itemsIds:a,copyToClipboard:s,addEntryToUpdate:i}=e;return(0,E.jsxs)(x.Z,{gap:6,wrap:"wrap",children:[a.map(((e,a)=>(0,E.jsxs)(x.Z,{gap:2,vertical:!0,children:[(0,E.jsx)(d.ck,{id:e,width:60}),(0,E.jsxs)(x.Z,{justify:"center",children:[(0,E.jsx)(h.Z.Text,{onClick:()=>s(e),children:e}),(0,E.jsx)(N,{disc:t,addEntryToUpdate:i,itemId:e})]})]},"".concat(t.title,"-").concat(e,"-").concat(a)))),(0,E.jsx)(l.A,{ids:a})]},"items-".concat(t.title))}var U=a(5922),R=a(3320),A=a(906),D=a(952),M=a(8357),B=a(6095),L=a(4290);function q(e){var t;let{data:a,addEntryToUpdate:s}=e;const{is:i,addParam:n}=(0,r.K)(),l=(0,j.N)("items"),[o,c]=(0,y.useMemo)((()=>{if(l.data){const e=Object.values(a).reduce(((e,t)=>(t.itemsIds.forEach((a=>{e[a]||(e[a]=[]),e[a].push(t.id)})),e)),{});Object.keys(l.data).reduce(((e,t)=>(void 0===e[t]&&(e[t]=[]),e[t].push(t),e)),{});const t=["black","blue","brown","green","orange","pink","purple","red","white","yellow"],s=Object.keys(l.data).filter((a=>void 0===e[a]||1===e[a].length&&t.includes(e[a][0]))).map((e=>l.data[e]));return[e,s]}return[{},[]]}),[a,l.data]),p=i("onlyOrphans"),{page:m,pagination:g}=(0,L.e)({data:p?c:Object.values(l.data),defaultPageSize:64,resetter:p?"orphans":"all"}),[Z,f]=(0,y.useState)(null),[S,v]=(0,y.useState)(null),I=(0,y.useMemo)((()=>Object.values(a).sort(((e,t)=>e.title.pt.localeCompare(t.title.pt)))),[a]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(h.Z.Title,{level:4,children:["Orphan Items (",c.length,")"]}),(0,E.jsx)(u.Z,{className:"mb-4",children:(0,E.jsx)(U.Z,{checkedChildren:"Only Orphans",unCheckedChildren:"All Items",onChange:e=>n("onlyOrphans",e,!1)})}),(0,E.jsx)(R.Z,{title:"Add Item to Set",open:!!Z,onClose:()=>f(null),children:!!Z&&(0,E.jsx)(K,{activeItem:Z,activeItemSets:null!==(t=null===o||void 0===o?void 0:o[Z])&&void 0!==t?t:[],latestSetId:S,setLatestSetId:v,sortedSets:I,data:a,addEntryToUpdate:s})}),(0,E.jsx)(B.N,{pagination:g,className:"full-width",children:(0,E.jsx)(x.Z,{gap:16,wrap:"wrap",children:m.map((e=>(0,E.jsx)(M.F6,{onClick:()=>f(e.id),children:(0,E.jsx)(d.ck,{id:e.id})},e.id)))})})]})}function K(e){let{activeItem:t,activeItemSets:a,setLatestSetId:i,sortedSets:n,data:r,addEntryToUpdate:l}=e;const[o,c]=(0,y.useState)(a);if(!t)return null;const u=n.map((e=>({value:e.id,label:e.title.pt})));return(0,E.jsxs)(x.Z,{vertical:!0,gap:16,children:[(0,E.jsx)(d.ck,{id:t}),(0,E.jsx)(m.ZP,{type:"primary",onClick:()=>{o.forEach((e=>{l(e,(0,s.Z)((0,s.Z)({},r[e]),{},{itemsIds:[...r[e].itemsIds,t]}))})),i(o[o.length-1])},disabled:(0,S.isEqual)(a,o),children:"Save to Sets"}),(0,E.jsx)(A.Z,{onChange:e=>{c(e)},mode:"tags",value:o,options:u}),(0,E.jsx)(x.Z,{wrap:"wrap",gap:8,children:n.map((e=>(0,E.jsx)(D.Z,{onClick:()=>{return t=e.id,void c((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t},color:o.includes(e.id)?"gold":void 0,children:e.title.pt},e.id)))})]})}function F(e){let{data:t,addEntryToUpdate:a}=e;const{is:s,queryParams:i}=(0,r.K)();return(0,E.jsxs)(E.Fragment,{children:[(s("display","sets")||!i.has("display"))&&(0,E.jsx)(P,{data:t,addEntryToUpdate:a}),(s("display","orphans")||!i.has("display"))&&(0,E.jsx)(q,{data:t,addEntryToUpdate:a})]})}var J=a(7128),_=a(7018),Q=a(7340),H=a(7965),X=a(9197),$=a(1635),G=a(3070),W=a(324),Y=a(1310),V=a(1291),ee=a.n(V);function te(e){let{addEntryToUpdate:t,ids:a}=e;const[s,i]=(0,y.useState)(!1),[n]=G.Z.useForm(),d=G.Z.useWatch("name",n),r=(0,y.useMemo)((()=>{const e={};if(d&&d.length>2){const s=(0,S.camelCase)(d);if(s)try{ee().findBestMatch(s,a).ratings.forEach((t=>{t.rating>.4&&(e[t.target]=t.rating)}))}catch(t){console.error(t)}}return Object.keys(e)}),[d,a]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(m.ZP,{type:"dashed",block:!0,onClick:()=>i(!0),children:"Add New Set"}),(0,E.jsxs)(W.Z,{title:"Add New Set",open:s,onOk:n.submit,onCancel:()=>i(!1),maskClosable:!1,okText:"Add",okButtonProps:{htmlType:"submit"},children:[(0,E.jsxs)(G.Z,{form:n,onFinish:e=>{const a=(0,S.camelCase)(e.name);t((0,S.camelCase)(a),{id:a,title:{pt:e.nome,en:e.name},itemsIds:[]})},children:[(0,E.jsx)(G.Z.Item,{name:"nome",label:"Nome",rules:[{required:!0}],children:(0,E.jsx)(C.Z,{prefix:(0,E.jsx)(Y.H,{language:"pt",width:"1em"}),placeholder:"Name in pt",size:"small"})}),(0,E.jsx)(G.Z.Item,{name:"name",label:"Name",rules:[{required:!0}],children:(0,E.jsx)(C.Z,{prefix:(0,E.jsx)(Y.H,{language:"en",width:"1em"}),placeholder:"Name in en",size:"small"})})]}),(0,E.jsx)(h.Z.Text,{children:"Similar:"}),(0,E.jsx)("ul",{children:r.map((e=>(0,E.jsx)("li",{children:e},e)))})]})]})}function ae(e){var t;let{data:a,save:s,isDirty:i,isSaving:n,entriesToUpdate:d,addEntryToUpdate:l}=e;const{queryParams:o,addParams:c}=(0,r.K)();return(0,E.jsxs)(H.Pd,{children:[(0,E.jsxs)(x.Z,{vertical:!0,gap:12,children:[(0,E.jsx)(Q.k,{isDirty:i,onSave:s,isSaving:n,dirt:JSON.stringify(se(d))}),(0,E.jsx)(_.o,{data:()=>{return e=a,Object.keys(e).forEach((t=>{e[t].itemsIds=(0,v.E4)((0,v.R1)(e[t].itemsIds))})),(0,v.Tj)(se(e));var e},fileName:"daily-disc-sets.json",disabled:i,block:!0})]}),(0,E.jsx)(J.Z,{}),(0,E.jsx)(M.H,{label:"Display",value:null!==(t=o.get("display"))&&void 0!==t?t:"sets",onChange:e=>c({display:e,page:1},{page:1,display:"table"}),options:[{title:"Sets",icon:(0,E.jsx)(X.Z,{}),value:"sets"},{title:"Orphan Items",icon:(0,E.jsx)($.Z,{}),value:"orphans"}]}),(0,E.jsx)(te,{addEntryToUpdate:l,ids:Object.keys(a)})]})}function se(e){return(0,S.omitBy)((0,S.cloneDeep)(e),(e=>(0,S.isEmpty)(e.itemsIds)))}var ie=a(4562),ne=a(8938);function de(){const e=(0,ne.i)({tdrResourceName:"daily-disc-sets",firebaseDataCollectionName:"discSets",serialize:!0});return(0,E.jsx)(H.Xg,{title:"Items",subtitle:"Disc Sets",children:(0,E.jsxs)(i.Z,{hasSider:!0,children:[(0,E.jsx)(ie.p,{children:(0,E.jsx)(ae,(0,s.Z)({},e))}),(0,E.jsx)(i.Z.Content,{className:"content",children:(0,E.jsx)(n.T,{isLoading:e.isLoading||e.isSaving,error:e.error,hasResponseData:!(0,S.isEmpty)(e.data),children:(0,E.jsx)(F,(0,s.Z)({},e))})})]})})}const re=de}}]);
//# sourceMappingURL=ItemsDiscSets.b5a7d541.chunk.js.map