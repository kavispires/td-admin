"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[9479],{7018:(e,t,i)=>{i.d(t,{o:()=>o});var l=i(1413),n=i(4925),s=i(9475),a=i(5850),d=i(184);const r=["data","fileName","loading","children"];function o(e){let{data:t,fileName:i,loading:o,children:c}=e,u=(0,n.Z)(e,r);return(0,d.jsx)(s.ZP,(0,l.Z)((0,l.Z)({onClick:()=>(0,a.ZN)("function"===typeof t?t():t,i),loading:o},u),{},{children:null!==c&&void 0!==c?c:"Download JSON"}))}},7340:(e,t,i)=>{i.d(t,{k:()=>g});var l=i(1413),n=i(4925),s=i(9475),a=i(2426),d=i.n(a),r=i(2791),o=i(8211),c=i(4483),u=i(4841),h=i(184);const m=["isDirty","onSave","isSaving","dirt","interval"];function g(e){let{isDirty:t,onSave:i,isSaving:a,dirt:g,interval:x=6e5}=e,p=(0,n.Z)(e,m);const{togglePendingSave:j}=(0,u.b)(),[,v,y]=(0,o.Z)((()=>{t&&i()}),x);return(0,r.useEffect)((()=>{t?(j(!0),console.log("Save Reset",d()(Date.now()).format("MM/DD/YYYY HH:mm:ss")),y()):(j(!1),v())}),[t,y,v,g]),(0,r.useEffect)((()=>{const e=e=>{if(t){const t="You have unsaved changes, are you sure you want to leave?";return e.returnValue=t,t}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[t]),(0,h.jsx)(s.ZP,(0,l.Z)((0,l.Z)({type:"primary",size:"large",icon:(0,h.jsx)(c.Z,{}),onClick:i,disabled:!t,loading:a,danger:!0,block:!0},p),{},{children:"Save"}))}},4766:(e,t,i)=>{i.d(t,{K:()=>s});var l=i(1087),n=i(263);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[t,i]=(0,l.lr)(),s=(e,l,n)=>{void 0===l||""===l||l===n?t.delete(e):t.set(e,String(l)),i(t)},a=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.entries(e).forEach((e=>{let[i,n]=e;l[i]===n?t.delete(i):t.set(i,String(n))})),i(t)},d=e=>{t.delete(e),i(t)},r=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"true";return t.get(e)===String(i)};return(0,n.Z)((()=>{Object.entries(e).forEach((e=>{let[i,l]=e;t.has(i)||s(i,l)}))})),{addParam:s,addParams:a,removeParam:d,queryParams:t,is:r}}},8938:(e,t,i)=>{i.d(t,{i:()=>h});var l=i(1413),n=i(4747),s=i(763),a=i(2791),d=i(3713),r=i(5850),o=i(8027),c=i(5529),u=i(2233);function h(e){let{tdrResourceName:t,firebaseDataCollectionName:i,serialize:h}=e;const{notification:m}=n.Z.useApp(),g=(0,d.NL)(),x=(0,c.N)(t),p=(0,o.X)("tdr",i,{select:h?r.d_:void 0}),[j,v]=(0,a.useState)({}),y=(0,u.B)("tdr",i,{onSuccess:()=>{m.success({message:"".concat(i," updated")}),g.refetchQueries({queryKey:["firebase","tdr",i]}),v({})},onError:e=>{m.error({message:"".concat(i," update failed"),description:e.message})}}),Z=(0,a.useMemo)((()=>{var e,n;return x.isSuccess&&p.isSuccess&&!y.isPending?(console.log("%cMerging ".concat(t,"+").concat(i," data..."),"color: #f0f"),(0,s.cloneDeep)((0,l.Z)((0,l.Z)((0,l.Z)({},null!==(e=x.data)&&void 0!==e?e:{}),null!==(n=p.data)&&void 0!==n?n:{}),j))):{}}),[t,i,x.data,p.data,x.isSuccess,p.isSuccess,y.isPending,j]),f=!(0,s.isEmpty)(j),b=p.data;return{data:Z,isLoading:x.isLoading||p.isLoading,error:x.error||p.error,firebaseData:b,isSaving:y.isPending,save:()=>{y.mutate(h?(0,r.aS)(j):j)},addEntryToUpdate:(e,t)=>{v((i=>(0,l.Z)((0,l.Z)({},i),{},{[e]:t})))},entriesToUpdate:j,isDirty:f}}},548:(e,t,i)=>{i.d(t,{P:()=>n});var l=i(4766);function n(e){var t,i;let{prefix:n="",defaultCurrent:s=1,defaultPageSize:a=10,pageSizeOptions:d=[10,20,50,100],total:r,showQuickJumper:o}=e;const{queryParams:c,addParam:u}=(0,l.K)();return{current:Number(null!==(t=c.get("".concat(n,"page")))&&void 0!==t?t:String(s)),pageSize:Number(null!==(i=c.get("".concat(n,"pageSize")))&&void 0!==i?i:String(a)),onChange:e=>{u("".concat(n,"page"),e.toString(),String(s))},onShowSizeChange:(e,t)=>{u("".concat(n,"pageSize"),t.toString(),String(a))},defaultCurrent:s,defaultPageSize:a,pageSizeOptions:d,total:r,hideOnSinglePage:!0,showQuickJumper:o}}},2233:(e,t,i)=>{i.d(t,{B:()=>r});var l=i(1413),n=i(9631),s=i(2592),a=i(8556);function d(e,t,i){console.log("%cUpdating ".concat(e,"/").concat(t," from firebase"),"color: #f00");const l=(0,n.JU)(s.RZ,"".concat(e,"/").concat(t));return(0,n.r7)(l,i)}function r(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,a.D)((0,l.Z)({mutationFn:async i=>d(e,t,i)},i))}},8900:(e,t,i)=>{i.r(t),i.d(t,{ItemsDiagramSets:()=>de,default:()=>re});var l=i(1413),n=i(1790),s=i(4520),a=i(2128),d=i(3660),r=i(9197),o=i(7128),c=i(9475),u=i(6178),h=i(8357),m=i(7018),g=i(7340),x=i(7965),p=i(4766),j=i(763),v=i(5850),y=i(184);function Z(e){var t;let{data:i,save:l,isDirty:n,isSaving:a,entriesToUpdate:Z}=e;const{addParams:f,queryParams:b}=(0,p.K)();return(0,y.jsxs)(x.Pd,{children:[(0,y.jsxs)(s.Z,{vertical:!0,gap:12,children:[(0,y.jsx)(g.k,{isDirty:n,onSave:l,isSaving:a,dirt:JSON.stringify(Z)}),(0,y.jsx)(m.o,{data:()=>function(e){console.log("Preparing file for download...");const t=(0,j.cloneDeep)(e);return(0,v.Tj)(t)}(i),fileName:"daily-diagram-items.json",disabled:n,block:!0})]}),(0,y.jsx)(o.Z,{}),(0,y.jsx)(h.H,{label:"Display",value:null!==(t=b.get("display"))&&void 0!==t?t:"rule",onChange:e=>f({display:e,page:1},{page:1}),options:[{title:"By Rule",icon:(0,y.jsx)(d.Z,{}),value:"rule"},{title:"By Thing",icon:(0,y.jsx)(r.Z,{}),value:"thing"}]}),(0,y.jsx)(o.Z,{}),(0,y.jsx)(c.ZP,{size:"small",block:!0,onClick:()=>f({display:"simulator"}),children:"Simulator"}),(0,y.jsx)(u.Z.Paragraph,{type:"secondary",className:"my-6",children:"v2.0.1"})]})}var f=i(5529),b=i(2791),T=i(7415),S=i(4925),I=i(3070),k=i(324),w=i(7515),C=i(4424),N=i(7305),E=i(5922),O=i(3733),P=i(2997),A=i(9425);const F=["itemId","name","updatedAt","syllables","stressedSyllable"];function M(e){let{isModalOpen:t,onSaveThing:i,onCancel:n,thing:a,rules:d,width:r,itemAliases:o,subtitle:u,okButtonText:h,onGiveAnotherThing:m}=e;const g=(0,b.useMemo)((()=>(0,j.orderBy)(Object.values(d),[e=>{const t=["manual","dependency","auto"].indexOf(e.method);return-1===t?Number.POSITIVE_INFINITY:t},e=>{const t=["grammar","comparison","order","count","contains","ends"].indexOf(e.type);return-1===t?Number.POSITIVE_INFINITY:t},e=>e.title.slice(0,7),e=>Number(e.id.split("-")[1])])),[d]),[x]=I.Z.useForm(),p=I.Z.useWatch([],x),v=!p||Object.values(null!==p&&void 0!==p?p:{}).some((e=>void 0===e)),Z=I.Z.useWatch("name",x);(0,b.useEffect)((()=>{var e;if(!Z)return;if(a.name&&a.syllables&&Z===a.name)return;const t={syllables:(0,A.wM)(Z),stressedSyllable:(null!==(e=a.stressedSyllable)&&void 0!==e?e:Z.includes(" "))?-1:0};Object.keys(d).forEach((e=>{A.nE[e]?t[e]=A.nE[e](Z):t[e]=a.rules.length>0?a.rules.includes(e):void 0})),x.setFieldsValue(t)}),[Z]);const f=I.Z.useWatch("syllables",x),T=x.getFieldValue("ddr-51-pt");(0,b.useEffect)((()=>{T&&(x.setFieldsValue({stressedSyllable:void 0}),x.setFieldsValue({"ddr-43-pt":!1}),x.setFieldsValue({"ddr-44-pt":!1}),x.setFieldsValue({"ddr-45-pt":!1}),x.setFieldsValue({"ddr-46-pt":!1})),void 0===T&&x.setFieldsValue({"ddr-51-pt":!1})}),[T]),(0,b.useEffect)((()=>{if(f){var e;const t=Object.keys(d).reduce(((e,t)=>(A.vM[t]&&(e[t]=A.vM[t](Z,f,T)),e)),{});x.setFieldsValue((0,l.Z)((0,l.Z)({},t),{},{stressedSyllable:f===a.syllables?a.stressedSyllable:(null!==(e=a.stressedSyllable)&&void 0!==e?e:Z.includes(" "))?-1:void 0}))}}),[Z,f,T]);const S=I.Z.useWatch("stressedSyllable",x);(0,b.useEffect)((()=>{if(!T&&void 0!==S){const e=Object.keys(d).reduce(((e,t)=>(A.bx[t]&&(e[t]=A.bx[t](Z,f,S)),e)),{});x.setFieldsValue((0,l.Z)({},e))}}),[S]);const F=x.getFieldValue("ddr-1-pt"),M=x.getFieldValue("ddr-2-pt"),z=x.getFieldValue("ddr-50-pt");(0,b.useEffect)((()=>{!0===F&&(x.setFieldsValue({"ddr-2-pt":!1}),x.setFieldsValue({"ddr-50-pt":!1}))}),[F]),(0,b.useEffect)((()=>{!0===M&&(x.setFieldsValue({"ddr-1-pt":!1}),x.setFieldsValue({"ddr-50-pt":!1}))}),[M]),(0,b.useEffect)((()=>{!0===z&&(x.setFieldsValue({"ddr-1-pt":!1}),x.setFieldsValue({"ddr-2-pt":!1}))}),[z]);const R=x.getFieldValue("ddr-3-pt");(0,b.useEffect)((()=>{!0===R&&x.setFieldsValue({"ddr-4-pt":!1})}),[R]);const U=x.getFieldValue("ddr-4-pt");(0,b.useEffect)((()=>{!0===U&&x.setFieldsValue({"ddr-3-pt":!1})}),[U]),(0,b.useEffect)((()=>{(null===Z||void 0===Z?void 0:Z.includes("-"))&&x.setFieldsValue({"ddr-5-pt":!0})}),[Z]);const B=(0,b.useMemo)((()=>(null!==f&&void 0!==f?f:"").split(A.$Y)),[f]);return(0,y.jsx)(k.Z,{width:r,title:(0,y.jsxs)(y.Fragment,{children:["Edit ",a.name," ",u&&(0,y.jsx)("small",{children:u})]}),open:t,onOk:x.submit,onCancel:n,maskClosable:!1,okButtonProps:{disabled:v,htmlType:"submit",size:"large"},okText:null!==h&&void 0!==h?h:"Add Item",children:(0,y.jsxs)(I.Z,{form:x,name:"new-item-".concat(a.itemId),onFinish:e=>{const t=V(e);i(t)},autoComplete:"off",initialValues:D(a,d),layout:"vertical",size:"small",labelWrap:!0,children:[(0,y.jsxs)("div",{className:"diagram-container",children:[(0,y.jsx)("div",{children:(0,y.jsx)(P.ck,{id:a.itemId,width:50})}),(0,y.jsx)(I.Z.Item,{name:"name",label:"Name",children:(0,y.jsx)(w.Z,{})}),(0,y.jsx)(I.Z.Item,{name:"itemId",label:"Item",children:(0,y.jsx)(w.Z,{readOnly:!0})}),(0,y.jsx)(I.Z.Item,{name:"syllables",label:"Syllables",children:(0,y.jsx)(w.Z,{})}),(0,y.jsx)(I.Z.Item,{name:"stressedSyllable",label:"Stressed Syllable",children:(0,y.jsx)(C.ZP.Group,{optionType:"button",buttonStyle:"solid",children:B.map(((e,t)=>(0,y.jsx)(C.ZP,{value:B.length-t-1,children:e},t)))})}),(0,y.jsx)(I.Z.Item,{name:"updatedAt",label:"Updated At",children:(0,y.jsx)(w.Z,{value:new Date(a.updatedAt).toLocaleString(),readOnly:!0})}),(o||m)&&(0,y.jsxs)("div",{children:[o&&(0,y.jsxs)("span",{children:["Options: ",null===o||void 0===o?void 0:o.join(", ")]}),m&&(0,y.jsx)(c.ZP,{size:"small",onClick:m,type:"dashed",className:"mt-2",children:"Give me another thing"})]}),(0,y.jsx)("div",{children:(0,y.jsx)(N.Z,{offsetTop:50,children:(0,y.jsx)(s.Z,{justify:"center",align:"center",children:(0,y.jsx)(c.ZP,{type:"primary",htmlType:"submit",size:"large",disabled:v,children:null!==h&&void 0!==h?h:"Add Item"})})})})]}),(0,y.jsx)("div",{className:"diagram-container",children:g.map((e=>"auto"===e.method&&A.nE[e.id]||"dependency"===e.method?(0,y.jsx)(I.Z.Item,{name:e.id,label:e.title,valuePropName:"checked",className:(0,O.Z)(a.updatedAt<e.updatedAt&&"diagram-container__outdated-rule"),children:(0,y.jsx)(E.Z,{checkedChildren:"\u2705",unCheckedChildren:"\u274c",disabled:!0})},e.id):(0,y.jsx)(I.Z.Item,{name:e.id,label:e.title,className:(0,O.Z)(a.updatedAt<e.updatedAt&&"diagram-container__outdated-rule"),children:(0,y.jsxs)(C.ZP.Group,{optionType:"button",buttonStyle:"solid",children:[(0,y.jsx)(C.ZP,{value:!0,children:"\u2705"}),(0,y.jsx)(C.ZP,{value:!1,children:"\u274c"})]})},e.id)))})]})})}const D=(e,t)=>{var i,n;let s=!1;return(0,l.Z)((0,l.Z)({name:e.name,itemId:e.itemId,syllables:null!==(i=e.syllables)&&void 0!==i?i:(0,A.wM)(e.name),stressedSyllable:null!==(n=e.stressedSyllable)&&void 0!==n?n:0},Object.keys(t).reduce(((i,l)=>{if(e.updatedAt<t[l].updatedAt)if(A.nE[l]){const t=A.nE[l](e.name);t&&e.rules.includes(l)&&(s=!0),i[l]=t}else i[l]=void 0;else i[l]=e.rules.includes(l);return i}),{})),{},{updatedAt:s?Date.now():e.updatedAt})},V=e=>{const{itemId:t,name:i,updatedAt:l,syllables:n,stressedSyllable:s}=e,a=(0,S.Z)(e,F);return{itemId:t,name:i,updatedAt:Date.now(),syllables:n,stressedSyllable:s,rules:Object.keys(a).filter((e=>!0===a[e]))}};var z=i(1046),R=i(2082),U=i(6978),B=i(4691);function L(e){let{itemId:t,name:i,width:l=50}=e;return(0,y.jsxs)(s.Z,{vertical:!0,align:"center",children:[(0,y.jsx)(P.ck,{id:t,width:l}),(0,y.jsx)(u.Z.Text,{code:!0,children:i},t)]})}function _(e){let{thing:t,width:i=50,onActivateThing:l}=e;return(0,y.jsx)(h.F6,{onClick:()=>l(t),children:(0,y.jsx)(L,{itemId:t.itemId,name:t.name,width:i})})}const W=["leftCircleChildren","rightCircleChildren","intersectionChildren"];function q(e){let{game:t}=e;const[i]=(0,b.useState)([{id:t.rule1.thing.id,name:t.rule1.thing.name,rule:1}]),[l]=(0,b.useState)([{id:t.rule2.thing.id,name:t.rule2.thing.name,rule:2}]),[n]=(0,b.useState)([{id:t.intersectingThing.id,name:t.intersectingThing.name,rule:0}]),[s]=(0,b.useState)(t.things.slice(0,4)),[a,d]=(0,b.useState)(t.things[0]);return(0,y.jsxs)(z.Z,{direction:"vertical",align:"center",children:[(0,y.jsx)(u.Z.Title,{level:4,children:"Game Sample"}),(0,y.jsxs)(u.Z.Title,{level:5,children:['"',t.title,'"']}),(0,y.jsx)(U.Z,{value:t.level,count:t.level,disabled:!0}),(0,y.jsx)(u.Z.Paragraph,{style:{maxWidth:"500px"},children:"O c\xedrculo amarelo tem uma regra gramatical secreta e o circulo vermelho tem outra regra gramatical secreta. O quadrado do meio representa a interse\xe7\xe3o entre a regra amarela e a regra vermelha."}),(0,y.jsx)(z.Z,{children:(0,y.jsx)(G,{width:600,leftCircleChildren:(0,y.jsx)(h.F6,{style:{width:"100%",height:"100%"},children:i.map(((e,t,i)=>(0,y.jsx)(L,{itemId:e.id,name:e.name,width:t===i.length-1?80:60},e.id)))}),rightCircleChildren:(0,y.jsx)(h.F6,{style:{width:"100%",height:"100%"},children:l.map(((e,t,i)=>(0,y.jsx)(L,{itemId:e.id,name:e.name,width:t===i.length-1?80:60},e.id)))}),intersectionChildren:(0,y.jsx)(h.F6,{style:{width:"100%",height:"100%"},children:n.map(((e,t,i)=>(0,y.jsx)(L,{itemId:e.id,name:e.name,width:t===i.length-1?80:60},e.id)))})})}),(0,y.jsx)(u.Z.Text,{children:"Coloque os objetos nos c\xedrculos corretos:"}),(0,y.jsx)(z.Z,{className:"space--center",children:s.map((e=>(0,y.jsx)(h.F6,{style:e.id===(null===a||void 0===a?void 0:a.id)?{outline:"3px solid hotPink"}:{},onClick:()=>d(e),children:(0,y.jsx)(L,{itemId:e.id,name:e.name},e.id)},e.id)))}),(0,y.jsx)(B.Z,{items:[{key:"1",label:"Resposta",children:(0,y.jsxs)(z.Z,{direction:"vertical",children:[(0,y.jsx)(u.Z.Text,{strong:!0,children:"Regra Amarela"}),(0,y.jsx)("ul",{children:(0,y.jsx)("li",{children:(0,y.jsx)(u.Z.Text,{children:t.rule1.text})})}),(0,y.jsx)(u.Z.Text,{strong:!0,children:"Regra Vermelha"}),(0,y.jsx)("ul",{children:(0,y.jsx)("li",{children:(0,y.jsx)(u.Z.Text,{children:t.rule2.text})})})]})}]}),(0,y.jsx)("div",{style:{height:"200px"}})]})}function G(e){let{leftCircleChildren:t,rightCircleChildren:i,intersectionChildren:n}=e,s=(0,S.Z)(e,W);return(0,y.jsxs)("svg",(0,l.Z)((0,l.Z)({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 760 500"},s),{},{children:[(0,y.jsx)("path",{fill:"#fbb03b",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5",d:"M252.78 3.5c-136.42 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.59-247-247-247zm.99 483.07C123.39 486.57 17.7 380.88 17.7 250.5S123.39 14.43 253.77 14.43 489.84 120.12 489.84 250.5 384.15 486.57 253.77 486.57z"}),(0,y.jsx)("path",{fill:"#f15a24",stroke:"#000",strokeMiterlimit:"10",strokeWidth:"5",d:"M508.22 3.5c-136.41 0-247 110.59-247 247s110.59 247 247 247 247-110.59 247-247-110.58-247-247-247zm.99 483.07c-130.38 0-236.07-105.69-236.07-236.07S378.84 14.43 509.22 14.43 745.29 120.12 745.29 250.5 639.6 486.57 509.22 486.57z"}),(0,y.jsx)("path",{fill:"#535353",d:"M487.34 250.5c0-62.39-24.29-121.04-68.41-165.16a235.9 235.9 0 00-37.43-30.47 235.35 235.35 0 00-37.43 30.47c-44.12 44.11-68.41 102.77-68.41 165.16s24.29 121.04 68.41 165.16a235.9 235.9 0 0037.43 30.47 235.35 235.35 0 0037.43-30.47c44.12-44.11 68.41-102.77 68.41-165.16z"}),(0,y.jsx)("path",{fill:"#535353",d:"M258.72 250.5c0-66.64 25.95-129.3 73.08-176.42a253.125 253.125 0 0134.1-28.57c-33.98-18.65-72.29-28.57-112.13-28.57-62.39 0-121.04 24.29-165.16 68.41C44.5 129.46 20.2 188.11 20.2 250.5s24.29 121.04 68.41 165.16c44.11 44.12 102.77 68.41 165.16 68.41 39.84 0 78.15-9.92 112.13-28.57a252.507 252.507 0 01-34.1-28.57c-47.12-47.12-73.08-109.78-73.08-176.42zM674.37 85.34C630.25 41.22 571.6 16.93 509.21 16.93c-40.27 0-78.98 10.14-113.24 29.18 11.74 8.26 22.86 17.6 33.22 27.96 47.12 47.12 73.08 109.78 73.08 176.42s-25.95 129.3-73.08 176.42a252.312 252.312 0 01-33.22 27.96c34.25 19.04 72.96 29.18 113.24 29.18 62.39 0 121.04-24.29 165.16-68.41 44.12-44.11 68.41-102.77 68.41-165.16s-24.29-121.04-68.41-165.16z"}),(0,y.jsx)("foreignObject",{x:"30",y:"25",width:"250",height:"450",children:(0,y.jsx)("div",{className:"venn-diagram__circle-content-left",children:t})}),(0,y.jsx)("foreignObject",{x:"480",y:"25",width:"250",height:"450",children:(0,y.jsx)("div",{className:"venn-diagram__circle-content-right",children:i})}),(0,y.jsx)("foreignObject",{x:"290",y:"65",width:"182",height:"370",children:(0,y.jsx)("div",{className:"venn-diagram__circle-content-intersection",children:n})})]}))}function Y(e){let{things:t,rules:i}=e;const[l]=(0,T.Z)(),[n,s]=(0,b.useState)(null);return(0,y.jsxs)(z.Z,{direction:"vertical",ref:l,children:[(0,y.jsx)(u.Z.Title,{level:5,children:"Game Simulator"}),(0,y.jsx)(c.ZP,{size:"large",onClick:()=>{s(Object.values((0,R.h)(1,{latestDate:"2023/01/01",latestNumber:0,used:[]},i,t))[0])},children:"Simulate"}),(0,y.jsx)(c.ZP,{size:"large",onClick:()=>{let e=null;try{e=(0,R.h)(25,{latestDate:"2023/01/01",latestNumber:0,used:[]},i,t),console.log(e)}catch(l){console.error(l)}},children:"Generate Demos (log)"}),n&&(0,y.jsx)(q,{game:n},JSON.stringify(n))]})}function J(e){let{children:t,things:i,rules:l,addEntryToUpdate:n}=e;const s=(0,b.useMemo)((()=>{const e=(0,A.qG)(l);return Object.values(i).filter((t=>{const i=t.updatedAt;return t.syllables&&t.syllables.split(A.$Y).join("")!==t.name.replace(/\s/g,"")?(console.log("\u2757\ufe0f Name and syllables do not match",t.name,t.syllables),!0):e>i}))}),[i,l]),[a,d]=(0,b.useState)(null);(0,b.useEffect)((()=>{console.count("Checking for things that need to update..."),s.length>0&&(async e=>{console.log("Found things that need to update..."),d(null),await(0,v.Dc)(250),s.length>0&&d(s[0])})(s[0])}),[s]);return(0,y.jsxs)(y.Fragment,{children:[a&&(0,y.jsx)(M,{subtitle:"(".concat(s.length," left to update)"),isModalOpen:null!==a,onSaveThing:e=>{n(e.itemId,e)},onCancel:()=>d(null),thing:a,rules:l,okButtonText:"Update",width:"90vw"}),t]})}var K=i(952),Q=i(1431),H=i(2786),X=i(548),$=i(4747);function ee(e){let{addEntryToUpdate:t,availableThings:i,rules:l,width:n}=e;const{notification:s}=$.Z.useApp(),[a,d]=(0,b.useState)(null),r=()=>{const e=(0,j.sample)(i);d(e?{itemId:e.id,name:te(e),updatedAt:Date.now(),syllables:"",stressedSyllable:0,rules:[]}:null)},o=(0,b.useMemo)((()=>{var e;if(!a)return[];const t=i.find((e=>e.id===a.itemId));return[null===t||void 0===t?void 0:t.name.pt,...null!==(e=null===t||void 0===t?void 0:t.aliasesPt)&&void 0!==e?e:[]].filter(Boolean)}),[a,i]);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(c.ZP,{size:"large",onClick:r,children:"Classify New Item"}),!!a&&(0,y.jsx)(M,{isModalOpen:null!==a,onSaveThing:async e=>{a&&(e.name&&e.itemId||s.error({message:"Name and Item ID are required"}),t(e.itemId,e),console.log("COMPLETED SAVE"),d(null),await(0,v.Dc)(250),r())},onCancel:()=>d(null),thing:a,rules:l,width:.9*n,itemAliases:o,onGiveAnotherThing:async()=>{d(null),await(0,v.Dc)(100),r()}})]})}const te=e=>{return 1===e.name.pt.split(" ").length?e.name.pt:e.aliasesPt&&null!==(t=e.aliasesPt.find((e=>1===e.split(" ").length)))&&void 0!==t?t:e.name.pt;var t};function ie(e){let{things:t,addEntryToUpdate:i,availableThings:l,rules:n,setActiveThing:a}=e;const[d,{width:r}]=(0,T.Z)(),c=(0,b.useMemo)((()=>Object.values(t)),[t]),h=(0,X.P)({total:c.length,showQuickJumper:!0}),m=[{title:"ItemId",dataIndex:"itemId",key:"itemId",sorter:(e,t)=>Number(e.itemId)-Number(t.itemId),render:e=>(0,y.jsx)(K.Z,{children:e})},{title:"Name",dataIndex:"name",key:"name",sorter:(e,t)=>e.name.localeCompare(t.name),render:e=>(0,y.jsx)(u.Z.Text,{children:e})},{title:"Sprite",dataIndex:"itemId",key:"sprite",render:e=>(0,y.jsx)(_,{thing:t[e],onActivateThing:a},"i-".concat(e))},{title:"Rules",dataIndex:"rules",key:"rules",render:(e,t)=>(0,y.jsx)(z.Z,{wrap:!0,children:e.map((e=>(0,y.jsx)(Q.Z,{title:n[e].title,children:(0,y.jsx)(K.Z,{color:n[e].updatedAt>t.updatedAt?"red":void 0,children:e})},e)))})},{title:"Count",dataIndex:"rules",key:"count",sorter:(e,t)=>e.rules.length-t.rules.length,render:e=>e.length}],g=(0,b.useMemo)((()=>{const e={};return Object.values(t).forEach((t=>{e[t.name]||(e[t.name]=[]),e[t.name].push(t.itemId)})),Object.values(e).filter((e=>e.length>1))}),[t]);return(0,y.jsxs)(z.Z,{direction:"vertical",ref:d,children:[(0,y.jsxs)(u.Z.Title,{level:5,children:["Rules By Items ",(0,y.jsx)(o.Z,{type:"vertical"})," Added: ",(0,y.jsx)(K.Z,{children:Object.keys(t).length})," Available to add ",(0,y.jsx)(K.Z,{children:l.length})]}),(0,y.jsx)(ee,{addEntryToUpdate:i,availableThings:l,rules:n,width:r}),(0,y.jsx)(o.Z,{}),(0,y.jsx)(H.Z,{dataSource:c,columns:m,rowKey:"itemId",pagination:h}),(0,y.jsx)(o.Z,{}),(0,y.jsx)(u.Z.Title,{level:5,children:"Duplicated Things"}),(0,y.jsxs)(z.Z,{wrap:!0,children:[0===g.length&&(0,y.jsx)(u.Z.Text,{children:"No duplicated things"}),g.map((e=>(0,y.jsxs)(s.Z,{align:"center",children:[(0,y.jsx)(K.Z,{color:"red",children:e.length}),e.map((e=>(0,y.jsx)(_,{thing:t[e],onActivateThing:a},"i-".concat(e))))]},e[0])))]})]})}function le(e){let{things:t,addEntryToUpdate:i,availableThings:n,rules:s,thingsByRules:a,setActiveThing:d,containerWidth:r}=e;const{is:c,addParam:h}=(0,p.K)(),m=(0,b.useMemo)((()=>Object.values(s).map((e=>(0,l.Z)((0,l.Z)({},e),{},{thingsCount:a[e.id].length})))),[s,a]),g=(0,X.P)({total:m.length,showQuickJumper:!0}),x=(0,b.useMemo)((()=>{const e=Object.values(a).map((e=>e.length));return{maxThings:Math.max(...e),minThings:Math.min(...e),averageThings:Math.round(Object.values(a).reduce(((e,t)=>e+t.length),0)/Object.keys(a).length)}}),[a]),j=[{title:"Id",dataIndex:"id",key:"id",sorter:(e,t)=>Number(e.id.split("-")[1])-Number(t.id.split("-")[1]),render:e=>(0,y.jsx)(u.Z.Text,{children:e})},{title:"Rule",dataIndex:"title",key:"title",sorter:(e,t)=>e.title.localeCompare(t.title),render:e=>(0,y.jsx)(u.Z.Text,{children:e})},{title:"Type",dataIndex:"type",key:"type",sorter:(e,t)=>e.type.localeCompare(t.type)},{title:"Method",dataIndex:"method",key:"method",sorter:(e,t)=>e.method.localeCompare(t.method)},{title:"Things",dataIndex:"thingsCount",key:"thingsCount",render:(e,i)=>(0,y.jsxs)(z.Z,{size:"small",children:[(0,y.jsx)(K.Z,{children:e}),c("showThings")?(0,y.jsxs)(z.Z,{size:"small",wrap:!0,children:[a[i.id].slice(0,20).map((e=>(0,y.jsx)(_,{thing:t[e],onActivateThing:d},"".concat(i.id,"-").concat(e)))),a[i.id].length>20&&(0,y.jsxs)(u.Z.Text,{children:["+",e-20," more"]})]}):(0,y.jsxs)(z.Z,{size:"small",wrap:!0,children:[a[i.id].slice(0,5).map((e=>(0,y.jsx)(_,{thing:t[e],onActivateThing:d},"".concat(i.id,"-").concat(e)))),a[i.id].length>5&&(0,y.jsxs)(u.Z.Text,{children:["+",e-5," more"]})]})]}),sorter:(e,t)=>e.thingsCount-t.thingsCount},{title:"Level",dataIndex:"level",key:"level",sorter:(e,t)=>e.level-t.level,render:e=>(0,y.jsx)(U.Z,{value:e,count:3,disabled:!0})}];return(0,y.jsxs)(z.Z,{direction:"vertical",children:[(0,y.jsxs)(u.Z.Title,{level:4,children:["Things By Rule (Added: ",Object.keys(t).length," | ",n.length,")"," "]}),(0,y.jsxs)(z.Z,{split:(0,y.jsx)(o.Z,{type:"vertical"}),wrap:!0,children:[(0,y.jsx)(ee,{addEntryToUpdate:i,availableThings:n,rules:s,width:r}),(0,y.jsxs)(u.Z.Text,{strong:!0,children:["Average Things: ",(0,y.jsx)(K.Z,{children:x.averageThings})]}),(0,y.jsxs)(u.Z.Text,{strong:!0,children:["Max Things: ",(0,y.jsx)(K.Z,{children:x.maxThings})]}),(0,y.jsxs)(u.Z.Text,{strong:!0,children:["Min Things: ",(0,y.jsx)(K.Z,{children:x.minThings})]}),(0,y.jsx)(E.Z,{checked:c("showThings"),onChange:e=>h("showThings",e),checkedChildren:"Hide things",unCheckedChildren:"Show things"})]}),(0,y.jsx)(H.Z,{dataSource:m,columns:j,pagination:g})]})}function ne(e){let{data:t,addEntryToUpdate:i}=e;const[l,{width:n}]=(0,T.Z)(),s=(0,f.N)("items"),d=(0,f.N)("daily-diagram-rules"),r=(0,b.useMemo)((()=>{var e;return Object.values(null!==(e=s.data)&&void 0!==e?e:{}).filter((e=>{var i,l,n;if(t&&void 0!==t[e.id])return!1;if(e.nsfw)return!1;const s=1===e.name.pt.split(" ").length;return!(null===(i=e.decks)||void 0===i||!i.includes("thing"))||(!(null===(l=e.decks)||void 0===l||!l.includes("alien")||!s)||!(null===(n=e.decks)||void 0===n||!n.includes("manufactured")||!s))}))}),[t,s.data]),o=(0,b.useMemo)((()=>{var e;return null!==(e=d.data)&&void 0!==e?e:{}}),[d.data]),c=(0,b.useMemo)((()=>{const e=Object.values(o).reduce(((e,t)=>(e[t.id]=[],e)),{});return(0,j.orderBy)(Object.values(t),["updatedAt"],["desc"]).forEach((t=>{t.rules.forEach((i=>{e[i].push(t.itemId)}))})),e}),[t,o]),{is:h,queryParams:m}=(0,p.K)(),[g,x]=(0,b.useState)(null);if(s.isLoading||d.isLoading)return(0,y.jsx)(u.Z.Text,{children:"Loading..."});return(0,y.jsx)(a.T,{isLoading:s.isLoading||d.isLoading,hasResponseData:s.hasResponseData||d.hasResponseData,children:(0,y.jsx)("div",{ref:l,children:(0,y.jsxs)(J,{things:t,rules:o,addEntryToUpdate:i,children:[g&&(0,y.jsx)(M,{isModalOpen:null!==g,onSaveThing:e=>{var t;i((t=e).itemId,t),x(null)},onCancel:()=>x(null),thing:g,rules:o,okButtonText:"Update",width:n}),(h("display","rule")||!m.has("display"))&&(0,y.jsx)(le,{things:t,addEntryToUpdate:i,availableThings:r,rules:o,thingsByRules:c,setActiveThing:x,containerWidth:n}),h("display","thing")&&(0,y.jsx)(ie,{things:t,addEntryToUpdate:i,availableThings:r,rules:o,thingsByRules:c,setActiveThing:x}),h("display","simulator")&&(0,y.jsx)(Y,{things:t,addEntryToUpdate:i,availableThings:r,rules:o})]})})})}var se=i(4562),ae=i(8938);function de(){const e=(0,ae.i)({tdrResourceName:"daily-diagram-items",firebaseDataCollectionName:"diagramItems",serialize:!0});return(0,y.jsx)(x.Xg,{title:"Items",subtitle:"Diagram Sets",children:(0,y.jsxs)(n.Z,{hasSider:!0,children:[(0,y.jsx)(se.p,{children:(0,y.jsx)(Z,(0,l.Z)({},e))}),(0,y.jsx)(n.Z.Content,{className:"content",children:(0,y.jsx)(a.T,{isLoading:e.isLoading||e.isSaving,error:e.error,hasResponseData:!(0,j.isEmpty)(e.data),children:(0,y.jsx)(s.Z,{vertical:!0,gap:24,children:(0,y.jsx)(ne,(0,l.Z)({},e))})})})]})})}const re=de}}]);
//# sourceMappingURL=ItemsDiagramSets.57a72d16.chunk.js.map