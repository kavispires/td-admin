"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[6213],{8384:(e,a,t)=>{t.d(a,{x:()=>u});var n=t(1413),r=t(4925),o=t(732),i=t(6473),s=t(9475),d=t(3733),c=t(184);const l=["open","onClose"];function u(e){let{open:a,onClose:t}=e,u=(0,r.Z)(e,l);return(0,c.jsx)(i.Z,(0,n.Z)({className:(0,d.Z)("full-screen-modal",!a&&"full-screen-modal--hidden"),bordered:!1,extra:(0,c.jsx)(s.ZP,{onClick:t,type:"text",shape:"circle",icon:(0,c.jsx)(o.Z,{})})},u))}},7340:(e,a,t)=>{t.d(a,{k:()=>p});var n=t(1413),r=t(4925),o=t(9475),i=t(2426),s=t.n(i),d=t(2791),c=t(8211),l=t(4483),u=t(4841),g=t(184);const m=["isDirty","onSave","isSaving","dirt","interval"];function p(e){let{isDirty:a,onSave:t,isSaving:i,dirt:p,interval:v=6e5}=e,f=(0,r.Z)(e,m);const{togglePendingSave:y}=(0,u.b)(),[,h,Z]=(0,c.Z)((()=>{a&&t()}),v);return(0,d.useEffect)((()=>{a?(y(!0),console.log("Save Reset",s()(Date.now()).format("MM/DD/YYYY HH:mm:ss")),Z()):(y(!1),h())}),[a,Z,h,p]),(0,d.useEffect)((()=>{const e=e=>{if(a){const a="You have unsaved changes, are you sure you want to leave?";return e.returnValue=a,a}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[a]),(0,g.jsx)(o.ZP,(0,n.Z)((0,n.Z)({type:"primary",size:"large",icon:(0,g.jsx)(l.Z,{}),onClick:t,disabled:!a,loading:i,danger:!0,block:!0},f),{},{children:"Save"}))}},145:(e,a,t)=>{t.d(a,{f:()=>s});var n=t(2402),r=t(3733),o=t(2606),i=t(184);const s=e=>{let{id:a,width:t=200,className:s="",preview:d=!0,fileExtension:c="jpg"}=e;const{getUrl:l}=(0,o.n)("images"),u=a.replace(/-/g,"/");return(0,i.jsx)("div",{className:(0,r.Z)("image-card",s),children:(0,i.jsx)(n.Z,{width:t,src:l("".concat(u,".").concat(c)),fallback:l("back/default.jpg"),preview:d})})}},359:(e,a,t)=>{t.d(a,{p:()=>i});var n=t(1413),r=t(5529),o=t(763);function i(){var e;const a=(0,r.N)("images-decks"),t=null!==(e=a.data)&&void 0!==e?e:{},i=()=>{if((0,o.isEmpty)(t))return"td-d0-00";const e=(0,o.sample)(Object.keys(t));if(!e)return"td-d0-00";const a=(0,o.random)(1,t[e]);return"".concat(e,"-").concat(a.toString().padStart(2,"0"))};return(0,n.Z)((0,n.Z)({},a),{},{decks:t,decksList:Object.keys(t),onRandomCard:i,onRandomUniqueCard:e=>{let a=0;for(;a<30;){const t=i();if(!e.includes(t))return t;a++}if(a>30)throw new Error("Could not find a unique card")},onRandomCards:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const a=[];let t=0;for(;Object.keys(a).length<e&&t<30;){const e=i();a.includes(e)?t++:a.push(e)}if(t>30&&a.length<e)throw new Error("Could not find enough unique cards");return a}})}},8027:(e,a,t)=>{t.d(a,{A:()=>d,X:()=>c});var n=t(1413),r=t(9631),o=t(2592),i=t(2010),s=t(5850);function d(e,a){return async()=>{var t;console.log("%cQuerying ".concat(e,"/").concat(a," from firebase: ").concat((0,s.xE)()),"color: #f0f");const n=(0,r.JU)(o.RZ,"".concat(e,"/").concat(a));return null!==(t=(await(0,r.QT)(n)).data())&&void 0!==t?t:{}}}function c(e,a,t){return(0,i.a)((0,n.Z)({queryKey:["firebase",e,a],queryFn:d(e,a)},t))}},8938:(e,a,t)=>{t.d(a,{i:()=>g});var n=t(1413),r=t(4747),o=t(763),i=t(2791),s=t(3713),d=t(5850),c=t(8027),l=t(5529),u=t(2233);function g(e){let{tdrResourceName:a,firebaseDataCollectionName:t,serialize:g}=e;const{notification:m}=r.Z.useApp(),p=(0,s.NL)(),v=(0,l.N)(a),f=(0,c.X)("tdr",t,{select:g?d.d_:void 0}),[y,h]=(0,i.useState)({}),Z=(0,u.B)("tdr",t,{onSuccess:()=>{m.success({message:"".concat(t," updated")}),p.refetchQueries({queryKey:["firebase","tdr",t]}),h({})},onError:e=>{m.error({message:"".concat(t," update failed"),description:e.message})}}),x=(0,i.useMemo)((()=>{var e,r;return v.isSuccess&&f.isSuccess&&!Z.isPending?(console.log("%cMerging ".concat(a,"+").concat(t," data..."),"color: #f0f"),(0,o.cloneDeep)((0,n.Z)((0,n.Z)((0,n.Z)({},null!==(e=v.data)&&void 0!==e?e:{}),null!==(r=f.data)&&void 0!==r?r:{}),y))):{}}),[a,t,v.data,f.data,v.isSuccess,f.isSuccess,Z.isPending,y]),j=!(0,o.isEmpty)(y),C=f.data;return{data:x,isLoading:v.isLoading||f.isLoading,error:v.error||f.error,firebaseData:C,isSaving:Z.isPending,save:()=>{Z.mutate(g?(0,d.aS)(y):y)},addEntryToUpdate:(e,a)=>{h((t=>(0,n.Z)((0,n.Z)({},t),{},{[e]:a})))},entriesToUpdate:y,isDirty:j}}},5529:(e,a,t)=>{t.d(a,{N:()=>s,Y:()=>d});var n=t(1413),r=t(763),o=t(2010),i=t(2606);function s(e){var a;let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{getUrl:s}=(0,i.n)("resources"),d=(0,o.a)({queryKey:[e],queryFn:async()=>{const a=await fetch(s("".concat(e,".json")));return await a.json()},enabled:t}),c=!(0,r.isEmpty)(d.data);return(0,n.Z)((0,n.Z)({},d),{},{data:null!==(a=d.data)&&void 0!==a?a:{},hasResponseData:c})}function d(e){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{getUrl:t}=(0,i.n)("resources"),s=(0,o.a)({queryKey:[e],queryFn:async()=>{const a=await fetch(t("".concat(e,".json")));return await a.json()},enabled:a}),d=!(0,r.isEmpty)(s.data);return(0,n.Z)((0,n.Z)({},s),{},{data:s.data,hasResponseData:d})}},548:(e,a,t)=>{t.d(a,{P:()=>r});var n=t(4766);function r(e){var a,t;let{prefix:r="",defaultCurrent:o=1,defaultPageSize:i=10,pageSizeOptions:s=[10,20,50,100],total:d,showQuickJumper:c}=e;const{queryParams:l,addParam:u}=(0,n.K)();return{current:Number(null!==(a=l.get("".concat(r,"page")))&&void 0!==a?a:String(o)),pageSize:Number(null!==(t=l.get("".concat(r,"pageSize")))&&void 0!==t?t:String(i)),onChange:e=>{u("".concat(r,"page"),e.toString(),String(o))},onShowSizeChange:(e,a)=>{u("".concat(r,"pageSize"),a.toString(),String(i))},defaultCurrent:o,defaultPageSize:i,pageSizeOptions:s,total:d,hideOnSinglePage:!0,showQuickJumper:c}}},2233:(e,a,t)=>{t.d(a,{B:()=>d});var n=t(1413),r=t(9631),o=t(2592),i=t(8556);function s(e,a,t){console.log("%cUpdating ".concat(e,"/").concat(a," from firebase"),"color: #f00");const n=(0,r.JU)(o.RZ,"".concat(e,"/").concat(a));return(0,r.r7)(n,t)}function d(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,i.D)((0,n.Z)({mutationFn:async t=>s(e,a,t)},t))}},6212:(e,a,t)=>{t.r(a),t.d(a,{ImageCardsDescriptor:()=>Q,default:()=>Y});var n=t(1413),r=t(1790),o=t(2128),i=t(4766),s=t(5529),d=t(4925),c=t(959),l=t(7391),u=t(4520),g=t(9475),m=t(6979),p=t(7515),v=t(906),f=t(8384),y=t(5850),h=t(145),Z=t(184);const x=["imageCard","addEntryToUpdate"],j=["imageCard","addEntryToUpdate","style"],C=["imageCard","addEntryToUpdate","style"];function w(e){var a,t;let{data:n,addEntryToUpdate:r,onClose:o,onNewCard:s}=e;const{queryParams:d,removeParam:c,addParam:l}=(0,i.K)(),p=Number(null!==(a=d.get("cardSize"))&&void 0!==a?a:200),v=d.get("cardId"),y=null!==(t=n[null!==v&&void 0!==v?v:""])&&void 0!==t?t:{id:v,keywords:[]};return(0,Z.jsx)(f.x,{title:"Image Card Descriptor for ".concat(v),open:!!v,onClose:()=>c("cardId"),cover:(0,Z.jsx)(u.Z,{justify:"center",align:"center",style:{width:"100vw"},children:(0,Z.jsx)(h.f,{id:null!==v&&void 0!==v?v:"",width:p})}),actions:[(0,Z.jsx)(g.ZP,{className:"my-10",onClick:o,children:"Close"},"cancel"),(0,Z.jsx)(g.ZP,{className:"my-10",onClick:s,children:"New Card"},"cancel")],children:(0,Z.jsxs)(u.Z,{gap:8,vertical:!0,style:{maxWidth:"500px"},children:[(0,Z.jsx)(m.Z,{value:p,min:100,max:500,step:25,style:{maxWidth:500,width:"100%"},onChange:e=>l("cardSize",e,200)}),(0,Z.jsx)(S,{imageCard:y,addEntryToUpdate:r,size:"large"}),(0,Z.jsx)(k,{imageCard:y,addEntryToUpdate:r,size:"large"}),(0,Z.jsx)(b,{imageCard:y,addEntryToUpdate:r,size:"large"})]},v)})}function S(e){let{imageCard:a,addEntryToUpdate:t}=e,r=(0,d.Z)(e,x);const o=a.favorite;return(0,Z.jsx)(g.ZP,(0,n.Z)({shape:"circle",icon:o?(0,Z.jsx)(c.Z,{style:{color:"red"}}):(0,Z.jsx)(l.Z,{}),type:"text",onClick:()=>t(a.id,(0,n.Z)((0,n.Z)({},a),{},{favorite:!o}))},r))}function k(e){let{imageCard:a,addEntryToUpdate:t,style:r}=e,o=(0,d.Z)(e,j);return(0,Z.jsx)(p.Z.Search,(0,n.Z)({defaultValue:a.keywords.join(" "),onSearch:e=>{return r=e,void t(a.id,(0,n.Z)((0,n.Z)({},a),{},{keywords:(0,y.R1)(r.toLocaleLowerCase().split(/, |,| /).filter(Boolean).map((e=>e.trim())).sort())}));var r},style:(0,n.Z)({maxWidth:500,width:"100%"},r),enterButton:"Update"},o))}function b(e){let{imageCard:a,addEntryToUpdate:t,style:r}=e,o=(0,d.Z)(e,C);return(0,Z.jsx)(v.Z,(0,n.Z)({mode:"multiple",allowClear:!0,style:(0,n.Z)({width:"100%"},r),placeholder:"Please select",defaultValue:null===a||void 0===a?void 0:a.triggers,onChange:e=>{t(a.id,(0,n.Z)((0,n.Z)({},a),{},{triggers:e}))},options:[{label:"aliens",value:"aliens"},{label:"insets",value:"insets"},{label:"snakes",value:"snakes"},{label:"spiders",value:"spiders"},{label:"scarry",value:"scarry"}]},o))}var E=t(1752),P=t(5625),N=t(548);function D(e){let{data:a,addEntryToUpdate:t}=e;const{addParam:n}=(0,i.K)(),r=[{title:"CardId",dataIndex:"id",key:"id",sorter:(e,a)=>Number(e.id)-Number(a.id)},{title:"Image",dataIndex:"id",key:"image",render:e=>(0,Z.jsx)(h.f,{id:e,width:50})},{title:"Keywords",dataIndex:"keywords",key:"keywords",render:e=>null===e||void 0===e?void 0:e.join(", ")},{title:"Triggers",dataIndex:"triggers",key:"triggers",render:e=>null===e||void 0===e?void 0:e.join(", ")},{title:"Actions",key:"actions",render:(e,a)=>(0,Z.jsxs)(u.Z,{children:[(0,Z.jsx)(S,{imageCard:a,addEntryToUpdate:t}),(0,Z.jsx)(g.ZP,{icon:(0,Z.jsx)(E.Z,{}),onClick:()=>n("cardId",a.id),children:"Edit"})]})}],o=Object.values(a),s=(0,N.P)({total:o.length,showQuickJumper:!0});return(0,Z.jsx)(P.Z,{dataSource:o,columns:r,rowKey:"id",pagination:s})}var U=t(359);function T(e){var a;const t=(0,U.p)(),r=(0,s.N)("images-credo"),{addParam:d,removeParam:c}=(0,i.K)();return(0,Z.jsxs)(o.T,{isLoading:t.isLoading||r.isLoading,hasResponseData:t.hasResponseData||r.hasResponseData,error:null!==(a=r.error)&&void 0!==a?a:t.error,children:[(0,Z.jsx)(D,(0,n.Z)({},e)),(0,Z.jsx)(w,(0,n.Z)((0,n.Z)({},e),{},{onNewCard:()=>d("cardId",t.onRandomCard()),onClose:()=>c("cardId")}))]})}var R=t(7128),z=t(7018),I=t(7340),L=t(7965),q=t(763);function K(e){let{data:a,save:t,isDirty:n,isSaving:r,entriesToUpdate:o}=e;const{addParam:s}=(0,i.K)(),{onRandomCard:d}=(0,U.p)();return(0,Z.jsxs)(L.Pd,{children:[(0,Z.jsxs)(u.Z,{vertical:!0,gap:12,children:[(0,Z.jsx)(I.k,{isDirty:n,onSave:t,isSaving:r,dirt:JSON.stringify(o)}),(0,Z.jsx)(z.o,{data:()=>function(e){console.log("Preparing file for download...");const a=(0,q.cloneDeep)(e);return(0,y.Tj)(a)}(a),fileName:"image-cards.json",disabled:n,block:!0})]}),(0,Z.jsx)(R.Z,{}),(0,Z.jsx)(g.ZP,{onClick:()=>s("cardId",d()),block:!0,children:"Random Card"}),(0,Z.jsx)(R.Z,{})]})}var O=t(4562),J=t(8938);function Q(){const e=(0,J.i)({tdrResourceName:"image-cards",firebaseDataCollectionName:"imageCards",serialize:!0});return(0,Z.jsx)(L.Xg,{title:"Image Cards",subtitle:"Descriptors",children:(0,Z.jsxs)(r.Z,{hasSider:!0,children:[(0,Z.jsx)(O.p,{children:(0,Z.jsx)(K,(0,n.Z)({},e))}),(0,Z.jsx)(r.Z.Content,{className:"content",children:(0,Z.jsx)(o.T,{isLoading:e.isLoading,error:e.error,hasResponseData:!(0,q.isEmpty)(e.data),children:(0,Z.jsx)(T,(0,n.Z)({},e))})})]})})}const Y=Q}}]);
//# sourceMappingURL=ImageCardsDescriptor.3ae95ec2.chunk.js.map