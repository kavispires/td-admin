"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[997],{2043:(e,t,s)=>{s.d(t,{Do:()=>v,H:()=>x,tj:()=>g,xh:()=>h,zE:()=>u});var a=s(3070),n=s(906),l=s(9793),i=s(5922),r=s(9862),o=s(4248),c=s(1431),d=s(184);function u(e){let{label:t,value:s,onChange:l,options:i,placeholder:r}=e;return(0,d.jsx)(a.Z.Item,{label:t,children:(0,d.jsxs)(n.Z,{style:{minWidth:"150px"},onChange:l,value:s,children:[r&&(0,d.jsx)(n.Z.Option,{value:"",disabled:!0,children:"placeholder"}),i.map((e=>"object"===typeof e?(0,d.jsx)(n.Z.Option,{value:e.value,children:e.label},"".concat(t,"-").concat(e.value)):(0,d.jsx)(n.Z.Option,{value:e,children:e},"".concat(t,"-").concat(e))))]})})}function h(e){let{label:t,value:s,onChange:n,min:i=0,max:r=100,step:o}=e;return(0,d.jsx)(a.Z.Item,{label:t,children:(0,d.jsx)(l.Z,{min:i,max:r,value:s,onChange:e=>n(null!==e&&void 0!==e?e:r),style:{minWidth:"150px",width:"100%"},step:o})})}function v(e){let{label:t,value:s,onChange:n,className:l,disabled:r}=e;return(0,d.jsx)(a.Z.Item,{label:t,valuePropName:"checked",className:l,children:(0,d.jsx)(i.Z,{checked:s,onChange:n,size:"small",disabled:r})})}function g(e){let{label:t,value:s,onChange:n,disabled:l,className:i}=e;return(0,d.jsx)(a.Z.Item,{label:t,valuePropName:"checked",className:i,children:(0,d.jsx)(r.Z,{checked:s,onChange:e=>n(e.target.checked),disabled:l})})}function x(e){let{value:t,label:s,onChange:n,options:l}=e;return(0,d.jsx)(a.Z.Item,{label:s,layout:l.length>2?"vertical":"horizontal",children:(0,d.jsx)(o.Z,{block:!0,value:t,onChange:n,options:l.map((e=>({label:(0,d.jsx)(c.Z,{arrow:!0,trigger:"hover",title:e.title,children:e.icon}),value:e.value})))})})}},2056:(e,t,s)=>{s.d(t,{m:()=>r});var a=s(1413),n=s(952),l=s(7134),i=s(184);function r(e){const t=(0,l._)();return(0,i.jsx)(n.Z,(0,a.Z)({onClick:()=>{var s,a;return t(null!==(s=null===(a=e.children)||void 0===a?void 0:a.toString())&&void 0!==s?s:"")}},e))}},7340:(e,t,s)=>{s.d(t,{k:()=>g});var a=s(1413),n=s(4925),l=s(9475),i=s(2426),r=s.n(i),o=s(2791),c=s(8211),d=s(4483),u=s(4841),h=s(184);const v=["isDirty","onSave","isSaving","dirt","interval"];function g(e){let{isDirty:t,onSave:s,isSaving:i,dirt:g,interval:x=6e5}=e,m=(0,n.Z)(e,v);const{togglePendingSave:j}=(0,u.b)(),[,p,f]=(0,c.Z)((()=>{t&&s()}),x);return(0,o.useEffect)((()=>{t?(j(!0),console.log("Save Reset",r()(Date.now()).format("MM/DD/YYYY HH:mm:ss")),f()):(j(!1),p())}),[t,f,p,g]),(0,o.useEffect)((()=>{const e=e=>{if(t){const t="You have unsaved changes, are you sure you want to leave?";return e.returnValue=t,t}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[t]),(0,h.jsx)(l.ZP,(0,a.Z)((0,a.Z)({type:"primary",size:"large",icon:(0,h.jsx)(d.Z,{}),onClick:s,disabled:!t,loading:i,danger:!0,block:!0},m),{},{children:"Save"}))}},8866:(e,t,s)=>{s.d(t,{N:()=>o});var a=s(1413),n=s(4925),l=s(6178),i=s(184);const r=["children","level"];function o(e){let{children:t,level:s}=e,o=(0,n.Z)(e,r);return(0,i.jsx)(l.Z.Title,(0,a.Z)((0,a.Z)({level:null!==s&&void 0!==s?s:3},o),{},{children:t}))}},8357:(e,t,s)=>{s.d(t,{tj:()=>c.tj,xh:()=>c.xh,H:()=>c.H,zE:()=>c.zE,Do:()=>c.Do,Th:()=>g,F6:()=>o});s(8866);var a=s(1413),n=s(4925),l=s(3733),i=s(184);const r=["children","active","activeClass","className","hoverType"],o=e=>{let{children:t,active:s=!1,activeClass:o="",className:c="",hoverType:d="scale"}=e,u=(0,n.Z)(e,r);return(0,i.jsx)("button",(0,a.Z)((0,a.Z)({className:(0,l.Z)("transparent-button","transparent-button--".concat(d),s&&(o||"transparent-button--active"),c)},u),{},{children:t}))};var c=s(2043),d=s(952),u=s(3070),h=s(7965);function v(e){let{isLoading:t,isIdle:s,error:a,isDirty:n,isError:l,hasResponseData:r}=e;return s?(0,i.jsx)(d.Z,{children:"No Data yet"}):t?(0,i.jsx)(d.Z,{color:"blue",children:"Loading..."}):a||l?(0,i.jsx)(d.Z,{color:"red",children:"Error"}):n?(0,i.jsx)(d.Z,{color:"orange",children:"Modified"}):r?(0,i.jsx)(d.Z,{color:"green",children:"Loaded"}):(0,i.jsx)(d.Z,{children:"No Data"})}function g(e){return(0,i.jsx)(h.Pd,{children:(0,i.jsx)(u.Z.Item,{label:"Status",children:(0,i.jsx)(v,(0,a.Z)({},e))})})}},145:(e,t,s)=>{s.d(t,{f:()=>r});var a=s(2402),n=s(3733),l=s(2606),i=s(184);const r=e=>{let{id:t,width:s=200,className:r="",preview:o=!0,fileExtension:c="jpg"}=e;const{getUrl:d}=(0,l.n)("images"),u=t.replace(/-/g,"/");return(0,i.jsx)("div",{className:(0,n.Z)("image-card",r),children:(0,i.jsx)(a.Z,{width:s,src:d("".concat(u,".").concat(c)),fallback:d("back/default.jpg"),preview:o})})}},7166:(e,t,s)=>{s.d(t,{P:()=>r,l:()=>o});var a=s(2791),n=s(2671),l=s(184);const i=(0,a.createContext)({}),r=e=>{let{children:t}=e;const s=(0,n.AZ)(),[r,o]=(0,a.useState)(15),[c,d]=(0,a.useState)(5),[u,h]=(0,a.useState)(150),[v,g]=(0,a.useState)(!1),x=(0,n.IN)(s.data,s.setDirty,r,c);return(0,l.jsx)(i.Provider,{value:{sampleSize:r,setSampleSize:o,tagThreshold:c,setTagThreshold:d,cardSize:u,setCardSize:h,showIds:v,setShowIds:g,randomGroups:x,query:s},children:t})},o=()=>(0,a.useContext)(i)},4249:(e,t,s)=>{s.d(t,{c:()=>i});var a=s(1492),n=s(952),l=s(184);function i(e){let{card:t}=e;const s=t.length>10?"red":t.length>5?"blue":t.length>0?"green":void 0;return(0,l.jsx)("div",{children:(0,l.jsxs)(n.Z,{color:s,icon:(0,l.jsx)(a.Z,{}),children:[" ",t.length]})})}},9936:(e,t,s)=>{s.d(t,{A:()=>o});var a=s(8622),n=s(3070),l=s(9367),i=s(7166),r=s(184);function o(){const{query:{stats:e}}=(0,i.l)();return(0,r.jsx)(n.Z.Item,{label:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.C,{icon:(0,r.jsx)(a.Z,{}),shape:"square",size:"small",style:{marginRight:6}}),"Stats"]}),children:(0,r.jsxs)("ul",{className:"statistic__list",children:[(0,r.jsxs)("li",{children:["Completion: ",Math.floor(100*e.total/2520),"%"]}),(0,r.jsxs)("li",{children:["Total Relationships: ",e.total]}),(0,r.jsxs)("li",{children:["Complete: ",e.complete]}),(0,r.jsxs)("li",{children:["Overdone: ",e.overdone]}),(0,r.jsxs)("li",{children:["Single Match: ",e.single]})]})})}},2671:(e,t,s)=>{s.d(t,{AZ:()=>m,gU:()=>x,IN:()=>j});var a=s(4747),n=s(9631),l=s(763),i=s(2791),r=s(2592),o=s(5850),c=s(3713),d=s(2010),u=s(8556),h=s(4766);const v=()=>(0,l.padStart)(String((0,l.random)(1,252)),2,"0"),g=()=>(0,l.random)(1,12);function x(e,t){var s,a,n;const[l,r]=(0,i.useState)(g()),[c,d]=(0,i.useState)(v()),[u,x]=(0,i.useState)(g()),[m,j]=(0,i.useState)(v()),p="td-d".concat(l,"-").concat(c),f="td-d".concat(u,"-").concat(m),[Z,S]=(0,i.useState)(0),{queryParams:y}=(0,h.K)(),b=Number(null!==(s=y.get("cycle"))&&void 0!==s?s:3),C=null!==(a=null===e||void 0===e?void 0:e[p])&&void 0!==a?a:[],N=null!==(n=null===e||void 0===e?void 0:e[f])&&void 0!==n?n:[],D=()=>{S(0),r(g()),d(v()),x(g()),j(v())};return(0,i.useEffect)((()=>{p===f&&j(v())}),[p,f]),{cardAId:p,cardA:C,cardBId:f,cardB:N,relate:()=>{S(0),C.push(f),e[p]=(0,o.R1)(C),N.push(p),e[f]=(0,o.R1)(N),t(!0),r(u),d(m),x(g()),j(v())},unrelate:()=>{Z>=b?(S(0),D()):(S((e=>e+1)),x(g()),j(v()))},areRelated:C.includes(f),onRandomCards:D}}function m(){const[e,t]=(0,i.useState)(!1),s=["data/imageCardsRelationships"],l=(0,c.NL)(),{notification:o}=a.Z.useApp(),[h,v]=(0,i.useState)({total:0,overdone:0,complete:0,single:0}),{data:g={},isLoading:x,isSuccess:m,isError:j,error:p,isFetched:f,isRefetching:Z,refetch:S}=(0,d.a)({queryKey:s,queryFn:async()=>{var e;const t=(0,n.JU)(r.RZ,"data/imageCardsRelationships");return null!==(e=(await(0,n.QT)(t)).data())&&void 0!==e?e:{}}}),{isPending:y,isError:b,isSuccess:C,mutate:N}=(0,u.D)({mutationKey:s,mutationFn:async()=>{const e=(0,n.JU)(r.RZ,"data/imageCardsRelationships");return await(0,n.pl)(e,g),g},onSuccess:()=>{o.success({message:"Saved",placement:"bottomLeft"}),l.refetchQueries({queryKey:s}),t(!1)}});return(0,i.useEffect)((()=>{if(!Z&&f){const e=Object.keys(g).length;let t=0,s=0,a=0;Object.values(g).forEach((e=>{e.length>8&&(t+=1),1===e.length&&(a+=1),e.length>2&&(s+=1)})),v({total:e,overdone:t,complete:s,single:a})}}),[f,Z]),{data:g,isLoading:x,isSuccess:m,isError:j,error:p,hasData:m&&Object.keys(g).length>0,refetch:S,isSaving:y,isMutationError:b,isSaved:C,save:N,setDirty:t,isDirty:e,stats:h}}function j(e,t,s,a){const[n,l]=(0,i.useState)([]),[r,c]=(0,i.useState)([]),[d,u]=(0,i.useState)([]),[h,x]=(0,i.useState)(0),[m,j]=(0,i.useState)(!0),[p,f]=(0,i.useState)([]),Z=t=>{c((null!==t&&void 0!==t?t:n).map((t=>{var s;return null!==(s=null===e||void 0===e?void 0:e[t])&&void 0!==s?s:[]})))},S=()=>{const t=[...p];let n=0;const i=d.length<2e3?d:[];let r=0;for(;r<400&&t.length<s;){var o;const s="td-d".concat(g(),"-").concat(v()),l=null!==(o=e[s])&&void 0!==o?o:[],c=!(a>0)||l.length<a,d=!!m&&i.includes(s);t.includes(s)||d||!c||(t.push(s),n+=1),r+=1}l(t),u((e=>[...e,...t])),Z(t),x((e=>e+n))};(0,i.useEffect)((()=>{0===n.length&&S()}),[n]);return{cardIds:n,cards:r,selection:p,onSelect:e=>{f((t=>{const s=[...t],a=s.indexOf(e);return a>-1?s.splice(a,1):s.push(e),s}))},relate:()=>{p.forEach((t=>{var s;const a=null!==(s=e[t])&&void 0!==s?s:[];a.push(...p.filter((e=>e!==t))),e[t]=(0,o.R1)(a)})),t(!0),f([]),Z(),u([]),x(0)},nextSet:S,deselectAll:()=>{f([])},cycles:h,filters:{useCycles:m,toggleUseCycles:()=>{j((e=>!e))}}}}},7134:(e,t,s)=>{s.d(t,{_:()=>r});var a=s(4747),n=s(763),l=s(2791),i=s(3250);function r(){const[e,t]=(0,i.Z)(),{message:s}=a.Z.useApp();return(0,l.useEffect)((()=>{e.value&&(e.value.length>20?s.info("Copied to clipboard: ".concat((0,n.truncate)(e.value,{length:30,omission:"..."}))):s.success("Copied"))}),[e,s]),t}},7131:(e,t,s)=>{s.r(t),s.d(t,{default:()=>L});var a=s(1790),n=s(7166),l=s(4925),i=s(7691),r=s(7106),o=s(398),c=s(4988),d=s(7360),u=s(4057),h=s(6473),v=s(1431),g=s(2402),x=s(3088),m=s(8357),j=s(2056),p=s(2128),f=s(763),Z=s(2791),S=s(7415),y=s(145),b=s(4249),C=s(184);const N=["isDirty","isSaving","save","stats"];function D(){const e=(0,n.l)(),{query:{isDirty:t,isSaving:s,save:a,stats:r},randomGroups:{cardIds:o,cards:c,onSelect:d,selection:u,relate:x,nextSet:D,deselectAll:w,cycles:k},showIds:z,cardSize:I}=e,R=(0,l.Z)(e.query,N),T=(0,Z.useRef)(null),[P,{width:L}]=(0,S.Z)(),[A,_]=(0,Z.useMemo)((()=>{const e=Math.floor(L/I)+1;return[e,Math.floor(L/e)]}),[I,L]);return(0,C.jsx)(p.T,{isLoading:R.isLoading,error:R.error,hasResponseData:!(0,f.isEmpty)(R.data),children:(0,C.jsx)("div",{ref:P,className:"my-6",children:(0,C.jsxs)(h.Z,{title:"Card Relationship Matching",extra:(0,C.jsxs)(v.Z,{title:"Total cycles",children:[(0,C.jsx)(i.Z,{})," ",k]}),className:"image-card-categorizer-card",ref:T,children:[(0,C.jsx)(g.Z.PreviewGroup,{children:(0,C.jsx)("div",{className:"image-cards-group",style:{gridTemplateColumns:"repeat(".concat(Math.max(A,1),", 1fr)")},children:o.map(((e,t)=>{const s=u.includes(e),a=c[t];return(0,C.jsx)("div",{className:"image-card-card__image",children:(0,C.jsxs)(m.F6,{onClick:()=>d(e),active:s,className:"image-cards-group__button",activeClass:"image-cards-group__button--active",children:[(0,C.jsx)(y.f,{id:e,width:_-24,preview:!1}),(0,C.jsxs)("div",{children:[z&&(0,C.jsx)(j.m,{children:e}),(0,C.jsx)(b.c,{card:a})]})]})},e)}))})}),(0,C.jsx)(E,{isSaving:s,isDirty:t,selection:u,relate:x,deselectAll:w,onNextSet:()=>{var e;D(),null===(e=T.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}})]})})})}const E=e=>{let{isSaving:t,isDirty:s,selection:a,relate:n,deselectAll:l,onNextSet:i}=e;if(t)return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(x.Z,{icon:(0,C.jsx)(r.Z,{})})});return(0,C.jsxs)(C.Fragment,{children:[s&&(0,C.jsx)(x.Z,{icon:(0,C.jsx)(o.Z,{}),type:"primary",style:{right:234}}),(0,C.jsx)(x.Z,{icon:(0,C.jsx)(c.Z,{}),style:{right:164},onClick:l}),(0,C.jsx)(x.Z,{icon:(0,C.jsx)(d.Z,{}),style:{right:94},type:a.length<2?"default":"primary",badge:{count:a.length,size:"small"},onClick:()=>{a.length<2||n()}}),(0,C.jsx)(x.Z,{icon:(0,C.jsx)(u.Z,{}),style:{right:24},onClick:i})]})};var w=s(4520),k=s(7018),z=s(7340),I=s(7965),R=s(6591),T=s(9936);function P(){const{query:{isDirty:e,isSaving:t,save:s,data:a,isLoading:l,isError:i},randomGroups:{filters:r},showIds:o,setShowIds:c,tagThreshold:d,setTagThreshold:u,sampleSize:h,setSampleSize:v,cardSize:g,setCardSize:x}=(0,n.l)();return(0,C.jsxs)(I.p3,{children:[(0,C.jsx)(I.Pd,{children:(0,C.jsxs)(w.Z,{vertical:!0,gap:6,children:[(0,C.jsx)(z.k,{isDirty:e,dirt:JSON.stringify(a),onSave:()=>s({}),isSaving:t}),(0,C.jsx)(k.o,{data:a,fileName:"imageCardsRelationships.json",loading:t,disabled:(0,f.isEmpty)(a),block:!0})]})}),(0,C.jsx)(m.Th,{isLoading:l||t,isDirty:e,isError:i,hasResponseData:!(0,f.isEmpty)(a)}),(0,C.jsxs)(I.Pd,{children:[(0,C.jsx)(m.Do,{label:"Use Cycles",value:r.useCycles,onChange:()=>r.toggleUseCycles()}),(0,C.jsx)(m.Do,{label:"Show Ids",value:o,onChange:e=>c(e)}),(0,C.jsx)(m.zE,{onChange:e=>u(e),value:d,options:R.VC,label:"Tag Count"}),(0,C.jsx)(m.zE,{onChange:e=>v(e),value:h,options:R.ZI,label:"Sample Size"}),(0,C.jsx)(m.zE,{onChange:e=>x(e),value:g,options:R.Hn,label:"Card Size"})]}),(0,C.jsx)(I.Pd,{children:(0,C.jsx)(T.A,{})})]})}const L=function(){return(0,C.jsx)(I.Xg,{title:"Image Cards",subtitle:"Relationships",children:(0,C.jsx)(n.P,{children:(0,C.jsxs)(a.Z,{hasSider:!0,children:[(0,C.jsx)(P,{}),(0,C.jsx)(a.Z.Content,{className:"content",children:(0,C.jsx)(D,{})})]})})})}}}]);
//# sourceMappingURL=ImageCardsRelationships.ae1d0b6e.chunk.js.map