"use strict";(self.webpackChunktdr=self.webpackChunktdr||[]).push([[724],{8178:(e,n,t)=>{t.d(n,{i:()=>d});var i=t(5),a=t(1105),s=t(5529),l=t(763),r=t(2791),o=t(184);function d(e){let{items:n,isPending:t,style:d,size:c,placeholder:u,allowClear:m,onFinish:g,...h}=e;const v=(0,s.N)("items",!Boolean(n)&&!t),{namesDict:p,options:j}=(0,r.useMemo)((()=>{var e;console.log("Recomputing item names typeahead...");const t=Object.values(null!==(e=null!==n&&void 0!==n?n:v.data)&&void 0!==e?e:{}).reduce(((e,n)=>{const t="".concat(n.name.en," (").concat(n.id,")"),i="".concat(n.name.pt," (").concat(n.id,")");return e[t]=n.id,e[i]=n.id,e}),{});return{namesDict:t,options:(0,l.orderBy)(Object.keys(t),[e=>e.toLowerCase()]).map((e=>({value:e})))}}),[n,t]),[x,f]=(0,r.useState)([]);return(0,o.jsx)(i.Z,{options:j,style:{width:250,...d},allowClear:null===m||void 0===m||m,placeholder:null!==u&&void 0!==u?u:"Search by name or id...",filterOption:(e,n)=>{var t;return-1!==String(null!==(t=null===n||void 0===n?void 0:n.value)&&void 0!==t?t:"").toUpperCase().indexOf(null===e||void 0===e?void 0:e.toUpperCase())},onSearch:e=>{const n=e.trim(),t=j.filter((e=>{var t;return String(null!==(t=null===e||void 0===e?void 0:e.value)&&void 0!==t?t:"").toUpperCase().includes(n)})),i=(0,l.orderBy)(t,[e=>{var t;const i=String(null!==(t=null===e||void 0===e?void 0:e.value)&&void 0!==t?t:"");if(i.includes("".concat(n," ")))return-1;const a=i.toUpperCase().indexOf(n);return 0===a?-1:-1===a?i.length:a}]);f(i)},notFoundContent:"No items found",onSelect:e=>{void 0!==p[e]&&g(p[e])},...h,children:(0,o.jsx)(a.Z,{onPressEnter:()=>{if(x.length>0){const e=x[0].value;void 0!==p[e]&&g(p[e])}}})})}},64:(e,n,t)=>{t.r(n),t.d(n,{default:()=>$});var i=t(3990),a=t(1046),s=t(2128),l=t(4031),r=t(6106),o=t(914),d=t(1674),c=t(1105),u=t(7765),m=t(5225),g=t(5922),h=t(4520),v=t(1310),p=t(6020),j=t(4766),x=t(8938),f=t(763),y=t(2791),w=t(184);const b=(0,y.createContext)({items:{},isLoading:!0,error:null,hasResponseData:!1,categoriesDict:{},categories:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1"}),S=e=>{var n;let{children:t}=e;const{queryParams:i}=(0,j.K)(),{data:a,isLoading:s,error:l,isSaving:r,save:o,addEntryToUpdate:d,entriesToUpdate:c,isDirty:u}=(0,x.i)({tdrResourceName:"items",firebaseDataCollectionName:"items"}),{categoriesDict:m,categories:g}=(0,y.useMemo)((()=>{console.log("Recomputing item categories typeahead...");const e={},n={},t={},i=[];Object.values(a).forEach((a=>{var s;const l="".concat(a.name.en," (").concat(a.id,")"),r="".concat(a.name.pt," (").concat(a.id,")");n[a.name.en]?i.push(["".concat(a.name.en," (").concat(n[a.name.en],")"),l]):n[a.name.en]=a.id,t[a.name.pt]?i.push(["".concat(a.name.pt," (").concat(t[a.name.pt],")"),r]):t[a.name.pt]=a.id,null===a||void 0===a||null===(s=a.categories)||void 0===s||s.forEach((n=>{e[n]=n}))}));const s=(0,f.orderBy)(Object.keys(e)).map((e=>({value:e})));return i.length>0&&console.warn("Possible duplicated items",i),{categoriesDict:e,categories:s}}),[a,r,s]),h=null!==(n=i.get("category"))&&void 0!==n?n:"all",v=(0,y.useMemo)((()=>{const e=(0,f.orderBy)(Object.values(a),[e=>Number(e.id)],"asc");switch(h){case"all":return e;case"!all":return e.filter((e=>{var n,t;return null===(n=!(null!==e&&void 0!==e&&null!==(t=e.categories)&&void 0!==t&&t.length))||void 0===n||n}));case"nsfw":return e.filter((e=>e.nsfw));case"!nsfw":return e.filter((e=>!e.nsfw));default:return h.startsWith("!")?e.filter((e=>{var n;return!(null!==e&&void 0!==e&&null!==(n=e.categories)&&void 0!==n&&n.includes(h.slice(1)))})):e.filter((e=>{var n;return null===e||void 0===e||null===(n=e.categories)||void 0===n?void 0:n.includes(h)}))}}),[a,h]),p=(0,y.useMemo)((()=>{var e;const n=(0,f.orderBy)(Object.keys(c),[e=>Number(e)],"asc"),t=null===(e=v[v.length-1])||void 0===e?void 0:e.id,i=(0,f.orderBy)([...n,t],[e=>Number(e)],"desc")[0];return String(Number(i)+1)}),[v,c]);return(0,w.jsx)(b.Provider,{value:{items:a,listing:v,isLoading:s,error:l,categoriesDict:m,categories:g,hasResponseData:v.length>0,isDirty:u,addItemToUpdate:d,isSaving:r,save:o,itemsToUpdate:c,newId:p},children:t})},C=()=>(0,y.useContext)(b);var Z=t(7134);var N=t(3834),k=t(4483),D=t(7747),O=t(8955);function T(e){let{item:n,editMode:t=!1,simplified:i}=e;const{categories:s}=C(),{isEditing:r,toggleEditMode:o,onEdit:h,isDirty:x,onModify:b,onReset:S,editableItem:T}=function(e){var n;let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{addItemToUpdate:i,itemsToUpdate:a}=C(),[s,l]=(0,y.useState)(t),[r,o]=(0,y.useState)((0,f.cloneDeep)(e)),d=null!==(n=a[e.id])&&void 0!==n?n:e,c=e=>{const n={...(0,f.cloneDeep)(r),...e};Object.keys(e).includes("nsfw")&&!1===e.nsfw&&delete n.nsfw,o(n)},u=async()=>{i(r.id,r)},m=()=>{o((0,f.cloneDeep)(e)),l(!1)},g=JSON.stringify(d)!==JSON.stringify(r);return{isEditing:s,toggleEditMode:()=>l((e=>!e)),editableItem:r,onEdit:c,isDirty:g,onModify:u,onReset:m}}(n,t),z=(0,Z._)(),{is:R}=(0,j.K)();return(0,w.jsxs)(d.Z,{title:(0,w.jsx)(l.Z.Text,{onClick:()=>z(n.id),children:n.id}),style:{maxWidth:250},size:i?"small":"default",actions:i?void 0:x?[(0,w.jsx)(N.Z,{onClick:S},"reset"),(0,w.jsx)(k.Z,{onClick:b},"save")]:[(0,w.jsx)(D.Z,{onClick:o},"edit")],children:[(0,w.jsx)(p.ck,{id:n.id,width:i?75:125,title:"".concat(n.name.en," | ").concat(n.name.pt)}),(0,w.jsxs)(a.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,w.jsx)(c.Z,{prefix:(0,w.jsx)(v.H,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:r?"outlined":"borderless",size:"small",defaultValue:n.name.en,readOnly:!r,onChange:e=>h({name:{...T.name,en:e.target.value}})},"en-".concat(n.name.en)),(0,w.jsx)(c.Z,{prefix:(0,w.jsx)(v.H,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:r?"outlined":"borderless",size:"small",defaultValue:n.name.pt,readOnly:!r,onChange:e=>h({name:{...T.name,pt:e.target.value}})},"pt-".concat(n.name.pt)),!i&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{children:(0,w.jsx)(u.Z,{mode:"multiple",style:{width:"100%"},placeholder:"Select a category",defaultValue:n.categories,disabled:!r,options:s,variant:r?"outlined":"borderless",size:"small",onChange:e=>h({categories:e.sort()})},String(n.categories))}),R("showVerifyThing")&&(0,w.jsx)("div",{children:(0,w.jsx)(P,{item:n})}),(r||n.nsfw)&&(0,w.jsx)("div",{children:(0,w.jsx)(m.Z.Item,{label:"nsfw",valuePropName:"checked",children:(0,w.jsx)(g.Z,{checked:n.nsfw,onChange:e=>h({nsfw:e}),size:"small",checkedChildren:(0,w.jsx)(O.Z,{style:{color:"hotpink"}}),disabled:!r})})})]})]})]})}const z=(0,f.memoize)((e=>{var n,t;const i=!(null===(n=e.categories)||void 0===n||!n.includes("thing")),a=!(null===(t=e.categories)||void 0===t||!t.includes("mesmice")),s=1===e.name.en.split(" ").length,l=1===e.name.pt.split(" ").length,r={en:i||s&&a,pt:i||l&&a};return r.pt||r.en?(0,w.jsxs)(w.Fragment,{children:[r.en&&(0,w.jsx)(v.H,{language:"en",width:"1em"}),r.pt&&(0,w.jsx)(v.H,{language:"pt",width:"1em"})]}):""})),P=e=>{let{item:n}=e;const t=z(n);return t?(0,w.jsxs)(h.Z,{gap:6,children:["Thing: ",t]}):(0,w.jsx)(w.Fragment,{})};var R=t(4290),I=t(2228);function M(){var e;const{queryParams:n}=(0,j.K)(),t=null!==(e=n.get("type"))&&void 0!==e?e:"all",{listing:i}=C(),{page:a,pagination:s}=(0,R.e)({data:i,resetter:t});return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(l.Z.Title,{level:2,children:["Listing - ",(0,f.capitalize)(t)," items (",i.length,")"]}),(0,w.jsx)(I.N,{pagination:s,children:(0,w.jsx)(r.Z,{gutter:[16,16],className:"my-4",children:a.map((e=>(0,w.jsx)(o.Z,{xs:24,sm:24,md:12,lg:6,xl:4,children:(0,w.jsx)(T,{item:e})},e.id)))})})]})}var U=t(7128),E=t(6173),F=t(7018),B=t(1958),L=t(959),V=t(2556);const K={id:"",name:{en:"",pt:""},groups:[]};function H(e){let{isModalOpen:n,handleOk:t,handleCancel:i,newId:a}=e;const[s]=(0,y.useState)((0,f.cloneDeep)({...K,id:a}));return(0,w.jsx)(L.Z,{title:"Add new item",open:n,onOk:t,onCancel:i,children:(0,w.jsx)(T,{item:s,editMode:!0})})}function W(){const[e,n]=(0,y.useState)(!1),{newId:t}=C();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(V.ZP,{block:!0,onClick:()=>{n(!0)},children:"Add New Item"}),e&&(0,w.jsx)(H,{isModalOpen:e,handleOk:()=>{n(!1)},handleCancel:()=>{n(!1)},newId:t},t)]})}var q=t(5850),A=t(7340);function J(){var e;const{isDirty:n,save:t,items:i,categories:a,itemsToUpdate:s,isSaving:l}=C(),{queryParams:r,is:o,addParam:d}=(0,j.K)(),c=(0,y.useMemo)((()=>{const e=(0,f.orderBy)(a.map((e=>{let{value:n}=e;return{label:(0,f.capitalize)(n),value:n}})),"label"),n=e.map((e=>{let{label:n,value:t}=e;return{label:"NOT ".concat(n),value:"!".concat(t)}}));return[...e,...n]}),[a]);return(0,w.jsxs)(B.Pd,{children:[(0,w.jsxs)(h.Z,{vertical:!0,gap:6,children:[(0,w.jsx)(A.k,{isDirty:n,dirt:JSON.stringify(s),onSave:t,isSaving:l}),(0,w.jsx)(F.o,{data:()=>function(e){return(0,q.Tj)(Object.values(e).reduce(((e,n)=>{var t;return n.categories=(null!==(t=null===n||void 0===n?void 0:n.categories)&&void 0!==t?t:[]).sort(),0===n.categories.length?(delete n.categories,e[n.id]=n,e):(n.categories.includes("thing")&&1===n.name.en.split(" ").length&&1===n.name.pt.split(" ").length&&((n.categories.includes("evidence")||n.categories.includes("dream")||n.categories.includes("alien")||n.categories.includes("mesmice"))&&(n.categories=n.categories.filter((e=>"thing"!==e))),e[n.id]=n),e[n.id]=n,e)}),{}))}(i),fileName:"items.json",disabled:n,block:!0})]}),(0,w.jsx)(U.Z,{}),(0,w.jsx)(E.Do,{label:"Show Search",value:!o("hideSearch"),onChange:e=>d("hideSearch",e?"":"true","")}),(0,w.jsx)(E.Do,{label:"Show Randomizer",value:o("showRandomizer"),onChange:e=>d("showRandomizer",e?"true":"","")}),(0,w.jsx)(E.Do,{label:"Verify Thing",value:o("showVerifyThing"),onChange:e=>d("showVerifyThing",e?"true":""),className:"full-width m-0"}),(0,w.jsx)(E.zE,{label:"Category",value:null!==(e=r.get("category"))&&void 0!==e?e:"all",onChange:e=>d("category",e,"all"),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...c,{label:"No categories",value:"!all"}]}),(0,w.jsx)(U.Z,{}),(0,w.jsx)(W,{})]})}function G(){const{listing:e}=C(),[n,t]=(0,y.useState)([]);return(0,w.jsxs)("div",{children:[(0,w.jsx)(l.Z.Title,{level:2,children:"Randomized Sample"}),(0,w.jsx)("div",{children:(0,w.jsx)(V.ZP,{onClick:()=>{t((0,f.sampleSize)(e,5))},children:"Get Sample"})}),(0,w.jsx)(a.Z,{wrap:!0,className:"my-4",children:n.map((e=>(0,w.jsx)(T,{item:e,simplified:!0},e.id)))}),(0,w.jsx)(U.Z,{})]})}var X=t(8178);function _(){const{items:e,isLoading:n,isSaving:t}=C(),[i,s]=(0,y.useState)(null);return(0,w.jsxs)(y.Fragment,{children:[(0,w.jsx)(l.Z.Title,{level:2,children:"Search for an item"}),(0,w.jsx)("div",{children:(0,w.jsx)(X.i,{items:e,isPending:n||t,onFinish:n=>s(e[n])})}),Boolean(i)&&(0,w.jsx)(a.Z,{direction:"vertical",className:"my-4",children:(0,w.jsx)(T,{item:i})},null===i||void 0===i?void 0:i.id),(0,w.jsx)(U.Z,{})]},"item-search-".concat(n))}var Q=t(4562);function Y(){const{isLoading:e,error:n,hasResponseData:t}=C(),{is:l}=(0,j.K)();return(0,w.jsx)(B.Xg,{title:"Items",subtitle:"Listing",children:(0,w.jsxs)(i.Z,{hasSider:!0,children:[(0,w.jsx)(Q.p,{children:(0,w.jsx)(J,{})}),(0,w.jsx)(i.Z.Content,{className:"content",children:(0,w.jsxs)(s.T,{isLoading:e,error:n,hasResponseData:t,children:[!e&&(0,w.jsxs)(a.Z,{size:"large",children:[!l("hideSearch")&&(0,w.jsx)(_,{}),l("showRandomizer")&&(0,w.jsx)(G,{})]}),(0,w.jsx)(M,{})]})})]})})}const $=function(){return(0,w.jsx)(S,{children:(0,w.jsx)(Y,{})})}}}]);
//# sourceMappingURL=Items.086fd2fa.chunk.js.map