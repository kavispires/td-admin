"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[633],{633:(e,t,s)=>{s.d(t,{Ld:()=>q,l9:()=>L,ve:()=>A});var a=s(4747),o=s(2481),n=s(2748),r=s(8556);const i={SUFFIX_DATA:{pt:"drawingsPT",en:"drawingsEN"},DAILY:{pt:"diario",en:"daily"}};var l=s(8027),u=s(2791),d=s(2010);function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{notification:s}=a.Z.useApp(),o=(0,d.a)({queryKey:[e,"history"],queryFn:(0,l.A)(e,"history"),...t});return(0,u.useEffect)((()=>{o.isSuccess&&(0,n.tS)("Loaded daily/history")}),[o.isSuccess]),(0,u.useEffect)((()=>{o.isError&&s.error({message:"Error loading daily/history",placement:"bottomLeft"})}),[o.isError]),o}var f=s(7342);var m=s(763),p=s(2606);function g(e,t){var s;let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3?arguments[3]:void 0;const{getUrl:n}=(0,p.n)("resources"),r=o?"words-".concat(e,"-letters-selected-").concat(t):"words-".concat(e,"-letters-").concat(t),i=(0,d.a)({queryKey:[r],queryFn:async()=>{const e=await fetch(n("".concat(r,".json")));return await e.json()},enabled:a&&!!e&&!!t}),l=!(0,m.isEmpty)(i.data);return{...i,data:null!==(s=i.data)&&void 0!==s?s:[],hasResponseData:l}}var v=s(5529),h=s(6728);function y(e,t){const s=(0,u.useMemo)((()=>{var s;return null!==(s=null===t||void 0===t?void 0:t[e])&&void 0!==s?s:{latestDate:(0,h.hD)(),latestNumber:0,used:"[]"}}),[t,e]);return[(0,u.useMemo)((()=>{var e,t,a;return{latestNumber:null!==(e=null===s||void 0===s?void 0:s.latestNumber)&&void 0!==e?e:0,latestDate:null!==(t=null===s||void 0===s?void 0:s.latestDate)&&void 0!==t?t:(0,h.hD)(),used:JSON.parse(null!==(a=null===s||void 0===s?void 0:s.used)&&void 0!==a?a:"[]")}}),[s]),s]}const b=function(e,t,s){var a;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,n=arguments.length>4?arguments[4]:void 0,r=(0,m.shuffle)((0,m.difference)(e,s,t));const i=n||(null!==(a=r.pop())&&void 0!==a?a:"");n&&(r=(0,m.difference)(r,[n]));const l=[];for(let u=0;u<o;u++){const t=S(e,i,l,u);l.push(t)}return s.push(i,...l),{keyword:i,words:l,letters:D(l,i.length)}},S=(e,t,s,a)=>{const o=(0,m.uniq)([...(0,m.flatMap)(s.map((e=>e.split("")))),...t.split("")]),n=(0,m.shuffle)(e.filter((e=>e[a]===t[a]&&!s.includes(e))));return(0,m.sortBy)(n,(e=>(0,m.intersection)(e.split(""),o).length))[0]},D=(e,t)=>{const s=(0,m.flatMap)(e.map((e=>e.split("")))),a=4===t?[0,5,10,15]:[0,6,12,18,24],o=(0,m.shuffle)(s.filter(((e,t)=>!a.includes(t))));let n=[];for(let i=0;i<s.length;i++){var r;if(a.includes(i))n.push(s[i]);else n.push(null!==(r=o.shift())&&void 0!==r?r:"")}return n},N=(e,t)=>{const[s,a,o]=e.split("-").map(Number),n={id:e,number:t,type:"controle-de-estoque",language:"pt",title:["Domingo","Segunda-feira","Ter\xe7a-feira","Quarta-feira","Quinta-feira","Sexta-feira","S\xe1bado"][new Date(s,a-1,o).getDay()],goods:[],orders:[]},r=(0,m.sampleSize)(Array(192).fill("").map(((e,t)=>"good-".concat(t+1))),17),i=r.pop();return n.goods=r,n.orders=(0,m.sampleSize)(n.goods,4),n.orders.push(i),n.orders=(0,m.shuffle)(n.orders),n};function q(e,t,s,o){const r=c(i.DAILY[null!==t&&void 0!==t?t:"pt"],{enabled:e}),p=function(e,t){var s,o;const{notification:r}=a.Z.useApp(),c=(0,d.a)({queryKey:["data","suffixCounts"],queryFn:(0,l.A)("data","suffixCounts"),enabled:e});(0,u.useEffect)((()=>{c.isSuccess&&(0,n.tS)("Loaded data/suffixCounts")}),[c.isSuccess]),(0,u.useEffect)((()=>{c.isError&&r.error({message:"Error loading data/suffixCounts",placement:"bottomLeft"})}),[c.isError]);const m=i.SUFFIX_DATA[null!==t&&void 0!==t?t:"pt"],p=null!==(s=null===(o=c.data)||void 0===o?void 0:o[m])&&void 0!==s?s:0,g="drawings".concat("pt"===t?"PT":"EN"),v=(0,u.useMemo)((()=>new Array(p).fill(0).map(((t,s)=>({queryKey:["data","".concat(g).concat(s+1)],queryFn:(0,l.A)("data","".concat(g).concat(s+1)),enabled:e&&Boolean(p),onSuccess:()=>{r.info({message:"Data Drawings ".concat(g).concat(s+1," loaded"),placement:"bottomLeft"})}})))),[p]);return(0,f.h)({queries:v})}(e,null!==t&&void 0!==t?t:"pt"),S=p.some((e=>e.isLoading)),[D]=y("arte-ruim",r.data),q=(0,u.useMemo)((()=>S||!r.isSuccess?[]:((e,t,s,a,o)=>{console.count("Creating Arte Ruim...");const n=(null!==s&&void 0!==s?s:[]).reduce(((e,s)=>{var o;const n=null!==(o=s.data)&&void 0!==o?o:{};return Object.entries(n).forEach((s=>{var o;let[n,r]=s;const i=null!==(o=r.cardId)&&void 0!==o?o:r.id;return null!==i&&void 0!==i&&i.includes("--")||t.used.includes(i)?e:r.drawing.trim().length<10?(console.log("\ud83d\udd06 Empty drawing",i),e):void(void 0===e[i]?e[i]={id:i,type:"arte-ruim",language:null!==a&&void 0!==a?a:"pt",cardId:i,text:r.text,drawings:[r.drawing],number:0,dataIds:[n]}:(e[i].drawings.push(r.drawing),e[i].dataIds.push(n)))})),e}),{}),r=Object.values(n).filter((e=>{var t;return e.drawings.length>=o&&e.cardId&&!(null!==(t=e.cardId)&&void 0!==t&&t.includes("--"))})),i=(0,m.sampleSize)((0,m.shuffle)(r),e);let l=t.latestDate;return i.map(((e,s)=>{const a=(0,h.ao)(l);return l=a,{...e,id:a,number:t.latestNumber+s+1}}))})(o,D,p,t,s)),[p,t,D,o,s,S,r.isSuccess]),I=(0,v.N)("daily-disc-sets",e),[w]=y("aqui-o",r.data),L=(0,u.useMemo)((()=>I.isSuccess&&r.isSuccess?((e,t,s)=>{console.count("Creating Aqui \xd3...");const a=(0,m.shuffle)(Object.values(s).filter((e=>e.itemsIds.filter(Boolean).length>=20)));let o=a.filter((e=>!t.used.includes(e.id)));o.length<e&&(console.log("\ud83d\udd06 Not enough aqui-o sets left, shuffling..."),o.push(...(0,m.shuffle)(a)));let n=t.latestDate;const r={};for(let i=0;i<e;i++){const e=o[i];e||console.error("No aqui-o sets left");const s=(0,h.ao)(n);n=s,r[s]={id:s,type:"aqui-o",number:t.latestNumber+i+1,setId:e.id,title:e.title,itemsIds:["0",...(0,m.sampleSize)(e.itemsIds,20)]}}return r})(o,w,I.data):{}),[I,w,o,r.isSuccess]),A=g(4,t,!0,!0),M=g(5,t,!0,!0),[Y]=y("palavreado",r.data),E=(0,u.useMemo)((()=>A.data&&A.data.length&&M.data&&M.data.length&&r.isSuccess?((e,t,s,a)=>{console.count("Creating Palavreado...");let o=t.latestDate;const n=[],r={};for(let i=0;i<e;i++){const e=(0,h.ao)(o),l=(0,h.TI)(e),u=l?5:4;o=e,r[e]={id:e,type:"palavreado",number:t.latestNumber+i+1,...b(l?a:s,[...Object.values(r).map((e=>e.keyword)),...t.used],n,u)}}return r})(o,Y,A.data,M.data):{}),[A,M,Y,o,r.isSuccess]),O=(0,v.N)("arte-ruim-cards-".concat(t),e),[C]=y("artista",r.data),J=(0,u.useMemo)((()=>{if(!O.isSuccess||!r.isSuccess)return{};const e=q.map((e=>e.cardId));return((e,t,s,a,o)=>{console.count("Creating Artista...");let n=t.latestDate;const r={};for(let i=0;i<e;i++){const e=(0,h.ao)(n),l=Object.keys(null!==a&&void 0!==a?a:{}).filter((e=>!s.used.includes(e)&&!o.includes(e))),u=(0,m.sampleSize)(l,15).map((e=>a[e]));n=e,r[e]={id:e,type:"artista",number:t.latestNumber+i+1,cards:u}}return r})(o,C,D,O.data,e)}),[O,D,C,o,r.isSuccess,q]),F=(0,v.N)("daily-movie-sets",e),[k]=y("filmaco",r.data),R=(0,u.useMemo)((()=>F.isSuccess&&r.isSuccess?((e,t,s)=>{console.count("Creating Filma\xe7o...");const a=(0,m.shuffle)(Object.values(s).filter((e=>e.itemsIds.filter(Boolean).length>0)));let o=a.filter((e=>!t.used.includes(e.id)));o.length<e&&o.push(...(0,m.shuffle)(a));let n=t.latestDate;const r={};for(let i=0;i<e;i++){const e=o[i];if(!e){console.error("No filma\xe7o sets left");break}const s=(0,h.ao)(n);n=s,r[s]={id:s,type:"filmaco",number:t.latestNumber+i+1,setId:e.id,title:e.title,itemsIds:e.itemsIds,year:e.year}}return r})(o,k,F.data):{}),[F,k,o,r.isSuccess]),[j]=y("controle-de-estoque",r.data),x=(0,u.useMemo)((()=>r.isSuccess?((e,t)=>{console.count("Creating Controle de Estoque...");let s=t.latestDate;const a={};for(let o=0;o<e;o++){const e=(0,h.ao)(s);s=e,a[e]=N(e,t.latestNumber+o+1)}return a})(o,j):{}),[o,r.isSuccess,j]),T=(0,u.useMemo)((()=>0===q.length?[]:(console.count("Bundling entries..."),q.map((e=>({id:e.id,"arte-ruim":e,"aqui-o":L[e.id],palavreado:E[e.id],artista:J[e.id],filmaco:R[e.id],"controle-de-estoque":x[e.id]}))))),[q,L,E,J,R,x]);return{isLoading:S||r.isLoading||A.isLoading||M.isLoading||O.isLoading||I.isLoading||F.isLoading,entries:T}}var I=s(5850),w=s(3713);function L(e){const{notification:t}=a.Z.useApp(),s=(0,w.NL)(),l=i.DAILY[null!==e&&void 0!==e?e:"pt"],[d,f]=(0,u.useState)(!1),m=c(l,{enabled:Boolean(l)}),p=(0,r.D)({mutationFn:async e=>{var t,s,a;const r=e.map((e=>{const t=(0,o.JU)(n.RZ,"".concat(l,"/").concat(e.id));return(0,o.pl)(t,e)})),i=(0,o.JU)(n.RZ,"".concat(l,"/history")),u=m.data;if(!u)throw new Error("No previous history");const d={...u,"arte-ruim":{latestDate:e[e.length-1].id,latestNumber:e[e.length-1]["arte-ruim"].number,used:JSON.stringify((0,I.R1)([...JSON.parse(u["arte-ruim"].used),...e.map((e=>e["arte-ruim"].cardId))]))},"aqui-o":{latestDate:e[e.length-1].id,latestNumber:e[e.length-1]["aqui-o"].number,used:JSON.stringify((0,I.R1)([...JSON.parse(null!==(t=u["aqui-o"].used)&&void 0!==t?t:"[]"),...e.map((e=>e["aqui-o"].setId))]))},palavreado:{latestDate:e[e.length-1].id,latestNumber:e[e.length-1].palavreado.number,used:JSON.stringify((0,I.R1)([...JSON.parse(u.palavreado.used),...e.map((e=>e.palavreado.keyword))]))},artista:{latestDate:e[e.length-1].id,latestNumber:e[e.length-1].artista.number,used:"[]"},filmaco:{latestDate:e[e.length-1].id,latestNumber:e[e.length-1].filmaco.number,used:JSON.stringify((0,I.R1)([...JSON.parse(null!==(s=null===u||void 0===u||null===(a=u.filmaco)||void 0===a?void 0:a.used)&&void 0!==s?s:"[]"),...e.map((e=>e.filmaco.setId))]))},"controle-de-estoque":{latestDate:e[e.length-1].id,latestNumber:e[e.length-1]["controle-de-estoque"].number,used:"[]"}};return(0,o.pl)(i,d),Promise.all(r)},onSuccess:()=>{t.info({message:"Data saved",placement:"bottomLeft"}),s.invalidateQueries({queryKey:[l,"history"]}),f(!1)},onError:()=>{t.error({message:"Error saving data",placement:"bottomLeft"})}});return{isDirty:d,setIsDirty:f,save:p.mutateAsync,isPending:p.isPending}}function A(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{notification:t}=a.Z.useApp(),s=i.DAILY.pt,l=(0,r.D)({mutationFn:async e=>{const t=(0,o.JU)(n.RZ,"".concat(s,"/history"));(0,o.pl)(t,e)},onSuccess:()=>{t.info({message:"New history data saved",placement:"bottomLeft"})}}),u=c(s,{enabled:e});return{mutation:l,historyQuery:u}}},6728:(e,t,s)=>{s.d(t,{TI:()=>i,ao:()=>r,hD:()=>n});s(763);var a=s(2426),o=s.n(a);function n(){return o()().subtract(1,"days").format("YYYY-MM-DD")}function r(e){return o()(e,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD")}function i(e){return 6===o()(e,"YYYY-MM-DD").day()}}}]);
//# sourceMappingURL=633.5d40132a.chunk.js.map