"use strict";(self.webpackChunktdr=self.webpackChunktdr||[]).push([[724],{8178:(e,n,t)=>{t.d(n,{i:()=>c});var i=t(5),s=t(1105),l=t(5529),a=t(763),d=t(2791),r=t(5675),o=t(184);function c(e){let{items:n,isPending:t,style:c,size:u,placeholder:m,allowClear:h,onFinish:v,...p}=e;const g=(0,l.N)("items",!Boolean(n)&&!t),{namesDict:x,options:j}=(0,d.useMemo)((()=>{var e;console.log("Recomputing item names typeahead...");const t=Object.values(null!==(e=null!==n&&void 0!==n?n:g.data)&&void 0!==e?e:{}).reduce(((e,n)=>{const t="".concat(n.name.en," (").concat(n.id,")"),i="".concat(n.name.pt," (").concat(n.id,")");return e[t]=n.id,e[i]=n.id,e}),{});return{namesDict:t,options:(0,a.orderBy)(Object.keys(t),[e=>e.toLowerCase()]).map((e=>({value:e})))}}),[n,t]),[f,k]=(0,d.useState)([]),[y,w]=(0,d.useState)("");(0,r.Z)((()=>{y&&Z(y)}),500,[y]);const Z=e=>{if(!e)return void k([]);const n=e.trim().toUpperCase(),t=j.filter((e=>{var t;return String(null!==(t=null===e||void 0===e?void 0:e.value)&&void 0!==t?t:"").toUpperCase().includes(n)})),i=(0,a.orderBy)(t,[e=>{var t;const i=String(null!==(t=null===e||void 0===e?void 0:e.value)&&void 0!==t?t:"").toUpperCase();if(i===n)return 0;const s=i.match(/\((.*?)\)/);if(s&&s[1]===n)return 1;const l=i.indexOf(n);return 0===l?2:l>0?3:4}]);k(i)};return(0,o.jsx)(i.Z,{options:f,style:{width:250,...c},allowClear:null===h||void 0===h||h,placeholder:null!==m&&void 0!==m?m:"Search by name or id...",filterOption:(e,n)=>{var t;return-1!==String(null!==(t=null===n||void 0===n?void 0:n.value)&&void 0!==t?t:"").toUpperCase().indexOf(null===e||void 0===e?void 0:e.toUpperCase())},onSearch:w,notFoundContent:y.length>0?"No items found":"Type to search...",onSelect:e=>{void 0!==x[e]&&v(x[e])},...p,children:(0,o.jsx)(s.Z,{onPressEnter:()=>{if(f.length>0){const e=f[0].value;void 0!==x[e]&&v(x[e])}}})})}},64:(e,n,t)=>{t.r(n),t.d(n,{default:()=>ie});var i=t(3990),s=t(1046),l=t(2128),a=t(4031),d=t(6106),r=t(914),o=t(731),c=t(1105),u=t(7765),m=t(5225),h=t(5922),v=t(4520),p=t(9228),g=t(2556),x=t(1310),j=t(6020),f=t(4766),k=t(8938),y=t(763),w=t(2791),Z=t(184);const b=(0,w.createContext)({items:{},isLoading:!0,error:null,hasResponseData:!1,decksDict:{},decks:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1"}),C=e=>{var n;let{children:t}=e;const{queryParams:i}=(0,f.K)(),{data:s,isLoading:l,error:a,isSaving:d,save:r,addEntryToUpdate:o,entriesToUpdate:c,isDirty:u}=(0,k.i)({tdrResourceName:"items",firebaseDataCollectionName:"items"}),{decksDict:m,decks:h}=(0,w.useMemo)((()=>{console.log("Recomputing item decks typeahead...");const e={},n={},t={},i=[];Object.values(s).forEach((s=>{var l;const a="".concat(s.name.en," (").concat(s.id,")"),d="".concat(s.name.pt," (").concat(s.id,")");n[s.name.en]?i.push(["".concat(s.name.en," (").concat(n[s.name.en],")"),a]):n[s.name.en]=s.id,t[s.name.pt]?i.push(["".concat(s.name.pt," (").concat(t[s.name.pt],")"),d]):t[s.name.pt]=s.id,null===s||void 0===s||null===(l=s.decks)||void 0===l||l.forEach((n=>{e[n]=n}))}));const l=(0,y.orderBy)(Object.keys(e)).map((e=>({value:e})));return i.length>0&&console.warn("Possible duplicated items",i),{decksDict:e,decks:l}}),[s,d,l]),v=null!==(n=i.get("deck"))&&void 0!==n?n:"all",p=(0,w.useMemo)((()=>{const e=(0,y.orderBy)(Object.values(s),[e=>Number(e.id)],"asc");switch(v){case"all":return e;case"!all":return e.filter((e=>{var n,t;return null===(n=!(null!==e&&void 0!==e&&null!==(t=e.decks)&&void 0!==t&&t.length))||void 0===n||n}));case"nsfw":return e.filter((e=>e.nsfw));case"!nsfw":return e.filter((e=>!e.nsfw));default:return v.startsWith("!")?e.filter((e=>{var n;return!(null!==e&&void 0!==e&&null!==(n=e.decks)&&void 0!==n&&n.includes(v.slice(1)))})):e.filter((e=>{var n;return null===e||void 0===e||null===(n=e.decks)||void 0===n?void 0:n.includes(v)}))}}),[s,v]),g=(0,w.useMemo)((()=>{var e;const n=(0,y.orderBy)(Object.keys(c),[e=>Number(e)],"asc"),t=null===(e=p[p.length-1])||void 0===e?void 0:e.id,i=(0,y.orderBy)([...n,t],[e=>Number(e)],"desc")[0];return String(Number(i)+1)}),[p,c]);return(0,Z.jsx)(b.Provider,{value:{items:s,listing:p,isLoading:l,error:a,decksDict:m,decks:h,hasResponseData:p.length>0,isDirty:u,addItemToUpdate:o,isSaving:d,save:r,itemsToUpdate:c,newId:g},children:t})},S=()=>(0,w.useContext)(b);var N=t(7134);var D=t(3834),O=t(4483),T=t(7747),z=t(8955),P=t(6324),I=t(2675);function R(e){let{item:n,editMode:t=!1,simplified:i}=e;const{decks:l}=S(),{isEditing:d,toggleEditMode:r,onEdit:v,isDirty:p,onModify:g,onReset:k,editableItem:b}=function(e){var n;let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{addItemToUpdate:i,itemsToUpdate:s}=S(),[l,a]=(0,w.useState)(t),[d,r]=(0,w.useState)((0,y.cloneDeep)(e)),o=null!==(n=s[e.id])&&void 0!==n?n:e,c=e=>{const n={...(0,y.cloneDeep)(d),...e};Object.keys(e).includes("nsfw")&&!1===e.nsfw&&delete n.nsfw,r(n)},u=async()=>{i(d.id,d)},m=()=>{r((0,y.cloneDeep)(e)),a(!1)},h=JSON.stringify(o)!==JSON.stringify(d);return{isEditing:l,toggleEditMode:()=>a((e=>!e)),editableItem:d,onEdit:c,isDirty:h,onModify:u,onReset:m}}(n,t),C=(0,N._)(),{is:P}=(0,f.K)();return(0,Z.jsxs)(o.Z,{title:(0,Z.jsx)(a.Z.Text,{onClick:()=>C(n.id),children:n.id}),extra:(0,Z.jsx)(M,{item:n}),style:{maxWidth:250},size:i?"small":"default",actions:i?void 0:p?[(0,Z.jsx)(D.Z,{onClick:k},"reset"),(0,Z.jsx)(O.Z,{onClick:g},"save")]:[(0,Z.jsx)(T.Z,{onClick:r},"edit")],children:[(0,Z.jsx)(j.ck,{id:n.id,width:i?75:125,title:"".concat(n.name.en," | ").concat(n.name.pt)}),(0,Z.jsxs)(s.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,Z.jsx)(c.Z,{prefix:(0,Z.jsx)(x.H,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:d?"outlined":"borderless",size:"small",defaultValue:n.name.en,readOnly:!d,onChange:e=>v({name:{...b.name,en:e.target.value}})},"en-".concat(n.name.en)),(0,Z.jsx)(c.Z,{prefix:(0,Z.jsx)(x.H,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:d?"outlined":"borderless",size:"small",defaultValue:n.name.pt,readOnly:!d,onChange:e=>v({name:{...b.name,pt:e.target.value}})},"pt-".concat(n.name.pt)),!i&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{children:(0,Z.jsx)(u.Z,{mode:"multiple",style:{width:"100%"},placeholder:"Select a deck",defaultValue:n.decks,disabled:!d,options:l,variant:d?"outlined":"borderless",size:"small",onChange:e=>v({decks:e.sort()})},String(n.decks))}),P("showVerifyThing")&&(0,Z.jsx)("div",{children:(0,Z.jsx)(E,{item:n})}),(d||n.nsfw)&&(0,Z.jsx)("div",{children:(0,Z.jsx)(m.Z.Item,{label:"nsfw",valuePropName:"checked",children:(0,Z.jsx)(h.Z,{checked:n.nsfw,onChange:e=>v({nsfw:e}),size:"small",checkedChildren:(0,Z.jsx)(z.Z,{style:{color:"hotpink"}}),disabled:!d})})})]})]})]})}const U=(0,y.memoize)((e=>{var n,t;const i=!(null===(n=e.decks)||void 0===n||!n.includes("thing")),s=!(null===(t=e.decks)||void 0===t||!t.includes("manufactured")),l=1===e.name.en.split(" ").length,a=1===e.name.pt.split(" ").length,d={en:i||l&&s,pt:i||a&&s};return d.pt||d.en?(0,Z.jsxs)(Z.Fragment,{children:[d.en&&(0,Z.jsx)(x.H,{language:"en",width:"1em"}),d.pt&&(0,Z.jsx)(x.H,{language:"pt",width:"1em"})]}):""})),E=e=>{let{item:n}=e;const t=U(n);return t?(0,Z.jsxs)(v.Z,{gap:6,children:["Thing: ",t]}):(0,Z.jsx)(Z.Fragment,{})};function M(e){let{item:n}=e;const[t,i]=(0,I.Z)(!1),l=(0,N._)();return(0,Z.jsx)(p.Z,{content:(0,Z.jsxs)(s.Z,{direction:"vertical",children:[(0,Z.jsx)(g.ZP,{size:"small",onClick:()=>l(JSON.stringify(n,null,2)),children:"Complete Item"}),(0,Z.jsx)(g.ZP,{size:"small",onClick:()=>l(n.name.en),children:"EN Name"}),(0,Z.jsx)(g.ZP,{size:"small",onClick:()=>l(n.name.pt),children:"PT Name"}),(0,Z.jsx)(g.ZP,{size:"small",onClick:()=>l(JSON.stringify((e=>({id:e.id,type:"item",header:{title:{en:"Item",pt:"Item"},iconId:"2077"},metadata:{level:"basic",keyword:(0,y.snakeCase)(e.name.en).toUpperCase()},content:{itemId:e.id,caption:e.name}}))(n),null,2)),children:"Escape Room Item"})]}),title:"Copy",trigger:"click",open:t,onOpenChange:i,children:(0,Z.jsx)(g.ZP,{type:"text",icon:(0,Z.jsx)(P.Z,{})})})}var F=t(4290),B=t(2228);function L(){var e;const{queryParams:n}=(0,f.K)(),t=null!==(e=n.get("type"))&&void 0!==e?e:"all",{listing:i}=S(),{page:s,pagination:l}=(0,F.e)({data:i,resetter:t});return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(a.Z.Title,{level:2,children:["Listing - ",(0,y.capitalize)(t)," items (",i.length,")"]}),(0,Z.jsx)(B.N,{pagination:l,children:(0,Z.jsx)(d.Z,{gutter:[16,16],className:"my-4",children:s.map((e=>(0,Z.jsx)(r.Z,{xs:24,sm:24,md:12,lg:6,xl:4,children:(0,Z.jsx)(R,{item:e})},e.id)))})})]})}var V=t(7128),J=t(6173),K=t(7018),H=t(1958),W=t(959);const q={id:"",name:{en:"",pt:""},groups:[]};function A(e){let{isModalOpen:n,handleOk:t,handleCancel:i,newId:s}=e;const[l]=(0,w.useState)((0,y.cloneDeep)({...q,id:s}));return(0,Z.jsx)(W.Z,{title:"Add new item",open:n,onOk:t,onCancel:i,children:(0,Z.jsx)(R,{item:l,editMode:!0})})}function _(){const[e,n]=(0,w.useState)(!1),{newId:t}=S();return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(g.ZP,{block:!0,onClick:()=>{n(!0)},children:"Add New Item"}),e&&(0,Z.jsx)(A,{isModalOpen:e,handleOk:()=>{n(!1)},handleCancel:()=>{n(!1)},newId:t},t)]})}var G=t(5850),X=t(7340);function Q(){var e;const{isDirty:n,save:t,items:i,decks:s,itemsToUpdate:l,isSaving:a}=S(),{queryParams:d,is:r,addParam:o}=(0,f.K)(),c=(0,w.useMemo)((()=>{const e=(0,y.orderBy)(s.map((e=>{let{value:n}=e;return{label:(0,y.capitalize)(n),value:n}})),"label"),n=e.map((e=>{let{label:n,value:t}=e;return{label:"NOT ".concat(n),value:"!".concat(t)}}));return[...e,...n]}),[s]);return(0,Z.jsxs)(H.Pd,{children:[(0,Z.jsxs)(v.Z,{vertical:!0,gap:6,children:[(0,Z.jsx)(X.k,{isDirty:n,dirt:JSON.stringify(l),onSave:t,isSaving:a}),(0,Z.jsx)(K.o,{data:()=>function(e){return(0,G.Tj)(Object.values(e).reduce(((e,n)=>{var t;return n.decks=(null!==(t=null===n||void 0===n?void 0:n.decks)&&void 0!==t?t:[]).sort(),0===n.decks.length?(delete n.decks,e[n.id]=n,e):(n.decks.includes("thing")&&1===n.name.en.split(" ").length&&1===n.name.pt.split(" ").length&&((n.decks.includes("evidence")||n.decks.includes("dream")||n.decks.includes("alien")||n.decks.includes("manufactured"))&&(n.decks=n.decks.filter((e=>"thing"!==e))),e[n.id]=n),e[n.id]=n,e)}),{}))}(i),fileName:"items.json",disabled:n,block:!0})]}),(0,Z.jsx)(V.Z,{}),(0,Z.jsx)(J.Do,{label:"Show Search",value:!r("hideSearch"),onChange:e=>o("hideSearch",e?"":"true","")}),(0,Z.jsx)(J.Do,{label:"Show Randomizer",value:r("showRandomizer"),onChange:e=>o("showRandomizer",e?"true":"","")}),(0,Z.jsx)(J.Do,{label:"Verify Thing",value:r("showVerifyThing"),onChange:e=>o("showVerifyThing",e?"true":""),className:"full-width m-0"}),(0,Z.jsx)(J.zE,{label:"Deck",value:null!==(e=d.get("deck"))&&void 0!==e?e:"all",onChange:e=>o("deck",e,"all"),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...c,{label:"No decks",value:"!all"}]}),(0,Z.jsx)(V.Z,{}),(0,Z.jsx)(_,{})]})}function Y(){const{listing:e}=S(),[n,t]=(0,w.useState)([]);return(0,Z.jsxs)("div",{children:[(0,Z.jsx)(a.Z.Title,{level:2,children:"Randomized Sample"}),(0,Z.jsx)("div",{children:(0,Z.jsx)(g.ZP,{onClick:()=>{t((0,y.sampleSize)(e,5))},children:"Get Sample"})}),(0,Z.jsx)(s.Z,{wrap:!0,className:"my-4",children:n.map((e=>(0,Z.jsx)(R,{item:e,simplified:!0},e.id)))}),(0,Z.jsx)(V.Z,{})]})}var $=t(8178);function ee(){const{items:e,isLoading:n,isSaving:t}=S(),[i,l]=(0,w.useState)(null);return(0,Z.jsxs)(w.Fragment,{children:[(0,Z.jsx)(a.Z.Title,{level:2,children:"Search for an item"}),(0,Z.jsx)("div",{children:(0,Z.jsx)($.i,{items:e,isPending:n||t,onFinish:n=>l(e[n])})}),Boolean(i)&&(0,Z.jsx)(s.Z,{direction:"vertical",className:"my-4",children:(0,Z.jsx)(R,{item:i})},null===i||void 0===i?void 0:i.id),(0,Z.jsx)(V.Z,{})]},"item-search-".concat(n))}var ne=t(4562);function te(){const{isLoading:e,error:n,hasResponseData:t}=S(),{is:a}=(0,f.K)();return(0,Z.jsx)(H.Xg,{title:"Items",subtitle:"Listing",children:(0,Z.jsxs)(i.Z,{hasSider:!0,children:[(0,Z.jsx)(ne.p,{children:(0,Z.jsx)(Q,{})}),(0,Z.jsx)(i.Z.Content,{className:"content",children:(0,Z.jsxs)(l.T,{isLoading:e,error:n,hasResponseData:t,children:[!e&&(0,Z.jsxs)(s.Z,{size:"large",children:[!a("hideSearch")&&(0,Z.jsx)(ee,{}),a("showRandomizer")&&(0,Z.jsx)(Y,{})]}),(0,Z.jsx)(L,{})]})})]})})}const ie=function(){return(0,Z.jsx)(C,{children:(0,Z.jsx)(te,{})})}}}]);
//# sourceMappingURL=Items.51b00068.chunk.js.map