"use strict";(self.webpackChunktdr=self.webpackChunktdr||[]).push([[724],{7018:(e,n,t)=>{t.d(n,{o:()=>o});var i=t(2556),a=t(5850),s=t(184);function o(e){let{data:n,fileName:t,loading:o,...l}=e;return(0,s.jsx)(i.ZP,{onClick:()=>(0,a.ZN)("function"===typeof n?n():n,t),loading:o,...l,children:"Download JSON"})}},8178:(e,n,t)=>{t.d(n,{i:()=>r});var i=t(5),a=t(1692),s=t(763),o=t(2791),l=t(184);function r(e){let{items:n,isPending:t,style:r,size:d,placeholder:c,allowClear:u,onFinish:g,...p}=e;const{namesDict:m,options:v}=(0,o.useMemo)((()=>{console.log("Recomputing item names typeahead...");const e=Object.values(n).reduce(((e,n)=>{const t="".concat(n.name.en," (").concat(n.id,")"),i="".concat(n.name.pt," (").concat(n.id,")");return e[t]=n.id,e[i]=n.id,e}),{});return{namesDict:e,options:(0,s.orderBy)(Object.keys(e),[e=>e.toLowerCase()]).map((e=>({value:e})))}}),[n,t]),[h,f]=(0,o.useState)([]);return(0,l.jsx)(i.Z,{options:v,style:{width:250,...r},allowClear:null===u||void 0===u||u,placeholder:null!==c&&void 0!==c?c:"Search by name or id...",filterOption:(e,n)=>{var t;return-1!==String(null!==(t=null===n||void 0===n?void 0:n.value)&&void 0!==t?t:"").toUpperCase().indexOf(null===e||void 0===e?void 0:e.toUpperCase())},onSearch:e=>{f(v.filter((n=>{var t;return-1!==String(null!==(t=null===n||void 0===n?void 0:n.value)&&void 0!==t?t:"").toUpperCase().indexOf(null===e||void 0===e?void 0:e.toUpperCase())})))},notFoundContent:"No items found",onSelect:e=>{void 0!==m[e]&&g(m[e])},...p,children:(0,l.jsx)(a.Z,{onPressEnter:()=>{if(h.length>0){const e=h[0].value;void 0!==m[e]&&g(m[e])}}})})}},8027:(e,n,t)=>{t.d(n,{A:()=>l,X:()=>r});var i=t(2481),a=t(5860),s=t(6807),o=t(5850);function l(e,n){return async()=>{var t;console.log("%cQuerying ".concat(e,"/").concat(n," from firebase: ").concat((0,o.xE)()),"color: #f0f");const s=(0,i.JU)(a.RZ,"".concat(e,"/").concat(n));return null!==(t=(await(0,i.QT)(s)).data())&&void 0!==t?t:{}}}function r(e,n,t){return(0,s.a)({queryKey:["firebase",e,n],queryFn:l(e,n),...t})}},5529:(e,n,t)=>{t.d(n,{N:()=>o});var i=t(763),a=t(6807),s=t(2606);function o(e){var n;let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{getUrl:o}=(0,s.n)("tdr"),l=(0,a.a)({queryKey:[e],queryFn:async()=>{const n=await fetch(o("".concat(e,".json")));return await n.json()},enabled:t}),r=!(0,i.isEmpty)(l.data);return{...l,data:null!==(n=l.data)&&void 0!==n?n:{},hasResponseData:r}}},2233:(e,n,t)=>{t.d(n,{B:()=>l});var i=t(2481),a=t(5860),s=t(3418);function o(e,n,t){console.log("%cUpdating ".concat(e,"/").concat(n," from firebase"),"color: #f00");const s=(0,i.JU)(a.RZ,"".concat(e,"/").concat(n));return(0,i.r7)(s,t)}function l(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,s.D)({mutationFn:async t=>o(e,n,t),...t})}},6424:(e,n,t)=>{t.r(n),t.d(n,{default:()=>_});var i=t(3990),a=t(2128),s=t(7742),o=t(8914),l=t(6106),r=t(914),d=t(763),c=t(2791),u=t(8027),g=t(5529),p=t(6403),m=t(2233),v=t(4747);var h=t(184);const f=(0,c.createContext)({items:{},isLoading:!0,error:null,hasResponseData:!1,groupsDict:{},groups:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1",listingType:"all",setListingType:()=>{}}),j=e=>{let{children:n}=e;const{items:t,isLoading:i,error:a,isSaving:s,save:o,addItemToUpdate:l,itemsToUpdate:r,isDirty:j}=function(){const{notification:e}=v.Z.useApp(),n=(0,p.NL)(),t=(0,g.N)("items"),i=(0,u.X)("data","items"),[a,s]=(0,c.useState)({}),o=(0,m.B)("data","items",{onSuccess:()=>{e.success({message:"Item updated"}),n.refetchQueries(["firebase","data","items"]),s({})},onError:n=>{e.error({message:"Item update failed",description:n.message})}}),l=(0,c.useMemo)((()=>{var e,n;return t.isLoading||i.isLoading||o.isLoading?{}:(console.log("%cMerging items data...","color: #f0f"),(0,d.cloneDeep)({...null!==(e=t.data)&&void 0!==e?e:{},...null!==(n=i.data)&&void 0!==n?n:{},...a}))}),[t.data,i.data,t.isLoading,i.isLoading,o.isLoading,a]),r=!(0,d.isEmpty)(a),h=i.data;return{items:l,isLoading:t.isLoading||i.isLoading,error:t.error||i.error,firebaseData:h,isSaving:o.isLoading,save:()=>{o.mutate({...h,...a})},addItemToUpdate:(e,n)=>{s((t=>({...t,[e]:n})))},itemsToUpdate:a,isDirty:r}}(),{groupsDict:x,groups:y}=(0,c.useMemo)((()=>{console.log("Recomputing item groups typeahead...");const e={},n={},i={},a=[];Object.values(t).forEach((t=>{var s;const o="".concat(t.name.en," (").concat(t.id,")"),l="".concat(t.name.pt," (").concat(t.id,")");n[t.name.en]?a.push(["".concat(t.name.en," (").concat(n[t.name.en],")"),o]):n[t.name.en]=t.id,i[t.name.pt]?a.push(["".concat(t.name.pt," (").concat(i[t.name.pt],")"),l]):i[t.name.pt]=t.id,null===t||void 0===t||null===(s=t.groups)||void 0===s||s.forEach((n=>{e[n]=n}))}));const s=Object.keys(e).map((e=>({value:e})));return a.length>0&&console.warn("Possible duplicated items",a),{groupsDict:e,groups:s}}),[t,s,i]),[b,S]=(0,c.useState)("all"),w=(0,c.useMemo)((()=>{const e=(0,d.orderBy)(Object.values(t),[e=>Number(e.id)],"asc");switch(b){case"all":return e;case"!all":return e.filter((e=>{var n,t;return null===(n=!(null!==e&&void 0!==e&&null!==(t=e.groups)&&void 0!==t&&t.length))||void 0===n||n}));case"nsfw":return e.filter((e=>e.nsfw));case"!nsfw":return e.filter((e=>!e.nsfw));default:return b.startsWith("!")?e.filter((e=>{var n;return!(null!==e&&void 0!==e&&null!==(n=e.groups)&&void 0!==n&&n.includes(b.slice(1)))})):e.filter((e=>{var n;return null===e||void 0===e||null===(n=e.groups)||void 0===n?void 0:n.includes(b)}))}}),[t,b]),C=(0,c.useMemo)((()=>{var e;const n=(0,d.orderBy)(Object.keys(r),[e=>Number(e)],"asc"),t=null===(e=w[w.length-1])||void 0===e?void 0:e.id,i=(0,d.orderBy)([...n,t],[e=>Number(e)],"desc")[0];return String(Number(i)+1)}),[w,r]);return(0,h.jsx)(f.Provider,{value:{items:t,listing:w,isLoading:i,error:a,groupsDict:x,groups:y,hasResponseData:w.length>0,isDirty:j,addItemToUpdate:l,isSaving:s,save:o,itemsToUpdate:r,newId:C,listingType:b,setListingType:S},children:n})},x=()=>(0,c.useContext)(f);var y=t(3477),b=t(1046),S=t(1692),w=t(1766),C=t(3070),Z=t(5922),D=t(1310),N=t(6020),T=t(3834),k=t(4483),L=t(1752),O=t(8955);var U=t(7134);function z(e){let{item:n,editMode:t=!1}=e;const{groups:i}=x(),{isEditing:a,toggleEditMode:s,onEdit:l,isDirty:r,onModify:u,onReset:g,editableItem:p}=function(e){var n;let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{addItemToUpdate:i,itemsToUpdate:a}=x(),[s,o]=(0,c.useState)(t),[l,r]=(0,c.useState)((0,d.cloneDeep)(e)),u=null!==(n=a[e.id])&&void 0!==n?n:e,g=e=>{const n={...(0,d.cloneDeep)(l),...e};Object.keys(e).includes("nsfw")&&!1===e.nsfw&&delete n.nsfw,r(n)},p=async()=>{i(l.id,l)},m=()=>{r((0,d.cloneDeep)(e)),o(!1)},v=JSON.stringify(u)!==JSON.stringify(l);return{isEditing:s,toggleEditMode:()=>o((e=>!e)),editableItem:l,onEdit:g,isDirty:v,onModify:p,onReset:m}}(n,t),m=(0,U._)();return(0,h.jsxs)(y.Z,{title:(0,h.jsx)(o.Z.Text,{onClick:()=>m(n.id),children:n.id}),style:{maxWidth:300},actions:r?[(0,h.jsx)(T.Z,{onClick:g},"reset"),(0,h.jsx)(k.Z,{onClick:u},"save")]:[(0,h.jsx)(L.Z,{onClick:s},"edit")],children:[(0,h.jsx)(N.ck,{id:n.id,width:124,title:"".concat(n.name.en," | ").concat(n.name.pt)}),(0,h.jsxs)(b.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,h.jsx)(S.Z,{prefix:(0,h.jsx)(D.H,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:a?"outlined":"borderless",size:"small",defaultValue:n.name.en,readOnly:!a,onChange:e=>l({name:{...p.name,en:e.target.value}})},"en-".concat(n.name.en)),(0,h.jsx)(S.Z,{prefix:(0,h.jsx)(D.H,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:a?"outlined":"borderless",size:"small",defaultValue:n.name.pt,readOnly:!a,onChange:e=>l({name:{...p.name,pt:e.target.value}})},"pt-".concat(n.name.pt)),(0,h.jsx)("div",{children:(0,h.jsx)(w.Z,{mode:"multiple",style:{width:"100%"},placeholder:"Please select groups",defaultValue:n.groups,disabled:!a,options:i,variant:a?"outlined":"borderless",size:"small",onChange:e=>l({groups:e.sort()})},String(n.groups))}),(a||n.nsfw)&&(0,h.jsx)("div",{children:(0,h.jsx)(C.Z.Item,{label:"nsfw",valuePropName:"checked",children:(0,h.jsx)(Z.Z,{checked:n.nsfw,onChange:e=>l({nsfw:e}),size:"small",checkedChildren:(0,h.jsx)(O.Z,{style:{color:"hotpink"}}),disabled:!a})})})]})]})}function I(){const{page:e,currentPage:n,onChange:t,total:i,pageSize:a,onPageSizeChange:u,listingType:g}=function(){const{listing:e,listingType:n}=x(),[t,i]=(0,c.useState)(1),[a,s]=(0,c.useState)(64),o=(0,c.useMemo)((()=>{const n=(t-1)*a,i=n+a;return e.slice(n,i)}),[t,e,a]);return(0,c.useEffect)((()=>{i(1)}),[n]),{currentPage:t,page:o,total:e.length,onChange:e=>{i(e)},pageSize:a,onPageSizeChange:(e,n)=>{s(n)},listingType:n}}(),p=(0,h.jsx)(s.Z,{onChange:t,current:n,total:i,pageSizeOptions:[16,32,64,128],pageSize:a,onShowSizeChange:u,className:"fixed-pagination"});return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(o.Z.Title,{level:2,children:["Listing - ",(0,d.capitalize)(g)," items (",i,")"]}),p,(0,h.jsx)(l.Z,{gutter:[16,16],className:"my-4",children:e.map((e=>(0,h.jsx)(r.Z,{xs:24,sm:24,md:12,lg:6,xl:4,children:(0,h.jsx)(z,{item:e})},e.id)))}),p]})}var E=t(4520),M=t(2556),P=t(7128),F=t(6173),R=t(7018),B=t(1958),A=t(959);const J={id:"",name:{en:"",pt:""},groups:[]};function q(e){let{isModalOpen:n,handleOk:t,handleCancel:i,newId:a}=e;const[s]=(0,c.useState)((0,d.cloneDeep)({...J,id:a}));return(0,h.jsx)(A.Z,{title:"Add new item",open:n,onOk:t,onCancel:i,children:(0,h.jsx)(z,{item:s,editMode:!0})})}function W(){const[e,n]=(0,c.useState)(!1),{newId:t}=x();return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(M.ZP,{block:!0,onClick:()=>{n(!0)},children:"Add New Item"}),e&&(0,h.jsx)(q,{isModalOpen:e,handleOk:()=>{n(!1)},handleCancel:()=>{n(!1)},newId:t},t)]})}var Q=t(5850);function V(e){let{showSearch:n,toggleSearch:t}=e;const{isDirty:i,save:a,items:s,listingType:o,setListingType:l,groups:r}=x(),u=(0,c.useMemo)((()=>{const e=(0,d.orderBy)(r.map((e=>{let{value:n}=e;return{label:(0,d.capitalize)(n),value:n}})),"label"),n=e.map((e=>{let{label:n,value:t}=e;return{label:"NOT ".concat(n),value:"!".concat(t)}}));return[...e,...n]}),[r]);return(0,h.jsxs)(B.Pd,{children:[(0,h.jsxs)(E.Z,{vertical:!0,gap:6,children:[(0,h.jsx)(M.ZP,{block:!0,danger:!0,type:"primary",disabled:!i,onClick:a,size:"large",children:"Save"}),(0,h.jsx)(R.o,{data:()=>function(e){return(0,Q.Tj)(Object.values(e).reduce(((e,n)=>{var t;return n.groups=(null!==(t=null===n||void 0===n?void 0:n.groups)&&void 0!==t?t:[]).sort(),0===n.groups.length?(delete n.groups,e[n.id]=n,e):(n.groups.includes("thing")&&1===n.name.en.split(" ").length&&1===n.name.pt.split(" ").length&&((n.groups.includes("evidence")||n.groups.includes("dream")||n.groups.includes("alien")||n.groups.includes("mesmice"))&&(n.groups=n.groups.filter((e=>"thing"!==e))),e[n.id]=n),e[n.id]=n,e)}),{}))}(s),fileName:"items.json",disabled:i,block:!0})]}),(0,h.jsx)(P.Z,{}),(0,h.jsx)(F.Do,{label:"Show Search",value:n,onChange:t}),(0,h.jsx)(F.zE,{label:"Group",value:o,onChange:e=>l(e),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...u,{label:"No groups",value:"!all"}]}),(0,h.jsx)(P.Z,{}),(0,h.jsx)(W,{})]})}var X=t(8178);function H(){const{items:e,isLoading:n,isSaving:t}=x(),[i,a]=(0,c.useState)(null);return(0,h.jsxs)(c.Fragment,{children:[(0,h.jsx)(o.Z.Title,{level:2,children:"Search for an item"}),(0,h.jsx)("div",{children:(0,h.jsx)(X.i,{items:e,isPending:n||t,onFinish:n=>a(e[n])})}),Boolean(i)&&(0,h.jsx)(b.Z,{direction:"vertical",className:"my-4",children:(0,h.jsx)(z,{item:i})},null===i||void 0===i?void 0:i.id),(0,h.jsx)(P.Z,{})]},"item-search-".concat(n))}var K=t(4562);function G(){const{isLoading:e,error:n,hasResponseData:t}=x(),[s,o]=(0,c.useState)(!0);return(0,h.jsx)(B.Xg,{title:"Items",subtitle:"Listing",children:(0,h.jsxs)(i.Z,{hasSider:!0,children:[(0,h.jsx)(K.p,{children:(0,h.jsx)(V,{showSearch:s,toggleSearch:()=>o((e=>!e))})}),(0,h.jsx)(i.Z.Content,{className:"content",children:(0,h.jsxs)(a.T,{isLoading:e,error:n,hasResponseData:t,children:[s&&!e&&(0,h.jsx)(H,{}),(0,h.jsx)(I,{})]})})]})})}const _=function(){return(0,h.jsx)(j,{children:(0,h.jsx)(G,{})})}}}]);
//# sourceMappingURL=Items.8eb8a03a.chunk.js.map