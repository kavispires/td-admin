"use strict";(self.webpackChunktdr=self.webpackChunktdr||[]).push([[8724],{6989:(e,s,n)=>{n.r(s),n.d(s,{default:()=>ae});var i=n(3990),t=n(1046),l=n(2128),a=n(4031),d=n(6106),c=n(914),r=n(731),o=n(1105),m=n(7765),u=n(4520),h=n(5225),p=n(5922),x=n(9228),j=n(2556),g=n(1310),v=n(2997),f=n(4766),k=n(8938),y=n(763),Z=n(2791),w=n(184);const b=(0,Z.createContext)({items:{},isLoading:!0,error:null,hasResponseData:!1,decksDict:{},decks:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1"}),N=e=>{var s;let{children:n}=e;const{queryParams:i}=(0,f.K)(),{data:t,isLoading:l,error:a,isSaving:d,save:c,addEntryToUpdate:r,entriesToUpdate:o,isDirty:m}=(0,k.i)({tdrResourceName:"items",firebaseDataCollectionName:"items"}),{decksDict:u,decks:h}=(0,Z.useMemo)((()=>{console.log("Recomputing item decks typeahead...");const e={},s={},n={},i=[];Object.values(t).forEach((t=>{var l;const a="".concat(t.name.en," (").concat(t.id,")"),d="".concat(t.name.pt," (").concat(t.id,")");s[t.name.en]?i.push(["".concat(t.name.en," (").concat(s[t.name.en],")"),a]):s[t.name.en]=t.id,n[t.name.pt]?i.push(["".concat(t.name.pt," (").concat(n[t.name.pt],")"),d]):n[t.name.pt]=t.id,null===t||void 0===t||null===(l=t.decks)||void 0===l||l.forEach((s=>{e[s]=s}))}));const l=(0,y.orderBy)(Object.keys(e)).map((e=>({value:e})));return i.length>0&&console.warn("Possible duplicated items",i),{decksDict:e,decks:l}}),[t,d,l]),p=null!==(s=i.get("deck"))&&void 0!==s?s:"all",x=(0,Z.useMemo)((()=>{const e=(0,y.orderBy)(Object.values(t),[e=>Number(e.id)],"asc");switch(p){case"all":return e;case"!all":return e.filter((e=>{var s,n;return null===(s=!(null!==e&&void 0!==e&&null!==(n=e.decks)&&void 0!==n&&n.length))||void 0===s||s}));case"nsfw":return e.filter((e=>e.nsfw));case"!nsfw":return e.filter((e=>!e.nsfw));default:return p.startsWith("!")?e.filter((e=>{var s;return!(null!==e&&void 0!==e&&null!==(s=e.decks)&&void 0!==s&&s.includes(p.slice(1)))})):e.filter((e=>{var s;return null===e||void 0===e||null===(s=e.decks)||void 0===s?void 0:s.includes(p)}))}}),[t,p]),j=(0,Z.useMemo)((()=>{var e;const s=(0,y.orderBy)(Object.keys(o),[e=>Number(e)],"asc"),n=null===(e=x[x.length-1])||void 0===e?void 0:e.id,i=(0,y.orderBy)([...s,n],[e=>Number(e)],"desc")[0];return String(Number(i)+1)}),[x,o]);return(0,w.jsx)(b.Provider,{value:{items:t,listing:x,isLoading:l,error:a,decksDict:u,decks:h,hasResponseData:x.length>0,isDirty:m,addItemToUpdate:r,isSaving:d,save:c,itemsToUpdate:o,newId:j},children:n})},C=()=>(0,Z.useContext)(b);var S=n(7134);var D=n(3834),T=n(4483),O=n(7747),z=n(8955),P=n(6324),I=n(2675);function E(e){let{item:s,editMode:n=!1,simplified:i}=e;const{decks:l}=C(),{isEditing:d,toggleEditMode:c,onEdit:x,isDirty:j,onModify:k,onReset:b,editableItem:N}=function(e){var s;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{addItemToUpdate:i,itemsToUpdate:t}=C(),[l,a]=(0,Z.useState)(n),[d,c]=(0,Z.useState)((0,y.cloneDeep)(e)),r=null!==(s=t[e.id])&&void 0!==s?s:e,o=e=>{const s={...(0,y.cloneDeep)(d),...e};Object.keys(e).includes("nsfw")&&!1===e.nsfw&&delete s.nsfw,c(s)},m=async()=>{i(d.id,d)},u=()=>{c((0,y.cloneDeep)(e)),a(!1)},h=JSON.stringify(r)!==JSON.stringify(d);return{isEditing:l,toggleEditMode:()=>a((e=>!e)),editableItem:d,onEdit:o,isDirty:h,onModify:m,onReset:u}}(s,n),P=(0,S._)(),{is:I}=(0,f.K)();return(0,w.jsxs)(r.Z,{title:(0,w.jsx)(a.Z.Text,{onClick:()=>P(s.id),children:s.id}),extra:(0,w.jsx)(_,{item:s}),style:{maxWidth:250},size:i?"small":"default",actions:i?void 0:j?[(0,w.jsx)(D.Z,{onClick:b},"reset"),(0,w.jsx)(T.Z,{onClick:k},"save")]:[(0,w.jsx)(O.Z,{onClick:c},"edit")],children:[(0,w.jsx)(v.ck,{id:s.id,width:i?75:125,title:"".concat(s.name.en," | ").concat(s.name.pt)}),(0,w.jsxs)(t.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,w.jsx)(o.Z,{prefix:(0,w.jsx)(g.H,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:d?"outlined":"borderless",size:"small",defaultValue:s.name.en,readOnly:!d,onChange:e=>x({name:{...N.name,en:e.target.value}})},"en-".concat(s.name.en)),(0,w.jsx)(o.Z,{prefix:(0,w.jsx)(g.H,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:d?"outlined":"borderless",size:"small",defaultValue:s.name.pt,readOnly:!d,onChange:e=>x({name:{...N.name,pt:e.target.value}})},"pt-".concat(s.name.pt)),!i&&(0,w.jsxs)(w.Fragment,{children:[!I("simplified")&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{children:(0,w.jsx)(m.Z,{mode:"multiple",style:{width:"100%"},placeholder:"Select a deck",defaultValue:s.decks,disabled:!d,options:l,variant:d?"outlined":"borderless",size:"small",onChange:e=>x({decks:e.sort()})},String(s.decks))}),(0,w.jsxs)(u.Z,{gap:6,children:[(0,w.jsx)(g.H,{language:"en",width:"1em"}),(0,w.jsx)(m.Z,{mode:"tags",style:{width:"100%"},placeholder:"Other names EN",defaultValue:s.aliasesEn,options:[],size:"small",onChange:e=>x({aliasesEn:e.sort()})})]}),(0,w.jsxs)(u.Z,{gap:6,children:[(0,w.jsx)(g.H,{language:"pt",width:"1em"}),(0,w.jsx)(m.Z,{mode:"tags",style:{width:"100%"},placeholder:"Other names PT",defaultValue:s.aliasesPt,options:[],size:"small",onChange:e=>x({aliasesPt:e.sort()})})]})]}),I("showVerifyThing")&&(0,w.jsx)("div",{children:(0,w.jsx)(M,{item:s})}),(d||s.nsfw)&&(0,w.jsx)("div",{children:(0,w.jsx)(h.Z.Item,{label:"nsfw",valuePropName:"checked",children:(0,w.jsx)(p.Z,{checked:s.nsfw,onChange:e=>x({nsfw:e}),size:"small",checkedChildren:(0,w.jsx)(z.Z,{style:{color:"hotpink"}}),disabled:!d})})})]})]})]})}const R=(0,y.memoize)((e=>{var s,n;const i=!(null===(s=e.decks)||void 0===s||!s.includes("thing")),t=!(null===(n=e.decks)||void 0===n||!n.includes("manufactured")),l=1===e.name.en.split(" ").length,a=1===e.name.pt.split(" ").length,d={en:i||l&&t,pt:i||a&&t};return d.pt||d.en?(0,w.jsxs)(w.Fragment,{children:[d.en&&(0,w.jsx)(g.H,{language:"en",width:"1em"}),d.pt&&(0,w.jsx)(g.H,{language:"pt",width:"1em"})]}):""})),M=e=>{let{item:s}=e;const n=R(s);return n?(0,w.jsxs)(u.Z,{gap:6,children:["Thing: ",n]}):(0,w.jsx)(w.Fragment,{})};function _(e){let{item:s}=e;const[n,i]=(0,I.Z)(!1),l=(0,S._)();return(0,w.jsx)(x.Z,{content:(0,w.jsxs)(t.Z,{direction:"vertical",children:[(0,w.jsx)(j.ZP,{size:"small",onClick:()=>l(JSON.stringify(s,null,2)),children:"Complete Item"}),(0,w.jsx)(j.ZP,{size:"small",onClick:()=>l(s.name.en),children:"EN Name"}),(0,w.jsx)(j.ZP,{size:"small",onClick:()=>l(s.name.pt),children:"PT Name"}),(0,w.jsx)(j.ZP,{size:"small",onClick:()=>l(JSON.stringify((e=>({id:e.id,type:"item",header:{title:{en:"Item",pt:"Item"},iconId:"2077"},metadata:{level:"basic",keyword:(0,y.snakeCase)(e.name.en).toUpperCase()},content:{itemId:e.id,caption:e.name}}))(s),null,2)),children:"Escape Room Item"})]}),title:"Copy",trigger:"click",open:n,onOpenChange:i,children:(0,w.jsx)(j.ZP,{type:"text",icon:(0,w.jsx)(P.Z,{})})})}var U=n(4290),F=n(2228);function V(){var e;const{queryParams:s}=(0,f.K)(),n=null!==(e=s.get("type"))&&void 0!==e?e:"all",{listing:i}=C(),{page:t,pagination:l}=(0,U.e)({data:i,resetter:n}),{is:r}=(0,f.K)(),o=r("simplified"),m=o?{xs:24,sm:12,md:8,lg:4,xl:3}:{xs:24,sm:24,md:12,lg:6,xl:4};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(a.Z.Title,{level:2,children:["Listing - ",(0,y.capitalize)(n)," items (",i.length,")"]}),(0,w.jsx)(F.N,{pagination:l,className:"full-width",children:(0,w.jsx)(d.Z,{gutter:[16,16],className:"my-4",children:t.map((e=>(0,w.jsx)(c.Z,{...m,children:(0,w.jsx)(E,{item:e,simplified:o})},e.id)))})})]})}var J=n(7128),L=n(6173),B=n(7018),H=n(1958),K=n(959);const W={id:"",name:{en:"",pt:""},groups:[]};function q(e){let{isModalOpen:s,handleOk:n,handleCancel:i,newId:t}=e;const[l]=(0,Z.useState)((0,y.cloneDeep)({...W,id:t}));return(0,w.jsx)(K.Z,{title:"Add new item",open:s,onOk:n,onCancel:i,children:(0,w.jsx)(E,{item:l,editMode:!0})})}function A(){const[e,s]=(0,Z.useState)(!1),{newId:n}=C();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(j.ZP,{block:!0,onClick:()=>{s(!0)},children:"Add New Item"}),e&&(0,w.jsx)(q,{isModalOpen:e,handleOk:()=>{s(!1)},handleCancel:()=>{s(!1)},newId:n},n)]})}var G=n(5850),Q=n(7340);function X(){var e;const{isDirty:s,save:n,items:i,decks:t,itemsToUpdate:l,isSaving:d}=C(),{queryParams:c,is:r,addParam:o}=(0,f.K)(),m=(0,Z.useMemo)((()=>{const e=(0,y.orderBy)(t.map((e=>{let{value:s}=e;return{label:(0,y.capitalize)(s),value:s}})),"label"),s=e.map((e=>{let{label:s,value:n}=e;return{label:"NOT ".concat(s),value:"!".concat(n)}}));return[...e,...s]}),[t]);return(0,w.jsxs)(H.Pd,{children:[(0,w.jsxs)(u.Z,{vertical:!0,gap:6,children:[(0,w.jsx)(Q.k,{isDirty:s,dirt:JSON.stringify(l),onSave:n,isSaving:d}),(0,w.jsx)(B.o,{data:()=>function(e){return(0,G.Tj)(Object.values(e).reduce(((e,s)=>{var n;return s.decks=(null!==(n=null===s||void 0===s?void 0:s.decks)&&void 0!==n?n:[]).sort(),0===s.decks.length?(delete s.decks,e[s.id]=s,e):(s.decks.includes("thing")&&1===s.name.en.split(" ").length&&1===s.name.pt.split(" ").length&&((s.decks.includes("evidence")||s.decks.includes("dream")||s.decks.includes("alien")||s.decks.includes("manufactured"))&&(s.decks=s.decks.filter((e=>"thing"!==e))),e[s.id]=s),e[s.id]=s,e)}),{}))}(i),fileName:"items.json",disabled:s,block:!0})]}),(0,w.jsx)(J.Z,{className:"my-4"}),(0,w.jsx)(a.Z.Text,{type:"secondary",children:"Tools"}),(0,w.jsx)(L.Do,{label:"Show Search",value:!r("hideSearch"),onChange:e=>o("hideSearch",e?"":"true",""),className:"full-width m-0"}),(0,w.jsx)(L.Do,{label:"Show Randomizer",value:r("showRandomizer"),onChange:e=>o("showRandomizer",e?"true":"",""),className:"full-width m-0"}),(0,w.jsx)(a.Z.Text,{type:"secondary",children:"Display"}),(0,w.jsx)(L.Do,{label:"Simplified UI",value:r("simplified"),onChange:e=>o("simplified",e?"true":""),className:"full-width m-0"}),(0,w.jsx)(L.Do,{label:"Thing Verifier",value:r("showVerifyThing"),onChange:e=>o("showVerifyThing",e?"true":""),className:"full-width m-0",disabled:r("simplified")}),(0,w.jsx)(L.Do,{label:"Other Names",value:r("showOtherNames"),onChange:e=>o("showOtherNames",e?"true":""),className:"full-width m-0",disabled:!0}),(0,w.jsx)(J.Z,{className:"my-4"}),(0,w.jsx)(L.zE,{label:"Deck",value:null!==(e=c.get("deck"))&&void 0!==e?e:"all",onChange:e=>o("deck",e,"all"),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...m,{label:"No decks",value:"!all"}]}),(0,w.jsx)(J.Z,{className:"my-4"}),(0,w.jsx)(A,{})]})}var Y=n(2326),$=n(1583),ee=n(5657);function se(){const{listing:e}=C(),[s,n]=(0,Z.useState)([]),i=(0,S._)(),[l,d]=(0,Z.useState)(5);return(0,w.jsxs)("div",{children:[(0,w.jsxs)(a.Z.Title,{level:2,children:["Randomized Sample"," ",(0,w.jsx)(j.ZP,{size:"small",icon:(0,w.jsx)(ee.Z,{}),onClick:()=>{const s=(0,y.chunk)((0,y.sampleSize)(e,18),3).map((e=>e.map((e=>e.name.en)).join(", "))).map(((e,s)=>"".concat(s+1,") ").concat(e))).join("\n");i(s)},children:"MJ"})]}),(0,w.jsxs)(u.Z,{gap:12,children:[(0,w.jsx)(h.Z.Item,{label:"Quantity"}),(0,w.jsx)("div",{children:(0,w.jsx)(Y.Z,{min:3,max:15,value:l,onChange:e=>d(Number(e)),style:{minWidth:"100px"}})}),(0,w.jsx)(j.ZP,{onClick:()=>{n((0,y.sampleSize)(e,l))},type:"primary",children:"Get Sample"}),(0,w.jsx)($.Z.Button,{menu:{items:[{label:"Copy IDs",key:"copy_ids"},{label:"Copy Names EN",key:"copy_names_en"},{label:"Copy Names PT",key:"copy_names_pt"}],onClick:e=>{let{key:n}=e;if("copy_ids"!==n)if("copy_names_en"!==n)if("copy_names_pt"!==n);else{const e=s.map((e=>e.name.pt)).join(", ");i(e)}else{const e=s.map((e=>e.name.en)).join(", ");i(e)}else{const e=s.map((e=>e.id));i(JSON.stringify(e))}}},disabled:0===s.length,onClick:()=>i(JSON.stringify(s,null,2)),icon:(0,w.jsx)(ee.Z,{}),children:"Copy"})]}),(0,w.jsx)(t.Z,{wrap:!0,className:"my-4",children:s.map((e=>(0,w.jsx)(E,{item:e,simplified:!0},e.id)))}),(0,w.jsx)(J.Z,{})]})}var ne=n(8178);function ie(){const{items:e,isLoading:s,isSaving:n}=C(),[i,l]=(0,Z.useState)(null);return(0,w.jsxs)(Z.Fragment,{children:[(0,w.jsx)(a.Z.Title,{level:2,children:"Search for an item"}),(0,w.jsx)("div",{children:(0,w.jsx)(ne.i,{items:e,isPending:s||n,onFinish:s=>l(e[s])})}),Boolean(i)&&(0,w.jsx)(t.Z,{direction:"vertical",className:"my-4",children:(0,w.jsx)(E,{item:i})},null===i||void 0===i?void 0:i.id),(0,w.jsx)(J.Z,{})]},"item-search-".concat(s))}var te=n(4562);function le(){const{isLoading:e,error:s,hasResponseData:n}=C(),{is:a}=(0,f.K)();return(0,w.jsx)(H.Xg,{title:"Items",subtitle:"Listing",children:(0,w.jsxs)(i.Z,{hasSider:!0,children:[(0,w.jsx)(te.p,{children:(0,w.jsx)(X,{})}),(0,w.jsx)(i.Z.Content,{className:"content",children:(0,w.jsxs)(l.T,{isLoading:e,error:s,hasResponseData:n,children:[!e&&(0,w.jsxs)(t.Z,{size:"large",children:[!a("hideSearch")&&(0,w.jsx)(ie,{}),a("showRandomizer")&&(0,w.jsx)(se,{})]}),(0,w.jsx)(V,{})]})})]})})}const ae=function(){return(0,w.jsx)(N,{children:(0,w.jsx)(le,{})})}}}]);
//# sourceMappingURL=Items.92ee467d.chunk.js.map