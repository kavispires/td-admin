"use strict";(self.webpackChunktdr=self.webpackChunktdr||[]).push([[404],{7018:(e,t,a)=>{a.d(t,{o:()=>r});var s=a(2556),n=a(5850),i=a(184);function r(e){let{data:t,fileName:a,loading:r,...l}=e;return(0,i.jsx)(s.ZP,{onClick:()=>(0,n.ZN)("function"===typeof t?t():t,a),loading:r,...l,children:"Download JSON"})}},8178:(e,t,a)=>{a.d(t,{i:()=>o});var s=a(5),n=a(1692),i=a(763),r=a(2791),l=a(184);function o(e){let{items:t,isPending:a,style:o,size:u,placeholder:c,allowClear:d,onFinish:m,...g}=e;const{namesDict:p,options:h}=(0,r.useMemo)((()=>{console.log("Recomputing item names typeahead...");const e=Object.values(t).reduce(((e,t)=>{const a="".concat(t.name.en," (").concat(t.id,")"),s="".concat(t.name.pt," (").concat(t.id,")");return e[a]=t.id,e[s]=t.id,e}),{});return{namesDict:e,options:(0,i.orderBy)(Object.keys(e),[e=>e.toLowerCase()]).map((e=>({value:e})))}}),[t,a]),[x,b]=(0,r.useState)([]);return(0,l.jsx)(s.Z,{options:h,style:{width:250,...o},allowClear:null===d||void 0===d||d,placeholder:null!==c&&void 0!==c?c:"Search by name or id...",filterOption:(e,t)=>{var a;return-1!==String(null!==(a=null===t||void 0===t?void 0:t.value)&&void 0!==a?a:"").toUpperCase().indexOf(null===e||void 0===e?void 0:e.toUpperCase())},onSearch:e=>{b(h.filter((t=>{var a;return-1!==String(null!==(a=null===t||void 0===t?void 0:t.value)&&void 0!==a?a:"").toUpperCase().indexOf(null===e||void 0===e?void 0:e.toUpperCase())})))},notFoundContent:"No items found",onSelect:e=>{void 0!==p[e]&&m(p[e])},...g,children:(0,l.jsx)(n.Z,{onPressEnter:()=>{if(x.length>0){const e=x[0].value;void 0!==p[e]&&m(p[e])}}})})}},8027:(e,t,a)=>{a.d(t,{A:()=>l,X:()=>o});var s=a(2481),n=a(5860),i=a(6807),r=a(5850);function l(e,t){return async()=>{var a;console.log("%cQuerying ".concat(e,"/").concat(t," from firebase: ").concat((0,r.xE)()),"color: #f0f");const i=(0,s.JU)(n.RZ,"".concat(e,"/").concat(t));return null!==(a=(await(0,s.QT)(i)).data())&&void 0!==a?a:{}}}function o(e,t,a){return(0,i.a)({queryKey:["firebase",e,t],queryFn:l(e,t),...a})}},5529:(e,t,a)=>{a.d(t,{N:()=>r});var s=a(763),n=a(6807),i=a(2606);function r(e){var t;let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{getUrl:r}=(0,i.n)("tdr"),l=(0,n.a)({queryKey:[e],queryFn:async()=>{const t=await fetch(r("".concat(e,".json")));return await t.json()},enabled:a}),o=!(0,s.isEmpty)(l.data);return{...l,data:null!==(t=l.data)&&void 0!==t?t:{},hasResponseData:o}}},2233:(e,t,a)=>{a.d(t,{B:()=>l});var s=a(2481),n=a(5860),i=a(3418);function r(e,t,a){console.log("%cUpdating ".concat(e,"/").concat(t," from firebase"),"color: #f00");const i=(0,s.JU)(n.RZ,"".concat(e,"/").concat(t));return(0,s.r7)(i,a)}function l(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,i.D)({mutationFn:async a=>r(e,t,a),...a})}},9927:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ke});var s=a(3990),n=a(2128),i=a(1087);function r(){var e;const[t,a]=(0,i.lr)();return{view:null!==(e=t.get("view"))&&void 0!==e?e:"classifier",setView:e=>a({view:e}),addQueryParam:(e,s)=>{t.set(e,"".concat(s)),a(t)},removeQueryParam:e=>{t.delete(e),a(t)},searchParams:t}}var l=a(3477),o=a(8914),u=a(2556),c=a(7305),d=a(4520),m=a(7128),g=a(1046),p=a(4747),h=a(763),x=a(2791),b=a(5850),j=a(6403),v=a(8027),y=a(5529),f=a(2233);const Z={};const w=e=>Object.keys(e).reduce(((t,a)=>(t[a]=JSON.parse(e[a]),t)),{}),N=e=>Object.keys(e).reduce(((t,a)=>(t[a]=JSON.stringify(e[a]),t)),{});var I=a(184);const C=(0,x.createContext)({getItem:()=>(0,b.VL)(),getItemAttributeValues:()=>(0,b.dK)(),isLoading:!0,error:null,hasResponseData:!1,isDirty:!1,jumpToItem:()=>{},activeItem:(0,b.VL)(),itemAttributeValues:(0,b.dK)(),onAttributeChange:()=>{},isSaving:!1,save:()=>{},attributesList:[],availableItemIds:[],addAttributesToUpdate:()=>{},addMultipleAttributesToUpdate:()=>{},prepareItemsAttributesFileForDownload:()=>({}),attributes:{}}),A=e=>{let{children:t}=e;const{getItem:a,getItemAttributeValues:s,availableItemIds:n,isLoading:i,error:r,isSaving:l,save:o,addAttributesToUpdate:u,isDirty:c,attributes:d,addMultipleAttributesToUpdate:m}=function(){var e;const{notification:t,message:a}=p.Z.useApp(),s=(0,j.NL)(),n=(0,y.N)("items"),i=(0,y.N)("items-attributes"),r=(0,y.N)("items-attribute-values"),l=(0,v.X)("data","itemsAttributeValues",{select:w}),[o,u]=(0,x.useState)({}),c=(0,f.B)("data","itemsAttributeValues",{onSuccess:()=>{t.success({message:"itemsAttributeValues updated"}),s.refetchQueries(["firebase","data","itemsAttributeValues"]),u({})},onError:e=>{t.error({message:"itemsAttributeValues update failed",description:e.message})}}),d=(0,x.useMemo)((()=>{var e,t;return{...null!==(e=r.data)&&void 0!==e?e:{},...null!==(t=l.data)&&void 0!==t?t:{}}}),[r.data,l.data]),m=!(0,h.isEmpty)(o),g=l.data;return{availableItemIds:(0,x.useMemo)((()=>{var e;const t=null!==(e=n.data)&&void 0!==e?e:{};return(0,h.orderBy)(Object.keys(t).filter((e=>{var a,s;return(null!==(a=null===(s=t[e])||void 0===s?void 0:s.groups)&&void 0!==a?a:[]).includes("alien")})),(e=>Number(e)),"asc")}),[n.data]),getItem:e=>{var t,s;return null!==(t=null!==(s=n.data)&&void 0!==s?s:{})&&void 0!==t&&t[e]?n.data[e]:(e&&a.info("Item ".concat(e," not found in TDR. Creating a new item...")),(0,b.VL)({id:e}))},getItemAttributeValues:e=>{var t,a,s;const n=null!==(t=null===d||void 0===d?void 0:d[e])&&void 0!==t?t:{},i=null!==(a=o[e])&&void 0!==a?a:{};return(0,h.isEmpty)(n)&&(0,h.isEmpty)(i)?(Z[e]=(0,b.dK)({id:e}),Z[e]):(0,h.merge)(null!==(s=null===Z||void 0===Z?void 0:Z[e])&&void 0!==s?s:{},n,i)},attributes:null!==(e=i.data)&&void 0!==e?e:{},isLoading:n.isLoading||i.isLoading||r.isLoading||l.isLoading,error:n.error||i.error||r.error||l.error,firebaseData:g,isSaving:c.isLoading,save:()=>{c.mutate(N({...g,...o}))},addAttributesToUpdate:(e,t)=>{u((a=>({...a,[e]:{...t,updatedAt:Date.now()}})))},addMultipleAttributesToUpdate:e=>{u((t=>({...t,...(0,h.mapKeys)(e.map((e=>({...e,updatedAt:Date.now()}))),"id")})))},attributesToUpdate:o,isDirty:m}}(),{message:g}=p.Z.useApp(),[A,S]=(0,x.useState)((0,h.random)(0,n.length-1)),T=a(n[A]),P=s(T.id),U=(0,x.useMemo)((()=>(0,h.orderBy)(Object.values(d),"name.en","asc")),[d]);return(0,I.jsx)(C.Provider,{value:{getItem:a,getItemAttributeValues:s,availableItemIds:n,isLoading:i,error:r,hasResponseData:n.length>0&&!(0,h.isEmpty)(d),isDirty:c,itemAttributeValues:P,jumpToItem:(e,t)=>{if("next"===e&&S((e=>(e+1)%n.length)),"previous"===e&&S((e=>(e-1+n.length)%n.length)),"random"===e&&S((0,h.random)(0,n.length-1)),"first"===e&&S(0),"last"===e&&S(n.length-1),"next10"===e&&S((e=>(e+10)%n.length)),"previous10"===e&&S((e=>(e-10+n.length)%n.length)),"goTo"===e&&void 0!==t){const e=n.indexOf(t);-1!==e?S(e):g.error("Item ".concat(t," is not available for attribution."))}},activeItem:T,onAttributeChange:(e,t)=>{u(T.id,{...P,attributes:{...P.attributes,[e]:t}})},isSaving:l,save:o,attributes:d,attributesList:U,addAttributesToUpdate:u,addMultipleAttributesToUpdate:m,prepareItemsAttributesFileForDownload:()=>(0,b.Tj)(n.reduce(((e,t)=>{const a=s(t);return(0,h.isEmpty)(a.attributes)||(Object.keys(a.attributes).length===U.length?a.complete=!0:delete a.complete,e[a.id]=a),e}),{}))},children:t})},S=()=>(0,x.useContext)(C);var T=a(4424),P=a(1431),U=a(8624),L=a(7557),E=a(6591);const k=[{label:"Opposite",value:E.NL.OPPOSITE},{label:"Unrelated",value:E.NL.UNRELATED},{label:"Unclear",value:E.NL.UNCLEAR},{label:"Related",value:E.NL.RELATED},{label:"Deterministic",value:E.NL.DETERMINISTIC}],D=[{label:"Opposite",value:E.NL.OPPOSITE},{label:"Unrelated",value:E.NL.UNRELATED},{label:"Unclear",value:E.NL.UNCLEAR},{label:"Related",value:E.NL.RELATED},{label:"Deterministic",value:E.NL.DETERMINISTIC,disabled:!0}];function V(e){let{attribute:t,value:a,onChange:s,onlyButtons:n}=e;return t?n?(0,I.jsx)(T.ZP.Group,{options:t.limited?D:k,onChange:e=>{let{target:{value:a}}=e;return s(t.id,a)},value:a,optionType:"button",buttonStyle:"solid"}):(0,I.jsxs)("div",{className:"attribute-button-container__row",children:[(0,I.jsxs)("span",{className:"attribute-button-container__label",children:[t.name.en," ",(0,I.jsx)(P.Z,{title:t.description.en,children:(0,I.jsx)(U.Z,{})})]}),(0,I.jsx)(T.ZP.Group,{options:t.limited?D:k,onChange:e=>{let{target:{value:a}}=e;return s(t.id,a)},value:a,optionType:"button",buttonStyle:"solid"}),(0,I.jsx)("span",{children:(0,I.jsx)(L.Z,{style:{color:a&&a>7?"green":"transparent"}})})]},t.id):(0,I.jsx)(I.Fragment,{})}var O=a(3733),M=a(6173),z=a(6020);function R(e){let{itemAttributeValues:t,attributes:a}=e;const{searchParams:s,addQueryParam:n}=r(),i="true"===s.get("showUnclear"),l="true"===s.get("showUnrelated"),o=(0,x.useMemo)((()=>(0,b.tt)((0,b.Mg)(t,a),i,l)),[t,a,i,l]),u="true"===s.get("signs")?F:B;return(0,I.jsxs)(d.Z,{gap:6,vertical:!0,children:[(0,I.jsx)(M.Do,{label:"Show Unrelated",value:"true"===s.get("showUnrelated"),onChange:e=>n("showUnrelated",e?"true":""),className:"full-width m-0"}),(0,I.jsx)(M.Do,{label:"Show Unclear",value:"true"===s.get("showUnclear"),onChange:e=>n("showUnclear",e?"true":""),className:"full-width m-0"}),(0,I.jsx)(M.Do,{label:"Alien Sings",value:"true"===s.get("signs"),onChange:e=>n("signs",e?"true":""),className:"full-width m-0"}),(0,I.jsx)(d.Z,{gap:6,wrap:"wrap",className:"item-attribute-value-statement",children:o.map(((e,t,s)=>(0,I.jsx)(u,{keyVariant:e,attributes:a,firstElement:0===t,lastElement:t===s.length-1},e)))})]})}function F(e){let{keyVariant:t,attributes:a,withText:s}=e;const{key:n,className:i,text:r}=(0,b.sB)(t);return(0,I.jsxs)(d.Z,{vertical:!0,align:"center",children:[(0,I.jsx)(z.o$,{width:50,id:a[n].spriteId,className:(0,O.Z)("item-attribute-alien-sign","item-attribute-alien-sign--".concat(i))}),s&&(0,I.jsxs)(d.Z,{wrap:"wrap",justify:"center",align:"center",style:{maxWidth:50,textAlign:"center",wordBreak:"break-word"},children:[r," ",a[n].name.en.toLowerCase()]})]})}function B(e){let{keyVariant:t,attributes:a,firstElement:s,lastElement:n}=e;const{key:i,text:r}=(0,b.sB)(t),l=s?"It's ":"",o=n?".":", ";return(0,I.jsxs)(I.Fragment,{children:[l,r," ",a[i].name.en.toLowerCase(),o]})}var G=a(1532),Q=a(4587),K=a(952);function _(e){let{label:t,children:a}=e;return(0,I.jsxs)(o.Z.Text,{children:[t," ",(0,I.jsx)(K.Z,{children:a})]})}function J(e){let{attributesList:t,itemAttributeValues:a}=e;const{completion:s,isDeterministic:n,value:i,isOpposing:r,relevancy:l}=(0,x.useMemo)((()=>{const e=t.length,s=Object.keys(a.attributes).length,n=Math.floor(s/e*100);let i=!1,r=!1,l=0;const o=Object.values(a.attributes).reduce(((e,t)=>t<=0?(t===E.NL.UNCLEAR&&(l+=1),t===E.NL.OPPOSITE&&(r=!0),e):(t===E.NL.DETERMINISTIC&&(i=!0),e+t)),0),u=Math.floor((s-l)/e*100);return{completion:n,isDeterministic:i,value:o,isOpposing:r,relevancy:u}}),[t,a.attributes]);return(0,I.jsxs)("div",{children:[(0,I.jsx)(o.Z.Text,{strong:!0,children:"Completion"}),(0,I.jsx)(Q.Z,{percent:s,size:"small"}),(0,I.jsx)(o.Z.Text,{strong:!0,children:"Stats"}),(0,I.jsxs)(d.Z,{vertical:!0,children:[(0,I.jsx)(_,{label:"Deterministic",children:n?(0,I.jsx)(L.Z,{style:{color:"green"}}):(0,I.jsx)(G.Z,{style:{color:"red"}})}),(0,I.jsx)(_,{label:"Opposing",children:r?(0,I.jsx)(L.Z,{style:{color:"CornflowerBlue"}}):(0,I.jsx)(G.Z,{style:{color:"grey"}})}),(0,I.jsx)(_,{label:"Value",children:i}),(0,I.jsxs)(_,{label:"Reliability",children:[l,"%"]})]})]})}var q=a(1692),X=a(1310),Y=a(8955),H=a(5458);function W(e){let{item:t,width:a,className:s}=e;return(0,I.jsx)(z.ck,{id:t.id,width:a,title:"".concat(t.name.en," | ").concat(t.name.pt),className:s})}function $(e){let{item:t}=e;return(0,I.jsx)("span",{children:(0,I.jsx)(q.Z,{prefix:t.nsfw?(0,I.jsx)(Y.Z,{style:{color:"hotPink"}}):(0,I.jsx)(H.Z,{}),placeholder:"Id",variant:"borderless",size:"small",value:t.id,readOnly:!0,style:{width:"8ch"}})})}function ee(e){let{item:t,language:a}=e;return(0,I.jsx)(q.Z,{prefix:(0,I.jsx)(X.H,{language:a,width:"1em"}),placeholder:"Name in ".concat(a.toUpperCase()),variant:"borderless",size:"small",value:t.name[a],readOnly:!0})}function te(e){let{item:t}=e;const[,a]=(0,i.lr)();return(0,I.jsx)("span",{children:(0,I.jsx)(u.ZP,{size:"small",shape:"round",onClick:()=>{a({itemId:t.id,view:"classifier"})},children:"Go to"})})}function ae(){const{activeItem:e,attributesList:t,itemAttributeValues:a,onAttributeChange:s,jumpToItem:n,attributes:i}=S(),{searchParams:p,removeQueryParam:h}=r(),b=p.get("itemId");(0,x.useEffect)((()=>{b&&(h("itemId"),n("goTo",b))}),[b,n,h]);const j="unset"===p.get("scope"),v=(0,x.useMemo)((()=>j?t.filter((e=>!a.attributes[e.id])):t),[j,e.id]);return e?(0,I.jsx)(l.Z,{children:(0,I.jsxs)("div",{className:"item-attribution-card",children:[(0,I.jsx)(c.Z,{offsetTop:120,className:"item-attribution-card__item",children:(0,I.jsxs)(d.Z,{vertical:!0,gap:6,children:[(0,I.jsx)(W,{item:e,width:150}),(0,I.jsx)($,{item:e}),(0,I.jsx)(ee,{item:e,language:"en"}),(0,I.jsx)(ee,{item:e,language:"pt"}),(0,I.jsx)(m.Z,{className:"my-2"}),(0,I.jsx)(J,{attributesList:t,itemAttributeValues:a}),(0,I.jsx)(m.Z,{className:"my-2"}),(0,I.jsx)(o.Z.Text,{type:"secondary",children:(0,I.jsx)(R,{itemAttributeValues:a,attributes:i})})]})}),(0,I.jsx)(g.Z,{size:"small",direction:"vertical",className:"my-4 attribute-button-container",wrap:!0,children:v.map(((e,t)=>(0,I.jsx)(V,{attribute:e,value:a.attributes[e.id],onChange:s},e.id)))})]},"".concat(e.id))}):(0,I.jsx)(l.Z,{children:(0,I.jsxs)(o.Z.Text,{type:"secondary",children:["No item selected."," ",(0,I.jsx)(u.ZP,{size:"small",type:"primary",onClick:()=>n("random"),children:"Random Item"})]})})}var se=a(9228),ne=a(9515),ie=a(9617),re=a(6864),le=a(1938),oe=a(5542),ue=a(6588),ce=a(8178);function de(){const{jumpToItem:e}=S();return(0,I.jsxs)(u.ZP.Group,{className:"my-4",children:[(0,I.jsx)(u.ZP,{onClick:()=>e("first"),icon:(0,I.jsx)(ne.Z,{}),children:"First"}),(0,I.jsx)(u.ZP,{onClick:()=>e("previous10"),icon:(0,I.jsx)(ie.Z,{}),children:"Previous 10"}),(0,I.jsx)(u.ZP,{onClick:()=>e("previous"),icon:(0,I.jsx)(re.Z,{}),children:"Previous"}),(0,I.jsxs)(u.ZP,{onClick:()=>e("next"),children:["Next ",(0,I.jsx)(le.Z,{})]}),(0,I.jsxs)(u.ZP,{onClick:()=>e("next10"),children:["Next 10 ",(0,I.jsx)(oe.Z,{})]}),(0,I.jsxs)(u.ZP,{onClick:()=>e("last"),children:["Last ",(0,I.jsx)(ue.Z,{})]}),(0,I.jsx)(se.Z,{content:(0,I.jsx)(me,{}),title:"Title",children:(0,I.jsx)(u.ZP,{children:"Go To"})})]})}function me(){var e;const t=(0,y.N)("items"),{jumpToItem:a}=S();return(0,I.jsx)(ce.i,{items:null!==(e=t.data)&&void 0!==e?e:{},isPending:!1,onFinish:e=>a("goTo",e)})}var ge=a(4664);function pe(){const{getItem:e,getItemAttributeValues:t}=S(),{sampleIds:a,attribute:s,onGetSample:n,updateAttributeValue:i}=function(){const{attributesList:e,availableItemIds:t,addAttributesToUpdate:a,getItemAttributeValues:s}=S(),{searchParams:n}=r(),[i,l]=(0,x.useState)([]),[o,u]=(0,x.useState)();return{sampleIds:i,attribute:o,onGetSample:()=>{var a,i,r,o;const c=null!==(a=null!==(i=n.get("attribute"))&&void 0!==i?i:null===(r=(0,h.sample)(e))||void 0===r?void 0:r.id)&&void 0!==a?a:"ali",d=null!==(o=e.find((e=>e.id===c)))&&void 0!==o?o:(0,h.sample)(e),m=Number(n.get("size"))||9,g=[],p=(0,h.shuffle)(t);for(let e=0;e<p.length&&g.length!==m;e++){const t=p[e];s(t).attributes[c]||g.push(t)}u(d),l(g)},updateAttributeValue:(e,t,n)=>{const i=s(e);a(e,{...i,attributes:{...i.attributes,[t]:n}})}}}();return(0,h.isEmpty)(a)&&(0,h.isEmpty)(s)?(0,I.jsx)(l.Z,{className:"my-4",children:(0,I.jsxs)(o.Z.Text,{type:"secondary",children:["No sample has been generated. Tweak options and"," ",(0,I.jsx)(u.ZP,{size:"small",type:"primary",onClick:n,children:"Get Sample"})]})}):(0,I.jsx)(l.Z,{className:"my-4",title:(0,I.jsx)(o.Z.Text,{children:null===s||void 0===s?void 0:s.name.en}),actions:[(0,I.jsx)(u.ZP,{type:"primary",block:!0,ghost:!0,onClick:n,children:"Get New Sample"})],extra:(0,I.jsx)(u.ZP,{type:"primary",size:"small",onClick:n,children:"Get New Sample"}),children:(0,I.jsx)(d.Z,{vertical:!0,gap:6,children:a.map((a=>{const n=t(a),r=e(a);return(0,I.jsxs)(x.Fragment,{children:[(0,I.jsxs)(d.Z,{gap:6,children:[(0,I.jsx)(W,{item:r,width:75}),(0,I.jsxs)(d.Z,{vertical:!0,gap:6,children:[(0,I.jsxs)(d.Z,{gap:6,children:[(0,I.jsx)($,{item:r}),(0,I.jsx)(te,{item:r})]}),(0,I.jsx)(ee,{item:r,language:"en"}),(0,I.jsx)(ee,{item:r,language:"pt"})]}),(0,I.jsx)(V,{attribute:s,value:n.attributes[s.id],onChange:(e,t)=>i(r.id,e,t)})]}),(0,I.jsx)(m.Z,{className:"my-1"})]},"".concat(a,"-").concat(n.updatedAt))}))})})}var he=a(7742),xe=a(1082),be=a(9416);function je(e){const[t,a]=(0,x.useState)(!1),s=()=>{a(window.pageYOffset>300)};return(0,x.useEffect)((()=>(window.addEventListener("scroll",s),()=>{window.removeEventListener("scroll",s)})),[]),(0,I.jsx)(u.ZP,{className:"go-to-top-button ".concat(t?"visible":""),onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},icon:(0,I.jsx)(be.Z,{}),...e,children:"Go to Top"})}var ve=a(1503);function ye(){const{getItem:e,getItemAttributeValues:t}=S(),{attribute:a,pageIds:s,group:n,updateAttributeValue:i,updatePageItemsAsUnrelated:c,pagination:m}=function(){var e,t,a,s;const{attributesList:n,addAttributesToUpdate:i,getItemAttributeValues:l,availableItemIds:o,addMultipleAttributesToUpdate:u}=S(),{searchParams:c,addQueryParam:d}=r(),m=null!==(e=c.get("attribute"))&&void 0!==e?e:"ali",g=null!==(t=c.get("scope"))&&void 0!==t?t:"unset",p=null!==(a=c.get("page"))&&void 0!==a?a:"1",b=null!==(s=c.get("pageSize"))&&void 0!==s?s:"12",[j,v]=(0,x.useState)("ali"),[y,f]=(0,x.useState)("unset"),Z=(0,x.useMemo)((()=>{const e=o.map((e=>l(e))),t="unset"===g?void 0:E.NL[g.toUpperCase()],a=e.filter((e=>{var a;return(null===(a=e.attributes)||void 0===a?void 0:a[m])===t})).map((e=>e.id));return(0,h.orderBy)(a,[e=>{var t;return null===(t=l(e))||void 0===t?void 0:t.updatedAt},e=>Number(e)],["desc","asc"])}),[m,g]),w=(0,x.useMemo)((()=>{if(j!==m||y!==g)return v(m),f(g),d("page","1"),Z.slice(0,Number(b));const e=(Number(p)-1)*Number(b),t=e+Number(b);return Z.slice(e,t)}),[p,b,Z]),N=n.find((e=>e.id===m));return{group:Z,pageIds:w,attribute:N,updateAttributeValue:(e,t,a)=>{const s=l(e);i(e,{...s,attributes:{...s.attributes,[t]:a}})},updatePageItemsAsUnrelated:()=>{u(w.map((e=>{const t=l(e);return t.attributes[m]||(t.attributes[m]=E.NL.UNRELATED),t})))},pagination:{total:Z.length,current:Number(p),pageSize:Number(b),onChange:e=>d("page",String(e)),onShowSizeChange:(e,t)=>d("pageSize",String(t)),pageSizeOptions:[12,24,48,96]}}}(),{searchParams:g}=r(),p=(0,ve.Z)("(max-width: 1024px)");if((0,h.isEmpty)(a))return(0,I.jsx)(l.Z,{className:"my-4",children:(0,I.jsx)(o.Z.Text,{type:"secondary",children:"No group attribute has been selected."})});const b=(0,I.jsx)(he.Z,{onChange:m.onChange,current:m.current,total:m.total,pageSizeOptions:m.pageSizeOptions,pageSize:m.pageSize,onShowSizeChange:m.onShowSizeChange},"pagination"),j=("unset"===g.get("scope")||!g.get("scope"))&&(0,I.jsx)(xe.Z,{title:"Are you sure everything is unrelated to ".concat(a.name.en,"?"),onConfirm:c,children:(0,I.jsx)(u.ZP,{type:"primary",danger:!0,disabled:0===s.length,children:"Unrelate Unset Items on Page"})},"unrelate-button");return(0,I.jsx)(l.Z,{className:"my-4",title:(0,I.jsxs)(o.Z.Text,{children:[null===a||void 0===a?void 0:a.name.en," (",n.length,")"]}),extra:b,actions:[j,(0,I.jsx)(je,{},"go-to-top"),b].filter(Boolean),children:s.map((s=>{const n=t(s),r=e(s);return(0,I.jsx)(l.Z.Grid,{style:{width:p?"50%":"25%"},children:(0,I.jsxs)(d.Z,{gap:6,children:[(0,I.jsxs)(d.Z,{vertical:!0,gap:6,children:[(0,I.jsx)(W,{item:r,width:75}),(0,I.jsx)($,{item:r}),(0,I.jsx)(te,{item:r}),(0,I.jsx)(ee,{item:r,language:"en"}),(0,I.jsx)(ee,{item:r,language:"pt"})]}),(0,I.jsx)(V,{attribute:a,value:n.attributes[a.id],onlyButtons:!0,onChange:(e,t)=>i(r.id,e,t)})]})},"".concat(s,"-").concat(n.updatedAt))}))})}var fe=a(6402);function Ze(){const{attributes:e}=S(),{itemMessages:t,grouping:a}=function(){const{attributes:e,getItemAttributeValues:t,availableItemIds:a,getItem:s,isLoading:n}=S(),{searchParams:i}=r(),l="true"===i.get("showComplete"),o="true"===i.get("showUnclear"),u="true"===i.get("showUnrelated"),{itemMessages:c,itemMessagesDict:d,grouping:m}=(0,x.useMemo)((()=>{if(n)return{itemMessages:[],itemMessagesDict:{},grouping:{}};console.log("useItemsComparator");const i=(0,h.orderBy)(a.map((a=>{const n=t(a),i=(0,b.Mg)(n,e);return{item:s(a),itemAttributesValues:n,message:(0,b.tt)(i,o,u),fullMessage:i}})).filter((e=>{let{itemAttributesValues:t}=e;return!l||t.complete})),["message"],["asc"]),r=i.reduce(((e,t)=>{let{message:a,item:{id:s}}=t;const n=a.join(" ");return void 0===e[n]&&(e[n]=[]),e[n].push(s),e}),{}),c=Object.values(r).filter((e=>e.length>1));return c.length>0&&console.log("More than one",c),console.log(r),{itemMessages:i,itemMessagesDict:(0,h.keyBy)(i,"item.id"),grouping:r}}),[e,a,t,s,n,l,o,u]);return{itemMessages:c,itemMessagesDict:d,grouping:m}}(),s=[{title:"Item Id",dataIndex:"item",key:"id",render:e=>(0,I.jsxs)("div",{children:[(0,I.jsx)($,{item:e}),(0,I.jsx)(te,{item:e})]}),sorter:(e,t)=>Number(e.item.id)-Number(t.item.id)},{title:"Sprite",dataIndex:"item",key:"sprite",render:e=>(0,I.jsx)(W,{item:e,width:75})},{title:"Name",dataIndex:"item",key:"name",render:e=>(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(ee,{item:e,language:"en"}),(0,I.jsx)(ee,{item:e,language:"pt"})]}),sorter:(e,t)=>e.item.name.en.localeCompare(t.item.name.en)},{title:"Address",dataIndex:"message",key:"message",render:(t,a)=>{let{item:s}=a;return(0,I.jsx)(d.Z,{gap:6,children:t.map(((t,a,n)=>(0,I.jsx)(F,{keyVariant:t,attributes:e,firstElement:0===a,lastElement:a===n.length-1,withText:!0},"".concat(t,"-").concat(s.id))))})},sorter:(e,t)=>e.message.join(" ").localeCompare(t.message.join(" "))},{title:"Complete",dataIndex:"itemAttributesValues",key:"complete",render:e=>e.complete?"Yes":"No"},{title:"Identical",dataIndex:"message",key:"identical",render:e=>{var t;const s=null!==(t=a[e.join(" ")])&&void 0!==t?t:[];return(0,I.jsx)(I.Fragment,{children:s.length>1?s.length:""})},sorter:(e,t)=>{var s,n;const i=null!==(s=a[e.message.join(" ")])&&void 0!==s?s:[];return(null!==(n=a[t.message.join(" ")])&&void 0!==n?n:[]).length-i.length}}];return(0,I.jsxs)("div",{className:"my-4",children:[(0,I.jsx)(o.Z.Title,{level:5,children:"Item Comparator"}),(0,I.jsx)(fe.Z,{dataSource:t,columns:s})]})}function we(){const{view:e}=r();return"classifier"===e?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(de,{}),(0,I.jsx)(ae,{}),(0,I.jsx)(d.Z,{justify:"flex-end",className:"my-4",children:(0,I.jsx)(je,{})})]}):"sampler"===e?(0,I.jsx)(pe,{}):"grouping"===e?(0,I.jsx)(ye,{}):"comparator"===e?(0,I.jsx)(Ze,{}):(0,I.jsx)(ge.Z,{className:"my-10",description:"Unknown view has been selected"})}var Ne=a(7018),Ie=a(1958);function Ce(){const{getItemAttributeValues:e,availableItemIds:t,attributesList:a}=S(),{total:s,complete:n,completionPercentage:i,hasDataCount:r,initiatedPercentage:l,progress:u,progressTotal:c,currentProgress:g}=(0,x.useMemo)((()=>{const s=t.length;let n=0,i=0,r=0;t.map((t=>e(t))).forEach((e=>{let{complete:t,attributes:s}=e;(0,h.isEmpty)(s)||(n+=1),Object.values(s).length===a.length&&(i+=1),r+=Object.values(s).length}));const l=Object.values(a).length*t.length;return{total:s,complete:i,completionPercentage:s>0?(i/s*100).toFixed(1):0,hasDataCount:n,initiatedPercentage:s>0?Math.floor(n/s*100):0,progress:(r/l*100).toFixed(1),currentProgress:r,progressTotal:l}}),[a,t,e]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(d.Z,{vertical:!0,children:[(0,I.jsx)(o.Z.Text,{strong:!0,className:"mb-2",children:"Items Stats"}),(0,I.jsx)(_,{label:"Total",children:s}),(0,I.jsxs)(_,{label:"Complete",children:[n," (",i,"%)"]}),(0,I.jsxs)(_,{label:"Initiated",children:[r," (",l,"%)"]}),(0,I.jsx)(o.Z.Text,{strong:!0,className:"mt-4 mb-2",children:"Attributes Stats"}),(0,I.jsx)(_,{label:"Total",children:c}),(0,I.jsx)(_,{label:"Set",children:g}),(0,I.jsxs)(_,{label:"Progress",children:[u,"%"]})]}),(0,I.jsx)(m.Z,{})]})}function Ae(){const{jumpToItem:e}=S(),{searchParams:t,addQueryParam:a}=r();return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(u.ZP,{block:!0,onClick:()=>e("random"),type:"primary",children:"Random Item"}),(0,I.jsx)(M.Do,{label:"Unset Only",value:"unset"===t.get("scope"),onChange:e=>a("scope",e?"unset":""),className:"mt-4"})]})}function Se(){const{searchParams:e,addQueryParam:t}=r(),{attributesList:a}=S(),s=(0,x.useMemo)((()=>[{label:"Random Attribute",value:"random"},...a.map((e=>{let{id:t,name:a}=e;return{label:a.en,value:t}}))]),[a]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(M.zE,{label:"Sampler Attribute",value:e.get("attribute")||"random",onChange:e=>t("attribute",e),options:s}),(0,I.jsx)(M.xh,{label:"Sample Size",value:Number(e.get("size")||9),onChange:e=>t("size",String(e)),min:3,max:21,step:3})]})}function Te(){const{searchParams:e,addQueryParam:t}=r(),{attributesList:a}=S(),s=(0,x.useMemo)((()=>a.map((e=>{let{id:t,name:a}=e;return{label:a.en,value:t}}))),[a]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(M.zE,{label:"Attribute",value:e.get("attribute")||"ali",onChange:e=>t("attribute",e),options:s}),(0,I.jsx)(M.zE,{label:"Scope",value:e.get("scope")||"unset",onChange:e=>t("scope",e),options:[{value:"unset",label:"Unset"},...E.Ud]}),(0,I.jsx)(M.zE,{label:"Results per page",value:e.get("pageSize")||12,onChange:e=>t("pageSize",e),options:[12,24,48,96]})]})}function Pe(){const{searchParams:e,addQueryParam:t}=r();return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(M.Do,{label:"Only Complete",value:"true"===e.get("showComplete"),onChange:e=>t("showComplete",e?"true":""),className:"full-width m-0"}),(0,I.jsx)(M.Do,{label:"Show Unrelated",value:"true"===e.get("showUnrelated"),onChange:e=>t("showUnrelated",e?"true":""),className:"full-width m-0"}),(0,I.jsx)(M.Do,{label:"Show Unclear",value:"true"===e.get("showUnclear"),onChange:e=>t("showUnclear",e?"true":""),className:"full-width m-0"})]})}function Ue(){const{isDirty:e,save:t,prepareItemsAttributesFileForDownload:a}=S(),{view:s,setView:n}=r();return(0,I.jsxs)(Ie.Pd,{children:[(0,I.jsxs)(d.Z,{vertical:!0,gap:12,children:[(0,I.jsx)(u.ZP,{block:!0,danger:!0,type:"primary",disabled:!e,onClick:t,size:"large",children:"Save"}),(0,I.jsx)(Ne.o,{data:()=>a(),fileName:"items-attribute-values.json",disabled:e,block:!0})]}),(0,I.jsx)(m.Z,{}),(0,I.jsx)(Ce,{}),(0,I.jsx)(M.zE,{label:"View",value:s,onChange:n,options:["classifier","sampler","grouping","comparator"]}),(0,I.jsx)(m.Z,{}),"classifier"===s&&(0,I.jsx)(Ae,{}),"sampler"===s&&(0,I.jsx)(Se,{}),"grouping"===s&&(0,I.jsx)(Te,{}),"comparator"===s&&(0,I.jsx)(Pe,{})]})}var Le=a(4562);function Ee(){const{isLoading:e,error:t,hasResponseData:a}=S();return(0,I.jsx)(Ie.Xg,{title:"Items",subtitle:"Attribution",children:(0,I.jsxs)(s.Z,{hasSider:!0,children:[(0,I.jsx)(Le.p,{children:(0,I.jsx)(Ue,{})}),(0,I.jsx)(s.Z.Content,{className:"content",children:(0,I.jsx)(n.T,{isLoading:e,error:t,hasResponseData:a,children:(0,I.jsx)(we,{})})})]})})}const ke=function(){return(0,I.jsx)(A,{children:(0,I.jsx)(Ee,{})})}}}]);
//# sourceMappingURL=ItemsAttribution.c44b1175.chunk.js.map