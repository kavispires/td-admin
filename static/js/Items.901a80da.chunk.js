"use strict";(self.webpackChunktdr=self.webpackChunktdr||[]).push([[724],{8178:(e,t,n)=>{n.d(t,{i:()=>c});var i=n(5),a=n(1105),s=n(5529),l=n(763),r=n(2791),o=n(184);function c(e){let{items:t,isPending:n,style:c,size:d,placeholder:u,allowClear:g,onFinish:m,...h}=e;const v=(0,s.N)("items",!Boolean(t)&&!n),{namesDict:p,options:j}=(0,r.useMemo)((()=>{var e;console.log("Recomputing item names typeahead...");const n=Object.values(null!==(e=null!==t&&void 0!==t?t:v.data)&&void 0!==e?e:{}).reduce(((e,t)=>{const n="".concat(t.name.en," (").concat(t.id,")"),i="".concat(t.name.pt," (").concat(t.id,")");return e[n]=t.id,e[i]=t.id,e}),{});return{namesDict:n,options:(0,l.orderBy)(Object.keys(n),[e=>e.toLowerCase()]).map((e=>({value:e})))}}),[t,n]),[x,f]=(0,r.useState)([]);return(0,o.jsx)(i.Z,{options:j,style:{width:250,...c},allowClear:null===g||void 0===g||g,placeholder:null!==u&&void 0!==u?u:"Search by name or id...",filterOption:(e,t)=>{var n;return-1!==String(null!==(n=null===t||void 0===t?void 0:t.value)&&void 0!==n?n:"").toUpperCase().indexOf(null===e||void 0===e?void 0:e.toUpperCase())},onSearch:e=>{const t=e.trim(),n=j.filter((e=>{var n;return String(null!==(n=null===e||void 0===e?void 0:e.value)&&void 0!==n?n:"").toUpperCase().includes(t)})),i=(0,l.orderBy)(n,[e=>{var n;const i=String(null!==(n=null===e||void 0===e?void 0:e.value)&&void 0!==n?n:"");if(i.includes("".concat(t," ")))return-1;const a=i.toUpperCase().indexOf(t);return 0===a?-1:-1===a?i.length:a}]);f(i)},notFoundContent:"No items found",onSelect:e=>{void 0!==p[e]&&m(p[e])},...h,children:(0,o.jsx)(a.Z,{onPressEnter:()=>{if(x.length>0){const e=x[0].value;void 0!==p[e]&&m(p[e])}}})})}},9667:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var i=n(3990),a=n(2128),s=n(4031),l=n(6106),r=n(914),o=n(1674),c=n(1046),d=n(1105),u=n(7765),g=n(5225),m=n(5922),h=n(4520),v=n(1310),p=n(6020),j=n(4766),x=n(8938),f=n(763),y=n(2791),w=n(184);const b=(0,y.createContext)({items:{},isLoading:!0,error:null,hasResponseData:!1,categoriesDict:{},categories:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1"}),S=e=>{var t;let{children:n}=e;const{queryParams:i}=(0,j.K)(),{data:a,isLoading:s,error:l,isSaving:r,save:o,addEntryToUpdate:c,entriesToUpdate:d,isDirty:u}=(0,x.i)({tdrResourceName:"items",firebaseDataCollectionName:"items"}),{categoriesDict:g,categories:m}=(0,y.useMemo)((()=>{console.log("Recomputing item categories typeahead...");const e={},t={},n={},i=[];Object.values(a).forEach((a=>{var s;const l="".concat(a.name.en," (").concat(a.id,")"),r="".concat(a.name.pt," (").concat(a.id,")");t[a.name.en]?i.push(["".concat(a.name.en," (").concat(t[a.name.en],")"),l]):t[a.name.en]=a.id,n[a.name.pt]?i.push(["".concat(a.name.pt," (").concat(n[a.name.pt],")"),r]):n[a.name.pt]=a.id,null===a||void 0===a||null===(s=a.categories)||void 0===s||s.forEach((t=>{e[t]=t}))}));const s=(0,f.orderBy)(Object.keys(e)).map((e=>({value:e})));return i.length>0&&console.warn("Possible duplicated items",i),{categoriesDict:e,categories:s}}),[a,r,s]),h=null!==(t=i.get("category"))&&void 0!==t?t:"all",v=(0,y.useMemo)((()=>{const e=(0,f.orderBy)(Object.values(a),[e=>Number(e.id)],"asc");switch(h){case"all":return e;case"!all":return e.filter((e=>{var t,n;return null===(t=!(null!==e&&void 0!==e&&null!==(n=e.categories)&&void 0!==n&&n.length))||void 0===t||t}));case"nsfw":return e.filter((e=>e.nsfw));case"!nsfw":return e.filter((e=>!e.nsfw));default:return h.startsWith("!")?e.filter((e=>{var t;return!(null!==e&&void 0!==e&&null!==(t=e.categories)&&void 0!==t&&t.includes(h.slice(1)))})):e.filter((e=>{var t;return null===e||void 0===e||null===(t=e.categories)||void 0===t?void 0:t.includes(h)}))}}),[a,h]),p=(0,y.useMemo)((()=>{var e;const t=(0,f.orderBy)(Object.keys(d),[e=>Number(e)],"asc"),n=null===(e=v[v.length-1])||void 0===e?void 0:e.id,i=(0,f.orderBy)([...t,n],[e=>Number(e)],"desc")[0];return String(Number(i)+1)}),[v,d]);return(0,w.jsx)(b.Provider,{value:{items:a,listing:v,isLoading:s,error:l,categoriesDict:g,categories:m,hasResponseData:v.length>0,isDirty:u,addItemToUpdate:c,isSaving:r,save:o,itemsToUpdate:d,newId:p},children:n})},C=()=>(0,y.useContext)(b);var Z=n(7134);var N=n(3834),k=n(4483),D=n(7747),O=n(8955);function T(e){let{item:t,editMode:n=!1}=e;const{categories:i}=C(),{isEditing:a,toggleEditMode:l,onEdit:r,isDirty:h,onModify:x,onReset:b,editableItem:S}=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{addItemToUpdate:i,itemsToUpdate:a}=C(),[s,l]=(0,y.useState)(n),[r,o]=(0,y.useState)((0,f.cloneDeep)(e)),c=null!==(t=a[e.id])&&void 0!==t?t:e,d=e=>{const t={...(0,f.cloneDeep)(r),...e};Object.keys(e).includes("nsfw")&&!1===e.nsfw&&delete t.nsfw,o(t)},u=async()=>{i(r.id,r)},g=()=>{o((0,f.cloneDeep)(e)),l(!1)},m=JSON.stringify(c)!==JSON.stringify(r);return{isEditing:s,toggleEditMode:()=>l((e=>!e)),editableItem:r,onEdit:d,isDirty:m,onModify:u,onReset:g}}(t,n),T=(0,Z._)(),{is:I}=(0,j.K)();return(0,w.jsxs)(o.Z,{title:(0,w.jsx)(s.Z.Text,{onClick:()=>T(t.id),children:t.id}),style:{maxWidth:250},actions:h?[(0,w.jsx)(N.Z,{onClick:b},"reset"),(0,w.jsx)(k.Z,{onClick:x},"save")]:[(0,w.jsx)(D.Z,{onClick:l},"edit")],children:[(0,w.jsx)(p.ck,{id:t.id,width:125,title:"".concat(t.name.en," | ").concat(t.name.pt)}),(0,w.jsxs)(c.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,w.jsx)(d.Z,{prefix:(0,w.jsx)(v.H,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:a?"outlined":"borderless",size:"small",defaultValue:t.name.en,readOnly:!a,onChange:e=>r({name:{...S.name,en:e.target.value}})},"en-".concat(t.name.en)),(0,w.jsx)(d.Z,{prefix:(0,w.jsx)(v.H,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:a?"outlined":"borderless",size:"small",defaultValue:t.name.pt,readOnly:!a,onChange:e=>r({name:{...S.name,pt:e.target.value}})},"pt-".concat(t.name.pt)),(0,w.jsx)("div",{children:(0,w.jsx)(u.Z,{mode:"multiple",style:{width:"100%"},placeholder:"Select a category",defaultValue:t.categories,disabled:!a,options:i,variant:a?"outlined":"borderless",size:"small",onChange:e=>r({categories:e.sort()})},String(t.categories))}),I("showVerifyThing")&&(0,w.jsx)("div",{children:(0,w.jsx)(M,{item:t})}),(a||t.nsfw)&&(0,w.jsx)("div",{children:(0,w.jsx)(g.Z.Item,{label:"nsfw",valuePropName:"checked",children:(0,w.jsx)(m.Z,{checked:t.nsfw,onChange:e=>r({nsfw:e}),size:"small",checkedChildren:(0,w.jsx)(O.Z,{style:{color:"hotpink"}}),disabled:!a})})})]})]})}const I=(0,f.memoize)((e=>{var t,n;const i=!(null===(t=e.categories)||void 0===t||!t.includes("thing")),a=!(null===(n=e.categories)||void 0===n||!n.includes("mesmice")),s=1===e.name.en.split(" ").length,l=1===e.name.pt.split(" ").length,r={en:i||s&&a,pt:i||l&&a};return r.pt||r.en?(0,w.jsxs)(w.Fragment,{children:[r.en&&(0,w.jsx)(v.H,{language:"en",width:"1em"}),r.pt&&(0,w.jsx)(v.H,{language:"pt",width:"1em"})]}):""})),M=e=>{let{item:t}=e;const n=I(t);return n?(0,w.jsxs)(h.Z,{gap:6,children:["Thing: ",n]}):(0,w.jsx)(w.Fragment,{})};var P=n(4290),U=n(2228);function E(){var e;const{queryParams:t}=(0,j.K)(),n=null!==(e=t.get("type"))&&void 0!==e?e:"all",{listing:i}=C(),{page:a,pagination:o}=(0,P.e)({data:i,resetter:n});return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(s.Z.Title,{level:2,children:["Listing - ",(0,f.capitalize)(n)," items (",i.length,")"]}),(0,w.jsx)(U.N,{pagination:o,children:(0,w.jsx)(l.Z,{gutter:[16,16],className:"my-4",children:a.map((e=>(0,w.jsx)(r.Z,{xs:24,sm:24,md:12,lg:6,xl:4,children:(0,w.jsx)(T,{item:e})},e.id)))})})]})}var z=n(7128),F=n(6173),B=n(7018),L=n(1958),R=n(959),V=n(2556);const H={id:"",name:{en:"",pt:""},groups:[]};function K(e){let{isModalOpen:t,handleOk:n,handleCancel:i,newId:a}=e;const[s]=(0,y.useState)((0,f.cloneDeep)({...H,id:a}));return(0,w.jsx)(R.Z,{title:"Add new item",open:t,onOk:n,onCancel:i,children:(0,w.jsx)(T,{item:s,editMode:!0})})}function W(){const[e,t]=(0,y.useState)(!1),{newId:n}=C();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(V.ZP,{block:!0,onClick:()=>{t(!0)},children:"Add New Item"}),e&&(0,w.jsx)(K,{isModalOpen:e,handleOk:()=>{t(!1)},handleCancel:()=>{t(!1)},newId:n},n)]})}var q=n(5850),A=n(7340);function J(e){var t;let{showSearch:n,toggleSearch:i}=e;const{isDirty:a,save:s,items:l,categories:r,itemsToUpdate:o,isSaving:c}=C(),{queryParams:d,is:u,addParam:g}=(0,j.K)(),m=(0,y.useMemo)((()=>{const e=(0,f.orderBy)(r.map((e=>{let{value:t}=e;return{label:(0,f.capitalize)(t),value:t}})),"label"),t=e.map((e=>{let{label:t,value:n}=e;return{label:"NOT ".concat(t),value:"!".concat(n)}}));return[...e,...t]}),[r]);return(0,w.jsxs)(L.Pd,{children:[(0,w.jsxs)(h.Z,{vertical:!0,gap:6,children:[(0,w.jsx)(A.k,{isDirty:a,dirt:JSON.stringify(o),onSave:s,isSaving:c}),(0,w.jsx)(B.o,{data:()=>function(e){return(0,q.Tj)(Object.values(e).reduce(((e,t)=>{var n;return t.categories=(null!==(n=null===t||void 0===t?void 0:t.categories)&&void 0!==n?n:[]).sort(),0===t.categories.length?(delete t.categories,e[t.id]=t,e):(t.categories.includes("thing")&&1===t.name.en.split(" ").length&&1===t.name.pt.split(" ").length&&((t.categories.includes("evidence")||t.categories.includes("dream")||t.categories.includes("alien")||t.categories.includes("mesmice"))&&(t.categories=t.categories.filter((e=>"thing"!==e))),e[t.id]=t),e[t.id]=t,e)}),{}))}(l),fileName:"items.json",disabled:a,block:!0})]}),(0,w.jsx)(z.Z,{}),(0,w.jsx)(F.Do,{label:"Show Search",value:n,onChange:i}),(0,w.jsx)(F.Do,{label:"Verify Thing",value:u("showVerifyThing"),onChange:e=>g("showVerifyThing",e?"true":""),className:"full-width m-0"}),(0,w.jsx)(F.zE,{label:"Category",value:null!==(t=d.get("category"))&&void 0!==t?t:"all",onChange:e=>g("category",e,"all"),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...m,{label:"No categories",value:"!all"}]}),(0,w.jsx)(z.Z,{}),(0,w.jsx)(W,{})]})}var X=n(8178);function _(){const{items:e,isLoading:t,isSaving:n}=C(),[i,a]=(0,y.useState)(null);return(0,w.jsxs)(y.Fragment,{children:[(0,w.jsx)(s.Z.Title,{level:2,children:"Search for an item"}),(0,w.jsx)("div",{children:(0,w.jsx)(X.i,{items:e,isPending:t||n,onFinish:t=>a(e[t])})}),Boolean(i)&&(0,w.jsx)(c.Z,{direction:"vertical",className:"my-4",children:(0,w.jsx)(T,{item:i})},null===i||void 0===i?void 0:i.id),(0,w.jsx)(z.Z,{})]},"item-search-".concat(t))}var G=n(4562);function Q(){const{isLoading:e,error:t,hasResponseData:n}=C(),[s,l]=(0,y.useState)(!0);return(0,w.jsx)(L.Xg,{title:"Items",subtitle:"Listing",children:(0,w.jsxs)(i.Z,{hasSider:!0,children:[(0,w.jsx)(G.p,{children:(0,w.jsx)(J,{showSearch:s,toggleSearch:()=>l((e=>!e))})}),(0,w.jsx)(i.Z.Content,{className:"content",children:(0,w.jsxs)(a.T,{isLoading:e,error:t,hasResponseData:n,children:[s&&!e&&(0,w.jsx)(_,{}),(0,w.jsx)(E,{})]})})]})})}const Y=function(){return(0,w.jsx)(S,{children:(0,w.jsx)(Q,{})})}}}]);
//# sourceMappingURL=Items.901a80da.chunk.js.map