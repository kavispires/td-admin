"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[8724],{5581:(e,n,s)=>{s.r(n),s.d(n,{default:()=>le});var i=s(3990),a=s(1046),t=s(2128),l=s(8252),d=s(6473),r=s(1105),o=s(5437),c=s(4520),m=s(5225),u=s(5922),h=s(9228),p=s(2556),j=s(1310),x=s(2997),g=s(4766),v=s(8938),f=s(763),y=s(2791),k=s(184);const Z=(0,y.createContext)({items:{},isLoading:!0,error:null,hasResponseData:!1,decksDict:{},decks:[],listing:[],isDirty:!1,addItemToUpdate:()=>{},itemsToUpdate:{},isSaving:!1,save:()=>{},newId:"-1"}),b=e=>{var n;let{children:s}=e;const{queryParams:i}=(0,g.K)(),{data:a,isLoading:t,error:l,isSaving:d,save:r,addEntryToUpdate:o,entriesToUpdate:c,isDirty:m}=(0,v.i)({tdrResourceName:"items",firebaseDataCollectionName:"items"}),{decksDict:u,decks:h}=(0,y.useMemo)((()=>{console.log("Recomputing item decks typeahead...");const e={},n={},s={},i=[];Object.values(a).forEach((a=>{var t;const l="".concat(a.name.en," (").concat(a.id,")"),d="".concat(a.name.pt," (").concat(a.id,")");n[a.name.en]?i.push(["".concat(a.name.en," (").concat(n[a.name.en],")"),l]):n[a.name.en]=a.id,s[a.name.pt]?i.push(["".concat(a.name.pt," (").concat(s[a.name.pt],")"),d]):s[a.name.pt]=a.id,null===a||void 0===a||null===(t=a.decks)||void 0===t||t.forEach((n=>{e[n]=n}))}));const t=(0,f.orderBy)(Object.keys(e)).map((e=>({value:e})));return i.length>0&&console.warn("Possible duplicated items",i),{decksDict:e,decks:t}}),[a,d,t]),p=null!==(n=i.get("deck"))&&void 0!==n?n:"all",j=(0,y.useMemo)((()=>{const e=(0,f.orderBy)(Object.values(a),[e=>Number(e.id)],"asc");switch(p){case"all":return e;case"!all":return e.filter((e=>{var n,s;return null===(n=!(null!==e&&void 0!==e&&null!==(s=e.decks)&&void 0!==s&&s.length))||void 0===n||n}));case"nsfw":return e.filter((e=>e.nsfw));case"!nsfw":return e.filter((e=>!e.nsfw));default:return p.startsWith("!")?e.filter((e=>{var n;return!(null!==e&&void 0!==e&&null!==(n=e.decks)&&void 0!==n&&n.includes(p.slice(1)))})):e.filter((e=>{var n;return null===e||void 0===e||null===(n=e.decks)||void 0===n?void 0:n.includes(p)}))}}),[a,p]),x=(0,y.useMemo)((()=>{var e;const n=(0,f.orderBy)(Object.keys(c),[e=>Number(e)],"asc"),s=null===(e=j[j.length-1])||void 0===e?void 0:e.id,i=(0,f.orderBy)([...n,s],[e=>Number(e)],"desc")[0];return String(Number(i)+1)}),[j,c]);return(0,k.jsx)(Z.Provider,{value:{items:a,listing:j,isLoading:t,error:l,decksDict:u,decks:h,hasResponseData:j.length>0,isDirty:m,addItemToUpdate:o,isSaving:d,save:r,itemsToUpdate:c,newId:x},children:s})},w=()=>(0,y.useContext)(Z);var N=s(7134);var C=s(3834),S=s(4483),O=s(7747),D=s(8955),T=s(6324),P=s(2675);function z(e){let{item:n,editMode:s=!1,simplified:i}=e;const{decks:t}=w(),{isEditing:h,toggleEditMode:p,onEdit:v,isDirty:Z,onModify:b,onReset:T,editableItem:P}=function(e){var n;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{addItemToUpdate:i,itemsToUpdate:a}=w(),[t,l]=(0,y.useState)(s),[d,r]=(0,y.useState)((0,f.cloneDeep)(e)),o=null!==(n=a[e.id])&&void 0!==n?n:e,c=e=>{const n={...(0,f.cloneDeep)(d),...e};Object.keys(e).includes("nsfw")&&!1===e.nsfw&&delete n.nsfw,r(n)},m=async()=>{i(d.id,d)},u=()=>{r((0,f.cloneDeep)(e)),l(!1)},h=JSON.stringify(o)!==JSON.stringify(d);return{isEditing:t,toggleEditMode:()=>l((e=>!e)),editableItem:d,onEdit:c,isDirty:h,onModify:m,onReset:u}}(n,s),z=(0,N._)(),{is:I}=(0,g.K)();return(0,k.jsxs)(d.Z,{title:(0,k.jsx)(l.Z.Text,{onClick:()=>z(n.id),children:n.id}),extra:(0,k.jsx)(R,{item:n}),style:{maxWidth:250},size:i?"small":"default",actions:i?void 0:Z?[(0,k.jsx)(C.Z,{onClick:T},"reset"),(0,k.jsx)(S.Z,{onClick:b},"save")]:[(0,k.jsx)(O.Z,{onClick:p},"edit")],children:[(0,k.jsx)(x.ck,{id:n.id,width:i?75:125,title:"".concat(n.name.en," | ").concat(n.name.pt)}),(0,k.jsxs)(a.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,k.jsx)(r.Z,{prefix:(0,k.jsx)(j.H,{language:"en",width:"1em"}),placeholder:"Name in EN",variant:h?"outlined":"borderless",size:"small",defaultValue:n.name.en,readOnly:!h,onChange:e=>v({name:{...P.name,en:e.target.value}})},"en-".concat(n.name.en)),(0,k.jsx)(r.Z,{prefix:(0,k.jsx)(j.H,{language:"pt",width:"1em"}),placeholder:"Name in PT",variant:h?"outlined":"borderless",size:"small",defaultValue:n.name.pt,readOnly:!h,onChange:e=>v({name:{...P.name,pt:e.target.value}})},"pt-".concat(n.name.pt)),!i&&(0,k.jsxs)(k.Fragment,{children:[!I("simplified")&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{children:(0,k.jsx)(o.Z,{mode:"multiple",style:{width:"100%"},placeholder:"Select a deck",defaultValue:n.decks,disabled:!h,options:t,variant:h?"outlined":"borderless",size:"small",onChange:e=>v({decks:e.sort()})},String(n.decks))}),(0,k.jsxs)(c.Z,{gap:6,children:[(0,k.jsx)(j.H,{language:"en",width:"1em"}),(0,k.jsx)(o.Z,{mode:"tags",style:{width:"100%"},placeholder:"Other names EN",defaultValue:n.aliasesEn,options:[],size:"small",onChange:e=>v({aliasesEn:e.sort()})})]}),(0,k.jsxs)(c.Z,{gap:6,children:[(0,k.jsx)(j.H,{language:"pt",width:"1em"}),(0,k.jsx)(o.Z,{mode:"tags",style:{width:"100%"},placeholder:"Other names PT",defaultValue:n.aliasesPt,options:[],size:"small",onChange:e=>v({aliasesPt:e.sort()})})]})]}),I("showVerifyThing")&&(0,k.jsx)("div",{children:(0,k.jsx)(E,{item:n})}),(h||n.nsfw)&&(0,k.jsx)("div",{children:(0,k.jsx)(m.Z.Item,{label:"nsfw",valuePropName:"checked",children:(0,k.jsx)(u.Z,{checked:n.nsfw,onChange:e=>v({nsfw:e}),size:"small",checkedChildren:(0,k.jsx)(D.Z,{style:{color:"hotpink"}}),disabled:!h})})})]})]})]})}const I=(0,f.memoize)((e=>{var n,s;const i=!(null===(n=e.decks)||void 0===n||!n.includes("thing")),a=!(null===(s=e.decks)||void 0===s||!s.includes("manufactured")),t=1===e.name.en.split(" ").length,l=1===e.name.pt.split(" ").length,d={en:i||t&&a,pt:i||l&&a};return d.pt||d.en?(0,k.jsxs)(k.Fragment,{children:[d.en&&(0,k.jsx)(j.H,{language:"en",width:"1em"}),d.pt&&(0,k.jsx)(j.H,{language:"pt",width:"1em"})]}):""})),E=e=>{let{item:n}=e;const s=I(n);return s?(0,k.jsxs)(c.Z,{gap:6,children:["Thing: ",s]}):(0,k.jsx)(k.Fragment,{})};function R(e){let{item:n}=e;const[s,i]=(0,P.Z)(!1),t=(0,N._)();return(0,k.jsx)(h.Z,{content:(0,k.jsxs)(a.Z,{direction:"vertical",children:[(0,k.jsx)(p.ZP,{size:"small",onClick:()=>t(JSON.stringify(n,null,2)),children:"Complete Item"}),(0,k.jsx)(p.ZP,{size:"small",onClick:()=>t(n.name.en),children:"EN Name"}),(0,k.jsx)(p.ZP,{size:"small",onClick:()=>t(n.name.pt),children:"PT Name"}),(0,k.jsx)(p.ZP,{size:"small",onClick:()=>t(JSON.stringify((e=>({id:e.id,type:"item",header:{title:{en:"Item",pt:"Item"},iconId:"2077"},metadata:{level:"basic",keyword:(0,f.snakeCase)(e.name.en).toUpperCase()},content:{itemId:e.id,caption:e.name}}))(n),null,2)),children:"Escape Room Item"})]}),title:"Copy",trigger:"click",open:s,onOpenChange:i,children:(0,k.jsx)(p.ZP,{type:"text",icon:(0,k.jsx)(T.Z,{})})})}var _=s(4290),M=s(2228);function U(){var e;const{queryParams:n}=(0,g.K)(),s=null!==(e=n.get("deck"))&&void 0!==e?e:"all",{listing:i}=w(),{page:a,pagination:t}=(0,_.e)({data:i,resetter:s}),{is:d}=(0,g.K)(),r=d("simplified");return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(l.Z.Title,{level:2,children:["Listing - ",(0,f.capitalize)(s)," items (",i.length,")"]}),(0,k.jsx)(M.N,{pagination:t,className:"full-width",children:(0,k.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:a.map((e=>(0,k.jsx)(z,{item:e,simplified:r},e.id)))})})]})}var F=s(7128),B=s(3166),J=s(7018),V=s(7965),L=s(5850),K=s(7340),H=s(2164),W=s(959);const q={id:"",name:{en:"",pt:""},groups:[]};function A(e){let{isModalOpen:n,handleOk:s,handleCancel:i,newId:a}=e;const[t]=(0,y.useState)((0,f.cloneDeep)({...q,id:a}));return(0,k.jsx)(W.Z,{title:"Add new item",open:n,onOk:s,onCancel:i,children:(0,k.jsx)(z,{item:t,editMode:!0})})}function G(){const[e,n]=(0,y.useState)(!1),{newId:s}=w();return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(p.ZP,{block:!0,onClick:()=>{n(!0)},children:"Add New Item"}),e&&(0,k.jsx)(A,{isModalOpen:e,handleOk:()=>{n(!1)},handleCancel:()=>{n(!1)},newId:s},s)]})}function Q(){var e;const{isDirty:n,save:s,items:i,decks:a,itemsToUpdate:t,isSaving:d}=w(),{queryParams:r,is:o,addParam:m}=(0,g.K)(),u=(0,y.useMemo)((()=>{const e=(0,f.orderBy)(a.map((e=>{let{value:n}=e;return{label:(0,f.capitalize)(n),value:n}})),"label"),n=e.map((e=>{let{label:n,value:s}=e;return{label:"NOT ".concat(n),value:"!".concat(s)}}));return[...e,...n]}),[a]);return(0,k.jsxs)(V.Pd,{children:[(0,k.jsxs)(c.Z,{vertical:!0,gap:6,children:[(0,k.jsx)(K.k,{isDirty:n,dirt:JSON.stringify(t),onSave:s,isSaving:d}),(0,k.jsx)(J.o,{data:()=>function(e){return(0,L.Tj)(Object.values(e).reduce(((e,n)=>{var s;return n.decks=(null!==(s=null===n||void 0===n?void 0:n.decks)&&void 0!==s?s:[]).sort(),0===n.decks.length&&delete n.decks,e[n.id]=n,e}),{}))}(i),fileName:"items.json",disabled:n,block:!0})]}),(0,k.jsx)(F.Z,{className:"my-4"}),(0,k.jsx)(l.Z.Text,{type:"secondary",children:"Tools"}),(0,k.jsx)(B.Do,{label:"Show Search",value:!o("hideSearch"),onChange:e=>m("hideSearch",e?"":"true",""),className:"full-width m-0"}),(0,k.jsx)(B.Do,{label:"Show Randomizer",value:o("showRandomizer"),onChange:e=>m("showRandomizer",e?"true":"",""),className:"full-width m-0"}),(0,k.jsx)(l.Z.Text,{type:"secondary",children:"Display"}),(0,k.jsx)(B.Do,{label:"Simplified UI",value:o("simplified"),onChange:e=>m("simplified",e?"true":""),className:"full-width m-0"}),(0,k.jsx)(B.Do,{label:"Thing Verifier",value:o("showVerifyThing"),onChange:e=>m("showVerifyThing",e?"true":""),className:"full-width m-0",disabled:o("simplified")}),(0,k.jsx)(B.Do,{label:"Other Names",value:o("showOtherNames"),onChange:e=>m("showOtherNames",e?"true":""),className:"full-width m-0",disabled:!0}),(0,k.jsx)(F.Z,{className:"my-4"}),(0,k.jsx)(B.zE,{label:"Deck",value:null!==(e=r.get("deck"))&&void 0!==e?e:"all",onChange:e=>m("deck",e,"all"),options:[{label:"All",value:"all"},{label:"NSFW",value:"nsfw"},{label:"SFW",value:"!nsfw"},...u,{label:"No decks",value:"!all"}]}),(0,k.jsx)(F.Z,{className:"my-4"}),(0,k.jsx)(G,{}),(0,k.jsx)(F.Z,{className:"my-4"}),(0,k.jsx)(J.o,{data:()=>function(e){return(0,L.Tj)(Object.values((0,f.cloneDeep)(e)).reduce(((e,n)=>{const s={id:n.id,names:{"en-US":n.name.en,"pt-BR":n.name.pt},aliases:{"en-US":n.aliasesEn,"pt-BR":n.aliasesPt}};return e[s.id]=s,e}),{}))}(i),fileName:"items-gpt.json",disabled:n,block:!0,icon:(0,k.jsx)(H.Z,{}),children:"Open AI JSON"})]})}var X=s(4003),Y=s(1583),$=s(5657);function ee(){const{listing:e}=w(),[n,s]=(0,y.useState)([]),i=(0,N._)(),[t,d]=(0,y.useState)(5);return(0,k.jsxs)("div",{children:[(0,k.jsxs)(l.Z.Title,{level:2,children:["Randomized Sample"," ",(0,k.jsx)(p.ZP,{size:"small",icon:(0,k.jsx)($.Z,{}),onClick:()=>{const n=(0,f.chunk)((0,f.sampleSize)(e,15*t),t).map((e=>e.filter((e=>!e.nsfw)))).map((e=>e.map((e=>e.name.en)).join(", "))).map(((e,n)=>"".concat(n+1,") ").concat(e))).join("\n");i(n)},children:"MJ"})]}),(0,k.jsxs)(c.Z,{gap:12,children:[(0,k.jsx)(m.Z.Item,{label:"Quantity"}),(0,k.jsx)("div",{children:(0,k.jsx)(X.Z,{min:3,max:15,value:t,onChange:e=>d(Number(e)),style:{minWidth:"100px"}})}),(0,k.jsx)(p.ZP,{onClick:()=>{s((0,f.sampleSize)(e,t))},type:"primary",children:"Get Sample"}),(0,k.jsx)(Y.Z.Button,{menu:{items:[{label:"Copy IDs",key:"copy_ids"},{label:"Copy Names EN",key:"copy_names_en"},{label:"Copy Names PT",key:"copy_names_pt"}],onClick:e=>{let{key:s}=e;if("copy_ids"!==s)if("copy_names_en"!==s)if("copy_names_pt"!==s);else{const e=n.map((e=>e.name.pt)).join(", ");i(e)}else{const e=n.map((e=>e.name.en)).join(", ");i(e)}else{const e=n.map((e=>e.id));i(JSON.stringify(e))}}},disabled:0===n.length,onClick:()=>i(JSON.stringify(n,null,2)),icon:(0,k.jsx)($.Z,{}),children:"Copy"})]}),(0,k.jsx)(a.Z,{wrap:!0,className:"my-4",children:n.map((e=>(0,k.jsx)(z,{item:e,simplified:!0},e.id)))}),(0,k.jsx)(F.Z,{})]})}var ne=s(8178),se=s(881);function ie(){const{items:e,isLoading:n,isSaving:s}=w(),[i,t]=(0,y.useState)(null),{queryParams:d,addParam:r}=(0,g.K)();return(0,k.jsxs)(y.Fragment,{children:[(0,k.jsx)(l.Z.Title,{level:2,children:"Search for an item"}),(0,k.jsx)("div",{children:(0,k.jsx)(ne.i,{items:e,isPending:n||s,onFinish:n=>t(e[n])})}),Boolean(i)&&(0,k.jsxs)(a.Z,{direction:"vertical",className:"my-4",children:[(0,k.jsx)(z,{item:i}),(0,k.jsx)(p.ZP,{onClick:()=>{if(i){var e;const n=Number(null!==(e=d.get("pageSize"))&&void 0!==e?e:64),s=Number(i.id),a=Math.floor(s/n)+1;r("page",a.toString())}},block:!0,icon:(0,k.jsx)(se.Z,{}),children:"Find in listing"})]},null===i||void 0===i?void 0:i.id),(0,k.jsx)(F.Z,{})]},"item-search-".concat(n))}var ae=s(4562);function te(){const{isLoading:e,error:n,hasResponseData:s}=w(),{is:l}=(0,g.K)();return(0,k.jsx)(V.Xg,{title:"Items",subtitle:"Listing",children:(0,k.jsxs)(i.Z,{hasSider:!0,children:[(0,k.jsx)(ae.p,{children:(0,k.jsx)(Q,{})}),(0,k.jsx)(i.Z.Content,{className:"content",children:(0,k.jsxs)(t.T,{isLoading:e,error:n,hasResponseData:s,children:[!e&&(0,k.jsxs)(a.Z,{size:"large",align:"start",children:[!l("hideSearch")&&(0,k.jsx)(ie,{}),l("showRandomizer")&&(0,k.jsx)(ee,{})]}),(0,k.jsx)(U,{})]})})]})})}const le=function(){return(0,k.jsx)(b,{children:(0,k.jsx)(te,{})})}}}]);
//# sourceMappingURL=Items.d496f2a7.chunk.js.map