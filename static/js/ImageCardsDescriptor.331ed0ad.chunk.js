"use strict";(self.webpackChunktd_admin=self.webpackChunktd_admin||[]).push([[6213],{7018:(e,a,n)=>{n.d(a,{o:()=>c});var t=n(1413),r=n(4925),o=n(424),i=n(5850),s=n(184);const d=["data","fileName","loading","children"];function c(e){let{data:a,fileName:n,loading:c,children:l}=e,u=(0,r.Z)(e,d);return(0,s.jsx)(o.ZP,(0,t.Z)((0,t.Z)({onClick:()=>(0,i.ZN)("function"===typeof a?a():a,n),loading:c},u),{},{children:null!==l&&void 0!==l?l:"Download JSON"}))}},8384:(e,a,n)=>{n.d(a,{x:()=>u});var t=n(1413),r=n(4925),o=n(732),i=n(6473),s=n(424),d=n(3733),c=n(184);const l=["open","onClose"];function u(e){let{open:a,onClose:n}=e,u=(0,r.Z)(e,l);return(0,c.jsx)(i.Z,(0,t.Z)({className:(0,d.Z)("full-screen-modal",!a&&"full-screen-modal--hidden"),bordered:!1,extra:(0,c.jsx)(s.ZP,{onClick:n,type:"text",shape:"circle",icon:(0,c.jsx)(o.Z,{})})},u))}},7340:(e,a,n)=>{n.d(a,{k:()=>f});var t=n(1413),r=n(4925),o=n(424),i=n(2426),s=n.n(i),d=n(2791),c=n(8211),l=n(4483),u=n(1548),g=n(184);const m=["isDirty","onSave","isSaving","dirt","interval"];function f(e){let{isDirty:a,onSave:n,isSaving:i,dirt:f,interval:p=6e5}=e,v=(0,r.Z)(e,m);const[,y,Z]=(0,c.Z)((()=>{a&&n()}),p);return(0,d.useEffect)((()=>{a?((0,u.F5)(!0),console.log("Save Reset",s()(Date.now()).format("MM/DD/YYYY HH:mm:ss")),Z()):((0,u.F5)(!1),y())}),[a,Z,y,f]),(0,d.useEffect)((()=>{const e=e=>{if(a){const a="You have unsaved changes, are you sure you want to leave?";return e.returnValue=a,a}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[a]),(0,g.jsx)(o.ZP,(0,t.Z)((0,t.Z)({type:"primary",size:"large",icon:(0,g.jsx)(l.Z,{}),onClick:n,disabled:!a,loading:i,danger:!0,block:!0},v),{},{children:"Save"}))}},145:(e,a,n)=>{n.d(a,{f:()=>s});var t=n(2402),r=n(3733),o=n(2606),i=n(184);const s=e=>{let{id:a,width:n=200,className:s="",preview:d=!0,fileExtension:c="jpg"}=e;const{getUrl:l}=(0,o.n)("images"),u=a.replace(/-/g,"/");return(0,i.jsx)("div",{className:(0,r.Z)("image-card",s),children:(0,i.jsx)(t.Z,{width:n,src:l("".concat(u,".").concat(c)),fallback:l("back/default.jpg"),preview:d})})}},359:(e,a,n)=>{n.d(a,{p:()=>i});var t=n(1413),r=n(5529),o=n(763);function i(){var e;const a=(0,r.N)("images-decks"),n=null!==(e=a.data)&&void 0!==e?e:{},i=()=>{if((0,o.isEmpty)(n))return"td-d0-00";const e=(0,o.sample)(Object.keys(n));if(!e)return"td-d0-00";const a=(0,o.random)(1,n[e]);return"".concat(e,"-").concat(a.toString().padStart(2,"0"))};return(0,t.Z)((0,t.Z)({},a),{},{decks:n,decksList:Object.keys(n),onRandomCard:i,onRandomUniqueCard:e=>{let a=0;for(;a<30;){const n=i();if(!e.includes(n))return n;a++}if(a>30)throw new Error("Could not find a unique card")},onRandomCards:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const a=[];let n=0;for(;Object.keys(a).length<e&&n<30;){const e=i();a.includes(e)?n++:a.push(e)}if(n>30&&a.length<e)throw new Error("Could not find enough unique cards");return a}})}},8027:(e,a,n)=>{n.d(a,{A:()=>d,X:()=>c});var t=n(1413),r=n(9631),o=n(6314),i=n(2010),s=n(5850);function d(e,a){return async()=>{var n;console.log("%cQuerying ".concat(e,"/").concat(a," from firebase: ").concat((0,s.xE)()),"color: #f0f");const t=(0,r.JU)(o.RZ,"".concat(e,"/").concat(a));return null!==(n=(await(0,r.QT)(t)).data())&&void 0!==n?n:{}}}function c(e,a,n){return(0,i.a)((0,t.Z)({queryKey:["firebase",e,a],queryFn:d(e,a)},n))}},8938:(e,a,n)=>{n.d(a,{i:()=>g});var t=n(1413),r=n(4607),o=n(763),i=n(2791),s=n(3713),d=n(5850),c=n(8027),l=n(5529),u=n(2233);function g(e){let{tdrResourceName:a,firebaseDataCollectionName:n,serialize:g}=e;const{notification:m}=r.Z.useApp(),f=(0,s.NL)(),p=(0,l.N)(a),v=(0,c.X)("tdr",n,{select:g?d.d_:void 0}),[y,Z]=(0,i.useState)({}),h=(0,u.B)("tdr",n,{onSuccess:()=>{m.success({message:"".concat(n," updated")}),f.refetchQueries({queryKey:["firebase","tdr",n]}),Z({})},onError:e=>{m.error({message:"".concat(n," update failed"),description:e.message})}}),x=(0,i.useMemo)((()=>{var e,r;return p.isSuccess&&v.isSuccess&&!h.isPending?(console.log("%cMerging ".concat(a,"+").concat(n," data..."),"color: #f0f"),(0,o.cloneDeep)((0,t.Z)((0,t.Z)((0,t.Z)({},null!==(e=p.data)&&void 0!==e?e:{}),null!==(r=v.data)&&void 0!==r?r:{}),y))):{}}),[a,n,p.data,v.data,p.isSuccess,v.isSuccess,h.isPending,y]),j=!(0,o.isEmpty)(y),C=v.data;return{data:x,isLoading:p.isLoading||v.isLoading,error:p.error||v.error,firebaseData:C,isSaving:h.isPending,save:()=>{h.mutate(g?(0,d.aS)(y):y)},addEntryToUpdate:(e,a)=>{Z((n=>(0,t.Z)((0,t.Z)({},n),{},{[e]:a})))},entriesToUpdate:y,isDirty:j}}},5529:(e,a,n)=>{n.d(a,{N:()=>s,Y:()=>d});var t=n(1413),r=n(763),o=n(2010),i=n(2606);function s(e){var a;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{getUrl:s}=(0,i.n)("resources"),d=(0,o.a)({queryKey:[e],queryFn:async()=>{const a=await fetch(s("".concat(e,".json")));return await a.json()},enabled:n}),c=!(0,r.isEmpty)(d.data);return(0,t.Z)((0,t.Z)({},d),{},{data:null!==(a=d.data)&&void 0!==a?a:{},hasResponseData:c})}function d(e){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{getUrl:n}=(0,i.n)("resources"),s=(0,o.a)({queryKey:[e],queryFn:async()=>{const a=await fetch(n("".concat(e,".json")));return await a.json()},enabled:a}),d=!(0,r.isEmpty)(s.data);return(0,t.Z)((0,t.Z)({},s),{},{data:s.data,hasResponseData:d})}},548:(e,a,n)=>{n.d(a,{P:()=>r});var t=n(4766);function r(e){var a,n;let{prefix:r="",defaultCurrent:o=1,defaultPageSize:i=10,pageSizeOptions:s=[10,20,50,100],total:d,showQuickJumper:c}=e;const{queryParams:l,addParam:u}=(0,t.K)();return{current:Number(null!==(a=l.get("".concat(r,"page")))&&void 0!==a?a:String(o)),pageSize:Number(null!==(n=l.get("".concat(r,"pageSize")))&&void 0!==n?n:String(i)),onChange:e=>{u("".concat(r,"page"),e.toString(),String(o))},onShowSizeChange:(e,a)=>{u("".concat(r,"pageSize"),a.toString(),String(i))},defaultCurrent:o,defaultPageSize:i,pageSizeOptions:s,total:d,hideOnSinglePage:!0,showQuickJumper:c}}},2233:(e,a,n)=>{n.d(a,{B:()=>d});var t=n(1413),r=n(9631),o=n(6314),i=n(8556);function s(e,a,n){console.log("%cUpdating ".concat(e,"/").concat(a," from firebase"),"color: #f00");const t=(0,r.JU)(o.RZ,"".concat(e,"/").concat(a));return(0,r.r7)(t,n)}function d(e,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,i.D)((0,t.Z)({mutationFn:async n=>s(e,a,n)},n))}},6212:(e,a,n)=>{n.r(a),n.d(a,{ImageCardsDescriptor:()=>F,default:()=>Q});var t=n(1413),r=n(1790),o=n(2128),i=n(4766),s=n(5529),d=n(4925),c=n(959),l=n(7391),u=n(4520),g=n(424),m=n(6979),f=n(1692),p=n(906),v=n(8384),y=n(5850),Z=n(145),h=n(184);const x=["imageCard","addEntryToUpdate"],j=["imageCard","addEntryToUpdate","style"],C=["imageCard","addEntryToUpdate","style"];function w(e){var a,n;let{data:t,addEntryToUpdate:r,onClose:o,onNewCard:s}=e;const{queryParams:d,removeParam:c,addParam:l}=(0,i.K)(),f=Number(null!==(a=d.get("cardSize"))&&void 0!==a?a:200),p=d.get("cardId"),y=null!==(n=t[null!==p&&void 0!==p?p:""])&&void 0!==n?n:{id:p,keywords:[]};return(0,h.jsx)(v.x,{title:"Image Card Descriptor for ".concat(p),open:!!p,onClose:()=>c("cardId"),cover:(0,h.jsx)(u.Z,{justify:"center",align:"center",style:{width:"100vw"},children:(0,h.jsx)(Z.f,{id:null!==p&&void 0!==p?p:"",width:f})}),actions:[(0,h.jsx)(g.ZP,{className:"my-10",onClick:o,children:"Close"},"cancel"),(0,h.jsx)(g.ZP,{className:"my-10",onClick:s,children:"New Card"},"cancel")],children:(0,h.jsxs)(u.Z,{gap:8,vertical:!0,style:{maxWidth:"500px"},children:[(0,h.jsx)(m.Z,{value:f,min:100,max:500,step:25,style:{maxWidth:500,width:"100%"},onChange:e=>l("cardSize",e,200)}),(0,h.jsx)(S,{imageCard:y,addEntryToUpdate:r,size:"large"}),(0,h.jsx)(k,{imageCard:y,addEntryToUpdate:r,size:"large"}),(0,h.jsx)(b,{imageCard:y,addEntryToUpdate:r,size:"large"})]},p)})}function S(e){let{imageCard:a,addEntryToUpdate:n}=e,r=(0,d.Z)(e,x);const o=a.favorite;return(0,h.jsx)(g.ZP,(0,t.Z)({shape:"circle",icon:o?(0,h.jsx)(c.Z,{style:{color:"red"}}):(0,h.jsx)(l.Z,{}),type:"text",onClick:()=>n(a.id,(0,t.Z)((0,t.Z)({},a),{},{favorite:!o}))},r))}function k(e){let{imageCard:a,addEntryToUpdate:n,style:r}=e,o=(0,d.Z)(e,j);return(0,h.jsx)(f.Z.Search,(0,t.Z)({defaultValue:a.keywords.join(" "),onSearch:e=>{return r=e,void n(a.id,(0,t.Z)((0,t.Z)({},a),{},{keywords:(0,y.R1)(r.toLocaleLowerCase().split(/, |,| /).filter(Boolean).map((e=>e.trim())).sort())}));var r},style:(0,t.Z)({maxWidth:500,width:"100%"},r),enterButton:"Update"},o))}function b(e){let{imageCard:a,addEntryToUpdate:n,style:r}=e,o=(0,d.Z)(e,C);return(0,h.jsx)(p.Z,(0,t.Z)({mode:"multiple",allowClear:!0,style:(0,t.Z)({width:"100%"},r),placeholder:"Please select",defaultValue:null===a||void 0===a?void 0:a.triggers,onChange:e=>{n(a.id,(0,t.Z)((0,t.Z)({},a),{},{triggers:e}))},options:[{label:"aliens",value:"aliens"},{label:"insets",value:"insets"},{label:"snakes",value:"snakes"},{label:"spiders",value:"spiders"},{label:"scarry",value:"scarry"}]},o))}var N=n(1752),E=n(5240),P=n(548);function D(e){let{data:a,addEntryToUpdate:n}=e;const{addParam:t}=(0,i.K)(),r=[{title:"CardId",dataIndex:"id",key:"id",sorter:(e,a)=>Number(e.id)-Number(a.id)},{title:"Image",dataIndex:"id",key:"image",render:e=>(0,h.jsx)(Z.f,{id:e,width:50})},{title:"Keywords",dataIndex:"keywords",key:"keywords",render:e=>null===e||void 0===e?void 0:e.join(", ")},{title:"Triggers",dataIndex:"triggers",key:"triggers",render:e=>null===e||void 0===e?void 0:e.join(", ")},{title:"Actions",key:"actions",render:(e,a)=>(0,h.jsxs)(u.Z,{children:[(0,h.jsx)(S,{imageCard:a,addEntryToUpdate:n}),(0,h.jsx)(g.ZP,{icon:(0,h.jsx)(N.Z,{}),onClick:()=>t("cardId",a.id),children:"Edit"})]})}],o=Object.values(a),s=(0,P.P)({total:o.length,showQuickJumper:!0});return(0,h.jsx)(E.Z,{dataSource:o,columns:r,rowKey:"id",pagination:s})}var U=n(359);function T(e){var a;const n=(0,U.p)(),r=(0,s.N)("images-credo"),{addParam:d,removeParam:c}=(0,i.K)();return(0,h.jsxs)(o.T,{isLoading:n.isLoading||r.isLoading,hasResponseData:n.hasResponseData||r.hasResponseData,error:null!==(a=r.error)&&void 0!==a?a:n.error,children:[(0,h.jsx)(D,(0,t.Z)({},e)),(0,h.jsx)(w,(0,t.Z)((0,t.Z)({},e),{},{onNewCard:()=>d("cardId",n.onRandomCard()),onClose:()=>c("cardId")}))]})}var R=n(7128),z=n(7018),I=n(7340),L=n(7965),q=n(763);function K(e){let{data:a,save:n,isDirty:t,isSaving:r,entriesToUpdate:o}=e;const{addParam:s}=(0,i.K)(),{onRandomCard:d}=(0,U.p)();return(0,h.jsxs)(L.Pd,{children:[(0,h.jsxs)(u.Z,{vertical:!0,gap:12,children:[(0,h.jsx)(I.k,{isDirty:t,onSave:n,isSaving:r,dirt:JSON.stringify(o)}),(0,h.jsx)(z.o,{data:()=>function(e){console.log("Preparing file for download...");const a=(0,q.cloneDeep)(e);return(0,y.Tj)(a)}(a),fileName:"image-cards.json",disabled:t,block:!0})]}),(0,h.jsx)(R.Z,{}),(0,h.jsx)(g.ZP,{onClick:()=>s("cardId",d()),block:!0,children:"Random Card"}),(0,h.jsx)(R.Z,{})]})}var O=n(4562),J=n(8938);function F(){const e=(0,J.i)({tdrResourceName:"image-cards",firebaseDataCollectionName:"imageCards",serialize:!0});return(0,h.jsx)(L.Xg,{title:"Image Cards",subtitle:"Descriptors",children:(0,h.jsxs)(r.Z,{hasSider:!0,children:[(0,h.jsx)(O.p,{children:(0,h.jsx)(K,(0,t.Z)({},e))}),(0,h.jsx)(r.Z.Content,{className:"content",children:(0,h.jsx)(o.T,{isLoading:e.isLoading,error:e.error,hasResponseData:!(0,q.isEmpty)(e.data),children:(0,h.jsx)(T,(0,t.Z)({},e))})})]})})}const Q=F}}]);
//# sourceMappingURL=ImageCardsDescriptor.331ed0ad.chunk.js.map