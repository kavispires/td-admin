"use strict";(self.webpackChunktdr=self.webpackChunktdr||[]).push([[187],{8158:(e,t,s)=>{s.d(t,{CQ:()=>h,bN:()=>p,cw:()=>j,hW:()=>x,xL:()=>m});var i=s(1105),n=s(2556),a=s(1310),r=s(6020),l=s(8955),o=s(5458),d=s(1087),c=s(7134),u=s(184);function m(e){let{item:t,width:s,className:i}=e;return(0,u.jsx)(r.ck,{id:t.id,width:s,title:"".concat(t.name.en," | ").concat(t.name.pt),className:i})}function p(e){let{item:t}=e;const s=(0,c._)();return(0,u.jsx)("span",{children:(0,u.jsx)(i.Z,{prefix:t.nsfw?(0,u.jsx)(l.Z,{style:{color:"hotPink"}}):(0,u.jsx)(o.Z,{}),placeholder:"Id",variant:"borderless",size:"small",value:t.id,readOnly:!0,style:{width:"8ch"},onClick:()=>s(t.id)})})}function h(e){let{item:t,language:s}=e;return(0,u.jsx)(i.Z,{prefix:(0,u.jsx)(a.H,{language:s,width:"1em"}),placeholder:"Name in ".concat(s.toUpperCase()),variant:"borderless",size:"small",value:t.name[s],readOnly:!0})}function x(e){let{item:t}=e;return t.nsfw?(0,u.jsx)(l.Z,{style:{color:"hotpink"}}):(0,u.jsx)(u.Fragment,{})}function j(e){let{item:t}=e;const[,s]=(0,d.lr)();return(0,u.jsx)("span",{children:(0,u.jsx)(n.ZP,{size:"small",shape:"round",onClick:()=>{s({itemId:t.id,view:"classifier"})},children:"Go to"})})}},1469:(e,t,s)=>{s.r(t),s.d(t,{ItemsGroups:()=>_,default:()=>H});var i=s(3990),n=s(2128),a=s(4520),r=s(4031),l=s(2979),o=s(6106),d=s(914),c=s(2228),u=s(6020),m=s(7134),p=s(4290),h=s(4766),x=s(5529),j=s(763),g=s(2791),y=s(5850),v=s(1674),f=s(1046),Z=s(7765),I=s(952),b=s(9228),G=s(1105),k=s(7747),w=s(9929),C=s(8158),N=s(184);function T(e){let{item:t,itemGroups:s,groupsTypeahead:i,onUpdateItemGroups:n}=e;const l=(0,m._)();return(0,N.jsxs)(v.Z,{title:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(r.Z.Text,{onClick:()=>l(t.id),children:t.id}),(0,N.jsx)(C.hW,{item:t})]}),style:{maxWidth:250},children:[(0,N.jsx)(C.xL,{item:t,width:75}),(0,N.jsxs)(f.Z,{size:"small",direction:"vertical",className:"my-4",children:[(0,N.jsx)(C.CQ,{item:t,language:"en"}),(0,N.jsx)(C.CQ,{item:t,language:"pt"}),(0,N.jsx)(Z.Z,{mode:"multiple",style:{width:"100%"},placeholder:"Select a group",defaultValue:s,options:i,showSearch:!0,size:"small",onChange:e=>n(t.id,e)},String(s)),(0,N.jsxs)(a.Z,{gap:4,children:[(0,N.jsx)(S,{item:t,itemGroups:s,groupsTypeahead:i,onUpdateItemGroups:n}),(0,N.jsx)(O,{item:t,itemGroups:s,groupsTypeahead:i,onUpdateItemGroups:n})]})]})]})}function S(e){let{item:t,itemGroups:s=[],groupsTypeahead:i,onUpdateItemGroups:n}=e;const a=(0,N.jsx)(f.Z,{wrap:!0,className:"item-groups-panel-container",children:i.map((e=>{const i=s.includes(e.value);return(0,N.jsx)(I.Z,{bordered:!i,color:i?"processing":void 0,onClick:()=>n(t.id,i?s.filter((t=>t!==e.value)):[...s,e.value]),children:e.label},e.value)}))});return(0,N.jsx)(b.Z,{content:a,title:'Select Tags for "'.concat(t.name.en,'"'),trigger:"click",placement:"bottom",children:(0,N.jsx)(I.Z,{style:{cursor:"pointer"},children:(0,N.jsx)(k.Z,{})})})}function O(e){let{item:t,itemGroups:s=[],groupsTypeahead:i,onUpdateItemGroups:n}=e;const[a,r]=(0,g.useState)(!1),[l,o]=(0,g.useState)(""),d=(0,g.useRef)(null);(0,g.useEffect)((()=>{var e;a&&(null===(e=d.current)||void 0===e||e.focus())}),[a]);const c=()=>{l&&!i.find((e=>e.label===l))&&n(t.id,[...s,l]),r(!1),o("")};return(0,N.jsx)(N.Fragment,{children:a?(0,N.jsx)(G.Z,{ref:d,type:"text",size:"small",style:{width:64,height:22,marginInlineEnd:8,verticalAlign:"top"},value:l,onChange:e=>{o(e.target.value)},onBlur:c,onPressEnter:c}):(0,N.jsx)(I.Z,{style:{height:22,borderStyle:"dashed",cursor:"pointer"},icon:(0,N.jsx)(w.Z,{}),onClick:()=>{r(!0)},children:"New Group"})})}function U(e){let{data:t,addEntryToUpdate:s}=e;const{is:i}=(0,h.K)(),n=(0,x.N)("items"),a=(0,g.useMemo)((()=>Object.values(null!==t&&void 0!==t?t:[]).reduce(((e,t)=>(t.itemsIds||console.warn("Group without items",t),t.itemsIds.forEach((s=>{e[s]||(e[s]=[]),e[s].push(t.id)})),e)),{})),[t]),r=(0,g.useMemo)((()=>(0,j.orderBy)(Object.keys(t).map((e=>({label:e,value:e}))),"label")),[t]);return(0,N.jsxs)(N.Fragment,{children:[i("display","group")&&(0,N.jsx)(E,{data:t}),i("display","item")&&(0,N.jsx)(z,{items:n.data,grousByItem:a,groupsTypeahead:r,onUpdateItemGroups:(e,i)=>{var n;const r=null!==(n=a[e])&&void 0!==n?n:[],l=i.filter((e=>!r.includes(e))),o=r.filter((e=>!i.includes(e)));l.forEach((i=>{var n,a;s(i,{id:i,itemsIds:(0,y.R1)([...null!==(n=null===(a=t[i])||void 0===a?void 0:a.itemsIds)&&void 0!==n?n:[],e])})})),o.forEach((i=>{var n;s(i,{id:i,itemsIds:(0,y.R1)(null===(n=t[i])||void 0===n?void 0:n.itemsIds.filter((t=>t!==e)))})}))}})]})}function E(e){let{data:t}=e;const s=(0,m._)(),i=[{title:"id",dataIndex:"id",key:"id",render:e=>(0,N.jsx)("span",{children:e})},{title:"Items",dataIndex:"itemsIds",key:"itemsIds",render:(e,t)=>(0,N.jsx)(a.Z,{gap:6,wrap:"wrap",children:e.map((e=>(0,N.jsxs)(a.Z,{gap:2,vertical:!0,children:[(0,N.jsx)(u.ck,{id:e,width:60}),(0,N.jsx)(a.Z,{justify:"center",children:(0,N.jsx)(r.Z.Text,{onClick:()=>s(e),children:e})})]},"".concat(t.id,"-").concat(e))))},"items-".concat(t.id))},{title:"Count",dataIndex:"itemsIds",key:"count",render:e=>(0,y.R1)(e).filter(Boolean).length}];return(0,N.jsx)(l.Z,{columns:i,dataSource:Object.values(t),className:"my-4",pagination:{showQuickJumper:!0}})}function z(e){let{items:t,grousByItem:s,groupsTypeahead:i,onUpdateItemGroups:n}=e;const{is:a}=(0,h.K)(),l=a("emptyOnly"),u=(0,g.useMemo)((()=>l?Object.values(t).filter((e=>!s[e.id])):Object.values(t)),[t,s,l]),{page:m,pagination:x}=(0,p.e)({data:u});return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(r.Z.Title,{level:2,children:["Groups by Items (",u.length,")"]}),(0,N.jsx)(c.N,{pagination:x,children:(0,N.jsx)(o.Z,{gutter:[16,16],className:"my-4",children:m.map((e=>(0,N.jsx)(d.Z,{xs:24,sm:24,md:12,lg:6,xl:4,children:(0,N.jsx)(T,{item:e,itemGroups:s[e.id],groupsTypeahead:i,onUpdateItemGroups:n})},e.id)))})})]})}var B=s(7128),D=s(6173),P=s(7018),R=s(1958),F=s(3660),L=s(9197),Q=s(7340);function K(e){var t;let{data:s,save:i,isDirty:n,isSaving:r,entriesToUpdate:l}=e;const{queryParams:o,addParam:d,is:c}=(0,h.K)();return(0,N.jsxs)(R.Pd,{children:[(0,N.jsxs)(a.Z,{vertical:!0,gap:12,children:[(0,N.jsx)(Q.k,{isDirty:n,onSave:i,isSaving:r,dirt:JSON.stringify(l)}),(0,N.jsx)(P.o,{data:()=>{return e=s,(0,y.Tj)(e);var e},fileName:"items-groups.json",disabled:n,block:!0})]}),(0,N.jsx)(B.Z,{}),(0,N.jsx)(D.H,{label:"Display",value:null!==(t=o.get("display"))&&void 0!==t?t:"group",onChange:e=>d("display",e),options:[{title:"By Groups",icon:(0,N.jsx)(F.Z,{}),value:"group"},{title:"By Items",icon:(0,N.jsx)(L.Z,{}),value:"item"}]}),(0,N.jsx)(D.Do,{label:"No Groups Only",value:c("emptyOnly"),onChange:e=>d("emptyOnly",e,!1)})]})}var M=s(4562),W=s(8938);function _(){const e=(0,W.i)({tdrResourceName:"items-groups",firebaseDataCollectionName:"itemsGroups",serialize:!0}),t=(0,x.N)("items");return(0,N.jsx)(R.Xg,{title:"Items",subtitle:"Groups Sets",children:(0,N.jsxs)(i.Z,{hasSider:!0,children:[(0,N.jsx)(M.p,{children:(0,N.jsx)(K,{...e})}),(0,N.jsx)(i.Z.Content,{className:"content",children:(0,N.jsx)(n.T,{isLoading:e.isLoading||t.isLoading,error:e.error||t.error,hasResponseData:!(0,j.isEmpty)(e.data)&&!(0,j.isEmpty)(t.data),children:(0,N.jsx)(U,{...e})})})]})})}const H=_}}]);
//# sourceMappingURL=ItemsGroups.f22bef83.chunk.js.map